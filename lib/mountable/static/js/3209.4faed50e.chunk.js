var stlite;(()=>{"use strict";var e={36315:e=>{function t(e){if("string"!==typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function r(e,t){for(var r,n="",o=0,s=-1,a=0,i=0;i<=e.length;++i){if(i<e.length)r=e.charCodeAt(i);else{if(47===r)break;r=47}if(47===r){if(s===i-1||1===a);else if(s!==i-1&&2===a){if(n.length<2||2!==o||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2))if(n.length>2){var l=n.lastIndexOf("/");if(l!==n.length-1){-1===l?(n="",o=0):o=(n=n.slice(0,l)).length-1-n.lastIndexOf("/"),s=i,a=0;continue}}else if(2===n.length||1===n.length){n="",o=0,s=i,a=0;continue}t&&(n.length>0?n+="/..":n="..",o=2)}else n.length>0?n+="/"+e.slice(s+1,i):n=e.slice(s+1,i),o=i-s-1;s=i,a=0}else 46===r&&-1!==a?++a:a=-1}return n}var n={resolve:function(){for(var e,n="",o=!1,s=arguments.length-1;s>=-1&&!o;s--){var a;s>=0?a=arguments[s]:(void 0===e&&(e=process.cwd()),a=e),t(a),0!==a.length&&(n=a+"/"+n,o=47===a.charCodeAt(0))}return n=r(n,!o),o?n.length>0?"/"+n:"/":n.length>0?n:"."},normalize:function(e){if(t(e),0===e.length)return".";var n=47===e.charCodeAt(0),o=47===e.charCodeAt(e.length-1);return 0!==(e=r(e,!n)).length||n||(e="."),e.length>0&&o&&(e+="/"),n?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,r=0;r<arguments.length;++r){var o=arguments[r];t(o),o.length>0&&(void 0===e?e=o:e+="/"+o)}return void 0===e?".":n.normalize(e)},relative:function(e,r){if(t(e),t(r),e===r)return"";if((e=n.resolve(e))===(r=n.resolve(r)))return"";for(var o=1;o<e.length&&47===e.charCodeAt(o);++o);for(var s=e.length,a=s-o,i=1;i<r.length&&47===r.charCodeAt(i);++i);for(var l=r.length-i,c=a<l?a:l,d=-1,g=0;g<=c;++g){if(g===c){if(l>c){if(47===r.charCodeAt(i+g))return r.slice(i+g+1);if(0===g)return r.slice(i+g)}else a>c&&(47===e.charCodeAt(o+g)?d=g:0===g&&(d=0));break}var p=e.charCodeAt(o+g);if(p!==r.charCodeAt(i+g))break;47===p&&(d=g)}var u="";for(g=o+d+1;g<=s;++g)g!==s&&47!==e.charCodeAt(g)||(0===u.length?u+="..":u+="/..");return u.length>0?u+r.slice(i+d):(i+=d,47===r.charCodeAt(i)&&++i,r.slice(i))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var r=e.charCodeAt(0),n=47===r,o=-1,s=!0,a=e.length-1;a>=1;--a)if(47===(r=e.charCodeAt(a))){if(!s){o=a;break}}else s=!1;return-1===o?n?"/":".":n&&1===o?"//":e.slice(0,o)},basename:function(e,r){if(void 0!==r&&"string"!==typeof r)throw new TypeError('"ext" argument must be a string');t(e);var n,o=0,s=-1,a=!0;if(void 0!==r&&r.length>0&&r.length<=e.length){if(r.length===e.length&&r===e)return"";var i=r.length-1,l=-1;for(n=e.length-1;n>=0;--n){var c=e.charCodeAt(n);if(47===c){if(!a){o=n+1;break}}else-1===l&&(a=!1,l=n+1),i>=0&&(c===r.charCodeAt(i)?-1===--i&&(s=n):(i=-1,s=l))}return o===s?s=l:-1===s&&(s=e.length),e.slice(o,s)}for(n=e.length-1;n>=0;--n)if(47===e.charCodeAt(n)){if(!a){o=n+1;break}}else-1===s&&(a=!1,s=n+1);return-1===s?"":e.slice(o,s)},extname:function(e){t(e);for(var r=-1,n=0,o=-1,s=!0,a=0,i=e.length-1;i>=0;--i){var l=e.charCodeAt(i);if(47!==l)-1===o&&(s=!1,o=i+1),46===l?-1===r?r=i:1!==a&&(a=1):-1!==r&&(a=-1);else if(!s){n=i+1;break}}return-1===r||-1===o||0===a||1===a&&r===o-1&&r===n+1?"":e.slice(r,o)},format:function(e){if(null===e||"object"!==typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var r=t.dir||t.root,n=t.base||(t.name||"")+(t.ext||"");return r?r===t.root?r+n:r+e+n:n}("/",e)},parse:function(e){t(e);var r={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return r;var n,o=e.charCodeAt(0),s=47===o;s?(r.root="/",n=1):n=0;for(var a=-1,i=0,l=-1,c=!0,d=e.length-1,g=0;d>=n;--d)if(47!==(o=e.charCodeAt(d)))-1===l&&(c=!1,l=d+1),46===o?-1===a?a=d:1!==g&&(g=1):-1!==a&&(g=-1);else if(!c){i=d+1;break}return-1===a||-1===l||0===g||1===g&&a===l-1&&a===i+1?-1!==l&&(r.base=r.name=0===i&&s?e.slice(1,l):e.slice(i,l)):(0===i&&s?(r.name=e.slice(1,a),r.base=e.slice(1,l)):(r.name=e.slice(i,a),r.base=e.slice(i,l)),r.ext=e.slice(a,l)),i>0?r.dir=e.slice(0,i-1):s&&(r.dir="/"),r},sep:"/",delimiter:":",win32:null,posix:null};n.posix=n,e.exports=n}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,r),s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);new RegExp("[[(<=>!~;@]");class n{constructor(){this.promise=new Promise(((e,t)=>{this.resolveInternal=e,this.rejectInternal=t}))}resolve(e){this.resolveInternal(e)}reject(e){this.rejectInternal(e)}}var o=r(36315),s=r.n(o);const a="/home/pyodide",i=e=>`${a}/${e}`,l=(e,t)=>null==e?s().resolve(a,t):s().resolve(i(e),t);function c(e,t){const r=s().normalize(t),n=s().dirname(r).split("/"),o=[];for(const s of n){o.push(s);const t=o.join("/");if(e.FS.analyzePath(t).exists){if(e.FS.isDir(t))throw new Error(`"${t}" already exists and is not a directory.`)}else try{e.FS.mkdir(t)}catch(a){throw console.error(`Failed to create a directory "${t}"`),a}}}function d(e,t,r,n){c(e,t),e.FS.writeFile(t,r,n)}const g=new RegExp("[[(<=>!~;@]");function p(e){e.forEach((e=>{let t;try{t=new URL(e)}catch{return}if("emfs:"===t.protocol||"file:"===t.protocol)throw new Error(`"emfs:" and "file:" protocols are not allowed for the requirement (${e})`)}));return e.filter((e=>{const t="streamlit"===function(e){return e.split(g)[0].trim()}(e);return!t||(console.warn(`Streamlit is specified in the requirements ("${e}"), but it will be ignored. A built-in version of Streamlit will be used.`),!1)}))}async function u(e,t){const{scriptURL:r,pyodideIndexURL:n,isESModule:o}=await async function(e){var t;const r="undefined"!==typeof process&&(null===(t=process.versions)||void 0===t?void 0:t.node);let n;n=r?(await import("node:path")).sep:"/";const o=e.slice(0,e.lastIndexOf(n)+1);if(e.endsWith(".mjs")){if(r){const t=await import("node:path"),r=await import("node:url");!e.includes("://")&&t.isAbsolute(e)&&(e=r.pathToFileURL(e).href)}return{scriptURL:e,pyodideIndexURL:o,isESModule:!0}}return{scriptURL:e,pyodideIndexURL:o,isESModule:!1}}(e);let s;if(o){s=(await import(r)).loadPyodide}else importScripts(r),s=self.loadPyodide;return s({...t,indexURL:n})}async function m(e,t,r){const n=e.pyimport("pyodide"),o=r.map((e=>(e=>n.code.find_imports(e).toJs())(e))),s=Array.from(new Set(o.flat())).filter((t=>!e.runPython(`__import__('importlib').util.find_spec('${t}')`))).map((t=>e._api._import_name_to_package_name.get(t))).filter((e=>e));if(0===s.length)return;const a=new MessageChannel;t({type:"event:moduleAutoLoad",data:{packagesToLoad:s}},a.port2);try{const t=await e.loadPackage(s);return a.port1.postMessage({type:"moduleAutoLoad:success",data:{loadedPackages:t}}),void a.port1.close()}catch(i){throw a.port1.postMessage({type:"moduleAutoLoad:error",error:i}),a.port1.close(),i}}const f=r.g;function h(e,t,r){const n=m(e,t,r);f.__moduleAutoLoadPromise__=n,e.runPythonAsync("\nfrom streamlit.runtime.scriptrunner import script_runner\nfrom js import __moduleAutoLoadPromise__\n\nscript_runner.moduleAutoLoadPromise = __moduleAutoLoadPromise__\n")}let _=null;function y(e,t,r,o){function s(e){t({type:"event:progress",data:{message:e}})}let a,g;const m=new n;const y=async function(){var n,c;const y=await m.promise,b={...r,...y};console.debug("Initial data",b);const{entrypoint:v,files:w,archives:k,requirements:S,prebuiltPackageNames:A,wheels:P,pyodideUrl:C=e,streamlitConfig:F,idbfsMountpoints:L,nodefsMountpoints:I,moduleAutoLoad:E}=b,R=p(S);_?(s("Pyodide is already loaded."),console.debug("Pyodide is already loaded."),a=await _):(s("Loading Pyodide."),console.debug("Loading Pyodide."),_=u(C,{stdout:console.log,stderr:console.error}),a=await _,P&&(R.unshift(P.streamlit),R.unshift(P.stliteLib)),console.debug("Loaded Pyodide"));let x=!1;L&&(x=!0,L.forEach((e=>{a.FS.mkdir(e),a.FS.mount(a.FS.filesystems.IDBFS,{},e)})),await new Promise(((e,t)=>{a.FS.syncfs(!0,(r=>{r?t(r):e()}))}))),I&&Object.entries(I).forEach((e=>{let[t,r]=e;a.FS.mkdir(t),a.FS.mount(a.FS.filesystems.NODEFS,{root:r},t)})),s("Mounting files.");const M=[];await Promise.all(Object.keys(w).map((async e=>{const t=w[e];let r;e=l(o,e),"url"in t?(console.debug(`Fetch a file from ${t.url}`),r=await fetch(t.url).then((e=>e.arrayBuffer())).then((e=>new Uint8Array(e)))):r=t.data,console.debug(`Write a file "${e}"`),d(a,e,r,w.opts),e.endsWith(".py")&&M.push(e)}))),s("Unpacking archives."),await Promise.all(k.map((async e=>{let t;"url"in e?(console.debug(`Fetch an archive from ${e.url}`),t=await fetch(e.url).then((e=>e.arrayBuffer()))):t=e.buffer;const{format:r,options:n}=e;console.debug("Unpack an archive",{format:r,options:n}),a.unpackArchive(t,r,n)}))),await a.loadPackage("micropip");const j=a.pyimport("micropip");if(s("Mocking some packages."),console.debug("Mock pyarrow"),function(e){e.runPython('\nimport micropip\nmicropip.add_mock_package(\n    "pyarrow", "0.0.1",\n    modules={\n        "pyarrow": """\n__version__ = \'0.0.1\'  # TODO: Update when releasing\n\n\nclass Table:\n    @classmethod\n    def from_pandas(*args, **kwargs):\n        raise NotImplementedError("stlite is not supporting this method.")\n\n\nclass Array:\n    def __init__(self, *args, **kwargs):\n        raise NotImplementedError("stlite is not supporting PyArrow.Array")\n\n\nclass ChunkedArray:\n    def __init__(self, *args, **kwargs):\n        raise NotImplementedError("stlite is not supporting PyArrow.ChunkedArray")\n"""\n    }\n)\n')}(a),console.debug("Mocked pyarrow"),s("Installing packages."),console.debug("Installing the prebuilt packages:",A),await a.loadPackage(A),console.debug("Installed the prebuilt packages"),console.debug("Installing the requirements:",R),await j.install.callKwargs(R,{keep_going:!0}),console.debug("Installed the requirements"),E){const e=M.map((e=>a.FS.readFile(e,{encoding:"utf8"})));h(a,t,e)}await a.runPythonAsync("\nimport importlib\nimportlib.invalidate_caches()\n"),s("Loading streamlit package."),console.debug("Loading the Streamlit package"),await a.runPythonAsync("\nimport streamlit.runtime\n    "),console.debug("Loaded the Streamlit package"),s("Setting up the loggers."),console.debug("Setting the loggers"),await a.runPythonAsync('\nimport logging\nimport streamlit.logger\n\nstreamlit.logger.get_logger = logging.getLogger\nstreamlit.logger.setup_formatter = None\nstreamlit.logger.update_formatter = lambda *a, **k: None\nstreamlit.logger.set_log_level = lambda *a, **k: None\n\nfor name in streamlit.logger._loggers.keys():\n    if name == "root":\n        name = "streamlit"\n    logger = logging.getLogger(name)\n    logger.propagate = True\n    logger.handlers.clear()\n    logger.setLevel(logging.NOTSET)\n\nstreamlit.logger._loggers = {}\n'),f.__logCallback__=(e,t)=>{e>=40?console.error(t):e>=30?console.warn(t):e>=20?console.info(t):console.debug(t)},await a.runPythonAsync('\ndef setup_loggers(streamlit_level, streamlit_message_format):\n    from js import __logCallback__\n\n\n    class JsHandler(logging.Handler):\n        def emit(self, record):\n            msg = self.format(record)\n            __logCallback__(record.levelno, msg)\n\n\n    root_message_format = "%(levelname)s:%(name)s:%(message)s"\n\n    root_logger = logging.getLogger()\n    root_logger.handlers.clear()\n    root_formatter = logging.Formatter(root_message_format)\n    root_handler = JsHandler()\n    root_handler.setFormatter(root_formatter)\n    root_logger.addHandler(root_handler)\n    root_logger.setLevel(logging.DEBUG)\n\n    streamlit_logger = logging.getLogger("streamlit")\n    streamlit_logger.propagate = False\n    streamlit_logger.handlers.clear()\n    streamlit_formatter = logging.Formatter(streamlit_message_format)\n    streamlit_handler = JsHandler()\n    streamlit_handler.setFormatter(streamlit_formatter)\n    streamlit_logger.addHandler(streamlit_handler)\n    streamlit_logger.setLevel(streamlit_level.upper())\n');const O=(null!==(n=null===F||void 0===F?void 0:F["logger.level"])&&void 0!==n?n:"INFO").toString(),U=null!==(c=null===F||void 0===F?void 0:F["logger.messageFormat"])&&void 0!==c?c:"%(asctime)s %(message)s";if(a.globals.get("setup_loggers")(O,U),console.debug("Set the loggers"),s("Mocking some Streamlit functions for the browser environment."),console.debug("Mocking some Streamlit functions"),await a.runPythonAsync("\nimport streamlit\n\ndef is_cacheable_msg(msg):\n    return False\n\nstreamlit.runtime.runtime.is_cacheable_msg = is_cacheable_msg\n"),console.debug("Mocked some Streamlit functions"),x){s("Setting up the IndexedDB filesystem synchronizer."),console.debug("Setting up the IndexedDB filesystem synchronizer");let e=!1;f.__scriptFinishedCallback__=()=>{console.debug("The script has finished. Syncing the filesystem."),e||(e=!0,a.FS.syncfs(!1,(t=>{e=!1,t&&console.error(t)})))},await a.runPythonAsync('\nfrom streamlit.runtime.app_session import AppSession\nfrom streamlit.runtime.scriptrunner import ScriptRunnerEvent\nfrom js import __scriptFinishedCallback__\n\ndef wrap_app_session_on_scriptrunner_event(original_method):\n    def wrapped(self, *args, **kwargs):\n        if "event" in kwargs:\n            event = kwargs["event"]\n            if event == ScriptRunnerEvent.SCRIPT_STOPPED_WITH_SUCCESS or event == ScriptRunnerEvent.SCRIPT_STOPPED_FOR_RERUN or event == ScriptRunnerEvent.SHUTDOWN:\n                __scriptFinishedCallback__()\n        return original_method(self, *args, **kwargs)\n    return wrapped\n\nAppSession._on_scriptrunner_event = wrap_app_session_on_scriptrunner_event(AppSession._on_scriptrunner_event)\n'),console.debug("Set up the IndexedDB filesystem synchronizer")}const T=l(o,v);s("Booting up the Streamlit server."),console.debug("Setting up the Streamlit configuration"),f.__sharedWorkerMode__=null!=o,f.__streamlitFlagOptions__={"browser.gatherUsageStats":!1,...F,"runner.fastReruns":!1},await a.runPythonAsync(`\nfrom stlite_lib.bootstrap import load_config_options, prepare\nfrom js import __sharedWorkerMode__, __streamlitFlagOptions__\n\nflag_options = __streamlitFlagOptions__.to_py()\nload_config_options(flag_options, __sharedWorkerMode__)\n\nmain_script_path = "${T}"\nargs = []\n\nprepare(main_script_path, args)\n`),console.debug("Set up the Streamlit configuration"),console.debug("Booting up the Streamlit server");const $=a.pyimport("stlite_lib.server.Server");return g=$(T,o?i(o):null),await g.start(),console.debug("Booted up the Streamlit server"),t({type:"event:loaded"}),b}().catch((e=>{throw t({type:"event:error",data:{error:e}}),e}));return t({type:"event:start"}),async e=>{const r=e.data;if("initData"===r.type)return void m.resolve(r.data);const{moduleAutoLoad:n}=await y,s=e.ports[0];function i(e){s.postMessage(e)}try{switch(r.type){case"reboot":{console.debug("Reboot the Streamlit server",r.data);const{entrypoint:e}=r.data;g.stop(),console.debug("Booting up the Streamlit server");const t=a.pyimport("stlite_lib.server.Server");g=t(e),g.start(),console.debug("Booted up the Streamlit server"),i({type:"reply"});break}case"websocket:connect":{console.debug("websocket:connect",r.data);const{path:e}=r.data;g.start_websocket(e,((e,r)=>{if(r){const r=e,n=r.getBuffer("u8");r.destroy();const o=new Uint8ClampedArray(n.data.buffer,n.data.byteOffset,n.data.byteLength);t({type:"websocket:message",data:{payload:new Uint8Array(o)}})}else{t({type:"websocket:message",data:{payload:e}})}})),i({type:"reply"});break}case"websocket:send":{console.debug("websocket:send",r.data);const{payload:e}=r.data;g.receive_websocket_from_js(e);break}case"http:request":{console.debug("http:request",r.data);const{request:e}=r.data,t=(e,t,r)=>{const n=new Map(t.toJs()),o=r.toJs();console.debug({statusCode:e,headers:n,body:o}),i({type:"http:response",data:{response:{statusCode:e,headers:n,body:o}}})};g.receive_http_from_js(e.method,decodeURIComponent(e.path),e.headers,e.body,t);break}case"file:write":{const{path:e,data:s,opts:c}=r.data,g=l(o,e);n&&"string"===typeof s&&g.endsWith(".py")&&(console.debug(`Auto install the requirements in ${g}`),h(a,t,[s])),console.debug(`Write a file "${g}"`),d(a,g,s,c),i({type:"reply"});break}case"file:rename":{const{oldPath:e,newPath:t}=r.data,n=l(o,e),s=l(o,t);console.debug(`Rename "${n}" to ${s}`),function(e,t,r){c(e,r),e.FS.rename(t,r)}(a,n,s),i({type:"reply"});break}case"file:unlink":{const{path:e}=r.data,t=l(o,e);console.debug(`Remove "${t}`),a.FS.unlink(t),i({type:"reply"});break}case"file:read":{const{path:e,opts:t}=r.data;console.debug(`Read "${e}"`);i({type:"reply:file:read",data:{content:a.FS.readFile(e,t)}});break}case"install":{const{requirements:e}=r.data,t=a.pyimport("micropip"),n=p(e);console.debug("Install the requirements:",n),await t.install.callKwargs(n,{keep_going:!0}).then((()=>{console.debug("Successfully installed"),i({type:"reply"})}))}}}catch(u){if(console.error(u),!(u instanceof Error))throw u;const e=new Error(u.message);e.name=u.name,e.stack=u.stack,i({type:"reply",error:e})}}}const b="abcdefghijklmnopqrstuvwxyz";function v(e){let t="";for(let r=0;r<e;r++){const e=Math.floor(26*Math.random());t+=b[e]}return t}const w="https://cdn.jsdelivr.net/pyodide/v0.26.2/full/pyodide.js";if("postMessage"in self)self.onmessage=y(w,((e,t)=>self.postMessage(e,t?[t]:void 0)));else{const e=[];self.onconnect=t=>{let r;do{r=v(4)}while(e.includes(r));e.push(r),console.debug("SharedWorker mode.",{appId:r});const n=t.ports[0];n.onmessage=y(w,((e,t)=>n.postMessage(e,t?[t]:void 0)),void 0,r),n.start()}}stlite={}})();
//# sourceMappingURL=3209.4faed50e.chunk.js.map