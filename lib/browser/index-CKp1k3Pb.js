import{r,E as P,_ as X,d5 as y,K as f,M as _,l as ne,c as S,z as de,bN as ue,cX as ce,j as l,bX as pe,bY as me,ca as be,bZ as fe,bG as ge,bV as G}from"./index-BlQj7Hmn.js";import{u as he}from"./uniqueId-CBRr8s3C.js";import{u as ve}from"./FormClearHelper-qP1iiDtn.js";import{I as ye}from"./InputInstructions-Bv4afE3Q.js";import{s as we}from"./sprintf-CQZ7AWXD.js";import{I as Ie}from"./input-EKKpbJma.js";var K=r.forwardRef(function(e,t){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(P,X({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 8 8"},e,{ref:t}),r.createElement("path",{d:"M0 3v2h8V3H0z"}))});K.displayName="Minus";var Y=r.forwardRef(function(e,t){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(P,X({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 8 8"},e,{ref:t}),r.createElement("path",{d:"M3 0v3H0v2h3v3h2V5h3V3H5V0H3z"}))});Y.displayName="Plus";const Te=ne.getLogger("NumberInput");function xe(e){return f(e)||e===""?void 0:e}const j=({value:e,format:t,step:o,dataType:b})=>{if(f(e))return null;let c=xe(t);if(f(c)&&_(o)){const i=o.toString();b===y.DataType.FLOAT&&o!==0&&i.includes(".")&&(c=`%0.${i.split(".")[1].length}f`)}if(f(c))return e.toString();try{return we.sprintf(c,e)}catch(i){return Te.warn(`Error in sprintf(${c}, ${e}): ${i}`),String(e)}},ke=(e,t,o)=>f(e)?!1:e-t>=o,Ce=(e,t,o)=>f(e)?!1:e+t<=o,Re=e=>(e.element.dataType===y.DataType.INT?e.widgetMgr.getIntValue(e.element):e.widgetMgr.getDoubleValue(e.element))??e.element.default??null,Z=({step:e,dataType:t})=>e||(t===y.DataType.INT?1:.01),Se=S("div",{target:"e116k4er3"})(({theme:e})=>({display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"center",height:e.sizes.minElementHeight,borderWidth:e.sizes.borderWidth,borderStyle:"solid",borderColor:e.colors.widgetBorderColor??e.colors.secondaryBg,transitionDuration:"200ms",transitionProperty:"border",transitionTimingFunction:"cubic-bezier(0.2, 0.8, 0.4, 1)",borderRadius:e.radii.default,overflow:"hidden","&.focused":{borderColor:e.colors.primary},input:{MozAppearance:"textfield","&::-webkit-inner-spin-button, &::-webkit-outer-spin-button":{WebkitAppearance:"none",margin:e.spacing.none}}}),""),Ve=S("div",{target:"e116k4er2"})({name:"76z9jo",styles:"display:flex;flex-direction:row;align-self:stretch"}),q=S("button",{target:"e116k4er1"})(({theme:e})=>({margin:e.spacing.none,border:"none",height:e.sizes.full,display:"flex",alignItems:"center",width:e.sizes.numberInputControlsWidth,justifyContent:"center",color:e.colors.bodyText,transition:"color 300ms, backgroundColor 300ms",backgroundColor:e.colors.secondaryBg,"&:hover:enabled, &:focus:enabled":{color:e.colors.white,backgroundColor:e.colors.primary,transition:"none",outline:"none"},"&:active":{outline:"none",border:"none"},"&:last-of-type":{borderTopRightRadius:e.radii.default,borderBottomRightRadius:e.radii.default},"&:disabled":{cursor:"not-allowed",color:e.colors.fadedText40}}),""),De=S("div",{target:"e116k4er0"})(({theme:e,clearable:t})=>({position:"absolute",marginRight:e.spacing.twoXS,left:0,right:`calc(${e.sizes.numberInputControlsWidth} * 2 + ${t?"1em":"0em"})`}),""),Ee=({disabled:e,element:t,widgetMgr:o,fragmentId:b})=>{var c;const i=de(),{dataType:V,id:D,formId:p,default:B,format:F,min:g,max:h}=t,[W,J]=ue(),[s,Q]=r.useState(()=>Z(t)),A=Re({element:t,widgetMgr:o}),[v,w]=r.useState(!1),[d,I]=r.useState(A),[L,T]=r.useState(()=>j({value:A,...t,step:s})),[M,U]=r.useState(!1),x=r.useRef(null),H=r.useRef(he("number_input_")),k=ke(d,s,g),C=Ce(d,s,h),$=ce({formId:p}),ee=$?o.allowFormEnterToSubmit(p):v,te=M&&W>i.breakpoints.hideWidgetDetails;r.useEffect(()=>{Q(Z({step:t.step,dataType:t.dataType}))},[t.dataType,t.step]);const u=r.useCallback(({value:a,source:n})=>{var m;if(_(a)&&(g>a||a>h))(m=x.current)==null||m.reportValidity();else{const R=a??B??null;switch(V){case y.DataType.INT:o.setIntValue({id:D,formId:p},R,n,b);break;case y.DataType.FLOAT:o.setDoubleValue({id:D,formId:p},R,n,b);break;default:throw new Error("Invalid data type")}w(!1),I(R),T(j({value:R,dataType:V,format:F,step:s}))}},[g,h,x,o,b,s,V,D,p,B,F]),re=r.useCallback(()=>{v&&u({value:d,source:{fromUi:!0}}),U(!1)},[v,d,u]),ae=r.useCallback(()=>{U(!0)},[]),O=r.useCallback(()=>{const{value:a}=t;t.setValue=!1,I(a??null),T(j({value:a??null,...t,step:s})),u({value:a??null,source:{fromUi:!1}})},[t,s,u]);r.useEffect(()=>{t.setValue?O():u({value:d,source:{fromUi:!1}});const a=x.current;if(a){const n=m=>{m.preventDefault()};return a.addEventListener("wheel",n),()=>{a.removeEventListener("wheel",n)}}},[]),t.setValue&&O();const E=f(t.default)&&!e,oe=r.useCallback(()=>{const a=t.default??null;I(a),u({value:a,source:{fromUi:!0}})},[t]);ve({element:t,widgetMgr:o,onFormCleared:oe});const ie=a=>{const{value:n}=a.target;if(n==="")w(!0),I(null),T(null);else{let m;t.dataType===y.DataType.INT?m=parseInt(n,10):m=parseFloat(n),w(!0),I(m),T(n)}},z=r.useCallback(()=>{C&&(w(!0),u({value:(d??g)+s,source:{fromUi:!0}}))},[d,g,s,C]),N=r.useCallback(()=>{k&&(w(!0),u({value:(d??h)-s,source:{fromUi:!0}}))},[d,h,s,k]),le=r.useCallback(a=>{const{key:n}=a;switch(n){case"ArrowUp":a.preventDefault(),z();break;case"ArrowDown":a.preventDefault(),N();break}},[z,N]),se=r.useCallback(a=>{a.key==="Enter"&&(v&&u({value:d,source:{fromUi:!0}}),o.allowFormEnterToSubmit(p)&&o.submitForm(p,b))},[v,d,u,o,p,b]);return l.jsxs("div",{className:"stNumberInput","data-testid":"stNumberInput",ref:J,children:[l.jsx(pe,{label:t.label,disabled:e,labelVisibility:me((c=t.labelVisibility)==null?void 0:c.value),htmlFor:H.current,children:t.help&&l.jsx(be,{children:l.jsx(fe,{content:t.help,placement:ge.TOP_RIGHT})})}),l.jsxs(Se,{className:M?"focused":"","data-testid":"stNumberInputContainer",children:[l.jsx(Ie,{type:"number",inputRef:x,value:L??"",placeholder:t.placeholder,onBlur:re,onFocus:ae,onChange:ie,onKeyPress:se,onKeyDown:le,clearable:E,clearOnEscape:E,disabled:e,"aria-label":t.label,id:H.current,overrides:{ClearIconContainer:{style:{padding:0}},ClearIcon:{props:{overrides:{Svg:{style:{color:i.colors.darkGray,padding:i.spacing.threeXS,height:i.sizes.clearIconSize,width:i.sizes.clearIconSize,":hover":{fill:i.colors.bodyText}}}}}},Input:{props:{"data-testid":"stNumberInputField",step:s,min:g,max:h,type:"number",inputMode:""},style:{lineHeight:i.lineHeights.inputWidget,paddingRight:i.spacing.sm,paddingLeft:i.spacing.md,paddingBottom:i.spacing.sm,paddingTop:i.spacing.sm}},InputContainer:{style:()=>({borderTopRightRadius:0,borderBottomRightRadius:0})},Root:{style:{borderTopRightRadius:0,borderBottomRightRadius:0,borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeftWidth:0,borderRightWidth:0,borderTopWidth:0,borderBottomWidth:0,paddingRight:0}}}}),W>i.breakpoints.hideNumberInputControls&&l.jsxs(Ve,{children:[l.jsx(q,{"data-testid":"stNumberInputStepDown",onClick:N,disabled:!k||e,tabIndex:-1,children:l.jsx(G,{content:K,size:"xs",color:k?"inherit":i.colors.disabled})}),l.jsx(q,{"data-testid":"stNumberInputStepUp",onClick:z,disabled:!C||e,tabIndex:-1,children:l.jsx(G,{content:Y,size:"xs",color:C?"inherit":i.colors.disabled})})]})]}),te&&l.jsx(De,{clearable:E,children:l.jsx(ye,{dirty:v,value:L??"",inForm:$,allowEnterToSubmit:ee})})]})},ze=r.memo(Ee);export{ze as default};
