{"version":3,"file":"index-B8oDcWjz.js","sources":["../../../streamlit/frontend/lib/src/components/elements/ImageList/styled-components.ts","../../../streamlit/frontend/lib/src/components/elements/ImageList/ImageList.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2025)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport styled from \"@emotion/styled\"\n\nexport const StyledImageList = styled.div(({ theme }) => ({\n  display: \"flex\",\n  flexDirection: \"row\",\n  flexWrap: \"wrap\",\n  // Not supported in Safari, but at least it's not a regression for those users:\n  rowGap: theme.spacing.lg,\n  maxWidth: \"100%\",\n  width: \"fit-content\",\n}))\n\nexport const StyledImageContainer = styled.div(({ theme }) => ({\n  display: \"flex\",\n  flexDirection: \"column\",\n  alignItems: \"stretch\",\n  width: \"auto\",\n  flexGrow: 0,\n\n  \">img\": {\n    borderRadius: theme.radii.default,\n  },\n}))\n\nexport const StyledCaption = styled.div(({ theme }) => ({\n  textAlign: \"center\",\n  marginTop: theme.spacing.xs,\n  wordWrap: \"break-word\",\n  padding: theme.spacing.threeXS,\n}))\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2025)\n * Copyright (c) Yuichiro Tachibana (Tsuchiya) (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { CSSProperties, memo, ReactElement } from \"react\"\n\nimport { getLogger } from \"loglevel\"\n\nimport {\n  ImageList as ImageListProto,\n  Image as ImageProto,\n} from \"@streamlit/protobuf\"\n\nimport { StreamlitEndpoints } from \"~lib/StreamlitEndpoints\"\nimport { ElementFullscreenContext } from \"~lib/components/shared/ElementFullscreen/ElementFullscreenContext\"\nimport { withFullScreenWrapper } from \"~lib/components/shared/FullScreenWrapper\"\nimport StreamlitMarkdown from \"~lib/components/shared/StreamlitMarkdown\"\nimport Toolbar, {\n  StyledToolbarElementContainer,\n} from \"~lib/components/shared/Toolbar\"\nimport { useRequiredContext } from \"~lib/hooks/useRequiredContext\"\n\nimport { useStliteMediaObjects } from \"@stlite/kernel\"\n\nimport {\n  StyledCaption,\n  StyledImageContainer,\n  StyledImageList,\n} from \"./styled-components\"\n\nconst LOG = getLogger(\"ImageList\")\n\nexport interface ImageListProps {\n  endpoints: StreamlitEndpoints\n  element: ImageListProto\n  disableFullscreenMode?: boolean\n}\n\n/**\n * @see WidthBehavior on the Backend\n * @see the Image.proto file\n */\nenum WidthBehavior {\n  OriginalWidth = -1,\n  /** @deprecated */\n  ColumnWidth = -2,\n  /** @deprecated */\n  AutoWidth = -3,\n  MinImageOrContainer = -4,\n  MaxImageOrContainer = -5,\n}\n\n/**\n * Functional element for a horizontal list of images.\n */\nfunction ImageList({\n  element,\n  endpoints,\n  disableFullscreenMode,\n}: Readonly<ImageListProps>): ReactElement {\n  const images = useStliteMediaObjects(element.imgs)\n\n  const {\n    expanded: isFullScreen,\n    width,\n    height,\n    expand,\n    collapse,\n  } = useRequiredContext(ElementFullscreenContext)\n\n  // The width of the element is the width of the container, not necessarily the image.\n  const elementWidth = width || 0\n  // The width field in the proto sets the image width, but has special\n  // cases the values in the WidthBehavior enum.\n  let imageWidth: number | undefined\n  const protoWidth = element.width\n\n  if (\n    [\n      WidthBehavior.OriginalWidth,\n      WidthBehavior.AutoWidth,\n      WidthBehavior.MinImageOrContainer,\n    ].includes(protoWidth)\n  ) {\n    // Use the original image width.\n    imageWidth = undefined\n  } else if (\n    [WidthBehavior.ColumnWidth, WidthBehavior.MaxImageOrContainer].includes(\n      protoWidth\n    )\n  ) {\n    // Use the full element width (which handles the full screen case)\n    imageWidth = elementWidth\n  } else if (protoWidth > 0) {\n    // Set the image width explicitly.\n    imageWidth = protoWidth\n  } else {\n    throw Error(`Invalid image width: ${protoWidth}`)\n  }\n\n  const imgStyle: CSSProperties = {}\n\n  if (height && isFullScreen) {\n    imgStyle.maxHeight = height\n    imgStyle.objectFit = \"contain\"\n  } else {\n    imgStyle.width = imageWidth\n    // Cap the image width, so it doesn't exceed its parent container width\n    imgStyle.maxWidth = \"100%\"\n  }\n\n  const handleImageError = (\n    e: React.SyntheticEvent<HTMLImageElement>\n  ): void => {\n    const imageUrl = e.currentTarget.src\n    LOG.error(`Client Error: Image source error - ${imageUrl}`)\n    endpoints.sendClientErrorToHost(\n      \"Image\",\n      \"Image source failed to load\",\n      \"onerror triggered\",\n      imageUrl\n    )\n  }\n\n  return (\n    <StyledToolbarElementContainer\n      width={elementWidth}\n      height={height}\n      useContainerWidth={isFullScreen}\n      topCentered\n    >\n      <Toolbar\n        target={StyledToolbarElementContainer}\n        isFullScreen={isFullScreen}\n        onExpand={expand}\n        onCollapse={collapse}\n        disableFullscreenMode={disableFullscreenMode}\n      ></Toolbar>\n      <StyledImageList className=\"stImage\" data-testid=\"stImage\">\n        {images.map((iimage, idx): ReactElement => {\n          const image = iimage as ImageProto\n          return (\n            // TODO: Update to match React best practices\n            // eslint-disable-next-line @eslint-react/no-array-index-key\n            <StyledImageContainer data-testid=\"stImageContainer\" key={idx}>\n              <img\n                style={imgStyle}\n                src={endpoints.buildMediaURL(image.url)}\n                alt={idx.toString()}\n                onError={handleImageError}\n              />\n              {image.caption && (\n                <StyledCaption data-testid=\"stImageCaption\" style={imgStyle}>\n                  <StreamlitMarkdown\n                    source={image.caption}\n                    allowHTML={false}\n                    isCaption\n                    // This is technically not a label but we want the same restrictions\n                    // as for labels (e.g. no Markdown tables or horizontal rule).\n                    isLabel\n                  />\n                </StyledCaption>\n              )}\n            </StyledImageContainer>\n          )\n        })}\n      </StyledImageList>\n    </StyledToolbarElementContainer>\n  )\n}\n\nconst ImageListWithFullScreen = withFullScreenWrapper(ImageList)\nexport default memo(ImageListWithFullScreen)\n"],"names":["StyledImageList","target","theme","display","flexDirection","flexWrap","rowGap","spacing","lg","maxWidth","width","StyledImageContainer","alignItems","flexGrow","borderRadius","radii","default","StyledCaption","textAlign","marginTop","xs","wordWrap","padding","threeXS","LOG","getLogger","ImageList","element","endpoints","disableFullscreenMode","images","useStliteMediaObjects","imgs","expanded","isFullScreen","height","expand","collapse","useRequiredContext","ElementFullscreenContext","elementWidth","imageWidth","protoWidth","WidthBehavior","includes","undefined","Error","imgStyle","maxHeight","objectFit","handleImageError","e","imageUrl","currentTarget","src","error","sendClientErrorToHost","jsxs","StyledToolbarElementContainer","jsx","Toolbar","map","iimage","idx","image","buildMediaURL","url","toString","caption","StreamlitMarkdown","ImageListWithFullScreen","withFullScreenWrapper","memo"],"mappings":"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"}