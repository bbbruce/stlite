var eG=Object.defineProperty,iG=(e,t,i)=>t in e?eG(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,z=(e,t,i)=>iG(e,typeof t!="symbol"?t+"":t,i);import{r as Ie,ar as wi,bk as ge,g as Jh,bl as Nu,_ as CB,a$ as nG,j as ir,bm as Kv,bn as Qv,bo as rG,bp as oG,bq as EB,b5 as sG,br as aG,c as BB,C as TB,Q as Zv,bs as SB,b2 as lG,z as cG,bt as uG,bu as IB}from"./index-Bil1Hr5a.js";import{_ as po,C as hG}from"./slicedToArray-w0s7P4YT.js";import{a as Uu,b as Gu,_ as Yv,c as _d,d as qv}from"./inherits-BtWPIjOR.js";import{T as fG,a as dG}from"./Toolbar-DJVrQ0s_.js";import{u as MB,E as PB,w as pG}from"./withFullScreenWrapper-Xo2yarZC.js";import{u as AG}from"./useBasicWidgetState-CuWiximn.js";import{u as gG,s as mG}from"./threshold-CT01Jj2z.js";import{a as yG}from"./index-DwP8ryNM.js";function _G(e,t){for(var i=0;i<t.length;i++){const n=t[i];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in e)){const s=Object.getOwnPropertyDescriptor(n,r);s&&Object.defineProperty(e,r,s.get?s:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}const zu={};function Jm(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const $v=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),RB=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);RB&&parseFloat(RB[1]);const t1=globalThis,Xm=globalThis.process||{};function vG(e){var t,i;if(typeof window<"u"&&((t=window.process)==null?void 0:t.type)==="renderer"||typeof process<"u"&&(i=process.versions)!=null&&i.electron)return!0;const n=typeof navigator<"u"&&navigator.userAgent;return!!(n&&n.indexOf("Electron")>=0)}function e1(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||vG()}const DB="4.0.7";function bG(e){try{const t=window[e],i="__storage_test__";return t.setItem(i,i),t.removeItem(i),t}catch{return null}}let xG=class{constructor(e,t,i="sessionStorage"){this.storage=bG(i),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function wG(e){let t;return e<10?t=`${e.toFixed(2)}ms`:e<100?t=`${e.toFixed(1)}ms`:e<1e3?t=`${e.toFixed(0)}ms`:t=`${(e/1e3).toFixed(2)}s`,t}function CG(e,t=8){const i=Math.max(t-e.length,0);return`${" ".repeat(i)}${e}`}var Km;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Km||(Km={}));const EG=10;function OB(e){return typeof e!="string"?e:(e=e.toUpperCase(),Km[e]||Km.WHITE)}function BG(e,t,i){return!e1&&typeof e=="string"&&(t&&(e=`\x1B[${OB(t)}m${e}\x1B[39m`),i&&(e=`\x1B[${OB(i)+EG}m${e}\x1B[49m`)),e}function TG(e,t=["constructor"]){const i=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(i),r=e;for(const s of n){const o=r[s];typeof o=="function"&&(t.find(l=>s===l)||(r[s]=o.bind(e)))}}function i1(e,t){if(!e)throw new Error("Assertion failed")}function vd(){var e,t,i;let n;if(e1()&&t1.performance)n=(t=(e=t1==null?void 0:t1.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in Xm){const r=(i=Xm==null?void 0:Xm.hrtime)==null?void 0:i.call(Xm);n=r[0]*1e3+r[1]/1e6}else n=Date.now();return n}const bd={debug:e1()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},SG={enabled:!0,level:0};function xd(){}const LB={},FB={once:!0};let kB=class{constructor({id:e}={id:""}){this.VERSION=DB,this._startTs=vd(),this._deltaTs=vd(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new xG(`__probe-${this.id}__`,SG),this.timeStamp(`${this.id} started`),TG(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((vd()-this._startTs).toPrecision(10))}getDelta(){return Number((vd()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,bd.warn,arguments,FB)}error(e){return this._getLogFunction(0,e,bd.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,bd.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,bd.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,bd.debug||bd.info,arguments,FB)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||xd,i&&[i],{tag:MG(t)}):xd}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||xd)}group(e,t,i={collapsed:!1}){const n=UB({logLevel:e,message:t,opts:i}),{collapsed:r}=i;return n.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t,i={}){return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||xd)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=NB(e)}_getLogFunction(e,t,i,n,r){if(this._shouldLog(e)){r=UB({logLevel:e,message:t,args:n,opts:r}),i=i||r.method,i1(i),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=vd();const s=r.tag||r.message;if(r.once&&s)if(!LB[s])LB[s]=vd();else return xd;return t=IG(this.id,r.message,r),i.bind(console,t,...r.args)}return xd}};kB.VERSION=DB;function NB(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return i1(Number.isFinite(t)&&t>=0),t}function UB(e){const{logLevel:t,message:i}=e;e.logLevel=NB(t);const n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==i;);switch(typeof t){case"string":case"function":i!==void 0&&n.unshift(i),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const r=typeof e.message;return i1(r==="string"||r==="object"),Object.assign(e,{args:n},e.opts)}function IG(e,t,i){if(typeof t=="string"){const n=i.time?CG(wG(i.total)):"";t=i.time?`${e}: ${n}  ${t}`:`${e}: ${t}`,t=BG(t,i.color,i.background)}return t}function MG(e){for(const t in e)for(const i in e[t])return i||"untitled";return"empty"}const n1="4.3.1",PG=n1[0]>="0"&&n1[0]<="9"?`v${n1}`:"";function RG(){const e=new kB({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=e,globalThis.loaders.version=PG,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=e,e}const DG=RG();function OG(e,t){return GB(e||{},t)}function GB(e,t,i=0){if(i>3)return t;const n={...e};for(const[r,s]of Object.entries(t))s&&typeof s=="object"&&!Array.isArray(s)?n[r]=GB(n[r]||{},t[r],i+1):n[r]=t[r];return n}const LG="latest";function FG(){var e;return(e=globalThis._loadersgl_)!=null&&e.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.1"),globalThis._loadersgl_.version}const kG=FG();function Vu(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const Xh=typeof process!="object"||String(process)!=="[object process]"||process.browser,NG=typeof window<"u"&&typeof window.orientation<"u",zB=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);zB&&parseFloat(zB[1]);let UG=class{constructor(e,t){z(this,"name"),z(this,"workerThread"),z(this,"isRunning",!0),z(this,"result"),z(this,"_resolve",()=>{}),z(this,"_reject",()=>{}),this.name=e,this.workerThread=t,this.result=new Promise((i,n)=>{this._resolve=i,this._reject=n})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Vu(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Vu(this.isRunning),this.isRunning=!1,this._reject(e)}},r1=class{terminate(){}};const o1=new Map;function GG(e){Vu(e.source&&!e.url||!e.source&&e.url);let t=o1.get(e.source||e.url);return t||(e.url&&(t=zG(e.url),o1.set(e.url,t)),e.source&&(t=VB(e.source),o1.set(e.source,t))),Vu(t),t}function zG(e){if(!e.startsWith("http"))return e;const t=VG(e);return VB(t)}function VB(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function VG(e){return`try {
  importScripts('${e}');
} catch (error) {
  console.error(error);
  throw error;
}`}function jB(e,t=!0,i){const n=i||new Set;if(e){if(HB(e))n.add(e);else if(HB(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)&&t&&typeof e=="object")for(const r in e)jB(e[r],t,n)}return i===void 0?Array.from(n):[]}function HB(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}const s1=()=>{};let a1=class{constructor(e){z(this,"name"),z(this,"source"),z(this,"url"),z(this,"terminated",!1),z(this,"worker"),z(this,"onMessage"),z(this,"onError"),z(this,"_loadableURL","");const{name:t,source:i,url:n}=e;Vu(i||n),this.name=t,this.source=i,this.url=n,this.onMessage=s1,this.onError=r=>console.log(r),this.worker=Xh?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Xh||typeof r1<"u"&&!Xh}destroy(){this.onMessage=s1,this.onError=s1,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||jB(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=GG({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const t=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new r1(t,{eval:!1})}else if(this.source)e=new r1(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}},jG=class{constructor(e){z(this,"name","unnamed"),z(this,"source"),z(this,"url"),z(this,"maxConcurrency",1),z(this,"maxMobileConcurrency",1),z(this,"onDebug",()=>{}),z(this,"reuseWorkers",!0),z(this,"props",{}),z(this,"jobQueue",[]),z(this,"idleQueue",[]),z(this,"count",0),z(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return a1.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(n,r,s)=>n.done(s),i=(n,r)=>n.error(r)){const n=new Promise(r=>(this.jobQueue.push({name:e,onMessage:t,onError:i,onStart:r}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const i=new UG(t.name,e);e.onMessage=n=>t.onMessage(i,n.type,n.payload),e.onError=n=>t.onError(i,n),t.onStart(i);try{await i.result}catch(n){console.error(`Worker exception: ${n}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Xh||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new a1({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return NG?this.maxMobileConcurrency:this.maxConcurrency}};const HG={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};var ju;let WB=(ju=class{constructor(e){z(this,"props"),z(this,"workerPools",new Map),this.props={...HG},this.setProps(e),this.workerPools=new Map}static isSupported(){return a1.isSupported()}static getWorkerFarm(e={}){return ju._workerFarm=ju._workerFarm||new ju({}),ju._workerFarm.setProps(e),ju._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:i,url:n}=e;let r=this.workerPools.get(t);return r||(r=new jG({name:t,source:i,url:n}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}},z(ju,"_workerFarm"),ju);function WG(e,t={}){const i=t[e.id]||{},n=Xh?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let r=i.workerUrl;if(!r&&e.id==="compression"&&(r=t.workerUrl),t._workerType==="test"&&(Xh?r=`modules/${e.module}/dist/${n}`:r=`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!r){let s=e.version;s==="latest"&&(s=LG);const o=s?`@${s}`:"";r=`https://unpkg.com/@loaders.gl/${e.module}${o}/dist/${n}`}return Vu(r),r}function JG(e,t=kG){Vu(e,"no worker provided");const i=e.version;return!(!t||!i)}function XG(e,t){return!WB.isSupported()||!Xh&&!(t!=null&&t._nodeWorkers)?!1:e.worker&&(t==null?void 0:t.worker)}async function KG(e,t,i,n,r){const s=e.id,o=WG(e,i),l=WB.getWorkerFarm(i).getWorkerPool({name:s,url:o});i=JSON.parse(JSON.stringify(i)),n=JSON.parse(JSON.stringify(n||{}));const h=await l.startJob("process-on-worker",QG.bind(null,r));return h.postMessage("process",{input:t,options:i,context:n}),await(await h.result).result}async function QG(e,t,i,n){switch(i){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":const{id:r,input:s,options:o}=n;try{const l=await e(s,o);t.postMessage("done",{id:r,result:l})}catch(l){const h=l instanceof Error?l.message:"unknown error";t.postMessage("error",{id:r,error:h})}break;default:console.warn(`parse-with-worker unknown message ${i}`)}}function ZG(e,t,i){if(i=i||e.byteLength,e.byteLength<i||t.byteLength<i)return!1;const n=new Uint8Array(e),r=new Uint8Array(t);for(let s=0;s<n.length;++s)if(n[s]!==r[s])return!1;return!0}function YG(...e){return qG(e)}function qG(e){const t=e.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),i=t.reduce((s,o)=>s+o.byteLength,0),n=new Uint8Array(i);let r=0;for(const s of t)n.set(s,r),r+=s.byteLength;return n.buffer}async function $G(e){const t=[];for await(const i of e)t.push(i);return YG(...t)}let tz="";const JB={};function ez(e){for(const t in JB)if(e.startsWith(t)){const i=JB[t];e=e.replace(t,i)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e=`${tz}${e}`),e}function iz(e){return e&&typeof e=="object"&&e.isBuffer}function XB(e){if(iz(e)||e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){const t=e;return new TextEncoder().encode(t).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function KB(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function nz(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}const rz=e=>typeof e=="boolean",UA=e=>typeof e=="function",GA=e=>e!==null&&typeof e=="object",QB=e=>GA(e)&&e.constructor==={}.constructor,oz=e=>!!e&&typeof e[Symbol.iterator]=="function",sz=e=>e&&typeof e[Symbol.asyncIterator]=="function",Kh=e=>typeof Response<"u"&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,Qh=e=>typeof Blob<"u"&&e instanceof Blob,az=e=>e&&typeof e=="object"&&e.isBuffer,lz=e=>typeof ReadableStream<"u"&&e instanceof ReadableStream||GA(e)&&UA(e.tee)&&UA(e.cancel)&&UA(e.getReader),cz=e=>GA(e)&&UA(e.read)&&UA(e.pipe)&&rz(e.readable),ZB=e=>lz(e)||cz(e);let uz=class extends Error{constructor(e,t){super(e),z(this,"reason"),z(this,"url"),z(this,"response"),this.reason=t.reason,this.url=t.url,this.response=t.response}};const hz=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,fz=/^([-\w.]+\/[-\w.+]+)/;function YB(e,t){return e.toLowerCase()===t.toLowerCase()}function dz(e){const t=fz.exec(e);return t?t[1]:e}function qB(e){const t=hz.exec(e);return t?t[1]:""}const $B=/\?.*/;function pz(e){const t=e.match($B);return t&&t[0]}function l1(e){return e.replace($B,"")}function Az(e){if(e.length<50)return e;const t=e.slice(e.length-15);return`${e.substr(0,32)}...${t}`}function Qm(e){return Kh(e)?e.url:Qh(e)?e.name||"":typeof e=="string"?e:""}function c1(e){if(Kh(e)){const t=e,i=t.headers.get("content-type")||"",n=l1(t.url);return dz(i)||qB(n)}return Qh(e)?e.type||"":typeof e=="string"?qB(e):""}function gz(e){return Kh(e)?e.headers["content-length"]||-1:Qh(e)?e.size:typeof e=="string"?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}async function tT(e){if(Kh(e))return e;const t={},i=gz(e);i>=0&&(t["content-length"]=String(i));const n=Qm(e),r=c1(e);r&&(t["content-type"]=r);const s=await _z(e);s&&(t["x-first-bytes"]=s),typeof e=="string"&&(e=new TextEncoder().encode(e));const o=new Response(e,{headers:t});return Object.defineProperty(o,"url",{value:n}),o}async function mz(e){if(!e.ok)throw await yz(e)}async function yz(e){const t=Az(e.url);let i=`Failed to fetch resource (${e.status}) ${e.statusText}: ${t}`;i=i.length>100?`${i.slice(0,100)}...`:i;const n={reason:e.statusText,url:e.url,response:e};try{const r=e.headers.get("Content-Type");n.reason=!e.bodyUsed&&r!=null&&r.includes("application/json")?await e.json():await e.text()}catch{}return new uz(i,n)}async function _z(e){if(typeof e=="string")return`data:,${e.slice(0,5)}`;if(e instanceof Blob){const t=e.slice(0,5);return await new Promise(i=>{const n=new FileReader;n.onload=r=>{var s;return i((s=r==null?void 0:r.target)==null?void 0:s.result)},n.readAsDataURL(t)})}if(e instanceof ArrayBuffer){const t=e.slice(0,5);return`data:base64,${vz(t)}`}return null}function vz(e){let t="";const i=new Uint8Array(e);for(let n=0;n<i.byteLength;n++)t+=String.fromCharCode(i[n]);return btoa(t)}function bz(e){return!xz(e)&&!wz(e)}function xz(e){return e.startsWith("http:")||e.startsWith("https:")}function wz(e){return e.startsWith("data:")}async function eT(e,t){var i,n;if(typeof e=="string"){const r=ez(e);return bz(r)&&(i=globalThis.loaders)!=null&&i.fetchNode?(n=globalThis.loaders)==null?void 0:n.fetchNode(r,t):await fetch(r,t)}return await tT(e)}const u1=globalThis,Zm=globalThis.process||{};function Cz(e){var t,i;if(typeof window<"u"&&((t=window.process)==null?void 0:t.type)==="renderer"||typeof process<"u"&&(i=process.versions)!=null&&i.electron)return!0;const n=typeof navigator<"u"&&navigator.userAgent;return!!(n&&n.indexOf("Electron")>=0)}function h1(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||Cz()}const iT="4.0.7";function Ez(e){try{const t=window[e],i="__storage_test__";return t.setItem(i,i),t.removeItem(i),t}catch{return null}}let Bz=class{constructor(e,t,i="sessionStorage"){this.storage=Ez(i),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function Tz(e){let t;return e<10?t=`${e.toFixed(2)}ms`:e<100?t=`${e.toFixed(1)}ms`:e<1e3?t=`${e.toFixed(0)}ms`:t=`${(e/1e3).toFixed(2)}s`,t}function Sz(e,t=8){const i=Math.max(t-e.length,0);return`${" ".repeat(i)}${e}`}var Ym;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Ym||(Ym={}));const Iz=10;function nT(e){return typeof e!="string"?e:(e=e.toUpperCase(),Ym[e]||Ym.WHITE)}function Mz(e,t,i){return!h1&&typeof e=="string"&&(t&&(e=`\x1B[${nT(t)}m${e}\x1B[39m`),i&&(e=`\x1B[${nT(i)+Iz}m${e}\x1B[49m`)),e}function Pz(e,t=["constructor"]){const i=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(i),r=e;for(const s of n){const o=r[s];typeof o=="function"&&(t.find(l=>s===l)||(r[s]=o.bind(e)))}}function f1(e,t){if(!e)throw new Error("Assertion failed")}function wd(){var e,t,i;let n;if(h1()&&u1.performance)n=(t=(e=u1==null?void 0:u1.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in Zm){const r=(i=Zm==null?void 0:Zm.hrtime)==null?void 0:i.call(Zm);n=r[0]*1e3+r[1]/1e6}else n=Date.now();return n}const Cd={debug:h1()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Rz={enabled:!0,level:0};function Ed(){}const rT={},oT={once:!0};let sT=class{constructor({id:e}={id:""}){this.VERSION=iT,this._startTs=wd(),this._deltaTs=wd(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new Bz(`__probe-${this.id}__`,Rz),this.timeStamp(`${this.id} started`),Pz(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((wd()-this._startTs).toPrecision(10))}getDelta(){return Number((wd()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Cd.warn,arguments,oT)}error(e){return this._getLogFunction(0,e,Cd.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Cd.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Cd.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Cd.debug||Cd.info,arguments,oT)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||Ed,i&&[i],{tag:Oz(t)}):Ed}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Ed)}group(e,t,i={collapsed:!1}){const n=lT({logLevel:e,message:t,opts:i}),{collapsed:r}=i;return n.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t,i={}){return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Ed)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=aT(e)}_getLogFunction(e,t,i,n,r){if(this._shouldLog(e)){r=lT({logLevel:e,message:t,args:n,opts:r}),i=i||r.method,f1(i),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=wd();const s=r.tag||r.message;if(r.once&&s)if(!rT[s])rT[s]=wd();else return Ed;return t=Dz(this.id,r.message,r),i.bind(console,t,...r.args)}return Ed}};sT.VERSION=iT;function aT(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return f1(Number.isFinite(t)&&t>=0),t}function lT(e){const{logLevel:t,message:i}=e;e.logLevel=aT(t);const n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==i;);switch(typeof t){case"string":case"function":i!==void 0&&n.unshift(i),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const r=typeof e.message;return f1(r==="string"||r==="object"),Object.assign(e,{args:n},e.opts)}function Dz(e,t,i){if(typeof t=="string"){const n=i.time?Sz(Tz(i.total)):"";t=i.time?`${e}: ${n}  ${t}`:`${e}: ${t}`,t=Mz(t,i.color,i.background)}return t}function Oz(e){for(const t in e)for(const i in e[t])return i||"untitled";return"empty"}const cT=new sT({id:"loaders.gl"});let Lz=class{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}},Fz=class{constructor(){z(this,"console"),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}};const uT={fetch:null,mimeType:void 0,nothrow:!1,log:new Fz,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:$v,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},kz={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function hT(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function fT(){const e=hT();return e.globalOptions=e.globalOptions||{...uT},e.globalOptions}function Nz(e,t,i,n){return i=i||[],i=Array.isArray(i)?i:[i],Uz(e,i),zz(t,e,n)}function Uz(e,t){dT(e,null,uT,kz,t);for(const i of t){const n=e&&e[i.id]||{},r=i.options&&i.options[i.id]||{},s=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};dT(n,i.id,r,s,t)}}function dT(e,t,i,n,r){const s=t||"Top level",o=t?`${t}.`:"";for(const l in e){const h=!t&&GA(e[l]),A=l==="baseUri"&&!t,v=l==="workerUrl"&&t;if(!(l in i)&&!A&&!v){if(l in n)cT.warn(`${s} loader option '${o}${l}' no longer supported, use '${n[l]}'`)();else if(!h){const C=Gz(l,r);cT.warn(`${s} loader option '${o}${l}' not recognized. ${C}`)()}}}}function Gz(e,t){const i=e.toLowerCase();let n="";for(const r of t)for(const s in r.options){if(e===s)return`Did you mean '${r.id}.${s}'?`;const o=s.toLowerCase();(i.startsWith(o)||o.startsWith(i))&&(n=n||`Did you mean '${r.id}.${s}'?`)}return n}function zz(e,t,i){const n={...e.options||{}};return Vz(n,i),n.log===null&&(n.log=new Lz),pT(n,fT()),pT(n,t),n}function pT(e,t){for(const i in t)if(i in t){const n=t[i];QB(n)&&QB(e[i])?e[i]={...e[i],...t[i]}:e[i]=t[i]}}function Vz(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}function d1(e){return e?(Array.isArray(e)&&(e=e[0]),Array.isArray(e==null?void 0:e.extensions)):!1}function p1(e){Jm(e,"null loader"),Jm(d1(e),"invalid loader");let t;return Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),(e!=null&&e.parseTextSync||e!=null&&e.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const AT=()=>{const e=hT();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function jz(e){const t=AT();e=Array.isArray(e)?e:[e];for(const i of e){const n=p1(i);t.find(r=>n===r)||t.unshift(n)}}function Hz(){return AT()}const Wz=/\.([^.]+)$/;async function Jz(e,t=[],i,n){if(!mT(e))return null;let r=gT(e,t,{...i,nothrow:!0},n);if(r)return r;if(Qh(e)&&(e=await e.slice(0,10).arrayBuffer(),r=gT(e,t,i,n)),!r&&!(i!=null&&i.nothrow))throw new Error(yT(e));return r}function gT(e,t=[],i,n){if(!mT(e))return null;if(t&&!Array.isArray(t))return p1(t);let r=[];t&&(r=r.concat(t)),i!=null&&i.ignoreRegisteredLoaders||r.push(...Hz()),Kz(r);const s=Xz(e,r,i,n);if(!s&&!(i!=null&&i.nothrow))throw new Error(yT(e));return s}function Xz(e,t,i,n){const r=Qm(e),s=c1(e),o=l1(r)||(n==null?void 0:n.url);let l=null,h="";return i!=null&&i.mimeType&&(l=A1(t,i==null?void 0:i.mimeType),h=`match forced by supplied MIME type ${i==null?void 0:i.mimeType}`),l=l||Qz(t,o),h=h||(l?`matched url ${o}`:""),l=l||A1(t,s),h=h||(l?`matched MIME type ${s}`:""),l=l||Yz(t,e),h=h||(l?`matched initial data ${vT(e)}`:""),i!=null&&i.fallbackMimeType&&(l=l||A1(t,i==null?void 0:i.fallbackMimeType),h=h||(l?`matched fallback MIME type ${s}`:"")),h&&DG.log(1,`selectLoader selected ${l==null?void 0:l.name}: ${h}.`),l}function mT(e){return!(e instanceof Response&&e.status===204)}function yT(e){const t=Qm(e),i=c1(e);let n="No valid loader found (";n+=t?`${KB(t)}, `:"no url provided, ",n+=`MIME type: ${i?`"${i}"`:"not provided"}, `;const r=e?vT(e):"";return n+=r?` first bytes: "${r}"`:"first bytes: not available",n+=")",n}function Kz(e){for(const t of e)p1(t)}function Qz(e,t){const i=t&&Wz.exec(t),n=i&&i[1];return n?Zz(e,n):null}function Zz(e,t){t=t.toLowerCase();for(const i of e)for(const n of i.extensions)if(n.toLowerCase()===t)return i;return null}function A1(e,t){var i;for(const n of e)if((i=n.mimeTypes)!=null&&i.some(r=>YB(t,r))||YB(t,`application/x.${n.id}`))return n;return null}function Yz(e,t){if(!t)return null;for(const i of e)if(typeof t=="string"){if(qz(t,i))return i}else if(ArrayBuffer.isView(t)){if(_T(t.buffer,t.byteOffset,i))return i}else if(t instanceof ArrayBuffer&&_T(t,0,i))return i;return null}function qz(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>e.startsWith(i))}function _T(e,t,i){return(Array.isArray(i.tests)?i.tests:[i.tests]).some(n=>$z(e,t,i,n))}function $z(e,t,i,n){if(n instanceof ArrayBuffer)return ZG(n,e,n.byteLength);switch(typeof n){case"function":return n(e);case"string":const r=g1(e,t,n.length);return n===r;default:return!1}}function vT(e,t=5){return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?g1(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?g1(e,0,t):""}function g1(e,t,i){if(e.byteLength<t+i)return"";const n=new DataView(e);let r="";for(let s=0;s<i;s++)r+=String.fromCharCode(n.getUint8(t+s));return r}const t7=256*1024;function*e7(e,t){const i=(t==null?void 0:t.chunkSize)||t7;let n=0;const r=new TextEncoder;for(;n<e.length;){const s=Math.min(e.length-n,i),o=e.slice(n,n+s);n+=s,yield r.encode(o)}}const i7=256*1024;function*n7(e,t={}){const{chunkSize:i=i7}=t;let n=0;for(;n<e.byteLength;){const r=Math.min(e.byteLength-n,i),s=new ArrayBuffer(r),o=new Uint8Array(e,n,r);new Uint8Array(s).set(o),n+=r,yield s}}const r7=1024*1024;async function*o7(e,t){const i=(t==null?void 0:t.chunkSize)||r7;let n=0;for(;n<e.size;){const r=n+i,s=await e.slice(n,r).arrayBuffer();n=r,yield s}}function bT(e,t){return $v?s7(e,t):a7(e)}async function*s7(e,t){const i=e.getReader();let n;try{for(;;){const r=n||i.read();t!=null&&t._streamReadAhead&&(n=i.read());const{done:s,value:o}=await r;if(s)return;yield XB(o)}}catch{i.releaseLock()}}async function*a7(e,t){for await(const i of e)yield XB(i)}function l7(e,t){if(typeof e=="string")return e7(e,t);if(e instanceof ArrayBuffer)return n7(e,t);if(Qh(e))return o7(e,t);if(ZB(e))return bT(e,t);if(Kh(e))return bT(e.body,t);throw new Error("makeIterator")}const xT="Cannot convert supplied data type";function c7(e,t,i){if(t.text&&typeof e=="string")return e;if(az(e)&&(e=e.buffer),e instanceof ArrayBuffer){const n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer;const r=e.byteLength||e.length;return(e.byteOffset!==0||r!==n.byteLength)&&(n=n.slice(e.byteOffset,e.byteOffset+r)),n}throw new Error(xT)}async function u7(e,t,i){const n=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if(typeof e=="string"||n)return c7(e,t);if(Qh(e)&&(e=await tT(e)),Kh(e)){const r=e;return await mz(r),t.binary?await r.arrayBuffer():await r.text()}if(ZB(e)&&(e=l7(e,i)),oz(e)||sz(e))return $G(e);throw new Error(xT)}function wT(e,t){const i=fT(),n=e||i;return typeof n.fetch=="function"?n.fetch:GA(n.fetch)?r=>eT(r,n.fetch):t!=null&&t.fetch?t==null?void 0:t.fetch:eT}function h7(e,t,i){if(i)return i;const n={fetch:wT(t,e),...e};if(n.url){const r=l1(n.url);n.baseUrl=r,n.queryString=pz(n.url),n.filename=KB(r),n.baseUrl=nz(r)}return Array.isArray(n.loaders)||(n.loaders=null),n}function f7(e,t){if(e&&!Array.isArray(e))return e;let i;if(e&&(i=Array.isArray(e)?e:[e]),t&&t.loaders){const n=Array.isArray(t.loaders)?t.loaders:[t.loaders];i=i?[...i,...n]:n}return i&&i.length?i:void 0}async function qm(e,t,i,n){t&&!Array.isArray(t)&&!d1(t)&&(n=void 0,i=t,t=void 0),e=await e,i=i||{};const r=Qm(e),s=f7(t,n),o=await Jz(e,s,i);return o?(i=Nz(i,o,s,r),n=h7({url:r,_parse:qm,loaders:s},i,n||null),await d7(o,e,i,n)):null}async function d7(e,t,i,n){if(JG(e),i=OG(e.options,i),Kh(t)){const s=t,{ok:o,redirected:l,status:h,statusText:A,type:v,url:C}=s,S=Object.fromEntries(s.headers.entries());n.response={headers:S,ok:o,redirected:l,status:h,statusText:A,type:v,url:C}}t=await u7(t,e,i);const r=e;if(r.parseTextSync&&typeof t=="string")return r.parseTextSync(t,i,n);if(XG(e,i))return await KG(e,t,i,n,qm);if(r.parseText&&typeof t=="string")return await r.parseText(t,i,n);if(r.parse)return await r.parse(t,i,n);throw Vu(!r.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}async function m1(e,t,i,n){let r,s;!Array.isArray(t)&&!d1(t)?(r=[],s=t):(r=t,s=i);const o=wT(s);let l=e;return typeof e=="string"&&(l=await o(e)),Qh(e)&&(l=await o(e)),Array.isArray(r)?await qm(l,r,s):await qm(l,r,s)}const p7="4.3.1";var CT;const A7=(CT=globalThis.loaders)==null?void 0:CT.parseImageNode,y1=typeof Image<"u",_1=typeof ImageBitmap<"u",g7=!!A7,v1=$v?!0:g7;function m7(e){switch(e){case"auto":return _1||y1||v1;case"imagebitmap":return _1;case"image":return y1;case"data":return v1;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}function y7(){if(_1)return"imagebitmap";if(y1)return"image";if(v1)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function _7(e){const t=b7(e);if(!t)throw new Error("Not an image");return t}function v7(e){switch(_7(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),i=t.getContext("2d");if(!i)throw new Error("getImageData");return t.width=e.width,t.height=e.height,i.drawImage(e,0,0),i.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function b7(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&e instanceof Image?"image":e&&typeof e=="object"&&e.data&&e.width&&e.height?"data":null}const x7=/^data:image\/svg\+xml/,w7=/\.svg((\?|#).*)?$/;function b1(e){return e&&(x7.test(e)||w7.test(e))}function C7(e,t){if(b1(t)){let i=new TextDecoder().decode(e);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(n){throw new Error(n.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return ET(e,t)}function ET(e,t){if(b1(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function BT(e,t,i){const n=C7(e,i),r=self.URL||self.webkitURL,s=typeof n!="string"&&r.createObjectURL(n);try{return await E7(s||n,t)}finally{s&&r.revokeObjectURL(s)}}async function E7(e,t){const i=new Image;return i.src=e,t.image&&t.image.decode&&i.decode?(await i.decode(),i):await new Promise((n,r)=>{try{i.onload=()=>n(i),i.onerror=s=>{const o=s instanceof Error?s.message:"error";r(new Error(o))}}catch(s){r(s)}})}const B7={};let TT=!0;async function T7(e,t,i){let n;b1(i)?n=await BT(e,t,i):n=ET(e,i);const r=t&&t.imagebitmap;return await S7(n,r)}async function S7(e,t=null){if((I7(t)||!TT)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(i){console.warn(i),TT=!1}return await createImageBitmap(e)}function I7(e){for(const t in e||B7)return!1;return!0}function M7(e){return!O7(e,"ftyp",4)||(e[8]&96)===0?null:P7(e)}function P7(e){switch(R7(e,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function R7(e,t,i){return String.fromCharCode(...e.slice(t,i))}function D7(e){return[...e].map(t=>t.charCodeAt(0))}function O7(e,t,i=0){const n=D7(t);for(let r=0;r<n.length;++r)if(n[r]!==e[r+i])return!1;return!0}const ec=!1,zA=!0;function ST(e){const t=VA(e);return F7(t)||U7(t)||k7(t)||N7(t)||L7(t)}function L7(e){const t=new Uint8Array(e instanceof DataView?e.buffer:e),i=M7(t);return i?{mimeType:i.mimeType,width:0,height:0}:null}function F7(e){const t=VA(e);return t.byteLength>=24&&t.getUint32(0,ec)===2303741511?{mimeType:"image/png",width:t.getUint32(16,ec),height:t.getUint32(20,ec)}:null}function k7(e){const t=VA(e);return t.byteLength>=10&&t.getUint32(0,ec)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,zA),height:t.getUint16(8,zA)}:null}function N7(e){const t=VA(e);return t.byteLength>=14&&t.getUint16(0,ec)===16973&&t.getUint32(2,zA)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,zA),height:t.getUint32(22,zA)}:null}function U7(e){const t=VA(e);if(!(t.byteLength>=3&&t.getUint16(0,ec)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:n}=G7();let r=2;for(;r+9<t.byteLength;){const s=t.getUint16(r,ec);if(n.has(s))return{mimeType:"image/jpeg",height:t.getUint16(r+5,ec),width:t.getUint16(r+7,ec)};if(!i.has(s))return null;r+=2,r+=t.getUint16(r,ec)}return null}function G7(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function VA(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}async function z7(e,t){var i;const{mimeType:n}=ST(e)||{},r=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return Jm(r),await r(e,n)}async function V7(e,t,i){t=t||{};const n=(t.image||{}).type||"auto",{url:r}=i||{},s=j7(n);let o;switch(s){case"imagebitmap":o=await T7(e,t,r);break;case"image":o=await BT(e,t,r);break;case"data":o=await z7(e);break;default:Jm(!1)}return n==="data"&&(o=v7(o)),o}function j7(e){switch(e){case"auto":case"data":return y7();default:return m7(e),e}}const H7=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],W7=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],J7={image:{type:"auto",decode:!0}},X7={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:p7,mimeTypes:W7,extensions:H7,parse:V7,tests:[e=>!!ST(new DataView(e))],options:J7},Bd=globalThis,Hu=globalThis.process||{},K7=globalThis.navigator||{};function IT(e){var t,i;if(typeof window<"u"&&((t=window.process)==null?void 0:t.type)==="renderer"||typeof process<"u"&&(i=process.versions)!=null&&i.electron)return!0;const n=typeof navigator<"u"&&navigator.userAgent;return!!(n&&n.indexOf("Electron")>=0)}function ic(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||IT()}function Q7(e){return ic()?IT()?"Electron":(K7.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const $m="4.1.0";function Z7(e){try{const t=window[e],i="__storage_test__";return t.setItem(i,i),t.removeItem(i),t}catch{return null}}let Y7=class{constructor(e,t,i="sessionStorage"){this.storage=Z7(i),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function q7(e){let t;return e<10?t=`${e.toFixed(2)}ms`:e<100?t=`${e.toFixed(1)}ms`:e<1e3?t=`${e.toFixed(0)}ms`:t=`${(e/1e3).toFixed(2)}s`,t}function $7(e,t=8){const i=Math.max(t-e.length,0);return`${" ".repeat(i)}${e}`}var t0;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(t0||(t0={}));const tV=10;function MT(e){return typeof e!="string"?e:(e=e.toUpperCase(),t0[e]||t0.WHITE)}function eV(e,t,i){return!ic&&typeof e=="string"&&(t&&(e=`\x1B[${MT(t)}m${e}\x1B[39m`),i&&(e=`\x1B[${MT(i)+tV}m${e}\x1B[49m`)),e}function iV(e,t=["constructor"]){const i=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(i),r=e;for(const s of n){const o=r[s];typeof o=="function"&&(t.find(l=>s===l)||(r[s]=o.bind(e)))}}function x1(e,t){if(!e)throw new Error("Assertion failed")}function Td(){var e,t,i;let n;if(ic()&&Bd.performance)n=(t=(e=Bd==null?void 0:Bd.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in Hu){const r=(i=Hu==null?void 0:Hu.hrtime)==null?void 0:i.call(Hu);n=r[0]*1e3+r[1]/1e6}else n=Date.now();return n}const Sd={debug:ic()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},nV={enabled:!0,level:0};function Id(){}const PT={},RT={once:!0};let DT=class{constructor({id:e}={id:""}){this.VERSION=$m,this._startTs=Td(),this._deltaTs=Td(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new Y7(`__probe-${this.id}__`,nV),this.timeStamp(`${this.id} started`),iV(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Td()-this._startTs).toPrecision(10))}getDelta(){return Number((Td()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Sd.warn,arguments,RT)}error(e){return this._getLogFunction(0,e,Sd.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Sd.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Sd.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Sd.debug||Sd.info,arguments,RT)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||Id,i&&[i],{tag:oV(t)}):Id}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Id)}group(e,t,i={collapsed:!1}){const n=LT({logLevel:e,message:t,opts:i}),{collapsed:r}=i;return n.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t,i={}){return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Id)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=OT(e)}_getLogFunction(e,t,i,n,r){if(this._shouldLog(e)){r=LT({logLevel:e,message:t,args:n,opts:r}),i=i||r.method,x1(i),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=Td();const s=r.tag||r.message;if(r.once&&s)if(!PT[s])PT[s]=Td();else return Id;return t=rV(this.id,r.message,r),i.bind(console,t,...r.args)}return Id}};DT.VERSION=$m;function OT(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return x1(Number.isFinite(t)&&t>=0),t}function LT(e){const{logLevel:t,message:i}=e;e.logLevel=OT(t);const n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==i;);switch(typeof t){case"string":case"function":i!==void 0&&n.unshift(i),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const r=typeof e.message;return x1(r==="string"||r==="object"),Object.assign(e,{args:n},e.opts)}function rV(e,t,i){if(typeof t=="string"){const n=i.time?$7(q7(i.total)):"";t=i.time?`${e}: ${n}  ${t}`:`${e}: ${t}`,t=eV(t,i.color,i.background)}return t}function oV(e){for(const t in e)for(const i in e[t])return i||"untitled";return"empty"}const Yi=new DT({id:"deck"});let w1={};function sV(e){w1=e}function As(e,t,i,n){Yi.level>0&&w1[e]&&w1[e].call(null,t,i,n)}function aV(e){const t=e[0],i=e[e.length-1];return t==="{"&&i==="}"||t==="["&&i==="]"}const lV={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:aV,parseTextSync:JSON.parse};function cV(){const e="9.1.9",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${e}`);return t||(Yi.log(1,`deck.gl ${e}`)(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:Yi,_registerLoggers:sV},jz([lV,[X7,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}const uV=cV();function C1(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}const E1={number:{type:"number",validate(e,t){return Number.isFinite(e)&&typeof t=="object"&&(t.max===void 0||e<=t.max)&&(t.min===void 0||e>=t.min)}},array:{type:"array",validate(e,t){return Array.isArray(e)||ArrayBuffer.isView(e)}}};function hV(e){const t={};for(const[i,n]of Object.entries(e))t[i]=fV(n);return t}function fV(e){let t=FT(e);if(t!=="object")return{value:e,...E1[t],type:t};if(typeof e=="object")return e?e.type!==void 0?{...e,...E1[e.type],type:e.type}:e.value===void 0?{type:"object",value:e}:(t=FT(e.value),{...e,...E1[t],type:t}):{type:"object",value:null};throw new Error("props")}function FT(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const dV=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,pV=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,AV={vertex:dV,fragment:pV},kT=/void\s+main\s*\([^)]*\)\s*\{\n?/,NT=/}\n?[^{}]*$/,B1=[],e0="__LUMA_INJECT_DECLARATIONS__";function gV(e){const t={vertex:{},fragment:{}};for(const i in e){let n=e[i];const r=mV(i);typeof n=="string"&&(n={order:0,injection:n}),t[r][i]=n}return t}function mV(e){const t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function i0(e,t,i,n=!1){const r=t==="vertex";for(const s in i){const o=i[s];o.sort((h,A)=>h.order-A.order),B1.length=o.length;for(let h=0,A=o.length;h<A;++h)B1[h]=o[h].injection;const l=`${B1.join(`
`)}
`;switch(s){case"vs:#decl":r&&(e=e.replace(e0,l));break;case"vs:#main-start":r&&(e=e.replace(kT,h=>h+l));break;case"vs:#main-end":r&&(e=e.replace(NT,h=>l+h));break;case"fs:#decl":r||(e=e.replace(e0,l));break;case"fs:#main-start":r||(e=e.replace(kT,h=>h+l));break;case"fs:#main-end":r||(e=e.replace(NT,h=>l+h));break;default:e=e.replace(s,h=>h+l)}}return e=e.replace(e0,""),n&&(e=e.replace(/\}\s*$/,s=>s+AV[t])),e}function n0(e){e.map(t=>UT(t))}function UT(e){if(e.instance)return;n0(e.dependencies||[]);const{propTypes:t={},deprecations:i=[],inject:n={}}=e,r={normalizedInjections:gV(n),parsedDeprecations:yV(i)};t&&(r.propValidators=hV(t)),e.instance=r;let s={};t&&(s=Object.entries(t).reduce((o,[l,h])=>{const A=h==null?void 0:h.value;return A&&(o[l]=A),o},{})),e.defaultUniforms={...e.defaultUniforms,...s}}function GT(e,t,i){var n;(n=e.deprecations)==null||n.forEach(r=>{var s;(s=r.regex)!=null&&s.test(t)&&(r.deprecated?i.deprecated(r.old,r.new)():i.removed(r.old,r.new)())})}function yV(e){return e.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp(`\\b${t.old}\\(`);break;default:t.regex=new RegExp(`${t.type} ${t.old};`)}}),e}function T1(e){n0(e);const t={},i={};zT({modules:e,level:0,moduleMap:t,moduleDepth:i});const n=Object.keys(i).sort((r,s)=>i[s]-i[r]).map(r=>t[r]);return n0(n),n}function zT(e){const{modules:t,level:i,moduleMap:n,moduleDepth:r}=e;if(i>=5)throw new Error("Possible loop in shader dependency graph");for(const s of t)n[s.name]=s,(r[s.name]===void 0||r[s.name]<i)&&(r[s.name]=i);for(const s of t)s.dependencies&&zT({modules:s.dependencies,level:i+1,moduleMap:n,moduleDepth:r})}function _V(e){switch(e==null?void 0:e.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function vV(e,t){var i;if(Number(((i=e.match(/^#version[ \t]+(\d+)/m))==null?void 0:i[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return e=jT(e,bV),e;case"fragment":return e=jT(e,xV),e;default:throw new Error(t)}}const VT=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],bV=[...VT,[S1("attribute"),"in $1"],[S1("varying"),"out $1"]],xV=[...VT,[S1("varying"),"in $1"]];function jT(e,t){for(const[i,n]of t)e=e.replace(i,n);return e}function S1(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function HT(e,t){let i="";for(const n in e){const r=e[n];if(i+=`void ${r.signature} {
`,r.header&&(i+=`  ${r.header}`),t[n]){const s=t[n];s.sort((o,l)=>o.order-l.order);for(const o of s)i+=`  ${o.injection}
`}r.footer&&(i+=`  ${r.footer}`),i+=`}
`}return i}function WT(e){const t={vertex:{},fragment:{}};for(const i of e){let n,r;typeof i!="string"?(n=i,r=n.hook):(n={},r=i),r=r.trim();const[s,o]=r.split(":"),l=r.replace(/\(.+/,""),h=Object.assign(n,{signature:o});switch(s){case"vs":t.vertex[l]=h;break;case"fs":t.fragment[l]=h;break;default:throw new Error(s)}}return t}function wV(e,t){return{name:CV(e,t),language:"glsl",version:EV(e)}}function CV(e,t="unnamed"){const i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return i?i[1]:t}function EV(e){let t=100;const i=e.match(/[^\s]+/g);if(i&&i.length>=2&&i[0]==="#version"){const n=parseInt(i[1],10);Number.isFinite(n)&&(t=n)}if(t!==100&&t!==300)throw new Error(`Invalid GLSL version ${t}`);return t}const JT=`

${e0}
`,BV=`precision highp float;
`;function TV(e){const t=T1(e.modules||[]);return{source:IV(e.platformInfo,{...e,source:e.source,stage:"vertex",modules:t}),getUniforms:KT(t)}}function SV(e){const{vs:t,fs:i}=e,n=T1(e.modules||[]);return{vs:XT(e.platformInfo,{...e,source:t,stage:"vertex",modules:n}),fs:XT(e.platformInfo,{...e,source:i,stage:"fragment",modules:n}),getUniforms:KT(n)}}function IV(e,t){var i;const{source:n,stage:r,modules:s,hookFunctions:o=[],inject:l={},log:h}=t;C1(typeof n=="string","shader source must be a string");const A=n;let v="";const C=WT(o),S={},L={},N={};for(const W in l){const j=typeof l[W]=="string"?{injection:l[W],order:0}:l[W],q=/^(v|f)s:(#)?([\w-]+)$/.exec(W);if(q){const Z=q[2],K=q[3];Z?K==="decl"?L[W]=[j]:N[W]=[j]:S[W]=[j]}else N[W]=[j]}const G=s;for(const W of G){h&&GT(W,A,h);const j=QT(W,"wgsl");v+=j;const q=((i=W.injections)==null?void 0:i[r])||{};for(const Z in q){const K=/^(v|f)s:#([\w-]+)$/.exec(Z);if(K){const ft=K[2]==="decl"?L:N;ft[Z]=ft[Z]||[],ft[Z].push(q[Z])}else S[Z]=S[Z]||[],S[Z].push(q[Z])}}return v+=JT,v=i0(v,r,L),v+=HT(C[r],S),v+=A,v=i0(v,r,N),v}function XT(e,t){var i;const{id:n,source:r,stage:s,language:o="glsl",modules:l,defines:h={},hookFunctions:A=[],inject:v={},prologue:C=!0,log:S}=t;C1(typeof r=="string","shader source must be a string");const L=o==="glsl"?wV(r).version:-1,N=e.shaderLanguageVersion,G=L===100?"#version 100":"#version 300 es",W=r.split(`
`).slice(1).join(`
`),j={};l.forEach(Lt=>{Object.assign(j,Lt.defines)}),Object.assign(j,h);let q="";switch(o){case"wgsl":break;case"glsl":q=C?`${G}

// ----- PROLOGUE -------------------------
${MV({id:n,source:r,stage:s})}
${`#define SHADER_TYPE_${s.toUpperCase()}`}

${_V(e)}
${s==="fragment"?BV:""}

// ----- APPLICATION DEFINES -------------------------

${PV(j)}

`:`${G}
`;break}const Z=WT(A),K={},ft={},rt={};for(const Lt in v){const Vt=typeof v[Lt]=="string"?{injection:v[Lt],order:0}:v[Lt],At=/^(v|f)s:(#)?([\w-]+)$/.exec(Lt);if(At){const at=At[2],kt=At[3];at?kt==="decl"?ft[Lt]=[Vt]:rt[Lt]=[Vt]:K[Lt]=[Vt]}else rt[Lt]=[Vt]}for(const Lt of l){S&&GT(Lt,W,S);const Vt=QT(Lt,s);q+=Vt;const At=((i=Lt.instance)==null?void 0:i.normalizedInjections[s])||{};for(const at in At){const kt=/^(v|f)s:#([\w-]+)$/.exec(at);if(kt){const X=kt[2]==="decl"?ft:rt;X[at]=X[at]||[],X[at].push(At[at])}else K[at]=K[at]||[],K[at].push(At[at])}}return q+="// ----- MAIN SHADER SOURCE -------------------------",q+=JT,q=i0(q,s,ft),q+=HT(Z[s],K),q+=W,q=i0(q,s,rt),o==="glsl"&&L!==N&&(q=vV(q,s)),q.trim()}function KT(e){return function(t){var i;const n={};for(const r of e){const s=(i=r.getUniforms)==null?void 0:i.call(r,t,n);Object.assign(n,s)}return n}}function MV(e){const{id:t,source:i,stage:n}=e;return t&&i.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${t}_${n}`:""}function PV(e={}){let t="";for(const i in e){const n=e[i];(n||Number.isFinite(n))&&(t+=`#define ${i.toUpperCase()} ${e[i]}
`)}return t}function QT(e,t){let i;switch(t){case"vertex":i=e.vs||"";break;case"fragment":i=e.fs||"";break;case"wgsl":i=e.source||"";break;default:C1(!1)}if(!e.name)throw new Error("Shader module must have a name");const n=e.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let r=`// ----- MODULE ${e.name} ---------------

`;return t!=="wgsl"&&(r+=`#define MODULE_${n}
`),r+=`${i}
`,r}const RV=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,DV=/^\s*\#\s*endif\s*$/;function OV(e,t){var i;const n=e.split(`
`),r=[];let s=!0,o=null;for(const l of n){const h=l.match(RV),A=l.match(DV);h?(o=h[1],s=!!((i=t==null?void 0:t.defines)!=null&&i[o])):A?s=!0:s&&r.push(l)}return r.join(`
`)}const ZT=class am{constructor(){z(this,"_hookFunctions",[]),z(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return am.defaultShaderAssembler=am.defaultShaderAssembler||new am,am.defaultShaderAssembler}addDefaultModule(t){this._defaultModules.find(i=>i.name===(typeof t=="string"?t:t.name))||this._defaultModules.push(t)}removeDefaultModule(t){const i=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==i)}addShaderHook(t,i){i&&(t=Object.assign(i,{hook:t})),this._hookFunctions.push(t)}assembleWGSLShader(t){const i=this._getModuleList(t.modules),n=this._hookFunctions,{source:r,getUniforms:s}=TV({...t,source:t.source,modules:i,hookFunctions:n});return{source:t.platformInfo.shaderLanguage==="wgsl"?OV(r):r,getUniforms:s,modules:i}}assembleGLSLShaderPair(t){const i=this._getModuleList(t.modules),n=this._hookFunctions;return{...SV({...t,vs:t.vs,fs:t.fs,modules:i,hookFunctions:n}),modules:i}}_getModuleList(t=[]){const i=new Array(this._defaultModules.length+t.length),n={};let r=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const l=this._defaultModules[s],h=l.name;i[r++]=l,n[h]=!0}for(let s=0,o=t.length;s<o;++s){const l=t[s],h=l.name;n[h]||(i[r++]=l,n[h]=!0)}return i.length=r,n0(i),i}};z(ZT,"defaultShaderAssembler");let YT=ZT;const LV=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,FV=`#version 300 es
${LV}`;function qT(e){const{input:t,inputChannels:i,output:n}=e||{};if(!t)return FV;if(!i)throw new Error("inputChannels");const r=kV(i),s=NV(t,i);return`#version 300 es
in ${r} ${t};
out vec4 ${n};
void main() {
  ${n} = ${s};
}`}function kV(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${e}`)}}function NV(e,t){switch(t){case 1:return`vec4(${e}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${e}, 0.0, 1.0)`;case 3:return`vec4(${e}, 1.0)`;case 4:return e;default:throw new Error(`invalid channels: ${t}`)}}function $T(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}let tS=class{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=$T(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime($T()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},UV=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:i}=e;let n=this.stats[t];return n||(e instanceof tS?n=e:n=new tS(t,i),this.stats[t]=n),n}};class GV{constructor(){z(this,"stats",new Map)}getStats(t){return this.get(t)}get(t){return this.stats.has(t)||this.stats.set(t,new UV({id:t})),this.stats.get(t)}}const eS=new GV;function zV(e){try{const t=window[e],i="__storage_test__";return t.setItem(i,i),t.removeItem(i),t}catch{return null}}let VV=class{constructor(e,t,i="sessionStorage"){this.storage=zV(i),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function jV(e){let t;return e<10?t=`${e.toFixed(2)}ms`:e<100?t=`${e.toFixed(1)}ms`:e<1e3?t=`${e.toFixed(0)}ms`:t=`${(e/1e3).toFixed(2)}s`,t}function HV(e,t=8){const i=Math.max(t-e.length,0);return`${" ".repeat(i)}${e}`}var r0;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(r0||(r0={}));const WV=10;function iS(e){return typeof e!="string"?e:(e=e.toUpperCase(),r0[e]||r0.WHITE)}function JV(e,t,i){return!ic&&typeof e=="string"&&(t&&(e=`\x1B[${iS(t)}m${e}\x1B[39m`),i&&(e=`\x1B[${iS(i)+WV}m${e}\x1B[49m`)),e}function XV(e,t=["constructor"]){const i=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(i),r=e;for(const s of n){const o=r[s];typeof o=="function"&&(t.find(l=>s===l)||(r[s]=o.bind(e)))}}function I1(e,t){if(!e)throw new Error("Assertion failed")}function Md(){var e,t,i;let n;if(ic()&&Bd.performance)n=(t=(e=Bd==null?void 0:Bd.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in Hu){const r=(i=Hu==null?void 0:Hu.hrtime)==null?void 0:i.call(Hu);n=r[0]*1e3+r[1]/1e6}else n=Date.now();return n}const Pd={debug:ic()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},KV={enabled:!0,level:0};function Rd(){}const nS={},rS={once:!0};let oS=class{constructor({id:e}={id:""}){this.VERSION=$m,this._startTs=Md(),this._deltaTs=Md(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new VV(`__probe-${this.id}__`,KV),this.timeStamp(`${this.id} started`),XV(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Md()-this._startTs).toPrecision(10))}getDelta(){return Number((Md()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Pd.warn,arguments,rS)}error(e){return this._getLogFunction(0,e,Pd.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Pd.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Pd.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Pd.debug||Pd.info,arguments,rS)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||Rd,i&&[i],{tag:ZV(t)}):Rd}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Rd)}group(e,t,i={collapsed:!1}){const n=aS({logLevel:e,message:t,opts:i}),{collapsed:r}=i;return n.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t,i={}){return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Rd)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=sS(e)}_getLogFunction(e,t,i,n,r){if(this._shouldLog(e)){r=aS({logLevel:e,message:t,args:n,opts:r}),i=i||r.method,I1(i),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=Md();const s=r.tag||r.message;if(r.once&&s)if(!nS[s])nS[s]=Md();else return Rd;return t=QV(this.id,r.message,r),i.bind(console,t,...r.args)}return Rd}};oS.VERSION=$m;function sS(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return I1(Number.isFinite(t)&&t>=0),t}function aS(e){const{logLevel:t,message:i}=e;e.logLevel=sS(t);const n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==i;);switch(typeof t){case"string":case"function":i!==void 0&&n.unshift(i),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const r=typeof e.message;return I1(r==="string"||r==="object"),Object.assign(e,{args:n},e.opts)}function QV(e,t,i){if(typeof t=="string"){const n=i.time?HV(jV(i.total)):"";t=i.time?`${e}: ${n}  ${t}`:`${e}: ${t}`,t=JV(t,i.color,i.background)}return t}function ZV(e){for(const t in e)for(const i in e[t])return i||"untitled";return"empty"}const ti=new oS({id:"luma.gl"}),M1={};function o0(e="id"){M1[e]=M1[e]||1;const t=M1[e]++;return`${e}-${t}`}var P1;let Ar=(P1=class{constructor(e,t,i){if(z(this,"id"),z(this,"props"),z(this,"userData",{}),z(this,"_device"),z(this,"destroyed",!1),z(this,"allocatedBytes",0),z(this,"_attachedResources",new Set),!e)throw new Error("no device");this._device=e,this.props=YV(t,i);const n=this.props.id!=="undefined"?this.props.id:o0(this[Symbol.toStringTag]);this.props.id=n,this.id=n,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},z(P1,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),P1);function YV(e,t){const i={...t};for(const n in e)e[n]!==void 0&&(i[n]=e[n]);return i}const ua=class Av extends Ar{constructor(t,i){const n={...i};(i.usage||0)&Av.INDEX&&!i.indexType&&(i.data instanceof Uint32Array?n.indexType="uint32":i.data instanceof Uint16Array&&(n.indexType="uint16")),delete n.data,super(t,n,Av.defaultProps),z(this,"usage"),z(this,"indexType"),z(this,"updateTimestamp"),z(this,"debugData",new ArrayBuffer(0)),this.usage=n.usage||0,this.indexType=n.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(t){return this.device.createBuffer({...this.props,...t})}readSyncWebGL(t,i){throw new Error("not implemented")}_setDebugData(t,i,n){const r=ArrayBuffer.isView(t)?t.buffer:t,s=Math.min(t?t.byteLength:n,Av.DEBUG_DATA_MAX_LENGTH);r===null?this.debugData=new ArrayBuffer(s):i===0&&n===r.byteLength?this.debugData=r.slice(0,s):this.debugData=r.slice(i,i+s)}};z(ua,"defaultProps",{...Ar.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),z(ua,"MAP_READ",1),z(ua,"MAP_WRITE",2),z(ua,"COPY_SRC",4),z(ua,"COPY_DST",8),z(ua,"INDEX",16),z(ua,"VERTEX",32),z(ua,"UNIFORM",64),z(ua,"STORAGE",128),z(ua,"INDIRECT",256),z(ua,"QUERY_RESOLVE",512),z(ua,"DEBUG_DATA_MAX_LENGTH",32);let jr=ua;function lS(e){const t=cS[e],i=qV(t),n=e.includes("norm"),r=!n&&!e.startsWith("float"),s=e.startsWith("s");return{dataType:cS[e],byteLength:i,integer:r,signed:s,normalized:n}}function qV(e){return $V[e]}const cS={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},$V={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},gs="texture-compression-bc",gr="texture-compression-astc",nc="texture-compression-etc2",tj="texture-compression-etc1-webgl",s0="texture-compression-pvrtc-webgl",R1="texture-compression-atc-webgl",a0="float32-renderable-webgl",D1="float16-renderable-webgl",ej="rgb9e5ufloat-renderable-webgl",O1="snorm8-renderable-webgl",jA="norm16-renderable-webgl",L1="snorm16-renderable-webgl",l0="float32-filterable",uS="float16-filterable-webgl";function hS(e){const t=ij[e];if(!t)throw new Error(`Unsupported texture format ${e}`);return t}const ij={r8unorm:{},r8snorm:{render:O1},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:O1},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:D1,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:jA},"r16snorm-webgl":{f:L1},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:O1},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:D1,filter:uS},"rg16unorm-webgl":{render:jA},"rg16snorm-webgl":{render:L1},r32uint:{},r32sint:{},r32float:{render:a0,filter:l0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:ej},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:a0},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:jA},"rgb16snorm-webgl":{f:jA},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:l0},rgba16uint:{},rgba16sint:{},rgba16float:{render:D1,filter:uS},"rgba16unorm-webgl":{render:jA},"rgba16snorm-webgl":{render:L1},"rgb32float-webgl":{render:a0,filter:l0},rgba32uint:{},rgba32sint:{},rgba32float:{render:a0,filter:l0},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:gs},"bc1-rgb-unorm-srgb-webgl":{f:gs},"bc1-rgba-unorm":{f:gs},"bc1-rgba-unorm-srgb":{f:gs},"bc2-rgba-unorm":{f:gs},"bc2-rgba-unorm-srgb":{f:gs},"bc3-rgba-unorm":{f:gs},"bc3-rgba-unorm-srgb":{f:gs},"bc4-r-unorm":{f:gs},"bc4-r-snorm":{f:gs},"bc5-rg-unorm":{f:gs},"bc5-rg-snorm":{f:gs},"bc6h-rgb-ufloat":{f:gs},"bc6h-rgb-float":{f:gs},"bc7-rgba-unorm":{f:gs},"bc7-rgba-unorm-srgb":{f:gs},"etc2-rgb8unorm":{f:nc},"etc2-rgb8unorm-srgb":{f:nc},"etc2-rgb8a1unorm":{f:nc},"etc2-rgb8a1unorm-srgb":{f:nc},"etc2-rgba8unorm":{f:nc},"etc2-rgba8unorm-srgb":{f:nc},"eac-r11unorm":{f:nc},"eac-r11snorm":{f:nc},"eac-rg11unorm":{f:nc},"eac-rg11snorm":{f:nc},"astc-4x4-unorm":{f:gr},"astc-4x4-unorm-srgb":{f:gr},"astc-5x4-unorm":{f:gr},"astc-5x4-unorm-srgb":{f:gr},"astc-5x5-unorm":{f:gr},"astc-5x5-unorm-srgb":{f:gr},"astc-6x5-unorm":{f:gr},"astc-6x5-unorm-srgb":{f:gr},"astc-6x6-unorm":{f:gr},"astc-6x6-unorm-srgb":{f:gr},"astc-8x5-unorm":{f:gr},"astc-8x5-unorm-srgb":{f:gr},"astc-8x6-unorm":{f:gr},"astc-8x6-unorm-srgb":{f:gr},"astc-8x8-unorm":{f:gr},"astc-8x8-unorm-srgb":{f:gr},"astc-10x5-unorm":{f:gr},"astc-10x5-unorm-srgb":{f:gr},"astc-10x6-unorm":{f:gr},"astc-10x6-unorm-srgb":{f:gr},"astc-10x8-unorm":{f:gr},"astc-10x8-unorm-srgb":{f:gr},"astc-10x10-unorm":{f:gr},"astc-10x10-unorm-srgb":{f:gr},"astc-12x10-unorm":{f:gr},"astc-12x10-unorm-srgb":{f:gr},"astc-12x12-unorm":{f:gr},"astc-12x12-unorm-srgb":{f:gr},"pvrtc-rgb4unorm-webgl":{f:s0},"pvrtc-rgba4unorm-webgl":{f:s0},"pvrtc-rbg2unorm-webgl":{f:s0},"pvrtc-rgba2unorm-webgl":{f:s0},"etc1-rbg-unorm-webgl":{f:tj},"atc-rgb-unorm-webgl":{f:R1},"atc-rgba-unorm-webgl":{f:R1},"atc-rgbai-unorm-webgl":{f:R1}},nj=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],rj=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function fS(e){return nj.some(t=>e.startsWith(t))}function F1(e){let t=oj(e);if(fS(e)){t.channels="rgb",t.components=3,t.bytesPerPixel=1,t.srgb=!1,t.compressed=!0;const n=sj(e);n&&(t.blockWidth=n.blockWidth,t.blockHeight=n.blockHeight)}const i=rj.exec(e);if(i){const[,n,r,s,o,l]=i,h=`${s}${r}`,A=lS(h),v=A.byteLength*8,C=n.length,S=[v,C>=2?v:0,C>=3?v:0,C>=4?v:0];t={format:e,attachment:t.attachment,dataType:A.dataType,components:C,channels:n,integer:A.integer,signed:A.signed,normalized:A.normalized,bitsPerChannel:S,bytesPerPixel:A.byteLength*n.length,packed:t.packed,srgb:t.srgb},l==="-webgl"&&(t.webgl=!0),o==="-srgb"&&(t.srgb=!0)}return e.endsWith("-webgl")&&(t.webgl=!0),e.endsWith("-srgb")&&(t.srgb=!0),t}function oj(e){var t;const i=hS(e),n=i.bytesPerPixel||1,r=i.bitsPerChannel||[8,8,8,8];return delete i.bitsPerChannel,delete i.bytesPerPixel,delete i.f,delete i.render,delete i.filter,delete i.blend,delete i.store,{...i,format:e,attachment:i.attachment||"color",channels:i.channels||"r",components:i.components||((t=i.channels)==null?void 0:t.length)||1,bytesPerPixel:n,bitsPerChannel:r,dataType:i.dataType||"uint8",srgb:i.srgb??!1,packed:i.packed??!1,webgl:i.webgl??!1,integer:i.integer??!1,signed:i.signed??!1,normalized:i.normalized??!1,compressed:i.compressed??!1}}function sj(e){const t=/.*-(\d+)x(\d+)-.*/.exec(e);if(t){const[,i,n]=t;return{blockWidth:Number(i),blockHeight:Number(n)}}return null}function aj(e){const t=hS(e),i={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},n=F1(e),r=e.startsWith("depth")||e.startsWith("stencil"),s=n==null?void 0:n.signed,o=n==null?void 0:n.integer,l=n==null?void 0:n.webgl;return i.render&&(i.render=!s),i.filter&&(i.filter=!r&&!s&&!o&&!l),i}class lj{}class cj{constructor(t=[],i){z(this,"features"),z(this,"disabledFeatures"),this.features=new Set(t),this.disabledFeatures=i||{}}*[Symbol.iterator](){yield*this.features}has(t){var i;return!((i=this.disabledFeatures)!=null&&i[t])&&this.features.has(t)}}const dS=class rN{constructor(t){z(this,"id"),z(this,"props"),z(this,"userData",{}),z(this,"statsManager",eS),z(this,"timestamp",0),z(this,"_reused",!1),z(this,"_lumaData",{}),this.props={...rN.defaultProps,...t},this.id=this.props.id||o0(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(t){const i=aj(t),n=o=>(typeof o=="string"?this.features.has(o):o)??!0,r=n(i.create),s={format:t,create:r,render:r&&n(i.render),filter:r&&n(i.filter),blend:r&&n(i.blend),store:r&&n(i.store)};return this._getDeviceSpecificTextureFormatCapabilities(s)}isTextureFormatSupported(t,i){return this.getTextureFormatCapabilities(t).create}isTextureFormatFilterable(t){return this.getTextureFormatCapabilities(t).filter}isTextureFormatRenderable(t){return this.getTextureFormatCapabilities(t).render}isTextureFormatCompressed(t){return fS(t)}loseDevice(){return!1}reportError(t){this.props.onError(t)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(t={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(t){this.props.onError(t)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(t,i){throw new Error("not implemented")}readPixelsToBufferWebGL(t,i){throw new Error("not implemented")}setParametersWebGL(t){throw new Error("not implemented")}getParametersWebGL(t){throw new Error("not implemented")}withParametersWebGL(t,i){throw new Error("not implemented")}clearWebGL(t){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(t){return t.createCanvasContext===!0?{}:t.createCanvasContext}_normalizeBufferProps(t){(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t={data:t});const i={...t};return(t.usage||0)&jr.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?i.indexType="uint32":t.data instanceof Uint16Array?i.indexType="uint16":ti.warn("indices buffer content must be of integer type")()),i}};z(dS,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>ti.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:ti.get("debug")||void 0,debugShaders:ti.get("debug-shaders")||void 0,debugFramebuffers:!!ti.get("debug-framebuffers"),debugWebGL:!!ti.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let Dd=dS;const uj=ic()&&typeof document<"u",hj=()=>uj&&document.readyState==="complete",fj="set luma.log.level=1 (or higher) to trace rendering",pS="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",k1=class lm{constructor(){if(z(this,"stats",eS),z(this,"log",ti),z(this,"VERSION","9.1.7"),z(this,"spector"),z(this,"preregisteredAdapters",new Map),globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw ti.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),ti.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");ti.error("This version of luma.gl has already been initialized")()}ti.log(1,`${this.VERSION} - ${fj}`)(),globalThis.luma=this}registerAdapters(t){for(const i of t)this.preregisteredAdapters.set(i.type,i)}getSupportedAdapters(t=[]){const i=this.getAdapterMap(t);return Array.from(i).map(([,n])=>n).filter(n=>{var r;return(r=n.isSupported)==null?void 0:r.call(n)}).map(n=>n.type)}getBestAvailableAdapter(t=[]){var i,n,r,s;const o=this.getAdapterMap(t);return(n=(i=o.get("webgpu"))==null?void 0:i.isSupported)!=null&&n.call(i)?"webgpu":(s=(r=o.get("webgl"))==null?void 0:r.isSupported)!=null&&s.call(r)?"webgl":null}setDefaultDeviceProps(t){Object.assign(lm.defaultProps,t)}async createDevice(t={}){var i;t={...lm.defaultProps,...t},t.waitForPageLoad&&await lm.pageLoaded;const n=this.getAdapterMap(t.adapters);let r=t.type||"";r==="best-available"&&(r=this.getBestAvailableAdapter(t.adapters)||r);const s=(this.getAdapterMap(t.adapters)||n).get(r),o=await((i=s==null?void 0:s.create)==null?void 0:i.call(s,t));if(o)return o;throw new Error(pS)}async attachDevice(t){var i;const n=this.getAdapterMap(t.adapters);let r="";t.handle instanceof WebGL2RenderingContext&&(r="webgl"),t.createCanvasContext&&await lm.pageLoaded,t.handle===null&&(r="unknown");const s=n.get(r),o=await((i=s==null?void 0:s.attach)==null?void 0:i.call(s,null));if(o)return o;throw new Error(pS)}enforceWebGL2(t=!0,i=[]){var n;const r=this.getAdapterMap(i).get("webgl");r||ti.warn("enforceWebGL2: webgl adapter not found")(),(n=r==null?void 0:r.enforceWebGL2)==null||n.call(r,t)}getAdapterMap(t=[]){const i=new Map(this.preregisteredAdapters);for(const n of t)i.set(n.type,n);return i}registerDevices(t){ti.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const i of t){const n=i.adapter;n&&this.preregisteredAdapters.set(n.type,n)}}};z(k1,"defaultProps",{...Dd.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),z(k1,"pageLoaded",pj().then(()=>{ti.probe(2,"DOM is loaded")()}));let dj=k1;const N1=new dj;function pj(){return hj()||typeof window>"u"?Promise.resolve():new Promise(e=>{window.addEventListener("load",()=>e())})}class Aj{}const AS=class oN{constructor(t){if(z(this,"id"),z(this,"props"),z(this,"canvas"),z(this,"htmlCanvas"),z(this,"offscreenCanvas"),z(this,"type"),z(this,"width",1),z(this,"height",1),z(this,"resizeObserver"),z(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1}),this.props={...oN.defaultProps,...t},t=this.props,!ic()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(t.canvas)typeof t.canvas=="string"?this.canvas=yj(t.canvas):this.canvas=t.canvas;else{const i=_j(t),n=mj((t==null?void 0:t.container)||null);n.insertBefore(i,n.firstChild),this.canvas=i,t!=null&&t.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&t.autoResize&&(this.resizeObserver=new ResizeObserver(i=>{for(const n of i)n.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(t){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(t=t===void 0?this.props.useDevicePixels:t,!t||t<=0)?1:t===!0?typeof window<"u"&&window.devicePixelRatio||1:t}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const t=this.getDevicePixelRatio(),i=this.canvas;return i.parentElement?[i.clientWidth*t,i.clientHeight*t]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[t,i]=this.getPixelSize();return t/i}cssToDeviceRatio(){var t;try{const[i]=this.getDrawingBufferSize(),n=this._canvasSizeInfo.clientWidth||((t=this.htmlCanvas)==null?void 0:t.clientWidth);return n?i/n:1}catch{return 1}}cssToDevicePixels(t,i=!0){const n=this.cssToDeviceRatio(),[r,s]=this.getDrawingBufferSize();return vj(t,n,r,s,i)}setDevicePixelRatio(t,i={}){if(!this.htmlCanvas)return;let n="width"in i?i.width:this.htmlCanvas.clientWidth,r="height"in i?i.height:this.htmlCanvas.clientHeight;(!n||!r)&&(ti.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,n=this.htmlCanvas.width||1,r=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==n||s.clientHeight!==r||s.devicePixelRatio!==t){let o=t;const l=Math.floor(n*o),h=Math.floor(r*o);if(this.htmlCanvas.width=l,this.htmlCanvas.height=h,this.device.gl){const[A,v]=this.getDrawingBufferSize();(A!==l||v!==h)&&(o=Math.min(A/n,v/r),this.htmlCanvas.width=Math.floor(n*o),this.htmlCanvas.height=Math.floor(r*o),ti.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=r,this._canvasSizeInfo.devicePixelRatio=t}}}getDrawingBufferSize(){const t=this.device.gl;return t?[t.drawingBufferWidth,t.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(t){var i;((i=this.htmlCanvas)==null?void 0:i.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=t)}};z(AS,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let gj=AS;function mj(e){if(typeof e=="string"){const t=document.getElementById(e);if(!t)throw new Error(`${e} is not an HTML element`);return t}else if(e)return e;return document.body}function yj(e){const t=document.getElementById(e);if(!(t instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return t}function _j(e){const{width:t,height:i}=e,n=document.createElement("canvas");return n.id=o0("lumagl-auto-created-canvas"),n.width=t||1,n.height=i||1,n.style.width=Number.isFinite(t)?`${t}px`:"100%",n.style.height=Number.isFinite(i)?`${i}px`:"100%",n}function vj(e,t,i,n,r){const s=e,o=gS(s[0],t,i);let l=mS(s[1],t,n,r),h=gS(s[0]+1,t,i);const A=h===i-1?h:h-1;h=mS(s[1]+1,t,n,r);let v;return r?(h=h===0?h:h+1,v=l,l=h):v=h===n-1?h:h-1,{x:o,y:l,width:Math.max(A-o+1,1),height:Math.max(v-l+1,1)}}function gS(e,t,i){return Math.min(Math.round(e*t),i-1)}function mS(e,t,i,n){return n?Math.max(0,i-1-Math.round(e*t)):Math.min(Math.round(e*t),i-1)}const Jc=class vh extends Ar{constructor(t,i){if(i=vh.normalizeProps(t,i),super(t,i,vh.defaultProps),z(this,"dimension"),z(this,"format"),z(this,"width"),z(this,"height"),z(this,"depth"),z(this,"mipLevels"),z(this,"updateTimestamp"),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const n=vh.getTextureDataSize(this.props.data);this.width=(n==null?void 0:n.width)||1,this.height=(n==null?void 0:n.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?vh.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(t){return this.device.createTexture({...this.props,...t})}static isExternalImage(t){return typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement||typeof VideoFrame<"u"&&t instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static getExternalImageSize(t){if(typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height};if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return{width:t.naturalWidth,height:t.naturalHeight};if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return{width:t.videoWidth,height:t.videoHeight};if(typeof VideoFrame<"u"&&t instanceof VideoFrame)return{width:t.displayWidth,height:t.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(t){const i=t==null?void 0:t.data;return ArrayBuffer.isView(i)}static getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return vh.getTextureDataSize(t[0]);if(vh.isExternalImage(t))return vh.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){const i=Object.values(t)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(t,i){let n;return ArrayBuffer.isView(t)?n=[{data:t,width:i.width,height:i.height}]:Array.isArray(t)?n=t:n=[t],n}static getMipLevelCount(t,i){return Math.floor(Math.log2(Math.max(t,i)))+1}static getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}static normalizeProps(t,i){var n,r;const s={...i},o=((r=(n=t==null?void 0:t.props)==null?void 0:n._resourceDefaults)==null?void 0:r.texture)||{};Object.assign(s,o);const{width:l,height:h}=s;return typeof l=="number"&&(s.width=Math.max(1,Math.ceil(l))),typeof h=="number"&&(s.height=Math.max(1,Math.ceil(h))),s}};z(Jc,"COPY_SRC",1),z(Jc,"COPY_DST",2),z(Jc,"TEXTURE",4),z(Jc,"STORAGE",8),z(Jc,"RENDER_ATTACHMENT",16),z(Jc,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),z(Jc,"defaultProps",{...Ar.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),z(Jc,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let uo=Jc;const yS=class sN extends Ar{get[Symbol.toStringTag](){return"TextureView"}constructor(t,i){super(t,i,sN.defaultProps)}};z(yS,"defaultProps",{...Ar.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let _S=yS;function bj(e,t,i){let n="";const r=t.split(/\r?\n/),s=e.slice().sort((o,l)=>o.lineNum-l.lineNum);switch((i==null?void 0:i.showSourceCode)||"no"){case"all":let o=0;for(let l=1;l<=r.length;l++)for(n+=bS(r[l-1],l,i);s.length>o&&s[o].lineNum===l;){const h=s[o++];n+=vS(h,r,h.lineNum,{...i,inlineSource:!1})}return n;case"issues":case"no":for(const l of e)n+=vS(l,r,l.lineNum,{inlineSource:(i==null?void 0:i.showSourceCode)!=="no"});return n}}function vS(e,t,i,n){if(n!=null&&n.inlineSource){const s=xj(t,i),o=e.linePos>0?`${" ".repeat(e.linePos+5)}^^^
`:"";return`
${s}${o}${e.type.toUpperCase()}: ${e.message}

`}const r=e.type==="error"?"red":"#8B4000";return n!=null&&n.html?`<div class='luma-compiler-log-error' style="color:${r};"><b> ${e.type.toUpperCase()}: ${e.message}</b></div>`:`${e.type.toUpperCase()}: ${e.message}`}function xj(e,t,i){let n="";for(let r=t-2;r<=t;r++){const s=e[r-1];s!==void 0&&(n+=bS(s,t,i))}return n}function bS(e,t,i){const n=i!=null&&i.html?Cj(e):e;return`${wj(String(t),4)}: ${n}${i!=null&&i.html?"<br/>":`
`}`}function wj(e,t){let i="";for(let n=e.length;n<t;++n)i+=" ";return i+e}function Cj(e){return e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const xS=class aN extends Ar{constructor(t,i){i={...i,debugShaders:i.debugShaders||t.props.debugShaders||"errors"},super(t,{id:Ej(i),...i},aN.defaultProps),z(this,"stage"),z(this,"source"),z(this,"compilationStatus","pending"),this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const i=await this.getCompilationInfo();t==="warnings"&&(i==null?void 0:i.length)===0||this._displayShaderLog(i)}_displayShaderLog(t){var i;if(typeof document>"u"||!(document!=null&&document.createElement))return;const n=CS(this.source),r=`${this.stage} ${n}`;let s=bj(t,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const l=document.createElement("Button");l.innerHTML=`
<h1>Shader Compilation Error in ${r}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,l.style.top="10px",l.style.left="10px",l.style.position="absolute",l.style.zIndex="9999",l.style.width="100%",l.style.textAlign="left",document.body.appendChild(l),(i=document.getElementsByClassName("luma-compiler-log-error")[0])==null||i.scrollIntoView(),l.onclick=()=>{const h=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(h)}}};z(xS,"defaultProps",{...Ar.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let wS=xS;function Ej(e){return CS(e.source)||e.id||o0(`unnamed ${e.stage}-shader`)}function CS(e,t="unnamed"){const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return i?i[1]:t}const ES=class NE extends Ar{get[Symbol.toStringTag](){return"Sampler"}constructor(t,i){i=NE.normalizeProps(t,i),super(t,i,NE.defaultProps)}static normalizeProps(t,i){var n,r;const s=((r=(n=t==null?void 0:t.props)==null?void 0:n._resourceDefaults)==null?void 0:r.sampler)||{};return{...i,...s}}};z(ES,"defaultProps",{...Ar.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let BS=ES;const TS=class lN extends Ar{constructor(t,i={}){super(t,i,lN.defaultProps),z(this,"width"),z(this,"height"),this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(t){const i=this.colorAttachments.map(r=>r.texture.clone(t)),n=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:i,depthStencilAttachment:n})}resize(t){let i=!t;if(t){const[n,r]=Array.isArray(t)?t:[t.width,t.height];i=i||r!==this.height||n!==this.width,this.width=n,this.height=r}i&&(ti.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((i,n)=>{if(typeof i=="string"){const r=this.createColorTexture(i,n);return this.attachResource(r),r.view}return i instanceof uo?i.view:i});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const i=this.createDepthStencilTexture(t);this.attachResource(i),this.depthStencilAttachment=i.view}else t instanceof uo?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,i){return this.device.createTexture({id:`${this.id}-color-attachment-${i}`,usage:uo.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:uo.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,i){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const r=this.colorAttachments[n].texture.clone({width:t,height:i});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=r.view,this.attachResource(r.view)}if(this.depthStencilAttachment){const n=this.depthStencilAttachment.texture.clone({width:t,height:i});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}this.updateAttachments()}};z(TS,"defaultProps",{...Ar.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let SS=TS;const IS=class cN extends Ar{constructor(t,i){super(t,i,cN.defaultProps),z(this,"shaderLayout"),z(this,"bufferLayout"),z(this,"linkStatus","pending"),z(this,"hash",""),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(t){throw new Error("Use uniform blocks")}};z(IS,"defaultProps",{...Ar.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let c0=IS;const Wu=class UE extends Ar{get[Symbol.toStringTag](){return"RenderPass"}constructor(t,i){i=UE.normalizeProps(t,i),super(t,i,UE.defaultProps)}static normalizeProps(t,i){var n;return{...(n=t.props._resourceDefaults)==null?void 0:n.renderPass,...i}}};z(Wu,"defaultClearColor",[0,0,0,1]),z(Wu,"defaultClearDepth",1),z(Wu,"defaultClearStencil",0),z(Wu,"defaultProps",{...Ar.defaultProps,framebuffer:null,parameters:void 0,clearColor:Wu.defaultClearColor,clearColors:void 0,clearDepth:Wu.defaultClearDepth,clearStencil:Wu.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Bj=Wu;const MS=class uN extends Ar{constructor(t,i){super(t,i,uN.defaultProps),z(this,"hash",""),z(this,"shaderLayout"),this.shaderLayout=i.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};z(MS,"defaultProps",{...Ar.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let PS=MS;const RS=class hN extends Ar{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(t,i){super(t,i,hN.defaultProps)}};z(RS,"defaultProps",{...Ar.defaultProps,measureExecutionTime:void 0});let Tj=RS;const DS=class fN extends Ar{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(t,i){super(t,i,fN.defaultProps)}};z(DS,"defaultProps",{...Ar.defaultProps});let Sj=DS;function Ij(e){const[t,i]=Pj[e],n=t==="i32"||t==="u32",r=t!=="u32",s=Rj[t]*i,o=Mj(t,i);return{dataType:t,components:i,defaultVertexFormat:o,byteLength:s,integer:n,signed:r}}function Mj(e,t){let i;switch(e){case"f32":i="float32";break;case"i32":i="sint32";break;case"u32":i="uint32";break;case"f16":return t<=2?"float16x2":"float16x4"}return t===1?i:`${i}x${t}`}const Pj={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},Rj={f32:4,f16:2,i32:4,u32:4};function OS(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);const[i,n]=e.split("x"),r=i,s=n?parseInt(n):1,o=lS(r),l={type:r,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return t&&(l.webglOnly=!0),l}function LS(e,t){const i={};for(const n of e.attributes){const r=Oj(e,t,n.name);r&&(i[n.name]=r)}return i}function Dj(e,t,i=16){const n=LS(e,t),r=new Array(i).fill(null);for(const s of Object.values(n))r[s.location]=s;return r}function Oj(e,t,i){const n=Lj(e,i),r=Fj(t,i);if(!n)return null;const s=Ij(n.type),o=(r==null?void 0:r.vertexFormat)||s.defaultVertexFormat,l=OS(o);return{attributeName:(r==null?void 0:r.attributeName)||n.name,bufferName:(r==null?void 0:r.bufferName)||n.name,location:n.location,shaderType:n.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:o,bufferDataType:l.type,bufferComponents:l.components,normalized:l.normalized,integer:s.integer,stepMode:(r==null?void 0:r.stepMode)||n.stepMode||"vertex",byteOffset:(r==null?void 0:r.byteOffset)||0,byteStride:(r==null?void 0:r.byteStride)||0}}function Lj(e,t){const i=e.attributes.find(n=>n.name===t);return i||ti.warn(`shader layout attribute "${t}" not present in shader`),i||null}function Fj(e,t){kj(e);let i=Nj(e,t);return i||(i=Uj(e,t),i)?i:(ti.warn(`layout for attribute "${t}" not present in buffer layout`),null)}function kj(e){for(const t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&ti.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function Nj(e,t){for(const i of e)if(i.format&&i.name===t)return{attributeName:i.name,bufferName:t,stepMode:i.stepMode,vertexFormat:i.format,byteOffset:0,byteStride:i.byteStride||0};return null}function Uj(e,t){var i;for(const n of e){let r=n.byteStride;if(typeof n.byteStride!="number")for(const o of n.attributes||[]){const l=OS(o.format);r+=l.byteLength}const s=(i=n.attributes)==null?void 0:i.find(o=>o.attribute===t);if(s)return{attributeName:s.attribute,bufferName:n.name,stepMode:n.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:r}}return null}const FS=class dN extends Ar{constructor(t,i){super(t,i,dN.defaultProps),z(this,"maxVertexAttributes"),z(this,"attributeInfos"),z(this,"indexBuffer",null),z(this,"attributes"),this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:n,bufferLayout:r}=i.renderPipeline||{};if(!n||!r)throw new Error("VertexArray");this.attributeInfos=Dj(n,r,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(t,i){this.device.reportError(new Error("constant attributes not supported"))}};z(FS,"defaultProps",{...Ar.defaultProps,renderPipeline:null});let Gj=FS;const kS=class pN extends Ar{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(t,i){super(t,i,pN.defaultProps)}};z(kS,"defaultProps",{...Ar.defaultProps,layout:void 0,buffers:{}});let zj=kS;const NS=class AN extends Ar{get[Symbol.toStringTag](){return"QuerySet"}constructor(t,i){super(t,i,AN.defaultProps)}};z(NS,"defaultProps",{...Ar.defaultProps,type:void 0,count:void 0});let Vj=NS;const jj={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function Hj(e){return jj[e]}function Wj(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}let u0;function US(e){return(!u0||u0.byteLength<e)&&(u0=new ArrayBuffer(e)),u0}function Jj(e,t){const i=US(e.BYTES_PER_ELEMENT*t);return new e(i,0,t)}function Xj(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function h0(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":Xj(e)}const GS=1024;class Kj{constructor(t){z(this,"layout",{}),z(this,"byteLength");let i=0;for(const[r,s]of Object.entries(t)){const o=Hj(s),{type:l,components:h}=o;i=Wj(i,h);const A=i;i+=h,this.layout[r]={type:l,size:h,offset:A}}i+=(4-i%4)%4;const n=i*4;this.byteLength=Math.max(n,GS)}getData(t){const i=Math.max(this.byteLength,GS),n=US(i),r={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(const[s,o]of Object.entries(t)){const l=this.layout[s];if(!l){ti.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:h,size:A,offset:v}=l,C=r[h];if(A===1){if(typeof o!="number"&&typeof o!="boolean"){ti.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}C[v]=Number(o)}else{if(!h0(o)){ti.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}C.set(o,v)}}return new Uint8Array(n)}has(t){return!!this.layout[t]}get(t){return this.layout[t]}}function Qj(e,t,i=16){if(e!==t)return!1;const n=e,r=t;if(!h0(n))return!1;if(h0(r)&&n.length===r.length){for(let s=0;s<n.length;++s)if(r[s]!==n[s])return!1}return!0}function Zj(e){return h0(e)?e.slice():e}class Yj{constructor(t){z(this,"name"),z(this,"uniforms",{}),z(this,"modifiedUniforms",{}),z(this,"modified",!0),z(this,"bindingLayout",{}),z(this,"needsRedraw","initialized");var i;if(this.name=(t==null?void 0:t.name)||"unnamed",t!=null&&t.name&&t!=null&&t.shaderLayout){const n=(i=t==null?void 0:t.shaderLayout.bindings)==null?void 0:i.find(s=>s.type==="uniform"&&s.name===(t==null?void 0:t.name));if(!n)throw new Error(t==null?void 0:t.name);const r=n;for(const s of r.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(t){for(const[i,n]of Object.entries(t))this._setUniform(i,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${i}=${n}`)}setNeedsRedraw(t){this.needsRedraw=this.needsRedraw||t}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(t,i){Qj(this.uniforms[t],i)||(this.uniforms[t]=Zj(i),this.modifiedUniforms[t]=!0,this.modified=!0)}}class qj{constructor(t){z(this,"uniformBlocks",new Map),z(this,"uniformBufferLayouts",new Map),z(this,"uniformBuffers",new Map);for(const[i,n]of Object.entries(t)){const r=i,s=new Kj(n.uniformTypes||{});this.uniformBufferLayouts.set(r,s);const o=new Yj({name:i});o.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(r,o)}}destroy(){for(const t of this.uniformBuffers.values())t.destroy()}setUniforms(t){var i;for(const[n,r]of Object.entries(t))(i=this.uniformBlocks.get(n))==null||i.setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(t){var i;return((i=this.uniformBufferLayouts.get(t))==null?void 0:i.byteLength)||0}getUniformBufferData(t){var i,n;const r=((i=this.uniformBlocks.get(t))==null?void 0:i.getAllUniforms())||{};return(n=this.uniformBufferLayouts.get(t))==null?void 0:n.getData(r)}createUniformBuffer(t,i,n){n&&this.setUniforms(n);const r=this.getUniformBufferByteLength(i),s=t.createBuffer({usage:jr.UNIFORM|jr.COPY_DST,byteLength:r}),o=this.getUniformBufferData(i);return s.write(o),s}getManagedUniformBuffer(t,i){if(!this.uniformBuffers.get(i)){const n=this.getUniformBufferByteLength(i),r=t.createBuffer({usage:jr.UNIFORM|jr.COPY_DST,byteLength:n});this.uniformBuffers.set(i,r)}return this.uniformBuffers.get(i)}updateUniformBuffers(){let t=!1;for(const i of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(i);t||(t=n)}return t&&ti.log(3,`UniformStore.updateUniformBuffers(): ${t}`)(),t}updateUniformBuffer(t){var i;const n=this.uniformBlocks.get(t);let r=this.uniformBuffers.get(t),s=!1;if(r&&n!=null&&n.needsRedraw){s||(s=n.needsRedraw);const o=this.getUniformBufferData(t);r=this.uniformBuffers.get(t),r==null||r.write(o);const l=(i=this.uniformBlocks.get(t))==null?void 0:i.getAllUniforms();ti.log(4,`Writing to uniform buffer ${String(t)}`,o,l)()}return s}}function zS(e){const t=ArrayBuffer.isView(e)?e.constructor:e;switch(t){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(t.constructor.name)}}function VS(e){switch(e){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(e)}}function $j(e,t,i){if(!t||t>4)throw new Error(`size ${t}`);const n=t;let r=zS(e);if(r==="uint8"&&i&&n===1)return"unorm8-webgl";if(r==="uint8"&&i&&n===3)return"unorm8x3-webgl";if(r==="uint8"||r==="sint8"){if(n===1||n===3)throw new Error(`size: ${t}`);return i&&(r=r.replace("int","norm")),`${r}x${n}`}if(r==="uint16"||r==="sint16"){if(n===1||n===3)throw new Error(`size: ${t}`);return i&&(r=r.replace("int","norm")),`${r}x${n}`}return n===1?r:`${r}x${n}`}class U1{constructor(t){z(this,"bufferLayouts"),this.bufferLayouts=t}getBufferLayout(t){return this.bufferLayouts.find(i=>i.name===t)||null}getAttributeNamesForBuffer(t){var i;return t.attributes?(i=t.attributes)==null?void 0:i.map(n=>n.attribute):[t.name]}mergeBufferLayouts(t,i){const n=[...t];for(const r of i){const s=n.findIndex(o=>o.name===r.name);s<0?n.push(r):n[s]=r}return n}}class Fa{constructor(t,i){this.name=t,this.attributes=i,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}getTypeName(){return this.name}}class jS{constructor(t,i,n){this.name=t,this.type=i,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Ju extends Fa{constructor(t,i){super(t,i),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Xu extends Fa{constructor(t,i){super(t,i),this.count=0,this.stride=0}get isArray(){return!0}}class Zh extends Fa{constructor(t,i,n,r){super(t,n),this.format=i,this.access=r}get isTemplate(){return!0}getTypeName(){let t=this.name;if(this.format!==null){if(t==="vec2"||t==="vec3"||t==="vec4"||t==="mat2x2"||t==="mat2x3"||t==="mat2x4"||t==="mat3x2"||t==="mat3x3"||t==="mat3x4"||t==="mat4x2"||t==="mat4x3"||t==="mat4x4"){if(this.format.name==="f32")return t+="f",t;if(this.format.name==="i32")return t+="i",t;if(this.format.name==="u32")return t+="u",t;if(this.format.name==="bool")return t+="b",t;if(this.format.name==="f16")return t+="h",t}t+=`<${this.format.name}>`}else if(t==="vec2"||t==="vec3"||t==="vec4")return t;return t}}var Ku;(e=>{e[e.Uniform=0]="Uniform",e[e.Storage=1]="Storage",e[e.Texture=2]="Texture",e[e.Sampler=3]="Sampler",e[e.StorageTexture=4]="StorageTexture"})(Ku||(Ku={}));class f0{constructor(t,i,n,r,s,o,l){this.name=t,this.type=i,this.group=n,this.binding=r,this.attributes=s,this.resourceType=o,this.access=l}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class tH{constructor(t,i){this.name=t,this.type=i}}class eH{constructor(t,i,n,r){this.name=t,this.type=i,this.locationType=n,this.location=r,this.interpolation=null}}class HS{constructor(t,i,n,r){this.name=t,this.type=i,this.locationType=n,this.location=r}}class iH{constructor(t,i,n,r){this.name=t,this.type=i,this.attributes=n,this.id=r}}class nH{constructor(t,i,n){this.name=t,this.type=i,this.attributes=n}}class rH{constructor(t,i=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=t,this.stage=i,this.attributes=n}}class oH{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const WS=new Float32Array(1),sH=new Int32Array(WS.buffer),ms=new Uint16Array(1);function aH(e){WS[0]=e;const t=sH[0],i=t>>31&1;let n=t>>23&255,r=8388607&t;if(n===255)return ms[0]=i<<15|31744|(r!==0?512:0),ms[0];if(n===0){if(r===0)return ms[0]=i<<15,ms[0];r|=8388608;let s=113;for(;!(8388608&r);)r<<=1,s--;return n=127-s,r&=8388607,n>0?(r=(r>>126-n)+(r>>127-n&1),ms[0]=i<<15|n<<10|r>>13,ms[0]):(ms[0]=i<<15,ms[0])}return n=n-127+15,n>=31?(ms[0]=i<<15|31744,ms[0]):n<=0?n<-10?(ms[0]=i<<15,ms[0]):(r=(8388608|r)>>1-n,ms[0]=i<<15|r>>13,ms[0]):(r>>=13,ms[0]=i<<15|n<<10|r,ms[0])}const G1=new Uint32Array(1),JS=new Float32Array(G1.buffer,0,1);function XS(e){const t=112+(e>>6&31)<<23|(63&e)<<17;return G1[0]=t,JS[0]}function lH(e,t,i,n,r,s,o,l,h){const A=n*(o>>=r)*(s>>=r)+i*o+t*l;switch(h){case"r8unorm":return[Yn(e,A,"8unorm",1)[0]];case"r8snorm":return[Yn(e,A,"8snorm",1)[0]];case"r8uint":return[Yn(e,A,"8uint",1)[0]];case"r8sint":return[Yn(e,A,"8sint",1)[0]];case"rg8unorm":{const v=Yn(e,A,"8unorm",2);return[v[0],v[1]]}case"rg8snorm":{const v=Yn(e,A,"8snorm",2);return[v[0],v[1]]}case"rg8uint":{const v=Yn(e,A,"8uint",2);return[v[0],v[1]]}case"rg8sint":{const v=Yn(e,A,"8sint",2);return[v[0],v[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const v=Yn(e,A,"8unorm",4);return[v[0],v[1],v[2],v[3]]}case"rgba8snorm":{const v=Yn(e,A,"8snorm",4);return[v[0],v[1],v[2],v[3]]}case"rgba8uint":{const v=Yn(e,A,"8uint",4);return[v[0],v[1],v[2],v[3]]}case"rgba8sint":{const v=Yn(e,A,"8sint",4);return[v[0],v[1],v[2],v[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const v=Yn(e,A,"8unorm",4);return[v[2],v[1],v[0],v[3]]}case"r16uint":return[Yn(e,A,"16uint",1)[0]];case"r16sint":return[Yn(e,A,"16sint",1)[0]];case"r16float":return[Yn(e,A,"16float",1)[0]];case"rg16uint":{const v=Yn(e,A,"16uint",2);return[v[0],v[1]]}case"rg16sint":{const v=Yn(e,A,"16sint",2);return[v[0],v[1]]}case"rg16float":{const v=Yn(e,A,"16float",2);return[v[0],v[1]]}case"rgba16uint":{const v=Yn(e,A,"16uint",4);return[v[0],v[1],v[2],v[3]]}case"rgba16sint":{const v=Yn(e,A,"16sint",4);return[v[0],v[1],v[2],v[3]]}case"rgba16float":{const v=Yn(e,A,"16float",4);return[v[0],v[1],v[2],v[3]]}case"r32uint":return[Yn(e,A,"32uint",1)[0]];case"r32sint":return[Yn(e,A,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Yn(e,A,"32float",1)[0]];case"rg32uint":{const v=Yn(e,A,"32uint",2);return[v[0],v[1]]}case"rg32sint":{const v=Yn(e,A,"32sint",2);return[v[0],v[1]]}case"rg32float":{const v=Yn(e,A,"32float",2);return[v[0],v[1]]}case"rgba32uint":{const v=Yn(e,A,"32uint",4);return[v[0],v[1],v[2],v[3]]}case"rgba32sint":{const v=Yn(e,A,"32sint",4);return[v[0],v[1],v[2],v[3]]}case"rgba32float":{const v=Yn(e,A,"32float",4);return[v[0],v[1],v[2],v[3]]}case"rg11b10ufloat":{const v=new Uint32Array(e.buffer,A,1)[0],C=(4192256&v)>>11,S=(4290772992&v)>>22;return[XS(2047&v),XS(C),function(L){const N=112+(L>>5&31)<<23|(31&L)<<18;return G1[0]=N,JS[0]}(S),1]}}return null}function Yn(e,t,i,n){const r=[0,0,0,0];for(let A=0;A<n;++A)switch(i){case"8unorm":r[A]=e[t]/255,t++;break;case"8snorm":r[A]=e[t]/255*2-1,t++;break;case"8uint":r[A]=e[t],t++;break;case"8sint":r[A]=e[t]-127,t++;break;case"16uint":r[A]=e[t]|e[t+1]<<8,t+=2;break;case"16sint":r[A]=(e[t]|e[t+1]<<8)-32768,t+=2;break;case"16float":r[A]=(s=e[t]|e[t+1]<<8,o=void 0,l=void 0,h=void 0,o=(32768&s)>>15,h=1023&s,(l=(31744&s)>>10)==0?(o?-1:1)*Math.pow(2,-14)*(h/Math.pow(2,10)):l==31?h?NaN:1/0*(o?-1:1):(o?-1:1)*Math.pow(2,l-15)*(1+h/Math.pow(2,10))),t+=2;break;case"32uint":case"32sint":r[A]=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,t+=4;break;case"32float":r[A]=new Float32Array(e.buffer,t,1)[0],t+=4}var s,o,l,h;return r}function nr(e,t,i,n,r){for(let s=0;s<n;++s)switch(i){case"8unorm":e[t]=255*r[s],t++;break;case"8snorm":e[t]=.5*(r[s]+1)*255,t++;break;case"8uint":e[t]=r[s],t++;break;case"8sint":e[t]=r[s]+127,t++;break;case"16uint":new Uint16Array(e.buffer,t,1)[0]=r[s],t+=2;break;case"16sint":new Int16Array(e.buffer,t,1)[0]=r[s],t+=2;break;case"16float":{const o=aH(r[s]);new Uint16Array(e.buffer,t,1)[0]=o,t+=2;break}case"32uint":new Uint32Array(e.buffer,t,1)[0]=r[s],t+=4;break;case"32sint":new Int32Array(e.buffer,t,1)[0]=r[s],t+=4;break;case"32float":new Float32Array(e.buffer,t,1)[0]=r[s],t+=4}return r}const z1={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Ja{constructor(){this.id=Ja._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(t){t(this)}searchBlock(t,i){if(t){i(d0.instance);for(const n of t)n instanceof Array?this.searchBlock(n,i):n.search(i);i(p0.instance)}}constEvaluate(t,i){throw new Error("Cannot evaluate node")}constEvaluateString(t){return this.constEvaluate(t).toString()}}Ja._id=0;let d0=class extends Ja{};d0.instance=new d0;class p0 extends Ja{}p0.instance=new p0;const KS=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class Nr extends Ja{constructor(){super()}}class HA extends Nr{constructor(t,i,n,r,s,o){super(),this.calls=new Set,this.name=t,this.args=i,this.returnType=n,this.body=r,this.startLine=s,this.endLine=o}get astNodeType(){return"function"}search(t){if(this.attributes)for(const i of this.attributes)t(i);t(this);for(const i of this.args)t(i);this.searchBlock(this.body,t)}}class cH extends Nr{constructor(t){super(),this.expression=t}get astNodeType(){return"staticAssert"}search(t){this.expression.search(t)}}class QS extends Nr{constructor(t,i){super(),this.condition=t,this.body=i}get astNodeType(){return"while"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class V1 extends Nr{constructor(t,i){super(),this.body=t,this.loopId=i}get astNodeType(){return"continuing"}search(t){this.searchBlock(this.body,t)}}class ZS extends Nr{constructor(t,i,n,r){super(),this.init=t,this.condition=i,this.increment=n,this.body=r}get astNodeType(){return"for"}search(t){var i,n,r;(i=this.init)===null||i===void 0||i.search(t),(n=this.condition)===null||n===void 0||n.search(t),(r=this.increment)===null||r===void 0||r.search(t),this.searchBlock(this.body,t)}}class Xc extends Nr{constructor(t,i,n,r,s){super(),this.attributes=null,this.name=t,this.type=i,this.storage=n,this.access=r,this.value=s}get astNodeType(){return"var"}search(t){var i;t(this),(i=this.value)===null||i===void 0||i.search(t)}}let j1=class extends Nr{constructor(e,t,i){super(),this.attributes=null,this.name=e,this.type=t,this.value=i}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}};class WA extends Nr{constructor(t,i,n,r,s){super(),this.attributes=null,this.name=t,this.type=i,this.storage=n,this.access=r,this.value=s}get astNodeType(){return"let"}search(t){var i;t(this),(i=this.value)===null||i===void 0||i.search(t)}}class A0 extends Nr{constructor(t,i,n,r,s){super(),this.attributes=null,this.name=t,this.type=i,this.storage=n,this.access=r,this.value=s}get astNodeType(){return"const"}constEvaluate(t,i){return this.value.constEvaluate(t,i)}search(t){var i;t(this),(i=this.value)===null||i===void 0||i.search(t)}}var Od,JA,ye,ne;(e=>{e.increment="++",e.decrement="--"})(Od||(Od={})),(e=>{e.parse=function(t){const i=t;if(i=="parse")throw new Error("Invalid value for IncrementOperator");return e[i]}})(Od||(Od={}));class YS extends Nr{constructor(t,i){super(),this.operator=t,this.variable=i}get astNodeType(){return"increment"}search(t){this.variable.search(t)}}(e=>{e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="})(JA||(JA={})),(e=>{e.parse=function(t){const i=t;if(i=="parse")throw new Error("Invalid value for AssignOperator");return i}})(JA||(JA={}));class qS extends Nr{constructor(t,i,n){super(),this.operator=t,this.variable=i,this.value=n}get astNodeType(){return"assign"}search(t){this.variable.search(t),this.value.search(t)}}class H1 extends Nr{constructor(t,i){super(),this.name=t,this.args=i}get astNodeType(){return"call"}isBuiltin(){return KS.has(this.name)}search(t){for(const i of this.args)i.search(t);t(this)}}class $S extends Nr{constructor(t,i){super(),this.body=t,this.continuing=i}get astNodeType(){return"loop"}}class tI extends Nr{constructor(t,i){super(),this.condition=t,this.cases=i}get astNodeType(){return"switch"}}class eI extends Nr{constructor(t,i,n,r){super(),this.condition=t,this.body=i,this.elseif=n,this.else=r}get astNodeType(){return"if"}search(t){this.condition.search(t),this.searchBlock(this.body,t),this.searchBlock(this.elseif,t),this.searchBlock(this.else,t)}}class iI extends Nr{constructor(t){super(),this.value=t}get astNodeType(){return"return"}search(t){var i;(i=this.value)===null||i===void 0||i.search(t)}}class uH extends Nr{constructor(t){super(),this.name=t}get astNodeType(){return"enable"}}class hH extends Nr{constructor(t){super(),this.extensions=t}get astNodeType(){return"requires"}}class nI extends Nr{constructor(t,i){super(),this.severity=t,this.rule=i}get astNodeType(){return"diagnostic"}}class W1 extends Nr{constructor(t,i){super(),this.name=t,this.type=i}get astNodeType(){return"alias"}}class fH extends Nr{constructor(){super()}get astNodeType(){return"discard"}}class rI extends Nr{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class oI extends Nr{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class Ue extends Nr{constructor(t){super(),this.attributes=null,this.name=t}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(t){let i=t[0];if(i.name==="f32")return i;for(let n=1;n<t.length;++n){const r=Ue._priority.get(i.name);Ue._priority.get(t[n].name)<r&&(i=t[n])}return i.name==="x32"?Ue.i32:i}getTypeName(){return this.name}}Ue.x32=new Ue("x32"),Ue.f32=new Ue("f32"),Ue.i32=new Ue("i32"),Ue.u32=new Ue("u32"),Ue.f16=new Ue("f16"),Ue.bool=new Ue("bool"),Ue.void=new Ue("void"),Ue._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class sI extends Ue{constructor(t){super(t)}}class Kc extends Ue{constructor(t,i,n,r){super(t),this.members=i,this.startLine=n,this.endLine=r}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(t){for(let i=0;i<this.members.length;i++)if(this.members[i].name==t)return i;return-1}search(t){for(const i of this.members)t(i)}}class ue extends Ue{constructor(t,i,n){super(t),this.format=i,this.access=n}get astNodeType(){return"template"}getTypeName(){let t=this.name;if(this.format!==null){if(t==="vec2"||t==="vec3"||t==="vec4"||t==="mat2x2"||t==="mat2x3"||t==="mat2x4"||t==="mat3x2"||t==="mat3x3"||t==="mat3x4"||t==="mat4x2"||t==="mat4x3"||t==="mat4x4"){if(this.format.name==="f32")return t+="f",t;if(this.format.name==="i32")return t+="i",t;if(this.format.name==="u32")return t+="u",t;if(this.format.name==="bool")return t+="b",t;if(this.format.name==="f16")return t+="h",t}t+=`<${this.format.name}>`}else if(t==="vec2"||t==="vec3"||t==="vec4")return t;return t}}ue.vec2f=new ue("vec2",Ue.f32,null),ue.vec3f=new ue("vec3",Ue.f32,null),ue.vec4f=new ue("vec4",Ue.f32,null),ue.vec2i=new ue("vec2",Ue.i32,null),ue.vec3i=new ue("vec3",Ue.i32,null),ue.vec4i=new ue("vec4",Ue.i32,null),ue.vec2u=new ue("vec2",Ue.u32,null),ue.vec3u=new ue("vec3",Ue.u32,null),ue.vec4u=new ue("vec4",Ue.u32,null),ue.vec2h=new ue("vec2",Ue.f16,null),ue.vec3h=new ue("vec3",Ue.f16,null),ue.vec4h=new ue("vec4",Ue.f16,null),ue.vec2b=new ue("vec2",Ue.bool,null),ue.vec3b=new ue("vec3",Ue.bool,null),ue.vec4b=new ue("vec4",Ue.bool,null),ue.mat2x2f=new ue("mat2x2",Ue.f32,null),ue.mat2x3f=new ue("mat2x3",Ue.f32,null),ue.mat2x4f=new ue("mat2x4",Ue.f32,null),ue.mat3x2f=new ue("mat3x2",Ue.f32,null),ue.mat3x3f=new ue("mat3x3",Ue.f32,null),ue.mat3x4f=new ue("mat3x4",Ue.f32,null),ue.mat4x2f=new ue("mat4x2",Ue.f32,null),ue.mat4x3f=new ue("mat4x3",Ue.f32,null),ue.mat4x4f=new ue("mat4x4",Ue.f32,null),ue.mat2x2h=new ue("mat2x2",Ue.f16,null),ue.mat2x3h=new ue("mat2x3",Ue.f16,null),ue.mat2x4h=new ue("mat2x4",Ue.f16,null),ue.mat3x2h=new ue("mat3x2",Ue.f16,null),ue.mat3x3h=new ue("mat3x3",Ue.f16,null),ue.mat3x4h=new ue("mat3x4",Ue.f16,null),ue.mat4x2h=new ue("mat4x2",Ue.f16,null),ue.mat4x3h=new ue("mat4x3",Ue.f16,null),ue.mat4x4h=new ue("mat4x4",Ue.f16,null),ue.mat2x2i=new ue("mat2x2",Ue.i32,null),ue.mat2x3i=new ue("mat2x3",Ue.i32,null),ue.mat2x4i=new ue("mat2x4",Ue.i32,null),ue.mat3x2i=new ue("mat3x2",Ue.i32,null),ue.mat3x3i=new ue("mat3x3",Ue.i32,null),ue.mat3x4i=new ue("mat3x4",Ue.i32,null),ue.mat4x2i=new ue("mat4x2",Ue.i32,null),ue.mat4x3i=new ue("mat4x3",Ue.i32,null),ue.mat4x4i=new ue("mat4x4",Ue.i32,null),ue.mat2x2u=new ue("mat2x2",Ue.u32,null),ue.mat2x3u=new ue("mat2x3",Ue.u32,null),ue.mat2x4u=new ue("mat2x4",Ue.u32,null),ue.mat3x2u=new ue("mat3x2",Ue.u32,null),ue.mat3x3u=new ue("mat3x3",Ue.u32,null),ue.mat3x4u=new ue("mat3x4",Ue.u32,null),ue.mat4x2u=new ue("mat4x2",Ue.u32,null),ue.mat4x3u=new ue("mat4x3",Ue.u32,null),ue.mat4x4u=new ue("mat4x4",Ue.u32,null);class J1 extends Ue{constructor(t,i,n,r){super(t),this.storage=i,this.type=n,this.access=r}get astNodeType(){return"pointer"}}class XA extends Ue{constructor(t,i,n,r){super(t),this.attributes=i,this.format=n,this.count=r}get astNodeType(){return"array"}get isArray(){return!0}}class KA extends Ue{constructor(t,i,n){super(t),this.format=i,this.access=n}get astNodeType(){return"sampler"}}class rc extends Ja{constructor(){super(),this.postfix=null}}class Yh extends rc{constructor(t){super(),this.value=t}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class oc extends rc{constructor(t,i){super(),this.type=t,this.args=i}get astNodeType(){return"createExpr"}search(t){if(t(this),this.args)for(const i of this.args)i.search(t)}constEvaluate(t,i){return i&&(i[0]=this.type),t.evalExpression(this,t.context)}}class X1 extends rc{constructor(t,i){super(),this.cachedReturnValue=null,this.name=t,this.args=i}get astNodeType(){return"callExpr"}setCachedReturnValue(t){this.cachedReturnValue=t}get isBuiltin(){return KS.has(this.name)}constEvaluate(t,i){return t.evalExpression(this,t.context)}search(t){for(const i of this.args)i.search(t);t(this)}}class ha extends rc{constructor(t){super(),this.name=t}get astNodeType(){return"varExpr"}search(t){t(this),this.postfix&&this.postfix.search(t)}constEvaluate(t,i){return t.evalExpression(this,t.context)}}class aI extends rc{constructor(t,i){super(),this.name=t,this.initializer=i}get astNodeType(){return"constExpr"}constEvaluate(t,i){if(this.initializer){const n=t.evalExpression(this.initializer,t.context);return n!==null&&this.postfix?n.getSubData(t,this.postfix,t.context):n}return null}search(t){this.initializer.search(t)}}class Bo extends rc{constructor(t,i){super(),this.value=t,this.type=i}get astNodeType(){return"literalExpr"}constEvaluate(t,i){return i!==void 0&&(i[0]=this.type),this.value}get isScalar(){return this.value instanceof ie}get isVector(){return this.value instanceof zt||this.value instanceof on}get scalarValue(){return this.value instanceof ie?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof zt||this.value instanceof on?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class lI extends rc{constructor(t,i){super(),this.type=t,this.value=i}get astNodeType(){return"bitcastExpr"}search(t){this.value.search(t)}}class Ld extends rc{constructor(t){super(),this.index=t}search(t){this.index.search(t)}}class cI extends rc{constructor(){super()}}class Ao extends cI{constructor(t,i){super(),this.operator=t,this.right=i}get astNodeType(){return"unaryOp"}constEvaluate(t,i){return t.evalExpression(this,t.context)}search(t){this.right.search(t)}}class fl extends cI{constructor(t,i,n){super(),this.operator=t,this.left=i,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(t,i){return t.name===i.name?t:t.name==="f32"||i.name==="f32"?Ue.f32:t.name==="u32"||i.name==="u32"?Ue.u32:Ue.i32}constEvaluate(t,i){return t.evalExpression(this,t.context)}search(t){this.left.search(t),this.right.search(t)}}class uI extends Ja{constructor(t){super(),this.body=t}}class g0 extends rc{constructor(){super()}get astNodeType(){return"default"}}class hI extends uI{constructor(t,i){super(i),this.selectors=t}get astNodeType(){return"case"}search(t){this.searchBlock(this.body,t)}}class fI extends uI{constructor(t){super(t)}get astNodeType(){return"default"}search(t){this.searchBlock(this.body,t)}}class dI extends Ja{constructor(t,i,n){super(),this.name=t,this.type=i,this.attributes=n}get astNodeType(){return"argument"}}class dH extends Ja{constructor(t,i){super(),this.condition=t,this.body=i}get astNodeType(){return"elseif"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class pI extends Ja{constructor(t,i,n){super(),this.name=t,this.type=i,this.attributes=n}get astNodeType(){return"member"}}class AI extends Ja{constructor(t,i){super(),this.name=t,this.value=i}get astNodeType(){return"attribute"}}class Xa{constructor(t,i){this.parent=null,this.typeInfo=t,this.parent=i,this.id=Xa._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(t,i,n,r){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(t,i,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.name}>`}}Xa._id=0;class K1 extends Xa{constructor(){super(new Fa("void",null),null)}toString(){return"void"}}K1.void=new K1;class Fd extends Xa{constructor(t){super(new Fa("pointer",null),null),this.reference=t}clone(){return this}setDataValue(t,i,n,r){this.reference.setDataValue(t,i,n,r)}getSubData(t,i,n){return i?this.reference.getSubData(t,i,n):this}}class ie extends Xa{constructor(t,i,n=null){super(i,n),t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array?this.data=t:this.typeInfo.name==="x32"?t-Math.floor(t)!=0?this.data=new Float32Array([t]):this.data=t>=0?new Uint32Array([t]):new Int32Array([t]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([t]):this.typeInfo.name==="u32"?this.data=new Uint32Array([t]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([t]):console.error("ScalarData2: Invalid type",i)}clone(){if(this.data instanceof Float32Array)return new ie(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new ie(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new ie(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(t){this.data[0]=t}setDataValue(t,i,n,r){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(i instanceof ie))return void console.error("SetDataValue: Invalid value",i);let s=i.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?s=Math.floor(s):this.typeInfo.name==="bool"&&(s=s?1:0),this.data[0]=s}getSubData(t,i,n){return i?(console.error("getSubData: Scalar data does not support postfix",i),null):this}toString(){return`${this.value}`}}function pH(e,t,i){const n=t.length;return n===2?i==="f32"?new zt(new Float32Array(t),e.getTypeInfo("vec2f")):i==="i32"||i==="bool"?new zt(new Int32Array(t),e.getTypeInfo("vec2i")):i==="u32"?new zt(new Uint32Array(t),e.getTypeInfo("vec2u")):i==="f16"?new zt(new Float32Array(t),e.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${i}`),null):n===3?i==="f32"?new zt(new Float32Array(t),e.getTypeInfo("vec3f")):i==="i32"||i==="bool"?new zt(new Int32Array(t),e.getTypeInfo("vec3i")):i==="u32"?new zt(new Uint32Array(t),e.getTypeInfo("vec3u")):i==="f16"?new zt(new Float32Array(t),e.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${i}`),null):n===4?i==="f32"?new zt(new Float32Array(t),e.getTypeInfo("vec4f")):i==="i32"||i==="bool"?new zt(new Int32Array(t),e.getTypeInfo("vec4i")):i==="u32"?new zt(new Uint32Array(t),e.getTypeInfo("vec4u")):i==="f16"?new zt(new Float32Array(t),e.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${i}`),null):(console.error(`getSubData: Invalid vector size ${t.length}`),null)}class zt extends Xa{constructor(t,i,n=null){if(super(i,n),t instanceof Float32Array||t instanceof Uint32Array||t instanceof Int32Array)this.data=t;else{const r=this.typeInfo.name;r==="vec2f"||r==="vec3f"||r==="vec4f"?this.data=new Float32Array(t):r==="vec2i"||r==="vec3i"||r==="vec4i"?this.data=new Int32Array(t):r==="vec2u"||r==="vec3u"||r==="vec4u"?this.data=new Uint32Array(t):r==="vec2h"||r==="vec3h"||r==="vec4h"?this.data=new Float32Array(t):r==="vec2b"||r==="vec3b"||r==="vec4b"?this.data=new Int32Array(t):r==="vec2"||r==="vec3"||r==="vec4"?this.data=new Float32Array(t):console.error(`VectorData: Invalid type ${r}`)}}clone(){if(this.data instanceof Float32Array)return new zt(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new zt(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new zt(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(t,i,n,r){n instanceof Yh?console.error("TODO: Set vector postfix"):i instanceof zt?this.data=i.data:console.error("SetDataValue: Invalid value",i)}getSubData(t,i,n){if(i===null)return this;let r=t.getTypeInfo("f32");if(this.typeInfo instanceof Zh)r=this.typeInfo.format||r;else{const o=this.typeInfo.name;o==="vec2f"||o==="vec3f"||o==="vec4f"?r=t.getTypeInfo("f32"):o==="vec2i"||o==="vec3i"||o==="vec4i"?r=t.getTypeInfo("i32"):o==="vec2b"||o==="vec3b"||o==="vec4b"?r=t.getTypeInfo("bool"):o==="vec2u"||o==="vec3u"||o==="vec4u"?r=t.getTypeInfo("u32"):o==="vec2h"||o==="vec3h"||o==="vec4h"?r=t.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${o}`)}let s=this;for(;i!==null&&s!==null;){if(i instanceof Ld){const o=i.index;let l=-1;if(o instanceof Bo){if(!(o.value instanceof ie))return console.error(`GetSubData: Invalid array index ${o.value}`),null;l=o.value.value}else{const h=t.evalExpression(o,n);if(!(h instanceof ie))return console.error("GetSubData: Unknown index type",o),null;l=h.value}if(l<0||l>=s.data.length)return console.error("GetSubData: Index out of range",l),null;if(s.data instanceof Float32Array){const h=new Float32Array(s.data.buffer,s.data.byteOffset+4*l,1);return new ie(h,r)}if(s.data instanceof Int32Array){const h=new Int32Array(s.data.buffer,s.data.byteOffset+4*l,1);return new ie(h,r)}if(s.data instanceof Uint32Array){const h=new Uint32Array(s.data.buffer,s.data.byteOffset+4*l,1);return new ie(h,r)}throw"GetSubData: Invalid data type"}if(!(i instanceof Yh))return console.error("GetSubData: Unknown postfix",i),null;{const o=i.value.toLowerCase();if(o.length===1){let h=0;if(o==="x"||o==="r")h=0;else if(o==="y"||o==="g")h=1;else if(o==="z"||o==="b")h=2;else{if(o!=="w"&&o!=="a")return console.error(`GetSubData: Unknown member ${o}`),null;h=3}if(this.data instanceof Float32Array){let A=new Float32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new ie(A,r,this)}if(this.data instanceof Int32Array){let A=new Int32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new ie(A,r,this)}if(this.data instanceof Uint32Array){let A=new Uint32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new ie(A,r,this)}}const l=[];for(const h of o)h==="x"||h==="r"?l.push(this.data[0]):h==="y"||h==="g"?l.push(this.data[1]):h==="z"||h==="b"?l.push(this.data[2]):h==="w"||h==="a"?l.push(this.data[3]):console.error(`GetDataValue: Unknown member ${h}`);s=pH(t,l,r.name)}i=i.postfix}return s}toString(){let t=`${this.data[0]}`;for(let i=1;i<this.data.length;++i)t+=`, ${this.data[i]}`;return t}}class on extends Xa{constructor(t,i,n=null){super(i,n),t instanceof Float32Array?this.data=t:this.data=new Float32Array(t)}clone(){return new on(new Float32Array(this.data),this.typeInfo,null)}setDataValue(t,i,n,r){n instanceof Yh?console.error("TODO: Set matrix postfix"):i instanceof on?this.data=i.data:console.error("SetDataValue: Invalid value",i)}getSubData(t,i,n){if(i===null)return this;const r=this.typeInfo.name;if(t.getTypeInfo("f32"),this.typeInfo instanceof Zh)this.typeInfo.format;else if(r.endsWith("f"))t.getTypeInfo("f32");else if(r.endsWith("i"))t.getTypeInfo("i32");else if(r.endsWith("u"))t.getTypeInfo("u32");else{if(!r.endsWith("h"))return console.error(`GetDataValue: Unknown type ${r}`),null;t.getTypeInfo("f16")}if(i instanceof Ld){const s=i.index;let o=-1;if(s instanceof Bo){if(!(s.value instanceof ie))return console.error(`GetDataValue: Invalid array index ${s.value}`),null;o=s.value.value}else{const A=t.evalExpression(s,n);if(!(A instanceof ie))return console.error("GetDataValue: Unknown index type",s),null;o=A.value}if(o<0||o>=this.data.length)return console.error("GetDataValue: Index out of range",o),null;const l=r.endsWith("h")?"h":"f";let h;if(r==="mat2x2"||r==="mat2x2f"||r==="mat2x2h"||r==="mat3x2"||r==="mat3x2f"||r==="mat3x2h"||r==="mat4x2"||r==="mat4x2f"||r==="mat4x2h")h=new zt(new Float32Array(this.data.buffer,this.data.byteOffset+2*o*4,2),t.getTypeInfo(`vec2${l}`));else if(r==="mat2x3"||r==="mat2x3f"||r==="mat2x3h"||r==="mat3x3"||r==="mat3x3f"||r==="mat3x3h"||r==="mat4x3"||r==="mat4x3f"||r==="mat4x3h")h=new zt(new Float32Array(this.data.buffer,this.data.byteOffset+3*o*4,3),t.getTypeInfo(`vec3${l}`));else{if(r!=="mat2x4"&&r!=="mat2x4f"&&r!=="mat2x4h"&&r!=="mat3x4"&&r!=="mat3x4f"&&r!=="mat3x4h"&&r!=="mat4x4"&&r!=="mat4x4f"&&r!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${r}`),null;h=new zt(new Float32Array(this.data.buffer,this.data.byteOffset+4*o*4,4),t.getTypeInfo(`vec4${l}`))}return i.postfix?h.getSubData(t,i.postfix,n):h}return console.error("GetDataValue: Invalid postfix",i),null}toString(){let t=`${this.data[0]}`;for(let i=1;i<this.data.length;++i)t+=`, ${this.data[i]}`;return t}}class eo extends Xa{constructor(t,i,n=0,r=null){super(i,r),this.buffer=t instanceof ArrayBuffer?t:t.buffer,this.offset=n}clone(){const t=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new eo(t.buffer,this.typeInfo,0,null)}setDataValue(t,i,n,r){if(i===null)return void console.log("setDataValue: NULL data.");let s=this.offset,o=this.typeInfo;for(;n;){if(n instanceof Ld)if(o instanceof Xu){const l=n.index;if(l instanceof Bo){if(!(l.value instanceof ie))return void console.error(`SetDataValue: Invalid index type ${l.value}`);s+=l.value.value*o.stride}else{const h=t.evalExpression(l,r);if(!(h instanceof ie))return void console.error("SetDataValue: Unknown index type",l);s+=h.value*o.stride}o=o.format}else console.error(`SetDataValue: Type ${o.getTypeName()} is not an array`);else{if(!(n instanceof Yh))return void console.error("SetDataValue: Unknown postfix type",n);{const l=n.value;if(o instanceof Ju){let h=!1;for(const A of o.members)if(A.name===l){s+=A.offset,o=A.type,h=!0;break}if(!h)return void console.error(`SetDataValue: Member ${l} not found`)}else if(o instanceof Fa){const h=o.getTypeName();let A=0;if(l==="x"||l==="r")A=0;else if(l==="y"||l==="g")A=1;else if(l==="z"||l==="b")A=2;else{if(l!=="w"&&l!=="a")return void console.error(`SetDataValue: Unknown member ${l}`);A=3}if(!(i instanceof ie))return void console.error("SetDataValue: Invalid value",i);const v=i.value;return h==="vec2f"?void(new Float32Array(this.buffer,s,2)[A]=v):h==="vec3f"?void(new Float32Array(this.buffer,s,3)[A]=v):h==="vec4f"?void(new Float32Array(this.buffer,s,4)[A]=v):h==="vec2i"?void(new Int32Array(this.buffer,s,2)[A]=v):h==="vec3i"?void(new Int32Array(this.buffer,s,3)[A]=v):h==="vec4i"?void(new Int32Array(this.buffer,s,4)[A]=v):h==="vec2u"?void(new Uint32Array(this.buffer,s,2)[A]=v):h==="vec3u"?void(new Uint32Array(this.buffer,s,3)[A]=v):h==="vec4u"?void(new Uint32Array(this.buffer,s,4)[A]=v):void console.error(`SetDataValue: Type ${h} is not a struct`)}}}n=n.postfix}this.setData(t,i,o,s,r)}setData(t,i,n,r,s){const o=n.getTypeName();if(o!=="f32"&&o!=="f16")if(o!=="i32"&&o!=="atomic<i32>"&&o!=="x32")if(o!=="u32"&&o!=="atomic<u32>")if(o!=="bool")if(o!=="vec2f"&&o!=="vec2h")if(o!=="vec3f"&&o!=="vec3h")if(o!=="vec4f"&&o!=="vec4h")if(o!=="vec2i")if(o!=="vec3i")if(o!=="vec4i")if(o!=="vec2u")if(o!=="vec3u")if(o!=="vec4u")if(o!=="vec2b")if(o!=="vec3b")if(o!=="vec4b")if(o!=="mat2x2f"&&o!=="mat2x2h")if(o!=="mat2x3f"&&o!=="mat2x3h")if(o!=="mat2x4f"&&o!=="mat2x4h")if(o!=="mat3x2f"&&o!=="mat3x2h")if(o!=="mat3x3f"&&o!=="mat3x3h")if(o!=="mat3x4f"&&o!=="mat3x4h")if(o!=="mat4x2f"&&o!=="mat4x2h")if(o!=="mat4x3f"&&o!=="mat4x3h")if(o!=="mat4x4f"&&o!=="mat4x4h")if(i instanceof eo){if(n===i.typeInfo)return void new Uint8Array(this.buffer,r,i.buffer.byteLength).set(new Uint8Array(i.buffer));console.error("SetDataValue: Type mismatch",o,i.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${o}`);else{const l=new Float32Array(this.buffer,r,16);i instanceof on?(l[0]=i.data[0],l[1]=i.data[1],l[2]=i.data[2],l[3]=i.data[3],l[4]=i.data[4],l[5]=i.data[5],l[6]=i.data[6],l[7]=i.data[7],l[8]=i.data[8],l[9]=i.data[9],l[10]=i.data[10],l[11]=i.data[11],l[12]=i.data[12],l[13]=i.data[13],l[14]=i.data[14],l[15]=i.data[15]):(l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3],l[4]=i[4],l[5]=i[5],l[6]=i[6],l[7]=i[7],l[8]=i[8],l[9]=i[9],l[10]=i[10],l[11]=i[11],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15])}else{const l=new Float32Array(this.buffer,r,12);i instanceof on?(l[0]=i.data[0],l[1]=i.data[1],l[2]=i.data[2],l[3]=i.data[3],l[4]=i.data[4],l[5]=i.data[5],l[6]=i.data[6],l[7]=i.data[7],l[8]=i.data[8],l[9]=i.data[9],l[10]=i.data[10],l[11]=i.data[11]):(l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3],l[4]=i[4],l[5]=i[5],l[6]=i[6],l[7]=i[7],l[8]=i[8],l[9]=i[9],l[10]=i[10],l[11]=i[11])}else{const l=new Float32Array(this.buffer,r,8);i instanceof on?(l[0]=i.data[0],l[1]=i.data[1],l[2]=i.data[2],l[3]=i.data[3],l[4]=i.data[4],l[5]=i.data[5],l[6]=i.data[6],l[7]=i.data[7]):(l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3],l[4]=i[4],l[5]=i[5],l[6]=i[6],l[7]=i[7])}else{const l=new Float32Array(this.buffer,r,12);i instanceof on?(l[0]=i.data[0],l[1]=i.data[1],l[2]=i.data[2],l[3]=i.data[3],l[4]=i.data[4],l[5]=i.data[5],l[6]=i.data[6],l[7]=i.data[7],l[8]=i.data[8],l[9]=i.data[9],l[10]=i.data[10],l[11]=i.data[11]):(l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3],l[4]=i[4],l[5]=i[5],l[6]=i[6],l[7]=i[7],l[8]=i[8],l[9]=i[9],l[10]=i[10],l[11]=i[11])}else{const l=new Float32Array(this.buffer,r,9);i instanceof on?(l[0]=i.data[0],l[1]=i.data[1],l[2]=i.data[2],l[3]=i.data[3],l[4]=i.data[4],l[5]=i.data[5],l[6]=i.data[6],l[7]=i.data[7],l[8]=i.data[8]):(l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3],l[4]=i[4],l[5]=i[5],l[6]=i[6],l[7]=i[7],l[8]=i[8])}else{const l=new Float32Array(this.buffer,r,6);i instanceof on?(l[0]=i.data[0],l[1]=i.data[1],l[2]=i.data[2],l[3]=i.data[3],l[4]=i.data[4],l[5]=i.data[5]):(l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3],l[4]=i[4],l[5]=i[5])}else{const l=new Float32Array(this.buffer,r,8);i instanceof on?(l[0]=i.data[0],l[1]=i.data[1],l[2]=i.data[2],l[3]=i.data[3],l[4]=i.data[4],l[5]=i.data[5],l[6]=i.data[6],l[7]=i.data[7]):(l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3],l[4]=i[4],l[5]=i[5],l[6]=i[6],l[7]=i[7])}else{const l=new Float32Array(this.buffer,r,6);i instanceof on?(l[0]=i.data[0],l[1]=i.data[1],l[2]=i.data[2],l[3]=i.data[3],l[4]=i.data[4],l[5]=i.data[5]):(l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3],l[4]=i[4],l[5]=i[5])}else{const l=new Float32Array(this.buffer,r,4);i instanceof on?(l[0]=i.data[0],l[1]=i.data[1],l[2]=i.data[2],l[3]=i.data[3]):(l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3])}else{const l=new Uint32Array(this.buffer,r,4);i instanceof zt?(l[0]=i.data[0],l[1]=i.data[1],l[2]=i.data[2],l[3]=i.data[3]):(l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3])}else{const l=new Uint32Array(this.buffer,r,3);i instanceof zt?(l[0]=i.data[0],l[1]=i.data[1],l[2]=i.data[2]):(l[0]=i[0],l[1]=i[1],l[2]=i[2])}else{const l=new Uint32Array(this.buffer,r,2);i instanceof zt?(l[0]=i.data[0],l[1]=i.data[1]):(l[0]=i[0],l[1]=i[1])}else{const l=new Uint32Array(this.buffer,r,4);i instanceof zt?(l[0]=i.data[0],l[1]=i.data[1],l[2]=i.data[2],l[3]=i.data[3]):(l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3])}else{const l=new Uint32Array(this.buffer,r,3);i instanceof zt?(l[0]=i.data[0],l[1]=i.data[1],l[2]=i.data[2]):(l[0]=i[0],l[1]=i[1],l[2]=i[2])}else{const l=new Uint32Array(this.buffer,r,2);i instanceof zt?(l[0]=i.data[0],l[1]=i.data[1]):(l[0]=i[0],l[1]=i[1])}else{const l=new Int32Array(this.buffer,r,4);i instanceof zt?(l[0]=i.data[0],l[1]=i.data[1],l[2]=i.data[2],l[3]=i.data[3]):(l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3])}else{const l=new Int32Array(this.buffer,r,3);i instanceof zt?(l[0]=i.data[0],l[1]=i.data[1],l[2]=i.data[2]):(l[0]=i[0],l[1]=i[1],l[2]=i[2])}else{const l=new Int32Array(this.buffer,r,2);i instanceof zt?(l[0]=i.data[0],l[1]=i.data[1]):(l[0]=i[0],l[1]=i[1])}else{const l=new Float32Array(this.buffer,r,4);i instanceof zt?(l[0]=i.data[0],l[1]=i.data[1],l[2]=i.data[2],l[3]=i.data[3]):(l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3])}else{const l=new Float32Array(this.buffer,r,3);i instanceof zt?(l[0]=i.data[0],l[1]=i.data[1],l[2]=i.data[2]):(l[0]=i[0],l[1]=i[1],l[2]=i[2])}else{const l=new Float32Array(this.buffer,r,2);i instanceof zt?(l[0]=i.data[0],l[1]=i.data[1]):(l[0]=i[0],l[1]=i[1])}else i instanceof ie&&(new Int32Array(this.buffer,r,1)[0]=i.value);else i instanceof ie&&(new Uint32Array(this.buffer,r,1)[0]=i.value);else i instanceof ie&&(new Int32Array(this.buffer,r,1)[0]=i.value);else i instanceof ie&&(new Float32Array(this.buffer,r,1)[0]=i.value)}getSubData(t,i,n){var r,s,o;if(i===null)return this;let l=this.offset,h=this.typeInfo;for(;i;){if(i instanceof Ld){const v=i.index,C=t.evalExpression(v,n);let S=0;if(C instanceof ie?S=C.value:console.error("GetDataValue: Invalid index type",v),h instanceof Xu)l+=S*h.stride,h=h.format;else{const L=h.getTypeName();L==="mat4x4"||L==="mat4x4f"||L==="mat4x4h"?(l+=16*S,h=t.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${h.getTypeName()} is not an array`)}}else{if(!(i instanceof Yh))return console.error("GetDataValue: Unknown postfix type",i),null;{const v=i.value;if(h instanceof Ju){let C=!1;for(const S of h.members)if(S.name===v){l+=S.offset,h=S.type,C=!0;break}if(!C)return console.error(`GetDataValue: Member ${v} not found`),null}else if(h instanceof Fa){const C=h.getTypeName();if(C==="vec2f"||C==="vec3f"||C==="vec4f"||C==="vec2i"||C==="vec3i"||C==="vec4i"||C==="vec2u"||C==="vec3u"||C==="vec4u"||C==="vec2b"||C==="vec3b"||C==="vec4b"||C==="vec2h"||C==="vec3h"||C==="vec4h"||C==="vec2"||C==="vec3"||C==="vec4"){if(v.length>0&&v.length<5){let S="f";const L=[];for(let N=0;N<v.length;++N){const G=v[N].toLowerCase();let W=0;if(G==="x"||G==="r")W=0;else if(G==="y"||G==="g")W=1;else if(G==="z"||G==="b")W=2;else{if(G!=="w"&&G!=="a")return console.error(`Unknown member ${v}`),null;W=3}if(v.length===1){if(C.endsWith("f"))return this.buffer.byteLength<l+4*W+4?(console.log("Insufficient buffer data"),null):new ie(new Float32Array(this.buffer,l+4*W,1),t.getTypeInfo("f32"),this);if(C.endsWith("h"))return new ie(new Float32Array(this.buffer,l+4*W,1),t.getTypeInfo("f16"),this);if(C.endsWith("i"))return new ie(new Int32Array(this.buffer,l+4*W,1),t.getTypeInfo("i32"),this);if(C.endsWith("b"))return new ie(new Int32Array(this.buffer,l+4*W,1),t.getTypeInfo("bool"),this);if(C.endsWith("u"))return new ie(new Uint32Array(this.buffer,l+4*W,1),t.getTypeInfo("i32"),this)}if(C==="vec2f")L.push(new Float32Array(this.buffer,l,2)[W]);else if(C==="vec3f"){if(l+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const j=new Float32Array(this.buffer,l,3);L.push(j[W])}else if(C==="vec4f")L.push(new Float32Array(this.buffer,l,4)[W]);else if(C==="vec2i")S="i",L.push(new Int32Array(this.buffer,l,2)[W]);else if(C==="vec3i")S="i",L.push(new Int32Array(this.buffer,l,3)[W]);else if(C==="vec4i")S="i",L.push(new Int32Array(this.buffer,l,4)[W]);else if(C==="vec2u"){S="u";const j=new Uint32Array(this.buffer,l,2);L.push(j[W])}else C==="vec3u"?(S="u",L.push(new Uint32Array(this.buffer,l,3)[W])):C==="vec4u"&&(S="u",L.push(new Uint32Array(this.buffer,l,4)[W]))}return L.length===2?h=t.getTypeInfo(`vec2${S}`):L.length===3?h=t.getTypeInfo(`vec3${S}`):L.length===4?h=t.getTypeInfo(`vec4${S}`):console.error(`GetDataValue: Invalid vector length ${L.length}`),new zt(L,h,null)}return console.error(`GetDataValue: Unknown member ${v}`),null}return console.error(`GetDataValue: Type ${C} is not a struct`),null}}}i=i.postfix}const A=h.getTypeName();return A==="f32"?new ie(new Float32Array(this.buffer,l,1),h,this):A==="i32"?new ie(new Int32Array(this.buffer,l,1),h,this):A==="u32"?new ie(new Uint32Array(this.buffer,l,1),h,this):A==="vec2f"?new zt(new Float32Array(this.buffer,l,2),h,this):A==="vec3f"?new zt(new Float32Array(this.buffer,l,3),h,this):A==="vec4f"?new zt(new Float32Array(this.buffer,l,4),h,this):A==="vec2i"?new zt(new Int32Array(this.buffer,l,2),h,this):A==="vec3i"?new zt(new Int32Array(this.buffer,l,3),h,this):A==="vec4i"?new zt(new Int32Array(this.buffer,l,4),h,this):A==="vec2u"?new zt(new Uint32Array(this.buffer,l,2),h,this):A==="vec3u"?new zt(new Uint32Array(this.buffer,l,3),h,this):A==="vec4u"?new zt(new Uint32Array(this.buffer,l,4),h,this):h instanceof Zh&&h.name==="atomic"?((r=h.format)===null||r===void 0?void 0:r.name)==="u32"?new ie(new Uint32Array(this.buffer,l,1)[0],h.format,this):((s=h.format)===null||s===void 0?void 0:s.name)==="i32"?new ie(new Int32Array(this.buffer,l,1)[0],h.format,this):(console.error(`GetDataValue: Invalid atomic format ${(o=h.format)===null||o===void 0?void 0:o.name}`),null):new eo(this.buffer,h,l,this)}toString(){let t="";if(this.typeInfo instanceof Xu)if(this.typeInfo.format.name==="f32"){const i=new Float32Array(this.buffer,this.offset);t=`[${i[0]}`;for(let n=1;n<i.length;++n)t+=`, ${i[n]}`}else if(this.typeInfo.format.name==="i32"){const i=new Int32Array(this.buffer,this.offset);t=`[${i[0]}`;for(let n=1;n<i.length;++n)t+=`, ${i[n]}`}else if(this.typeInfo.format.name==="u32"){const i=new Uint32Array(this.buffer,this.offset);t=`[${i[0]}`;for(let n=1;n<i.length;++n)t+=`, ${i[n]}`}else if(this.typeInfo.format.name==="vec2f"){const i=new Float32Array(this.buffer,this.offset);t=`[${i[0]}, ${i[1]}]`;for(let n=1;n<i.length/2;++n)t+=`, [${i[2*n]}, ${i[2*n+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const i=new Float32Array(this.buffer,this.offset);t=`[${i[0]}, ${i[1]}, ${i[2]}]`;for(let n=4;n<i.length;n+=4)t+=`, [${i[n]}, ${i[n+1]}, ${i[n+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const i=new Float32Array(this.buffer,this.offset);t=`[${i[0]}, ${i[1]}, ${i[2]}, ${i[3]}]`;for(let n=4;n<i.length;n+=4)t+=`, [${i[n]}, ${i[n+1]}, ${i[n+2]}, ${i[n+3]}]`}else t="[...]";else this.typeInfo instanceof Ju?t+="{...}":t="[...]";return t}}class uu extends Xa{constructor(t,i,n,r){super(i,null),this.data=t,this.descriptor=n,this.view=r}clone(){return new uu(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var t,i;const n=this.descriptor.size;return n instanceof Array&&n.length>0?(t=n[0])!==null&&t!==void 0?t:0:n instanceof Object&&(i=n.width)!==null&&i!==void 0?i:0}get height(){var t,i;const n=this.descriptor.size;return n instanceof Array&&n.length>1?(t=n[1])!==null&&t!==void 0?t:0:n instanceof Object&&(i=n.height)!==null&&i!==void 0?i:0}get depthOrArrayLayers(){var t,i;const n=this.descriptor.size;return n instanceof Array&&n.length>2?(t=n[2])!==null&&t!==void 0?t:0:n instanceof Object&&(i=n.depthOrArrayLayers)!==null&&i!==void 0?i:0}get format(){var t;return this.descriptor&&(t=this.descriptor.format)!==null&&t!==void 0?t:"rgba8unorm"}get sampleCount(){var t;return this.descriptor&&(t=this.descriptor.sampleCount)!==null&&t!==void 0?t:1}get mipLevelCount(){var t;return this.descriptor&&(t=this.descriptor.mipLevelCount)!==null&&t!==void 0?t:1}get dimension(){var t;return this.descriptor&&(t=this.descriptor.dimension)!==null&&t!==void 0?t:"2d"}getMipLevelSize(t){if(t>=this.mipLevelCount)return[0,0,0];const i=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<i.length;++n)i[n]=Math.max(1,i[n]>>t);return i}get texelByteSize(){const t=this.format,i=z1[t];return i?i.isDepthStencil?4:i.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const t=this.format,i=z1[t];return!!i&&i.isDepthStencil}getGpuSize(){const t=this.format,i=z1[t],n=this.width;if(!t||n<=0||!i)return-1;const r=this.height,s=this.depthOrArrayLayers,o=this.dimension;return n/i.blockWidth*(o==="1d"?1:r/i.blockHeight)*i.bytesPerBlock*s}getPixel(t,i,n=0,r=0){const s=this.texelByteSize,o=this.bytesPerRow,l=this.height,h=this.data[r];return lH(new Uint8Array(h),t,i,n,r,l,o,s,this.format)}setPixel(t,i,n,r,s){const o=this.texelByteSize,l=this.bytesPerRow,h=this.height,A=this.data[r];(function(v,C,S,L,N,G,W,j,q,Z){const K=L*(W>>=N)*(G>>=N)+S*W+C*j;switch(q){case"r8unorm":return void nr(v,K,"8unorm",1,Z);case"r8snorm":return void nr(v,K,"8snorm",1,Z);case"r8uint":return void nr(v,K,"8uint",1,Z);case"r8sint":return void nr(v,K,"8sint",1,Z);case"rg8unorm":return void nr(v,K,"8unorm",2,Z);case"rg8snorm":return void nr(v,K,"8snorm",2,Z);case"rg8uint":return void nr(v,K,"8uint",2,Z);case"rg8sint":return void nr(v,K,"8sint",2,Z);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void nr(v,K,"8unorm",4,Z);case"rgba8snorm":return void nr(v,K,"8snorm",4,Z);case"rgba8uint":return void nr(v,K,"8uint",4,Z);case"rgba8sint":return void nr(v,K,"8sint",4,Z);case"r16uint":return void nr(v,K,"16uint",1,Z);case"r16sint":return void nr(v,K,"16sint",1,Z);case"r16float":return void nr(v,K,"16float",1,Z);case"rg16uint":return void nr(v,K,"16uint",2,Z);case"rg16sint":return void nr(v,K,"16sint",2,Z);case"rg16float":return void nr(v,K,"16float",2,Z);case"rgba16uint":return void nr(v,K,"16uint",4,Z);case"rgba16sint":return void nr(v,K,"16sint",4,Z);case"rgba16float":return void nr(v,K,"16float",4,Z);case"r32uint":return void nr(v,K,"32uint",1,Z);case"r32sint":return void nr(v,K,"32sint",1,Z);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void nr(v,K,"32float",1,Z);case"rg32uint":return void nr(v,K,"32uint",2,Z);case"rg32sint":return void nr(v,K,"32sint",2,Z);case"rg32float":return void nr(v,K,"32float",2,Z);case"rgba32uint":return void nr(v,K,"32uint",4,Z);case"rgba32sint":return void nr(v,K,"32sint",4,Z);case"rgba32float":return void nr(v,K,"32float",4,Z);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(A),t,i,n,r,h,l,o,this.format,s)}}(e=>{e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"})(ne||(ne={}));class oe{constructor(t,i,n){this.name=t,this.type=i,this.rule=n}toString(){return this.name}}class Ot{}ye=Ot,Ot.none=new oe("",ne.reserved,""),Ot.eof=new oe("EOF",ne.token,""),Ot.reserved={asm:new oe("asm",ne.reserved,"asm"),bf16:new oe("bf16",ne.reserved,"bf16"),do:new oe("do",ne.reserved,"do"),enum:new oe("enum",ne.reserved,"enum"),f16:new oe("f16",ne.reserved,"f16"),f64:new oe("f64",ne.reserved,"f64"),handle:new oe("handle",ne.reserved,"handle"),i8:new oe("i8",ne.reserved,"i8"),i16:new oe("i16",ne.reserved,"i16"),i64:new oe("i64",ne.reserved,"i64"),mat:new oe("mat",ne.reserved,"mat"),premerge:new oe("premerge",ne.reserved,"premerge"),regardless:new oe("regardless",ne.reserved,"regardless"),typedef:new oe("typedef",ne.reserved,"typedef"),u8:new oe("u8",ne.reserved,"u8"),u16:new oe("u16",ne.reserved,"u16"),u64:new oe("u64",ne.reserved,"u64"),unless:new oe("unless",ne.reserved,"unless"),using:new oe("using",ne.reserved,"using"),vec:new oe("vec",ne.reserved,"vec"),void:new oe("void",ne.reserved,"void")},Ot.keywords={array:new oe("array",ne.keyword,"array"),atomic:new oe("atomic",ne.keyword,"atomic"),bool:new oe("bool",ne.keyword,"bool"),f32:new oe("f32",ne.keyword,"f32"),i32:new oe("i32",ne.keyword,"i32"),mat2x2:new oe("mat2x2",ne.keyword,"mat2x2"),mat2x3:new oe("mat2x3",ne.keyword,"mat2x3"),mat2x4:new oe("mat2x4",ne.keyword,"mat2x4"),mat3x2:new oe("mat3x2",ne.keyword,"mat3x2"),mat3x3:new oe("mat3x3",ne.keyword,"mat3x3"),mat3x4:new oe("mat3x4",ne.keyword,"mat3x4"),mat4x2:new oe("mat4x2",ne.keyword,"mat4x2"),mat4x3:new oe("mat4x3",ne.keyword,"mat4x3"),mat4x4:new oe("mat4x4",ne.keyword,"mat4x4"),ptr:new oe("ptr",ne.keyword,"ptr"),sampler:new oe("sampler",ne.keyword,"sampler"),sampler_comparison:new oe("sampler_comparison",ne.keyword,"sampler_comparison"),struct:new oe("struct",ne.keyword,"struct"),texture_1d:new oe("texture_1d",ne.keyword,"texture_1d"),texture_2d:new oe("texture_2d",ne.keyword,"texture_2d"),texture_2d_array:new oe("texture_2d_array",ne.keyword,"texture_2d_array"),texture_3d:new oe("texture_3d",ne.keyword,"texture_3d"),texture_cube:new oe("texture_cube",ne.keyword,"texture_cube"),texture_cube_array:new oe("texture_cube_array",ne.keyword,"texture_cube_array"),texture_multisampled_2d:new oe("texture_multisampled_2d",ne.keyword,"texture_multisampled_2d"),texture_storage_1d:new oe("texture_storage_1d",ne.keyword,"texture_storage_1d"),texture_storage_2d:new oe("texture_storage_2d",ne.keyword,"texture_storage_2d"),texture_storage_2d_array:new oe("texture_storage_2d_array",ne.keyword,"texture_storage_2d_array"),texture_storage_3d:new oe("texture_storage_3d",ne.keyword,"texture_storage_3d"),texture_depth_2d:new oe("texture_depth_2d",ne.keyword,"texture_depth_2d"),texture_depth_2d_array:new oe("texture_depth_2d_array",ne.keyword,"texture_depth_2d_array"),texture_depth_cube:new oe("texture_depth_cube",ne.keyword,"texture_depth_cube"),texture_depth_cube_array:new oe("texture_depth_cube_array",ne.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new oe("texture_depth_multisampled_2d",ne.keyword,"texture_depth_multisampled_2d"),texture_external:new oe("texture_external",ne.keyword,"texture_external"),u32:new oe("u32",ne.keyword,"u32"),vec2:new oe("vec2",ne.keyword,"vec2"),vec3:new oe("vec3",ne.keyword,"vec3"),vec4:new oe("vec4",ne.keyword,"vec4"),bitcast:new oe("bitcast",ne.keyword,"bitcast"),block:new oe("block",ne.keyword,"block"),break:new oe("break",ne.keyword,"break"),case:new oe("case",ne.keyword,"case"),continue:new oe("continue",ne.keyword,"continue"),continuing:new oe("continuing",ne.keyword,"continuing"),default:new oe("default",ne.keyword,"default"),diagnostic:new oe("diagnostic",ne.keyword,"diagnostic"),discard:new oe("discard",ne.keyword,"discard"),else:new oe("else",ne.keyword,"else"),enable:new oe("enable",ne.keyword,"enable"),fallthrough:new oe("fallthrough",ne.keyword,"fallthrough"),false:new oe("false",ne.keyword,"false"),fn:new oe("fn",ne.keyword,"fn"),for:new oe("for",ne.keyword,"for"),function:new oe("function",ne.keyword,"function"),if:new oe("if",ne.keyword,"if"),let:new oe("let",ne.keyword,"let"),const:new oe("const",ne.keyword,"const"),loop:new oe("loop",ne.keyword,"loop"),while:new oe("while",ne.keyword,"while"),private:new oe("private",ne.keyword,"private"),read:new oe("read",ne.keyword,"read"),read_write:new oe("read_write",ne.keyword,"read_write"),return:new oe("return",ne.keyword,"return"),requires:new oe("requires",ne.keyword,"requires"),storage:new oe("storage",ne.keyword,"storage"),switch:new oe("switch",ne.keyword,"switch"),true:new oe("true",ne.keyword,"true"),alias:new oe("alias",ne.keyword,"alias"),type:new oe("type",ne.keyword,"type"),uniform:new oe("uniform",ne.keyword,"uniform"),var:new oe("var",ne.keyword,"var"),override:new oe("override",ne.keyword,"override"),workgroup:new oe("workgroup",ne.keyword,"workgroup"),write:new oe("write",ne.keyword,"write"),r8unorm:new oe("r8unorm",ne.keyword,"r8unorm"),r8snorm:new oe("r8snorm",ne.keyword,"r8snorm"),r8uint:new oe("r8uint",ne.keyword,"r8uint"),r8sint:new oe("r8sint",ne.keyword,"r8sint"),r16uint:new oe("r16uint",ne.keyword,"r16uint"),r16sint:new oe("r16sint",ne.keyword,"r16sint"),r16float:new oe("r16float",ne.keyword,"r16float"),rg8unorm:new oe("rg8unorm",ne.keyword,"rg8unorm"),rg8snorm:new oe("rg8snorm",ne.keyword,"rg8snorm"),rg8uint:new oe("rg8uint",ne.keyword,"rg8uint"),rg8sint:new oe("rg8sint",ne.keyword,"rg8sint"),r32uint:new oe("r32uint",ne.keyword,"r32uint"),r32sint:new oe("r32sint",ne.keyword,"r32sint"),r32float:new oe("r32float",ne.keyword,"r32float"),rg16uint:new oe("rg16uint",ne.keyword,"rg16uint"),rg16sint:new oe("rg16sint",ne.keyword,"rg16sint"),rg16float:new oe("rg16float",ne.keyword,"rg16float"),rgba8unorm:new oe("rgba8unorm",ne.keyword,"rgba8unorm"),rgba8unorm_srgb:new oe("rgba8unorm_srgb",ne.keyword,"rgba8unorm_srgb"),rgba8snorm:new oe("rgba8snorm",ne.keyword,"rgba8snorm"),rgba8uint:new oe("rgba8uint",ne.keyword,"rgba8uint"),rgba8sint:new oe("rgba8sint",ne.keyword,"rgba8sint"),bgra8unorm:new oe("bgra8unorm",ne.keyword,"bgra8unorm"),bgra8unorm_srgb:new oe("bgra8unorm_srgb",ne.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new oe("rgb10a2unorm",ne.keyword,"rgb10a2unorm"),rg11b10float:new oe("rg11b10float",ne.keyword,"rg11b10float"),rg32uint:new oe("rg32uint",ne.keyword,"rg32uint"),rg32sint:new oe("rg32sint",ne.keyword,"rg32sint"),rg32float:new oe("rg32float",ne.keyword,"rg32float"),rgba16uint:new oe("rgba16uint",ne.keyword,"rgba16uint"),rgba16sint:new oe("rgba16sint",ne.keyword,"rgba16sint"),rgba16float:new oe("rgba16float",ne.keyword,"rgba16float"),rgba32uint:new oe("rgba32uint",ne.keyword,"rgba32uint"),rgba32sint:new oe("rgba32sint",ne.keyword,"rgba32sint"),rgba32float:new oe("rgba32float",ne.keyword,"rgba32float"),static_assert:new oe("static_assert",ne.keyword,"static_assert")},Ot.tokens={decimal_float_literal:new oe("decimal_float_literal",ne.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new oe("hex_float_literal",ne.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new oe("int_literal",ne.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new oe("uint_literal",ne.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new oe("name",ne.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new oe("ident",ne.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new oe("and",ne.token,"&"),and_and:new oe("and_and",ne.token,"&&"),arrow:new oe("arrow ",ne.token,"->"),attr:new oe("attr",ne.token,"@"),forward_slash:new oe("forward_slash",ne.token,"/"),bang:new oe("bang",ne.token,"!"),bracket_left:new oe("bracket_left",ne.token,"["),bracket_right:new oe("bracket_right",ne.token,"]"),brace_left:new oe("brace_left",ne.token,"{"),brace_right:new oe("brace_right",ne.token,"}"),colon:new oe("colon",ne.token,":"),comma:new oe("comma",ne.token,","),equal:new oe("equal",ne.token,"="),equal_equal:new oe("equal_equal",ne.token,"=="),not_equal:new oe("not_equal",ne.token,"!="),greater_than:new oe("greater_than",ne.token,">"),greater_than_equal:new oe("greater_than_equal",ne.token,">="),shift_right:new oe("shift_right",ne.token,">>"),less_than:new oe("less_than",ne.token,"<"),less_than_equal:new oe("less_than_equal",ne.token,"<="),shift_left:new oe("shift_left",ne.token,"<<"),modulo:new oe("modulo",ne.token,"%"),minus:new oe("minus",ne.token,"-"),minus_minus:new oe("minus_minus",ne.token,"--"),period:new oe("period",ne.token,"."),plus:new oe("plus",ne.token,"+"),plus_plus:new oe("plus_plus",ne.token,"++"),or:new oe("or",ne.token,"|"),or_or:new oe("or_or",ne.token,"||"),paren_left:new oe("paren_left",ne.token,"("),paren_right:new oe("paren_right",ne.token,")"),semicolon:new oe("semicolon",ne.token,";"),star:new oe("star",ne.token,"*"),tilde:new oe("tilde",ne.token,"~"),underscore:new oe("underscore",ne.token,"_"),xor:new oe("xor",ne.token,"^"),plus_equal:new oe("plus_equal",ne.token,"+="),minus_equal:new oe("minus_equal",ne.token,"-="),times_equal:new oe("times_equal",ne.token,"*="),division_equal:new oe("division_equal",ne.token,"/="),modulo_equal:new oe("modulo_equal",ne.token,"%="),and_equal:new oe("and_equal",ne.token,"&="),or_equal:new oe("or_equal",ne.token,"|="),xor_equal:new oe("xor_equal",ne.token,"^="),shift_right_equal:new oe("shift_right_equal",ne.token,">>="),shift_left_equal:new oe("shift_left_equal",ne.token,"<<=")},Ot.simpleTokens={"@":ye.tokens.attr,"{":ye.tokens.brace_left,"}":ye.tokens.brace_right,":":ye.tokens.colon,",":ye.tokens.comma,"(":ye.tokens.paren_left,")":ye.tokens.paren_right,";":ye.tokens.semicolon},Ot.literalTokens={"&":ye.tokens.and,"&&":ye.tokens.and_and,"->":ye.tokens.arrow,"/":ye.tokens.forward_slash,"!":ye.tokens.bang,"[":ye.tokens.bracket_left,"]":ye.tokens.bracket_right,"=":ye.tokens.equal,"==":ye.tokens.equal_equal,"!=":ye.tokens.not_equal,">":ye.tokens.greater_than,">=":ye.tokens.greater_than_equal,">>":ye.tokens.shift_right,"<":ye.tokens.less_than,"<=":ye.tokens.less_than_equal,"<<":ye.tokens.shift_left,"%":ye.tokens.modulo,"-":ye.tokens.minus,"--":ye.tokens.minus_minus,".":ye.tokens.period,"+":ye.tokens.plus,"++":ye.tokens.plus_plus,"|":ye.tokens.or,"||":ye.tokens.or_or,"*":ye.tokens.star,"~":ye.tokens.tilde,_:ye.tokens.underscore,"^":ye.tokens.xor,"+=":ye.tokens.plus_equal,"-=":ye.tokens.minus_equal,"*=":ye.tokens.times_equal,"/=":ye.tokens.division_equal,"%=":ye.tokens.modulo_equal,"&=":ye.tokens.and_equal,"|=":ye.tokens.or_equal,"^=":ye.tokens.xor_equal,">>=":ye.tokens.shift_right_equal,"<<=":ye.tokens.shift_left_equal},Ot.regexTokens={decimal_float_literal:ye.tokens.decimal_float_literal,hex_float_literal:ye.tokens.hex_float_literal,int_literal:ye.tokens.int_literal,uint_literal:ye.tokens.uint_literal,ident:ye.tokens.ident},Ot.storage_class=[ye.keywords.function,ye.keywords.private,ye.keywords.workgroup,ye.keywords.uniform,ye.keywords.storage],Ot.access_mode=[ye.keywords.read,ye.keywords.write,ye.keywords.read_write],Ot.sampler_type=[ye.keywords.sampler,ye.keywords.sampler_comparison],Ot.sampled_texture_type=[ye.keywords.texture_1d,ye.keywords.texture_2d,ye.keywords.texture_2d_array,ye.keywords.texture_3d,ye.keywords.texture_cube,ye.keywords.texture_cube_array],Ot.multisampled_texture_type=[ye.keywords.texture_multisampled_2d],Ot.storage_texture_type=[ye.keywords.texture_storage_1d,ye.keywords.texture_storage_2d,ye.keywords.texture_storage_2d_array,ye.keywords.texture_storage_3d],Ot.depth_texture_type=[ye.keywords.texture_depth_2d,ye.keywords.texture_depth_2d_array,ye.keywords.texture_depth_cube,ye.keywords.texture_depth_cube_array,ye.keywords.texture_depth_multisampled_2d],Ot.texture_external_type=[ye.keywords.texture_external],Ot.any_texture_type=[...ye.sampled_texture_type,...ye.multisampled_texture_type,...ye.storage_texture_type,...ye.depth_texture_type,...ye.texture_external_type],Ot.texel_format=[ye.keywords.r8unorm,ye.keywords.r8snorm,ye.keywords.r8uint,ye.keywords.r8sint,ye.keywords.r16uint,ye.keywords.r16sint,ye.keywords.r16float,ye.keywords.rg8unorm,ye.keywords.rg8snorm,ye.keywords.rg8uint,ye.keywords.rg8sint,ye.keywords.r32uint,ye.keywords.r32sint,ye.keywords.r32float,ye.keywords.rg16uint,ye.keywords.rg16sint,ye.keywords.rg16float,ye.keywords.rgba8unorm,ye.keywords.rgba8unorm_srgb,ye.keywords.rgba8snorm,ye.keywords.rgba8uint,ye.keywords.rgba8sint,ye.keywords.bgra8unorm,ye.keywords.bgra8unorm_srgb,ye.keywords.rgb10a2unorm,ye.keywords.rg11b10float,ye.keywords.rg32uint,ye.keywords.rg32sint,ye.keywords.rg32float,ye.keywords.rgba16uint,ye.keywords.rgba16sint,ye.keywords.rgba16float,ye.keywords.rgba32uint,ye.keywords.rgba32sint,ye.keywords.rgba32float],Ot.const_literal=[ye.tokens.int_literal,ye.tokens.uint_literal,ye.tokens.decimal_float_literal,ye.tokens.hex_float_literal,ye.keywords.true,ye.keywords.false],Ot.literal_or_ident=[ye.tokens.ident,ye.tokens.int_literal,ye.tokens.uint_literal,ye.tokens.decimal_float_literal,ye.tokens.hex_float_literal,ye.tokens.name],Ot.element_count_expression=[ye.tokens.int_literal,ye.tokens.uint_literal,ye.tokens.ident],Ot.template_types=[ye.keywords.vec2,ye.keywords.vec3,ye.keywords.vec4,ye.keywords.mat2x2,ye.keywords.mat2x3,ye.keywords.mat2x4,ye.keywords.mat3x2,ye.keywords.mat3x3,ye.keywords.mat3x4,ye.keywords.mat4x2,ye.keywords.mat4x3,ye.keywords.mat4x4,ye.keywords.atomic,ye.keywords.bitcast,...ye.any_texture_type],Ot.attribute_name=[ye.tokens.ident,ye.keywords.block,ye.keywords.diagnostic],Ot.assignment_operators=[ye.tokens.equal,ye.tokens.plus_equal,ye.tokens.minus_equal,ye.tokens.times_equal,ye.tokens.division_equal,ye.tokens.modulo_equal,ye.tokens.and_equal,ye.tokens.or_equal,ye.tokens.xor_equal,ye.tokens.shift_right_equal,ye.tokens.shift_left_equal],Ot.increment_operators=[ye.tokens.plus_plus,ye.tokens.minus_minus];class gI{constructor(t,i,n,r,s){this.type=t,this.lexeme=i,this.line=n,this.start=r,this.end=s}toString(){return this.lexeme}isTemplateType(){return Ot.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==Ot.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class AH{constructor(t){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=t??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new gI(Ot.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let t=this._advance();if(t==`
`)return this._line++,!0;if(this._isWhitespace(t))return!0;if(t=="/"){if(this._peekAhead()=="/"){for(;t!=`
`;){if(this._isAtEnd())return!0;t=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(t=this._advance(),t==`
`)this._line++;else if(t=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else t=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const i=Ot.simpleTokens[t];if(i)return this._addToken(i),!0;let n=Ot.none;const r=this._isAlpha(t),s=t==="_";if(this._isAlphaNumeric(t)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)t+=this._advance(),o=this._peekAhead()}if(r){const o=Ot.keywords[t];if(o)return this._addToken(o),!0}if(r||s)return this._addToken(Ot.tokens.ident),!0;for(;;){let o=this._findType(t);const l=this._peekAhead();if(t=="-"&&this._tokens.length>0){if(l=="=")return this._current++,t+=l,this._addToken(Ot.tokens.minus_equal),!0;if(l=="-")return this._current++,t+=l,this._addToken(Ot.tokens.minus_minus),!0;const h=this._tokens.length-1;if((Ot.literal_or_ident.indexOf(this._tokens[h].type)!=-1||this._tokens[h].type==Ot.tokens.paren_right)&&l!=">")return this._addToken(o),!0}if(t==">"&&(l==">"||l=="=")){let h=!1,A=this._tokens.length-1;for(let v=0;v<5&&A>=0&&Ot.assignment_operators.indexOf(this._tokens[A].type)===-1;++v,--A)if(this._tokens[A].type===Ot.tokens.less_than){A>0&&this._tokens[A-1].isArrayOrTemplateType()&&(h=!0);break}if(h)return this._addToken(o),!0}if(o===Ot.none){let h=t,A=0;const v=2;for(let C=0;C<v;++C)if(h+=this._peekAhead(C),o=this._findType(h),o!==Ot.none){A=C;break}if(o===Ot.none)return n!==Ot.none&&(this._current--,this._addToken(n),!0);t=h,this._current+=A+1}if(n=o,this._isAtEnd())break;t+=this._advance()}return n!==Ot.none&&(this._addToken(n),!0)}_findType(t){for(const i in Ot.regexTokens){const n=Ot.regexTokens[i];if(this._match(t,n.rule))return n}return Ot.literalTokens[t]||Ot.none}_match(t,i){const n=i.exec(t);return n&&n.index==0&&n[0]==t}_isAtEnd(){return this._current>=this._source.length}_isAlpha(t){return!this._isNumeric(t)&&!this._isWhitespace(t)&&t!=="_"&&t!=="."&&t!=="("&&t!==")"&&t!=="["&&t!=="]"&&t!=="{"&&t!=="}"&&t!==","&&t!==";"&&t!==":"&&t!=="="&&t!=="!"&&t!=="<"&&t!==">"&&t!=="+"&&t!=="-"&&t!=="*"&&t!=="/"&&t!=="%"&&t!=="&"&&t!=="|"&&t!=="^"&&t!=="~"&&t!=="@"&&t!=="#"&&t!=="?"&&t!=="'"&&t!=="`"&&t!=='"'&&t!=="\\"&&t!==`
`&&t!=="\r"&&t!=="	"&&t!=="\0"}_isNumeric(t){return t>="0"&&t<="9"}_isAlphaNumeric(t){return this._isAlpha(t)||this._isNumeric(t)||t==="_"}_isWhitespace(t){return t==" "||t=="	"||t=="\r"}_advance(t=0){let i=this._source[this._current];return t=t||0,t++,this._current+=t,i}_peekAhead(t=0){return t=t||0,this._current+t>=this._source.length?"\0":this._source[this._current+t]}_addToken(t){const i=this._source.substring(this._start,this._current);this._tokens.push(new gI(t,i,this._line,this._start,this._current))}}function gi(e){return Array.isArray(e)||(e==null?void 0:e.buffer)instanceof ArrayBuffer}const m0=new Float32Array(1),gH=new Uint32Array(m0.buffer),mH=new Uint32Array(m0.buffer),y0=new Int32Array(1),yH=new Float32Array(y0.buffer),_H=new Uint32Array(y0.buffer),_0=new Uint32Array(1),vH=new Float32Array(_0.buffer),bH=new Int32Array(_0.buffer);function mI(e,t,i){if(t===i)return e;if(t==="f32"){if(i==="i32"||i==="x32")return m0[0]=e,gH[0];if(i==="u32")return m0[0]=e,mH[0]}else if(t==="i32"||t==="x32"){if(i==="f32")return y0[0]=e,yH[0];if(i==="u32")return y0[0]=e,_H[0]}else if(t==="u32"){if(i==="f32")return _0[0]=e,vH[0];if(i==="i32"||i==="x32")return _0[0]=e,bH[0]}return console.error(`Unsupported cast from ${t} to ${i}`),e}class xH{constructor(t){this.resources=null,this.inUse=!1,this.info=null,this.node=t}}class v0{constructor(t,i){this.align=t,this.size=i}}class bc{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new oH,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(t){return t.name=="texture_storage_1d"||t.name=="texture_storage_2d"||t.name=="texture_storage_2d_array"||t.name=="texture_storage_3d"}updateAST(t){for(const i of t)i instanceof HA&&this._functions.set(i.name,new xH(i));for(const i of t)if(i instanceof Kc){const n=this.getTypeInfo(i,null);n instanceof Ju&&this.structs.push(n)}for(const i of t)if(i instanceof W1)this.aliases.push(this._getAliasInfo(i));else if(i instanceof j1){const n=i,r=this._getAttributeNum(n.attributes,"id",0),s=n.type!=null?this.getTypeInfo(n.type,n.attributes):null;this.overrides.push(new iH(n.name,s,n.attributes,r))}else if(this._isUniformVar(i)){const n=i,r=this._getAttributeNum(n.attributes,"group",0),s=this._getAttributeNum(n.attributes,"binding",0),o=this.getTypeInfo(n.type,n.attributes),l=new f0(n.name,o,r,s,n.attributes,Ku.Uniform,n.access);l.access||(l.access="read"),this.uniforms.push(l)}else if(this._isStorageVar(i)){const n=i,r=this._getAttributeNum(n.attributes,"group",0),s=this._getAttributeNum(n.attributes,"binding",0),o=this.getTypeInfo(n.type,n.attributes),l=this._isStorageTexture(o),h=new f0(n.name,o,r,s,n.attributes,l?Ku.StorageTexture:Ku.Storage,n.access);h.access||(h.access="read"),this.storage.push(h)}else if(this._isTextureVar(i)){const n=i,r=this._getAttributeNum(n.attributes,"group",0),s=this._getAttributeNum(n.attributes,"binding",0),o=this.getTypeInfo(n.type,n.attributes),l=this._isStorageTexture(o),h=new f0(n.name,o,r,s,n.attributes,l?Ku.StorageTexture:Ku.Texture,n.access);h.access||(h.access="read"),l?this.storage.push(h):this.textures.push(h)}else if(this._isSamplerVar(i)){const n=i,r=this._getAttributeNum(n.attributes,"group",0),s=this._getAttributeNum(n.attributes,"binding",0),o=this.getTypeInfo(n.type,n.attributes),l=new f0(n.name,o,r,s,n.attributes,Ku.Sampler,n.access);this.samplers.push(l)}else if(i instanceof HA){const n=this._getAttribute(i,"vertex"),r=this._getAttribute(i,"fragment"),s=this._getAttribute(i,"compute"),o=n||r||s,l=new rH(i.name,o==null?void 0:o.name,i.attributes);l.attributes=i.attributes,l.startLine=i.startLine,l.endLine=i.endLine,this.functions.push(l),this._functions.get(i.name).info=l,o&&(this._functions.get(i.name).inUse=!0,l.inUse=!0,l.resources=this._findResources(i,!!o),l.inputs=this._getInputs(i.args),l.outputs=this._getOutputs(i.returnType),this.entry[o.name].push(l)),l.arguments=i.args.map(h=>new nH(h.name,this.getTypeInfo(h.type,h.attributes),h.attributes)),l.returnType=i.returnType?this.getTypeInfo(i.returnType,i.attributes):null}for(const i of this._functions.values())i.info&&(i.info.inUse=i.inUse,this._addCalls(i.node,i.info.calls));for(const i of this._functions.values())i.node.search(n=>{var r,s,o;if(n instanceof AI){if(n.value)if(gi(n.value))for(const l of n.value)for(const h of this.overrides)l===h.name&&((r=i.info)===null||r===void 0||r.overrides.push(h));else for(const l of this.overrides)n.value===l.name&&((s=i.info)===null||s===void 0||s.overrides.push(l))}else if(n instanceof ha)for(const l of this.overrides)n.name===l.name&&((o=i.info)===null||o===void 0||o.overrides.push(l))});for(const i of this.uniforms)this._markStructsInUse(i.type);for(const i of this.storage)this._markStructsInUse(i.type)}getStructInfo(t){for(const i of this.structs)if(i.name==t)return i;return null}getOverrideInfo(t){for(const i of this.overrides)if(i.name==t)return i;return null}_markStructsInUse(t){if(t)if(t.isStruct){if(t.inUse=!0,t.members)for(const i of t.members)this._markStructsInUse(i.type)}else if(t.isArray)this._markStructsInUse(t.format);else if(t.isTemplate)t.format&&this._markStructsInUse(t.format);else{const i=this._getAlias(t.name);i&&this._markStructsInUse(i)}}_addCalls(t,i){var n;for(const r of t.calls){const s=(n=this._functions.get(r.name))===null||n===void 0?void 0:n.info;s&&i.add(s)}}findResource(t,i,n){if(n){for(const r of this.entry.compute)if(r.name===n){for(const s of r.resources)if(s.group==t&&s.binding==i)return s}for(const r of this.entry.vertex)if(r.name===n){for(const s of r.resources)if(s.group==t&&s.binding==i)return s}for(const r of this.entry.fragment)if(r.name===n){for(const s of r.resources)if(s.group==t&&s.binding==i)return s}}for(const r of this.uniforms)if(r.group==t&&r.binding==i)return r;for(const r of this.storage)if(r.group==t&&r.binding==i)return r;for(const r of this.textures)if(r.group==t&&r.binding==i)return r;for(const r of this.samplers)if(r.group==t&&r.binding==i)return r;return null}_findResource(t){for(const i of this.uniforms)if(i.name==t)return i;for(const i of this.storage)if(i.name==t)return i;for(const i of this.textures)if(i.name==t)return i;for(const i of this.samplers)if(i.name==t)return i;return null}_markStructsFromAST(t){const i=this.getTypeInfo(t,null);this._markStructsInUse(i)}_findResources(t,i){const n=[],r=this,s=[];return t.search(o=>{if(o instanceof d0)s.push({});else if(o instanceof p0)s.pop();else if(o instanceof Xc){const l=o;i&&l.type!==null&&this._markStructsFromAST(l.type),s.length>0&&(s[s.length-1][l.name]=l)}else if(o instanceof oc){const l=o;i&&l.type!==null&&this._markStructsFromAST(l.type)}else if(o instanceof WA){const l=o;i&&l.type!==null&&this._markStructsFromAST(l.type),s.length>0&&(s[s.length-1][l.name]=l)}else if(o instanceof ha){const l=o;if(s.length>0&&s[s.length-1][l.name])return;const h=r._findResource(l.name);h&&n.push(h)}else if(o instanceof X1){const l=o,h=r._functions.get(l.name);h&&(i&&(h.inUse=!0),t.calls.add(h.node),h.resources===null&&(h.resources=r._findResources(h.node,i)),n.push(...h.resources))}else if(o instanceof H1){const l=o,h=r._functions.get(l.name);h&&(i&&(h.inUse=!0),t.calls.add(h.node),h.resources===null&&(h.resources=r._findResources(h.node,i)),n.push(...h.resources))}}),[...new Map(n.map(o=>[o.name,o])).values()]}getBindGroups(){const t=[];function i(n,r){n>=t.length&&(t.length=n+1),t[n]===void 0&&(t[n]=[]),r>=t[n].length&&(t[n].length=r+1)}for(const n of this.uniforms)i(n.group,n.binding),t[n.group][n.binding]=n;for(const n of this.storage)i(n.group,n.binding),t[n.group][n.binding]=n;for(const n of this.textures)i(n.group,n.binding),t[n.group][n.binding]=n;for(const n of this.samplers)i(n.group,n.binding),t[n.group][n.binding]=n;return t}_getOutputs(t,i=void 0){if(i===void 0&&(i=[]),t instanceof Kc)this._getStructOutputs(t,i);else{const n=this._getOutputInfo(t);n!==null&&i.push(n)}return i}_getStructOutputs(t,i){for(const n of t.members)if(n.type instanceof Kc)this._getStructOutputs(n.type,i);else{const r=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(r!==null){const s=this.getTypeInfo(n.type,n.type.attributes),o=this._parseInt(r.value),l=new HS(n.name,s,r.name,o);i.push(l)}}}_getOutputInfo(t){const i=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(i!==null){const n=this.getTypeInfo(t,t.attributes),r=this._parseInt(i.value);return new HS("",n,i.name,r)}return null}_getInputs(t,i=void 0){i===void 0&&(i=[]);for(const n of t)if(n.type instanceof Kc)this._getStructInputs(n.type,i);else{const r=this._getInputInfo(n);r!==null&&i.push(r)}return i}_getStructInputs(t,i){for(const n of t.members)if(n.type instanceof Kc)this._getStructInputs(n.type,i);else{const r=this._getInputInfo(n);r!==null&&i.push(r)}}_getInputInfo(t){const i=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(i!==null){const n=this._getAttribute(t,"interpolation"),r=this.getTypeInfo(t.type,t.attributes),s=this._parseInt(i.value),o=new eH(t.name,r,i.name,s);return n!==null&&(o.interpolation=this._parseString(n.value)),o}return null}_parseString(t){return t instanceof Array&&(t=t[0]),t}_parseInt(t){t instanceof Array&&(t=t[0]);const i=parseInt(t);return isNaN(i)?t:i}_getAlias(t){for(const i of this.aliases)if(i.name==t)return i.type;return null}_getAliasInfo(t){return new tH(t.name,this.getTypeInfo(t.type,null))}getTypeInfoByName(t){for(const i of this.structs)if(i.name==t)return i;for(const i of this.aliases)if(i.name==t)return i.type;return null}getTypeInfo(t,i=null){if(this._types.has(t))return this._types.get(t);if(t instanceof XA){const r=t,s=r.format?this.getTypeInfo(r.format,r.attributes):null,o=new Xu(r.name,i);return o.format=s,o.count=r.count,this._types.set(t,o),this._updateTypeInfo(o),o}if(t instanceof Kc){const r=t,s=new Ju(r.name,i);s.startLine=r.startLine,s.endLine=r.endLine;for(const o of r.members){const l=this.getTypeInfo(o.type,o.attributes);s.members.push(new jS(o.name,l,o.attributes))}return this._types.set(t,s),this._updateTypeInfo(s),s}if(t instanceof KA){const r=t,s=r.format instanceof Ue,o=r.format?s?this.getTypeInfo(r.format,null):new Fa(r.format,null):null,l=new Zh(r.name,o,i,r.access);return this._types.set(t,l),this._updateTypeInfo(l),l}if(t instanceof ue){const r=t,s=r.format?this.getTypeInfo(r.format,null):null,o=new Zh(r.name,s,i,r.access);return this._types.set(t,o),this._updateTypeInfo(o),o}const n=new Fa(t.name,i);return this._types.set(t,n),this._updateTypeInfo(n),n}_updateTypeInfo(t){var i,n,r;const s=this._getTypeSize(t);if(t.size=(i=s==null?void 0:s.size)!==null&&i!==void 0?i:0,t instanceof Xu&&t.format){const o=this._getTypeSize(t.format);t.stride=Math.max((n=o==null?void 0:o.size)!==null&&n!==void 0?n:0,(r=o==null?void 0:o.align)!==null&&r!==void 0?r:0),this._updateTypeInfo(t.format)}t instanceof Ju&&this._updateStructInfo(t)}_updateStructInfo(t){var i;let n=0,r=0,s=0,o=0;for(let l=0,h=t.members.length;l<h;++l){const A=t.members[l],v=this._getTypeSize(A);if(!v)continue;(i=this._getAlias(A.type.name))!==null&&i!==void 0||A.type;const C=v.align,S=v.size;n=this._roundUp(C,n+r),r=S,s=n,o=Math.max(o,C),A.offset=n,A.size=S,this._updateTypeInfo(A.type)}t.size=this._roundUp(o,s+r),t.align=o}_getTypeSize(t){var i,n;if(t==null)return null;const r=this._getAttributeNum(t.attributes,"size",0),s=this._getAttributeNum(t.attributes,"align",0);if(t instanceof jS&&(t=t.type),t instanceof Fa){const o=this._getAlias(t.name);o!==null&&(t=o)}{const o=bc._typeInfo[t.name];if(o!==void 0){const l=((i=t.format)===null||i===void 0?void 0:i.name)==="f16"?2:1;return new v0(Math.max(s,o.align/l),Math.max(r,o.size/l))}}{const o=bc._typeInfo[t.name.substring(0,t.name.length-1)];if(o){const l=t.name[t.name.length-1]==="h"?2:1;return new v0(Math.max(s,o.align/l),Math.max(r,o.size/l))}}if(t instanceof Xu){let o=t,l=8,h=8;const A=this._getTypeSize(o.format);return A!==null&&(h=A.size,l=A.align),h=o.count*this._getAttributeNum((n=t==null?void 0:t.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(l,h)),r&&(h=r),new v0(Math.max(s,l),Math.max(r,h))}if(t instanceof Ju){let o=0,l=0,h=0,A=0,v=0;for(const C of t.members){const S=this._getTypeSize(C.type);S!==null&&(o=Math.max(S.align,o),h=this._roundUp(S.align,h+A),A=S.size,v=h)}return l=this._roundUp(o,v+A),new v0(Math.max(s,o),Math.max(r,l))}return null}_isUniformVar(t){return t instanceof Xc&&t.storage=="uniform"}_isStorageVar(t){return t instanceof Xc&&t.storage=="storage"}_isTextureVar(t){return t instanceof Xc&&t.type!==null&&bc._textureTypes.indexOf(t.type.name)!=-1}_isSamplerVar(t){return t instanceof Xc&&t.type!==null&&bc._samplerTypes.indexOf(t.type.name)!=-1}_getAttribute(t,i){const n=t;if(!n||!n.attributes)return null;const r=n.attributes;for(let s of r)if(s.name==i)return s;return null}_getAttributeNum(t,i,n){if(t===null)return n;for(let r of t)if(r.name==i){let s=r!==null&&r.value!==null?r.value:n;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):n}return n}_roundUp(t,i){return Math.ceil(i/t)*t}}bc._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},bc._textureTypes=Ot.any_texture_type.map(e=>e.name),bc._samplerTypes=Ot.sampler_type.map(e=>e.name);class jE{constructor(t,i,n){this.name=t,this.value=i,this.node=n}clone(){return new jE(this.name,this.value,this.node)}}class HE{constructor(t){this.name=t.name,this.node=t}clone(){return new HE(this.node)}}class WE{constructor(t){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",t&&(this.parent=t,this.currentFunctionName=t.currentFunctionName)}getVariable(t){var i;return this.variables.has(t)?(i=this.variables.get(t))!==null&&i!==void 0?i:null:this.parent?this.parent.getVariable(t):null}getFunction(t){var i;return this.functions.has(t)?(i=this.functions.get(t))!==null&&i!==void 0?i:null:this.parent?this.parent.getFunction(t):null}createVariable(t,i,n){this.variables.set(t,new jE(t,i,n??null))}setVariable(t,i,n){const r=this.getVariable(t);r!==null?r.value=i:this.createVariable(t,i,n)}getVariableValue(t){var i;const n=this.getVariable(t);return(i=n==null?void 0:n.value)!==null&&i!==void 0?i:null}clone(){return new WE(this)}}class wH{evalExpression(t,i){return null}getTypeInfo(t){return null}getVariableName(t,i){return""}}class CH{constructor(t){this.exec=t}getTypeInfo(t){return this.exec.getTypeInfo(t)}All(t,i){const n=this.exec.evalExpression(t.args[0],i);let r=!0;if(n instanceof zt)return n.data.forEach(s=>{s||(r=!1)}),new ie(r?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${t.line}`)}Any(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt){const r=n.data.some(s=>s);return new ie(r?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${t.line}`)}Select(t,i){const n=this.exec.evalExpression(t.args[2],i);if(!(n instanceof ie))throw new Error(`Select() expects a bool condition. Line ${t.line}`);return n.value?this.exec.evalExpression(t.args[1],i):this.exec.evalExpression(t.args[0],i)}ArrayLength(t,i){let n=t.args[0];n instanceof Ao&&(n=n.right);const r=this.exec.evalExpression(n,i);if(r instanceof eo&&r.typeInfo.size===0){const s=r.typeInfo,o=r.buffer.byteLength/s.stride;return new ie(o,this.getTypeInfo("u32"))}return new ie(r.typeInfo.size,this.getTypeInfo("u32"))}Abs(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.abs(s)),n.typeInfo);const r=n;return new ie(Math.abs(r.value),r.typeInfo)}Acos(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.acos(s)),n.typeInfo);const r=n;return new ie(Math.acos(r.value),n.typeInfo)}Acosh(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.acosh(s)),n.typeInfo);const r=n;return new ie(Math.acosh(r.value),n.typeInfo)}Asin(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.asin(s)),n.typeInfo);const r=n;return new ie(Math.asin(r.value),n.typeInfo)}Asinh(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.asinh(s)),n.typeInfo);const r=n;return new ie(Math.asinh(r.value),n.typeInfo)}Atan(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.atan(s)),n.typeInfo);const r=n;return new ie(Math.atan(r.value),n.typeInfo)}Atanh(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.atanh(s)),n.typeInfo);const r=n;return new ie(Math.atanh(r.value),n.typeInfo)}Atan2(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i);if(n instanceof zt&&r instanceof zt)return new zt(n.data.map((l,h)=>Math.atan2(l,r.data[h])),n.typeInfo);const s=n,o=r;return new ie(Math.atan2(s.value,o.value),n.typeInfo)}Ceil(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.ceil(s)),n.typeInfo);const r=n;return new ie(Math.ceil(r.value),n.typeInfo)}_clamp(t,i,n){return Math.min(Math.max(t,i),n)}Clamp(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i),s=this.exec.evalExpression(t.args[2],i);if(n instanceof zt&&r instanceof zt&&s instanceof zt)return new zt(n.data.map((A,v)=>this._clamp(A,r.data[v],s.data[v])),n.typeInfo);const o=n,l=r,h=s;return new ie(this._clamp(o.value,l.value,h.value),n.typeInfo)}Cos(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.cos(s)),n.typeInfo);const r=n;return new ie(Math.cos(r.value),n.typeInfo)}Cosh(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.cosh(s)),n.typeInfo);const r=n;return new ie(Math.cos(r.value),n.typeInfo)}CountLeadingZeros(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.clz32(s)),n.typeInfo);const r=n;return new ie(Math.clz32(r.value),n.typeInfo)}_countOneBits(t){let i=0;for(;t!==0;)1&t&&i++,t>>=1;return i}CountOneBits(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>this._countOneBits(s)),n.typeInfo);const r=n;return new ie(this._countOneBits(r.value),n.typeInfo)}_countTrailingZeros(t){if(t===0)return 32;let i=0;for(;!(1&t);)t>>=1,i++;return i}CountTrailingZeros(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>this._countTrailingZeros(s)),n.typeInfo);const r=n;return new ie(this._countTrailingZeros(r.value),n.typeInfo)}Cross(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i);if(n instanceof zt&&r instanceof zt){if(n.data.length!==3||r.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${t.line}`),null;const s=n.data,o=r.data;return new zt([s[1]*o[2]-o[1]*s[2],s[2]*o[0]-o[2]*s[0],s[0]*o[1]-o[0]*s[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${t.line}`),null}Degrees(t,i){const n=this.exec.evalExpression(t.args[0],i),r=180/Math.PI;return n instanceof zt?new zt(n.data.map(s=>s*r),n.typeInfo):new ie(n.value*r,this.getTypeInfo("f32"))}Determinant(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof on){const r=n.data,s=n.typeInfo.getTypeName(),o=s.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h")return new ie(r[0]*r[3]-r[1]*r[2],o);if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h")return new ie(r[0]*(r[4]*r[8]-r[5]*r[7])-r[1]*(r[3]*r[8]-r[5]*r[6])+r[2]*(r[3]*r[7]-r[4]*r[6]),o);if(s==="mat2x4"||s==="mat2x4f"||s==="mat2x4h")console.error(`TODO: Determinant for ${s}`);else if(s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h")console.error(`TODO: Determinant for ${s}`);else{if(s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h")return new ie(r[0]*(r[4]*r[8]-r[5]*r[7])-r[1]*(r[3]*r[8]-r[5]*r[6])+r[2]*(r[3]*r[7]-r[4]*r[6]),o);s==="mat3x4"||s==="mat3x4f"||s==="mat3x4h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h"?console.error(`TODO: Determinant for ${s}`):s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h"||console.error(`TODO: Determinant for ${s}`)}}return console.error(`Determinant expects a matrix argument. Line ${t.line}`),null}Distance(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i);if(n instanceof zt&&r instanceof zt){let l=0;for(let h=0;h<n.data.length;++h)l+=(n.data[h]-r.data[h])*(n.data[h]-r.data[h]);return new ie(Math.sqrt(l),this.getTypeInfo("f32"))}const s=n,o=r;return new ie(Math.abs(s.value-o.value),n.typeInfo)}_dot(t,i){let n=0;for(let r=0;r<t.length;++r)n+=i[r]*t[r];return n}Dot(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i);return n instanceof zt&&r instanceof zt?new ie(this._dot(n.data,r.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${t.line}`),null)}Dot4U8Packed(t,i){return console.error(`TODO: dot4U8Packed. Line ${t.line}`),null}Dot4I8Packed(t,i){return console.error(`TODO: dot4I8Packed. Line ${t.line}`),null}Exp(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.exp(s)),n.typeInfo);const r=n;return new ie(Math.exp(r.value),n.typeInfo)}Exp2(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.pow(2,s)),n.typeInfo);const r=n;return new ie(Math.pow(2,r.value),n.typeInfo)}ExtractBits(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i),s=this.exec.evalExpression(t.args[2],i);if(r.typeInfo.name!=="u32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${t.line}`),null;if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${t.line}`),null;const o=r.value,l=s.value;if(n instanceof zt)return new zt(n.data.map(A=>A>>o&(1<<l)-1),n.typeInfo);if(n.typeInfo.name!=="i32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${t.line}`),null;const h=n.value;return new ie(h>>o&(1<<l)-1,this.getTypeInfo("i32"))}FaceForward(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i),s=this.exec.evalExpression(t.args[2],i);if(n instanceof zt&&r instanceof zt&&s instanceof zt){const o=this._dot(r.data,s.data);return new zt(o<0?Array.from(n.data):n.data.map(l=>-l),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${t.line}`),null}_firstLeadingBit(t){return t===0?-1:31-Math.clz32(t)}FirstLeadingBit(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>this._firstLeadingBit(s)),n.typeInfo);const r=n;return new ie(this._firstLeadingBit(r.value),n.typeInfo)}_firstTrailingBit(t){return t===0?-1:Math.log2(t&-t)}FirstTrailingBit(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>this._firstTrailingBit(s)),n.typeInfo);const r=n;return new ie(this._firstTrailingBit(r.value),n.typeInfo)}Floor(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.floor(s)),n.typeInfo);const r=n;return new ie(Math.floor(r.value),n.typeInfo)}Fma(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i),s=this.exec.evalExpression(t.args[2],i);if(n instanceof zt&&r instanceof zt&&s instanceof zt)return n.data.length!==r.data.length||n.data.length!==s.data.length?(console.error(`Fma() expects vectors of the same length. Line ${t.line}`),null):new zt(n.data.map((A,v)=>A*r.data[v]+s.data[v]),n.typeInfo);const o=n,l=r,h=s;return new ie(o.value*l.value+h.value,o.typeInfo)}Fract(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>s-Math.floor(s)),n.typeInfo);const r=n;return new ie(r.value-Math.floor(r.value),n.typeInfo)}Frexp(t,i){return console.error(`TODO: frexp. Line ${t.line}`),null}InsertBits(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i),s=this.exec.evalExpression(t.args[2],i),o=this.exec.evalExpression(t.args[3],i);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${t.line}`),null;const l=s.value,h=(1<<o.value)-1<<l,A=~h;if(n instanceof zt&&r instanceof zt)return new zt(n.data.map((S,L)=>S&A|r.data[L]<<l&h),n.typeInfo);const v=n.value,C=r.value;return new ie(v&A|C<<l&h,n.typeInfo)}InverseSqrt(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>1/Math.sqrt(s)),n.typeInfo);const r=n;return new ie(1/Math.sqrt(r.value),n.typeInfo)}Ldexp(t,i){return console.error(`TODO: ldexp. Line ${t.line}`),null}Length(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt){let s=0;return n.data.forEach(o=>{s+=o*o}),new ie(Math.sqrt(s),this.getTypeInfo("f32"))}const r=n;return new ie(Math.abs(r.value),n.typeInfo)}Log(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.log(s)),n.typeInfo);const r=n;return new ie(Math.log(r.value),n.typeInfo)}Log2(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.log2(s)),n.typeInfo);const r=n;return new ie(Math.log2(r.value),n.typeInfo)}Max(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i);if(n instanceof zt&&r instanceof zt)return new zt(n.data.map((l,h)=>Math.max(l,r.data[h])),n.typeInfo);const s=n,o=r;return new ie(Math.max(s.value,o.value),n.typeInfo)}Min(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i);if(n instanceof zt&&r instanceof zt)return new zt(n.data.map((l,h)=>Math.min(l,r.data[h])),n.typeInfo);const s=n,o=r;return new ie(Math.min(s.value,o.value),n.typeInfo)}Mix(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i),s=this.exec.evalExpression(t.args[2],i);if(n instanceof zt&&r instanceof zt&&s instanceof zt)return new zt(n.data.map((h,A)=>n.data[A]*(1-s.data[A])+r.data[A]*s.data[A]),n.typeInfo);const o=r,l=s;return new ie(n.value*(1-l.value)+o.value*l.value,n.typeInfo)}Modf(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i);if(n instanceof zt&&r instanceof zt)return new zt(n.data.map((o,l)=>o%r.data[l]),n.typeInfo);const s=r;return new ie(n.value%s.value,n.typeInfo)}Normalize(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt){const r=this.Length(t,i).value;return new zt(n.data.map(s=>s/r),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${t.line}`),null}Pow(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i);if(n instanceof zt&&r instanceof zt)return new zt(n.data.map((l,h)=>Math.pow(l,r.data[h])),n.typeInfo);const s=n,o=r;return new ie(Math.pow(s.value,o.value),n.typeInfo)}QuantizeToF16(t,i){const n=this.exec.evalExpression(t.args[0],i);return n instanceof zt?new zt(n.data.map(r=>r),n.typeInfo):new ie(n.value,n.typeInfo)}Radians(t,i){const n=this.exec.evalExpression(t.args[0],i);return n instanceof zt?new zt(n.data.map(r=>r*Math.PI/180),n.typeInfo):new ie(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(t,i){let n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i);if(n instanceof zt&&r instanceof zt){const s=this._dot(n.data,r.data);return new zt(n.data.map((o,l)=>o-2*s*r.data[l]),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${t.line}`),null}Refract(t,i){let n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i),s=this.exec.evalExpression(t.args[2],i);if(n instanceof zt&&r instanceof zt&&s instanceof ie){const o=this._dot(r.data,n.data);return new zt(n.data.map((l,h)=>{const A=1-s.value*s.value*(1-o*o);if(A<0)return 0;const v=Math.sqrt(A);return s.value*l-(s.value*o+v)*r.data[h]}),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${t.line}`),null}ReverseBits(t,i){return console.error(`TODO: reverseBits. Line ${t.line}`),null}Round(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.round(s)),n.typeInfo);const r=n;return new ie(Math.round(r.value),n.typeInfo)}Saturate(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.min(Math.max(s,0),1)),n.typeInfo);const r=n;return new ie(Math.min(Math.max(r.value,0),1),n.typeInfo)}Sign(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.sign(s)),n.typeInfo);const r=n;return new ie(Math.sign(r.value),n.typeInfo)}Sin(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.sin(s)),n.typeInfo);const r=n;return new ie(Math.sin(r.value),n.typeInfo)}Sinh(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.sinh(s)),n.typeInfo);const r=n;return new ie(Math.sinh(r.value),n.typeInfo)}_smoothstep(t,i,n){const r=Math.min(Math.max((n-t)/(i-t),0),1);return r*r*(3-2*r)}SmoothStep(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i),s=this.exec.evalExpression(t.args[2],i);if(s instanceof zt&&n instanceof zt&&r instanceof zt)return new zt(s.data.map((A,v)=>this._smoothstep(n.data[v],r.data[v],A)),s.typeInfo);const o=n,l=r,h=s;return new ie(this._smoothstep(o.value,l.value,h.value),s.typeInfo)}Sqrt(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.sqrt(s)),n.typeInfo);const r=n;return new ie(Math.sqrt(r.value),n.typeInfo)}Step(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i);if(r instanceof zt&&n instanceof zt)return new zt(r.data.map((o,l)=>o<n.data[l]?0:1),r.typeInfo);const s=n;return new ie(r.value<s.value?0:1,s.typeInfo)}Tan(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.tan(s)),n.typeInfo);const r=n;return new ie(Math.tan(r.value),n.typeInfo)}Tanh(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.tanh(s)),n.typeInfo);const r=n;return new ie(Math.tanh(r.value),n.typeInfo)}_getTransposeType(t){const i=t.getTypeName();return i==="mat2x2f"||i==="mat2x2h"?t:i==="mat2x3f"?this.getTypeInfo("mat3x2f"):i==="mat2x3h"?this.getTypeInfo("mat3x2h"):i==="mat2x4f"?this.getTypeInfo("mat4x2f"):i==="mat2x4h"?this.getTypeInfo("mat4x2h"):i==="mat3x2f"?this.getTypeInfo("mat2x3f"):i==="mat3x2h"?this.getTypeInfo("mat2x3h"):i==="mat3x3f"||i==="mat3x3h"?t:i==="mat3x4f"?this.getTypeInfo("mat4x3f"):i==="mat3x4h"?this.getTypeInfo("mat4x3h"):i==="mat4x2f"?this.getTypeInfo("mat2x4f"):i==="mat4x2h"?this.getTypeInfo("mat2x4h"):i==="mat4x3f"?this.getTypeInfo("mat3x4f"):i==="mat4x3h"?this.getTypeInfo("mat3x4h"):(i==="mat4x4f"||i==="mat4x4h"||console.error(`Invalid matrix type ${i}`),t)}Transpose(t,i){const n=this.exec.evalExpression(t.args[0],i);if(!(n instanceof on))return console.error(`Transpose() expects a matrix argument. Line ${t.line}`),null;const r=this._getTransposeType(n.typeInfo);if(n.typeInfo.name==="mat2x2"||n.typeInfo.name==="mat2x2f"||n.typeInfo.name==="mat2x2h"){const s=n.data;return new on([s[0],s[2],s[1],s[3]],r)}if(n.typeInfo.name==="mat2x3"||n.typeInfo.name==="mat2x3f"||n.typeInfo.name==="mat2x3h"){const s=n.data;return new on([s[0],s[3],s[6],s[1],s[4],s[7]],r)}if(n.typeInfo.name==="mat2x4"||n.typeInfo.name==="mat2x4f"||n.typeInfo.name==="mat2x4h"){const s=n.data;return new on([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13]],r)}if(n.typeInfo.name==="mat3x2"||n.typeInfo.name==="mat3x2f"||n.typeInfo.name==="mat3x2h"){const s=n.data;return new on([s[0],s[3],s[1],s[4],s[2],s[5]],r)}if(n.typeInfo.name==="mat3x3"||n.typeInfo.name==="mat3x3f"||n.typeInfo.name==="mat3x3h"){const s=n.data;return new on([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]],r)}if(n.typeInfo.name==="mat3x4"||n.typeInfo.name==="mat3x4f"||n.typeInfo.name==="mat3x4h"){const s=n.data;return new on([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14]],r)}if(n.typeInfo.name==="mat4x2"||n.typeInfo.name==="mat4x2f"||n.typeInfo.name==="mat4x2h"){const s=n.data;return new on([s[0],s[4],s[1],s[5],s[2],s[6]],r)}if(n.typeInfo.name==="mat4x3"||n.typeInfo.name==="mat4x3f"||n.typeInfo.name==="mat4x3h"){const s=n.data;return new on([s[0],s[4],s[8],s[1],s[5],s[9],s[2],s[6],s[10]],r)}if(n.typeInfo.name==="mat4x4"||n.typeInfo.name==="mat4x4f"||n.typeInfo.name==="mat4x4h"){const s=n.data;return new on([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14],s[3],s[7],s[11],s[15]],r)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof zt)return new zt(n.data.map(s=>Math.trunc(s)),n.typeInfo);const r=n;return new ie(Math.trunc(r.value),n.typeInfo)}Dpdx(t,i){return console.error(`TODO: dpdx. Line ${t.line}`),null}DpdxCoarse(t,i){return console.error(`TODO: dpdxCoarse. Line ${t.line}`),null}DpdxFine(t,i){return console.error("TODO: dpdxFine"),null}Dpdy(t,i){return console.error("TODO: dpdy"),null}DpdyCoarse(t,i){return console.error("TODO: dpdyCoarse"),null}DpdyFine(t,i){return console.error("TODO: dpdyFine"),null}Fwidth(t,i){return console.error("TODO: fwidth"),null}FwidthCoarse(t,i){return console.error("TODO: fwidthCoarse"),null}FwidthFine(t,i){return console.error("TODO: fwidthFine"),null}TextureDimensions(t,i){const n=t.args[0],r=t.args.length>1?this.exec.evalExpression(t.args[1],i).value:0;if(n instanceof ha){const s=n.name,o=i.getVariableValue(s);if(o instanceof uu){if(r<0||r>=o.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${t.line}`),null;const l=o.getMipLevelSize(r),h=o.dimension;return h==="1d"?new ie(l[0],this.getTypeInfo("u32")):h==="3d"?new zt(l,this.getTypeInfo("vec3u")):h==="2d"?new zt(l.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${h} not found. Line ${t.line}`),null)}return console.error(`Texture ${s} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${t.line}`),null}TextureGather(t,i){return console.error("TODO: textureGather"),null}TextureGatherCompare(t,i){return console.error("TODO: textureGatherCompare"),null}TextureLoad(t,i){const n=t.args[0],r=this.exec.evalExpression(t.args[1],i),s=t.args.length>2?this.exec.evalExpression(t.args[2],i).value:0;if(!(r instanceof zt)||r.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${t.line}`),null;if(n instanceof ha){const o=n.name,l=i.getVariableValue(o);if(l instanceof uu){const h=Math.floor(r.data[0]),A=Math.floor(r.data[1]);if(h<0||h>=l.width||A<0||A>=l.height)return console.error(`Texture ${o} out of bounds. Line ${t.line}`),null;const v=l.getPixel(h,A,0,s);return v===null?(console.error(`Invalid texture format for textureLoad. Line ${t.line}`),null):new zt(v,this.getTypeInfo("vec4f"))}return console.error(`Texture ${o} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${t.line}`),null}TextureNumLayers(t,i){const n=t.args[0];if(n instanceof ha){const r=n.name,s=i.getVariableValue(r);return s instanceof uu?new ie(s.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${t.line}`),null}TextureNumLevels(t,i){const n=t.args[0];if(n instanceof ha){const r=n.name,s=i.getVariableValue(r);return s instanceof uu?new ie(s.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${t.line}`),null}TextureNumSamples(t,i){const n=t.args[0];if(n instanceof ha){const r=n.name,s=i.getVariableValue(r);return s instanceof uu?new ie(s.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${t.line}`),null}TextureSample(t,i){return console.error("TODO: textureSample"),null}TextureSampleBias(t,i){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(t,i){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(t,i){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(t,i){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(t,i){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(t,i){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(t,i){const n=t.args[0],r=this.exec.evalExpression(t.args[1],i),s=t.args.length===4?this.exec.evalExpression(t.args[2],i).value:0,o=t.args.length===4?this.exec.evalExpression(t.args[3],i).data:this.exec.evalExpression(t.args[2],i).data;if(o.length!==4)return console.error(`Invalid value argument for textureStore. Line ${t.line}`),null;if(!(r instanceof zt)||r.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${t.line}`),null;if(n instanceof ha){const l=n.name,h=i.getVariableValue(l);if(h instanceof uu){const A=h.getMipLevelSize(0),v=Math.floor(r.data[0]),C=Math.floor(r.data[1]);return v<0||v>=A[0]||C<0||C>=A[1]?(console.error(`Texture ${l} out of bounds. Line ${t.line}`),null):(h.setPixel(v,C,0,s,Array.from(o)),null)}return console.error(`Texture ${l} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${t.line}`),null}AtomicLoad(t,i){let n=t.args[0];n instanceof Ao&&(n=n.right);const r=this.exec.getVariableName(n,i);return i.getVariable(r).value.getSubData(this.exec,n.postfix,i)}AtomicStore(t,i){let n=t.args[0];n instanceof Ao&&(n=n.right);const r=this.exec.getVariableName(n,i),s=i.getVariable(r);let o=t.args[1];const l=this.exec.evalExpression(o,i),h=s.value.getSubData(this.exec,n.postfix,i);return h instanceof ie&&l instanceof ie&&(h.value=l.value),s.value instanceof eo&&s.value.setDataValue(this.exec,h,n.postfix,i),null}AtomicAdd(t,i){let n=t.args[0];n instanceof Ao&&(n=n.right);const r=this.exec.getVariableName(n,i),s=i.getVariable(r);let o=t.args[1];const l=this.exec.evalExpression(o,i),h=s.value.getSubData(this.exec,n.postfix,i),A=new ie(h.value,h.typeInfo);return h instanceof ie&&l instanceof ie&&(h.value+=l.value),s.value instanceof eo&&s.value.setDataValue(this.exec,h,n.postfix,i),A}AtomicSub(t,i){let n=t.args[0];n instanceof Ao&&(n=n.right);const r=this.exec.getVariableName(n,i),s=i.getVariable(r);let o=t.args[1];const l=this.exec.evalExpression(o,i),h=s.value.getSubData(this.exec,n.postfix,i),A=new ie(h.value,h.typeInfo);return h instanceof ie&&l instanceof ie&&(h.value-=l.value),s.value instanceof eo&&s.value.setDataValue(this.exec,h,n.postfix,i),A}AtomicMax(t,i){let n=t.args[0];n instanceof Ao&&(n=n.right);const r=this.exec.getVariableName(n,i),s=i.getVariable(r);let o=t.args[1];const l=this.exec.evalExpression(o,i),h=s.value.getSubData(this.exec,n.postfix,i),A=new ie(h.value,h.typeInfo);return h instanceof ie&&l instanceof ie&&(h.value=Math.max(h.value,l.value)),s.value instanceof eo&&s.value.setDataValue(this.exec,h,n.postfix,i),A}AtomicMin(t,i){let n=t.args[0];n instanceof Ao&&(n=n.right);const r=this.exec.getVariableName(n,i),s=i.getVariable(r);let o=t.args[1];const l=this.exec.evalExpression(o,i),h=s.value.getSubData(this.exec,n.postfix,i),A=new ie(h.value,h.typeInfo);return h instanceof ie&&l instanceof ie&&(h.value=Math.min(h.value,l.value)),s.value instanceof eo&&s.value.setDataValue(this.exec,h,n.postfix,i),A}AtomicAnd(t,i){let n=t.args[0];n instanceof Ao&&(n=n.right);const r=this.exec.getVariableName(n,i),s=i.getVariable(r);let o=t.args[1];const l=this.exec.evalExpression(o,i),h=s.value.getSubData(this.exec,n.postfix,i),A=new ie(h.value,h.typeInfo);return h instanceof ie&&l instanceof ie&&(h.value=h.value&l.value),s.value instanceof eo&&s.value.setDataValue(this.exec,h,n.postfix,i),A}AtomicOr(t,i){let n=t.args[0];n instanceof Ao&&(n=n.right);const r=this.exec.getVariableName(n,i),s=i.getVariable(r);let o=t.args[1];const l=this.exec.evalExpression(o,i),h=s.value.getSubData(this.exec,n.postfix,i),A=new ie(h.value,h.typeInfo);return h instanceof ie&&l instanceof ie&&(h.value=h.value|l.value),s.value instanceof eo&&s.value.setDataValue(this.exec,h,n.postfix,i),A}AtomicXor(t,i){let n=t.args[0];n instanceof Ao&&(n=n.right);const r=this.exec.getVariableName(n,i),s=i.getVariable(r);let o=t.args[1];const l=this.exec.evalExpression(o,i),h=s.value.getSubData(this.exec,n.postfix,i),A=new ie(h.value,h.typeInfo);return h instanceof ie&&l instanceof ie&&(h.value=h.value^l.value),s.value instanceof eo&&s.value.setDataValue(this.exec,h,n.postfix,i),A}AtomicExchange(t,i){let n=t.args[0];n instanceof Ao&&(n=n.right);const r=this.exec.getVariableName(n,i),s=i.getVariable(r);let o=t.args[1];const l=this.exec.evalExpression(o,i),h=s.value.getSubData(this.exec,n.postfix,i),A=new ie(h.value,h.typeInfo);return h instanceof ie&&l instanceof ie&&(h.value=l.value),s.value instanceof eo&&s.value.setDataValue(this.exec,h,n.postfix,i),A}AtomicCompareExchangeWeak(t,i){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(t,i){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(t,i){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(t,i){return console.error("TODO: pack4xI8"),null}Pack4xU8(t,i){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(t,i){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(t,i){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(t,i){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(t,i){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(t,i){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(t,i){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(t,i){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(t,i){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(t,i){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(t,i){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(t,i){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(t,i){return console.error("TODO: unpack2x16float"),null}StorageBarrier(t,i){return null}TextureBarrier(t,i){return null}WorkgroupBarrier(t,i){return null}WorkgroupUniformLoad(t,i){return null}SubgroupAdd(t,i){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(t,i){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(t,i){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(t,i){return console.error("TODO: subgroupAll"),null}SubgroupAnd(t,i){return console.error("TODO: subgroupAnd"),null}SubgroupAny(t,i){return console.error("TODO: subgroupAny"),null}SubgroupBallot(t,i){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(t,i){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(t,i){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(t,i){return console.error("TODO: subgroupElect"),null}SubgroupMax(t,i){return console.error("TODO: subgroupMax"),null}SubgroupMin(t,i){return console.error("TODO: subgroupMin"),null}SubgroupMul(t,i){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(t,i){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(t,i){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(t,i){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(t,i){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(t,i){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(t,i){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(t,i){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(t,i){return console.error("TODO: subgroupXor"),null}QuadBroadcast(t,i){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(t,i){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(t,i){return console.error("TODO: quadSwapX"),null}QuadSwapY(t,i){return console.error("TODO: quadSwapY"),null}}const Q1={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Rs={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Cs extends wH{constructor(t,i){var n;super(),this.ast=t??[],this.reflection=new bc,this.reflection.updateAST(this.ast),this.context=(n=i==null?void 0:i.clone())!==null&&n!==void 0?n:new WE,this.builtins=new CH(this),this.typeInfo={bool:this.getTypeInfo(Ue.bool),i32:this.getTypeInfo(Ue.i32),u32:this.getTypeInfo(Ue.u32),f32:this.getTypeInfo(Ue.f32),f16:this.getTypeInfo(Ue.f16),vec2f:this.getTypeInfo(ue.vec2f),vec2u:this.getTypeInfo(ue.vec2u),vec2i:this.getTypeInfo(ue.vec2i),vec2h:this.getTypeInfo(ue.vec2h),vec3f:this.getTypeInfo(ue.vec3f),vec3u:this.getTypeInfo(ue.vec3u),vec3i:this.getTypeInfo(ue.vec3i),vec3h:this.getTypeInfo(ue.vec3h),vec4f:this.getTypeInfo(ue.vec4f),vec4u:this.getTypeInfo(ue.vec4u),vec4i:this.getTypeInfo(ue.vec4i),vec4h:this.getTypeInfo(ue.vec4h),mat2x2f:this.getTypeInfo(ue.mat2x2f),mat2x3f:this.getTypeInfo(ue.mat2x3f),mat2x4f:this.getTypeInfo(ue.mat2x4f),mat3x2f:this.getTypeInfo(ue.mat3x2f),mat3x3f:this.getTypeInfo(ue.mat3x3f),mat3x4f:this.getTypeInfo(ue.mat3x4f),mat4x2f:this.getTypeInfo(ue.mat4x2f),mat4x3f:this.getTypeInfo(ue.mat4x3f),mat4x4f:this.getTypeInfo(ue.mat4x4f)}}getVariableValue(t){var i,n;const r=(n=(i=this.context.getVariable(t))===null||i===void 0?void 0:i.value)!==null&&n!==void 0?n:null;if(r===null)return null;if(r instanceof ie)return r.value;if(r instanceof zt||r instanceof on)return Array.from(r.data);if(r instanceof eo&&r.typeInfo instanceof Xu){if(r.typeInfo.format.name==="u32")return Array.from(new Uint32Array(r.buffer,r.offset,r.typeInfo.count));if(r.typeInfo.format.name==="i32")return Array.from(new Int32Array(r.buffer,r.offset,r.typeInfo.count));if(r.typeInfo.format.name==="f32")return Array.from(new Float32Array(r.buffer,r.offset,r.typeInfo.count))}return console.error(`Unsupported return variable type ${r.typeInfo.name}`),null}execute(t){(t=t??{}).constants&&this._setOverrides(t.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(t,i,n,r){const s=this.context.clone();(r=r??{}).constants&&this._setOverrides(r.constants,s),this._execStatements(this.ast,s);const o=s.getFunction(t);if(!o)return void console.error(`Function ${t} not found`);if(typeof i=="number")i=[i,1,1];else{if(i.length===0)return void console.error("Invalid dispatch count");i.length===1?i=[i[0],1,1]:i.length===2?i=[i[0],i[1],1]:i.length>3&&(i=[i[0],i[1],i[2]])}const l=i[0],h=i[1],A=i[2],v=this.getTypeInfo("vec3u");s.setVariable("@num_workgroups",new zt(i,v));for(const C in n)for(const S in n[C]){const L=n[C][S];s.variables.forEach(N=>{var G;const W=N.node;if(W!=null&&W.attributes){let j=null,q=null;for(const Z of W.attributes)Z.name==="binding"?j=Z.value:Z.name==="group"&&(q=Z.value);if(S==j&&C==q)if(L.texture!==void 0&&L.descriptor!==void 0){const Z=new uu(L.texture,this.getTypeInfo(W.type),L.descriptor,(G=L.texture.view)!==null&&G!==void 0?G:null);N.value=Z}else L.uniform!==void 0?N.value=new eo(L.uniform,this.getTypeInfo(W.type)):N.value=new eo(L,this.getTypeInfo(W.type))}})}for(let C=0;C<A;++C)for(let S=0;S<h;++S)for(let L=0;L<l;++L)s.setVariable("@workgroup_id",new zt([L,S,C],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(o,[L,S,C],s)}execStatement(t,i){if(t instanceof iI)return this.evalExpression(t.value,i);if(t instanceof rI){if(t.condition){const n=this.evalExpression(t.condition,i);if(!(n instanceof ie))throw new Error("Invalid break-if condition");if(!n.value)return null}return Cs._breakObj}if(t instanceof oI)return Cs._continueObj;if(t instanceof WA)this._let(t,i);else if(t instanceof Xc)this._var(t,i);else if(t instanceof A0)this._const(t,i);else if(t instanceof HA)this._function(t,i);else{if(t instanceof eI)return this._if(t,i);if(t instanceof tI)return this._switch(t,i);if(t instanceof ZS)return this._for(t,i);if(t instanceof QS)return this._while(t,i);if(t instanceof $S)return this._loop(t,i);if(t instanceof V1){const n=i.clone();return n.currentFunctionName=i.currentFunctionName,this._execStatements(t.body,n)}if(t instanceof qS)this._assign(t,i);else if(t instanceof YS)this._increment(t,i);else{if(t instanceof Kc)return null;if(t instanceof j1){const n=t.name;i.getVariable(n)===null&&i.setVariable(n,new ie(0,this.getTypeInfo("u32")))}else if(t instanceof H1)this._call(t,i);else{if(t instanceof nI||t instanceof W1)return null;console.error("Invalid statement type.",t,`Line ${t.line}`)}}}return null}evalExpression(t,i){return t instanceof fl?this._evalBinaryOp(t,i):t instanceof Bo?this._evalLiteral(t,i):t instanceof ha?this._evalVariable(t,i):t instanceof X1?this._evalCall(t,i):t instanceof oc?this._evalCreate(t,i):t instanceof aI?this._evalConst(t,i):t instanceof lI?this._evalBitcast(t,i):t instanceof Ao?this._evalUnaryOp(t,i):(console.error("Invalid expression type",t,`Line ${t.line}`),null)}getTypeInfo(t){var i;if(t instanceof Ue){const r=this.reflection.getTypeInfo(t);if(r!==null)return r}let n=(i=this.typeInfo[t])!==null&&i!==void 0?i:null;return n!==null||(n=this.reflection.getTypeInfoByName(t)),n}_setOverrides(t,i){for(const n in t){const r=t[n],s=this.reflection.getOverrideInfo(n);s!==null?(s.type===null&&(s.type=this.getTypeInfo("u32")),s.type.name==="u32"||s.type.name==="i32"||s.type.name==="f32"||s.type.name==="f16"?i.setVariable(n,new ie(r,s.type)):s.type.name==="bool"?i.setVariable(n,new ie(r?1:0,s.type)):s.type.name==="vec2"||s.type.name==="vec3"||s.type.name==="vec4"||s.type.name==="vec2f"||s.type.name==="vec3f"||s.type.name==="vec4f"||s.type.name==="vec2i"||s.type.name==="vec3i"||s.type.name==="vec4i"||s.type.name==="vec2u"||s.type.name==="vec3u"||s.type.name==="vec4u"||s.type.name==="vec2h"||s.type.name==="vec3h"||s.type.name==="vec4h"?i.setVariable(n,new zt(r,s.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(t,i,n){const r=[1,1,1];for(const v of t.node.attributes)if(v.name==="workgroup_size"){if(v.value.length>0){const C=n.getVariableValue(v.value[0]);r[0]=C instanceof ie?C.value:parseInt(v.value[0])}if(v.value.length>1){const C=n.getVariableValue(v.value[1]);r[1]=C instanceof ie?C.value:parseInt(v.value[1])}if(v.value.length>2){const C=n.getVariableValue(v.value[2]);r[2]=C instanceof ie?C.value:parseInt(v.value[2])}}const s=this.getTypeInfo("vec3u"),o=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new zt(r,s));const l=r[0],h=r[1],A=r[2];for(let v=0,C=0;v<A;++v)for(let S=0;S<h;++S)for(let L=0;L<l;++L,++C){const N=[L,S,v],G=[L+i[0]*r[0],S+i[1]*r[1],v+i[2]*r[2]];n.setVariable("@local_invocation_id",new zt(N,s)),n.setVariable("@global_invocation_id",new zt(G,s)),n.setVariable("@local_invocation_index",new ie(C,o)),this._dispatchExec(t,n)}}_dispatchExec(t,i){for(const n of t.node.args)for(const r of n.attributes)if(r.name==="builtin"){const s=`@${r.value}`,o=i.getVariable(s);o!==void 0&&i.variables.set(n.name,o)}this._execStatements(t.node.body,i)}getVariableName(t,i){for(;t instanceof Ao;)t=t.right;return t instanceof ha?t.name:(console.error("Unknown variable type",t,"Line",t.line),null)}_execStatements(t,i){for(const n of t){if(n instanceof Array){const s=i.clone(),o=this._execStatements(n,s);if(o)return o;continue}const r=this.execStatement(n,i);if(r)return r}return null}_call(t,i){const n=i.clone();n.currentFunctionName=t.name;const r=i.getFunction(t.name);if(r){for(let s=0;s<r.node.args.length;++s){const o=r.node.args[s],l=this.evalExpression(t.args[s],n);n.setVariable(o.name,l,o)}this._execStatements(r.node.body,n)}else t.isBuiltin?this._callBuiltinFunction(t,n):this.getTypeInfo(t.name)&&this._evalCreate(t,i)}_increment(t,i){const n=this.getVariableName(t.variable,i),r=i.getVariable(n);r?t.operator==="++"?r.value instanceof ie?r.value.value++:console.error(`Variable ${n} is not a scalar. Line ${t.line}`):t.operator==="--"?r.value instanceof ie?r.value.value--:console.error(`Variable ${n} is not a scalar. Line ${t.line}`):console.error(`Unknown increment operator ${t.operator}. Line ${t.line}`):console.error(`Variable ${n} not found. Line ${t.line}`)}_getVariableData(t,i){if(t instanceof ha){const n=this.getVariableName(t,i),r=i.getVariable(n);return r===null?(console.error(`Variable ${n} not found. Line ${t.line}`),null):r.value.getSubData(this,t.postfix,i)}if(t instanceof Ao){if(t.operator==="*"){const n=this._getVariableData(t.right,i);return n instanceof Fd?n.reference.getSubData(this,t.postfix,i):(console.error(`Variable ${t.right} is not a pointer. Line ${t.line}`),null)}if(t.operator==="&"){const n=this._getVariableData(t.right,i);return new Fd(n)}}return null}_assign(t,i){let n=null,r="<var>",s=null;if(t.variable instanceof Ao){const h=this._getVariableData(t.variable,i),A=this.evalExpression(t.value,i),v=t.operator;if(v==="="){if(h instanceof ie||h instanceof zt||h instanceof on){if(A instanceof ie||A instanceof zt||A instanceof on&&h.data.length===A.data.length)return void h.data.set(A.data);console.error(`Invalid assignment. Line ${t.line}`)}else if(h instanceof eo&&A instanceof eo&&h.buffer.byteLength-h.offset>=A.buffer.byteLength-A.offset)return void(h.buffer.byteLength%4==0?new Uint32Array(h.buffer,h.offset,h.typeInfo.size/4).set(new Uint32Array(A.buffer,A.offset,A.typeInfo.size/4)):new Uint8Array(h.buffer,h.offset,h.typeInfo.size).set(new Uint8Array(A.buffer,A.offset,A.typeInfo.size)));return console.error(`Invalid assignment. Line ${t.line}`),null}if(v==="+=")return h instanceof ie||h instanceof zt||h instanceof on?A instanceof ie||A instanceof zt||A instanceof on?void h.data.set(A.data.map((C,S)=>h.data[S]+C)):void console.error(`Invalid assignment . Line ${t.line}`):void console.error(`Invalid assignment. Line ${t.line}`);if(v==="-=")return(h instanceof ie||h instanceof zt||h instanceof on)&&(A instanceof ie||A instanceof zt||A instanceof on)?void h.data.set(A.data.map((C,S)=>h.data[S]-C)):void console.error(`Invalid assignment. Line ${t.line}`)}if(t.variable instanceof Ao){if(t.variable.operator==="*"){r=this.getVariableName(t.variable.right,i);const h=i.getVariable(r);if(!(h&&h.value instanceof Fd))return void console.error(`Variable ${r} is not a pointer. Line ${t.line}`);n=h.value.reference;let A=t.variable.postfix;if(!A){let v=t.variable.right;for(;v instanceof Ao;){if(v.postfix){A=v.postfix;break}v=v.right}}A&&(n=n.getSubData(this,A,i))}}else{s=t.variable.postfix,r=this.getVariableName(t.variable,i);const h=i.getVariable(r);if(h===null)return void console.error(`Variable ${r} not found. Line ${t.line}`);n=h.value}if(n instanceof Fd&&(n=n.reference),n===null)return void console.error(`Variable ${r} not found. Line ${t.line}`);const o=this.evalExpression(t.value,i),l=t.operator;if(l==="=")if(n instanceof eo)n.setDataValue(this,o,s,i);else if(s){if(!(n instanceof zt||n instanceof on))return void console.error(`Variable ${r} is not a vector or matrix. Line ${t.line}`);if(s instanceof Ld){const h=this.evalExpression(s.index,i).value;if(n instanceof zt){if(!(o instanceof ie))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[h]=o.value}else{if(!(n instanceof on))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);{const A=this.evalExpression(s.index,i).value;if(A<0)return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);if(!(o instanceof zt))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);{const v=n.typeInfo.getTypeName();if(v==="mat2x2"||v==="mat2x2f"||v==="mat2x2h"){if(!(A<2&&o.data.length===2))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[2*A]=o.data[0],n.data[2*A+1]=o.data[1]}else if(v==="mat2x3"||v==="mat2x3f"||v==="mat2x3h"){if(!(A<2&&o.data.length===3))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[3*A]=o.data[0],n.data[3*A+1]=o.data[1],n.data[3*A+2]=o.data[2]}else if(v==="mat2x4"||v==="mat2x4f"||v==="mat2x4h"){if(!(A<2&&o.data.length===4))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[4*A]=o.data[0],n.data[4*A+1]=o.data[1],n.data[4*A+2]=o.data[2],n.data[4*A+3]=o.data[3]}else if(v==="mat3x2"||v==="mat3x2f"||v==="mat3x2h"){if(!(A<3&&o.data.length===2))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[2*A]=o.data[0],n.data[2*A+1]=o.data[1]}else if(v==="mat3x3"||v==="mat3x3f"||v==="mat3x3h"){if(!(A<3&&o.data.length===3))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[3*A]=o.data[0],n.data[3*A+1]=o.data[1],n.data[3*A+2]=o.data[2]}else if(v==="mat3x4"||v==="mat3x4f"||v==="mat3x4h"){if(!(A<3&&o.data.length===4))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[4*A]=o.data[0],n.data[4*A+1]=o.data[1],n.data[4*A+2]=o.data[2],n.data[4*A+3]=o.data[3]}else if(v==="mat4x2"||v==="mat4x2f"||v==="mat4x2h"){if(!(A<4&&o.data.length===2))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[2*A]=o.data[0],n.data[2*A+1]=o.data[1]}else if(v==="mat4x3"||v==="mat4x3f"||v==="mat4x3h"){if(!(A<4&&o.data.length===3))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[3*A]=o.data[0],n.data[3*A+1]=o.data[1],n.data[3*A+2]=o.data[2]}else{if(v!=="mat4x4"&&v!=="mat4x4f"&&v!=="mat4x4h")return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);if(!(A<4&&o.data.length===4))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[4*A]=o.data[0],n.data[4*A+1]=o.data[1],n.data[4*A+2]=o.data[2],n.data[4*A+3]=o.data[3]}}}}}else if(s instanceof Yh){const h=s.value;if(!(n instanceof zt))return void console.error(`Invalid assignment to ${h}. Variable ${r} is not a vector. Line ${t.line}`);if(o instanceof ie){if(h.length>1)return void console.error(`Invalid assignment to ${h} for variable ${r}. Line ${t.line}`);if(h==="x")n.data[0]=o.value;else if(h==="y"){if(n.data.length<2)return void console.error(`Invalid assignment to ${h} for variable ${r}. Line ${t.line}`);n.data[1]=o.value}else if(h==="z"){if(n.data.length<3)return void console.error(`Invalid assignment to ${h} for variable ${r}. Line ${t.line}`);n.data[2]=o.value}else if(h==="w"){if(n.data.length<4)return void console.error(`Invalid assignment to ${h} for variable ${r}. Line ${t.line}`);n.data[3]=o.value}}else{if(!(o instanceof zt))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);if(h.length!==o.data.length)return void console.error(`Invalid assignment to ${h} for variable ${r}. Line ${t.line}`);for(let A=0;A<h.length;++A){const v=h[A];if(v==="x"||v==="r")n.data[0]=o.data[A];else if(v==="y"||v==="g"){if(o.data.length<2)return void console.error(`Invalid assignment to ${v} for variable ${r}. Line ${t.line}`);n.data[1]=o.data[A]}else if(v==="z"||v==="b"){if(o.data.length<3)return void console.error(`Invalid assignment to ${v} for variable ${r}. Line ${t.line}`);n.data[2]=o.data[A]}else{if(v!=="w"&&v!=="a")return void console.error(`Invalid assignment to ${v} for variable ${r}. Line ${t.line}`);if(o.data.length<4)return void console.error(`Invalid assignment to ${v} for variable ${r}. Line ${t.line}`);n.data[3]=o.data[A]}}}}}else n instanceof ie&&o instanceof ie?n.value=o.value:n instanceof zt&&o instanceof zt||n instanceof on&&o instanceof on?n.data.set(o.data):console.error(`Invalid assignment to ${r}. Line ${t.line}`);else{const h=n.getSubData(this,s,i);if(h instanceof zt&&o instanceof ie){const A=h.data,v=o.value;if(l==="+=")for(let C=0;C<A.length;++C)A[C]+=v;else if(l==="-=")for(let C=0;C<A.length;++C)A[C]-=v;else if(l==="*=")for(let C=0;C<A.length;++C)A[C]*=v;else if(l==="/=")for(let C=0;C<A.length;++C)A[C]/=v;else if(l==="%=")for(let C=0;C<A.length;++C)A[C]%=v;else if(l==="&=")for(let C=0;C<A.length;++C)A[C]&=v;else if(l==="|=")for(let C=0;C<A.length;++C)A[C]|=v;else if(l==="^=")for(let C=0;C<A.length;++C)A[C]^=v;else if(l==="<<=")for(let C=0;C<A.length;++C)A[C]<<=v;else if(l===">>=")for(let C=0;C<A.length;++C)A[C]>>=v;else console.error(`Invalid operator ${l}. Line ${t.line}`)}else if(h instanceof zt&&o instanceof zt){const A=h.data,v=o.data;if(A.length!==v.length)return void console.error(`Vector length mismatch. Line ${t.line}`);if(l==="+=")for(let C=0;C<A.length;++C)A[C]+=v[C];else if(l==="-=")for(let C=0;C<A.length;++C)A[C]-=v[C];else if(l==="*=")for(let C=0;C<A.length;++C)A[C]*=v[C];else if(l==="/=")for(let C=0;C<A.length;++C)A[C]/=v[C];else if(l==="%=")for(let C=0;C<A.length;++C)A[C]%=v[C];else if(l==="&=")for(let C=0;C<A.length;++C)A[C]&=v[C];else if(l==="|=")for(let C=0;C<A.length;++C)A[C]|=v[C];else if(l==="^=")for(let C=0;C<A.length;++C)A[C]^=v[C];else if(l==="<<=")for(let C=0;C<A.length;++C)A[C]<<=v[C];else if(l===">>=")for(let C=0;C<A.length;++C)A[C]>>=v[C];else console.error(`Invalid operator ${l}. Line ${t.line}`)}else{if(!(h instanceof ie&&o instanceof ie))return void console.error(`Invalid type for ${t.operator} operator. Line ${t.line}`);l==="+="?h.value+=o.value:l==="-="?h.value-=o.value:l==="*="?h.value*=o.value:l==="/="?h.value/=o.value:l==="%="?h.value%=o.value:l==="&="?h.value&=o.value:l==="|="?h.value|=o.value:l==="^="?h.value^=o.value:l==="<<="?h.value<<=o.value:l===">>="?h.value>>=o.value:console.error(`Invalid operator ${l}. Line ${t.line}`)}n instanceof eo&&n.setDataValue(this,h,s,i)}}_function(t,i){const n=new HE(t);i.functions.set(t.name,n)}_const(t,i){let n=null;t.value!==null&&(n=this.evalExpression(t.value,i)),i.createVariable(t.name,n,t)}_let(t,i){let n=null;if(t.value!==null){if(n=this.evalExpression(t.value,i),n===null)return void console.error(`Invalid value for variable ${t.name}. Line ${t.line}`);t.value instanceof Ao||(n=n.clone())}else{const r=t.type.name;if(r==="f32"||r==="i32"||r==="u32"||r==="bool"||r==="f16"||r==="vec2"||r==="vec3"||r==="vec4"||r==="vec2f"||r==="vec3f"||r==="vec4f"||r==="vec2i"||r==="vec3i"||r==="vec4i"||r==="vec2u"||r==="vec3u"||r==="vec4u"||r==="vec2h"||r==="vec3h"||r==="vec4h"||r==="vec2b"||r==="vec3b"||r==="vec4b"||r==="mat2x2"||r==="mat2x3"||r==="mat2x4"||r==="mat3x2"||r==="mat3x3"||r==="mat3x4"||r==="mat4x2"||r==="mat4x3"||r==="mat4x4"||r==="mat2x2f"||r==="mat2x3f"||r==="mat2x4f"||r==="mat3x2f"||r==="mat3x3f"||r==="mat3x4f"||r==="mat4x2f"||r==="mat4x3f"||r==="mat4x4f"||r==="mat2x2h"||r==="mat2x3h"||r==="mat2x4h"||r==="mat3x2h"||r==="mat3x3h"||r==="mat3x4h"||r==="mat4x2h"||r==="mat4x3h"||r==="mat4x4h"||r==="array"){const s=new oc(t.type,[]);n=this._evalCreate(s,i)}}i.createVariable(t.name,n,t)}_var(t,i){let n=null;if(t.value!==null){if(n=this.evalExpression(t.value,i),n===null)return void console.error(`Invalid value for variable ${t.name}. Line ${t.line}`);t.value instanceof Ao||(n=n.clone())}else{if(t.type===null)return void console.error(`Variable ${t.name} has no type. Line ${t.line}`);const r=t.type.name;if(r==="f32"||r==="i32"||r==="u32"||r==="bool"||r==="f16"||r==="vec2"||r==="vec3"||r==="vec4"||r==="vec2f"||r==="vec3f"||r==="vec4f"||r==="vec2i"||r==="vec3i"||r==="vec4i"||r==="vec2u"||r==="vec3u"||r==="vec4u"||r==="vec2h"||r==="vec3h"||r==="vec4h"||r==="vec2b"||r==="vec3b"||r==="vec4b"||r==="mat2x2"||r==="mat2x3"||r==="mat2x4"||r==="mat3x2"||r==="mat3x3"||r==="mat3x4"||r==="mat4x2"||r==="mat4x3"||r==="mat4x4"||r==="mat2x2f"||r==="mat2x3f"||r==="mat2x4f"||r==="mat3x2f"||r==="mat3x3f"||r==="mat3x4f"||r==="mat4x2f"||r==="mat4x3f"||r==="mat4x4f"||r==="mat2x2h"||r==="mat2x3h"||r==="mat2x4h"||r==="mat3x2h"||r==="mat3x3h"||r==="mat3x4h"||r==="mat4x2h"||r==="mat4x3h"||r==="mat4x4h"||t.type instanceof XA||t.type instanceof Kc||t.type instanceof ue){const s=new oc(t.type,[]);n=this._evalCreate(s,i)}}i.createVariable(t.name,n,t)}_switch(t,i){i=i.clone();const n=this.evalExpression(t.condition,i);if(!(n instanceof ie))return console.error(`Invalid if condition. Line ${t.line}`),null;let r=null;for(const s of t.cases)if(s instanceof hI)for(const o of s.selectors){if(o instanceof g0){r=s;continue}const l=this.evalExpression(o,i);if(!(l instanceof ie))return console.error(`Invalid case selector. Line ${t.line}`),null;if(l.value===n.value)return this._execStatements(s.body,i)}else s instanceof fI&&(r=s);return r?this._execStatements(r.body,i):null}_if(t,i){i=i.clone();const n=this.evalExpression(t.condition,i);if(!(n instanceof ie))return console.error(`Invalid if condition. Line ${t.line}`),null;if(n.value)return this._execStatements(t.body,i);for(const r of t.elseif){const s=this.evalExpression(r.condition,i);if(!(s instanceof ie))return console.error(`Invalid if condition. Line ${t.line}`),null;if(s.value)return this._execStatements(r.body,i)}return t.else?this._execStatements(t.else,i):null}_getScalarValue(t){return t instanceof ie?t.value:(console.error("Expected scalar value.",t),0)}_for(t,i){for(i=i.clone(),this.execStatement(t.init,i);this._getScalarValue(this.evalExpression(t.condition,i));){const n=this._execStatements(t.body,i);if(n===Cs._breakObj)break;if(n!==null&&n!==Cs._continueObj)return n;this.execStatement(t.increment,i)}return null}_loop(t,i){for(i=i.clone();;){const n=this._execStatements(t.body,i);if(n===Cs._breakObj)break;if(n===Cs._continueObj){if(t.continuing&&this._execStatements(t.continuing.body,i)===Cs._breakObj)break}else if(n!==null)return n}return null}_while(t,i){for(i=i.clone();this._getScalarValue(this.evalExpression(t.condition,i));){const n=this._execStatements(t.body,i);if(n===Cs._breakObj)break;if(n!==Cs._continueObj&&n!==null)return n}return null}_evalBitcast(t,i){const n=this.evalExpression(t.value,i),r=t.type;if(n instanceof ie){const s=mI(n.value,n.typeInfo.name,r.name);return new ie(s,this.getTypeInfo(r))}if(n instanceof zt){const s=n.typeInfo.getTypeName();let o="";if(s.endsWith("f"))o="f32";else if(s.endsWith("i"))o="i32";else if(s.endsWith("u"))o="u32";else if(s.endsWith("b"))o="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${t.line}`),null;o="f16"}const l=r.getTypeName();let h="";if(l.endsWith("f"))h="f32";else if(l.endsWith("i"))h="i32";else if(l.endsWith("u"))h="u32";else if(l.endsWith("b"))h="bool";else{if(!l.endsWith("h"))return console.error(`Unknown vector type ${h}. Line ${t.line}`),null;h="f16"}const A=function(v,C,S){if(C===S)return v;const L=new Array(v.length);for(let N=0;N<v.length;N++)L[N]=mI(v[N],C,S);return L}(Array.from(n.data),o,h);return new zt(A,this.getTypeInfo(r))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${t.line}`),null}_evalConst(t,i){return i.getVariableValue(t.name).clone().getSubData(this,t.postfix,i)}_evalCreate(t,i){var n;if(t instanceof oc){if(t.type===null)return K1.void;switch(t.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(t,i);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(t,i);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(t,i)}}const r=t instanceof oc?t.type.name:t.name,s=t instanceof oc?this.getTypeInfo(t.type):this.getTypeInfo(t.name);if(s===null)return console.error(`Unknown type ${r}. Line ${t.line}`),null;if(s.size===0)return null;const o=new eo(new ArrayBuffer(s.size),s,0);if(s instanceof Ju){if(t.args)for(let l=0;l<t.args.length;++l){const h=s.members[l],A=t.args[l],v=this.evalExpression(A,i);o.setData(this,v,h.type,h.offset,i)}}else if(s instanceof Xu){let l=0;if(t.args)for(let h=0;h<t.args.length;++h){const A=t.args[h],v=this.evalExpression(A,i);s.format===null&&(((n=v.typeInfo)===null||n===void 0?void 0:n.name)==="x32"?s.format=this.getTypeInfo("i32"):s.format=v.typeInfo),o.setData(this,v,s.format,l,i),l+=s.stride}}else console.error(`Unknown type "${r}". Line ${t.line}`);return t instanceof oc?o.getSubData(this,t.postfix,i):o}_evalLiteral(t,i){const n=this.getTypeInfo(t.type),r=n.name;return r==="x32"||r==="u32"||r==="f32"||r==="f16"||r==="i32"||r==="bool"?new ie(t.scalarValue,n):r==="vec2"||r==="vec3"||r==="vec4"||r==="vec2f"||r==="vec3f"||r==="vec4f"||r==="vec2h"||r==="vec3h"||r==="vec4h"||r==="vec2i"||r==="vec3i"||r==="vec4i"||r==="vec2u"||r==="vec3u"||r==="vec4u"?this._callConstructorVec(t,i):r==="mat2x2"||r==="mat2x3"||r==="mat2x4"||r==="mat3x2"||r==="mat3x3"||r==="mat3x4"||r==="mat4x2"||r==="mat4x3"||r==="mat4x4"||r==="mat2x2f"||r==="mat2x3f"||r==="mat2x4f"||r==="mat3x2f"||r==="mat3x3f"||r==="mat3x4f"||r==="mat4x2f"||r==="mat4x3f"||r==="mat4x4f"||r==="mat2x2h"||r==="mat2x3h"||r==="mat2x4h"||r==="mat3x2h"||r==="mat3x3h"||r==="mat3x4h"||r==="mat4x2h"||r==="mat4x3h"||r==="mat4x4h"?this._callConstructorMatrix(t,i):t.value}_evalVariable(t,i){const n=i.getVariableValue(t.name);return n===null?n:n.getSubData(this,t.postfix,i)}_maxFormatTypeInfo(t){let i=t[0];if(i.name==="f32")return i;for(let n=1;n<t.length;++n){const r=Cs._priority.get(i.name);Cs._priority.get(t[n].name)<r&&(i=t[n])}return i.name==="x32"?this.getTypeInfo("i32"):i}_evalUnaryOp(t,i){const n=this.evalExpression(t.right,i);if(t.operator==="&")return new Fd(n);if(t.operator==="*")return n instanceof Fd?n.reference.getSubData(this,t.postfix,i):(console.error(`Invalid dereference. Line ${t.line}`),null);const r=n instanceof ie?n.value:n instanceof zt?Array.from(n.data):null;switch(t.operator){case"+":{if(gi(r)){const l=r.map((h,A)=>+h);return new zt(l,n.typeInfo)}const s=r,o=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new ie(+s,o)}case"-":{if(gi(r)){const l=r.map((h,A)=>-h);return new zt(l,n.typeInfo)}const s=r,o=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new ie(-s,o)}case"!":{if(gi(r)){const l=r.map((h,A)=>h?0:1);return new zt(l,n.typeInfo)}const s=r,o=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new ie(s?0:1,o)}case"~":{if(gi(r)){const l=r.map((h,A)=>~h);return new zt(l,n.typeInfo)}const s=r,o=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new ie(~s,o)}}return console.error(`Invalid unary operator ${t.operator}. Line ${t.line}`),null}_evalBinaryOp(t,i){const n=this.evalExpression(t.left,i),r=this.evalExpression(t.right,i),s=n instanceof ie?n.value:n instanceof zt||n instanceof on?Array.from(n.data):null,o=r instanceof ie?r.value:r instanceof zt||r instanceof on?Array.from(r.data):null;switch(t.operator){case"+":{if(gi(s)&&gi(o)){const v=s,C=o;if(v.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const S=v.map((L,N)=>L+C[N]);return new zt(S,n.typeInfo)}if(gi(s)){const v=o,C=s.map((S,L)=>S+v);return new zt(C,n.typeInfo)}if(gi(o)){const v=s,C=o.map((S,L)=>v+S);return new zt(C,r.typeInfo)}const l=s,h=o,A=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ie(l+h,A)}case"-":{if(gi(s)&&gi(o)){const v=s,C=o;if(v.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const S=v.map((L,N)=>L-C[N]);return new zt(S,n.typeInfo)}if(gi(s)){const v=o,C=s.map((S,L)=>S-v);return new zt(C,n.typeInfo)}if(gi(o)){const v=s,C=o.map((S,L)=>v-S);return new zt(C,r.typeInfo)}const l=s,h=o,A=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ie(l-h,A)}case"*":{if(gi(s)&&gi(o)){const v=s,C=o;if(n instanceof on&&r instanceof on){const S=function(W,j,q,Z){if(Rs[j.name]===void 0||Rs[Z.name]===void 0)return null;const K=Rs[j.name][0],ft=Rs[j.name][1],rt=Rs[Z.name][0];if(K!==Rs[Z.name][1])return null;const Lt=new Array(rt*ft);for(let Vt=0;Vt<ft;Vt++)for(let At=0;At<rt;At++){let at=0;for(let kt=0;kt<K;kt++)at+=W[kt*ft+Vt]*q[At*K+kt];Lt[Vt*rt+At]=at}return Lt}(v,n.typeInfo,C,r.typeInfo);if(S===null)return console.error(`Matrix multiplication failed. Line ${t.line}.`),null;const L=Rs[r.typeInfo.name][0],N=Rs[n.typeInfo.name][1],G=this.getTypeInfo(`mat${L}x${N}f`);return new on(S,G)}if(n instanceof on&&r instanceof zt){const S=function(L,N,G,W){if(Rs[N.name]===void 0||Q1[W.name]===void 0)return null;const j=Rs[N.name][0],q=Rs[N.name][1];if(j!==G.length)return null;const Z=new Array(q);for(let K=0;K<q;K++){let ft=0;for(let rt=0;rt<j;rt++)ft+=L[rt*q+K]*G[rt];Z[K]=ft}return Z}(v,n.typeInfo,C,r.typeInfo);return S===null?(console.error(`Matrix vector multiplication failed. Line ${t.line}.`),null):new zt(S,r.typeInfo)}if(n instanceof zt&&r instanceof on){const S=function(L,N,G,W){if(Q1[N.name]===void 0||Rs[W.name]===void 0)return null;const j=Rs[W.name][0],q=Rs[W.name][1];if(q!==L.length)return null;const Z=[];for(let K=0;K<j;K++){let ft=0;for(let rt=0;rt<q;rt++)ft+=L[rt]*G[rt*j+K];Z[K]=ft}return Z}(v,n.typeInfo,C,r.typeInfo);return S===null?(console.error(`Matrix vector multiplication failed. Line ${t.line}.`),null):new zt(S,n.typeInfo)}{if(v.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const S=v.map((L,N)=>L*C[N]);return new zt(S,n.typeInfo)}}if(gi(s)){const v=o,C=s.map((S,L)=>S*v);return n instanceof on?new on(C,n.typeInfo):new zt(C,n.typeInfo)}if(gi(o)){const v=s,C=o.map((S,L)=>v*S);return r instanceof on?new on(C,r.typeInfo):new zt(C,r.typeInfo)}const l=s,h=o,A=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ie(l*h,A)}case"%":{if(gi(s)&&gi(o)){const v=s,C=o;if(v.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const S=v.map((L,N)=>L%C[N]);return new zt(S,n.typeInfo)}if(gi(s)){const v=o,C=s.map((S,L)=>S%v);return new zt(C,n.typeInfo)}if(gi(o)){const v=s,C=o.map((S,L)=>v%S);return new zt(C,r.typeInfo)}const l=s,h=o,A=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ie(l%h,A)}case"/":{if(gi(s)&&gi(o)){const v=s,C=o;if(v.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const S=v.map((L,N)=>L/C[N]);return new zt(S,n.typeInfo)}if(gi(s)){const v=o,C=s.map((S,L)=>S/v);return new zt(C,n.typeInfo)}if(gi(o)){const v=s,C=o.map((S,L)=>v/S);return new zt(C,r.typeInfo)}const l=s,h=o,A=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ie(l/h,A)}case"&":{if(gi(s)&&gi(o)){const v=s,C=o;if(v.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const S=v.map((L,N)=>L&C[N]);return new zt(S,n.typeInfo)}if(gi(s)){const v=o,C=s.map((S,L)=>S&v);return new zt(C,n.typeInfo)}if(gi(o)){const v=s,C=o.map((S,L)=>v&S);return new zt(C,r.typeInfo)}const l=s,h=o,A=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ie(l&h,A)}case"|":{if(gi(s)&&gi(o)){const v=s,C=o;if(v.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const S=v.map((L,N)=>L|C[N]);return new zt(S,n.typeInfo)}if(gi(s)){const v=o,C=s.map((S,L)=>S|v);return new zt(C,n.typeInfo)}if(gi(o)){const v=s,C=o.map((S,L)=>v|S);return new zt(C,r.typeInfo)}const l=s,h=o,A=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ie(l|h,A)}case"^":{if(gi(s)&&gi(o)){const v=s,C=o;if(v.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const S=v.map((L,N)=>L^C[N]);return new zt(S,n.typeInfo)}if(gi(s)){const v=o,C=s.map((S,L)=>S^v);return new zt(C,n.typeInfo)}if(gi(o)){const v=s,C=o.map((S,L)=>v^S);return new zt(C,r.typeInfo)}const l=s,h=o,A=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ie(l^h,A)}case"<<":{if(gi(s)&&gi(o)){const v=s,C=o;if(v.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const S=v.map((L,N)=>L<<C[N]);return new zt(S,n.typeInfo)}if(gi(s)){const v=o,C=s.map((S,L)=>S<<v);return new zt(C,n.typeInfo)}if(gi(o)){const v=s,C=o.map((S,L)=>v<<S);return new zt(C,r.typeInfo)}const l=s,h=o,A=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ie(l<<h,A)}case">>":{if(gi(s)&&gi(o)){const v=s,C=o;if(v.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const S=v.map((L,N)=>L>>C[N]);return new zt(S,n.typeInfo)}if(gi(s)){const v=o,C=s.map((S,L)=>S>>v);return new zt(C,n.typeInfo)}if(gi(o)){const v=s,C=o.map((S,L)=>v>>S);return new zt(C,r.typeInfo)}const l=s,h=o,A=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ie(l>>h,A)}case">":if(gi(s)&&gi(o)){const l=s,h=o;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const A=l.map((v,C)=>v>h[C]?1:0);return new zt(A,n.typeInfo)}if(gi(s)){const l=o,h=s.map((A,v)=>A>l?1:0);return new zt(h,n.typeInfo)}if(gi(o)){const l=s,h=o.map((A,v)=>l>A?1:0);return new zt(h,r.typeInfo)}return new ie(s>o?1:0,this.getTypeInfo("bool"));case"<":if(gi(s)&&gi(o)){const l=s,h=o;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const A=l.map((v,C)=>v<h[C]?1:0);return new zt(A,n.typeInfo)}if(gi(s)){const l=o,h=s.map((A,v)=>A<l?1:0);return new zt(h,n.typeInfo)}if(gi(o)){const l=s,h=o.map((A,v)=>l<A?1:0);return new zt(h,r.typeInfo)}return new ie(s<o?1:0,this.getTypeInfo("bool"));case"==":if(gi(s)&&gi(o)){const l=s,h=o;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const A=l.map((v,C)=>v===h[C]?1:0);return new zt(A,n.typeInfo)}if(gi(s)){const l=o,h=s.map((A,v)=>A==l?1:0);return new zt(h,n.typeInfo)}if(gi(o)){const l=s,h=o.map((A,v)=>l==A?1:0);return new zt(h,r.typeInfo)}return new ie(s===o?1:0,this.getTypeInfo("bool"));case"!=":if(gi(s)&&gi(o)){const l=s,h=o;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const A=l.map((v,C)=>v!==h[C]?1:0);return new zt(A,n.typeInfo)}if(gi(s)){const l=o,h=s.map((A,v)=>A!==l?1:0);return new zt(h,n.typeInfo)}if(gi(o)){const l=s,h=o.map((A,v)=>l!==A?1:0);return new zt(h,r.typeInfo)}return new ie(s!==o?1:0,this.getTypeInfo("bool"));case">=":if(gi(s)&&gi(o)){const l=s,h=o;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const A=l.map((v,C)=>v>=h[C]?1:0);return new zt(A,n.typeInfo)}if(gi(s)){const l=o,h=s.map((A,v)=>A>=l?1:0);return new zt(h,n.typeInfo)}if(gi(o)){const l=s,h=o.map((A,v)=>l>=A?1:0);return new zt(h,r.typeInfo)}return new ie(s>=o?1:0,this.getTypeInfo("bool"));case"<=":if(gi(s)&&gi(o)){const l=s,h=o;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const A=l.map((v,C)=>v<=h[C]?1:0);return new zt(A,n.typeInfo)}if(gi(s)){const l=o,h=s.map((A,v)=>A<=l?1:0);return new zt(h,n.typeInfo)}if(gi(o)){const l=s,h=o.map((A,v)=>l<=A?1:0);return new zt(h,r.typeInfo)}return new ie(s<=o?1:0,this.getTypeInfo("bool"));case"&&":if(gi(s)&&gi(o)){const l=s,h=o;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const A=l.map((v,C)=>v&&h[C]?1:0);return new zt(A,n.typeInfo)}if(gi(s)){const l=o,h=s.map((A,v)=>A&&l?1:0);return new zt(h,n.typeInfo)}if(gi(o)){const l=s,h=o.map((A,v)=>l&&A?1:0);return new zt(h,r.typeInfo)}return new ie(s&&o?1:0,this.getTypeInfo("bool"));case"||":if(gi(s)&&gi(o)){const l=s,h=o;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const A=l.map((v,C)=>v||h[C]?1:0);return new zt(A,n.typeInfo)}if(gi(s)){const l=o,h=s.map((A,v)=>A||l?1:0);return new zt(h,n.typeInfo)}if(gi(o)){const l=s,h=o.map((A,v)=>l||A?1:0);return new zt(h,r.typeInfo)}return new ie(s||o?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${t.operator}. Line ${t.line}`),null}_evalCall(t,i){if(t.cachedReturnValue!==null)return t.cachedReturnValue;const n=i.clone();n.currentFunctionName=t.name;const r=i.getFunction(t.name);if(!r)return t.isBuiltin?this._callBuiltinFunction(t,n):this.getTypeInfo(t.name)?this._evalCreate(t,i):(console.error(`Unknown function "${t.name}". Line ${t.line}`),null);for(let s=0;s<r.node.args.length;++s){const o=r.node.args[s],l=this.evalExpression(t.args[s],n);n.createVariable(o.name,l,o)}return this._execStatements(r.node.body,n)}_callBuiltinFunction(t,i){switch(t.name){case"all":return this.builtins.All(t,i);case"any":return this.builtins.Any(t,i);case"select":return this.builtins.Select(t,i);case"arrayLength":return this.builtins.ArrayLength(t,i);case"abs":return this.builtins.Abs(t,i);case"acos":return this.builtins.Acos(t,i);case"acosh":return this.builtins.Acosh(t,i);case"asin":return this.builtins.Asin(t,i);case"asinh":return this.builtins.Asinh(t,i);case"atan":return this.builtins.Atan(t,i);case"atanh":return this.builtins.Atanh(t,i);case"atan2":return this.builtins.Atan2(t,i);case"ceil":return this.builtins.Ceil(t,i);case"clamp":return this.builtins.Clamp(t,i);case"cos":return this.builtins.Cos(t,i);case"cosh":return this.builtins.Cosh(t,i);case"countLeadingZeros":return this.builtins.CountLeadingZeros(t,i);case"countOneBits":return this.builtins.CountOneBits(t,i);case"countTrailingZeros":return this.builtins.CountTrailingZeros(t,i);case"cross":return this.builtins.Cross(t,i);case"degrees":return this.builtins.Degrees(t,i);case"determinant":return this.builtins.Determinant(t,i);case"distance":return this.builtins.Distance(t,i);case"dot":return this.builtins.Dot(t,i);case"dot4U8Packed":return this.builtins.Dot4U8Packed(t,i);case"dot4I8Packed":return this.builtins.Dot4I8Packed(t,i);case"exp":return this.builtins.Exp(t,i);case"exp2":return this.builtins.Exp2(t,i);case"extractBits":return this.builtins.ExtractBits(t,i);case"faceForward":return this.builtins.FaceForward(t,i);case"firstLeadingBit":return this.builtins.FirstLeadingBit(t,i);case"firstTrailingBit":return this.builtins.FirstTrailingBit(t,i);case"floor":return this.builtins.Floor(t,i);case"fma":return this.builtins.Fma(t,i);case"fract":return this.builtins.Fract(t,i);case"frexp":return this.builtins.Frexp(t,i);case"insertBits":return this.builtins.InsertBits(t,i);case"inverseSqrt":return this.builtins.InverseSqrt(t,i);case"ldexp":return this.builtins.Ldexp(t,i);case"length":return this.builtins.Length(t,i);case"log":return this.builtins.Log(t,i);case"log2":return this.builtins.Log2(t,i);case"max":return this.builtins.Max(t,i);case"min":return this.builtins.Min(t,i);case"mix":return this.builtins.Mix(t,i);case"modf":return this.builtins.Modf(t,i);case"normalize":return this.builtins.Normalize(t,i);case"pow":return this.builtins.Pow(t,i);case"quantizeToF16":return this.builtins.QuantizeToF16(t,i);case"radians":return this.builtins.Radians(t,i);case"reflect":return this.builtins.Reflect(t,i);case"refract":return this.builtins.Refract(t,i);case"reverseBits":return this.builtins.ReverseBits(t,i);case"round":return this.builtins.Round(t,i);case"saturate":return this.builtins.Saturate(t,i);case"sign":return this.builtins.Sign(t,i);case"sin":return this.builtins.Sin(t,i);case"sinh":return this.builtins.Sinh(t,i);case"smoothStep":return this.builtins.SmoothStep(t,i);case"sqrt":return this.builtins.Sqrt(t,i);case"step":return this.builtins.Step(t,i);case"tan":return this.builtins.Tan(t,i);case"tanh":return this.builtins.Tanh(t,i);case"transpose":return this.builtins.Transpose(t,i);case"trunc":return this.builtins.Trunc(t,i);case"dpdx":return this.builtins.Dpdx(t,i);case"dpdxCoarse":return this.builtins.DpdxCoarse(t,i);case"dpdxFine":return this.builtins.DpdxFine(t,i);case"dpdy":return this.builtins.Dpdy(t,i);case"dpdyCoarse":return this.builtins.DpdyCoarse(t,i);case"dpdyFine":return this.builtins.DpdyFine(t,i);case"fwidth":return this.builtins.Fwidth(t,i);case"fwidthCoarse":return this.builtins.FwidthCoarse(t,i);case"fwidthFine":return this.builtins.FwidthFine(t,i);case"textureDimensions":return this.builtins.TextureDimensions(t,i);case"textureGather":return this.builtins.TextureGather(t,i);case"textureGatherCompare":return this.builtins.TextureGatherCompare(t,i);case"textureLoad":return this.builtins.TextureLoad(t,i);case"textureNumLayers":return this.builtins.TextureNumLayers(t,i);case"textureNumLevels":return this.builtins.TextureNumLevels(t,i);case"textureNumSamples":return this.builtins.TextureNumSamples(t,i);case"textureSample":return this.builtins.TextureSample(t,i);case"textureSampleBias":return this.builtins.TextureSampleBias(t,i);case"textureSampleCompare":return this.builtins.TextureSampleCompare(t,i);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(t,i);case"textureSampleGrad":return this.builtins.TextureSampleGrad(t,i);case"textureSampleLevel":return this.builtins.TextureSampleLevel(t,i);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(t,i);case"textureStore":return this.builtins.TextureStore(t,i);case"atomicLoad":return this.builtins.AtomicLoad(t,i);case"atomicStore":return this.builtins.AtomicStore(t,i);case"atomicAdd":return this.builtins.AtomicAdd(t,i);case"atomicSub":return this.builtins.AtomicSub(t,i);case"atomicMax":return this.builtins.AtomicMax(t,i);case"atomicMin":return this.builtins.AtomicMin(t,i);case"atomicAnd":return this.builtins.AtomicAnd(t,i);case"atomicOr":return this.builtins.AtomicOr(t,i);case"atomicXor":return this.builtins.AtomicXor(t,i);case"atomicExchange":return this.builtins.AtomicExchange(t,i);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(t,i);case"pack4x8snorm":return this.builtins.Pack4x8snorm(t,i);case"pack4x8unorm":return this.builtins.Pack4x8unorm(t,i);case"pack4xI8":return this.builtins.Pack4xI8(t,i);case"pack4xU8":return this.builtins.Pack4xU8(t,i);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(t,i);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(t,i);case"pack2x16snorm":return this.builtins.Pack2x16snorm(t,i);case"pack2x16unorm":return this.builtins.Pack2x16unorm(t,i);case"pack2x16float":return this.builtins.Pack2x16float(t,i);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(t,i);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(t,i);case"unpack4xI8":return this.builtins.Unpack4xI8(t,i);case"unpack4xU8":return this.builtins.Unpack4xU8(t,i);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(t,i);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(t,i);case"unpack2x16float":return this.builtins.Unpack2x16float(t,i);case"storageBarrier":return this.builtins.StorageBarrier(t,i);case"textureBarrier":return this.builtins.TextureBarrier(t,i);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(t,i);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(t,i);case"subgroupAdd":return this.builtins.SubgroupAdd(t,i);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(t,i);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(t,i);case"subgroupAll":return this.builtins.SubgroupAll(t,i);case"subgroupAnd":return this.builtins.SubgroupAnd(t,i);case"subgroupAny":return this.builtins.SubgroupAny(t,i);case"subgroupBallot":return this.builtins.SubgroupBallot(t,i);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(t,i);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(t,i);case"subgroupElect":return this.builtins.SubgroupElect(t,i);case"subgroupMax":return this.builtins.SubgroupMax(t,i);case"subgroupMin":return this.builtins.SubgroupMin(t,i);case"subgroupMul":return this.builtins.SubgroupMul(t,i);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(t,i);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(t,i);case"subgroupOr":return this.builtins.SubgroupOr(t,i);case"subgroupShuffle":return this.builtins.SubgroupShuffle(t,i);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(t,i);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(t,i);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(t,i);case"subgroupXor":return this.builtins.SubgroupXor(t,i);case"quadBroadcast":return this.builtins.QuadBroadcast(t,i);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(t,i);case"quadSwapX":return this.builtins.QuadSwapX(t,i);case"quadSwapY":return this.builtins.QuadSwapY(t,i)}const n=i.getFunction(t.name);if(n){const r=i.clone();for(let s=0;s<n.node.args.length;++s){const o=n.node.args[s],l=this.evalExpression(t.args[s],r);r.setVariable(o.name,l,o)}return this._execStatements(n.node.body,r)}return null}_callConstructorValue(t,i){if(!t.args||t.args.length===0)return new ie(0,this.getTypeInfo(t.type));const n=this.evalExpression(t.args[0],i);return n.typeInfo=this.getTypeInfo(t.type),n.getSubData(this,t.postfix,i).clone()}_callConstructorVec(t,i){const n=this.getTypeInfo(t.type),r=t.type.getTypeName(),s=Q1[r];if(s===void 0)return console.error(`Invalid vec constructor ${r}. Line ${t.line}`),null;const o=[];if(t instanceof Bo)if(t.isVector){const l=t.vectorValue;for(const h of l)o.push(h)}else o.push(t.scalarValue);else if(t.args)for(const l of t.args){const h=this.evalExpression(l,i);if(h instanceof zt){const A=h.data;for(let v=0;v<A.length;++v){let C=A[v];o.push(C)}}else if(h instanceof ie){let A=h.value;o.push(A)}}if(t.type instanceof ue&&t.type.format===null&&(t.type.format=ue.f32),o.length===0){const l=new Array(s).fill(0);return new zt(l,n).getSubData(this,t.postfix,i)}if(o.length===1)for(;o.length<s;)o.push(o[0]);return o.length<s?(console.error(`Invalid vec constructor. Line ${t.line}`),null):new zt(o.length>s?o.slice(0,s):o,n).getSubData(this,t.postfix,i)}_callConstructorMatrix(t,i){const n=this.getTypeInfo(t.type),r=t.type.getTypeName(),s=Rs[r];if(s===void 0)return console.error(`Invalid matrix constructor ${r}. Line ${t.line}`),null;const o=[];if(t instanceof Bo)if(t.isVector){const l=t.vectorValue;for(const h of l)o.push(h)}else o.push(t.scalarValue);else if(t.args)for(const l of t.args){const h=this.evalExpression(l,i);h instanceof zt?o.push(...h.data):h instanceof ie?o.push(h.value):h instanceof on&&o.push(...h.data)}if(n instanceof Zh&&n.format===null&&(n.format=this.getTypeInfo("f32")),o.length===0){const l=new Array(s[2]).fill(0);return new on(l,n).getSubData(this,t.postfix,i)}return o.length!==s[2]?(console.error(`Invalid matrix constructor. Line ${t.line}`),null):new on(o,n).getSubData(this,t.postfix,i)}}Cs._breakObj=new Xa(new Fa("BREAK",null),null),Cs._continueObj=new Xa(new Fa("CONTINUE",null),null),Cs._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class EH{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class BH{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new EH,this._exec=new Cs,this._forwardTypeCount=0}parse(t){this._initialize(t),this._deferArrayCountEval.length=0;const i=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;i.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const r=n.arrayType,s=n.countNode;if(s instanceof ha){const o=s.name,l=this._context.constants.get(o);if(l)try{const h=l.constEvaluate(this._exec);r.count=h}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const n of i)n.search(r=>{r instanceof pI||r instanceof J1?r.type=this._forwardType(r.type):r instanceof XA?r.format=this._forwardType(r.format):r instanceof Xc||r instanceof WA||r instanceof A0?r.type=this._forwardType(r.type):r instanceof HA?r.returnType=this._forwardType(r.returnType):r instanceof dI&&(r.type=this._forwardType(r.type))});return i}_forwardType(t){if(t instanceof sI){const i=this._getType(t.name);if(i)return i}else t instanceof J1?t.type=this._forwardType(t.type):t instanceof XA&&(t.format=this._forwardType(t.format));return t}_initialize(t){if(t)if(typeof t=="string"){const i=new AH(t);this._tokens=i.scanTokens()}else this._tokens=t;else this._tokens=[];this._current=0}_updateNode(t,i){return t.line=i??this._currentLine,t}_error(t,i){return{token:t,message:i,toString:()=>`${i}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==Ot.eof}_match(t){if(t instanceof oe)return!!this._check(t)&&(this._advance(),!0);for(let i=0,n=t.length;i<n;++i){const r=t[i];if(this._check(r))return this._advance(),!0}return!1}_consume(t,i){if(this._check(t))return this._advance();throw this._error(this._peek(),`${i}. Line:${this._currentLine}`)}_check(t){if(this._isAtEnd())return!1;const i=this._peek();if(t instanceof Array){const n=i.type;let r=!1;for(const s of t){if(n===s)return!0;s===Ot.tokens.name&&(r=!0)}if(r){const s=Ot.tokens.name.rule.exec(i.lexeme);if(s&&s.index==0&&s[0]==i.lexeme)return!0}return!1}if(i.type===t)return!0;if(t===Ot.tokens.name){const n=Ot.tokens.name.rule.exec(i.lexeme);return n&&n.index==0&&n[0]==i.lexeme}return!1}_advance(){var t,i;return this._currentLine=(i=(t=this._peek())===null||t===void 0?void 0:t.line)!==null&&i!==void 0?i:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(Ot.tokens.semicolon)&&!this._isAtEnd(););if(this._match(Ot.keywords.alias)){const i=this._type_alias();return this._consume(Ot.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([i]),i}if(this._match(Ot.keywords.diagnostic)){const i=this._diagnostic();return this._consume(Ot.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([i]),i}if(this._match(Ot.keywords.requires)){const i=this._requires_directive();return this._consume(Ot.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([i]),i}if(this._match(Ot.keywords.enable)){const i=this._enable_directive();return this._consume(Ot.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([i]),i}const t=this._attribute();if(this._check(Ot.keywords.var)){const i=this._global_variable_decl();return i!=null&&(i.attributes=t),this._consume(Ot.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([i]),i}if(this._check(Ot.keywords.override)){const i=this._override_variable_decl();return i!=null&&(i.attributes=t),this._consume(Ot.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([i]),i}if(this._check(Ot.keywords.let)){const i=this._global_let_decl();return i!=null&&(i.attributes=t),this._consume(Ot.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([i]),i}if(this._check(Ot.keywords.const)){const i=this._global_const_decl();return i!=null&&(i.attributes=t),this._consume(Ot.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([i]),i}if(this._check(Ot.keywords.struct)){const i=this._struct_decl();return i!=null&&(i.attributes=t),this._exec.reflection.updateAST([i]),i}if(this._check(Ot.keywords.fn)){const i=this._function_decl();return i!=null&&(i.attributes=t),this._exec.reflection.updateAST([i]),i}return null}_function_decl(){if(!this._match(Ot.keywords.fn))return null;const t=this._currentLine,i=this._consume(Ot.tokens.ident,"Expected function name.").toString();this._consume(Ot.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(Ot.tokens.paren_right))do{if(this._check(Ot.tokens.paren_right))break;const l=this._attribute(),h=this._consume(Ot.tokens.name,"Expected argument name.").toString();this._consume(Ot.tokens.colon,"Expected ':' for argument type.");const A=this._attribute(),v=this._type_decl();v!=null&&(v.attributes=A,n.push(this._updateNode(new dI(h,v,l))))}while(this._match(Ot.tokens.comma));this._consume(Ot.tokens.paren_right,"Expected ')' after function arguments.");let r=null;if(this._match(Ot.tokens.arrow)){const l=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=l)}const s=this._compound_statement(),o=this._currentLine;return this._updateNode(new HA(i,n,r,s,t,o),t)}_compound_statement(){const t=[];for(this._consume(Ot.tokens.brace_left,"Expected '{' for block.");!this._check(Ot.tokens.brace_right);){const i=this._statement();i!==null&&t.push(i)}return this._consume(Ot.tokens.brace_right,"Expected '}' for block."),t}_statement(){for(;this._match(Ot.tokens.semicolon)&&!this._isAtEnd(););if(this._check(Ot.tokens.attr)&&this._attribute(),this._check(Ot.keywords.if))return this._if_statement();if(this._check(Ot.keywords.switch))return this._switch_statement();if(this._check(Ot.keywords.loop))return this._loop_statement();if(this._check(Ot.keywords.for))return this._for_statement();if(this._check(Ot.keywords.while))return this._while_statement();if(this._check(Ot.keywords.continuing))return this._continuing_statement();if(this._check(Ot.keywords.static_assert))return this._static_assert_statement();if(this._check(Ot.tokens.brace_left))return this._compound_statement();let t=null;if(this._check(Ot.keywords.return))t=this._return_statement();else if(this._check([Ot.keywords.var,Ot.keywords.let,Ot.keywords.const]))t=this._variable_statement();else if(this._match(Ot.keywords.discard))t=this._updateNode(new fH);else if(this._match(Ot.keywords.break)){const i=this._updateNode(new rI);if(this._currentLoop.length>0){const n=this._currentLoop[this._currentLoop.length-1];i.loopId=n.id}t=i,this._check(Ot.keywords.if)&&(this._advance(),i.condition=this._optional_paren_expression())}else if(this._match(Ot.keywords.continue)){const i=this._updateNode(new oI);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${i.line}`);{const n=this._currentLoop[this._currentLoop.length-1];i.loopId=n.id}t=i}else t=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return t!=null&&this._consume(Ot.tokens.semicolon,"Expected ';' after statement."),t}_static_assert_statement(){if(!this._match(Ot.keywords.static_assert))return null;const t=this._currentLine,i=this._optional_paren_expression();return this._updateNode(new cH(i),t)}_while_statement(){if(!this._match(Ot.keywords.while))return null;const t=this._updateNode(new QS(null,null));return this._currentLoop.push(t),t.condition=this._optional_paren_expression(),this._check(Ot.tokens.attr)&&this._attribute(),t.body=this._compound_statement(),this._currentLoop.pop(),t}_continuing_statement(){const t=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(Ot.keywords.continuing))return null;const i=this._currentLine,n=this._compound_statement();return this._updateNode(new V1(n,t),i)}_for_statement(){if(!this._match(Ot.keywords.for))return null;this._consume(Ot.tokens.paren_left,"Expected '('.");const t=this._updateNode(new ZS(null,null,null,null));return this._currentLoop.push(t),t.init=this._check(Ot.tokens.semicolon)?null:this._for_init(),this._consume(Ot.tokens.semicolon,"Expected ';'."),t.condition=this._check(Ot.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(Ot.tokens.semicolon,"Expected ';'."),t.increment=this._check(Ot.tokens.paren_right)?null:this._for_increment(),this._consume(Ot.tokens.paren_right,"Expected ')'."),this._check(Ot.tokens.attr)&&this._attribute(),t.body=this._compound_statement(),this._currentLoop.pop(),t}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(Ot.keywords.var)){const t=this._variable_decl();if(t===null)throw this._error(this._peek(),"Variable declaration expected.");let i=null;return this._match(Ot.tokens.equal)&&(i=this._short_circuit_or_expression()),this._updateNode(new Xc(t.name,t.type,t.storage,t.access,i),t.line)}if(this._match(Ot.keywords.let)){const t=this._currentLine,i=this._consume(Ot.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(Ot.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}this._consume(Ot.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return this._updateNode(new WA(i,n,null,null,r),t)}if(this._match(Ot.keywords.const)){const t=this._currentLine,i=this._consume(Ot.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(Ot.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}this._consume(Ot.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return n===null&&r instanceof Bo&&(n=r.type),this._updateNode(new A0(i,n,null,null,r),t)}return null}_increment_decrement_statement(){const t=this._current,i=this._unary_expression();if(i==null)return null;if(!this._check(Ot.increment_operators))return this._current=t,null;const n=this._consume(Ot.increment_operators,"Expected increment operator");return this._updateNode(new YS(n.type===Ot.tokens.plus_plus?Od.increment:Od.decrement,i))}_assignment_statement(){let t=null;const i=this._currentLine;if(this._check(Ot.tokens.brace_right))return null;let n=this._match(Ot.tokens.underscore);if(n||(t=this._unary_expression()),!n&&t==null)return null;const r=this._consume(Ot.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return this._updateNode(new qS(JA.parse(r.lexeme),t,s),i)}_func_call_statement(){if(!this._check(Ot.tokens.ident))return null;const t=this._currentLine,i=this._current,n=this._consume(Ot.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=i,null):this._updateNode(new H1(n.lexeme,r),t)}_loop_statement(){if(!this._match(Ot.keywords.loop))return null;this._check(Ot.tokens.attr)&&this._attribute(),this._consume(Ot.tokens.brace_left,"Expected '{' for loop.");const t=this._updateNode(new $S([],null));this._currentLoop.push(t);let i=this._statement();for(;i!==null;){if(Array.isArray(i))for(let n of i)t.body.push(n);else t.body.push(i);if(i instanceof V1){t.continuing=i;break}i=this._statement()}return this._currentLoop.pop(),this._consume(Ot.tokens.brace_right,"Expected '}' for loop."),t}_switch_statement(){if(!this._match(Ot.keywords.switch))return null;const t=this._updateNode(new tI(null,[]));if(this._currentLoop.push(t),t.condition=this._optional_paren_expression(),this._check(Ot.tokens.attr)&&this._attribute(),this._consume(Ot.tokens.brace_left,"Expected '{' for switch."),t.cases=this._switch_body(),t.cases==null||t.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(Ot.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),t}_switch_body(){const t=[];let i=!1;for(;this._check([Ot.keywords.default,Ot.keywords.case]);){if(this._match(Ot.keywords.case)){const n=this._case_selectors();for(const s of n)if(s instanceof g0){if(i)throw this._error(this._previous(),"Multiple default cases in switch statement.");i=!0;break}this._match(Ot.tokens.colon),this._check(Ot.tokens.attr)&&this._attribute(),this._consume(Ot.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(Ot.tokens.brace_right,"Exected '}' for switch case."),t.push(this._updateNode(new hI(n,r)))}if(this._match(Ot.keywords.default)){if(i)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(Ot.tokens.colon),this._check(Ot.tokens.attr)&&this._attribute(),this._consume(Ot.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(Ot.tokens.brace_right,"Exected '}' for switch default."),t.push(this._updateNode(new fI(n)))}}return t}_case_selectors(){const t=[];for(this._match(Ot.keywords.default)?t.push(this._updateNode(new g0)):t.push(this._shift_expression());this._match(Ot.tokens.comma);)this._match(Ot.keywords.default)?t.push(this._updateNode(new g0)):t.push(this._shift_expression());return t}_case_body(){if(this._match(Ot.keywords.fallthrough))return this._consume(Ot.tokens.semicolon,"Expected ';'"),[];let t=this._statement();if(t==null)return[];t instanceof Array||(t=[t]);const i=this._case_body();return i.length==0?t:[...t,i[0]]}_if_statement(){if(!this._match(Ot.keywords.if))return null;const t=this._currentLine,i=this._optional_paren_expression();this._check(Ot.tokens.attr)&&this._attribute();const n=this._compound_statement();let r=[];this._match_elseif()&&(this._check(Ot.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let s=null;return this._match(Ot.keywords.else)&&(this._check(Ot.tokens.attr)&&this._attribute(),s=this._compound_statement()),this._updateNode(new eI(i,n,r,s),t)}_match_elseif(){return this._tokens[this._current].type===Ot.keywords.else&&this._tokens[this._current+1].type===Ot.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(t=[]){const i=this._optional_paren_expression(),n=this._compound_statement();return t.push(this._updateNode(new dH(i,n))),this._match_elseif()&&(this._check(Ot.tokens.attr)&&this._attribute(),this._elseif_statement(t)),t}_return_statement(){if(!this._match(Ot.keywords.return))return null;const t=this._short_circuit_or_expression();return this._updateNode(new iI(t))}_short_circuit_or_expression(){let t=this._short_circuit_and_expr();for(;this._match(Ot.tokens.or_or);)t=this._updateNode(new fl(this._previous().toString(),t,this._short_circuit_and_expr()));return t}_short_circuit_and_expr(){let t=this._inclusive_or_expression();for(;this._match(Ot.tokens.and_and);)t=this._updateNode(new fl(this._previous().toString(),t,this._inclusive_or_expression()));return t}_inclusive_or_expression(){let t=this._exclusive_or_expression();for(;this._match(Ot.tokens.or);)t=this._updateNode(new fl(this._previous().toString(),t,this._exclusive_or_expression()));return t}_exclusive_or_expression(){let t=this._and_expression();for(;this._match(Ot.tokens.xor);)t=this._updateNode(new fl(this._previous().toString(),t,this._and_expression()));return t}_and_expression(){let t=this._equality_expression();for(;this._match(Ot.tokens.and);)t=this._updateNode(new fl(this._previous().toString(),t,this._equality_expression()));return t}_equality_expression(){const t=this._relational_expression();return this._match([Ot.tokens.equal_equal,Ot.tokens.not_equal])?this._updateNode(new fl(this._previous().toString(),t,this._relational_expression())):t}_relational_expression(){let t=this._shift_expression();for(;this._match([Ot.tokens.less_than,Ot.tokens.greater_than,Ot.tokens.less_than_equal,Ot.tokens.greater_than_equal]);)t=this._updateNode(new fl(this._previous().toString(),t,this._shift_expression()));return t}_shift_expression(){let t=this._additive_expression();for(;this._match([Ot.tokens.shift_left,Ot.tokens.shift_right]);)t=this._updateNode(new fl(this._previous().toString(),t,this._additive_expression()));return t}_additive_expression(){let t=this._multiplicative_expression();for(;this._match([Ot.tokens.plus,Ot.tokens.minus]);)t=this._updateNode(new fl(this._previous().toString(),t,this._multiplicative_expression()));return t}_multiplicative_expression(){let t=this._unary_expression();for(;this._match([Ot.tokens.star,Ot.tokens.forward_slash,Ot.tokens.modulo]);)t=this._updateNode(new fl(this._previous().toString(),t,this._unary_expression()));return t}_unary_expression(){return this._match([Ot.tokens.minus,Ot.tokens.bang,Ot.tokens.tilde,Ot.tokens.star,Ot.tokens.and])?this._updateNode(new Ao(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const t=this._primary_expression(),i=this._postfix_expression();return i&&(t.postfix=i),t}_postfix_expression(){if(this._match(Ot.tokens.bracket_left)){const t=this._short_circuit_or_expression();this._consume(Ot.tokens.bracket_right,"Expected ']'.");const i=this._updateNode(new Ld(t)),n=this._postfix_expression();return n&&(i.postfix=n),i}if(this._match(Ot.tokens.period)){const t=this._consume(Ot.tokens.name,"Expected member name."),i=this._postfix_expression(),n=this._updateNode(new Yh(t.lexeme));return i&&(n.postfix=i),n}return null}_getStruct(t){return this._context.aliases.has(t)?this._context.aliases.get(t).type:this._context.structs.has(t)?this._context.structs.get(t):null}_getType(t){const i=this._getStruct(t);if(i!==null)return i;switch(t){case"void":return Ue.void;case"bool":return Ue.bool;case"i32":return Ue.i32;case"u32":return Ue.u32;case"f32":return Ue.f32;case"f16":return Ue.f16;case"vec2f":return ue.vec2f;case"vec3f":return ue.vec3f;case"vec4f":return ue.vec4f;case"vec2i":return ue.vec2i;case"vec3i":return ue.vec3i;case"vec4i":return ue.vec4i;case"vec2u":return ue.vec2u;case"vec3u":return ue.vec3u;case"vec4u":return ue.vec4u;case"vec2h":return ue.vec2h;case"vec3h":return ue.vec3h;case"vec4h":return ue.vec4h;case"mat2x2f":return ue.mat2x2f;case"mat2x3f":return ue.mat2x3f;case"mat2x4f":return ue.mat2x4f;case"mat3x2f":return ue.mat3x2f;case"mat3x3f":return ue.mat3x3f;case"mat3x4f":return ue.mat3x4f;case"mat4x2f":return ue.mat4x2f;case"mat4x3f":return ue.mat4x3f;case"mat4x4f":return ue.mat4x4f;case"mat2x2h":return ue.mat2x2h;case"mat2x3h":return ue.mat2x3h;case"mat2x4h":return ue.mat2x4h;case"mat3x2h":return ue.mat3x2h;case"mat3x3h":return ue.mat3x3h;case"mat3x4h":return ue.mat3x4h;case"mat4x2h":return ue.mat4x2h;case"mat4x3h":return ue.mat4x3h;case"mat4x4h":return ue.mat4x4h;case"mat2x2i":return ue.mat2x2i;case"mat2x3i":return ue.mat2x3i;case"mat2x4i":return ue.mat2x4i;case"mat3x2i":return ue.mat3x2i;case"mat3x3i":return ue.mat3x3i;case"mat3x4i":return ue.mat3x4i;case"mat4x2i":return ue.mat4x2i;case"mat4x3i":return ue.mat4x3i;case"mat4x4i":return ue.mat4x4i;case"mat2x2u":return ue.mat2x2u;case"mat2x3u":return ue.mat2x3u;case"mat2x4u":return ue.mat2x4u;case"mat3x2u":return ue.mat3x2u;case"mat3x3u":return ue.mat3x3u;case"mat3x4u":return ue.mat3x4u;case"mat4x2u":return ue.mat4x2u;case"mat4x3u":return ue.mat4x3u;case"mat4x4u":return ue.mat4x4u}return null}_validateTypeRange(t,i){if(i.name==="i32"){if(t<-2147483648||t>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${t}. Line: ${this._currentLine}.`)}else if(i.name==="u32"&&(t<0||t>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${t}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(Ot.tokens.ident)){const n=this._previous().toString();if(this._check(Ot.tokens.paren_left)){const r=this._argument_expression_list(),s=this._getType(n);return s!==null?this._updateNode(new oc(s,r)):this._updateNode(new X1(n,r))}if(this._context.constants.has(n)){const r=this._context.constants.get(n);return this._updateNode(new aI(n,r.value))}return this._updateNode(new ha(n))}if(this._match(Ot.tokens.int_literal)){const n=this._previous().toString();let r=n.endsWith("i")||n.endsWith("i")?Ue.i32:n.endsWith("u")||n.endsWith("U")?Ue.u32:Ue.x32;const s=parseInt(n);return this._validateTypeRange(s,r),this._updateNode(new Bo(new ie(s,this._exec.getTypeInfo(r)),r))}if(this._match(Ot.tokens.uint_literal)){const n=parseInt(this._previous().toString());return this._validateTypeRange(n,Ue.u32),this._updateNode(new Bo(new ie(n,this._exec.getTypeInfo(Ue.u32)),Ue.u32))}if(this._match([Ot.tokens.decimal_float_literal,Ot.tokens.hex_float_literal])){let n=this._previous().toString(),r=n.endsWith("h");r&&(n=n.substring(0,n.length-1));const s=parseFloat(n);this._validateTypeRange(s,r?Ue.f16:Ue.f32);const o=r?Ue.f16:Ue.f32;return this._updateNode(new Bo(new ie(s,this._exec.getTypeInfo(o)),o))}if(this._match([Ot.keywords.true,Ot.keywords.false])){let n=this._previous().toString()===Ot.keywords.true.rule;return this._updateNode(new Bo(new ie(n?1:0,this._exec.getTypeInfo(Ue.bool)),Ue.bool))}if(this._check(Ot.tokens.paren_left))return this._paren_expression();if(this._match(Ot.keywords.bitcast)){this._consume(Ot.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(Ot.tokens.greater_than,"Expected '>'.");const r=this._paren_expression();return this._updateNode(new lI(n,r))}const t=this._type_decl(),i=this._argument_expression_list();return this._updateNode(new oc(t,i))}_argument_expression_list(){if(!this._match(Ot.tokens.paren_left))return null;const t=[];do{if(this._check(Ot.tokens.paren_right))break;const i=this._short_circuit_or_expression();t.push(i)}while(this._match(Ot.tokens.comma));return this._consume(Ot.tokens.paren_right,"Expected ')' for agument list"),t}_optional_paren_expression(){this._match(Ot.tokens.paren_left);const t=this._short_circuit_or_expression();return this._match(Ot.tokens.paren_right),t}_paren_expression(){this._consume(Ot.tokens.paren_left,"Expected '('.");const t=this._short_circuit_or_expression();return this._consume(Ot.tokens.paren_right,"Expected ')'."),t}_struct_decl(){if(!this._match(Ot.keywords.struct))return null;const t=this._currentLine,i=this._consume(Ot.tokens.ident,"Expected name for struct.").toString();this._consume(Ot.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(Ot.tokens.brace_right);){const o=this._attribute(),l=this._consume(Ot.tokens.name,"Expected variable name.").toString();this._consume(Ot.tokens.colon,"Expected ':' for struct member type.");const h=this._attribute(),A=this._type_decl();A!=null&&(A.attributes=h),this._check(Ot.tokens.brace_right)?this._match(Ot.tokens.comma):this._consume(Ot.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new pI(l,A,o)))}this._consume(Ot.tokens.brace_right,"Expected '}' after struct body.");const r=this._currentLine,s=this._updateNode(new Kc(i,n,t,r),t);return this._context.structs.set(i,s),s}_global_variable_decl(){const t=this._variable_decl();if(!t)return null;if(this._match(Ot.tokens.equal)){const i=this._const_expression();t.value=i}if(t.type!==null&&t.value instanceof Bo){if(t.value.type.name!=="x32"&&t.type.getTypeName()!==t.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${t.value.type.name} to ${t.type.name}. Line:${this._currentLine}`);t.value.isScalar&&this._validateTypeRange(t.value.scalarValue,t.type),t.value.type=t.type}else t.type===null&&t.value instanceof Bo&&(t.type=t.value.type.name==="x32"?Ue.i32:t.value.type,t.value.isScalar&&this._validateTypeRange(t.value.scalarValue,t.type));return t}_override_variable_decl(){const t=this._override_decl();return t&&this._match(Ot.tokens.equal)&&(t.value=this._const_expression()),t}_global_const_decl(){var t;if(!this._match(Ot.keywords.const))return null;const i=this._consume(Ot.tokens.name,"Expected variable name"),n=this._currentLine;let r=null;if(this._match(Ot.tokens.colon)){const h=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=h)}let s=null;this._consume(Ot.tokens.equal,"const declarations require an assignment");const o=this._short_circuit_or_expression();try{let h=[Ue.f32],A=o.constEvaluate(this._exec,h);A instanceof ie&&this._validateTypeRange(A.value,h[0]),h[0]instanceof ue&&h[0].format===null&&A.typeInfo instanceof Zh&&A.typeInfo.format!==null&&(A.typeInfo.format.name==="f16"?h[0].format=Ue.f16:A.typeInfo.format.name==="f32"?h[0].format=Ue.f32:A.typeInfo.format.name==="i32"?h[0].format=Ue.i32:A.typeInfo.format.name==="u32"?h[0].format=Ue.u32:A.typeInfo.format.name==="bool"?h[0].format=Ue.bool:console.error(`TODO: impelement template format type ${A.typeInfo.format.name}`)),s=this._updateNode(new Bo(A,h[0])),this._exec.context.setVariable(i.toString(),A)}catch{s=o}if(r!==null&&s instanceof Bo){if(s.type.name!=="x32"&&r.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${r.name}. Line:${this._currentLine}`);s.type=r,s.isScalar&&this._validateTypeRange(s.scalarValue,s.type)}else r===null&&s instanceof Bo&&(r=(t=s==null?void 0:s.type)!==null&&t!==void 0?t:Ue.f32,r===Ue.x32&&(r=Ue.i32));const l=this._updateNode(new A0(i.toString(),r,"","",s),n);return this._context.constants.set(l.name,l),l}_global_let_decl(){if(!this._match(Ot.keywords.let))return null;const t=this._currentLine,i=this._consume(Ot.tokens.name,"Expected variable name");let n=null;if(this._match(Ot.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}let r=null;if(this._match(Ot.tokens.equal)&&(r=this._const_expression()),n!==null&&r instanceof Bo){if(r.type.name!=="x32"&&n.getTypeName()!==r.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${r.type.name} to ${n.name}. Line:${this._currentLine}`);r.type=n}else n===null&&r instanceof Bo&&(n=r.type.name==="x32"?Ue.i32:r.type);return r instanceof Bo&&r.isScalar&&this._validateTypeRange(r.scalarValue,n),this._updateNode(new WA(i.toString(),n,"","",r),t)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(Ot.keywords.var))return null;const t=this._currentLine;let i="",n="";this._match(Ot.tokens.less_than)&&(i=this._consume(Ot.storage_class,"Expected storage_class.").toString(),this._match(Ot.tokens.comma)&&(n=this._consume(Ot.access_mode,"Expected access_mode.").toString()),this._consume(Ot.tokens.greater_than,"Expected '>'."));const r=this._consume(Ot.tokens.name,"Expected variable name");let s=null;if(this._match(Ot.tokens.colon)){const o=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=o)}return this._updateNode(new Xc(r.toString(),s,i,n,null),t)}_override_decl(){if(!this._match(Ot.keywords.override))return null;const t=this._consume(Ot.tokens.name,"Expected variable name");let i=null;if(this._match(Ot.tokens.colon)){const n=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=n)}return this._updateNode(new j1(t.toString(),i,null))}_diagnostic(){this._consume(Ot.tokens.paren_left,"Expected '('");const t=this._consume(Ot.tokens.ident,"Expected severity control name.");this._consume(Ot.tokens.comma,"Expected ','");let i=this._consume(Ot.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(Ot.tokens.period)&&(i+=`.${this._consume(Ot.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(Ot.tokens.paren_right,"Expected ')'"),this._updateNode(new nI(t.toString(),i))}_enable_directive(){const t=this._consume(Ot.tokens.ident,"identity expected.");return this._updateNode(new uH(t.toString()))}_requires_directive(){const t=[this._consume(Ot.tokens.ident,"identity expected.").toString()];for(;this._match(Ot.tokens.comma);){const i=this._consume(Ot.tokens.ident,"identity expected.");t.push(i.toString())}return this._updateNode(new hH(t))}_type_alias(){const t=this._consume(Ot.tokens.ident,"identity expected.");this._consume(Ot.tokens.equal,"Expected '=' for type alias.");let i=this._type_decl();if(i===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);const n=this._updateNode(new W1(t.toString(),i));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([Ot.tokens.ident,...Ot.texel_format,Ot.keywords.bool,Ot.keywords.f32,Ot.keywords.i32,Ot.keywords.u32])){const n=this._advance().toString();if(this._context.structs.has(n))return this._context.structs.get(n);if(this._context.aliases.has(n))return this._context.aliases.get(n).type;if(!this._getType(n)){const r=this._updateNode(new sI(n));return this._forwardTypeCount++,r}return this._updateNode(new Ue(n))}let t=this._texture_sampler_types();if(t)return t;if(this._check(Ot.template_types)){let n=this._advance().toString(),r=null,s=null;return this._match(Ot.tokens.less_than)&&(r=this._type_decl(),s=null,this._match(Ot.tokens.comma)&&(s=this._consume(Ot.access_mode,"Expected access_mode for pointer").toString()),this._consume(Ot.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new ue(n,r,s))}if(this._match(Ot.keywords.ptr)){let n=this._previous().toString();this._consume(Ot.tokens.less_than,"Expected '<' for pointer.");const r=this._consume(Ot.storage_class,"Expected storage_class for pointer");this._consume(Ot.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let o=null;return this._match(Ot.tokens.comma)&&(o=this._consume(Ot.access_mode,"Expected access_mode for pointer").toString()),this._consume(Ot.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new J1(n,r.toString(),s,o))}const i=this._attribute();if(this._match(Ot.keywords.array)){let n=null,r=-1;const s=this._previous();let o=null;if(this._match(Ot.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let h="";if(this._match(Ot.tokens.comma)){o=this._shift_expression();try{h=o.constEvaluate(this._exec).toString(),o=null}catch{h="1"}}this._consume(Ot.tokens.greater_than,"Expected '>' for array."),r=h?parseInt(h):0}const l=this._updateNode(new XA(s.toString(),i,n,r));return o&&this._deferArrayCountEval.push({arrayType:l,countNode:o}),l}return null}_texture_sampler_types(){if(this._match(Ot.sampler_type))return this._updateNode(new KA(this._previous().toString(),null,null));if(this._match(Ot.depth_texture_type))return this._updateNode(new KA(this._previous().toString(),null,null));if(this._match(Ot.sampled_texture_type)||this._match(Ot.multisampled_texture_type)){const t=this._previous();this._consume(Ot.tokens.less_than,"Expected '<' for sampler type.");const i=this._type_decl();return this._consume(Ot.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new KA(t.toString(),i,null))}if(this._match(Ot.storage_texture_type)){const t=this._previous();this._consume(Ot.tokens.less_than,"Expected '<' for sampler type.");const i=this._consume(Ot.texel_format,"Invalid texel format.").toString();this._consume(Ot.tokens.comma,"Expected ',' after texel format.");const n=this._consume(Ot.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(Ot.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new KA(t.toString(),i,n))}return null}_attribute(){let t=[];for(;this._match(Ot.tokens.attr);){const i=this._consume(Ot.attribute_name,"Expected attribute name"),n=this._updateNode(new AI(i.toString(),null));if(this._match(Ot.tokens.paren_left)){if(n.value=this._consume(Ot.literal_or_ident,"Expected attribute value").toString(),this._check(Ot.tokens.comma)){this._advance();do{const r=this._consume(Ot.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(r)}while(this._match(Ot.tokens.comma))}this._consume(Ot.tokens.paren_right,"Expected ')'")}t.push(n)}return t.length==0?null:t}}class TH extends bc{constructor(t){super(),t&&this.update(t)}update(t){const i=new BH().parse(t);this.updateAST(i)}}function SH(e){var t;const i={attributes:[],bindings:[]};let n;try{n=IH(e)}catch(o){return ti.error(o.message)(),i}for(const o of n.uniforms){const l=[];for(const h of((t=o.type)==null?void 0:t.members)||[])l.push({name:h.name,type:yI(h.type)});i.bindings.push({type:"uniform",name:o.name,group:o.group,location:o.binding,members:l})}for(const o of n.textures)i.bindings.push({type:"texture",name:o.name,group:o.group,location:o.binding});for(const o of n.samplers)i.bindings.push({type:"sampler",name:o.name,group:o.group,location:o.binding});const r=n.entry.vertex[0],s=(r==null?void 0:r.inputs.length)||0;for(let o=0;o<s;o++){const l=r.inputs[o];if(l.locationType==="location"){const h=yI(l.type);i.attributes.push({name:l.name,location:Number(l.location),type:h})}}return i}function yI(e){return e.format?`${e.name}<${e.format.name}>`:e.name}function IH(e){try{return new TH(e)}catch(t){if(t instanceof Error)throw t;let i="WGSL parse error";throw typeof t=="object"&&t!=null&&t.message&&(i+=`: ${t.message} `),typeof t=="object"&&t!=null&&t.token&&(i+=t.token.line||""),new Error(i,{cause:t})}}const MH=1/Math.PI*180,PH=1/180*Math.PI,RH={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...RH}};const To=globalThis.mathgl.config;function DH(e,{precision:t=To.precision}={}){return e=kH(e),`${parseFloat(e.toPrecision(t))}`}function Qu(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function OH(e){return FH(e)}function LH(e){return dl(e)}function FH(e,t){return Z1(e,i=>i*PH,t)}function dl(e,t){return Z1(e,i=>i*MH,t)}function Qc(e,t,i){return Z1(e,n=>Math.max(t,Math.min(i,n)))}function pl(e,t,i){return Qu(e)?e.map((n,r)=>pl(n,t[r],i)):i*t+(1-i)*e}function fa(e,t,i){const n=To.EPSILON;i&&(To.EPSILON=i);try{if(e===t)return!0;if(Qu(e)&&Qu(t)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!fa(e[r],t[r]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=To.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{To.EPSILON=n}}function kH(e){return Math.round(e/To.EPSILON)*To.EPSILON}function NH(e){return e.clone?e.clone():new Array(e.length)}function Z1(e,t,i){if(Qu(e)){const n=e;i=i||NH(n);for(let r=0;r<i.length&&r<n.length;++r){const s=typeof e=="number"?e:e[r];i[r]=t(s,r,i)}return i}return t(e)}class Y1 extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,i=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+i];return this.check()}toArray(t=[],i=0){for(let n=0;n<this.ELEMENTS;++n)t[i+n]=this[n];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:Qu(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(To)}formatString(t){let i="";for(let n=0;n<this.ELEMENTS;++n)i+=(n>0?", ":"")+DH(this[n],t);return`${t.printTypes?this.constructor.name:""}[${i}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(!fa(this[i],t[i]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(this[i]!==t[i])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,i,n){if(n===void 0)return this.lerp(this,t,i);for(let r=0;r<this.ELEMENTS;++r){const s=t[r],o=typeof i=="number"?i:i[r];this[r]=s+n*(o-s)}return this.check()}min(t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(t[i],this[i]);return this.check()}max(t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.max(t[i],this[i]);return this.check()}clamp(t,i){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),i[n]);return this.check()}add(...t){for(const i of t)for(let n=0;n<this.ELEMENTS;++n)this[n]+=i[n];return this.check()}subtract(...t){for(const i of t)for(let n=0;n<this.ELEMENTS;++n)this[n]-=i[n];return this.check()}scale(t){if(typeof t=="number")for(let i=0;i<this.ELEMENTS;++i)this[i]*=t;else for(let i=0;i<this.ELEMENTS&&i<t.length;++i)this[i]*=t[i];return this.check()}multiplyByScalar(t){for(let i=0;i<this.ELEMENTS;++i)this[i]*=t;return this.check()}check(){if(To.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let i=0;i<this.ELEMENTS;++i)t=t&&Number.isFinite(this[i]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let i=0;i<this.ELEMENTS;++i)this[i]=t;return this.check()}addScalar(t){for(let i=0;i<this.ELEMENTS;++i)this[i]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let i=0;i<this.ELEMENTS;++i)this[i]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,i){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),i);return this.check()}get elements(){return this}}function UH(e,t){if(e.length!==t)return!1;for(let i=0;i<e.length;++i)if(!Number.isFinite(e[i]))return!1;return!0}function qn(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function QA(e,t,i=""){if(To.debug&&!UH(e,t))throw new Error(`math.gl: ${i} some fields set to invalid numbers'`);return e}function Al(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}class q1 extends Y1{get x(){return this[0]}set x(t){this[0]=qn(t)}get y(){return this[1]}set y(t){this[1]=qn(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let i=0;i<this.ELEMENTS;++i)t+=this[i]*this[i];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let i=0;for(let n=0;n<this.ELEMENTS;++n){const r=this[n]-t[n];i+=r*r}return qn(i)}dot(t){let i=0;for(let n=0;n<this.ELEMENTS;++n)i+=this[n]*t[n];return qn(i)}normalize(){const t=this.magnitude();if(t!==0)for(let i=0;i<this.ELEMENTS;++i)this[i]/=t;return this.check()}multiply(...t){for(const i of t)for(let n=0;n<this.ELEMENTS;++n)this[n]*=i[n];return this.check()}divide(...t){for(const i of t)for(let n=0;n<this.ELEMENTS;++n)this[n]/=i[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return Al(t>=0&&t<this.ELEMENTS,"index is out of range"),qn(this[t])}setComponent(t,i){return Al(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=i,this.check()}addVectors(t,i){return this.copy(t).add(i)}subVectors(t,i){return this.copy(t).subtract(i)}multiplyVectors(t,i){return this.copy(t).multiply(i)}addScaledVector(t,i){return this.add(new this.constructor(t).multiplyScalar(i))}}const ZA=1e-6;let gl=typeof Float32Array<"u"?Float32Array:Array;function GH(){const e=new gl(2);return gl!=Float32Array&&(e[0]=0,e[1]=0),e}function _I(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function zH(e,t){return e[0]=-t[0],e[1]=-t[1],e}function vI(e,t,i,n){const r=t[0],s=t[1];return e[0]=r+n*(i[0]-r),e[1]=s+n*(i[1]-s),e}function VH(e,t,i){const n=t[0],r=t[1];return e[0]=i[0]*n+i[2]*r,e[1]=i[1]*n+i[3]*r,e}function jH(e,t,i){const n=t[0],r=t[1];return e[0]=i[0]*n+i[2]*r+i[4],e[1]=i[1]*n+i[3]*r+i[5],e}function bI(e,t,i){const n=t[0],r=t[1];return e[0]=i[0]*n+i[3]*r+i[6],e[1]=i[1]*n+i[4]*r+i[7],e}function xI(e,t,i){const n=t[0],r=t[1];return e[0]=i[0]*n+i[4]*r+i[12],e[1]=i[1]*n+i[5]*r+i[13],e}(function(){const e=GH();return function(t,i,n,r,s,o){let l,h;for(i||(i=2),n||(n=0),r?h=Math.min(r*i+n,t.length):h=t.length,l=n;l<h;l+=i)e[0]=t[l],e[1]=t[l+1],s(e,e,o),t[l]=e[0],t[l+1]=e[1];return t}})();function wI(e,t,i){const n=t[0],r=t[1],s=i[3]*n+i[7]*r||1;return e[0]=(i[0]*n+i[4]*r)/s,e[1]=(i[1]*n+i[5]*r)/s,e}function CI(e,t,i){const n=t[0],r=t[1],s=t[2],o=i[3]*n+i[7]*r+i[11]*s||1;return e[0]=(i[0]*n+i[4]*r+i[8]*s)/o,e[1]=(i[1]*n+i[5]*r+i[9]*s)/o,e[2]=(i[2]*n+i[6]*r+i[10]*s)/o,e}function HH(e,t,i){const n=t[0],r=t[1];return e[0]=i[0]*n+i[2]*r,e[1]=i[1]*n+i[3]*r,e[2]=t[2],e}function WH(e,t,i){const n=t[0],r=t[1];return e[0]=i[0]*n+i[2]*r,e[1]=i[1]*n+i[3]*r,e[2]=t[2],e[3]=t[3],e}function EI(e,t,i){const n=t[0],r=t[1],s=t[2];return e[0]=i[0]*n+i[3]*r+i[6]*s,e[1]=i[1]*n+i[4]*r+i[7]*s,e[2]=i[2]*n+i[5]*r+i[8]*s,e[3]=t[3],e}class $1 extends q1{constructor(t=0,i=0){super(2),Qu(t)&&arguments.length===1?this.copy(t):(To.debug&&(qn(t),qn(i)),this[0]=t,this[1]=i)}set(t,i){return this[0]=t,this[1]=i,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return To.debug&&(qn(t.x),qn(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return xI(this,this,t),this.check()}transformAsVector(t){return wI(this,this,t),this.check()}transformByMatrix3(t){return bI(this,this,t),this.check()}transformByMatrix2x3(t){return jH(this,this,t),this.check()}transformByMatrix2(t){return VH(this,this,t),this.check()}}function BI(){const e=new gl(3);return gl!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function TI(e){const t=e[0],i=e[1],n=e[2];return Math.sqrt(t*t+i*i+n*n)}function SI(e,t,i){const n=new gl(3);return n[0]=e,n[1]=t,n[2]=i,n}function JH(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function XH(e){const t=e[0],i=e[1],n=e[2];return t*t+i*i+n*n}function KH(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function QH(e,t){const i=t[0],n=t[1],r=t[2];let s=i*i+n*n+r*r;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function tb(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function b0(e,t,i){const n=t[0],r=t[1],s=t[2],o=i[0],l=i[1],h=i[2];return e[0]=r*h-s*l,e[1]=s*o-n*h,e[2]=n*l-r*o,e}function ZH(e,t,i,n){const r=t[0],s=t[1],o=t[2];return e[0]=r+n*(i[0]-r),e[1]=s+n*(i[1]-s),e[2]=o+n*(i[2]-o),e}function eb(e,t,i){const n=t[0],r=t[1],s=t[2];let o=i[3]*n+i[7]*r+i[11]*s+i[15];return o=o||1,e[0]=(i[0]*n+i[4]*r+i[8]*s+i[12])/o,e[1]=(i[1]*n+i[5]*r+i[9]*s+i[13])/o,e[2]=(i[2]*n+i[6]*r+i[10]*s+i[14])/o,e}function II(e,t,i){const n=t[0],r=t[1],s=t[2];return e[0]=n*i[0]+r*i[3]+s*i[6],e[1]=n*i[1]+r*i[4]+s*i[7],e[2]=n*i[2]+r*i[5]+s*i[8],e}function MI(e,t,i){const n=i[0],r=i[1],s=i[2],o=i[3],l=t[0],h=t[1],A=t[2];let v=r*A-s*h,C=s*l-n*A,S=n*h-r*l,L=r*S-s*C,N=s*v-n*S,G=n*C-r*v;const W=o*2;return v*=W,C*=W,S*=W,L*=2,N*=2,G*=2,e[0]=l+v+L,e[1]=h+C+N,e[2]=A+S+G,e}function YH(e,t,i,n){const r=[],s=[];return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],s[0]=r[0],s[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),s[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),e[0]=s[0]+i[0],e[1]=s[1]+i[1],e[2]=s[2]+i[2],e}function qH(e,t,i,n){const r=[],s=[];return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],s[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),s[1]=r[1],s[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),e[0]=s[0]+i[0],e[1]=s[1]+i[1],e[2]=s[2]+i[2],e}function $H(e,t,i,n){const r=[],s=[];return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],s[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),s[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),s[2]=r[2],e[0]=s[0]+i[0],e[1]=s[1]+i[1],e[2]=s[2]+i[2],e}function tW(e,t){const i=e[0],n=e[1],r=e[2],s=t[0],o=t[1],l=t[2],h=Math.sqrt((i*i+n*n+r*r)*(s*s+o*o+l*l)),A=h&&tb(e,t)/h;return Math.acos(Math.min(Math.max(A,-1),1))}const PI=JH,RI=TI,ib=XH;(function(){const e=BI();return function(t,i,n,r,s,o){let l,h;for(i||(i=3),n||(n=0),r?h=Math.min(r*i+n,t.length):h=t.length,l=n;l<h;l+=i)e[0]=t[l],e[1]=t[l+1],e[2]=t[l+2],s(e,e,o),t[l]=e[0],t[l+1]=e[1],t[l+2]=e[2];return t}})();const nb=[0,0,0];let x0;class de extends q1{static get ZERO(){return x0||(x0=new de(0,0,0),Object.freeze(x0)),x0}constructor(t=0,i=0,n=0){super(-0,-0,-0),arguments.length===1&&Qu(t)?this.copy(t):(To.debug&&(qn(t),qn(i),qn(n)),this[0]=t,this[1]=i,this[2]=n)}set(t,i,n){return this[0]=t,this[1]=i,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return To.debug&&(qn(t.x),qn(t.y),qn(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=qn(t)}angle(t){return tW(this,t)}cross(t){return b0(this,this,t),this.check()}rotateX({radians:t,origin:i=nb}){return YH(this,this,i,t),this.check()}rotateY({radians:t,origin:i=nb}){return qH(this,this,i,t),this.check()}rotateZ({radians:t,origin:i=nb}){return $H(this,this,i,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return eb(this,this,t),this.check()}transformAsVector(t){return CI(this,this,t),this.check()}transformByMatrix3(t){return II(this,this,t),this.check()}transformByMatrix2(t){return HH(this,this,t),this.check()}transformByQuaternion(t){return MI(this,this,t),this.check()}}let w0;class JE extends q1{static get ZERO(){return w0||(w0=new JE(0,0,0,0),Object.freeze(w0)),w0}constructor(t=0,i=0,n=0,r=0){super(-0,-0,-0,-0),Qu(t)&&arguments.length===1?this.copy(t):(To.debug&&(qn(t),qn(i),qn(n),qn(r)),this[0]=t,this[1]=i,this[2]=n,this[3]=r)}set(t,i,n,r){return this[0]=t,this[1]=i,this[2]=n,this[3]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return To.debug&&(qn(t.x),qn(t.y),qn(t.z),qn(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=qn(t)}get w(){return this[3]}set w(t){this[3]=qn(t)}transform(t){return eb(this,this,t),this.check()}transformByMatrix3(t){return EI(this,this,t),this.check()}transformByMatrix2(t){return WH(this,this,t),this.check()}transformByQuaternion(t){return MI(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class DI extends Y1{toString(){let t="[";if(To.printRowMajor){t+="row-major:";for(let i=0;i<this.RANK;++i)for(let n=0;n<this.RANK;++n)t+=` ${this[n*this.RANK+i]}`}else{t+="column-major:";for(let i=0;i<this.ELEMENTS;++i)t+=` ${this[i]}`}return t+="]",t}getElementIndex(t,i){return i*this.RANK+t}getElement(t,i){return this[i*this.RANK+t]}setElement(t,i,n){return this[i*this.RANK+t]=qn(n),this}getColumn(t,i=new Array(this.RANK).fill(-0)){const n=t*this.RANK;for(let r=0;r<this.RANK;++r)i[r]=this[n+r];return i}setColumn(t,i){const n=t*this.RANK;for(let r=0;r<this.RANK;++r)this[n+r]=i[r];return this}}function eW(){const e=new gl(9);return gl!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function iW(e,t){if(e===t){const i=t[1],n=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=n,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function nW(e,t){const i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],l=t[5],h=t[6],A=t[7],v=t[8],C=v*o-l*A,S=-v*s+l*h,L=A*s-o*h;let N=i*C+n*S+r*L;return N?(N=1/N,e[0]=C*N,e[1]=(-v*n+r*A)*N,e[2]=(l*n-r*o)*N,e[3]=S*N,e[4]=(v*i-r*h)*N,e[5]=(-l*i+r*s)*N,e[6]=L*N,e[7]=(-A*i+n*h)*N,e[8]=(o*i-n*s)*N,e):null}function rW(e){const t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],l=e[6],h=e[7],A=e[8];return t*(A*s-o*h)+i*(-A*r+o*l)+n*(h*r-s*l)}function OI(e,t,i){const n=t[0],r=t[1],s=t[2],o=t[3],l=t[4],h=t[5],A=t[6],v=t[7],C=t[8],S=i[0],L=i[1],N=i[2],G=i[3],W=i[4],j=i[5],q=i[6],Z=i[7],K=i[8];return e[0]=S*n+L*o+N*A,e[1]=S*r+L*l+N*v,e[2]=S*s+L*h+N*C,e[3]=G*n+W*o+j*A,e[4]=G*r+W*l+j*v,e[5]=G*s+W*h+j*C,e[6]=q*n+Z*o+K*A,e[7]=q*r+Z*l+K*v,e[8]=q*s+Z*h+K*C,e}function oW(e,t,i){const n=t[0],r=t[1],s=t[2],o=t[3],l=t[4],h=t[5],A=t[6],v=t[7],C=t[8],S=i[0],L=i[1];return e[0]=n,e[1]=r,e[2]=s,e[3]=o,e[4]=l,e[5]=h,e[6]=S*n+L*o+A,e[7]=S*r+L*l+v,e[8]=S*s+L*h+C,e}function sW(e,t,i){const n=t[0],r=t[1],s=t[2],o=t[3],l=t[4],h=t[5],A=t[6],v=t[7],C=t[8],S=Math.sin(i),L=Math.cos(i);return e[0]=L*n+S*o,e[1]=L*r+S*l,e[2]=L*s+S*h,e[3]=L*o-S*n,e[4]=L*l-S*r,e[5]=L*h-S*s,e[6]=A,e[7]=v,e[8]=C,e}function LI(e,t,i){const n=i[0],r=i[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function aW(e,t){const i=t[0],n=t[1],r=t[2],s=t[3],o=i+i,l=n+n,h=r+r,A=i*o,v=n*o,C=n*l,S=r*o,L=r*l,N=r*h,G=s*o,W=s*l,j=s*h;return e[0]=1-C-N,e[3]=v-j,e[6]=S+W,e[1]=v+j,e[4]=1-A-N,e[7]=L-G,e[2]=S-W,e[5]=L+G,e[8]=1-A-C,e}var rb;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"})(rb||(rb={}));const lW=Object.freeze([1,0,0,0,1,0,0,0,1]);class mr extends DI{static get IDENTITY(){return uW()}static get ZERO(){return cW()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return rb}constructor(t,...i){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):i.length>0?this.copy([t,...i]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(lW)}fromObject(t){return this.check()}fromQuaternion(t){return aW(this,t),this.check()}set(t,i,n,r,s,o,l,h,A){return this[0]=t,this[1]=i,this[2]=n,this[3]=r,this[4]=s,this[5]=o,this[6]=l,this[7]=h,this[8]=A,this.check()}setRowMajor(t,i,n,r,s,o,l,h,A){return this[0]=t,this[1]=r,this[2]=l,this[3]=i,this[4]=s,this[5]=h,this[6]=n,this[7]=o,this[8]=A,this.check()}determinant(){return rW(this)}transpose(){return iW(this,this),this.check()}invert(){return nW(this,this),this.check()}multiplyLeft(t){return OI(this,t,this),this.check()}multiplyRight(t){return OI(this,this,t),this.check()}rotate(t){return sW(this,this,t),this.check()}scale(t){return Array.isArray(t)?LI(this,this,t):LI(this,this,[t,t]),this.check()}translate(t){return oW(this,this,t),this.check()}transform(t,i){let n;switch(t.length){case 2:n=bI(i||[-0,-0],t,this);break;case 3:n=II(i||[-0,-0,-0],t,this);break;case 4:n=EI(i||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return QA(n,t.length),n}transformVector(t,i){return this.transform(t,i)}transformVector2(t,i){return this.transform(t,i)}transformVector3(t,i){return this.transform(t,i)}}let C0,E0=null;function cW(){return C0||(C0=new mr([0,0,0,0,0,0,0,0,0]),Object.freeze(C0)),C0}function uW(){return E0||(E0=new mr,Object.freeze(E0)),E0}function hW(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fW(e,t){if(e===t){const i=t[1],n=t[2],r=t[3],s=t[6],o=t[7],l=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=s,e[11]=t[14],e[12]=r,e[13]=o,e[14]=l}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function ob(e,t){const i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],l=t[5],h=t[6],A=t[7],v=t[8],C=t[9],S=t[10],L=t[11],N=t[12],G=t[13],W=t[14],j=t[15],q=i*l-n*o,Z=i*h-r*o,K=i*A-s*o,ft=n*h-r*l,rt=n*A-s*l,Lt=r*A-s*h,Vt=v*G-C*N,At=v*W-S*N,at=v*j-L*N,kt=C*W-S*G,X=C*j-L*G,ht=S*j-L*W;let Mt=q*ht-Z*X+K*kt+ft*at-rt*At+Lt*Vt;return Mt?(Mt=1/Mt,e[0]=(l*ht-h*X+A*kt)*Mt,e[1]=(r*X-n*ht-s*kt)*Mt,e[2]=(G*Lt-W*rt+j*ft)*Mt,e[3]=(S*rt-C*Lt-L*ft)*Mt,e[4]=(h*at-o*ht-A*At)*Mt,e[5]=(i*ht-r*at+s*At)*Mt,e[6]=(W*K-N*Lt-j*Z)*Mt,e[7]=(v*Lt-S*K+L*Z)*Mt,e[8]=(o*X-l*at+A*Vt)*Mt,e[9]=(n*at-i*X-s*Vt)*Mt,e[10]=(N*rt-G*K+j*q)*Mt,e[11]=(C*K-v*rt-L*q)*Mt,e[12]=(l*At-o*kt-h*Vt)*Mt,e[13]=(i*kt-n*At+r*Vt)*Mt,e[14]=(G*Z-N*ft-W*q)*Mt,e[15]=(v*ft-C*Z+S*q)*Mt,e):null}function dW(e){const t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],l=e[6],h=e[7],A=e[8],v=e[9],C=e[10],S=e[11],L=e[12],N=e[13],G=e[14],W=e[15],j=t*o-i*s,q=t*l-n*s,Z=i*l-n*o,K=A*N-v*L,ft=A*G-C*L,rt=v*G-C*N,Lt=t*rt-i*ft+n*K,Vt=s*rt-o*ft+l*K,At=A*Z-v*q+C*j,at=L*Z-N*q+G*j;return h*Lt-r*Vt+W*At-S*at}function qh(e,t,i){const n=t[0],r=t[1],s=t[2],o=t[3],l=t[4],h=t[5],A=t[6],v=t[7],C=t[8],S=t[9],L=t[10],N=t[11],G=t[12],W=t[13],j=t[14],q=t[15];let Z=i[0],K=i[1],ft=i[2],rt=i[3];return e[0]=Z*n+K*l+ft*C+rt*G,e[1]=Z*r+K*h+ft*S+rt*W,e[2]=Z*s+K*A+ft*L+rt*j,e[3]=Z*o+K*v+ft*N+rt*q,Z=i[4],K=i[5],ft=i[6],rt=i[7],e[4]=Z*n+K*l+ft*C+rt*G,e[5]=Z*r+K*h+ft*S+rt*W,e[6]=Z*s+K*A+ft*L+rt*j,e[7]=Z*o+K*v+ft*N+rt*q,Z=i[8],K=i[9],ft=i[10],rt=i[11],e[8]=Z*n+K*l+ft*C+rt*G,e[9]=Z*r+K*h+ft*S+rt*W,e[10]=Z*s+K*A+ft*L+rt*j,e[11]=Z*o+K*v+ft*N+rt*q,Z=i[12],K=i[13],ft=i[14],rt=i[15],e[12]=Z*n+K*l+ft*C+rt*G,e[13]=Z*r+K*h+ft*S+rt*W,e[14]=Z*s+K*A+ft*L+rt*j,e[15]=Z*o+K*v+ft*N+rt*q,e}function B0(e,t,i){const n=i[0],r=i[1],s=i[2];let o,l,h,A,v,C,S,L,N,G,W,j;return t===e?(e[12]=t[0]*n+t[4]*r+t[8]*s+t[12],e[13]=t[1]*n+t[5]*r+t[9]*s+t[13],e[14]=t[2]*n+t[6]*r+t[10]*s+t[14],e[15]=t[3]*n+t[7]*r+t[11]*s+t[15]):(o=t[0],l=t[1],h=t[2],A=t[3],v=t[4],C=t[5],S=t[6],L=t[7],N=t[8],G=t[9],W=t[10],j=t[11],e[0]=o,e[1]=l,e[2]=h,e[3]=A,e[4]=v,e[5]=C,e[6]=S,e[7]=L,e[8]=N,e[9]=G,e[10]=W,e[11]=j,e[12]=o*n+v*r+N*s+t[12],e[13]=l*n+C*r+G*s+t[13],e[14]=h*n+S*r+W*s+t[14],e[15]=A*n+L*r+j*s+t[15]),e}function sb(e,t,i){const n=i[0],r=i[1],s=i[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function pW(e,t,i,n){let r=n[0],s=n[1],o=n[2],l=Math.sqrt(r*r+s*s+o*o),h,A,v,C,S,L,N,G,W,j,q,Z,K,ft,rt,Lt,Vt,At,at,kt,X,ht,Mt,pe;return l<ZA?null:(l=1/l,r*=l,s*=l,o*=l,A=Math.sin(i),h=Math.cos(i),v=1-h,C=t[0],S=t[1],L=t[2],N=t[3],G=t[4],W=t[5],j=t[6],q=t[7],Z=t[8],K=t[9],ft=t[10],rt=t[11],Lt=r*r*v+h,Vt=s*r*v+o*A,At=o*r*v-s*A,at=r*s*v-o*A,kt=s*s*v+h,X=o*s*v+r*A,ht=r*o*v+s*A,Mt=s*o*v-r*A,pe=o*o*v+h,e[0]=C*Lt+G*Vt+Z*At,e[1]=S*Lt+W*Vt+K*At,e[2]=L*Lt+j*Vt+ft*At,e[3]=N*Lt+q*Vt+rt*At,e[4]=C*at+G*kt+Z*X,e[5]=S*at+W*kt+K*X,e[6]=L*at+j*kt+ft*X,e[7]=N*at+q*kt+rt*X,e[8]=C*ht+G*Mt+Z*pe,e[9]=S*ht+W*Mt+K*pe,e[10]=L*ht+j*Mt+ft*pe,e[11]=N*ht+q*Mt+rt*pe,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function FI(e,t,i){const n=Math.sin(i),r=Math.cos(i),s=t[4],o=t[5],l=t[6],h=t[7],A=t[8],v=t[9],C=t[10],S=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*r+A*n,e[5]=o*r+v*n,e[6]=l*r+C*n,e[7]=h*r+S*n,e[8]=A*r-s*n,e[9]=v*r-o*n,e[10]=C*r-l*n,e[11]=S*r-h*n,e}function AW(e,t,i){const n=Math.sin(i),r=Math.cos(i),s=t[0],o=t[1],l=t[2],h=t[3],A=t[8],v=t[9],C=t[10],S=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r-A*n,e[1]=o*r-v*n,e[2]=l*r-C*n,e[3]=h*r-S*n,e[8]=s*n+A*r,e[9]=o*n+v*r,e[10]=l*n+C*r,e[11]=h*n+S*r,e}function kI(e,t,i){const n=Math.sin(i),r=Math.cos(i),s=t[0],o=t[1],l=t[2],h=t[3],A=t[4],v=t[5],C=t[6],S=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r+A*n,e[1]=o*r+v*n,e[2]=l*r+C*n,e[3]=h*r+S*n,e[4]=A*r-s*n,e[5]=v*r-o*n,e[6]=C*r-l*n,e[7]=S*r-h*n,e}function gW(e,t){const i=t[0],n=t[1],r=t[2],s=t[4],o=t[5],l=t[6],h=t[8],A=t[9],v=t[10];return e[0]=Math.sqrt(i*i+n*n+r*r),e[1]=Math.sqrt(s*s+o*o+l*l),e[2]=Math.sqrt(h*h+A*A+v*v),e}function mW(e,t){const i=t[0],n=t[1],r=t[2],s=t[3],o=i+i,l=n+n,h=r+r,A=i*o,v=n*o,C=n*l,S=r*o,L=r*l,N=r*h,G=s*o,W=s*l,j=s*h;return e[0]=1-C-N,e[1]=v+j,e[2]=S-W,e[3]=0,e[4]=v-j,e[5]=1-A-N,e[6]=L+G,e[7]=0,e[8]=S+W,e[9]=L-G,e[10]=1-A-C,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function yW(e,t,i,n,r,s,o){const l=1/(i-t),h=1/(r-n),A=1/(s-o);return e[0]=s*2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*h,e[6]=0,e[7]=0,e[8]=(i+t)*l,e[9]=(r+n)*h,e[10]=(o+s)*A,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*s*2*A,e[15]=0,e}function _W(e,t,i,n,r){const s=1/Math.tan(t/2);if(e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==1/0){const o=1/(n-r);e[10]=(r+n)*o,e[14]=2*r*n*o}else e[10]=-1,e[14]=-2*n;return e}const vW=_W;function bW(e,t,i,n,r,s,o){const l=1/(t-i),h=1/(n-r),A=1/(s-o);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*h,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*A,e[11]=0,e[12]=(t+i)*l,e[13]=(r+n)*h,e[14]=(o+s)*A,e[15]=1,e}const xW=bW;function wW(e,t,i,n){let r,s,o,l,h,A,v,C,S,L;const N=t[0],G=t[1],W=t[2],j=n[0],q=n[1],Z=n[2],K=i[0],ft=i[1],rt=i[2];return Math.abs(N-K)<ZA&&Math.abs(G-ft)<ZA&&Math.abs(W-rt)<ZA?hW(e):(C=N-K,S=G-ft,L=W-rt,r=1/Math.sqrt(C*C+S*S+L*L),C*=r,S*=r,L*=r,s=q*L-Z*S,o=Z*C-j*L,l=j*S-q*C,r=Math.sqrt(s*s+o*o+l*l),r?(r=1/r,s*=r,o*=r,l*=r):(s=0,o=0,l=0),h=S*l-L*o,A=L*s-C*l,v=C*o-S*s,r=Math.sqrt(h*h+A*A+v*v),r?(r=1/r,h*=r,A*=r,v*=r):(h=0,A=0,v=0),e[0]=s,e[1]=h,e[2]=C,e[3]=0,e[4]=o,e[5]=A,e[6]=S,e[7]=0,e[8]=l,e[9]=v,e[10]=L,e[11]=0,e[12]=-(s*N+o*G+l*W),e[13]=-(h*N+A*G+v*W),e[14]=-(C*N+S*G+L*W),e[15]=1,e)}function CW(){const e=new gl(4);return gl!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function EW(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function ab(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function BW(e){const t=e[0],i=e[1],n=e[2],r=e[3];return Math.sqrt(t*t+i*i+n*n+r*r)}function TW(e){const t=e[0],i=e[1],n=e[2],r=e[3];return t*t+i*i+n*n+r*r}function SW(e,t){const i=t[0],n=t[1],r=t[2],s=t[3];let o=i*i+n*n+r*r+s*s;return o>0&&(o=1/Math.sqrt(o)),e[0]=i*o,e[1]=n*o,e[2]=r*o,e[3]=s*o,e}function IW(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function MW(e,t,i,n){const r=t[0],s=t[1],o=t[2],l=t[3];return e[0]=r+n*(i[0]-r),e[1]=s+n*(i[1]-s),e[2]=o+n*(i[2]-o),e[3]=l+n*(i[3]-l),e}function kd(e,t,i){const n=t[0],r=t[1],s=t[2],o=t[3];return e[0]=i[0]*n+i[4]*r+i[8]*s+i[12]*o,e[1]=i[1]*n+i[5]*r+i[9]*s+i[13]*o,e[2]=i[2]*n+i[6]*r+i[10]*s+i[14]*o,e[3]=i[3]*n+i[7]*r+i[11]*s+i[15]*o,e}function PW(e,t,i){const n=t[0],r=t[1],s=t[2],o=i[0],l=i[1],h=i[2],A=i[3],v=A*n+l*s-h*r,C=A*r+h*n-o*s,S=A*s+o*r-l*n,L=-o*n-l*r-h*s;return e[0]=v*A+L*-o+C*-h-S*-l,e[1]=C*A+L*-l+S*-o-v*-h,e[2]=S*A+L*-h+v*-l-C*-o,e[3]=t[3],e}(function(){const e=CW();return function(t,i,n,r,s,o){let l,h;for(i||(i=4),n||(n=0),r?h=Math.min(r*i+n,t.length):h=t.length,l=n;l<h;l+=i)e[0]=t[l],e[1]=t[l+1],e[2]=t[l+2],e[3]=t[l+3],s(e,e,o),t[l]=e[0],t[l+1]=e[1],t[l+2]=e[2],t[l+3]=e[3];return t}})();var lb;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"})(lb||(lb={}));const RW=45*Math.PI/180,DW=1,cb=.1,ub=500,OW=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class mn extends DI{static get IDENTITY(){return FW()}static get ZERO(){return LW()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return lb}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,i,n,r,s,o,l,h,A,v,C,S,L,N,G,W){return this[0]=t,this[1]=i,this[2]=n,this[3]=r,this[4]=s,this[5]=o,this[6]=l,this[7]=h,this[8]=A,this[9]=v,this[10]=C,this[11]=S,this[12]=L,this[13]=N,this[14]=G,this[15]=W,this.check()}setRowMajor(t,i,n,r,s,o,l,h,A,v,C,S,L,N,G,W){return this[0]=t,this[1]=s,this[2]=A,this[3]=L,this[4]=i,this[5]=o,this[6]=v,this[7]=N,this[8]=n,this[9]=l,this[10]=C,this[11]=G,this[12]=r,this[13]=h,this[14]=S,this[15]=W,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(OW)}fromObject(t){return this.check()}fromQuaternion(t){return mW(this,t),this.check()}frustum(t){const{left:i,right:n,bottom:r,top:s,near:o=cb,far:l=ub}=t;return l===1/0?kW(this,i,n,r,s,o):yW(this,i,n,r,s,o,l),this.check()}lookAt(t){const{eye:i,center:n=[0,0,0],up:r=[0,1,0]}=t;return wW(this,i,n,r),this.check()}ortho(t){const{left:i,right:n,bottom:r,top:s,near:o=cb,far:l=ub}=t;return xW(this,i,n,r,s,o,l),this.check()}orthographic(t){const{fovy:i=RW,aspect:n=DW,focalDistance:r=1,near:s=cb,far:o=ub}=t;NI(i);const l=i/2,h=r*Math.tan(l),A=h*n;return this.ortho({left:-A,right:A,bottom:-h,top:h,near:s,far:o})}perspective(t){const{fovy:i=45*Math.PI/180,aspect:n=1,near:r=.1,far:s=500}=t;return NI(i),vW(this,i,n,r,s),this.check()}determinant(){return dW(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,i){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const n=this.getScale(i),r=1/n[0],s=1/n[1],o=1/n[2];return t[0]=this[0]*r,t[1]=this[1]*s,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*r,t[5]=this[5]*s,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*r,t[9]=this[9]*s,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,i){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const n=this.getScale(i),r=1/n[0],s=1/n[1],o=1/n[2];return t[0]=this[0]*r,t[1]=this[1]*s,t[2]=this[2]*o,t[3]=this[4]*r,t[4]=this[5]*s,t[5]=this[6]*o,t[6]=this[8]*r,t[7]=this[9]*s,t[8]=this[10]*o,t}transpose(){return fW(this,this),this.check()}invert(){return ob(this,this),this.check()}multiplyLeft(t){return qh(this,t,this),this.check()}multiplyRight(t){return qh(this,this,t),this.check()}rotateX(t){return FI(this,this,t),this.check()}rotateY(t){return AW(this,this,t),this.check()}rotateZ(t){return kI(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,i){return pW(this,this,t,i),this.check()}scale(t){return sb(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return B0(this,this,t),this.check()}transform(t,i){return t.length===4?(i=kd(i||[-0,-0,-0,-0],t,this),QA(i,4),i):this.transformAsPoint(t,i)}transformAsPoint(t,i){const{length:n}=t;let r;switch(n){case 2:r=xI(i||[-0,-0],t,this);break;case 3:r=eb(i||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return QA(r,t.length),r}transformAsVector(t,i){let n;switch(t.length){case 2:n=wI(i||[-0,-0],t,this);break;case 3:n=CI(i||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return QA(n,t.length),n}transformPoint(t,i){return this.transformAsPoint(t,i)}transformVector(t,i){return this.transformAsPoint(t,i)}transformDirection(t,i){return this.transformAsVector(t,i)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,i,n){return this.identity().translate([t,i,n])}}let T0,S0;function LW(){return T0||(T0=new mn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(T0)),T0}function FW(){return S0||(S0=new mn,Object.freeze(S0)),S0}function NI(e){if(e>Math.PI*2)throw Error("expected radians")}function kW(e,t,i,n,r,s){const o=2*s/(i-t),l=2*s/(r-n),h=(i+t)/(i-t),A=(r+n)/(r-n),v=-1,C=-1,S=-2*s;return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=h,e[9]=A,e[10]=v,e[11]=C,e[12]=0,e[13]=0,e[14]=S,e[15]=0,e}function UI(){const e=new gl(4);return gl!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function NW(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function GI(e,t,i){i=i*.5;const n=Math.sin(i);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(i),e}function zI(e,t,i){const n=t[0],r=t[1],s=t[2],o=t[3],l=i[0],h=i[1],A=i[2],v=i[3];return e[0]=n*v+o*l+r*A-s*h,e[1]=r*v+o*h+s*l-n*A,e[2]=s*v+o*A+n*h-r*l,e[3]=o*v-n*l-r*h-s*A,e}function UW(e,t,i){i*=.5;const n=t[0],r=t[1],s=t[2],o=t[3],l=Math.sin(i),h=Math.cos(i);return e[0]=n*h+o*l,e[1]=r*h+s*l,e[2]=s*h-r*l,e[3]=o*h-n*l,e}function GW(e,t,i){i*=.5;const n=t[0],r=t[1],s=t[2],o=t[3],l=Math.sin(i),h=Math.cos(i);return e[0]=n*h-s*l,e[1]=r*h+o*l,e[2]=s*h+n*l,e[3]=o*h-r*l,e}function zW(e,t,i){i*=.5;const n=t[0],r=t[1],s=t[2],o=t[3],l=Math.sin(i),h=Math.cos(i);return e[0]=n*h+r*l,e[1]=r*h-n*l,e[2]=s*h+o*l,e[3]=o*h-s*l,e}function VW(e,t){const i=t[0],n=t[1],r=t[2];return e[0]=i,e[1]=n,e[2]=r,e[3]=Math.sqrt(Math.abs(1-i*i-n*n-r*r)),e}function I0(e,t,i,n){const r=t[0],s=t[1],o=t[2],l=t[3];let h=i[0],A=i[1],v=i[2],C=i[3],S,L,N,G,W;return S=r*h+s*A+o*v+l*C,S<0&&(S=-S,h=-h,A=-A,v=-v,C=-C),1-S>ZA?(L=Math.acos(S),W=Math.sin(L),N=Math.sin((1-n)*L)/W,G=Math.sin(n*L)/W):(N=1-n,G=n),e[0]=N*r+G*h,e[1]=N*s+G*A,e[2]=N*o+G*v,e[3]=N*l+G*C,e}function jW(e,t){const i=t[0],n=t[1],r=t[2],s=t[3],o=i*i+n*n+r*r+s*s,l=o?1/o:0;return e[0]=-i*l,e[1]=-n*l,e[2]=-r*l,e[3]=s*l,e}function HW(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function VI(e,t){const i=t[0]+t[4]+t[8];let n;if(i>0)n=Math.sqrt(i+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[r*3+r]&&(r=2);const s=(r+1)%3,o=(r+2)%3;n=Math.sqrt(t[r*3+r]-t[s*3+s]-t[o*3+o]+1),e[r]=.5*n,n=.5/n,e[3]=(t[s*3+o]-t[o*3+s])*n,e[s]=(t[s*3+r]+t[r*3+s])*n,e[o]=(t[o*3+r]+t[r*3+o])*n}return e}const WW=EW,JW=ab,XW=IW,KW=MW,QW=BW,ZW=TW,jI=SW,YW=function(){const e=BI(),t=SI(1,0,0),i=SI(0,1,0);return function(n,r,s){const o=tb(r,s);return o<-.999999?(b0(e,t,r),RI(e)<1e-6&&b0(e,i,r),QH(e,e),GI(n,e,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(b0(e,r,s),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+o,jI(n,n))}}();(function(){const e=UI(),t=UI();return function(i,n,r,s,o,l){return I0(e,n,o,l),I0(t,r,s,l),I0(i,e,t,2*l*(1-l)),i}})(),function(){const e=eW();return function(t,i,n,r){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=r[0],e[4]=r[1],e[7]=r[2],e[2]=-i[0],e[5]=-i[1],e[8]=-i[2],jI(t,VI(t,e))}}();const qW=[0,0,0,1];class YA extends Y1{constructor(t=0,i=0,n=0,r=1){super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,i,n,r)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,i,n,r){return this[0]=t,this[1]=i,this[2]=n,this[3]=r,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return VI(this,t),this.check()}fromAxisRotation(t,i){return GI(this,t,i),this.check()}identity(){return NW(this),this.check()}setAxisAngle(t,i){return this.fromAxisRotation(t,i)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=qn(t)}get y(){return this[1]}set y(t){this[1]=qn(t)}get z(){return this[2]}set z(t){this[2]=qn(t)}get w(){return this[3]}set w(t){this[3]=qn(t)}len(){return QW(this)}lengthSquared(){return ZW(this)}dot(t){return XW(this,t)}rotationTo(t,i){return YW(this,t,i),this.check()}add(t){return WW(this,this,t),this.check()}calculateW(){return VW(this,this),this.check()}conjugate(){return HW(this,this),this.check()}invert(){return jW(this,this),this.check()}lerp(t,i,n){return n===void 0?this.lerp(this,t,i):(KW(this,t,i,n),this.check())}multiplyRight(t){return zI(this,this,t),this.check()}multiplyLeft(t){return zI(this,t,this),this.check()}normalize(){const t=this.len(),i=t>0?1/t:0;return this[0]=this[0]*i,this[1]=this[1]*i,this[2]=this[2]*i,this[3]=this[3]*i,t===0&&(this[3]=1),this.check()}rotateX(t){return UW(this,this,t),this.check()}rotateY(t){return GW(this,this,t),this.check()}rotateZ(t){return zW(this,this,t),this.check()}scale(t){return JW(this,this,t),this.check()}slerp(t,i,n){let r,s,o;switch(arguments.length){case 1:({start:r=qW,target:s,ratio:o}=t);break;case 2:r=this,s=t,o=i;break;default:r=t,s=i,o=n}return I0(this,r,s,o),this.check()}transformVector4(t,i=new JE){return PW(i,t,this),QA(i,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,i){return this.setAxisAngle(t,i)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}const $W=.1,tJ=1e-12,HI=1e-15,eJ=1e-20;function WI(e,t=[],i=0){const n=Math.fround(e),r=e-n;return t[i]=n,t[i+1]=r,t}function iJ(e){return e-Math.fround(e)}function nJ(e){const t=new Float32Array(32);for(let i=0;i<4;++i)for(let n=0;n<4;++n){const r=i*4+n;WI(e[n*4+i],t,r*2)}return t}const rJ=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,oJ={name:"fp32",vs:rJ},sJ=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,aJ={ONE:1},lJ={name:"fp64arithmetic",vs:sJ,defaultUniforms:aJ,uniformTypes:{ONE:"f32"},fp64ify:WI,fp64LowPart:iJ,fp64ifyMatrix4:nJ},cJ=[0,1,1,1],uJ=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,hJ=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,JI={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:cJ},vs:uJ,fs:hJ,getUniforms:fJ};function fJ(e={},t){const i={};if(e.highlightedObjectColor!==void 0)if(e.highlightedObjectColor===null)i.isHighlightActive=!1;else{i.isHighlightActive=!0;const n=e.highlightedObjectColor.slice(0,3);i.highlightedObjectColor=n}if(e.highlightColor){const n=Array.from(e.highlightColor,r=>r/255);Number.isFinite(n[3])||(n[3]=1),i.highlightColor=n}return e.isActive!==void 0&&(i.isActive=!!e.isActive,i.isAttribute=!!e.isAttribute),e.useFloatColors!==void 0&&(i.useFloatColors=!!e.useFloatColors),i}const XI=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,dJ=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,KI=3,pJ=255;var qA;(function(e){e[e.POINT=0]="POINT",e[e.DIRECTIONAL=1]="DIRECTIONAL"})(qA||(qA={}));const Nd={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:KI},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:qA.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:dJ,vs:XI,fs:XI,getUniforms:AJ};function AJ(e,t={}){if(e=e&&{...e},!e)return{...Nd.defaultUniforms};e.lights&&(e={...e,...mJ(e.lights),lights:void 0});const{ambientLight:i,pointLights:n,directionalLights:r}=e||{};if(!(i||n&&n.length>0||r&&r.length>0))return{...Nd.defaultUniforms,enabled:0};const s={...Nd.defaultUniforms,...t,...gJ({ambientLight:i,pointLights:n,directionalLights:r})};return e.enabled!==void 0&&(s.enabled=e.enabled?1:0),s}function gJ({ambientLight:e,pointLights:t=[],directionalLights:i=[]}){const n={};n.ambientLightColor=hb(e);let r=0;for(const s of t){n.lightType=qA.POINT;const o=r;n[`lightColor${o}`]=hb(s),n[`lightPosition${o}`]=s.position,n[`lightAttenuation${o}`]=s.attenuation||[1,0,0],r++}for(const s of i){n.lightType=qA.DIRECTIONAL;const o=r;n[`lightColor${o}`]=hb(s),n[`lightDirection${o}`]=s.direction,r++}return r>KI&&ti.warn("MAX_LIGHTS exceeded")(),n.directionalLightCount=i.length,n.pointLightCount=t.length,n}function mJ(e){var t,i;const n={pointLights:[],directionalLights:[]};for(const r of e||[])switch(r.type){case"ambient":n.ambientLight=r;break;case"directional":(t=n.directionalLights)==null||t.push(r);break;case"point":(i=n.pointLights)==null||i.push(r);break}return n}function hb(e={}){const{color:t=[0,0,0],intensity:i=1}=e;return t.map(n=>n*i/pJ)}const QI=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,ZI=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,YI=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,M0={props:{},name:"gouraudMaterial",vs:ZI.replace("phongMaterial","gouraudMaterial"),fs:QI.replace("phongMaterial","gouraudMaterial"),source:YI.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[Nd],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){const t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(i=>i/255)),{...M0.defaultUniforms,...t}}},fb={name:"phongMaterial",dependencies:[Nd],source:YI,vs:QI,fs:ZI,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){const t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(i=>i/255)),{...fb.defaultUniforms,...t}}},yJ=`out vec3 pbr_vPosition;
out vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = pbrProjection.modelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else // HAS_TANGENTS != 1
  pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,_J=`precision highp float;

uniform pbrMaterialUniforms {
  // Material is unlit
  bool unlit;

  // Base color map
  bool baseColorMapEnabled;
  vec4 baseColorFactor;

  bool normalMapEnabled;  
  float normalScale; // #ifdef HAS_NORMALMAP

  bool emissiveMapEnabled;
  vec3 emissiveFactor; // #ifdef HAS_EMISSIVEMAP

  vec2 metallicRoughnessValues;
  bool metallicRoughnessMapEnabled;

  bool occlusionMapEnabled;
  float occlusionStrength; // #ifdef HAS_OCCLUSIONMAP
  
  bool alphaCutoffEnabled;
  float alphaCutoff; // #ifdef ALPHA_CUTOFF
  
  // IBL
  bool IBLenabled;
  vec2 scaleIBLAmbient; // #ifdef USE_IBL
  
  // debugging flags used for shader output of intermediate PBR variables
  // #ifdef PBR_DEBUG
  vec4 scaleDiffBaseMR;
  vec4 scaleFGDSpec;
  // #endif
} pbrMaterial;

// Samplers
#ifdef HAS_BASECOLORMAP
uniform sampler2D pbr_baseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D pbr_normalSampler;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D pbr_emissiveSampler;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D pbr_metallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D pbr_occlusionSampler;
#endif
#ifdef USE_IBL
uniform samplerCube pbr_diffuseEnvSampler;
uniform samplerCube pbr_specularEnvSampler;
uniform sampler2D pbr_brdfLUT;
#endif

// Inputs from vertex shader

in vec3 pbr_vPosition;
in vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif

// Encapsulate the various inputs used by the various functions in the shading equation
// We store values in this struct to simplify the integration of alternative implementations
// of the shading terms, outlined in the Readme.MD Appendix.
struct PBRInfo {
  float NdotL;                  // cos angle between normal and light direction
  float NdotV;                  // cos angle between normal and view direction
  float NdotH;                  // cos angle between normal and half vector
  float LdotH;                  // cos angle between light direction and half vector
  float VdotH;                  // cos angle between view direction and half vector
  float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)
  float metalness;              // metallic value at the surface
  vec3 reflectance0;            // full reflectance color (normal incidence angle)
  vec3 reflectance90;           // reflectance color at grazing angle
  float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])
  vec3 diffuseColor;            // color contribution from diffuse lighting
  vec3 specularColor;           // color contribution from specular lighting
  vec3 n;                       // normal at surface point
  vec3 v;                       // vector from surface point to camera
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else // SRGB_FAST_APPROXIMATION
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif //SRGB_FAST_APPROXIMATION
  return vec4(linOut,srgbIn.w);;
#else //MANUAL_SRGB
  return srgbIn;
#endif //MANUAL_SRGB
}

// Find the normal for this fragment, pulling either from a predefined normal map
// or from the interpolated mesh normal and tangent attributes.
vec3 getNormal()
{
  // Retrieve the tangent space matrix
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else // HAS_TANGENTS
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));
#else
  // The tbn matrix is linearly interpolated, so we need to re-normalize
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}

// Calculation of the lighting contribution from an optional Image Based Light source.
// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
// See our README.md on Environment Maps [3] for additional discussion.
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection)
{
  float mipCount = 9.0; // resolution of 512x512
  float lod = (pbrInfo.perceptualRoughness * mipCount);
  // retrieve a scale and bias to F0. See [1], Figure 3
  vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,
    vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;
  vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);

  // For presentation, this allows us to disable IBL terms
  diffuse *= pbrMaterial.scaleIBLAmbient.x;
  specular *= pbrMaterial.scaleIBLAmbient.y;

  return diffuse + specular;
}
#endif

// Basic Lambertian diffuse
// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog
// See also [1], Equation 1
vec3 diffuse(PBRInfo pbrInfo)
{
  return pbrInfo.diffuseColor / M_PI;
}

// The following equation models the Fresnel reflectance term of the spec equation (aka F())
// Implementation of fresnel from [4], Equation 15
vec3 specularReflection(PBRInfo pbrInfo)
{
  return pbrInfo.reflectance0 +
    (pbrInfo.reflectance90 - pbrInfo.reflectance0) *
    pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);
}

// This calculates the specular geometric attenuation (aka G()),
// where rougher material will reflect less light back to the viewer.
// This implementation is based on [1] Equation 4, and we adopt their modifications to
// alphaRoughness as input as originally proposed in [2].
float geometricOcclusion(PBRInfo pbrInfo)
{
  float NdotL = pbrInfo.NdotL;
  float NdotV = pbrInfo.NdotV;
  float r = pbrInfo.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}

// The following equation(s) model the distribution of microfacet normals across
// the area being drawn (aka D())
// Implementation from "Average Irregularity Representation of a Roughened Surface
// for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes
// from EPIC Games [1], Equation 3.
float microfacetDistribution(PBRInfo pbrInfo)
{
  float roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;
  float f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInfo) {
  pbrInfo.NdotL = 1.0;
  pbrInfo.NdotH = 0.0;
  pbrInfo.LdotH = 0.0;
  pbrInfo.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInfo, vec3 lightDirection) {
  vec3 n = pbrInfo.n;
  vec3 v = pbrInfo.v;
  vec3 l = normalize(lightDirection);             // Vector from surface point to light
  vec3 h = normalize(l+v);                        // Half vector between both l and v

  pbrInfo.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInfo, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInfo, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInfo, vec3 lightColor) {
  // Calculate the shading terms for the microfacet specular shading model
  vec3 F = specularReflection(pbrInfo);
  float G = geometricOcclusion(pbrInfo);
  float D = microfacetDistribution(pbrInfo);

  // Calculation of analytical lighting contribution
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInfo);
  vec3 specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);
  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
  return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
  // The albedo may be defined from a base texture or a flat color
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture(pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;
#else
  vec4 baseColor = pbrMaterial.baseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < pbrMaterial.alphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbrMaterial.unlit){
    color.rgb = baseColor.rgb;
  }
  else{
    // Metallic and Roughness material properties are packed together
    // In glTF, these factors can be specified by fixed scalar values
    // or from a metallic-roughness map
    float perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;
    float metallic = pbrMaterial.metallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
    vec4 mrSample = texture(pbr_metallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);
    // Roughness is authored as perceptual roughness; as is convention,
    // convert to material roughness by squaring the perceptual roughness [2].
    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);

    // Compute reflectance.
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

    // For typical incident reflectance range (between 4% to 100%) set the grazing
    // reflectance to 100% for typical fresnel effect.
    // For very low reflectance range on highly diffuse objects (below 4%),
    // incrementally reduce grazing reflecance to 0%.
    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();                          // normal at surface point
    vec3 v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInfo = PBRInfo(
      0.0, // NdotL
      NdotV,
      0.0, // NdotH
      0.0, // LdotH
      0.0, // VdotH
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );


#ifdef USE_LIGHTS
    // Apply ambient light
    PBRInfo_setAmbientLight(pbrInfo);
    color += calculateFinalColor(pbrInfo, lighting.ambientColor);

    // Apply directional light
    for(int i = 0; i < lighting.directionalLightCount; i++) {
      if (i < lighting.directionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInfo, lighting_getDirectionalLight(i).direction);
        color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);
      }
    }

    // Apply point light
    for(int i = 0; i < lighting.pointLightCount; i++) {
      if (i < lighting.pointLightCount) {
        PBRInfo_setPointLight(pbrInfo, lighting_getPointLight(i));
        float attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));
        color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);
      }
    }
#endif

    // Calculate lighting contribution from image based lighting source (IBL)
#ifdef USE_IBL
    if (pbrMaterial.IBLenabled) {
      color += getIBLContribution(pbrInfo, n, reflection);
    }
#endif

 // Apply optional PBR terms for additional (optional) shading
#ifdef HAS_OCCLUSIONMAP
    if (pbrMaterial.occlusionMapEnabled) {
      float ao = texture(pbr_occlusionSampler, pbr_vUV).r;
      color = mix(color, color * ao, pbrMaterial.occlusionStrength);
    }
#endif

#ifdef HAS_EMISSIVEMAP
    if (pbrMaterial.emissiveMapEnabled) {
      vec3 emissive = SRGBtoLINEAR(texture(pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;
      color += emissive;
    }
#endif

    // This section uses mix to override final color for reference app visualization
    // of various parameters in the lighting equation.
#ifdef PBR_DEBUG
    // TODO: Figure out how to debug multiple lights

    // color = mix(color, F, pbr_scaleFGDSpec.x);
    // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);
    // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);
    // color = mix(color, specContrib, pbr_scaleFGDSpec.w);

    // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);
    color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), pbrMaterial.scaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,qI=`uniform pbrProjectionUniforms {
  mat4 modelViewProjectionMatrix;
  mat4 modelMatrix;
  mat4 normalMatrix;
  vec3 camera;
} pbrProjection;
`,vJ={name:"pbrProjection",vs:qI,fs:qI,getUniforms:e=>e,uniformTypes:{modelViewProjectionMatrix:"mat4x4<f32>",modelMatrix:"mat4x4<f32>",normalMatrix:"mat4x4<f32>",camera:"vec3<i32>"}},db={props:{},uniforms:{},name:"pbrMaterial",dependencies:[Nd,vJ],vs:yJ,fs:_J,defines:{LIGHTING_FRAGMENT:1},getUniforms:e=>e,uniformTypes:{unlit:"i32",baseColorMapEnabled:"i32",baseColorFactor:"vec4<f32>",normalMapEnabled:"i32",normalScale:"f32",emissiveMapEnabled:"i32",emissiveFactor:"vec3<f32>",metallicRoughnessValues:"vec2<f32>",metallicRoughnessMapEnabled:"i32",occlusionMapEnabled:"i32",occlusionStrength:"f32",alphaCutoffEnabled:"i32",alphaCutoff:"f32",IBLenabled:"i32",scaleIBLAmbient:"vec2<f32>",scaleDiffBaseMR:"vec4<f32>",scaleFGDSpec:"vec4<f32>"}},$I=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,bJ={name:"layer",vs:$I,fs:$I,getUniforms:e=>({opacity:Math.pow(e.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},xJ=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,tM="#define SMOOTH_EDGE_RADIUS 0.5",wJ=`${tM}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,CJ=`${tM}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,eM={name:"geometry",source:xJ,vs:wJ,fs:CJ},EJ=25;var go;(function(e){e[e.Start=1]="Start",e[e.Move=2]="Move",e[e.End=4]="End",e[e.Cancel=8]="Cancel"})(go||(go={}));var So;(function(e){e[e.None=0]="None",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Up=4]="Up",e[e.Down=8]="Down",e[e.Horizontal=3]="Horizontal",e[e.Vertical=12]="Vertical",e[e.All=15]="All"})(So||(So={}));var yn;(function(e){e[e.Possible=1]="Possible",e[e.Began=2]="Began",e[e.Changed=4]="Changed",e[e.Ended=8]="Ended",e[e.Recognized=8]="Recognized",e[e.Cancelled=16]="Cancelled",e[e.Failed=32]="Failed"})(yn||(yn={}));const BJ="compute",TJ="auto",pb="manipulation",P0="none",Ab="pan-x",gb="pan-y";function SJ(e){if(e.includes(P0))return P0;const t=e.includes(Ab),i=e.includes(gb);return t&&i?P0:t||i?t?Ab:gb:e.includes(pb)?pb:TJ}class IJ{constructor(t,i){this.actions="",this.manager=t,this.set(i)}set(t){t===BJ&&(t=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=t,this.actions=t)}update(){this.set(this.manager.options.touchAction)}compute(){let t=[];for(const i of this.manager.recognizers)i.options.enable&&(t=t.concat(i.getTouchAction()));return SJ(t.join(" "))}}function R0(e){return e.trim().split(/\s+/g)}function mb(e,t,i){if(e)for(const n of R0(t))e.addEventListener(n,i,!1)}function yb(e,t,i){if(e)for(const n of R0(t))e.removeEventListener(n,i,!1)}function iM(e){return(e.ownerDocument||e).defaultView}function MJ(e,t){let i=e;for(;i;){if(i===t)return!0;i=i.parentNode}return!1}function nM(e){const t=e.length;if(t===1)return{x:Math.round(e[0].clientX),y:Math.round(e[0].clientY)};let i=0,n=0,r=0;for(;r<t;)i+=e[r].clientX,n+=e[r].clientY,r++;return{x:Math.round(i/t),y:Math.round(n/t)}}function rM(e){const t=[];let i=0;for(;i<e.pointers.length;)t[i]={clientX:Math.round(e.pointers[i].clientX),clientY:Math.round(e.pointers[i].clientY)},i++;return{timeStamp:Date.now(),pointers:t,center:nM(t),deltaX:e.deltaX,deltaY:e.deltaY}}function oM(e,t){const i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}function sM(e,t){const i=t.clientX-e.clientX,n=t.clientY-e.clientY;return Math.sqrt(i*i+n*n)}function PJ(e,t){const i=t.x-e.x,n=t.y-e.y;return Math.atan2(n,i)*180/Math.PI}function aM(e,t){const i=t.clientX-e.clientX,n=t.clientY-e.clientY;return Math.atan2(n,i)*180/Math.PI}function lM(e,t){return e===t?So.None:Math.abs(e)>=Math.abs(t)?e<0?So.Left:So.Right:t<0?So.Up:So.Down}function RJ(e,t){const i=t.center;let n=e.offsetDelta,r=e.prevDelta;const s=e.prevInput;return(t.eventType===go.Start||(s==null?void 0:s.eventType)===go.End)&&(r=e.prevDelta={x:(s==null?void 0:s.deltaX)||0,y:(s==null?void 0:s.deltaY)||0},n=e.offsetDelta={x:i.x,y:i.y}),{deltaX:r.x+(i.x-n.x),deltaY:r.y+(i.y-n.y)}}function cM(e,t,i){return{x:t/e||0,y:i/e||0}}function DJ(e,t){return sM(t[0],t[1])/sM(e[0],e[1])}function OJ(e,t){return aM(t[1],t[0])-aM(e[1],e[0])}function LJ(e,t){const i=e.lastInterval||t,n=t.timeStamp-i.timeStamp;let r,s,o,l;if(t.eventType!==go.Cancel&&(n>EJ||i.velocity===void 0)){const h=t.deltaX-i.deltaX,A=t.deltaY-i.deltaY,v=cM(n,h,A);s=v.x,o=v.y,r=Math.abs(v.x)>Math.abs(v.y)?v.x:v.y,l=lM(h,A),e.lastInterval=t}else r=i.velocity,s=i.velocityX,o=i.velocityY,l=i.direction;t.velocity=r,t.velocityX=s,t.velocityY=o,t.direction=l}function FJ(e,t){const{session:i}=e,{pointers:n}=t,{length:r}=n;i.firstInput||(i.firstInput=rM(t)),r>1&&!i.firstMultiple?i.firstMultiple=rM(t):r===1&&(i.firstMultiple=!1);const{firstInput:s,firstMultiple:o}=i,l=o?o.center:s.center,h=t.center=nM(n);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-s.timeStamp,t.angle=PJ(l,h),t.distance=oM(l,h);const{deltaX:A,deltaY:v}=RJ(i,t);t.deltaX=A,t.deltaY=v,t.offsetDirection=lM(t.deltaX,t.deltaY);const C=cM(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=C.x,t.overallVelocityY=C.y,t.overallVelocity=Math.abs(C.x)>Math.abs(C.y)?C.x:C.y,t.scale=o?DJ(o.pointers,n):1,t.rotation=o?OJ(o.pointers,n):0,t.maxPointers=i.prevInput?t.pointers.length>i.prevInput.maxPointers?t.pointers.length:i.prevInput.maxPointers:t.pointers.length;let S=e.element;return MJ(t.srcEvent.target,S)&&(S=t.srcEvent.target),t.target=S,LJ(i,t),t}function kJ(e,t,i){const n=i.pointers.length,r=i.changedPointers.length,s=t&go.Start&&n-r===0,o=t&(go.End|go.Cancel)&&n-r===0;i.isFirst=!!s,i.isFinal=!!o,s&&(e.session={}),i.eventType=t;const l=FJ(e,i);e.emit("hammer.input",l),e.recognize(l),e.session.prevInput=l}let NJ=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){kJ(this.manager,e,t)}init(){mb(this.element,this.evEl,this.domHandler),mb(this.target,this.evTarget,this.domHandler),mb(iM(this.element),this.evWin,this.domHandler)}destroy(){yb(this.element,this.evEl,this.domHandler),yb(this.target,this.evTarget,this.domHandler),yb(iM(this.element),this.evWin,this.domHandler)}};const UJ={pointerdown:go.Start,pointermove:go.Move,pointerup:go.End,pointercancel:go.Cancel,pointerout:go.Cancel},GJ="pointerdown",zJ="pointermove pointerup pointercancel";class VJ extends NJ{constructor(t){super(t),this.evEl=GJ,this.evWin=zJ,this.store=this.manager.session.pointerEvents=[],this.init()}handler(t){const{store:i}=this;let n=!1;const r=UJ[t.type],s=t.pointerType,o=s==="touch";let l=i.findIndex(h=>h.pointerId===t.pointerId);r&go.Start&&(t.buttons||o)?l<0&&(i.push(t),l=i.length-1):r&(go.End|go.Cancel)&&(n=!0),!(l<0)&&(i[l]=t,this.callback(r,{pointers:i,changedPointers:[t],eventType:r,pointerType:s,srcEvent:t}),n&&i.splice(l,1))}}const jJ=["","webkit","Moz","MS","ms","o"];function HJ(e,t){const i=t[0].toUpperCase()+t.slice(1);for(const n of jJ){const r=n?n+i:t;if(r in e)return r}}const WJ=1,uM=2,hM={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};let JJ=class{constructor(e,t){this.options={...hM,...t,cssProps:{...hM.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new VJ(this),this.touchAction=new IJ(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?uM:WJ}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let i;const{recognizers:n}=this;let{curRecognizer:r}=t;(!r||r&&r.state&yn.Recognized)&&(r=t.curRecognizer=null);let s=0;for(;s<n.length;)i=n[s],t.stopped!==uM&&(!r||i===r||i.canRecognizeWith(r))?i.recognize(e):i.reset(),!r&&i.state&(yn.Began|yn.Changed|yn.Ended)&&(r=t.curRecognizer=i),s++}get(e){const{recognizers:t}=this;for(let i=0;i<t.length;i++)if(t[i].options.event===e)return t[i];return null}add(e){if(Array.isArray(e)){for(const i of e)this.add(i);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const i of e)this.remove(i);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:i}=this,n=i.indexOf(t);n!==-1&&(i.splice(n,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:i}=this;for(const n of R0(e))i[n]=i[n]||[],i[n].push(t)}off(e,t){if(!e)return;const{handlers:i}=this;for(const n of R0(e))t?i[n]&&i[n].splice(i[n].indexOf(t),1):delete i[n]}emit(e,t){const i=this.handlers[e]&&this.handlers[e].slice();if(!i||!i.length)return;const n=t;n.type=e,n.preventDefault=function(){t.srcEvent.preventDefault()};let r=0;for(;r<i.length;)i[r](n),r++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[i,n]of Object.entries(this.options.cssProps)){const r=HJ(t.style,i);e?(this.oldCssProps[r]=t.style[r],t.style[r]=n):t.style[r]=this.oldCssProps[r]||""}e||(this.oldCssProps={})}}},XJ=1;function KJ(){return XJ++}function fM(e){return e&yn.Cancelled?"cancel":e&yn.Ended?"end":e&yn.Changed?"move":e&yn.Began?"start":""}class dM{constructor(t){this.options=t,this.id=KJ(),this.state=yn.Possible,this.simultaneous={},this.requireFail=[]}set(t){return Object.assign(this.options,t),this.manager.touchAction.update(),this}recognizeWith(t){if(Array.isArray(t)){for(const r of t)this.recognizeWith(r);return this}let i;if(typeof t=="string"){if(i=this.manager.get(t),!i)throw new Error(`Cannot find recognizer ${t}`)}else i=t;const{simultaneous:n}=this;return n[i.id]||(n[i.id]=i,i.recognizeWith(this)),this}dropRecognizeWith(t){if(Array.isArray(t)){for(const n of t)this.dropRecognizeWith(n);return this}let i;return typeof t=="string"?i=this.manager.get(t):i=t,i&&delete this.simultaneous[i.id],this}requireFailure(t){if(Array.isArray(t)){for(const r of t)this.requireFailure(r);return this}let i;if(typeof t=="string"){if(i=this.manager.get(t),!i)throw new Error(`Cannot find recognizer ${t}`)}else i=t;const{requireFail:n}=this;return n.indexOf(i)===-1&&(n.push(i),i.requireFailure(this)),this}dropRequireFailure(t){if(Array.isArray(t)){for(const n of t)this.dropRequireFailure(n);return this}let i;if(typeof t=="string"?i=this.manager.get(t):i=t,i){const n=this.requireFail.indexOf(i);n>-1&&this.requireFail.splice(n,1)}return this}hasRequireFailures(){return!!this.requireFail.find(t=>t.options.enable)}canRecognizeWith(t){return!!this.simultaneous[t.id]}emit(t){if(!t)return;const{state:i}=this;i<yn.Ended&&this.manager.emit(this.options.event+fM(i),t),this.manager.emit(this.options.event,t),t.additionalEvent&&this.manager.emit(t.additionalEvent,t),i>=yn.Ended&&this.manager.emit(this.options.event+fM(i),t)}tryEmit(t){this.canEmit()?this.emit(t):this.state=yn.Failed}canEmit(){let t=0;for(;t<this.requireFail.length;){if(!(this.requireFail[t].state&(yn.Failed|yn.Possible)))return!1;t++}return!0}recognize(t){const i={...t};if(!this.options.enable){this.reset(),this.state=yn.Failed;return}this.state&(yn.Recognized|yn.Cancelled|yn.Failed)&&(this.state=yn.Possible),this.state=this.process(i),this.state&(yn.Began|yn.Changed|yn.Ended|yn.Cancelled)&&this.tryEmit(i)}getEventNames(){return[this.options.event]}reset(){}}class pM extends dM{attrTest(t){const i=this.options.pointers;return i===0||t.pointers.length===i}process(t){const{state:i}=this,{eventType:n}=t,r=i&(yn.Began|yn.Changed),s=this.attrTest(t);return r&&(n&go.Cancel||!s)?i|yn.Cancelled:r||s?n&go.End?i|yn.Ended:i&yn.Began?i|yn.Changed:yn.Began:yn.Failed}}class AM extends dM{constructor(t={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...t}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[pb]}process(t){const{options:i}=this,n=t.pointers.length===i.pointers,r=t.distance<i.threshold,s=t.deltaTime<i.time;if(this.reset(),t.eventType&go.Start&&this.count===0)return this.failTimeout();if(r&&s&&n){if(t.eventType!==go.End)return this.failTimeout();const o=this.pTime?t.timeStamp-this.pTime<i.interval:!0,l=!this.pCenter||oM(this.pCenter,t.center)<i.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,!l||!o?this.count=1:this.count+=1,this._input=t,this.count%i.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=yn.Recognized,this.tryEmit(this._input)},i.interval),yn.Began):yn.Recognized}return yn.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=yn.Failed},this.options.interval),yn.Failed}reset(){clearTimeout(this._timer)}emit(t){this.state===yn.Recognized&&(t.tapCount=this.count,this.manager.emit(this.options.event,t))}}const QJ=["","start","move","end","cancel","up","down","left","right"];class gM extends pM{constructor(t={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:So.All,...t}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:t}}=this,i=[];return t&So.Horizontal&&i.push(gb),t&So.Vertical&&i.push(Ab),i}getEventNames(){return QJ.map(t=>this.options.event+t)}directionTest(t){const{options:i}=this;let n=!0,{distance:r}=t,{direction:s}=t;const o=t.deltaX,l=t.deltaY;return s&i.direction||(i.direction&So.Horizontal?(s=o===0?So.None:o<0?So.Left:So.Right,n=o!==this.pX,r=Math.abs(t.deltaX)):(s=l===0?So.None:l<0?So.Up:So.Down,n=l!==this.pY,r=Math.abs(t.deltaY))),t.direction=s,n&&r>i.threshold&&!!(s&i.direction)}attrTest(t){return super.attrTest(t)&&(!!(this.state&yn.Began)||!(this.state&yn.Began)&&this.directionTest(t))}emit(t){this.pX=t.deltaX,this.pY=t.deltaY;const i=So[t.direction].toLowerCase();i&&(t.additionalEvent=this.options.event+i),super.emit(t)}}const ZJ=["","start","move","end","cancel","in","out"];class YJ extends pM{constructor(t={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...t})}getTouchAction(){return[P0]}getEventNames(){return ZJ.map(t=>this.options.event+t)}attrTest(t){return super.attrTest(t)&&(Math.abs(t.scale-1)>this.options.threshold||!!(this.state&yn.Began))}emit(t){if(t.scale!==1){const i=t.scale<1?"in":"out";t.additionalEvent=this.options.event+i}super.emit(t)}}let D0=class{constructor(e,t,i){this.element=e,this.callback=t,this.options=i}};const qJ=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",$J=qJ.indexOf("firefox")!==-1,mM=4.000244140625,tX=40,eX=.25;let iX=class extends D0{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=n=>{if(!this.options.enable)return;let r=n.deltaY;globalThis.WheelEvent&&($J&&n.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(r/=globalThis.devicePixelRatio),n.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(r*=tX)),r!==0&&r%mM===0&&(r=Math.floor(r/mM)),n.shiftKey&&r&&(r=r*eX),this.callback({type:"wheel",center:{x:n.clientX,y:n.clientY},delta:-r,srcEvent:n,pointerType:"mouse",target:n.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}};const yM=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];let nX=class extends D0{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=r=>{this.handleOverEvent(r),this.handleOutEvent(r),this.handleEnterEvent(r),this.handleLeaveEvent(r),this.handleMoveEvent(r)},this.pressed=!1;const{enable:n}=this.options;this.enableMoveEvent=n,this.enableLeaveEvent=n,this.enableEnterEvent=n,this.enableOutEvent=n,this.enableOverEvent=n,yM.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){yM.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}};const _M=["keydown","keyup"];let rX=class extends D0{constructor(e,t,i){super(e,t,{enable:!0,tabIndex:0,...i}),this.handleEvent=n=>{const r=n.target||n.srcElement;r.tagName==="INPUT"&&r.type==="text"||r.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:"keydown",srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:"keyup",srcEvent:n,key:n.key,target:n.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",_M.forEach(n=>e.addEventListener(n,this.handleEvent))}destroy(){_M.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}},oX=class extends D0{constructor(e,t,i){super(e,t,i),this.handleEvent=n=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}};const vM=1,_b=2,bM=4,sX={pointerdown:vM,pointermove:_b,pointerup:bM,mousedown:vM,mousemove:_b,mouseup:bM},aX=0,lX=1,cX=2,uX=1,hX=2,fX=4;function dX(e){const t=sX[e.srcEvent.type];if(!t)return null;const{buttons:i,button:n}=e.srcEvent;let r=!1,s=!1,o=!1;return t===_b?(r=!!(i&uX),s=!!(i&fX),o=!!(i&hX)):(r=n===aX,s=n===lX,o=n===cX),{leftButton:r,middleButton:s,rightButton:o}}function pX(e,t){const i=e.center;if(!i)return null;const n=t.getBoundingClientRect(),r=n.width/t.offsetWidth||1,s=n.height/t.offsetHeight||1,o={x:(i.x-n.left-t.clientLeft)/r,y:(i.y-n.top-t.clientTop)/s};return{center:i,offsetCenter:o}}const AX={srcElement:"root",priority:0};let gX=class{constructor(e,t){this.handleEvent=i=>{if(this.isEmpty())return;const n=this._normalizeEvent(i);let r=i.srcEvent.target;for(;r&&r!==n.rootElement;){if(this._emit(n,r),n.handled)return;r=r.parentNode}this._emit(n,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,i,n=!1,r=!1){const{handlers:s,handlersByElement:o}=this,l={...AX,...i};let h=o.get(l.srcElement);h||(h=[],o.set(l.srcElement,h));const A={type:e,handler:t,srcElement:l.srcElement,priority:l.priority};n&&(A.once=!0),r&&(A.passive=!0),s.push(A),this._active=this._active||!A.passive;let v=h.length-1;for(;v>=0&&!(h[v].priority>=A.priority);)v--;h.splice(v+1,0,A)}remove(e,t){const{handlers:i,handlersByElement:n}=this;for(let r=i.length-1;r>=0;r--){const s=i[r];if(s.type===e&&s.handler===t){i.splice(r,1);const o=n.get(s.srcElement);o.splice(o.indexOf(s),1),o.length===0&&n.delete(s.srcElement)}}this._active=i.some(r=>!r.passive)}_emit(e,t){const i=this.handlersByElement.get(t);if(i){let n=!1;const r=()=>{e.handled=!0},s=()=>{e.handled=!0,n=!0},o=[];for(let l=0;l<i.length;l++){const{type:h,handler:A,once:v}=i[l];if(A({...e,type:h,stopPropagation:r,stopImmediatePropagation:s}),v&&o.push(i[l]),n)break}for(let l=0;l<o.length;l++){const{type:h,handler:A}=o[l];this.remove(h,A)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...dX(e),...pX(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}};function mX(e){if("recognizer"in e)return e;let t;const i=Array.isArray(e)?[...e]:[e];if(typeof i[0]=="function"){const n=i.shift(),r=i.shift()||{};t=new n(r)}else t=i.shift();return{recognizer:t,recognizeWith:typeof i[0]=="string"?[i[0]]:i[0],requireFailure:typeof i[1]=="string"?[i[1]]:i[1]}}let yX=class{constructor(e=null,t={}){if(this._onBasicInput=i=>{this.manager.emit(i.srcEvent.type,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new JJ(e,this.options);for(const i of this.options.recognizers){const{recognizer:n,recognizeWith:r,requireFailure:s}=mX(i);this.manager.add(n),r&&n.recognizeWith(r),s&&n.requireFailure(s)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new iX(e,this._onOtherEvent,{enable:!1}),this.moveInput=new nX(e,this._onOtherEvent,{enable:!1}),this.keyInput=new rX(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new oX(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,i){this._addEventHandler(e,t,i,!1)}once(e,t,i){this._addEventHandler(e,t,i,!0)}watch(e,t,i){this._addEventHandler(e,t,i,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){var i,n,r,s;const{manager:o}=this;if(!o)return;const l=o.get(e);l&&(l.set({enable:t}),o.touchAction.update()),(i=this.wheelInput)==null||i.enableEventType(e,t),(n=this.moveInput)==null||n.enableEventType(e,t),(r=this.keyInput)==null||r.enableEventType(e,t),(s=this.contextmenuInput)==null||s.enableEventType(e,t)}_addEventHandler(e,t,i,n,r){if(typeof e!="string"){i=t;for(const[h,A]of Object.entries(e))this._addEventHandler(h,A,i,n,r);return}const{manager:s,events:o}=this;if(!s)return;let l=o.get(e);if(!l){const h=this._getRecognizerName(e)||e;l=new gX(this,h),o.set(e,l),s&&s.on(e,l.handleEvent)}l.add(e,t,i,n,r),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[r,s]of Object.entries(e))this._removeEventHandler(r,s);return}const{events:i}=this,n=i.get(e);if(n&&(n.remove(e,t),n.isEmpty())){const{recognizerName:r}=n;let s=!1;for(const o of i.values())if(o.recognizerName===r&&!o.isEmpty()){s=!0;break}s||this._toggleRecognizer(r,!1)}}_getRecognizerName(e){var t;return(t=this.manager.recognizers.find(i=>i.getEventNames().includes(e)))==null?void 0:t.options.event}};const qi={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(qi,"IDENTITY",{get:()=>(Yi.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const da={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Ds={common:0,meters:1,pixels:2},vb={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},xM={multipan:[gM,{threshold:10,direction:So.Vertical,pointers:2}],pinch:[YJ,{},null,["multipan"]],pan:[gM,{threshold:1},["pinch"],["multipan"]],dblclick:[AM,{event:"dblclick",taps:2}],click:[AM,{event:"click"},null,["dblclick"]]};function _X(e,t){if(e===t)return!0;if(Array.isArray(e)){const i=e.length;if(!t||t.length!==i)return!1;for(let n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0}return!1}function $A(e){let t={},i;return n=>{for(const r in n)if(!_X(n[r],t[r])){i=e(n),t=n;break}return i}}const wM=[0,0,0,0],vX=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],CM=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],bX=[0,0,0],EM=[0,0,0],xX=$A(EX);function BM(e,t,i=EM){i.length<3&&(i=[i[0],i[1],0]);let n=i,r,s=!0;switch(t===qi.LNGLAT_OFFSETS||t===qi.METER_OFFSETS?r=i:r=e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case da.WEB_MERCATOR:(t===qi.LNGLAT||t===qi.CARTESIAN)&&(r=[0,0,0],s=!1);break;case da.WEB_MERCATOR_AUTO_OFFSET:t===qi.LNGLAT?n=r:t===qi.CARTESIAN&&(n=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],r=e.unprojectPosition(n),n[0]-=i[0],n[1]-=i[1],n[2]-=i[2]);break;case da.IDENTITY:n=e.position.map(Math.fround),n[2]=n[2]||0;break;case da.GLOBE:s=!1,r=null;break;default:s=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:n,offsetMode:s}}function wX(e,t,i){const{viewMatrixUncentered:n,projectionMatrix:r}=e;let{viewMatrix:s,viewProjectionMatrix:o}=e,l=wM,h=wM,A=e.cameraPosition;const{geospatialOrigin:v,shaderCoordinateOrigin:C,offsetMode:S}=BM(e,t,i);return S&&(h=e.projectPosition(v||C),A=[A[0]-h[0],A[1]-h[1],A[2]-h[2]],h[3]=1,l=kd([],h,o),s=n||s,o=qh([],r,s),o=qh([],o,vX)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:l,originCommon:h,cameraPosCommon:A,shaderCoordinateOrigin:C,geospatialOrigin:v}}function CX({viewport:e,devicePixelRatio:t=1,modelMatrix:i=null,coordinateSystem:n=qi.DEFAULT,coordinateOrigin:r=EM,autoWrapLongitude:s=!1}){n===qi.DEFAULT&&(n=e.isGeospatial?qi.LNGLAT:qi.CARTESIAN);const o=xX({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:r});return o.wrapLongitude=s,o.modelMatrix=i||CM,o}function EX({viewport:e,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:n}){const{projectionCenter:r,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:l,shaderCoordinateOrigin:h,geospatialOrigin:A}=wX(e,i,n),v=e.getDistanceScales(),C=[e.width*t,e.height*t],S=kd([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,L={coordinateSystem:i,projectionMode:e.projectionMode,coordinateOrigin:h,commonOrigin:o.slice(0,3),center:r,pseudoMeters:!!e._pseudoMeters,viewportSize:C,devicePixelRatio:t,focalDistance:S,commonUnitsPerMeter:v.unitsPerMeter,commonUnitsPerWorldUnit:v.unitsPerMeter,commonUnitsPerWorldUnit2:bX,scale:e.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:CM,cameraPosition:l};if(A){const N=e.getDistanceScales(A);switch(i){case qi.METER_OFFSETS:L.commonUnitsPerWorldUnit=N.unitsPerMeter,L.commonUnitsPerWorldUnit2=N.unitsPerMeter2;break;case qi.LNGLAT:case qi.LNGLAT_OFFSETS:e._pseudoMeters||(L.commonUnitsPerMeter=N.unitsPerMeter),L.commonUnitsPerWorldUnit=N.unitsPerDegree,L.commonUnitsPerWorldUnit2=N.unitsPerDegree2;break;case qi.CARTESIAN:L.commonUnitsPerWorldUnit=[1,1,N.unitsPerMeter[2]],L.commonUnitsPerWorldUnit2=[0,0,N.unitsPerMeter2[2]];break}}return L}const BX=Object.keys(qi).map(e=>`const COORDINATE_SYSTEM_${e}: i32 = ${qi[e]};`).join(""),TX=Object.keys(da).map(e=>`const PROJECTION_MODE_${e}: i32 = ${da[e]};`).join(""),SX=Object.keys(Ds).map(e=>`const UNIT_${e.toUpperCase()}: i32 = ${Ds[e]};`).join(""),IX=`${BX}
${TX}
${SX}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,MX=`${IX}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the z\u2011axis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,PX=Object.keys(qi).map(e=>`const int COORDINATE_SYSTEM_${e} = ${qi[e]};`).join(""),RX=Object.keys(da).map(e=>`const int PROJECTION_MODE_${e} = ${da[e]};`).join(""),DX=Object.keys(Ds).map(e=>`const int UNIT_${e.toUpperCase()} = ${Ds[e]};`).join(""),OX=`${PX}
${RX}
${DX}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,LX={};function FX(e=LX){return"viewport"in e?CX(e):{}}const O0={name:"project",dependencies:[oJ,eM],source:MX,vs:OX,getUniforms:FX,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},kX=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,NX=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Uo={name:"project32",dependencies:[O0],source:kX,vs:NX};function UX(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Ud(e,t){const i=kd([],t,e);return ab(i,i,1/i[3]),i}function TM(e,t){const i=e%t;return i<0?t+i:i}function bb(e,t,i){return e<t?t:e>i?i:e}function GX(e){return Math.log(e)*Math.LOG2E}const xb=Math.log2||GX;function Zc(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const ml=Math.PI,SM=ml/4,ka=ml/180,wb=180/ml,Gd=512,L0=4003e4,Cb=85.051129,zX=1.5;function VX(e){return xb(e)}function Yc(e){const[t,i]=e;Zc(Number.isFinite(t)),Zc(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");const n=t*ka,r=i*ka,s=Gd*(n+ml)/(2*ml),o=Gd*(ml+Math.log(Math.tan(SM+r*.5)))/(2*ml);return[s,o]}function sc(e){const[t,i]=e,n=t/Gd*(2*ml)-ml,r=2*(Math.atan(Math.exp(i/Gd*(2*ml)-ml))-SM);return[n*wb,r*wb]}function jX(e){const{latitude:t}=e;Zc(Number.isFinite(t));const i=Math.cos(t*ka);return VX(L0*i)-9}function Eb(e){const t=Math.cos(e*ka);return Gd/L0/t}function Bb(e){const{latitude:t,longitude:i,highPrecision:n=!1}=e;Zc(Number.isFinite(t)&&Number.isFinite(i));const r=Gd,s=Math.cos(t*ka),o=r/360,l=o/s,h=r/L0/s,A={unitsPerMeter:[h,h,h],metersPerUnit:[1/h,1/h,1/h],unitsPerDegree:[o,l,h],degreesPerUnit:[1/o,1/l,1/h]};if(n){const v=ka*Math.tan(t*ka)/s,C=o*v/2,S=r/L0*v,L=S/l*h;A.unitsPerDegree2=[0,C,S],A.unitsPerMeter2=[L,0,L]}return A}function IM(e,t){const[i,n,r]=e,[s,o,l]=t,{unitsPerMeter:h,unitsPerMeter2:A}=Bb({longitude:i,latitude:n,highPrecision:!0}),v=Yc(e);v[0]+=s*(h[0]+A[0]*o),v[1]+=o*(h[1]+A[1]*o);const C=sc(v),S=(r||0)+(l||0);return Number.isFinite(r)||Number.isFinite(l)?[C[0],C[1],S]:C}function HX(e){const{height:t,pitch:i,bearing:n,altitude:r,scale:s,center:o}=e,l=UX();B0(l,l,[0,0,-r]),FI(l,l,-i*ka),kI(l,l,n*ka);const h=s/t;return sb(l,l,[h,h,h]),o&&B0(l,l,KH([],o)),l}function WX(e){const{width:t,height:i,altitude:n,pitch:r=0,offset:s,center:o,scale:l,nearZMultiplier:h=1,farZMultiplier:A=1}=e;let{fovy:v=tg(zX)}=e;n!==void 0&&(v=tg(n));const C=v*ka,S=r*ka,L=Tb(v);let N=L;o&&(N+=o[2]*l/Math.cos(S)/i);const G=C*(.5+(s?s[1]:0)/i),W=Math.sin(G)*N/Math.sin(bb(Math.PI/2-S-G,.01,Math.PI-.01)),j=Math.sin(S)*W+N,q=N*10,Z=Math.min(j*A,q);return{fov:C,aspect:t/i,focalDistance:L,near:h,far:Z}}function tg(e){return 2*Math.atan(.5/e)*wb}function Tb(e){return .5/Math.tan(.5*e*ka)}function MM(e,t){const[i,n,r=0]=e;return Zc(Number.isFinite(i)&&Number.isFinite(n)&&Number.isFinite(r)),Ud(t,[i,n,r,1])}function Sb(e,t,i=0){const[n,r,s]=e;if(Zc(Number.isFinite(n)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(s))return Ud(t,[n,r,s,1]);const o=Ud(t,[n,r,0,1]),l=Ud(t,[n,r,1,1]),h=o[2],A=l[2],v=h===A?0:((i||0)-h)/(A-h);return vI([],o,l,v)}function JX(e){const{width:t,height:i,bounds:n,minExtent:r=0,maxZoom:s=24,offset:o=[0,0]}=e,[[l,h],[A,v]]=n,C=XX(e.padding),S=Yc([l,bb(v,-85.051129,Cb)]),L=Yc([A,bb(h,-85.051129,Cb)]),N=[Math.max(Math.abs(L[0]-S[0]),r),Math.max(Math.abs(L[1]-S[1]),r)],G=[t-C.left-C.right-Math.abs(o[0])*2,i-C.top-C.bottom-Math.abs(o[1])*2];Zc(G[0]>0&&G[1]>0);const W=G[0]/N[0],j=G[1]/N[1],q=(C.right-C.left)/2/W,Z=(C.top-C.bottom)/2/j,K=[(L[0]+S[0])/2+q,(L[1]+S[1])/2+Z],ft=sc(K),rt=Math.min(s,xb(Math.abs(Math.min(W,j))));return Zc(Number.isFinite(rt)),{longitude:ft[0],latitude:ft[1],zoom:rt}}function XX(e=0){return typeof e=="number"?{top:e,bottom:e,left:e,right:e}:(Zc(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}const PM=Math.PI/180;function KX(e,t=0){const{width:i,height:n,unproject:r}=e,s={targetZ:t},o=r([0,n],s),l=r([i,n],s);let h,A;const v=e.fovy?.5*e.fovy*PM:Math.atan(.5/e.altitude),C=(90-e.pitch)*PM;return v>C-.01?(h=RM(e,0,t),A=RM(e,i,t)):(h=r([0,0],s),A=r([i,0],s)),[o,l,A,h]}function RM(e,t,i){const{pixelUnprojectionMatrix:n}=e,r=Ud(n,[t,0,1,1]),s=Ud(n,[t,e.height,1,1]),o=(i*e.distanceScales.unitsPerMeter[2]-r[2])/(s[2]-r[2]),l=vI([],r,s,o),h=sc(l);return h.push(i),h}const DM=512;function QX(e){const{width:t,height:i,pitch:n=0}=e;let{longitude:r,latitude:s,zoom:o,bearing:l=0}=e;(r<-180||r>180)&&(r=TM(r+180,360)-180),(l<-180||l>180)&&(l=TM(l+180,360)-180);const h=xb(i/DM);if(o<=h)o=h,s=0;else{const A=i/2/Math.pow(2,o),v=sc([0,A])[1];if(s<v)s=v;else{const C=sc([0,DM-A])[1];s>C&&(s=C)}}return{width:t,height:i,longitude:r,latitude:s,zoom:o,pitch:n,bearing:l}}const OM=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,ZX=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,YX=`
${OM}
${ZX}
`,qX=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,$X=`
${OM}
${qX}
`,tK=$A(oK),eK=$A(sK),iK=[0,0,0,1],nK=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function rK(e,t){const[i,n,r]=e,s=Sb([i,n,r],t);return Number.isFinite(r)?s:[s[0],s[1],0]}function oK({viewport:e,center:t}){return new mn(e.viewProjectionMatrix).invert().transform(t)}function sK({viewport:e,shadowMatrices:t}){const i=[],n=e.pixelUnprojectionMatrix,r=e.isGeospatial?void 0:1,s=[[0,0,r],[e.width,0,r],[0,e.height,r],[e.width,e.height,r],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(o=>rK(o,n));for(const o of t){const l=o.clone().translate(new de(e.center).negate()),h=s.map(v=>l.transform(v)),A=new mn().ortho({left:Math.min(...h.map(v=>v[0])),right:Math.max(...h.map(v=>v[0])),bottom:Math.min(...h.map(v=>v[1])),top:Math.max(...h.map(v=>v[1])),near:Math.min(...h.map(v=>-v[2])),far:Math.max(...h.map(v=>-v[2]))});i.push(A.multiplyRight(o))}return i}function aK(e){const{shadowEnabled:t=!0,project:i}=e;if(!t||!i||!e.shadowMatrices||!e.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};const n=O0.getUniforms(i),r=tK({viewport:i.viewport,center:n.center}),s=[],o=eK({shadowMatrices:e.shadowMatrices,viewport:i.viewport}).slice();for(let h=0;h<e.shadowMatrices.length;h++){const A=o[h],v=A.clone().translate(new de(i.viewport.center).negate());n.coordinateSystem===qi.LNGLAT&&n.projectionMode===da.WEB_MERCATOR?(o[h]=v,s[h]=r):(o[h]=A.clone().multiplyRight(nK),s[h]=v.transform(r))}const l={drawShadowMap:!!e.drawToShadowMap,useShadowMap:e.shadowMaps?e.shadowMaps.length>0:!1,color:e.shadowColor||iK,lightId:e.shadowLightId||0,lightCount:e.shadowMatrices.length,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};for(let h=0;h<o.length;h++)l[`viewProjectionMatrix${h}`]=o[h],l[`projectCenter${h}`]=s[h];for(let h=0;h<2;h++)l[`shadow_uShadowMap${h}`]=e.shadowMaps&&e.shadowMaps[h]||e.dummyShadowMap;return l}const LM={name:"shadow",dependencies:[O0],vs:YX,fs:$X,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:aK,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},pa={...JI,defaultUniforms:{...JI.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},lK=[eM],cK=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],uK=[];function hK(e){const t=YT.getDefaultShaderAssembler();for(const n of lK)t.addDefaultModule(n);const i=e==="glsl"?cK:uK;for(const n of i)t.addShaderHook(n);return t}const fK=[255,255,255],dK=1;let pK=0;class AK{constructor(t={}){this.type="ambient";const{color:i=fK}=t,{intensity:n=dK}=t;this.id=t.id||`ambient-${pK++}`,this.color=i,this.intensity=n}}const gK=[255,255,255],mK=1,yK=[0,0,-1];let _K=0;class FM{constructor(t={}){this.type="directional";const{color:i=gK}=t,{intensity:n=mK}=t,{direction:r=yK}=t,{_shadow:s=!1}=t;this.id=t.id||`directional-${_K++}`,this.color=i,this.intensity=n,this.type="directional",this.direction=new de(r).normalize().toArray(),this.shadow=s}getProjectedLight(t){return this}}class kM{constructor(t,i={id:"pass"}){const{id:n}=i;this.id=n,this.device=t,this.props={...i}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class F0 extends kM{constructor(){super(...arguments),this._lastRenderIndex=-1}render(t){const[i,n]=this.device.canvasContext.getDrawingBufferSize(),r=t.clearCanvas??!0,s=t.clearColor??(r?[0,0,0,0]:!1),o=r?1:!1,l=r?0:!1,h=t.colorMask??15,A={viewport:[0,0,i,n]};t.colorMask&&(A.colorMask=h),t.scissorRect&&(A.scissorRect=t.scissorRect);const v=this.device.beginRenderPass({framebuffer:t.target,parameters:A,clearColor:s,clearDepth:o,clearStencil:l});try{return this._drawLayers(v,t)}finally{v.end(),this.device.submit()}}_drawLayers(t,i){const{target:n,shaderModuleProps:r,viewports:s,views:o,onViewportActive:l,clearStack:h=!0}=i;i.pass=i.pass||"unknown",h&&(this._lastRenderIndex=-1);const A=[];for(const v of s){const C=o&&o[v.id];l==null||l(v);const S=this._getDrawLayerParams(v,i),L=v.subViewports||[v];for(const N of L){const G=this._drawLayersInViewport(t,{target:n,shaderModuleProps:r,viewport:N,view:C,pass:i.pass,layers:i.layers},S);A.push(G)}}return A}_getDrawLayerParams(t,{layers:i,pass:n,isPicking:r=!1,layerFilter:s,cullRect:o,effects:l,shaderModuleProps:h},A=!1){var v;const C=[],S=NM(this._lastRenderIndex+1),L={layer:i[0],viewport:t,isPicking:r,renderPass:n,cullRect:o},N={};for(let G=0;G<i.length;G++){const W=i[G],j=this._shouldDrawLayer(W,L,s,N),q={shouldDrawLayer:j};j&&!A&&(q.shouldDrawLayer=!0,q.layerRenderIndex=S(W,j),q.shaderModuleProps=this._getShaderModuleProps(W,l,n,h),q.layerParameters={...(v=W.context.deck)==null?void 0:v.props.parameters,...this.getLayerParameters(W,G,t)}),C[G]=q}return C}_drawLayersInViewport(t,{layers:i,shaderModuleProps:n,pass:r,target:s,viewport:o,view:l},h){const A=vK(this.device,{shaderModuleProps:n,target:s,viewport:o});if(l&&l.props.clear){const C=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;this.device.beginRenderPass({framebuffer:s,parameters:{viewport:A,scissorRect:A},clearColor:C.color?[0,0,0,0]:!1,clearDepth:C.depth?1:!1}).end()}const v={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};t.setParameters({viewport:A});for(let C=0;C<i.length;C++){const S=i[C],L=h[C],{shouldDrawLayer:N}=L;if(N&&S.props.pickable&&v.pickableCount++,S.isComposite&&v.compositeCount++,S.isDrawable&&L.shouldDrawLayer){const{layerRenderIndex:G,shaderModuleProps:W,layerParameters:j}=L;v.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,G),W.project&&(W.project.viewport=o),S.context.renderPass=t;try{S._drawLayer({renderPass:t,shaderModuleProps:W,uniforms:{layerIndex:G},parameters:j})}catch(q){S.raiseError(q,`drawing ${S} to ${r}`)}}}return v}shouldDrawLayer(t){return!0}getShaderModuleProps(t,i,n){return null}getLayerParameters(t,i,n){return t.props.parameters}_shouldDrawLayer(t,i,n,r){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;i.layer=t;let s=t.parent;for(;s;){if(!s.props.visible||!s.filterSubLayer(i))return!1;i.layer=s,s=s.parent}if(n){const o=i.layer.id;if(o in r||(r[o]=n(i)),!r[o])return!1}return t.activateViewport(i.viewport),!0}_getShaderModuleProps(t,i,n,r){var s,o;const l=this.device.canvasContext.cssToDeviceRatio(),h=((s=t.internalState)==null?void 0:s.propsInTransition)||t.props,A={layer:h,picking:{isActive:!1},project:{viewport:t.context.viewport,devicePixelRatio:l,modelMatrix:h.modelMatrix,coordinateSystem:h.coordinateSystem,coordinateOrigin:h.coordinateOrigin,autoWrapLongitude:t.wrapLongitude}};if(i)for(const v of i)UM(A,(o=v.getShaderModuleProps)==null?void 0:o.call(v,t,A));return UM(A,this.getShaderModuleProps(t,i,A),r)}}function NM(e=0,t={}){const i={},n=(r,s)=>{const o=r.props._offset,l=r.id,h=r.parent&&r.parent.id;let A;if(h&&!(h in t)&&n(r.parent,!1),h in i){const v=i[h]=i[h]||NM(t[h],t);A=v(r,s),i[l]=v}else Number.isFinite(o)?(A=o+(t[h]||0),i[l]=null):A=e;return s&&A>=e&&(e=A+1),t[l]=A,A};return n}function vK(e,{shaderModuleProps:t,target:i,viewport:n}){var r;const s=((r=t==null?void 0:t.project)==null?void 0:r.devicePixelRatio)??e.canvasContext.cssToDeviceRatio(),[,o]=e.canvasContext.getDrawingBufferSize(),l=i?i.height:o,h=n;return[h.x*s,l-(h.y+h.height)*s,h.width*s,h.height*s]}function UM(e,...t){for(const i of t)if(i)for(const n in i)e[n]?Object.assign(e[n],i[n]):e[n]=i[n];return e}class bK extends F0{constructor(t,i){super(t,i);const n=t.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),r=t.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=t.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:r})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(t){const i=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),r=t.viewports[0],s=r.width*n,o=r.height*n,l=[1,1,1,1];(s!==i.width||o!==i.height)&&i.resize({width:s,height:o}),super.render({...t,clearColor:l,target:i,pass:"shadow"})}getLayerParameters(t,i,n){return{...t.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getShaderModuleProps(t,i,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const xK={color:[255,255,255],intensity:1},GM=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],wK=[0,0,0,200/255];class zM{constructor(t={}){this.id="lighting-effect",this.shadowColor=wK,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(t)}setup(t){this.context=t;const{device:i,deck:n}=t;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(i),n._addDefaultShaderModule(LM),this.dummyShadowMap=i.createTexture({width:1,height:1}))}setProps(t){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const i in t){const n=t[i];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(i=>i.shadow),this.context&&this.setup(this.context),this.props=t}preRender({layers:t,layerFilter:i,viewports:n,onViewportActive:r,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:t,layerFilter:i,viewports:n,onViewportActive:r,views:s,shaderModuleProps:{shadow:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(t,i){const n=this.shadow?{project:i.project,shadowMaps:this.shadowPasses.map(o=>o.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},r={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(o=>o.getProjectedLight({layer:t})),pointLights:this.pointLights.map(o=>o.getProjectedLight({layer:t}))},s=t.props.material;return{shadow:n,lighting:r,phongMaterial:s,gouraudMaterial:s}}cleanup(t){for(const i of this.shadowPasses)i.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,t.deck._removeDefaultShaderModule(LM))}_calculateMatrices(){const t=[];for(const i of this.directionalLights){const n=new mn().lookAt({eye:new de(i.direction).negate()});t.push(n)}return t}_createShadowPasses(t){for(let i=0;i<this.directionalLights.length;i++){const n=new bK(t);this.shadowPasses[i]=n}}_applyDefaultLights(){const{ambientLight:t,pointLights:i,directionalLights:n}=this;!t&&i.length===0&&n.length===0&&(this.ambientLight=new AK(xK),this.directionalLights.push(new FM(GM[0]),new FM(GM[1])))}}class CK{constructor(t={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,i,{size:n=1,type:r,padding:s=0,copy:o=!1,initialize:l=!1,maxCount:h}){const A=r||t&&t.constructor||Float32Array,v=i*n+s;if(ArrayBuffer.isView(t)){if(v<=t.length)return t;if(v*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new A(t.buffer,0,v)}let C=1/0;h&&(C=h*n+s);const S=this._allocate(A,v,l,C);return t&&o?S.set(t):l||S.fill(0,0,4),this._release(t),S}release(t){this._release(t)}_allocate(t,i,n,r){let s=Math.max(Math.ceil(i*this.opts.overAlloc),1);s>r&&(s=r);const o=this._pool,l=t.BYTES_PER_ELEMENT*s,h=o.findIndex(A=>A.byteLength>=l);if(h>=0){const A=new t(o.splice(h,1)[0],0,s);return n&&A.fill(0),A}return new t(s)}_release(t){if(!ArrayBuffer.isView(t))return;const i=this._pool,{buffer:n}=t,{byteLength:r}=n,s=i.findIndex(o=>o.byteLength>=r);s<0?i.push(n):(s>0||i.length<this.opts.poolSize)&&i.splice(s,0,n),i.length>this.opts.poolSize&&i.shift()}}const zd=new CK;function eg(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function EK(e){return[e[12],e[13],e[14]]}function BK(e){return{left:Vd(e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:Vd(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:Vd(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:Vd(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:Vd(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:Vd(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}}const VM=new de;function Vd(e,t,i,n){VM.set(e,t,i);const r=VM.len();return{distance:n/r,normal:new de(-e/r,-t/r,-i/r)}}function TK(e){return e-Math.fround(e)}let ig;function Ib(e,t){const{size:i=1,startIndex:n=0}=t,r=t.endIndex!==void 0?t.endIndex:e.length,s=(r-n)/i;ig=zd.allocate(ig,s,{type:Float32Array,size:i*2});let o=n,l=0;for(;o<r;){for(let h=0;h<i;h++){const A=e[o++];ig[l+h]=A,ig[l+h+i]=TK(A)}l+=i*2}return ig.subarray(0,s*i*2)}function SK(e){let t=null,i=!1;for(const n of e)n&&(t?(i||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],i=!0),t[0][0]=Math.min(t[0][0],n[0][0]),t[0][1]=Math.min(t[0][1],n[0][1]),t[1][0]=Math.max(t[1][0],n[1][0]),t[1][1]=Math.max(t[1][1],n[1][1])):t=n);return t}const IK=Math.PI/180,MK=eg(),jM=[0,0,0],PK={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function RK({width:e,height:t,orthographic:i,fovyRadians:n,focalDistance:r,padding:s,near:o,far:l}){const h=e/t,A=i?new mn().orthographic({fovy:n,aspect:h,focalDistance:r,near:o,far:l}):new mn().perspective({fovy:n,aspect:h,near:o,far:l});if(s){const{left:v=0,right:C=0,top:S=0,bottom:L=0}=s,N=Qc((v+e-C)/2,0,e)-e/2,G=Qc((S+t-L)/2,0,t)-t/2;A[8]-=N*2/e,A[9]+=G*2/t}return A}class hu{constructor(t={}){this._frustumPlanes={},this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||PK,this.focalDistance=t.focalDistance||1,this.position=t.position||jM,this.modelMatrix=t.modelMatrix||null;const{longitude:i,latitude:n}=t;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(i),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?da.WEB_MERCATOR:da.WEB_MERCATOR_AUTO_OFFSET:da.IDENTITY}equals(t){return t instanceof hu?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&fa(t.projectionMatrix,this.projectionMatrix)&&fa(t.viewMatrix,this.viewMatrix):!1}project(t,{topLeft:i=!0}={}){const n=this.projectPosition(t),r=MM(n,this.pixelProjectionMatrix),[s,o]=r,l=i?o:this.height-o;return t.length===2?[s,l]:[s,l,r[2]]}unproject(t,{topLeft:i=!0,targetZ:n}={}){const[r,s,o]=t,l=i?s:this.height-s,h=n&&n*this.distanceScales.unitsPerMeter[2],A=Sb([r,l,o],this.pixelUnprojectionMatrix,h),[v,C,S]=this.unprojectPosition(A);return Number.isFinite(o)?[v,C,S]:Number.isFinite(n)?[v,C,n]:[v,C]}projectPosition(t){const[i,n]=this.projectFlat(t),r=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[i,n,r]}unprojectPosition(t){const[i,n]=this.unprojectFlat(t),r=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[i,n,r]}projectFlat(t){if(this.isGeospatial){const i=Yc(t);return i[1]=Qc(i[1],-318,830),i}return t}unprojectFlat(t){return this.isGeospatial?sc(t):t}getBounds(t={}){const i={targetZ:t.z||0},n=this.unproject([0,0],i),r=this.unproject([this.width,0],i),s=this.unproject([0,this.height],i),o=this.unproject([this.width,this.height],i);return[Math.min(n[0],r[0],s[0],o[0]),Math.min(n[1],r[1],s[1],o[1]),Math.max(n[0],r[0],s[0],o[0]),Math.max(n[1],r[1],s[1],o[1])]}getDistanceScales(t){return t&&this.isGeospatial?Bb({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:i,width:n=1,height:r=1}){return t<this.x+this.width&&this.x<t+n&&i<this.y+this.height&&this.y<i+r}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,BK(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,i){return null}_initProps(t){const i=t.longitude,n=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=jX({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||Bb({latitude:n,longitude:i}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:s,modelMatrix:o}=t;let l=jM;if(s&&(l=o?new mn(o).transformAsVector(s,[]):s),this.isGeospatial){const h=this.projectPosition([i,n,0]);this.center=new de(l).scale(this.distanceScales.unitsPerMeter).add(h)}else this.center=this.projectPosition(l)}_initMatrices(t){const{viewMatrix:i=MK,projectionMatrix:n=null,orthographic:r=!1,fovyRadians:s,fovy:o=75,near:l=.1,far:h=1e3,padding:A=null,focalDistance:v=1}=t;this.viewMatrixUncentered=i,this.viewMatrix=new mn().multiplyRight(i).translate(new de(this.center).negate()),this.projectionMatrix=n||RK({width:this.width,height:this.height,orthographic:r,fovyRadians:s||o*IK,focalDistance:v,padding:A,near:l,far:h});const C=eg();qh(C,C,this.projectionMatrix),qh(C,C,this.viewMatrix),this.viewProjectionMatrix=C,this.viewMatrixInverse=ob([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=EK(this.viewMatrixInverse);const S=eg(),L=eg();sb(S,S,[this.width/2,-this.height/2,1]),B0(S,S,[1,-1,0]),qh(L,S,this.viewProjectionMatrix),this.pixelProjectionMatrix=L,this.pixelUnprojectionMatrix=ob(eg(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Yi.warn("Pixel project matrix not invertible")()}}hu.displayName="Viewport";let ng=class GE extends hu{constructor(t={}){const{latitude:i=0,longitude:n=0,zoom:r=0,pitch:s=0,bearing:o=0,nearZMultiplier:l=.1,farZMultiplier:h=1.01,nearZ:A,farZ:v,orthographic:C=!1,projectionMatrix:S,repeat:L=!1,worldOffset:N=0,position:G,padding:W,legacyMeterSizes:j=!1}=t;let{width:q,height:Z,altitude:K=1.5}=t;const ft=Math.pow(2,r);q=q||1,Z=Z||1;let rt,Lt=null;if(S)K=S[5]/2,rt=tg(K);else{t.fovy?(rt=t.fovy,K=Tb(rt)):rt=tg(K);let At;if(W){const{top:at=0,bottom:kt=0}=W;At=[0,Qc((at+Z-kt)/2,0,Z)-Z/2]}Lt=WX({width:q,height:Z,scale:ft,center:G&&[0,0,G[2]*Eb(i)],offset:At,pitch:s,fovy:rt,nearZMultiplier:l,farZMultiplier:h}),Number.isFinite(A)&&(Lt.near=A),Number.isFinite(v)&&(Lt.far=v)}let Vt=HX({height:Z,pitch:s,bearing:o,scale:ft,altitude:K});N&&(Vt=new mn().translate([512*N,0,0]).multiplyLeft(Vt)),super({...t,width:q,height:Z,viewMatrix:Vt,longitude:n,latitude:i,zoom:r,...Lt,fovy:rt,focalDistance:K}),this.latitude=i,this.longitude=n,this.zoom=r,this.pitch=s,this.bearing=o,this.altitude=K,this.fovy=rt,this.orthographic=C,this._subViewports=L?[]:null,this._pseudoMeters=j,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),i=Math.floor((t[0]+180)/360),n=Math.ceil((t[2]-180)/360);for(let r=i;r<=n;r++){const s=r?new GE({...this,worldOffset:r}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[i,n]=this.projectFlat(t),r=(t[2]||0)*Eb(t[1]);return[i,n,r]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[i,n]=this.unprojectFlat(t),r=(t[2]||0)/Eb(n);return[i,n,r]}addMetersToLngLat(t,i){return IM(t,i)}panByPosition(t,i){const n=Sb(i,this.pixelUnprojectionMatrix),r=this.projectFlat(t),s=_I([],r,zH([],n)),o=_I([],this.center,s),[l,h]=this.unprojectFlat(o);return{longitude:l,latitude:h}}getBounds(t={}){const i=KX(this,t.z||0);return[Math.min(i[0][0],i[1][0],i[2][0],i[3][0]),Math.min(i[0][1],i[1][1],i[2][1],i[3][1]),Math.max(i[0][0],i[1][0],i[2][0],i[3][0]),Math.max(i[0][1],i[1][1],i[2][1],i[3][1])]}fitBounds(t,i={}){const{width:n,height:r}=this,{longitude:s,latitude:o,zoom:l}=JX({width:n,height:r,bounds:t,...i});return new GE({width:n,height:r,longitude:s,latitude:o,zoom:l})}};ng.displayName="WebMercatorViewport";const HM=[0,0,0];function Mb(e,t,i=!1){const n=t.projectPosition(e);if(i&&t instanceof ng){const[r,s,o=0]=e,l=t.getDistanceScales([r,s]);n[2]=o*l.unitsPerMeter[2]}return n}function DK(e){const{viewport:t,modelMatrix:i,coordinateOrigin:n}=e;let{coordinateSystem:r,fromCoordinateSystem:s,fromCoordinateOrigin:o}=e;return r===qi.DEFAULT&&(r=t.isGeospatial?qi.LNGLAT:qi.CARTESIAN),s===void 0&&(s=r),o===void 0&&(o=n),{viewport:t,coordinateSystem:r,coordinateOrigin:n,modelMatrix:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function WM(e,{viewport:t,modelMatrix:i,coordinateSystem:n,coordinateOrigin:r,offsetMode:s}){let[o,l,h=0]=e;switch(i&&([o,l,h]=kd([],[o,l,h,1],i)),n){case qi.LNGLAT:return Mb([o,l,h],t,s);case qi.LNGLAT_OFFSETS:return Mb([o+r[0],l+r[1],h+(r[2]||0)],t,s);case qi.METER_OFFSETS:return Mb(IM(r,[o,l,h]),t,s);case qi.CARTESIAN:default:return t.isGeospatial?[o+r[0],l+r[1],h+r[2]]:t.projectPosition([o,l,h])}}function OK(e,t){const{viewport:i,coordinateSystem:n,coordinateOrigin:r,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:l}=DK(t),{autoOffset:h=!0}=t,{geospatialOrigin:A=HM,shaderCoordinateOrigin:v=HM,offsetMode:C=!1}=h?BM(i,n,r):{},S=WM(e,{viewport:i,modelMatrix:s,coordinateSystem:o,coordinateOrigin:l,offsetMode:C});if(C){const L=i.projectPosition(A||v);PI(S,S,L)}return S}let LK=1,FK=1;class JM{constructor(){z(this,"time",0),z(this,"channels",new Map),z(this,"animations",new Map),z(this,"playing",!1),z(this,"lastEngineTime",-1)}addChannel(t){const{delay:i=0,duration:n=Number.POSITIVE_INFINITY,rate:r=1,repeat:s=1}=t,o=LK++,l={time:0,delay:i,duration:n,rate:r,repeat:s};return this._setChannelTime(l,this.time),this.channels.set(o,l),o}removeChannel(t){this.channels.delete(t);for(const[i,n]of this.animations)n.channel===t&&this.detachAnimation(i)}isFinished(t){const i=this.channels.get(t);return i===void 0?!1:this.time>=i.delay+i.duration*i.repeat}getTime(t){if(t===void 0)return this.time;const i=this.channels.get(t);return i===void 0?-1:i.time}setTime(t){this.time=Math.max(0,t);const i=this.channels.values();for(const r of i)this._setChannelTime(r,this.time);const n=this.animations.values();for(const r of n){const{animation:s,channel:o}=r;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,i){const n=FK++;return this.animations.set(n,{animation:t,channel:i}),t.setTime(this.getTime(i)),n}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,i){const n=i-t.delay,r=t.duration*t.repeat;n>=r?t.time=t.duration*t.rate:(t.time=Math.max(0,n)%t.duration,t.time*=t.rate)}}function kK(e){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)}function NK(e){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e)}function XM(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}let KM=class{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=XM(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(XM()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},UK=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:i}=e;let n=this.stats[t];return n||(e instanceof KM?n=e:n=new KM(t,i),this.stats[t]=n),n}},GK=0;const zK={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:N1.stats.get(`animation-loop-${GK++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class VK{constructor(t){if(z(this,"device",null),z(this,"canvas",null),z(this,"props"),z(this,"animationProps",null),z(this,"timeline",null),z(this,"stats"),z(this,"cpuTime"),z(this,"gpuTime"),z(this,"frameRate"),z(this,"display"),z(this,"needsRedraw","initialized"),z(this,"_initialized",!1),z(this,"_running",!1),z(this,"_animationFrameId",null),z(this,"_nextFramePromise",null),z(this,"_resolveNextFrame",null),z(this,"_cpuStartTime",0),z(this,"_error",null),this.props={...zK,...t},t=this.props,!t.device)throw new Error("No device provided");const{useDevicePixels:i=!0}=this.props;this.stats=t.stats||new UK({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:t.autoResizeViewport,autoResizeDrawingBuffer:t.autoResizeDrawingBuffer,useDevicePixels:i}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(t){var i,n;if(this.props.onError(t),this._error=Error(),((n=(i=this.device)==null?void 0:i.canvasContext)==null?void 0:n.canvas)instanceof HTMLCanvasElement){const r=document.createElement("h1");r.innerHTML=t.message,r.style.position="absolute",r.style.top="20%",r.style.left="10px",r.style.color="black",r.style.backgroundColor="red",document.body.appendChild(r)}}setNeedsRedraw(t){return this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.props.autoResizeViewport=t.autoResizeViewport||!1),"autoResizeDrawingBuffer"in t&&(this.props.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer||!1),"useDevicePixels"in t&&(this.props.useDevicePixels=t.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let t;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(t!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(t){const i=t instanceof Error?t:new Error("Unknown error");throw this.props.onError(i),i}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var t;return(t=this.device)!=null&&t.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(t){this.display&&(this.display.destroy(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_requestAnimationFrame(){this._running&&(this._animationFrameId=kK(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(NK(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(t){var i;if(this.display){this.display._renderFrame(t);return}this.props.onRender(this._getAnimationProps()),(i=this.device)==null||i.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var t,i;const n=(i=(t=this.device)==null?void 0:t.canvasContext)==null?void 0:i.canvas;if(!this.device||!n)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:n,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:t,height:i,aspect:n}=this._getSizeAndAspect();(t!==this.animationProps.width||i!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=i,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var t;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((t=this.device.canvasContext)==null?void 0:t.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const i=document.createElement("div");i.style.position="absolute",i.style.left="10px",i.style.bottom="10px",i.style.width="300px",i.style.background="white",this.canvas instanceof HTMLCanvasElement&&t.appendChild(this.canvas),t.appendChild(i);const n=this.props.onAddHTML(i);n&&(i.innerHTML=n)}}_getSizeAndAspect(){var t,i,n,r;if(!this.device)return{width:1,height:1,aspect:1};const[s,o]=((i=(t=this.device)==null?void 0:t.canvasContext)==null?void 0:i.getPixelSize())||[1,1];let l=1;const h=(r=(n=this.device)==null?void 0:n.canvasContext)==null?void 0:r.canvas;return h&&h.clientHeight?l=h.clientWidth/h.clientHeight:s>0&&o>0&&(l=s/o),{width:s,height:o,aspect:l}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var t,i;this.props.autoResizeDrawingBuffer&&((i=(t=this.device)==null?void 0:t.canvasContext)==null||i.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(t){t instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[t.offsetX,t.offsetY])}_onMouseleave(t){this._getAnimationProps()._mousePosition=null}}const Pb={};function $h(e="id"){Pb[e]=Pb[e]||1;const t=Pb[e]++;return`${e}-${t}`}class QM{constructor(t){if(z(this,"id"),z(this,"userData",{}),z(this,"topology"),z(this,"bufferLayout",[]),z(this,"vertexCount"),z(this,"indices"),z(this,"attributes"),this.id=t.id||$h("geometry"),this.topology=t.topology,this.indices=t.indices||null,this.attributes=t.attributes,this.vertexCount=t.vertexCount,this.bufferLayout=t.bufferLayout||[],this.indices&&!(this.indices.usage&jr.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var t;(t=this.indices)==null||t.destroy();for(const i of Object.values(this.attributes))i.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(t){return t.byteLength/12}}function jK(e,t){if(t instanceof QM)return t;const i=HK(e,t),{attributes:n,bufferLayout:r}=WK(e,t);return new QM({topology:t.topology||"triangle-list",bufferLayout:r,vertexCount:t.vertexCount,indices:i,attributes:n})}function HK(e,t){if(!t.indices)return;const i=t.indices.value;return e.createBuffer({usage:jr.INDEX,data:i})}function WK(e,t){const i=[],n={};for(const[s,o]of Object.entries(t.attributes)){let l=s;switch(s){case"POSITION":l="positions";break;case"NORMAL":l="normals";break;case"TEXCOORD_0":l="texCoords";break;case"COLOR_0":l="colors";break}if(o){n[l]=e.createBuffer({data:o.value,id:`${s}-buffer`});const{value:h,size:A,normalized:v}=o;i.push({name:l,format:$j(h,A,v)})}}const r=t._calculateVertexCount(t.attributes,t.indices);return{attributes:n,bufferLayout:i,vertexCount:r}}const ZM=class gN{constructor(t){z(this,"device"),z(this,"destroyPolicy"),z(this,"_hashCounter",0),z(this,"_hashes",{}),z(this,"_renderPipelineCache",{}),z(this,"_computePipelineCache",{}),this.device=t,this.destroyPolicy=t.props._factoryDestroyPolicy}static getDefaultPipelineFactory(t){return t._lumaData.defaultPipelineFactory=t._lumaData.defaultPipelineFactory||new gN(t),t._lumaData.defaultPipelineFactory}createRenderPipeline(t){const i={...c0.defaultProps,...t},n=this._hashRenderPipeline(i);if(!this._renderPipelineCache[n]){const r=this.device.createRenderPipeline({...i,id:i.id?`${i.id}-cached`:void 0});r.hash=n,this._renderPipelineCache[n]={pipeline:r,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(t){const i={...PS.defaultProps,...t},n=this._hashComputePipeline(i);if(!this._computePipelineCache[n]){const r=this.device.createComputePipeline({...i,id:i.id?`${i.id}-cached`:void 0});r.hash=n,this._computePipelineCache[n]={pipeline:r,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(t){const i=t.hash,n=t instanceof PS?this._computePipelineCache:this._renderPipelineCache;n[i].useCount--,n[i].useCount===0&&this.destroyPolicy==="unused"&&(n[i].pipeline.destroy(),delete n[i])}_hashComputePipeline(t){return`${this._getHash(t.shader.source)}`}_hashRenderPipeline(t){const i=t.vs?this._getHash(t.vs.source):0,n=t.fs?this._getHash(t.fs.source):0,r="-",s=this._getHash(JSON.stringify(t.bufferLayout));switch(this.device.type){case"webgl":return`${i}/${n}V${r}BL${s}`;default:const o=this._getHash(JSON.stringify(t.parameters));return`${i}/${n}V${r}T${t.topology}P${o}BL${s}`}}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}};z(ZM,"defaultProps",{...c0.defaultProps});let JK=ZM;const YM=class mN{constructor(t){z(this,"device"),z(this,"destroyPolicy"),z(this,"_cache",{}),this.device=t,this.destroyPolicy=t.props._factoryDestroyPolicy}static getDefaultShaderFactory(t){var i;return(i=t._lumaData).defaultShaderFactory||(i.defaultShaderFactory=new mN(t)),t._lumaData.defaultShaderFactory}createShader(t){const i=this._hashShader(t);let n=this._cache[i];if(!n){const r=this.device.createShader({...t,id:t.id?`${t.id}-cached`:void 0});this._cache[i]=n={shader:r,useCount:0}}return n.useCount++,n.shader}release(t){const i=this._hashShader(t),n=this._cache[i];n&&(n.useCount--,n.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[i],n.shader.destroy()))}_hashShader(t){return`${t.stage}:${t.source}`}};z(YM,"defaultProps",{...wS.defaultProps});let XK=YM;function KK(e,t){var i;const n={},r="Values";if(e.attributes.length===0&&!((i=e.varyings)!=null&&i.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const s of e.attributes)if(s){const o=`${s.location} ${s.name}: ${s.type}`;n[`in ${o}`]={[r]:s.stepMode||"vertex"}}for(const s of e.varyings||[]){const o=`${s.location} ${s.name}`;n[`out ${o}`]={[r]:JSON.stringify(s)}}return n}let Go=null,rg=null;function QK(e,{id:t,minimap:i,opaque:n,top:r="0",left:s="0",rgbaScale:o=1}){Go||(Go=document.createElement("canvas"),Go.id=t,Go.title=t,Go.style.zIndex="100",Go.style.position="absolute",Go.style.top=r,Go.style.left=s,Go.style.border="blue 5px solid",Go.style.transform="scaleY(-1)",document.body.appendChild(Go),rg=Go.getContext("2d")),(Go.width!==e.width||Go.height!==e.height)&&(Go.width=e.width/2,Go.height=e.height/2,Go.style.width="400px",Go.style.height="400px");const l=e.device.readPixelsToArrayWebGL(e),h=rg==null?void 0:rg.createImageData(e.width,e.height);if(h){for(let A=0;A<l.length;A+=4)h.data[0+A+0]=l[A+0]*o,h.data[0+A+1]=l[A+1]*o,h.data[0+A+2]=l[A+2]*o,h.data[0+A+3]=n?255:l[A+3]*o;rg==null||rg.putImageData(h,0,0)}}function Rb(e,t,i){if(e===t)return!0;if(!i||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Rb(e[n],t[n],i-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const s of n)if(!t.hasOwnProperty(s)||!Rb(e[s],t[s],i-1))return!1;return!0}return!1}function ZK(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function YK(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function qM(e){return ZK(e)||YK(e)}function qK(e){return qM(e)||typeof e=="number"||typeof e=="boolean"}function $M(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach(i=>{const n=e[i];qK(n)?t.uniforms[i]=n:t.bindings[i]=n}),t}class $K{constructor(t,i){z(this,"options",{disableWarnings:!1}),z(this,"modules"),z(this,"moduleUniforms"),z(this,"moduleBindings"),Object.assign(this.options,i);const n=T1(Object.values(t).filter(r=>r.dependencies));for(const r of n)t[r.name]=r;ti.log(1,"Creating ShaderInputs with modules",Object.keys(t))(),this.modules=t,this.moduleUniforms={},this.moduleBindings={};for(const[r,s]of Object.entries(t))this._addModule(s),s.name&&r!==s.name&&!this.options.disableWarnings&&ti.warn(`Module name: ${r} vs ${s.name}`)()}destroy(){}setProps(t){var i;for(const n of Object.keys(t)){const r=n,s=t[r]||{},o=this.modules[r];if(!o){this.options.disableWarnings||ti.warn(`Module ${n} not found`)();continue}const l=this.moduleUniforms[r],h=this.moduleBindings[r],A=((i=o.getUniforms)==null?void 0:i.call(o,s,l))||s,{uniforms:v,bindings:C}=$M(A);this.moduleUniforms[r]={...l,...v},this.moduleBindings[r]={...h,...C}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const t={};for(const i of Object.values(this.moduleBindings))Object.assign(t,i);return t}getDebugTable(){var t;const i={};for(const[n,r]of Object.entries(this.moduleUniforms))for(const[s,o]of Object.entries(r))i[`${n}.${s}`]={type:(t=this.modules[n].uniformTypes)==null?void 0:t[s],value:String(o)};return i}_addModule(t){const i=t.name;this.moduleUniforms[i]=t.defaultUniforms||{},this.moduleBindings[i]={}}}let tQ="";async function eQ(e,t){const i=new Image;return i.crossOrigin="anonymous",i.src=e.startsWith("http")?e:tQ+e,await i.decode(),t?await createImageBitmap(i,t):await createImageBitmap(i)}class Db{constructor(t,i){z(this,"device"),z(this,"id"),z(this,"texture"),z(this,"sampler"),z(this,"view"),z(this,"ready"),z(this,"isReady",!1),z(this,"destroyed",!1),z(this,"resolveReady",()=>{}),z(this,"rejectReady",()=>{}),this.device=t,this.id=i.id||$h("async-texture"),typeof(i==null?void 0:i.data)=="string"&&i.dimension==="2d"&&(i={...i,data:eQ(i.data)}),this.ready=new Promise((n,r)=>{this.resolveReady=()=>{this.isReady=!0,n()},this.rejectReady=r}),this.initAsync(i)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(t){let i,n;const r=t.data,s=await tP(r).then(i,n);if(this.destroyed)return;const o={...t,data:s};this.texture=this.device.createTexture(o),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(t){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(t.width===this.texture.width&&t.height===this.texture.height)return!1;if(this.texture){const i=this.texture;this.texture=i.clone(t),i.destroy()}return!0}}async function tP(e){if(e=await e,Array.isArray(e))return await Promise.all(e.map(tP));if(e&&typeof e=="object"&&e.constructor===Object){const t=e,i=await Promise.all(Object.values(t)),n=Object.keys(t),r={};for(let s=0;s<n.length;s++)r[n[s]]=i[s];return r}return e}const tf=2,iQ=1e4,eP=class yN{constructor(t,i){z(this,"device"),z(this,"id"),z(this,"source"),z(this,"vs"),z(this,"fs"),z(this,"pipelineFactory"),z(this,"shaderFactory"),z(this,"userData",{}),z(this,"parameters"),z(this,"topology"),z(this,"bufferLayout"),z(this,"isInstanced"),z(this,"instanceCount",0),z(this,"vertexCount"),z(this,"indexBuffer",null),z(this,"bufferAttributes",{}),z(this,"constantAttributes",{}),z(this,"bindings",{}),z(this,"uniforms",{}),z(this,"vertexArray"),z(this,"transformFeedback",null),z(this,"pipeline"),z(this,"shaderInputs"),z(this,"_uniformStore"),z(this,"_attributeInfos",{}),z(this,"_gpuGeometry",null),z(this,"_getModuleUniforms"),z(this,"props"),z(this,"_pipelineNeedsUpdate","newly created"),z(this,"_needsRedraw","initializing"),z(this,"_destroyed",!1),z(this,"_lastDrawTimestamp",-1),z(this,"_lastLogTime",0),z(this,"_logOpen",!1),z(this,"_drawCount",0);var n,r,s,o;this.props={...yN.defaultProps,...i},i=this.props,this.id=i.id||$h("model"),this.device=t,Object.assign(this.userData,i.userData);const l=Object.fromEntries(((n=this.props.modules)==null?void 0:n.map(C=>[C.name,C]))||[]),h=i.shaderInputs||new $K(l,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(h);const A=rQ(t),v=(((r=this.props.modules)==null?void 0:r.length)>0?this.props.modules:(s=this.shaderInputs)==null?void 0:s.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:C,getUniforms:S}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:A,...this.props,modules:v});this.source=C,this._getModuleUniforms=S,(o=this.props).shaderLayout||(o.shaderLayout=SH(this.source))}else{const{vs:C,fs:S,getUniforms:L}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:A,...this.props,modules:v});this.vs=C,this.fs=S,this._getModuleUniforms=L}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,i.geometry&&this.setGeometry(i.geometry),this.pipelineFactory=i.pipelineFactory||JK.getDefaultPipelineFactory(this.device),this.shaderFactory=i.shaderFactory||XK.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=t.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in i&&(this.isInstanced=i.isInstanced),i.instanceCount&&this.setInstanceCount(i.instanceCount),i.vertexCount&&this.setVertexCount(i.vertexCount),i.indexBuffer&&this.setIndexBuffer(i.indexBuffer),i.attributes&&this.setAttributes(i.attributes),i.constantAttributes&&this.setConstantAttributes(i.constantAttributes),i.bindings&&this.setBindings(i.bindings),i.uniforms&&this.setUniformsWebGL(i.uniforms),i.moduleSettings&&this.updateModuleSettingsWebGL(i.moduleSettings),i.transformFeedback&&(this.transformFeedback=i.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var t;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(t=this._gpuGeometry)==null||t.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const t=this._needsRedraw;return this._needsRedraw=!1,t}setNeedsRedraw(t){this._needsRedraw||(this._needsRedraw=t)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(t){const i=this._areBindingsLoading();if(i)return ti.info(tf,`>>> DRAWING ABORTED ${this.id}: ${i} not loaded`)(),!1;try{t.pushDebugGroup(`${this}.predraw(${t})`),this.predraw()}finally{t.popDebugGroup()}let n;try{t.pushDebugGroup(`${this}.draw(${t})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const r=this._getBindings();this.pipeline.setBindings(r,{disableWarnings:this.props.disableWarnings}),Ob(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:s}=this.vertexArray,o=s?s.byteLength/(s.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:t,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:o,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{t.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(t),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(t){var i;(i=this._gpuGeometry)==null||i.destroy();const n=t&&jK(this.device,t);if(n){this.setTopology(n.topology||"triangle-list");const r=new U1(this.bufferLayout);this.bufferLayout=r.mergeBufferLayouts(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)}this._gpuGeometry=n}setTopology(t){t!==this.topology&&(this.topology=t,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(t){const i=new U1(this.bufferLayout);this.bufferLayout=this._gpuGeometry?i.mergeBufferLayouts(t,this._gpuGeometry.bufferLayout):t,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(t){Rb(t,this.parameters,2)||(this.parameters=t,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(t){this.instanceCount=t,this.isInstanced===void 0&&t>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(t){this.vertexCount=t,this.setNeedsRedraw("vertexCount")}setShaderInputs(t){this.shaderInputs=t,this._uniformStore=new qj(this.shaderInputs.modules);for(const[i,n]of Object.entries(this.shaderInputs.modules))if(nQ(n)){const r=this._uniformStore.getManagedUniformBuffer(this.device,i);this.bindings[`${i}Uniforms`]=r}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(t){Object.assign(this.bindings,t),this.setNeedsRedraw("bindings")}setTransformFeedback(t){this.transformFeedback=t,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(t){this.vertexArray.setIndexBuffer(t),this.setNeedsRedraw("indexBuffer")}setAttributes(t,i){const n=(i==null?void 0:i.disableWarnings)??this.props.disableWarnings;t.indices&&ti.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();const r=new U1(this.bufferLayout);for(const[s,o]of Object.entries(t)){const l=r.getBufferLayout(s);if(!l){n||ti.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}const h=r.getAttributeNamesForBuffer(l);let A=!1;for(const v of h){const C=this._attributeInfos[v];C&&(this.vertexArray.setBuffer(C.location,o),A=!0)}!A&&!n&&ti.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(t,i){for(const[n,r]of Object.entries(t)){const s=this._attributeInfos[n];s?this.vertexArray.setConstantWebGL(s.location,r):((i==null?void 0:i.disableWarnings)??this.props.disableWarnings)||ti.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(t){this.setUniformsWebGL(t)}setUniformsWebGL(t){Ob(t)||(this.pipeline.setUniformsWebGL(t),Object.assign(this.uniforms,t)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(t){const{bindings:i,uniforms:n}=$M(this._getModuleUniforms(t));Object.assign(this.bindings,i),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const t of Object.values(this.bindings))if(t instanceof Db&&!t.isReady)return t.id;return!1}_getBindings(){const t={};for(const[i,n]of Object.entries(this.bindings))n instanceof Db?n.isReady&&(t[i]=n.texture):t[i]=n;return t}_getBindingsUpdateTimestamp(){let t=0;for(const i of Object.values(this.bindings))i instanceof _S?t=Math.max(t,i.texture.updateTimestamp):i instanceof jr||i instanceof uo?t=Math.max(t,i.updateTimestamp):i instanceof Db?t=i.texture?Math.max(t,i.texture.updateTimestamp):1/0:i instanceof BS||(t=Math.max(t,i.buffer.updateTimestamp));return t}_setGeometryAttributes(t){const i={...t.attributes};for(const[n]of Object.entries(i))!this.pipeline.shaderLayout.attributes.find(r=>r.name===n)&&n!=="positions"&&delete i[n];this.vertexCount=t.vertexCount,this.setIndexBuffer(t.indices||null),this.setAttributes(t.attributes,{disableWarnings:!0}),this.setAttributes(i,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(t){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=t),this.setNeedsRedraw(t)}_updatePipeline(){if(this._pipelineNeedsUpdate){let t=null,i=null;this.pipeline&&(ti.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),t=this.pipeline.vs,i=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let r=null;this.source?r=n:this.fs&&(r=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:r}),this._attributeInfos=LS(this.pipeline.shaderLayout,this.bufferLayout),t&&this.shaderFactory.release(t),i&&this.shaderFactory.release(i)}return this.pipeline}_logDrawCallStart(){const t=ti.level>3?0:iQ;ti.level<2||Date.now()-this._lastLogTime<t||(this._lastLogTime=Date.now(),this._logOpen=!0,ti.group(tf,`>>> DRAWING MODEL ${this.id}`,{collapsed:ti.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const t=KK(this.pipeline.shaderLayout,this.id);ti.table(tf,t)();const i=this.shaderInputs.getDebugTable();for(const[r,s]of Object.entries(this.uniforms))i[r]={value:s};ti.table(tf,i)();const n=this._getAttributeDebugTable();ti.table(tf,this._attributeInfos)(),ti.table(tf,n)(),ti.groupEnd(tf)(),this._logOpen=!1}}_logFramebuffer(t){const i=this.device.props.debugFramebuffers;if(this._drawCount++,!i)return;const n=t.props.framebuffer;n&&QK(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const t={};for(const[i,n]of Object.entries(this._attributeInfos)){const r=this.vertexArray.attributes[n.location];t[n.location]={name:i,type:n.shaderType,values:r?this._getBufferOrConstantValues(r,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:i}=this.vertexArray,n=i.indexType==="uint32"?new Uint32Array(i.debugData):new Uint16Array(i.debugData);t.indices={name:"indices",type:i.indexType,values:n.toString()}}return t}_getBufferOrConstantValues(t,i){const n=VS(i);return(t instanceof jr?new n(t.debugData):t).toString()}};z(eP,"defaultProps",{...c0.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:YT.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Hr=eP;function nQ(e){return!!(e.uniformTypes&&!Ob(e.uniformTypes))}function rQ(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}function Ob(e){for(const t in e)return!1;return!0}const iP=class zE{constructor(t,i=zE.defaultProps){if(z(this,"device"),z(this,"model"),z(this,"transformFeedback"),!zE.isSupported(t))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=t,this.model=new Hr(this.device,{id:i.id||"buffer-transform-model",fs:i.fs||qT(),topology:i.topology||"point-list",varyings:i.outputs||i.varyings,...i}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:i.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(t){var i;return((i=t==null?void 0:t.info)==null?void 0:i.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(t){t!=null&&t.inputBuffers&&this.model.setAttributes(t.inputBuffers),t!=null&&t.outputBuffers&&this.transformFeedback.setBuffers(t.outputBuffers);const i=this.device.beginRenderPass(t);this.model.draw(i),i.end()}getBuffer(t){return this.transformFeedback.getBuffer(t)}readAsync(t){const i=this.getBuffer(t);if(!i)throw new Error("BufferTransform#getBuffer");if(i instanceof jr)return i.readAsync();const{buffer:n,byteOffset:r=0,byteLength:s=n.byteLength}=i;return n.readAsync(r,s)}};z(iP,"defaultProps",{...Hr.defaultProps,outputs:void 0,feedbackBuffers:void 0});let k0=iP;const oQ="transform_output";class nP{constructor(t,i){z(this,"device"),z(this,"model"),z(this,"sampler"),z(this,"currentIndex",0),z(this,"samplerTextureMap",null),z(this,"bindings",[]),z(this,"resources",{}),this.device=t,this.sampler=t.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new Hr(this.device,{id:i.id||"texture-transform-model",fs:i.fs||qT({input:i.targetTextureVarying,inputChannels:i.targetTextureChannels,output:oQ}),vertexCount:i.vertexCount,...i}),this._initialize(i),Object.seal(this)}destroy(){var t;this.model.destroy();for(const i of this.bindings)(t=i.framebuffer)==null||t.destroy()}delete(){this.destroy()}run(t){const{framebuffer:i}=this.bindings[this.currentIndex],n=this.device.beginRenderPass({framebuffer:i,...t});this.model.draw(n),n.end()}getTargetTexture(){const{targetTexture:t}=this.bindings[this.currentIndex];return t}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(t){this._updateBindings(t)}_updateBindings(t){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t)}_updateBinding(t,{sourceBuffers:i,sourceTextures:n,targetTexture:r}){if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,n),Object.assign(t.sourceBuffers,i),r){t.targetTexture=r;const{width:s,height:o}=r;t.framebuffer&&t.framebuffer.destroy(),t.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:s,height:o,colorAttachments:[r]}),t.framebuffer.resize({width:s,height:o})}return t}_setSourceTextureParameters(){const t=this.currentIndex,{sourceTextures:i}=this.bindings[t];for(const n in i)i[n].sampler=this.sampler}}class es{constructor(t){z(this,"id"),z(this,"topology"),z(this,"vertexCount"),z(this,"indices"),z(this,"attributes"),z(this,"userData",{});const{attributes:i={},indices:n=null,vertexCount:r=null}=t;this.id=t.id||$h("geometry"),this.topology=t.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[s,o]of Object.entries(i)){const l=ArrayBuffer.isView(o)?{value:o}:o;if(!ArrayBuffer.isView(l.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!l.size&&(l.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=l}else this.attributes[s]=l}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=r||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return`Geometry ${this.id} attribute ${t}`}_setAttributes(t,i){return this}_calculateVertexCount(t,i){if(i)return i.value.length;let n=1/0;for(const r of Object.values(t)){const{value:s,size:o,constant:l}=r;!l&&s&&o!==void 0&&o>=1&&(n=Math.min(n,s.length/o))}return n}}const sQ=`struct VertexInputs {
  @location(0) clipSpacePosition: vec2<f32>,
  @location(1) texCoord: vec2<f32>,
  @location(2) coordinate: vec2<f32>  
}

struct FragmentInputs {
  @builtin(position) Position : vec4<f32>,
  @location(0) position : vec2<f32>,
  @location(1) coordinate : vec2<f32>,
  @location(2) uv : vec2<f32>
};

@vertex
fn vertexMain(inputs: VertexInputs) -> FragmentInputs {
  var outputs: FragmentInputs;
  outputs.Position = vec4(inputs.clipSpacePosition, 0., 1.);
  outputs.position = inputs.clipSpacePosition;
  outputs.coordinate = inputs.coordinate;
  outputs.uv = inputs.texCoord;
  return outputs;
}
`,aQ=`#version 300 es
in vec2 clipSpacePositions;
in vec2 texCoords;
in vec2 coordinates;

out vec2 position;
out vec2 coordinate;
out vec2 uv;

void main(void) {
  gl_Position = vec4(clipSpacePositions, 0., 1.);
  position = clipSpacePositions;
  coordinate = coordinates;
  uv = texCoords;
}
`,rP=[-1,-1,1,-1,-1,1,1,1];class lQ extends Hr{constructor(t,i){const n=rP.map(r=>r===-1?0:r);i.source&&(i={...i,source:`${sQ}
${i.source}`}),super(t,{id:i.id||$h("clip-space"),...i,vs:aQ,vertexCount:4,geometry:new es({topology:"triangle-strip",vertexCount:4,attributes:{clipSpacePositions:{size:2,value:new Float32Array(rP)},texCoords:{size:2,value:new Float32Array(n)},coordinates:{size:2,value:new Float32Array(n)}}})})}}class N0{constructor(t={}){z(this,"id"),z(this,"matrix",new mn),z(this,"display",!0),z(this,"position",new de),z(this,"rotation",new de),z(this,"scale",new de(1,1,1)),z(this,"userData",{}),z(this,"props",{});const{id:i}=t;this.id=i||$h(this.constructor.name),this._setScenegraphNodeProps(t)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(t){return this._setScenegraphNodeProps(t),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(t){return this.position=t,this}setRotation(t){return this.rotation=t,this}setScale(t){return this.scale=t,this}setMatrix(t,i=!0){i?this.matrix.copy(t):this.matrix=t}setMatrixComponents(t){const{position:i,rotation:n,scale:r,update:s=!0}=t;return i&&this.setPosition(i),n&&this.setRotation(n),r&&this.setScale(r),s&&this.updateMatrix(),this}updateMatrix(){const t=this.position,i=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(i),this.matrix.scale(n),this}update(t={}){const{position:i,rotation:n,scale:r}=t;return i&&this.setPosition(i),n&&this.setRotation(n),r&&this.setScale(r),this.updateMatrix(),this}getCoordinateUniforms(t,i){i=i||this.matrix;const n=new mn(t).multiplyRight(i),r=n.invert(),s=r.transpose();return{viewMatrix:t,modelMatrix:i,objectMatrix:i,worldMatrix:n,worldInverseMatrix:r,worldInverseTransposeMatrix:s}}_setScenegraphNodeProps(t){"position"in t&&this.setPosition(t.position),"rotation"in t&&this.setRotation(t.rotation),"scale"in t&&this.setScale(t.scale),"matrix"in t&&this.setMatrix(t.matrix),Object.assign(this.props,t)}}class oA extends N0{constructor(t={}){t=Array.isArray(t)?{children:t}:t;const{children:i=[]}=t;ti.assert(i.every(n=>n instanceof N0),"every child must an instance of ScenegraphNode"),super(t),z(this,"children"),this.children=i}getBounds(){const t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((i,{worldMatrix:n})=>{const r=i.getBounds();if(!r)return;const[s,o]=r,l=new de(s).add(o).divide([2,2,2]);n.transformAsPoint(l,l);const h=new de(o).subtract(s).divide([2,2,2]);n.transformAsVector(h,h);for(let A=0;A<8;A++){const v=new de(A&1?-1:1,A&2?-1:1,A&4?-1:1).multiply(h).add(l);for(let C=0;C<3;C++)t[0][C]=Math.min(t[0][C],v[C]),t[1][C]=Math.max(t[1][C],v[C])}}),Number.isFinite(t[0][0])?t:null}destroy(){this.children.forEach(t=>t.destroy()),this.removeAll(),super.destroy()}add(...t){for(const i of t)Array.isArray(i)?this.add(...i):this.children.push(i);return this}remove(t){const i=this.children,n=i.indexOf(t);return n>-1&&i.splice(n,1),this}removeAll(){return this.children=[],this}traverse(t,{worldMatrix:i=new mn}={}){const n=new mn(i).multiplyRight(this.matrix);for(const r of this.children)r instanceof oA?r.traverse(t,{worldMatrix:n}):t(r,{worldMatrix:n})}}class Lb extends N0{constructor(t){super(t),z(this,"model"),z(this,"bounds",null),z(this,"managedResources"),this.model=t.model,this.managedResources=t.managedResources||[],this.bounds=t.bounds||null,this.setProps(t)}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(t=>t.destroy()),this.managedResources=[]}getBounds(){return this.bounds}draw(t){return this.model.draw(t)}}class oP extends es{constructor(t={}){const{id:i=$h("cube-geometry"),indices:n=!0}=t;super(n?{...t,id:i,topology:"triangle-list",indices:{size:1,value:cQ},attributes:{...gQ,...t.attributes}}:{...t,id:i,topology:"triangle-list",indices:void 0,attributes:{...mQ,...t.attributes}})}}const cQ=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),uQ=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),hQ=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),fQ=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),dQ=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),pQ=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),AQ=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),gQ={POSITION:{size:3,value:uQ},NORMAL:{size:3,value:hQ},TEXCOORD_0:{size:2,value:fQ}},mQ={POSITION:{size:3,value:dQ},TEXCOORD_0:{size:2,value:pQ},COLOR_0:{size:3,value:AQ}},yQ=`uniform screenUniforms {
  vec2 texSize;
} screen;
`,_Q={name:"screen",fs:yQ,uniformTypes:{texSize:"vec2<f32>"}};class vQ extends kM{constructor(t,i){super(t,i);const{module:n,fs:r,id:s}=i,o={depthWriteEnabled:!1,depthCompare:"always"};this.model=new lQ(t,{id:s,fs:r,modules:[n,_Q],parameters:o})}render(t){this._renderPass(this.device,t)}delete(){this.model.destroy(),this.model=null}_renderPass(t,i){const{clearCanvas:n,inputBuffer:r,outputBuffer:s}=i,o=[r.width,r.height],l={texSrc:r.colorAttachments[0],texSize:o};this.model.shaderInputs.setProps({screen:l,...i.moduleProps});const h=this.device.beginRenderPass({framebuffer:s,parameters:{viewport:[0,0,...o]},clearColor:n?[0,0,0,0]:!1,clearDepth:1});this.model.draw(h),h.end()}}class bQ{constructor(t,i){this.id=`${t.name}-pass`,this.props=i,UT(t),this.module=t}setup({device:t}){this.passes=xQ(t,this.module,this.id)}setProps(t){this.props=t}preRender(){}postRender(t){const i=this.passes,{target:n}=t;let r=t.inputBuffer,s=t.swapBuffer;for(let o=0;o<i.length;o++){const l=o===i.length-1,h=n!==void 0&&l;h&&(s=n);const A=!h||!!t.clearCanvas,v={},C=this.module.passes[o].uniforms;v[this.module.name]={...this.props,...C},i[o].render({clearCanvas:A,inputBuffer:r,outputBuffer:s,moduleProps:v});const S=s;s=r,r=S}return r}cleanup(){if(this.passes){for(const t of this.passes)t.delete();this.passes=void 0}}}function xQ(e,t,i){return t.passes.map((n,r)=>{const s=EQ(t,n),o=`${i}-${r}`;return new vQ(e,{id:o,module:t,fs:s})})}const sP=`#version 300 es
uniform sampler2D texSrc;

in vec2 position;
in vec2 coordinate;
in vec2 uv;

out vec4 fragColor;
`,wQ=e=>`${sP}
void main() {
  fragColor = texture(texSrc, coordinate);
  fragColor = ${e}(fragColor, screen.texSize, coordinate);
}
`,CQ=e=>`${sP}
void main() {
  fragColor = ${e}(texSrc, screen.texSize, coordinate);
}
`;function EQ(e,t){if(t.filter){const i=typeof t.filter=="string"?t.filter:`${e.name}_filterColor_ext`;return wQ(i)}if(t.sampler){const i=typeof t.sampler=="string"?t.sampler:`${e.name}_sampleColor`;return CQ(i)}return""}const BQ={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class aP extends F0{constructor(){super(...arguments),this._colorEncoderState=null}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer({layers:t,layerFilter:i,views:n,viewports:r,onViewportActive:s,pickingFBO:o,deviceRect:{x:l,y:h,width:A,height:v},cullRect:C,effects:S,pass:L="picking",pickZ:N,shaderModuleProps:G}){this.pickZ=N;const W=this._resetColorEncoder(N),j=[l,h,A,v],q=super.render({target:o,layers:t,layerFilter:i,views:n,viewports:r,onViewportActive:s,cullRect:C,effects:S==null?void 0:S.filter(Z=>Z.useInPicking),pass:L,isPicking:!0,shaderModuleProps:G,clearColor:[0,0,0,0],colorMask:15,scissorRect:j});return this._colorEncoderState=null,{decodePickingColor:W&&SQ.bind(null,W),stats:q}}shouldDrawLayer(t){const{pickable:i,operation:n}=t.props;return i&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(t,i,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(t,i,n){const r={...t.props.parameters},{pickable:s,operation:o}=t.props;return!this._colorEncoderState||o.includes("terrain")?r.blend=!1:s&&o.includes("draw")&&(Object.assign(r,BQ),r.blend=!0,r.blendColor=TQ(this._colorEncoderState,t,n)),r}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function TQ(e,t,i){const{byLayer:n,byAlpha:r}=e;let s,o=n.get(t);return o?(o.viewports.push(i),s=o.a):(s=n.size+1,s<=255?(o={a:s,layer:t,viewports:[i]},n.set(t,o),r[s]=o):(Yi.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function SQ(e,t){const i=e.byAlpha[t[3]];return i&&{pickedLayer:i.layer,pickedViewports:i.viewports,pickedObjectIndex:i.layer.decodePickingColor(t)}}const jd={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},U0=Symbol.for("component"),Zu=Symbol.for("propTypes"),Fb=Symbol.for("deprecatedProps"),Hd=Symbol.for("asyncPropDefaults"),ef=Symbol.for("asyncPropOriginal"),Yu=Symbol.for("asyncPropResolved");function G0(e,t=()=>!0){return Array.isArray(e)?lP(e,t,[]):t(e)?[e]:[]}function lP(e,t,i){let n=-1;for(;++n<e.length;){const r=e[n];Array.isArray(r)?lP(r,t,i):t(r)&&i.push(r)}return i}function IQ({target:e,source:t,start:i=0,count:n=1}){const r=t.length,s=n*r;let o=0;for(let l=i;o<r;o++)e[l++]=t[o];for(;o<s;)o<s-o?(e.copyWithin(i+o,i,i+o),o*=2):(e.copyWithin(i+o,i,i+s-o),o=s);return e}function cP(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}let uP=class{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=cP(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(cP()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},hP=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:i}=e;let n=this.stats[t];return n||(e instanceof uP?n=e:n=new uP(t,i),this.stats[t]=n),n}};class MQ{constructor(t,i,n){this._loadCount=0,this._subscribers=new Set,this.id=t,this.context=n,this.setData(i)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,i){if(t===this._data&&!i)return;this._data=t;const n=++this._loadCount;let r=t;typeof t=="string"&&(r=m1(t)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(s=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===n&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const s of this._subscribers)s.onChange(this.getData())}}class PQ{constructor(t){var i;this.protocol=t.protocol||"resource://",this._context={device:t.device,gl:(i=t.device)==null?void 0:i.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add({resourceId:t,data:i,forceUpdate:n=!1,persistent:r=!0}){let s=this._resources[t];s?s.setData(i,n):(s=new MQ(t,i,this._context),this._resources[t]=s),s.persistent=r}remove(t){const i=this._resources[t];i&&(i.delete(),delete this._resources[t])}unsubscribe({consumerId:t}){const i=this._consumers[t];if(i){for(const n in i){const r=i[n],s=this._resources[r.resourceId];s&&s.unsubscribe(r)}delete this._consumers[t],this.prune()}}subscribe({resourceId:t,onChange:i,consumerId:n,requestId:r="default"}){const{_resources:s,protocol:o}=this;t.startsWith(o)&&(t=t.replace(o,""),s[t]||this.add({resourceId:t,data:null,persistent:!1}));const l=s[t];if(this._track(n,r,l,i),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,i,n,r){const s=this._consumers,o=s[t]=s[t]||{};let l=o[i];const h=l&&l.resourceId&&this._resources[l.resourceId];h&&(h.unsubscribe(l),this.prune()),n&&(l?(l.onChange=r,l.resourceId=n.id):l={onChange:r,resourceId:n.id},o[i]=l,n.subscribe(l))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const i=this._resources[t];!i.persistent&&!i.inUse()&&(i.delete(),delete this._resources[t])}}}const RQ="layerManager.setLayers",DQ="layerManager.activateViewport";class OQ{constructor(t,i){var n;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=h=>{As(DQ,this,h),h&&(this.context.viewport=h)};const{deck:r,stats:s,viewport:o,timeline:l}=i||{};this.layers=[],this.resourceManager=new PQ({device:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:t,gl:t==null?void 0:t.gl,deck:r,shaderAssembler:hK(((n=t==null?void 0:t.info)==null?void 0:n.shadingLanguage)||"glsl"),defaultShaderModules:[bJ],renderPass:void 0,stats:s||new hP({id:"deck.gl"}),viewport:o||new hu({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:l||new JM,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(t={clearRedrawFlags:!1}){let i=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const r=n.getNeedsRedraw(t);i=i||r}return i}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers({layerIds:t}={}){return t?this.layers.filter(i=>t.find(n=>i.id.indexOf(n)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,i){As(RQ,this,i,t),this._lastRenderedLayers=t;const n=G0(t,Boolean);for(const r of n)r.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw(`updating layers: ${t}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}addDefaultShaderModule(t){const{defaultShaderModules:i}=this.context;i.find(n=>n.name===t.name)||(i.push(t),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(t){const{defaultShaderModules:i}=this.context,n=i.findIndex(r=>r.name===t.name);n>=0&&(i.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(t,i,n){n.raiseError(i,`${t} of ${n}`)}_updateLayers(t,i){const n={};for(const o of t)n[o.id]?Yi.warn(`Multiple old layers with same id ${o.id}`)():n[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of t)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const r=[];this._updateSublayersRecursively(i,n,r),this._finalizeOldLayers(n);let s=!1;for(const o of r)if(o.hasUniformTransition()){s=`Uniform transition in ${o}`;break}this._needsUpdate=s,this.layers=r}_updateSublayersRecursively(t,i,n){for(const r of t){r.context=this.context;const s=i[r.id];s===null&&Yi.warn(`Multiple new layers with same id ${r.id}`)(),i[r.id]=null;let o=null;try{this._debug&&s!==r&&r.validateProps(),s?(this._transferLayerState(s,r),this._updateLayer(r)):this._initializeLayer(r),n.push(r),o=r.isComposite?r.getSubLayers():null}catch(l){this._handleError("matching",l,r)}o&&this._updateSublayersRecursively(o,i,n)}}_finalizeOldLayers(t){for(const i in t){const n=t[i];n&&this._finalizeLayer(n)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=jd.INITIALIZED}catch(i){this._handleError("initialization",i,t)}}_transferLayerState(t,i){i._transferState(t),i.lifecycle=jd.MATCHED,i!==t&&(t.lifecycle=jd.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(i){this._handleError("update",i,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||`finalized ${t}`,t.lifecycle=jd.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=jd.FINALIZED}catch(i){this._handleError("finalization",i,t)}}}function $r(e,t,i){if(e===t)return!0;if(!i||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!$r(e[n],t[n],i-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const s of n)if(!t.hasOwnProperty(s)||!$r(e[s],t[s],i-1))return!1;return!0}return!1}class LQ{constructor(t){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const i=this.controllers[t];i&&i.finalize()}this.controllers={}}needsRedraw(t={clearRedrawFlags:!1}){const i=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),i}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const i=this.controllers[t];i&&i.updateTransition()}}getViewports(t){return t?this._viewports.filter(i=>i.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(i=>{t[i.id]=i}),t}getView(t){return this.views.find(i=>i.id===t)}getViewState(t){const i=typeof t=="string"?this.getView(t):t,n=i&&this.viewState[i.getViewStateId()]||this.viewState;return i?i.filterViewState(n):n}getViewport(t){return this._viewportMap[t]}unproject(t,i){const n=this.getViewports(),r={x:t[0],y:t[1]};for(let s=n.length-1;s>=0;--s){const o=n[s];if(o.containsPixel(r)){const l=t.slice();return l[0]-=o.x,l[1]-=o.y,o.unproject(l,i)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,i){(t!==this.width||i!==this.height)&&(this.width=t,this.height=i,this.setNeedsUpdate("Size changed"))}_setViews(t){t=G0(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!$r(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):Yi.warn("missing `viewState` or `initialViewState`")()}_createController(t,i){const n=i.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:r=>{var s;return(s=this.getView(t.id))==null?void 0:s.makeViewport({viewState:r,width:this.width,height:this.height})}})}_updateController(t,i,n,r){const s=t.controller;if(s&&n){const o={...i,...s,id:t.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!r||r.constructor!==s.type)&&(r=this._createController(t,o)),r&&r.setProps(o),r}return null}_rebuildViewports(){const{views:t}=this,i=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let r=t.length;r--;){const s=t[r],o=this.getViewState(s),l=s.makeViewport({viewState:o,width:this.width,height:this.height});let h=i[s.id];const A=!!s.controller;A&&!h&&(n=!0),(n||!A)&&h&&(h.finalize(),h=null),this.controllers[s.id]=this._updateController(s,o,l,h),l&&this._viewports.unshift(l)}for(const r in i){const s=i[r];s&&!this.controllers[r]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,i){return t.length!==i.length?!0:t.some((n,r)=>!t[r].equals(i[r]))}}const FQ=/([0-9]+\.?[0-9]*)(%|px)/;function qu(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":const t=FQ.exec(e);if(t&&t.length>=3){const i=t[2]==="%",n=parseFloat(t[1]);return{position:i?n/100:n,relative:i}}default:throw new Error(`Could not parse position string ${e}`)}}function $u(e,t){return e.relative?Math.round(e.position*t):e.position}class Wd{constructor(t){const{id:i,x:n=0,y:r=0,width:s="100%",height:o="100%",padding:l=null}=t;this.id=i||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=qu(n),this._y=qu(r),this._width=qu(s),this._height=qu(o),this._padding=l&&{left:qu(l.left||0),right:qu(l.right||0),top:qu(l.top||0),bottom:qu(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.constructor===t.constructor&&$r(this.props,t.props,2)}makeViewport({width:t,height:i,viewState:n}){n=this.filterViewState(n);const r=this.getDimensions({width:t,height:i});if(!r.height||!r.width)return null;const s=this.getViewportType(n);return new s({...n,...this.props,...r})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:(t==null?void 0:t.id)||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const i={...t};for(const n in this.props.viewState)n!=="id"&&(i[n]=this.props.viewState[n]);return i}return t}getDimensions({width:t,height:i}){const n={x:$u(this._x,t),y:$u(this._y,i),width:$u(this._width,t),height:$u(this._height,i)};return this._padding&&(n.padding={left:$u(this._padding.left,t),top:$u(this._padding.top,i),right:$u(this._padding.right,t),bottom:$u(this._padding.bottom,i)}),n}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}}class z0{constructor(t){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=t}get inProgress(){return this._inProgress}start(t){var i,n;this.cancel(),this.settings=t,this._inProgress=!0,(n=(i=this.settings).onStart)==null||n.call(i,this)}end(){var t,i;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(i=(t=this.settings).onEnd)==null||i.call(t,this))}cancel(){var t,i;this._inProgress&&((i=(t=this.settings).onInterrupt)==null||i.call(t,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var t,i;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:n,settings:r}=this;this._handle=n.addChannel({delay:n.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(i=(t=this.settings).onUpdate)==null||i.call(t,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const fP=()=>{},kb={BREAK:1,SNAP_TO_END:2,IGNORE:3},kQ=e=>e,NQ=kb.BREAK;let UQ=class{constructor(e){this._onTransitionUpdate=t=>{const{time:i,settings:{interpolator:n,startProps:r,endProps:s,duration:o,easing:l}}=t,h=l(i/o),A=n.interpolateProps(r,s,h);this.propsInTransition=this.getControllerState({...this.props,...A}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new z0(e.timeline),this.onViewStateChange=e.onViewStateChange||fP,this.onStateChange=e.onStateChange||fP}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let n=i;if(this.transition.inProgress){const{interruption:r,endProps:s}=this.transition.settings;n={...i,...r===kb.SNAP_TO_END?s:this.propsInTransition||i}}this._triggerTransition(n,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:i}=e;return(t>0||t==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===kb.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const i=this.getControllerState(e),n=this.getControllerState(t).shortestPathFrom(i),r=t.transitionInterpolator,s=r.getDuration?r.getDuration(e,t):t.transitionDuration;if(s===0)return;const o=r.initializeProps(e,n);this.propsInTransition={};const l={duration:s,easing:t.transitionEasing||kQ,interpolator:r,interruption:t.transitionInterruption||NQ,startProps:o.start,endProps:o.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}};function is(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}let GQ=class{constructor(e){const{compare:t,extract:i,required:n}=e;this._propsToCompare=t,this._propsToExtract=i||t,this._requiredProps=n}arePropsEqual(e,t){for(const i of this._propsToCompare)if(!(i in e)||!(i in t)||!fa(e[i],t[i]))return!1;return!0}initializeProps(e,t){const i={},n={};for(const r of this._propsToExtract)(r in e||r in t)&&(i[r]=e[r],n[r]=t[r]);return this._checkRequiredProps(i),this._checkRequiredProps(n),{start:i,end:n}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const i=e[t];is(Number.isFinite(i)||Array.isArray(i),`${t} is required for transition`)})}};const zQ=["longitude","latitude","zoom","bearing","pitch"],VQ=["longitude","latitude","zoom"];let dP=class extends GQ{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:zQ,required:VQ},super(i.transitionProps),this.opts=i}initializeProps(e,t){const i=super.initializeProps(e,t),{makeViewport:n,around:r}=this.opts;if(n&&r){const s=n(e),o=n(t),l=s.unproject(r);i.start.around=r,Object.assign(i.end,{around:o.project(l),aroundPosition:l,width:t.width,height:t.height})}return i}interpolateProps(e,t,i){const n={};for(const r of this._propsToExtract)n[r]=pl(e[r]||0,t[r]||0,i);if(t.aroundPosition&&this.opts.makeViewport){const r=this.opts.makeViewport({...t,...n});Object.assign(n,r.panByPosition(t.aroundPosition,pl(e.around,t.around,i)))}return n}};const th={transitionDuration:0},jQ=300,V0=e=>1-(1-e)*(1-e),Jd={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},nf={};class HQ{constructor(t){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new UQ({...t,getControllerState:i=>new this.ControllerState(i),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){var t;for(const i in this._events)this._events[i]&&((t=this.eventManager)==null||t.off(i,this.handleEvent));this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const i=this._eventStartBlocked;switch(t.type){case"panstart":return i?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return i?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"multipanstart":return i?!1:this._onMultiPanStart(t);case"multipanmove":return this._onMultiPan(t);case"multipanend":return this._onMultiPanEnd(t);case"dblclick":return this._onDoubleClick(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:i,y:n}=this.props,{offsetCenter:r}=t;return[r.x-i,r.y-n]}isPointInBounds(t,i){const{width:n,height:r}=this.props;if(i&&i.handled)return!1;const s=t[0]>=0&&t[0]<=n&&t[1]>=0&&t[1]<=r;return s&&i&&i.stopPropagation(),s}isFunctionKeyPressed(t){const{srcEvent:i}=t;return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const i=setTimeout(()=>{this._eventStartBlocked===i&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=i}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:i}=t;this.inertia=Number.isFinite(i)?i:i===!0?jQ:0;const{scrollZoom:n=!0,dragPan:r=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:l=!0,touchRotate:h=!1,keyboard:A=!0}=t,v=!!this.onViewStateChange;this.toggleEvents(Jd.WHEEL,v&&n),this.toggleEvents(Jd.PAN,v),this.toggleEvents(Jd.PINCH,v&&(l||h)),this.toggleEvents(Jd.MULTI_PAN,v&&h),this.toggleEvents(Jd.DOUBLE_CLICK,v&&o),this.toggleEvents(Jd.KEYBOARD,v&&A),this.scrollZoom=n,this.dragPan=r,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=l,this.touchRotate=h,this.keyboard=A}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,i){this.eventManager&&t.forEach(n=>{this._events[n]!==i&&(this._events[n]=i,i?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(t,i=null,n={}){const r={...t.getViewportProps(),...i},s=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(n),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const i=this.getCenter(t);if(!this.isPointInBounds(i,t))return!1;let n=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const r=this.controllerState[n?"panStart":"rotateStart"]({pos:i});return this._panMove=n,this.updateViewport(r,th,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const i=this.getCenter(t),n=this.controllerState.pan({pos:i});return this.updateViewport(n,th,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:i}=this;if(this.dragPan&&i&&t.velocity){const n=this.getCenter(t),r=[n[0]+t.velocityX*i/2,n[1]+t.velocityY*i/2],s=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:V0},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const i=this.getCenter(t),n=this.controllerState.rotate({pos:i});return this.updateViewport(n,th,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:i}=this;if(this.dragRotate&&i&&t.velocity){const n=this.getCenter(t),r=[n[0]+t.velocityX*i/2,n[1]+t.velocityY*i/2],s=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:V0},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;const i=this.getCenter(t);if(!this.isPointInBounds(i,t))return!1;t.srcEvent.preventDefault();const{speed:n=.01,smooth:r=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=t;let o=2/(1+Math.exp(-Math.abs(s*n)));s<0&&o!==0&&(o=1/o);const l=this.controllerState.zoom({pos:i,scale:o});return this.updateViewport(l,{...this._getTransitionProps({around:i}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(t){const i=this.getCenter(t);if(!this.isPointInBounds(i,t))return!1;const n=this.controllerState.rotateStart({pos:i});return this.updateViewport(n,th,{isDragging:!0}),!0}_onMultiPan(t){if(!this.touchRotate||!this.isDragging())return!1;const i=this.getCenter(t);i[0]-=t.deltaX;const n=this.controllerState.rotate({pos:i});return this.updateViewport(n,th,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(t){if(!this.isDragging())return!1;const{inertia:i}=this;if(this.touchRotate&&i&&t.velocityY){const n=this.getCenter(t),r=[n[0],n[1]+=t.velocityY*i/2],s=this.controllerState.rotate({pos:r});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:V0},{isDragging:!1,isRotating:!0}),this.blockEvents(i)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const i=this.getCenter(t);if(!this.isPointInBounds(i,t))return!1;const n=this.controllerState.zoomStart({pos:i}).rotateStart({pos:i});return nf._startPinchRotation=t.rotation,nf._lastPinchEvent=t,this.updateViewport(n,th,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let i=this.controllerState;if(this.touchZoom){const{scale:n}=t,r=this.getCenter(t);i=i.zoom({pos:r,scale:n})}if(this.touchRotate){const{rotation:n}=t;i=i.rotate({deltaAngleX:nf._startPinchRotation-n})}return this.updateViewport(i,th,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),nf._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:i}=this,{_lastPinchEvent:n}=nf;if(this.touchZoom&&i&&n&&t.scale!==n.scale){const r=this.getCenter(t);let s=this.controllerState.rotateEnd();const o=Math.log2(t.scale),l=(o-Math.log2(n.scale))/(t.deltaTime-n.deltaTime),h=Math.pow(2,o+l*i/2);s=s.zoom({pos:r,scale:h}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:r}),transitionDuration:i,transitionEasing:V0},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(i)}else{const r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return nf._startPinchRotation=null,nf._lastPinchEvent=null,!0}_onDoubleClick(t){if(!this.doubleClickZoom)return!1;const i=this.getCenter(t);if(!this.isPointInBounds(i,t))return!1;const n=this.isFunctionKeyPressed(t),r=this.controllerState.zoom({pos:i,scale:n?.5:2});return this.updateViewport(r,this._getTransitionProps({around:i}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const i=this.isFunctionKeyPressed(t),{zoomSpeed:n,moveSpeed:r,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let h;const A={};switch(t.srcEvent.code){case"Minus":h=i?l.zoomOut(n).zoomOut(n):l.zoomOut(n),A.isZooming=!0;break;case"Equal":h=i?l.zoomIn(n).zoomIn(n):l.zoomIn(n),A.isZooming=!0;break;case"ArrowLeft":i?(h=l.rotateLeft(s),A.isRotating=!0):(h=l.moveLeft(r),A.isPanning=!0);break;case"ArrowRight":i?(h=l.rotateRight(s),A.isRotating=!0):(h=l.moveRight(r),A.isPanning=!0);break;case"ArrowUp":i?(h=l.rotateUp(o),A.isRotating=!0):(h=l.moveUp(r),A.isPanning=!0);break;case"ArrowDown":i?(h=l.rotateDown(o),A.isRotating=!0):(h=l.moveDown(r),A.isPanning=!0);break;default:return!1}return this.updateViewport(h,this._getTransitionProps(),A),!0}_getTransitionProps(t){const{transition:i}=this;return!i||!i.transitionInterpolator?th:t?{...i,transitionInterpolator:new dP({...t,...i.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:i}}class WQ{constructor(t,i){this._viewportProps=this.applyConstraints(t),this._state=i}getViewportProps(){return this._viewportProps}getState(){return this._state}}const pP=5,JQ=1.2;let XQ=class extends WQ{constructor(e){const{width:t,height:i,latitude:n,longitude:r,zoom:s,bearing:o=0,pitch:l=0,altitude:h=1.5,position:A=[0,0,0],maxZoom:v=20,minZoom:C=0,maxPitch:S=60,minPitch:L=0,startPanLngLat:N,startZoomLngLat:G,startRotatePos:W,startBearing:j,startPitch:q,startZoom:Z,normalize:K=!0}=e;is(Number.isFinite(r)),is(Number.isFinite(n)),is(Number.isFinite(s)),super({width:t,height:i,latitude:n,longitude:r,zoom:s,bearing:o,pitch:l,altitude:h,maxZoom:v,minZoom:C,maxPitch:S,minPitch:L,normalize:K,position:A},{startPanLngLat:N,startZoomLngLat:G,startRotatePos:W,startBearing:j,startPitch:q,startZoom:Z}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const i=this.getState().startPanLngLat||this._unproject(t);if(!i)return this;const n=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(n)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){const{startRotatePos:n,startBearing:r,startPitch:s}=this.getState();if(!n||r===void 0||s===void 0)return this;let o;return e?o=this._getNewRotation(e,n,s,r):o={bearing:r+t,pitch:s+i},this._getUpdatedState(o)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:i}){let{startZoom:n,startZoomLngLat:r}=this.getState();if(r||(n=this.getViewportProps().zoom,r=this._unproject(t)||this._unproject(e)),!r)return this;const{maxZoom:s,minZoom:o}=this.getViewportProps();let l=n+Math.log2(i);l=Qc(l,o,s);const h=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...h.panByPosition(r,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),i={...this.getViewportProps()},{bearing:n,longitude:r}=i;return Math.abs(n-t.bearing)>180&&(i.bearing=n<0?n+360:n-360),Math.abs(r-t.longitude)>180&&(i.longitude=r<0?r+360:r-360),i}applyConstraints(e){const{maxZoom:t,minZoom:i,zoom:n}=e;e.zoom=Qc(n,i,t);const{maxPitch:r,minPitch:s,pitch:o}=e;e.pitch=Qc(o,s,r);const{normalize:l=!0}=e;return l&&Object.assign(e,QX(e)),e}_zoomFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.zoom({pos:[t/2,i/2],scale:e})}_panFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.pan({startPos:[t/2,i/2],pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,i,n){const r=e[0]-t[0],s=e[1]-t[1],o=e[1],l=t[1],{width:h,height:A}=this.getViewportProps(),v=r/h;let C=0;s>0?Math.abs(A-l)>pP&&(C=s/(l-A)*JQ):s<0&&l>pP&&(C=1-o/l),C=Qc(C,-1,1);const{minPitch:S,maxPitch:L}=this.getViewportProps(),N=n+180*v;let G=i;return C>0?G=i+C*(L-i):C<0&&(G=i-C*(S-i)),{pitch:G,bearing:N}}},KQ=class extends HQ{constructor(){super(...arguments),this.ControllerState=XQ,this.transition={transitionDuration:300,transitionInterpolator:new dP({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}};class AP extends Wd{constructor(t={}){super(t)}getViewportType(){return ng}get ControllerType(){return KQ}}AP.displayName="MapView";const QQ=new zM;function ZQ(e,t){const i=e.order??1/0,n=t.order??1/0;return i-n}class YQ{constructor(t){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=t,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){const i=this._defaultEffects;if(!i.find(n=>n.id===t.id)){const n=i.findIndex(r=>ZQ(r,t)>0);n<0?i.push(t):i.splice(n,0,t),t.setup(this._context),this._setEffects(this.effects)}}setProps(t){"effects"in t&&($r(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(t={clearRedrawFlags:!1}){const i=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),i}getEffects(){return this._resolvedEffects}_setEffects(t){const i={};for(const r of this.effects)i[r.id]=r;const n=[];for(const r of t){const s=i[r.id];let o=r;s&&s!==r?s.setProps?(s.setProps(r.props),o=s):s.cleanup(this._context):s||r.setup(this._context),n.push(o),delete i[r.id]}for(const r in i)i[r].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),t.some(r=>r instanceof zM)||this._resolvedEffects.push(QQ),this._needsRedraw="effects changed"}finalize(){for(const t of this._resolvedEffects)t.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class qQ extends F0{shouldDrawLayer(t){const{operation:i}=t.props;return i.includes("draw")||i.includes("terrain")}}const $Q="deckRenderer.renderLayers";class tZ{constructor(t){this.device=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new qQ(t),this.pickLayersPass=new aP(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;const i=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t};n.effects&&this._preRender(n.effects,n);const r=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const s=i.render({...n,target:r});n.effects&&this._postRender(n.effects,n),this.renderCount++,As($Q,this,s,t)}needsRedraw(t={clearRedrawFlags:!1}){const i=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),i}finalize(){const{renderBuffers:t}=this;for(const i of t)i.delete();t.length=0}_preRender(t,i){this.lastPostProcessEffect=null,i.preRenderStats=i.preRenderStats||{};for(const n of t)i.preRenderStats[n.id]=n.preRender(i),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:t}=this,i=this.device.canvasContext.getDrawingBufferSize();t.length===0&&[0,1].map(n=>{const r=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});t.push(this.device.createFramebuffer({id:`deck-renderbuffer-${n}`,colorAttachments:[r]}))});for(const n of t)n.resize(i)}_postRender(t,i){const{renderBuffers:n}=this,r={...i,inputBuffer:n[0],swapBuffer:n[1]};for(const s of t)if(s.postRender){r.target=s.id===this.lastPostProcessEffect?i.target:void 0;const o=s.postRender(r);r.inputBuffer=o,r.swapBuffer=o===n[0]?n[1]:n[0]}}}const eZ={pickedColor:null,pickedObjectIndex:-1};function iZ({pickedColors:e,decodePickingColor:t,deviceX:i,deviceY:n,deviceRadius:r,deviceRect:s}){const{x:o,y:l,width:h,height:A}=s;let v=r*r,C=-1,S=0;for(let L=0;L<A;L++){const N=L+l-n,G=N*N;if(G>v)S+=4*h;else for(let W=0;W<h;W++){if(e[S+3]-1>=0){const j=W+o-i,q=j*j+G;q<=v&&(v=q,C=S)}S+=4}}if(C>=0){const L=e.slice(C,C+4),N=t(L);if(N){const G=Math.floor(C/4/h),W=C/4-G*h;return{...N,pickedColor:L,pickedX:o+W,pickedY:l+G}}Yi.error("Picked non-existent layer. Is picking buffer corrupt?")()}return eZ}function nZ({pickedColors:e,decodePickingColor:t}){const i=new Map;if(e){for(let n=0;n<e.length;n+=4)if(e[n+3]-1>=0){const r=e.slice(n,n+4),s=r.join(",");if(!i.has(s)){const o=t(r);o?i.set(s,{...o,color:r}):Yi.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}function gP({pickInfo:e,viewports:t,pixelRatio:i,x:n,y:r,z:s}){let o=t[0];t.length>1&&(o=oZ((e==null?void 0:e.pickedViewports)||t,{x:n,y:r}));let l;if(o){const h=[n-o.x,r-o.y];s!==void 0&&(h[2]=s),l=o.unproject(h)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:n,y:r,pixel:[n,r],coordinate:l,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:i}}function rZ(e){const{pickInfo:t,lastPickedInfo:i,mode:n,layers:r}=e,{pickedColor:s,pickedLayer:o,pickedObjectIndex:l}=t,h=o?[o]:[];if(n==="hover"){const C=i.index,S=i.layerId,L=o?o.props.id:null;if(L!==S||l!==C){if(L!==S){const N=r.find(G=>G.props.id===S);N&&h.unshift(N)}i.layerId=L,i.index=l,i.info=null}}const A=gP(e),v=new Map;return v.set(null,A),h.forEach(C=>{let S={...A};C===o&&(S.color=s,S.index=l,S.picked=!0),S=mP({layer:C,info:S,mode:n});const L=S.layer;C===o&&n==="hover"&&(i.info=S),v.set(L.id,S),n==="hover"&&L.updateAutoHighlight(S)}),v}function mP({layer:e,info:t,mode:i}){for(;e&&t;){const n=t.layer||null;t.sourceLayer=n,t.layer=e,t=e.getPickingInfo({info:t,mode:i,sourceLayer:n}),e=e.parent}return t}function oZ(e,t){for(let i=e.length-1;i>=0;i--){const n=e[i];if(n.containsPixel(t))return n}return e[0]}class sZ{constructor(t){this._pickable=!0,this.device=t,this.pickLayersPass=new aP(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject({x:t,y:i,layers:n,viewports:r},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,l=s&&s.viewport&&s.viewport.id,h=o?n.find(C=>C.id===o):null,A=l&&r.find(C=>C.id===l)||r[0],v=A&&A.unproject([t-A.x,i-A.y]);return{...s,x:t,y:i,viewport:A,coordinate:v,layer:h}}_resizeBuffer(){var t,i;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const r=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=r}const{canvas:n}=this.device.getDefaultCanvasContext();(t=this.pickingFBO)==null||t.resize({width:n.width,height:n.height}),(i=this.depthFBO)==null||i.resize({width:n.width,height:n.height})}_getPickable(t){if(this._pickable===!1)return null;const i=t.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return i.length?i:null}_pickClosestObject({layers:t,views:i,viewports:n,x:r,y:s,radius:o=0,depth:l=1,mode:h="query",unproject3D:A,onViewportActive:v,effects:C}){const S=this.device.canvasContext.cssToDeviceRatio(),L=this._getPickable(t);if(!L||n.length===0)return{result:[],emptyInfo:gP({viewports:n,x:r,y:s,pixelRatio:S})};this._resizeBuffer();const N=this.device.canvasContext.cssToDevicePixels([r,s],!0),G=[N.x+Math.floor(N.width/2),N.y+Math.floor(N.height/2)],W=Math.round(o*S),{width:j,height:q}=this.pickingFBO,Z=this._getPickingRect({deviceX:G[0],deviceY:G[1],deviceRadius:W,deviceWidth:j,deviceHeight:q}),K={x:r-o,y:s-o,width:o*2+1,height:o*2+1};let ft;const rt=[],Lt=new Set;for(let Vt=0;Vt<l;Vt++){let At;if(Z){const kt=this._drawAndSample({layers:L,views:i,viewports:n,onViewportActive:v,deviceRect:Z,cullRect:K,effects:C,pass:`picking:${h}`});At=iZ({...kt,deviceX:G[0],deviceY:G[1],deviceRadius:W,deviceRect:Z})}else At={pickedColor:null,pickedObjectIndex:-1};let at;if(At.pickedLayer&&A&&this.depthFBO){const{pickedColors:kt}=this._drawAndSample({layers:[At.pickedLayer],views:i,viewports:n,onViewportActive:v,deviceRect:{x:At.pickedX,y:At.pickedY,width:1,height:1},cullRect:K,effects:C,pass:`picking:${h}:z`},!0);kt[3]&&(at=kt[0])}At.pickedLayer&&Vt+1<l&&(Lt.add(At.pickedLayer),At.pickedLayer.disablePickingIndex(At.pickedObjectIndex)),ft=rZ({pickInfo:At,lastPickedInfo:this.lastPickedInfo,mode:h,layers:L,viewports:n,x:r,y:s,z:at,pixelRatio:S});for(const kt of ft.values())kt.layer&&rt.push(kt);if(!At.pickedColor)break}for(const Vt of Lt)Vt.restorePickingColors();return{result:rt,emptyInfo:ft.get(null)}}_pickVisibleObjects({layers:t,views:i,viewports:n,x:r,y:s,width:o=1,height:l=1,mode:h="query",maxObjects:A=null,onViewportActive:v,effects:C}){const S=this._getPickable(t);if(!S||n.length===0)return[];this._resizeBuffer();const L=this.device.canvasContext.cssToDeviceRatio(),N=this.device.canvasContext.cssToDevicePixels([r,s],!0),G=N.x,W=N.y+N.height,j=this.device.canvasContext.cssToDevicePixels([r+o,s+l],!0),q=j.x+j.width,Z=j.y,K={x:G,y:Z,width:q-G,height:W-Z},ft=this._drawAndSample({layers:S,views:i,viewports:n,onViewportActive:v,deviceRect:K,cullRect:{x:r,y:s,width:o,height:l},effects:C,pass:`picking:${h}`}),rt=nZ(ft),Lt=new Map,Vt=[],At=Number.isFinite(A);for(let at=0;at<rt.length&&!(At&&Vt.length>=A);at++){const kt=rt[at];let X={color:kt.pickedColor,layer:null,index:kt.pickedObjectIndex,picked:!0,x:r,y:s,pixelRatio:L};X=mP({layer:kt.pickedLayer,info:X,mode:h});const ht=X.layer.id;Lt.has(ht)||Lt.set(ht,new Set);const Mt=Lt.get(ht),pe=X.object??X.index;Mt.has(pe)||(Mt.add(pe),Vt.push(X))}return Vt}_drawAndSample({layers:t,views:i,viewports:n,onViewportActive:r,deviceRect:s,cullRect:o,effects:l,pass:h},A=!1){const v=A?this.depthFBO:this.pickingFBO,C={layers:t,layerFilter:this.layerFilter,views:i,viewports:n,onViewportActive:r,pickingFBO:v,deviceRect:s,cullRect:o,effects:l,pass:h,pickZ:A,preRenderStats:{},isPicking:!0};for(const q of l)q.useInPicking&&(C.preRenderStats[q.id]=q.preRender(C));const{decodePickingColor:S}=this.pickLayersPass.render(C),{x:L,y:N,width:G,height:W}=s,j=new(A?Float32Array:Uint8Array)(G*W*4);return this.device.readPixelsToArrayWebGL(v,{sourceX:L,sourceY:N,sourceWidth:G,sourceHeight:W,target:j}),{pickedColors:j,decodePickingColor:S}}_getPickingRect({deviceX:t,deviceY:i,deviceRadius:n,deviceWidth:r,deviceHeight:s}){const o=Math.max(0,t-n),l=Math.max(0,i-n),h=Math.min(r,t+n+1)-o,A=Math.min(s,i+n+1)-l;return h<=0||A<=0?null:{x:o,y:l,width:h,height:A}}}const aZ={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},lZ="top-left",yP="__root";class cZ{constructor({deck:t,parentElement:i}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=t,this.parentElement=i}getWidgets(){return this.resolvedWidgets}setProps(t){t.widgets&&!$r(t.widgets,this.widgets,1)&&this._setWidgets(t.widgets)}finalize(){for(const t of this.getWidgets())this._remove(t);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const t in this.containers)this.containers[t].remove()}addDefault(t){this.defaultWidgets.find(i=>i.id===t.id)||(this._add(t),this.defaultWidgets.push(t),this._setWidgets(this.widgets))}_setWidgets(t){const i={};for(const n of this.resolvedWidgets)i[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)i[n.id]=null,this.resolvedWidgets.push(n);for(let n of t){const r=i[n.id];r?r.viewId!==n.viewId||r.placement!==n.placement?(this._remove(r),this._add(n)):n!==r&&(r.setProps(n.props),n=r):this._add(n),i[n.id]=null,this.resolvedWidgets.push(n)}for(const n in i){const r=i[n];r&&this._remove(r)}this.widgets=t}_add(t){const{viewId:i=null,placement:n=lZ}=t,r=t.onAdd({deck:this.deck,viewId:i});r&&this._getContainer(i,n).append(r),t._element=r}_remove(t){var i;(i=t.onRemove)==null||i.call(t),t._element&&t._element.remove(),t._element=void 0}_getContainer(t,i){var n;const r=t||yP;let s=this.containers[r];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",(n=this.parentElement)==null||n.append(s),this.containers[r]=s);let o=s.querySelector(`.${i}`);return o||(o=document.createElement("div"),o.className=i,o.style.position="absolute",o.style.zIndex="2",Object.assign(o.style,aZ[i]),s.append(o)),o}_updateContainers(){const t=this.deck.width,i=this.deck.height;for(const n in this.containers){const r=this.lastViewports[n]||null,s=n===yP||r,o=this.containers[n];s?(o.style.display="block",o.style.left=`${r?r.x:0}px`,o.style.top=`${r?r.y:0}px`,o.style.width=`${r?r.width:t}px`,o.style.height=`${r?r.height:i}px`):o.style.display="none"}}onRedraw({viewports:t,layers:i}){var n,r;const s=t.reduce((o,l)=>(o[l.id]=l,o),{});for(const o of this.getWidgets()){const{viewId:l}=o;if(l){const h=s[l];h&&(o.onViewportChange&&o.onViewportChange(h),(n=o.onRedraw)==null||n.call(o,{viewports:[h],layers:i}))}else{if(o.onViewportChange)for(const h of t)o.onViewportChange(h);(r=o.onRedraw)==null||r.call(o,{viewports:t,layers:i})}}this.lastViewports=s,this._updateContainers()}onHover(t,i){var n,r;for(const s of this.getWidgets()){const{viewId:o}=s;(!o||o===((n=t.viewport)==null?void 0:n.id))&&((r=s.onHover)==null||r.call(s,t,i))}}onEvent(t,i){var n,r;const s=vb[i.type];if(s)for(const o of this.getWidgets()){const{viewId:l}=o;(!l||l===((n=t.viewport)==null?void 0:n.id))&&((r=o[s])==null||r.call(o,t,i))}}}const uZ={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class hZ{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:t}){const i=document.createElement("div");return i.className="deck-tooltip",Object.assign(i.style,uZ),this.deck=t,this.element=i,i}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(t){var i;this.isVisible&&t.id===((i=this.lastViewport)==null?void 0:i.id)&&t!==this.lastViewport&&this.setTooltip(null)}onHover(t){const{deck:i}=this,n=i&&i.props.getTooltip;if(!n)return;const r=n(t);this.lastViewport=t.viewport,this.setTooltip(r,t.x,t.y)}setTooltip(t,i,n){const r=this.element;if(r){if(typeof t=="string")r.innerText=t;else if(t)t.text&&(r.innerText=t.text),t.html&&(r.innerHTML=t.html),t.className&&(r.className=t.className);else{this.isVisible=!1,r.style.display="none";return}this.isVisible=!0,r.style.display="block",r.style.transform=`translate(${i}px, ${n}px)`,t&&typeof t=="object"&&"style"in t&&Object.assign(r.style,t.style)}}}var Xd;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.R16_EXT=33322]="R16_EXT",e[e.RG16_EXT=33324]="RG16_EXT",e[e.RGB16_EXT=32852]="RGB16_EXT",e[e.RGBA16_EXT=32859]="RGBA16_EXT",e[e.R16_SNORM_EXT=36760]="R16_SNORM_EXT",e[e.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",e[e.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",e[e.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",e[e.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",e[e.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",e[e.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",e[e.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",e[e.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",e[e.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",e[e.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",e[e.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",e[e.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",e[e.LINE_WEBGL=6913]="LINE_WEBGL",e[e.FILL_WEBGL=6914]="FILL_WEBGL",e[e.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",e[e.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",e[e.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",e[e.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",e[e.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",e[e.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",e[e.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",e[e.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",e[e.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",e[e.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",e[e.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",e[e.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",e[e.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",e[e.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",e[e.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",e[e.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",e[e.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",e[e.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",e[e.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",e[e.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",e[e.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",e[e.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",e[e.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",e[e.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Xd||(Xd={}));const Nb={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},mo=(e,t,i)=>t?e.enable(i):e.disable(i),_P=(e,t,i)=>e.hint(i,t),Aa=(e,t,i)=>e.pixelStorei(i,t),vP=(e,t,i)=>{const n=i===36006?36009:36008;return e.bindFramebuffer(n,t)},og=(e,t,i)=>{const n={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[i];e.bindBuffer(n,t)};function Ub(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}const fZ={3042:mo,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:mo,2885:(e,t)=>e.cullFace(t),2929:mo,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:mo,35723:_P,35725:(e,t)=>e.useProgram(t),36007:(e,t)=>e.bindRenderbuffer(36161,t),36389:(e,t)=>{var i;return(i=e.bindTransformFeedback)==null?void 0:i.call(e,36386,t)},34229:(e,t)=>e.bindVertexArray(t),36006:vP,36010:vP,34964:og,36662:og,36663:og,35053:og,35055:og,2886:(e,t)=>e.frontFace(t),33170:_P,2849:(e,t)=>e.lineWidth(t),32823:mo,32824:"polygonOffset",10752:"polygonOffset",35977:mo,32926:mo,32928:mo,32938:"sampleCoverage",32939:"sampleCoverage",3089:mo,3088:(e,t)=>e.scissor(...t),2960:mo,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),34383:mo,10754:mo,12288:mo,12289:mo,12290:mo,12291:mo,12292:mo,12293:mo,12294:mo,12295:mo,3333:Aa,3317:Aa,37440:Aa,37441:Aa,37443:Aa,3330:Aa,3332:Aa,3331:Aa,3314:Aa,32878:Aa,3316:Aa,3315:Aa,32877:Aa,framebuffer:(e,t)=>{const i=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,i)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{const i=typeof t=="number"?[t,t]:t;e.blendEquationSeparate(...i)},blendFunc:(e,t)=>{const i=(t==null?void 0:t.length)===2?[...t,...t]:t;e.blendFuncSeparate(...i)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(t[0],t[1]||!1),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=Ub(t)?t:[t,t];const[i,n]=t;e.stencilMaskSeparate(1028,i),e.stencilMaskSeparate(1029,n)},stencilFunc:(e,t)=>{t=Ub(t)&&t.length===3?[...t,...t]:t;const[i,n,r,s,o,l]=t;e.stencilFuncSeparate(1028,i,n,r),e.stencilFuncSeparate(1029,s,o,l)},stencilOp:(e,t)=>{t=Ub(t)&&t.length===3?[...t,...t]:t;const[i,n,r,s,o,l]=t;e.stencilOpSeparate(1028,i,n,r),e.stencilOpSeparate(1029,s,o,l)},viewport:(e,t)=>e.viewport(...t)};function to(e,t,i){return t[e]!==void 0?t[e]:i[e]}const dZ={blendEquation:(e,t,i)=>e.blendEquationSeparate(to(32777,t,i),to(34877,t,i)),blendFunc:(e,t,i)=>e.blendFuncSeparate(to(32969,t,i),to(32968,t,i),to(32971,t,i),to(32970,t,i)),polygonOffset:(e,t,i)=>e.polygonOffset(to(32824,t,i),to(10752,t,i)),sampleCoverage:(e,t,i)=>e.sampleCoverage(to(32938,t,i),to(32939,t,i)),stencilFuncFront:(e,t,i)=>e.stencilFuncSeparate(1028,to(2962,t,i),to(2967,t,i),to(2963,t,i)),stencilFuncBack:(e,t,i)=>e.stencilFuncSeparate(1029,to(34816,t,i),to(36003,t,i),to(36004,t,i)),stencilOpFront:(e,t,i)=>e.stencilOpSeparate(1028,to(2964,t,i),to(2965,t,i),to(2966,t,i)),stencilOpBack:(e,t,i)=>e.stencilOpSeparate(1029,to(34817,t,i),to(34818,t,i),to(34819,t,i))},bP={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,i)=>e({[t]:i}),hint:(e,t,i)=>e({[t]:i}),useProgram:(e,t)=>e({35725:t}),bindRenderbuffer:(e,t,i)=>e({36007:i}),bindTransformFeedback:(e,t,i)=>e({36389:i}),bindVertexArray:(e,t)=>e({34229:t}),bindFramebuffer:(e,t,i)=>{switch(t){case 36160:return e({36006:i,36010:i});case 36009:return e({36006:i});case 36008:return e({36010:i});default:return null}},bindBuffer:(e,t,i)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return n?e({[n]:i}):{valueChanged:!0}},blendColor:(e,t,i,n,r)=>e({32773:new Float32Array([t,i,n,r])}),blendEquation:(e,t)=>e({32777:t,34877:t}),blendEquationSeparate:(e,t,i)=>e({32777:t,34877:i}),blendFunc:(e,t,i)=>e({32969:t,32968:i,32971:t,32970:i}),blendFuncSeparate:(e,t,i,n,r)=>e({32969:t,32968:i,32971:n,32970:r}),clearColor:(e,t,i,n,r)=>e({3106:new Float32Array([t,i,n,r])}),clearDepth:(e,t)=>e({2931:t}),clearStencil:(e,t)=>e({2961:t}),colorMask:(e,t,i,n,r)=>e({3107:[t,i,n,r]}),cullFace:(e,t)=>e({2885:t}),depthFunc:(e,t)=>e({2932:t}),depthRange:(e,t,i)=>e({2928:new Float32Array([t,i])}),depthMask:(e,t)=>e({2930:t}),frontFace:(e,t)=>e({2886:t}),lineWidth:(e,t)=>e({2849:t}),polygonOffset:(e,t,i)=>e({32824:t,10752:i}),sampleCoverage:(e,t,i)=>e({32938:t,32939:i}),scissor:(e,t,i,n,r)=>e({3088:new Int32Array([t,i,n,r])}),stencilMask:(e,t)=>e({2968:t,36005:t}),stencilMaskSeparate:(e,t,i)=>e({[t===1028?2968:36005]:i}),stencilFunc:(e,t,i,n)=>e({2962:t,2967:i,2963:n,34816:t,36003:i,36004:n}),stencilFuncSeparate:(e,t,i,n,r)=>e({[t===1028?2962:34816]:i,[t===1028?2967:36003]:n,[t===1028?2963:36004]:r}),stencilOp:(e,t,i,n)=>e({2964:t,2965:i,2966:n,34817:t,34818:i,34819:n}),stencilOpSeparate:(e,t,i,n,r)=>e({[t===1028?2964:34817]:i,[t===1028?2965:34818]:n,[t===1028?2966:34819]:r}),viewport:(e,t,i,n,r)=>e({2978:[t,i,n,r]})},ac=(e,t)=>e.isEnabled(t),xP={3042:ac,2884:ac,2929:ac,3024:ac,32823:ac,32926:ac,32928:ac,3089:ac,2960:ac,35977:ac},pZ=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Kd(e,t){if(gZ(t))return;const i={};for(const r in t){const s=Number(r),o=fZ[r];o&&(typeof o=="string"?i[o]=!0:o(e,t[r],s))}const n=e.state&&e.state.cache;if(n)for(const r in i){const s=dZ[r];s(e,t,n)}}function wP(e,t=Nb){if(typeof t=="number"){const r=t,s=xP[r];return s?s(e,r):e.getParameter(r)}const i=Array.isArray(t)?t:Object.keys(t),n={};for(const r of i){const s=xP[r];n[r]=s?s(e,Number(r)):e.getParameter(Number(r))}return n}function AZ(e){Kd(e,Nb)}function gZ(e){for(const t in e)return!1;return!0}function mZ(e,t){if(e===t)return!0;const i=Array.isArray(e)||ArrayBuffer.isView(e),n=Array.isArray(t)||ArrayBuffer.isView(t);if(i&&n&&e.length===t.length){for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}return!1}class rf{constructor(t,i){z(this,"gl"),z(this,"program",null),z(this,"stateStack",[]),z(this,"enable",!0),z(this,"cache",null),z(this,"log"),z(this,"initialized",!1),this.gl=t,this.log=(i==null?void 0:i.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(t){return t.state}push(t={}){this.stateStack.push({})}pop(){const t=this.stateStack[this.stateStack.length-1];Kd(this.gl,t),this.stateStack.pop()}trackState(t,i){if(this.cache=i.copyState?wP(t):Object.assign({},Nb),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,_Z(t);for(const n in bP){const r=bP[n];yZ(t,n,r)}CP(t,"getParameter"),CP(t,"isEnabled")}_updateCache(t){let i=!1,n;const r=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in t){const o=t[s],l=this.cache[s];mZ(o,l)||(i=!0,n=l,r&&!(s in r)&&(r[s]=l),this.cache[s]=o)}return{valueChanged:i,oldValue:n}}}function CP(e,t){const i=e[t].bind(e);e[t]=function(n){if(n===void 0||pZ.has(n))return i(n);const r=rf.get(e);return n in r.cache||(r.cache[n]=i(n)),r.enable?r.cache[n]:i(n)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function yZ(e,t,i){if(!e[t])return;const n=e[t].bind(e);e[t]=function(...r){const s=rf.get(e),{valueChanged:o,oldValue:l}=i(s._updateCache,...r);return o&&n(...r),l},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}function _Z(e){const t=e.useProgram.bind(e);e.useProgram=function(i){const n=rf.get(e);n.program!==i&&(t(i),n.program=i)}}function vZ(e,t,i){let n="";const r={preserveDrawingBuffer:!0,...i};let s=null;if(s||(s=e.getContext("webgl2",r)),r.failIfMajorPerformanceCaveat&&(n||(n="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!s&&!i.failIfMajorPerformanceCaveat&&(r.failIfMajorPerformanceCaveat=!1,s=e.getContext("webgl2",r),s.luma||(s.luma={}),s.luma.softwareRenderer=!0),s||(s=e.getContext("webgl",{}),s&&(s=null,n||(n="Your browser only supports WebGL1"))),!s)throw n||(n="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${n}`);const{onContextLost:o,onContextRestored:l}=t;return e.addEventListener("webglcontextlost",h=>o(h),!1),e.addEventListener("webglcontextrestored",h=>l(h),!1),s.luma||(s.luma={}),s}function Qd(e,t,i){return i[t]===void 0&&(i[t]=e.getExtension(t)||null),i[t]}function bZ(e,t){const i=e.getParameter(7936),n=e.getParameter(7937);Qd(e,"WEBGL_debug_renderer_info",t);const r=t.WEBGL_debug_renderer_info,s=e.getParameter(r?r.UNMASKED_VENDOR_WEBGL:7936),o=e.getParameter(r?r.UNMASKED_RENDERER_WEBGL:7937),l=s||i,h=o||n,A=e.getParameter(7938),v=EP(l,h),C=xZ(l,h),S=wZ(l,h);return{type:"webgl",gpu:v,gpuType:S,gpuBackend:C,vendor:l,renderer:h,version:A,shadingLanguage:"glsl",shadingLanguageVersion:300}}function EP(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}function xZ(e,t){return/Metal/i.exec(e)||/Metal/i.exec(t)?"metal":/ANGLE/i.exec(e)||/ANGLE/i.exec(t)?"opengl":"unknown"}function wZ(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(EP(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function BP(e){switch(e){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(e))}const sg="WEBGL_compressed_texture_s3tc",ag="WEBGL_compressed_texture_s3tc_srgb",Zd="EXT_texture_compression_rgtc",Yd="EXT_texture_compression_bptc",CZ="WEBGL_compressed_texture_etc",EZ="WEBGL_compressed_texture_astc",BZ="WEBGL_compressed_texture_etc1",TZ="WEBGL_compressed_texture_pvrtc",SZ="WEBGL_compressed_texture_atc",TP="EXT_texture_norm16",SP="EXT_render_snorm",IZ="EXT_color_buffer_float",Gb={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[SP],"norm16-renderable-webgl":[TP],"snorm16-renderable-webgl":[TP,SP],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[sg,ag,Zd,Yd],"texture-compression-bc5-webgl":[Zd],"texture-compression-bc7-webgl":[Yd],"texture-compression-etc2":[CZ],"texture-compression-astc":[EZ],"texture-compression-etc1-webgl":[BZ],"texture-compression-pvrtc-webgl":[TZ],"texture-compression-atc-webgl":[SZ]};function MZ(e){return e in Gb}function PZ(e,t,i){return(Gb[t]||[]).every(n=>Qd(e,n,i))}const zb={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:IZ,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:sg},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:ag},"bc1-rgba-unorm":{gl:33777,x:sg},"bc1-rgba-unorm-srgb":{gl:35916,x:ag},"bc2-rgba-unorm":{gl:33778,x:sg},"bc2-rgba-unorm-srgb":{gl:35918,x:ag},"bc3-rgba-unorm":{gl:33779,x:sg},"bc3-rgba-unorm-srgb":{gl:35919,x:ag},"bc4-r-unorm":{gl:36283,x:Zd},"bc4-r-snorm":{gl:36284,x:Zd},"bc5-rg-unorm":{gl:36285,x:Zd},"bc5-rg-snorm":{gl:36286,x:Zd},"bc6h-rgb-ufloat":{gl:36495,x:Yd},"bc6h-rgb-float":{gl:36494,x:Yd},"bc7-rgba-unorm":{gl:36492,x:Yd},"bc7-rgba-unorm-srgb":{gl:36493,x:Yd},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function RZ(e,t,i){let n=t.create;const r=zb[t.format];return(r==null?void 0:r.gl)===void 0&&(n=!1),r!=null&&r.x&&(n=n&&!!Qd(e,r.x,i)),{format:t.format,create:n&&t.create,render:n&&t.render,filter:n&&t.filter,blend:n&&t.blend,store:n&&t.store}}function IP(e){var t;const i=zb[e],n=LZ(e),r=F1(e);return{internalFormat:n,format:(i==null?void 0:i.dataFormat)||OZ(r.channels,r.integer,r.normalized,n),type:r.dataType?BP(r.dataType):((t=i==null?void 0:i.types)==null?void 0:t[0])||5121,compressed:r.compressed||!1}}function DZ(e){switch(F1(e).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${e}`)}}function OZ(e,t,i,n){if(n===6408||n===6407)return n;switch(e){case"r":return t&&!i?36244:6403;case"rg":return t&&!i?33320:33319;case"rgb":return t&&!i?36248:6407;case"rgba":return t&&!i?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function LZ(e){const t=zb[e],i=t==null?void 0:t.gl;if(i===void 0)throw new Error(`Unsupported texture format ${e}`);return i}const MP={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class FZ extends cj{constructor(t,i,n){super([],n),z(this,"gl"),z(this,"extensions"),z(this,"testedFeatures",new Set),this.gl=t,this.extensions=i,Qd(t,"EXT_color_buffer_float",i)}*[Symbol.iterator](){const t=this.getFeatures();for(const i of t)this.has(i)&&(yield i);return[]}has(t){var i;return(i=this.disabledFeatures)!=null&&i[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),MZ(t)&&PZ(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(i=>i!=="polygon-mode-webgl");for(const i of t)this.has(i)}getFeatures(){return[...Object.keys(MP),...Object.keys(Gb)]}getWebGLFeature(t){const i=MP[t];return typeof i=="string"?!!Qd(this.gl,i,this.extensions):!!i}}class kZ extends lj{constructor(t){super(),z(this,"gl"),z(this,"limits",{}),this.gl=t}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}class lg extends SS{constructor(t,i){super(t,i),z(this,"device"),z(this,"gl"),z(this,"handle"),z(this,"colorAttachments",[]),z(this,"depthStencilAttachment",null);const n=i.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),n||(t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const t=this.gl.bindFramebuffer(36160,this.handle);for(let i=0;i<this.colorAttachments.length;++i){const n=this.colorAttachments[i];if(n){const r=36064+i;this._attachTextureView(r,n)}}if(this.depthStencilAttachment){const i=DZ(this.depthStencilAttachment.props.format);this._attachTextureView(i,this.depthStencilAttachment)}if(this.device.props.debug){const i=this.gl.checkFramebufferStatus(36160);if(i!==36053)throw new Error(`Framebuffer ${UZ(i)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,i){const{gl:n}=this.device,{texture:r}=i,s=i.props.baseMipLevel,o=i.props.baseArrayLayer;switch(n.bindTexture(r.glTarget,r.handle),r.glTarget){case 35866:case 32879:n.framebufferTextureLayer(36160,t,r.handle,s,o);break;case 34067:const l=NZ(o);n.framebufferTexture2D(36160,t,l,r.handle,s);break;case 3553:n.framebufferTexture2D(36160,t,3553,r.handle,s);break;default:throw new Error("Illegal texture type")}n.bindTexture(r.glTarget,null)}}function NZ(e){return e<34069?e+34069:e}function UZ(e){switch(e){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${e}`}}class GZ extends gj{constructor(t,i){super(i),z(this,"device"),z(this,"format","rgba8unorm"),z(this,"depthStencilFormat","depth24plus"),z(this,"presentationSize"),z(this,"_framebuffer",null),this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new lg(this.device,{handle:null}),this._framebuffer}update(){const t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){const i=this.getDevicePixelRatio(t==null?void 0:t.useDevicePixels);this.setDevicePixelRatio(i,t);return}}commit(){}}async function PP(e,t){const i=document.getElementsByTagName("head")[0];if(!i)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",e),new Promise((r,s)=>{n.onload=r,n.onerror=o=>s(new Error(`Unable to load script '${e}': ${o}`)),i.appendChild(n)})}const zZ=1;let yo=null,RP=!1;const Vb={debugSpectorJS:ti.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function VZ(e){if(!globalThis.SPECTOR)try{await PP(e.debugSpectorJSUrl||Vb.debugSpectorJSUrl)}catch(t){ti.warn(String(t))}}function jZ(e){var t;if(e={...Vb,...e},!e.debugSpectorJS)return null;if(!yo&&globalThis.SPECTOR&&!((t=globalThis.luma)!=null&&t.spector)){ti.probe(zZ,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:i}=globalThis.SPECTOR;yo=new i,globalThis.luma&&(globalThis.luma.spector=yo)}if(!yo)return null;if(RP||(RP=!0,yo.spyCanvases(),yo==null||yo.onCaptureStarted.add(i=>ti.info("Spector capture started:",i)()),yo==null||yo.onCapture.add(i=>{ti.info("Spector capture complete:",i)(),yo==null||yo.getResultUI(),yo==null||yo.resultView.display(),yo==null||yo.resultView.addCapture(i)})),e.gl){const i=e.gl,n=i.device;yo==null||yo.startCapture(e.gl,500),i.device=n,new Promise(r=>setTimeout(r,2e3)).then(r=>{ti.info("Spector capture stopped after 2 seconds")(),yo==null||yo.stopCapture()})}return yo}const HZ="https://unpkg.com/webgl-debug@2.0.1/index.js";function DP(e){return e.luma=e.luma||{},e.luma}async function WZ(){ic()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await PP(HZ))}function JZ(e,t={}){return t.debugWebGL||t.traceWebGL?KZ(e,t):XZ(e)}function XZ(e){const t=DP(e);return t.realContext?t.realContext:e}function KZ(e,t){if(!globalThis.WebGLDebugUtils)return ti.warn("webgl-debug not loaded")(),e;const i=DP(e);if(i.debugContext)return i.debugContext;globalThis.WebGLDebugUtils.init({...Xd,...e});const n=globalThis.WebGLDebugUtils.makeDebugContext(e,QZ.bind(null,t),ZZ.bind(null,t));for(const o in Xd)!(o in n)&&typeof Xd[o]=="number"&&(n[o]=Xd[o]);class r{}Object.setPrototypeOf(n,Object.getPrototypeOf(e)),Object.setPrototypeOf(r,n);const s=Object.create(r);return i.realContext=e,i.debugContext=s,s.debug=!0,s}function OP(e,t){t=Array.from(t).map(n=>n===void 0?"undefined":n);let i=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return i=`${i.slice(0,100)}${i.length>100?"...":""}`,`gl.${e}(${i})`}function QZ(e,t,i,n){n=Array.from(n).map(l=>l===void 0?"undefined":l);const r=globalThis.WebGLDebugUtils.glEnumToString(t),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(i,n),o=`${r} in gl.${i}(${s})`;ti.error(o)();debugger}function ZZ(e,t,i){let n="";ti.level>=1&&(n=OP(t,i),e.traceWebGL&&ti.log(1,n)());for(const r of i)if(r===void 0){n=n||OP(t,i);debugger}}const jb={};function YZ(e="id"){jb[e]=jb[e]||1;const t=jb[e]++;return`${e}-${t}`}class cg extends jr{constructor(t,i={}){super(t,i),z(this,"device"),z(this,"gl"),z(this,"handle"),z(this,"glTarget"),z(this,"glUsage"),z(this,"glIndexType",5123),z(this,"byteLength"),z(this,"bytesUsed"),this.device=t,this.gl=this.device.gl;const n=typeof i=="object"?i.handle:void 0;this.handle=n||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=qZ(this.props.usage),this.glUsage=$Z(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,i.data?this._initWithData(i.data,i.byteOffset,i.byteLength):this._initWithByteLength(i.byteLength||0)}_initWithData(t,i=0,n=t.byteLength+i){const r=this.glTarget;this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,n,this.glUsage),this.gl.bufferSubData(r,i,t),this.gl.bindBuffer(r,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(t,i,n),this.trackAllocatedMemory(n)}_initWithByteLength(t){let i=t;t===0&&(i=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,i,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,i=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,i,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,i,t.byteLength)}async readAsync(t=0,i){return this.readSyncWebGL(t,i)}readSyncWebGL(t=0,i){i=i??this.byteLength-t;const n=new Uint8Array(i);return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,n,0,i),this.gl.bindBuffer(36662,null),this._setDebugData(n,t,i),n}}function qZ(e){return e&jr.INDEX?34963:e&jr.VERTEX?34962:e&jr.UNIFORM?35345:34962}function $Z(e){return e&jr.INDEX||e&jr.VERTEX?35044:e&jr.UNIFORM?35048:35044}function tY(e){const t=e.split(/\r?\n/),i=[];for(const n of t){if(n.length<=1)continue;const r=n.split(":");if(r.length===2){const[C,S]=r;i.push({message:S.trim(),type:LP(C),lineNum:0,linePos:0});continue}const[s,o,l,...h]=r;let A=parseInt(l,10);isNaN(A)&&(A=0);let v=parseInt(o,10);isNaN(v)&&(v=0),i.push({message:h.join(":").trim(),type:LP(s),lineNum:A,linePos:v})}return i}function LP(e){const t=["warning","error","info"],i=e.toLowerCase();return t.includes(i)?i:"info"}class eY extends wS{constructor(t,i){switch(super(t,i),z(this,"device"),z(this,"handle"),this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return t?tY(t):[]}getTranslatedSource(){const t=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(t==null?void 0:t.getTranslatedShaderSource(this.handle))||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;const{gl:i}=this.device;if(i.shaderSource(this.handle,t),i.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}ti.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),ti.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async n=>await new Promise(r=>setTimeout(r,n));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function iY(e,t,i,n){if(sY(t))return n(e);const r=e;r.pushState();try{return nY(e,t),Kd(r.gl,i),n(e)}finally{r.popState()}}function nY(e,t){const i=e,{gl:n}=i;if(t.cullMode)switch(t.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(t.frontFace&&n.frontFace(of("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&e.features.has("depth-clip-control")&&n.enable(34383),t.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&e.features.has("provoking-vertex-webgl")){const r=i.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,s=of("provokingVertex",t.provokingVertex,{first:36429,last:36430});r==null||r.provokingVertexWEBGL(s)}if((t.polygonMode||t.polygonOffsetLine)&&e.features.has("polygon-mode-webgl")){if(t.polygonMode){const r=i.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,s=of("polygonMode",t.polygonMode,{fill:6914,line:6913});r==null||r.polygonModeWEBGL(1028,s),r==null||r.polygonModeWEBGL(1029,s)}t.polygonOffsetLine&&n.enable(10754)}if(e.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&n.enable(12288),t.clipDistance1&&n.enable(12289),t.clipDistance2&&n.enable(12290),t.clipDistance3&&n.enable(12291),t.clipDistance4&&n.enable(12292),t.clipDistance5&&n.enable(12293),t.clipDistance6&&n.enable(12294),t.clipDistance7&&n.enable(12295)),t.depthWriteEnabled!==void 0&&n.depthMask(oY("depthWriteEnabled",t.depthWriteEnabled)),t.depthCompare&&(t.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(Hb("depthCompare",t.depthCompare))),t.stencilWriteMask){const r=t.stencilWriteMask;n.stencilMaskSeparate(1028,r),n.stencilMaskSeparate(1029,r)}if(t.stencilReadMask&&ti.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){const r=t.stencilReadMask||4294967295,s=Hb("depthCompare",t.stencilCompare);t.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,s,0,r),n.stencilFuncSeparate(1029,s,0,r)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){const r=Wb("stencilPassOperation",t.stencilPassOperation),s=Wb("stencilFailOperation",t.stencilFailOperation),o=Wb("stencilDepthFailOperation",t.stencilDepthFailOperation);n.stencilOpSeparate(1028,s,o,r),n.stencilOpSeparate(1029,s,o,r)}switch(t.blend){case!0:n.enable(3042);break;case!1:n.disable(3042);break}if(t.blendColorOperation||t.blendAlphaOperation){const r=FP("blendColorOperation",t.blendColorOperation||"add"),s=FP("blendAlphaOperation",t.blendAlphaOperation||"add");n.blendEquationSeparate(r,s);const o=j0("blendColorSrcFactor",t.blendColorSrcFactor||"one"),l=j0("blendColorDstFactor",t.blendColorDstFactor||"zero"),h=j0("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),A=j0("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");n.blendFuncSeparate(o,l,h,A)}}function Hb(e,t){return of(e,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Wb(e,t){return of(e,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function FP(e,t){return of(e,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function j0(e,t){return of(e,t,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function rY(e,t){return`Illegal parameter ${t} for ${e}`}function of(e,t,i){if(!(t in i))throw new Error(rY(e,t));return i[t]}function oY(e,t){return t}function sY(e){let t=!0;for(const i in e){t=!1;break}return t}function kP(e){const t={};return e.addressModeU&&(t[10242]=Jb(e.addressModeU)),e.addressModeV&&(t[10243]=Jb(e.addressModeV)),e.addressModeW&&(t[32882]=Jb(e.addressModeW)),e.magFilter&&(t[10240]=Xb(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[10241]=aY(e.minFilter||"linear",e.mipmapFilter)),e.lodMinClamp!==void 0&&(t[33082]=e.lodMinClamp),e.lodMaxClamp!==void 0&&(t[33083]=e.lodMaxClamp),e.type==="comparison-sampler"&&(t[34892]=34894),e.compare&&(t[34893]=Hb("compare",e.compare)),e.maxAnisotropy&&(t[34046]=e.maxAnisotropy),t}function Jb(e){switch(e){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Xb(e){switch(e){case"nearest":return 9728;case"linear":return 9729}}function aY(e,t="none"){if(!t)return Xb(e);switch(t){case"none":return Xb(e);case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class Kb extends BS{constructor(t,i){super(t,i),z(this,"device"),z(this,"handle"),z(this,"parameters"),this.device=t,this.parameters=kP(i),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[i,n]of Object.entries(t)){const r=Number(i);switch(r){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,r,n);break;default:this.device.gl.samplerParameteri(this.handle,r,n);break}}}}class qd extends _S{constructor(t,i){super(t,{...uo.defaultProps,...i}),z(this,"device"),z(this,"gl"),z(this,"handle"),z(this,"texture"),this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=i.texture}}const lY="Failed to deduce GL constant from typed array";function cY(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(lY)}}function uY(e,t){const{clamped:i=!0}=t||{};switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return i?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function NP(e){switch(e){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function hY(e){switch(e){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function H0(e,t,i){if(fY(t))return i(e);const{nocatch:n=!0}=t,r=rf.get(e);r.push(),Kd(e,t);let s;if(n)s=i(e),r.pop();else try{s=i(e)}finally{r.pop()}return s}function fY(e){for(const t in e)return!1;return!0}function dY(e,t,i){const{dimension:n,width:r,height:s,depth:o=0}=i,{glInternalFormat:l}=i,h=i.glTarget;switch(n){case"2d-array":case"3d":e.texStorage3D(h,t,l,r,s,o);break;default:e.texStorage2D(h,t,l,r,s)}}function UP(e,t,i,n){const{width:r,height:s}=n,{dimension:o,depth:l=0,mipLevel:h=0}=n,{x:A=0,y:v=0,z:C=0}=n,{glFormat:S,glType:L}=n,N=zP(n.glTarget,o,l),G=n.flipY?{37440:!0}:{};H0(e,G,()=>{switch(o){case"2d-array":case"3d":e.bindTexture(N,t),e.texSubImage3D(N,h,A,v,C,r,s,l,S,L,i),e.bindTexture(N,null);break;case"2d":case"cube":e.bindTexture(N,t),e.texSubImage2D(N,h,A,v,r,s,S,L,i),e.bindTexture(N,null);break;default:throw new Error(o)}})}function GP(e,t,i){const{dimension:n,width:r,height:s,depth:o=0,mipLevel:l=0,byteOffset:h=0}=i,{x:A=0,y:v=0,z:C=0}=i,{glFormat:S,glType:L,compressed:N}=i,G=zP(i.glTarget,n,o);switch(n){case"2d-array":case"3d":N?e.compressedTexSubImage3D(G,l,A,v,C,r,s,o,S,t,h):e.texSubImage3D(G,l,A,v,C,r,s,o,S,L,t,h);break;case"2d":case"cube":N?e.compressedTexSubImage2D(G,l,A,v,r,s,S,t,h):e.texSubImage2D(G,l,A,v,r,s,S,L,t,h);break;default:throw new Error(n)}}function pY(e){switch(e){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(e)}function zP(e,t,i){return t==="cube"?34069+i:e}function AY(e,t){var i;const{sourceX:n=0,sourceY:r=0,sourceAttachment:s=0}=t||{};let{target:o=null,sourceWidth:l,sourceHeight:h,sourceDepth:A,sourceFormat:v,sourceType:C}=t||{};const{framebuffer:S,deleteFramebuffer:L}=VP(e),{gl:N,handle:G}=S;l||(l=S.width),h||(h=S.height);const W=(i=S.colorAttachments[s])==null?void 0:i.texture;if(!W)throw new Error(`Invalid framebuffer attachment ${s}`);A=(W==null?void 0:W.depth)||1,v||(v=(W==null?void 0:W.glFormat)||6408),C||(C=(W==null?void 0:W.glType)||5121),o=yY(o,C,v,l,h),C=C||cY(o);const j=N.bindFramebuffer(36160,G);return N.readBuffer(36064+s),N.readPixels(n,r,l,h,v,C,o),N.readBuffer(36064),N.bindFramebuffer(36160,j||null),L&&S.destroy(),o}function gY(e,t){const{target:i,sourceX:n=0,sourceY:r=0,sourceFormat:s=6408,targetByteOffset:o=0}=t||{};let{sourceWidth:l,sourceHeight:h,sourceType:A}=t||{};const{framebuffer:v,deleteFramebuffer:C}=VP(e);l=l||v.width,h=h||v.height;const S=v;A=A||5121;let L=i;if(!L){const G=NP(s),W=hY(A),j=o+l*h*G*W;L=S.device.createBuffer({byteLength:j})}const N=e.device.createCommandEncoder();return N.copyTextureToBuffer({sourceTexture:e,width:l,height:h,origin:[n,r],destinationBuffer:L,byteOffset:o}),N.destroy(),C&&v.destroy(),L}function VP(e){return e instanceof SS?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:mY(e),deleteFramebuffer:!0}}function mY(e,t){const{device:i,width:n,height:r,id:s}=e;return i.createFramebuffer({...t,id:`framebuffer-for-${s}`,width:n,height:r,colorAttachments:[e]})}function yY(e,t,i,n,r,s){if(e)return e;t||(t=5121);const o=uY(t,{clamped:!1}),l=NP(i);return new o(n*r*l)}class ug extends uo{constructor(t,i){super(t,i),z(this,"device"),z(this,"gl"),z(this,"handle"),z(this,"sampler"),z(this,"view"),z(this,"mipmaps"),z(this,"compressed"),z(this,"glTarget"),z(this,"glFormat"),z(this,"glType"),z(this,"glInternalFormat"),z(this,"textureUnit",0);const n={...this.props};n.data=i.data,this.device=t,this.gl=this.device.gl,this.glTarget=pY(this.props.dimension);const r=IP(this.props.format);this.glInternalFormat=r.internalFormat,this.glFormat=r.format,this.glType=r.type,this.compressed=r.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(n),Object.seal(this)}_initialize(t){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:t.data});let{width:i,height:n}=t;if(!i||!n){const r=uo.getTextureDataSize(t.data);i=(r==null?void 0:r.width)||1,n=(r==null?void 0:r.height)||1}if(this.width=i,this.height=n,this.depth=t.depth,this.setSampler(t.sampler),this.view=new qd(this.device,{...this.props,texture:this}),this.bind(),dY(this.gl,this.mipLevels,this),t.data)switch(t.dimension){case"1d":this.setTexture1DData(t.data);break;case"2d":this.setTexture2DData(t.data);break;case"3d":this.setTexture3DData(t.data);break;case"cube":this.setTextureCubeData(t.data);break;case"2d-array":this.setTextureArrayData(t.data);break;case"cube-array":this.setTextureCubeArrayData(t.data);break;default:throw new Error(t.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new qd(this.device,{...t,texture:this})}setSampler(t={}){let i;t instanceof Kb?(this.sampler=t,i=t.props):(this.sampler=new Kb(this.device,t),i=t);const n=kP(i);this._setSamplerParameters(n)}generateMipmap(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(ti.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(t!=null&&t.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){ti.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(t){const i=uo.getExternalImageSize(t.image),n={...uo.defaultCopyExternalImageOptions,...i,...t},{image:r,depth:s,mipLevel:o,x:l,y:h,z:A,flipY:v}=n;let{width:C,height:S}=n;const{dimension:L,glTarget:N,glFormat:G,glInternalFormat:W,glType:j}=this;if(C=Math.min(C,this.width-l),S=Math.min(S,this.height-h),t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return UP(this.device.gl,this.handle,r,{dimension:L,mipLevel:o,x:l,y:h,z:A,width:C,height:S,depth:s,glFormat:G,glType:j,glTarget:N,flipY:v}),{width:n.width,height:n.height}}setTexture1DData(t){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(t,i=0){this.bind();const n=uo.normalizeTextureData(t,this);n.length>1&&this.props.mipmaps!==!1&&ti.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let r=0;r<n.length;r++){const s=n[r];this._setMipLevel(i,r,s)}this.unbind()}setTexture3DData(t){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(t)&&(this.bind(),GP(this.device.gl,t,this),this.unbind())}setTextureCubeData(t,i=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const n of uo.CubeFaces)this.setTextureCubeFaceData(t[n],n)}setTextureArrayData(t){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(t,i,n=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&ti.warn(`${this.id} has mipmap and multiple LODs.`)();const r=uo.CubeFaces.indexOf(i);this.setTexture2DData(t,r)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(t){const{face:i,width:n,height:r,pixels:s,data:o,format:l=6408,type:h=5121}=t,{gl:A}=this,v=s||o;this.bind(),v instanceof Promise?v.then(C=>this.setImageDataForFace(Object.assign({},t,{face:i,data:C,pixels:C}))):this.width||this.height?A.texImage2D(i,0,l,n,r,0,l,h,v):A.texImage2D(i,0,l,l,h,v)}_getImageDataMap(t){for(let i=0;i<uo.CubeFaces.length;++i){const n=uo.CubeFaces[i];t[n]&&(t[34069+i]=t[n],delete t[n])}return t}_setSamplerParameters(t){ti.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[i,n]of Object.entries(t)){const r=Number(i),s=n;switch(r){case 33082:case 33083:this.gl.texParameterf(this.glTarget,r,s);break;case 10241:this.gl.texParameteri(this.glTarget,r,s);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,r,s);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,r,s);break;default:this.gl.texParameteri(this.glTarget,r,s);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(t,i,n,r=this.glTarget){if(uo.isExternalImage(n)){UP(this.device.gl,this.handle,n,{...this,depth:t,mipLevel:i,glTarget:r,flipY:this.props.flipY});return}if(uo.isTextureLevelData(n)){GP(this.device.gl,n.data,{...this,depth:t,mipLevel:i,glTarget:r});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t){const{gl:i}=this;return t!==void 0&&(this.textureUnit=t,i.activeTexture(33984+t)),i.bindTexture(this.glTarget,this.handle),t}unbind(t){const{gl:i}=this;return t!==void 0&&(this.textureUnit=t,i.activeTexture(33984+t)),i.bindTexture(this.glTarget,null),t}}const _Y=[1,2,4,8];class vY extends Bj{constructor(t,i){var n;super(t,i),z(this,"device"),z(this,"glParameters"),this.device=t;let r;if(!((n=i==null?void 0:i.parameters)!=null&&n.viewport))if(i!=null&&i.framebuffer){const{width:o,height:l}=i.framebuffer;r=[0,0,o,l]}else{const[o,l]=t.getCanvasContext().getDrawingBufferSize();r=[0,0,o,l]}this.device.pushState(),this.setParameters({viewport:r,...this.props.parameters});const s=this.props.framebuffer;if(s!=null&&s.handle)if(this.props.framebuffer){const o=this.props.framebuffer.colorAttachments.map((l,h)=>36064+h);this.device.gl.drawBuffers(o)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const i={...this.glParameters};i.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(i.depthMask=!this.props.depthReadOnly),i.stencilMask=this.props.stencilReadOnly?0:1,i[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(i.viewport=t.viewport.slice(0,4),i.depthRange=[t.viewport[4],t.viewport[5]]):i.viewport=t.viewport),t.scissorRect&&(i.scissorTest=!0,i.scissor=t.scissorRect),t.blendConstant&&(i.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(i.colorMask=_Y.map(n=>!!(n&t.colorMask))),this.glParameters=i,Kd(this.device.gl,i)}beginOcclusionQuery(t){const i=this.props.occlusionQuerySet;i==null||i.beginOcclusionQuery()}endOcclusionQuery(){const t=this.props.occlusionQuerySet;t==null||t.endOcclusionQuery()}clear(){const t={...this.glParameters};let i=0;this.props.clearColors&&this.props.clearColors.forEach((n,r)=>{n&&this.clearColorBuffer(r,n)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(i|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(i|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(i|=1024,t.clearStencil=this.props.clearStencil),i!==0&&H0(this.device.gl,t,()=>{this.device.gl.clear(i)})}clearColorBuffer(t=0,i=[0,0,0,0]){H0(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(i.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,i);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,i);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,i);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function bY(e){return xY.includes(e)}const xY=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],jP={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function HP(e){const t=jP[e];if(!t)throw new Error("uniform");const[i,n,,r]=t;return{format:r,components:n,glType:i}}function wY(e){const t=jP[e];if(!t)throw new Error("attribute");const[,i,,n,r]=t;return{attributeType:n,vertexFormat:r,components:i}}function CY(e,t){const i={attributes:[],bindings:[]};i.attributes=EY(e,t);const n=SY(e,t);for(const l of n){const h=l.uniforms.map(A=>({name:A.name,format:A.format,byteOffset:A.byteOffset,byteStride:A.byteStride,arrayLength:A.arrayLength}));i.bindings.push({type:"uniform",name:l.name,group:0,location:l.location,visibility:(l.vertex?1:0)&(l.fragment?2:0),minBindingSize:l.byteLength,uniforms:h})}const r=TY(e,t);let s=0;for(const l of r)if(bY(l.type)){const{viewDimension:h,sampleType:A}=MY(l.type);i.bindings.push({type:"texture",name:l.name,group:0,location:s,viewDimension:h,sampleType:A}),l.textureUnit=s,s+=1}r.length&&(i.uniforms=r);const o=BY(e,t);return o!=null&&o.length&&(i.varyings=o),i}function EY(e,t){const i=[],n=e.getProgramParameter(t,35721);for(let r=0;r<n;r++){const s=e.getActiveAttrib(t,r);if(!s)throw new Error("activeInfo");const{name:o,type:l}=s,h=e.getAttribLocation(t,o);if(h>=0){const{attributeType:A}=wY(l),v=/instance/i.test(o)?"instance":"vertex";i.push({name:o,location:h,stepMode:v,type:A})}}return i.sort((r,s)=>r.location-s.location),i}function BY(e,t){const i=[],n=e.getProgramParameter(t,35971);for(let r=0;r<n;r++){const s=e.getTransformFeedbackVarying(t,r);if(!s)throw new Error("activeInfo");const{name:o,type:l,size:h}=s,{glType:A,components:v}=HP(l),C={location:r,name:o,type:A,size:h*v};i.push(C)}return i.sort((r,s)=>r.location-s.location),i}function TY(e,t){const i=[],n=e.getProgramParameter(t,35718);for(let r=0;r<n;r++){const s=e.getActiveUniform(t,r);if(!s)throw new Error("activeInfo");const{name:o,size:l,type:h}=s,{name:A,isArray:v}=PY(o);let C=e.getUniformLocation(t,A);const S={location:C,name:A,size:l,type:h,isArray:v};if(i.push(S),S.size>1)for(let L=0;L<S.size;L++){const N=`${A}[${L}]`;C=e.getUniformLocation(t,N);const G={...S,name:N,location:C};i.push(G)}}return i}function SY(e,t){const i=(s,o)=>e.getActiveUniformBlockParameter(t,s,o),n=[],r=e.getProgramParameter(t,35382);for(let s=0;s<r;s++){const o={name:e.getActiveUniformBlockName(t,s)||"",location:i(s,35391),byteLength:i(s,35392),vertex:i(s,35396),fragment:i(s,35398),uniformCount:i(s,35394),uniforms:[]},l=i(s,35395)||[],h=e.getActiveUniforms(t,l,35383),A=e.getActiveUniforms(t,l,35384),v=e.getActiveUniforms(t,l,35387),C=e.getActiveUniforms(t,l,35388);for(let S=0;S<o.uniformCount;++S){const L=e.getActiveUniform(t,l[S]);if(!L)throw new Error("activeInfo");o.uniforms.push({name:L.name,format:HP(h[S]).format,type:h[S],arrayLength:A[S],byteOffset:v[S],byteStride:C[S]})}n.push(o)}return n.sort((s,o)=>s.location-o.location),n}const IY={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function MY(e){const t=IY[e];if(!t)throw new Error("sampler");const[i,n]=t;return{viewDimension:i,sampleType:n}}function PY(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function RY(e,t,i,n){const r=e;let s=n;s===!0&&(s=1),s===!1&&(s=0);const o=typeof s=="number"?[s]:s;switch(i){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return e.uniform1i(t,n);case 5126:return e.uniform1fv(t,o);case 35664:return e.uniform2fv(t,o);case 35665:return e.uniform3fv(t,o);case 35666:return e.uniform4fv(t,o);case 5124:return e.uniform1iv(t,o);case 35667:return e.uniform2iv(t,o);case 35668:return e.uniform3iv(t,o);case 35669:return e.uniform4iv(t,o);case 35670:return e.uniform1iv(t,o);case 35671:return e.uniform2iv(t,o);case 35672:return e.uniform3iv(t,o);case 35673:return e.uniform4iv(t,o);case 5125:return r.uniform1uiv(t,o,1);case 36294:return r.uniform2uiv(t,o,2);case 36295:return r.uniform3uiv(t,o,3);case 36296:return r.uniform4uiv(t,o,4);case 35674:return e.uniformMatrix2fv(t,!1,o);case 35675:return e.uniformMatrix3fv(t,!1,o);case 35676:return e.uniformMatrix4fv(t,!1,o);case 35685:return r.uniformMatrix2x3fv(t,!1,o);case 35686:return r.uniformMatrix2x4fv(t,!1,o);case 35687:return r.uniformMatrix3x2fv(t,!1,o);case 35688:return r.uniformMatrix3x4fv(t,!1,o);case 35689:return r.uniformMatrix4x2fv(t,!1,o);case 35690:return r.uniformMatrix4x3fv(t,!1,o)}throw new Error("Illegal uniform")}function DY(e){return qM(e)!==null||typeof e=="number"||typeof e=="boolean"}function OY(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach(i=>{const n=e[i];DY(n)?t.uniforms[i]=n:t.bindings[i]=n}),t}function LY(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(e)}}function FY(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(e)}}const WP=4;class kY extends c0{constructor(t,i){super(t,i),z(this,"device"),z(this,"handle"),z(this,"vs"),z(this,"fs"),z(this,"introspectedLayout"),z(this,"uniforms",{}),z(this,"bindings",{}),z(this,"varyings",null),z(this,"_uniformCount",0),z(this,"_uniformSetters",{}),this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=i.vs,this.fs=i.fs;const{varyings:n,bufferMode:r=35981}=i;n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,r)),this._linkShaders(),ti.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=CY(this.device.gl,this.handle),ti.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=NY(this.introspectedLayout,i.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,i){for(const[n,r]of Object.entries(t)){const s=this.shaderLayout.bindings.find(o=>o.name===n)||this.shaderLayout.bindings.find(o=>o.name===`${n}Uniforms`);if(!s){const o=this.shaderLayout.bindings.map(l=>`"${l.name}"`).join(", ");i!=null&&i.disableWarnings||ti.warn(`No binding "${n}" in render pipeline "${this.id}", expected one of ${o}`,r)();continue}switch(r||ti.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),s.type){case"uniform":if(!(r instanceof cg)&&!(r.buffer instanceof cg))throw new Error("buffer value");break;case"texture":if(!(r instanceof qd||r instanceof ug||r instanceof lg))throw new Error("texture value");break;case"sampler":ti.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(s.type)}this.bindings[n]=r}}draw(t){var i;const{renderPass:n,parameters:r=this.props.parameters,topology:s=this.props.topology,vertexArray:o,vertexCount:l,instanceCount:h,isInstanced:A=!1,firstVertex:v=0,transformFeedback:C}=t,S=LY(s),L=!!o.indexBuffer,N=(i=o.indexBuffer)==null?void 0:i.glIndexType;if(this.linkStatus!=="success")return ti.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return ti.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(n),C&&C.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const G=n;return iY(this.device,r,G.glParameters,()=>{L&&A?this.device.gl.drawElementsInstanced(S,l||0,N,v,h||0):L?this.device.gl.drawElements(S,l||0,N,v):A?this.device.gl.drawArraysInstanced(S,v,l||0,h||0):this.device.gl.drawArrays(S,v,l||0),C&&C.end()}),o.unbindAfterRender(n),!0}setUniformsWebGL(t){const{bindings:i}=OY(t);Object.keys(i).forEach(n=>{ti.warn(`Unsupported value "${JSON.stringify(i[n])}" used in setUniforms() for key ${n}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),ti.time(WP,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),ti.timeEnd(WP,`linkProgram for ${this.id}`)(),ti.level,!this.device.features.has("compilation-status-async-webgl")){const n=this._getLinkStatus();this._reportLinkStatus(n);return}ti.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),ti.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const i=this._getLinkStatus();this._reportLinkStatus(i)}async _reportLinkStatus(t){var i;switch(t){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((i=this.fs)==null?void 0:i.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const n=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${t}: ${n}`)}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const t=async n=>await new Promise(r=>setTimeout(r,n));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const i of this.shaderLayout.bindings)!this.bindings[i.name]&&!this.bindings[i.name.replace(/Uniforms$/,"")]&&(ti.warn(`Binding ${i.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let i=0,n=0;for(const r of this.shaderLayout.bindings){const s=this.bindings[r.name]||this.bindings[r.name.replace(/Uniforms$/,"")];if(!s)throw new Error(`No value for binding ${r.name} in ${this.id}`);switch(r.type){case"uniform":const{name:o}=r,l=t.getUniformBlockIndex(this.handle,o);if(l===4294967295)throw new Error(`Invalid uniform block name ${o}`);t.uniformBlockBinding(this.handle,n,l),s instanceof cg?t.bindBufferBase(35345,n,s.handle):t.bindBufferRange(35345,n,s.buffer.handle,s.offset||0,s.size||s.buffer.byteLength-s.offset),n+=1;break;case"texture":if(!(s instanceof qd||s instanceof ug||s instanceof lg))throw new Error("texture");let h;if(s instanceof qd)h=s.texture;else if(s instanceof ug)h=s;else if(s instanceof lg&&s.colorAttachments[0]instanceof qd)ti.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),h=s.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+i),t.bindTexture(h.glTarget,h.handle),i+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${r.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:i,location:n,type:r,textureUnit:s}=t,o=this.uniforms[i]??s;o!==void 0&&RY(this.device.gl,n,r,o)}}}function NY(e,t){const i={...e,attributes:e.attributes.map(n=>({...n}))};for(const n of(t==null?void 0:t.attributes)||[]){const r=i.attributes.find(s=>s.name===n.name);r?(r.type=n.type||r.type,r.stepMode=n.stepMode||r.stepMode):ti.warn(`shader layout attribute ${n.name} not present in shader`)}return i}class UY extends Sj{constructor(t){super(t,{}),z(this,"device"),z(this,"commands",[]),this.device=t}submitCommands(t=this.commands){for(const i of t)switch(i.name){case"copy-buffer-to-buffer":GY(this.device,i.options);break;case"copy-buffer-to-texture":zY(this.device,i.options);break;case"copy-texture-to-buffer":VY(this.device,i.options);break;case"copy-texture-to-texture":jY(this.device,i.options);break;default:throw new Error(i.name)}}}function GY(e,t){const i=t.sourceBuffer,n=t.destinationBuffer;e.gl.bindBuffer(36662,i.handle),e.gl.bindBuffer(36663,n.handle),e.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),e.gl.bindBuffer(36662,null),e.gl.bindBuffer(36663,null)}function zY(e,t){throw new Error("Not implemented")}function VY(e,t){const{sourceTexture:i,mipLevel:n=0,aspect:r="all",width:s=t.sourceTexture.width,height:o=t.sourceTexture.height,depthOrArrayLayers:l=0,origin:h=[0,0],destinationBuffer:A,byteOffset:v=0,bytesPerRow:C,rowsPerImage:S}=t;if(r!=="all")throw new Error("aspect not supported in WebGL");if(n!==0||l!==0||C||S)throw new Error("not implemented");const{framebuffer:L,destroyFramebuffer:N}=JP(i);let G;try{const W=A,j=s||L.width,q=o||L.height,Z=IP(L.colorAttachments[0].texture.props.format),K=Z.format,ft=Z.type;e.gl.bindBuffer(35051,W.handle),G=e.gl.bindFramebuffer(36160,L.handle),e.gl.readPixels(h[0],h[1],j,q,K,ft,v)}finally{e.gl.bindBuffer(35051,null),G!==void 0&&e.gl.bindFramebuffer(36160,G),N&&L.destroy()}}function jY(e,t){const{sourceTexture:i,destinationMipLevel:n=0,origin:r=[0,0],destinationOrigin:s=[0,0],destinationTexture:o}=t;let{width:l=t.destinationTexture.width,height:h=t.destinationTexture.height}=t;const{framebuffer:A,destroyFramebuffer:v}=JP(i),[C,S]=r,[L,N,G]=s,W=e.gl.bindFramebuffer(36160,A.handle);let j=null,q;if(o instanceof ug)j=o,l=Number.isFinite(l)?l:j.width,h=Number.isFinite(h)?h:j.height,j.bind(0),q=j.glTarget;else throw new Error("invalid destination");switch(q){case 3553:case 34067:e.gl.copyTexSubImage2D(q,n,L,N,C,S,l,h);break;case 35866:case 32879:e.gl.copyTexSubImage3D(q,n,L,N,G,C,S,l,h);break}j&&j.unbind(),e.gl.bindFramebuffer(36160,W),v&&A.destroy()}function JP(e){if(e instanceof uo){const{width:t,height:i,id:n}=e;return{framebuffer:e.device.createFramebuffer({id:`framebuffer-for-${n}`,width:t,height:i,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}class HY extends Tj{constructor(t,i){super(t,i),z(this,"device"),z(this,"commandBuffer"),this.device=t,this.commandBuffer=new UY(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,i,n){}}function WY(e){const{target:t,source:i,start:n=0,count:r=1}=e,s=i.length,o=r*s;let l=0;for(let h=n;l<s;l++)t[h++]=i[l];for(;l<o;)l<o-l?(t.copyWithin(n+l,n,n+l),l*=2):(t.copyWithin(n+l,n,n+o-l),l=o);return e.target}class XE extends Gj{constructor(t,i){super(t,i),z(this,"device"),z(this,"handle"),z(this,"buffer",null),z(this,"bufferValue",null),this.device=t,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(t){return Q7()==="Chrome"}destroy(){var t;super.destroy(),this.buffer&&((t=this.buffer)==null||t.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const i=t;if(i&&i.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,i?i.handle:null),this.indexBuffer=i,this.device.gl.bindVertexArray(null)}setBuffer(t,i){const n=i;if(n.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:r,type:s,stride:o,offset:l,normalized:h,integer:A,divisor:v}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),A?this.device.gl.vertexAttribIPointer(t,r,s,o,l):this.device.gl.vertexAttribPointer(t,r,s,h,o,l),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,v||0),this.attributes[t]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,i){this._enable(t,!1),this.attributes[t]=i}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const i=this.attributes[t];ArrayBuffer.isView(i)&&this.device.setConstantAttributeWebGL(t,i)}}_getAccessor(t){const i=this.attributeInfos[t];if(!i)throw new Error(`Unknown attribute location ${t}`);const n=BP(i.bufferDataType);return{size:i.bufferComponents,type:n,stride:i.byteStride,offset:i.byteOffset,normalized:i.normalized,integer:i.integer,divisor:i.stepMode==="instance"?1:0}}_enable(t,i=!0){const n=XE.isConstantAttributeZeroSupported(this.device)||t!==0;(i||n)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),i?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,i){const n=JY(i),r=n.byteLength*t,s=n.length*t;if(this.buffer&&r!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${r} !== ${this.buffer.byteLength}.`);let o=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:r}),o=o||!XY(n,this.bufferValue),o){const l=Jj(i.constructor,s);WY({target:l,source:n,start:0,count:s}),this.buffer.write(l),this.bufferValue=i}return this.buffer}}function JY(e){return Array.isArray(e)?new Float32Array(e):e}function XY(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}class KY extends zj{constructor(t,i){super(t,i),z(this,"device"),z(this,"gl"),z(this,"handle"),z(this,"layout"),z(this,"buffers",{}),z(this,"unusedBuffers",{}),z(this,"bindOnUse",!0),z(this,"_bound",!1),this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,i.buffers&&this.setBuffers(i.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(FY(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const i in t)this.setBuffer(i,t[i])})}setBuffer(t,i){const n=this._getVaryingIndex(t),{buffer:r,byteLength:s,byteOffset:o}=this._getBufferRange(i);if(n<0){this.unusedBuffers[t]=r,ti.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[n]={buffer:r,byteLength:s,byteOffset:o},this.bindOnUse||this._bindBuffer(n,r,o,s)}getBuffer(t){if(XP(t))return this.buffers[t]||null;const i=this._getVaryingIndex(t);return i>=0?this.buffers[i]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let i;return this._bound?i=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,i=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),i}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof cg)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:i,byteOffset:n=0,byteLength:r=t.buffer.byteLength}=t;return{buffer:i,byteOffset:n,byteLength:r}}_getVaryingIndex(t){if(XP(t))return Number(t);for(const i of this.layout.varyings)if(t===i.name)return i.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:i,byteLength:n,byteOffset:r}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),i,r,n)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,i,n=0,r){const s=i&&i.handle;!s||r===void 0?this.gl.bindBufferBase(35982,t,s):this.gl.bindBufferRange(35982,t,s,n,r)}}function XP(e){return typeof e=="number"?Number.isInteger(e):/^\d+$/.test(e)}class QY extends Vj{constructor(t,i){if(super(t,i),z(this,"device"),z(this,"handle"),z(this,"target",null),z(this,"_queryPending",!1),z(this,"_pollingPromise",null),this.device=t,i.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t!=null&&t.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let i=0;return this._pollingPromise=new Promise((n,r)=>{const s=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):i++>t?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}}class $d extends Dd{constructor(t){var i,n;super({...t,id:t.id||YZ("webgl-device")}),z(this,"type","webgl"),z(this,"handle"),z(this,"features"),z(this,"limits"),z(this,"info"),z(this,"canvasContext"),z(this,"lost"),z(this,"_resolveContextLost"),z(this,"gl"),z(this,"debug",!1),z(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1}),z(this,"_extensions",{}),z(this,"_polyfilled",!1),z(this,"spectorJS"),z(this,"renderPass",null),z(this,"_constants");const r=Dd._getCanvasContextProps(t);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let s=(n=(i=r.canvas)==null?void 0:i.gl)==null?void 0:n.device;if(s)throw new Error(`WebGL context already attached to device ${s.id}`);this.canvasContext=new GZ(this,r),this.lost=new Promise(v=>{this._resolveContextLost=v});const o={...t.webgl};r.alphaMode==="premultiplied"&&(o.premultipliedAlpha=!0),t.powerPreference!==void 0&&(o.powerPreference=t.powerPreference);const l=this.props._handle||vZ(this.canvasContext.canvas,{onContextLost:v=>{var C;return(C=this._resolveContextLost)==null?void 0:C.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:v=>console.log("WebGL context restored")},o);if(!l)throw new Error("WebGL context creation failed");if(s=l.device,s){if(t._reuseDevices)return ti.log(1,`Not creating a new Device, instead returning a reference to Device ${s.id} already attached to WebGL context`,s)(),s._reused=!0,s;throw new Error(`WebGL context already attached to device ${s.id}`)}this.handle=l,this.gl=l,this.spectorJS=jZ({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=bZ(this.gl,this._extensions),this.limits=new kZ(this.gl),this.features=new FZ(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),r.autoResize!==!1&&this.canvasContext.resize(),new rf(this.gl,{log:(...v)=>ti.log(1,...v)()}).trackState(this.gl,{copyState:!1});const h=t.debugWebGL||t.debug,A=t.debugWebGL;h&&(this.gl=JZ(this.gl,{debugWebGL:h,traceWebGL:A}),ti.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(ti.level=Math.max(ti.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const i=this._normalizeBufferProps(t);return new cg(this,i)}createTexture(t){return new ug(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new Kb(this,t)}createShader(t){return new eY(this,t)}createFramebuffer(t){return new lg(this,t)}createVertexArray(t){return new XE(this,t)}createTransformFeedback(t){return new KY(this,t)}createQuerySet(t){return new QY(this,t)}createRenderPipeline(t){return new kY(this,t)}beginRenderPass(t){return new vY(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(t={}){return new HY(this,t)}submit(){var t;(t=this.renderPass)==null||t.end(),this.renderPass=null}readPixelsToArrayWebGL(t,i){return AY(t,i)}readPixelsToBufferWebGL(t,i){return gY(t,i)}setParametersWebGL(t){Kd(this.gl,t)}getParametersWebGL(t){return wP(this.gl,t)}withParametersWebGL(t,i){return H0(this.gl,t,i)}resetWebGL(){ti.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),AZ(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return RZ(this.gl,t,this._extensions)}loseDevice(){var t;let i=!1;const n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(i=!0,n.loseContext()),(t=this._resolveContextLost)==null||t.call(this,{reason:"destroyed",message:"Application triggered context loss"}),i}pushState(){rf.get(this.gl).push()}popState(){rf.get(this.gl).pop()}setSpectorMetadata(t,i){t.__SPECTOR_Metadata=i}getGLKey(t,i){const n=Number(t);for(const r in this.gl)if(this.gl[r]===n)return`GL.${r}`;return i!=null&&i.emptyIfUnknown?"":String(t)}getGLKeys(t){const i={emptyIfUnknown:!0};return Object.entries(t).reduce((n,[r,s])=>(n[`${r}:${this.getGLKey(r,i)}`]=`${s}:${this.getGLKey(s,i)}`,n),{})}setConstantAttributeWebGL(t,i){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const r=this._constants[t];switch(r&&$Y(r,i)&&ti.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=i,i.constructor){case Float32Array:ZY(this,t,i);break;case Int32Array:YY(this,t,i);break;case Uint32Array:qY(this,t,i);break;default:throw new Error("constant")}}getExtension(t){return Qd(this.gl,t,this._extensions),this._extensions}}function ZY(e,t,i){switch(i.length){case 1:e.gl.vertexAttrib1fv(t,i);break;case 2:e.gl.vertexAttrib2fv(t,i);break;case 3:e.gl.vertexAttrib3fv(t,i);break;case 4:e.gl.vertexAttrib4fv(t,i);break}}function YY(e,t,i){e.gl.vertexAttribI4iv(t,i)}function qY(e,t,i){e.gl.vertexAttribI4uiv(t,i)}function $Y(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}const tq={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},eq=e=>({drawBuffersWEBGL(t){return e.drawBuffers(t)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),iq=e=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return e.createVertexArray()},deleteVertexArrayOES(t){return e.deleteVertexArray(t)},isVertexArrayOES(t){return e.isVertexArray(t)},bindVertexArrayOES(t){return e.bindVertexArray(t)}}),nq=e=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...t){return e.drawArraysInstanced(...t)},drawElementsInstancedANGLE(...t){return e.drawElementsInstanced(...t)},vertexAttribDivisorANGLE(...t){return e.vertexAttribDivisor(...t)}});function rq(e=!0){const t=HTMLCanvasElement.prototype;if(!e&&t.originalGetContext){t.getContext=t.originalGetContext,t.originalGetContext=void 0;return}t.originalGetContext=t.getContext,t.getContext=function(i,n){if(i==="webgl"||i==="experimental-webgl"){const r=this.originalGetContext("webgl2",n);return r instanceof HTMLElement&&oq(r),r}return this.originalGetContext(i,n)}}function oq(e){e.getExtension("EXT_color_buffer_float");const t={...tq,WEBGL_disjoint_timer_query:e.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:eq(e),OES_vertex_array_object:iq(e),ANGLE_instanced_arrays:nq(e)},i=e.getExtension;e.getExtension=function(r){return i.call(e,r)||(r in t?t[r]:null)};const n=e.getSupportedExtensions;e.getSupportedExtensions=function(){const r=n.apply(e)||[];return r==null?void 0:r.concat(Object.keys(t))}}const W0=1;class sq extends Aj{constructor(){super(),z(this,"type","webgl"),Dd.defaultProps={...Dd.defaultProps,...Vb},$d.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(t){rq(t)}async attach(t){if(t instanceof $d)return t;if((t==null?void 0:t.device)instanceof Dd)return t.device;if(!aq(t))throw new Error("Invalid WebGL2RenderingContext");return new $d({_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1}})}async create(t={}){ti.groupCollapsed(W0,"WebGLDevice created")();const i=[];(t.debugWebGL||t.debug)&&i.push(WZ()),t.debugSpectorJS&&i.push(VZ(t));const n=await Promise.allSettled(i);for(const o of n)o.status==="rejected"&&ti.error(`Failed to initialize debug libraries ${o.reason}`)();const r=new $d(t),s=`${r._reused?"Reusing":"Created"} device with WebGL2 ${r.debug?"debug ":""}context: ${r.info.vendor}, ${r.info.renderer} for canvas: ${r.canvasContext.id}`;return ti.probe(W0,s)(),ti.table(W0,r.info)(),ti.groupEnd(W0)(),r}}function aq(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:!!(e&&Number.isFinite(e._version))}const KP=new sq;function eh(){}const lq=({isDragging:e})=>e?"grabbing":"grab",QP={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:eh,onWebGLInitialized:eh,onResize:eh,onViewStateChange:eh,onInteractionStateChange:eh,onBeforeRender:eh,onAfterRender:eh,onLoad:eh,onError:e=>Yi.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:lq,getTooltip:null,debug:!1,drawPickingColors:!1};class Qb{constructor(t){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new hP({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:r}=this;if(n.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(n.leftButton||n.rightButton)return;{const s=n.offsetCenter;if(!s)return;r.x=s.x,r.y=s.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=n},this._onEvent=n=>{const r=vb[n.type],s=n.offsetCenter;if(!r||!s||!this.layerManager)return;const o=this.layerManager.getLayers(),l=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:h}=l,A=h&&(h[r]||h.props[r]),v=this.props[r];let C=!1;A&&(C=A.call(h,l,n)),C||(v==null||v(l,n),this.widgetManager.onEvent(l,n))},this._onPointerDown=n=>{var r;if(((r=this.device)==null?void 0:r.type)==="webgpu")return;const s=n.offsetCenter,o=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=o.result[0]||o.emptyInfo},this.props={...QP,...t},t=this.props,t.viewState&&t.initialViewState&&Yi.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,t.device&&(this.device=t.device);let i=this.device;!i&&t.gl&&(t.gl instanceof WebGLRenderingContext&&Yi.error("WebGL1 context not supported.")(),i=KP.attach(t.gl)),i||(i=N1.createDevice({type:"best-available",_reuseDevices:!0,adapters:[KP],...t.deviceProps,createCanvasContext:{canvas:this._createCanvas(t),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(i,t),this.setProps(t),t._typedArrayManagerProps&&zd.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){var t,i,n,r,s,o,l,h,A,v;(t=this.animationLoop)==null||t.stop(),(i=this.animationLoop)==null||i.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)==null||n.finalize(),this.layerManager=null,(r=this.viewManager)==null||r.finalize(),this.viewManager=null,(s=this.effectManager)==null||s.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(l=this.deckPicker)==null||l.finalize(),this.deckPicker=null,(h=this.eventManager)==null||h.destroy(),this.eventManager=null,(A=this.widgetManager)==null||A.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((v=this.canvas.parentElement)==null||v.removeChild(this.canvas),this.canvas=null)}setProps(t){var i;this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&Yi.removed("onLayerHover","onHover")(),"onLayerClick"in t&&Yi.removed("onLayerClick","onClick")(),t.initialViewState&&!$r(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(i=this.animationLoop)==null||i.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n),this.widgetManager.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(t={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let i=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(t),r=this.layerManager.needsRedraw(t),s=this.effectManager.needsRedraw(t),o=this.deckRenderer.needsRedraw(t);return i=i||n||r||s||o,i}redraw(t){if(!this.layerManager)return;let i=this.needsRedraw({clearRedrawFlags:!0});i=t||i,i&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(i):this._drawLayers(i))}get isInitialized(){return this.viewManager!==null}getViews(){return is(this.viewManager),this.viewManager.views}getViewports(t){return is(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){const i=this._pick("pickObject","pickObject Time",t).result;return i.length?i[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t,i=!1){for(const n in t)this.layerManager.resourceManager.add({resourceId:n,data:t[n],forceUpdate:i})}_removeResources(t){for(const i of t)this.layerManager.resourceManager.remove(i)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_addDefaultShaderModule(t){this.layerManager.addDefaultShaderModule(t)}_removeDefaultShaderModule(t){var i;(i=this.layerManager)==null||i.removeDefaultShaderModule(t)}_pick(t,i,n){is(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(i).timeStart();const s=this.deckPicker[t]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return r.get(i).timeEnd(),s}_createCanvas(t){let i=t.canvas;return typeof i=="string"&&(i=document.getElementById(i),is(i)),i||(i=document.createElement("canvas"),i.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(i)),Object.assign(i.style,t.style),i}_setCanvasSize(t){var i;if(!this.canvas)return;const{width:n,height:r}=t;if(n||n===0){const s=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=s}if(r||r===0){const s=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((i=t.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var t,i;const{canvas:n}=this;if(!n)return;const r=n.clientWidth??n.width,s=n.clientHeight??n.height;(r!==this.width||s!==this.height)&&(this.width=r,this.height=s,(t=this.viewManager)==null||t.setProps({width:r,height:s}),(i=this.layerManager)==null||i.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:s}))}_createAnimationLoop(t,i){const{gl:n,onError:r,useDevicePixels:s}=i;return new VK({device:t,useDevicePixels:s,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:r})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:t}=this.props,i=Array.isArray(t)?t:t?[t]:[new AP({id:"default-view"})];return i.length&&this.props.controller&&(i[0].props.controller=this.props.controller),i}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){var t,i,n,r;if(((t=this.device)==null?void 0:t.type)==="webgpu")return;const{_pickRequest:s}=this;if(s.event){const{result:o,emptyInfo:l}=this._pick("pickObject","pickObject Time",s);this.cursorState.isHovering=o.length>0;let h=l,A=!1;for(const v of o)h=v,A=((i=v.layer)==null?void 0:i.onHover(v,s.event))||A;A||((r=(n=this.props).onHover)==null||r.call(n,h,s.event),this.widgetManager.onHover(h,s.event)),s.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(t){var i,n;if(this.device=t,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const r=new JM;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new yX(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(xM).map(o=>{var l;const[h,A,v,C]=xM[o],S=(l=this.props.eventRecognizerOptions)==null?void 0:l[o],L={...A,...S,event:o};return{recognizer:new h(L),recognizeWith:v,requestFailure:C}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in vb)this.eventManager.on(o,this._onEvent);this.viewManager=new LQ({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const s=this.viewManager.getViewports()[0];this.layerManager=new OQ(this.device,{deck:this,stats:this.stats,viewport:s,timeline:r}),this.effectManager=new YQ({deck:this,device:this.device}),this.deckRenderer=new tZ(this.device),this.deckPicker=new sZ(this.device),this.widgetManager=new cZ({deck:this,parentElement:(n=this.canvas)==null?void 0:n.parentElement}),this.widgetManager.addDefault(new hZ),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,i){var n;const{device:r,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:s});const o={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...i};(n=this.deckRenderer)==null||n.renderLayers(o),o.pass==="screen"&&this.widgetManager.onRedraw({viewports:o.viewports,layers:o.layers}),this.props.onAfterRender({device:r,gl:s})}_onRenderFrame(){var t;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Yi.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((t=this.device)==null?void 0:t.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const i=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:i},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const i=this.animationLoop.stats;t.get("GPU Time").addTime(i.get("GPU Time").lastTiming),t.get("CPU Time").addTime(i.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:i}=this;t.fps=i.get("frameRate").getHz(),t.setPropsTime=i.get("setProps Time").time,t.updateAttributesTime=i.get("Update Attributes").time,t.framesRedrawn=i.get("Redraw Count").count,t.pickTime=i.get("pickObject Time").time+i.get("pickMultipleObjects Time").time+i.get("pickObjects Time").time,t.pickCount=i.get("Pick Count").count,t.gpuTime=i.get("GPU Time").time,t.cpuTime=i.get("CPU Time").time,t.gpuTimePerFrame=i.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=i.get("CPU Time").getAverageTime();const n=N1.stats.get("Memory Usage");t.bufferMemory=n.get("Buffer Memory").count,t.textureMemory=n.get("Texture Memory").count,t.renderbufferMemory=n.get("Renderbuffer Memory").count,t.gpuMemory=n.get("GPU Memory").count}}Qb.defaultProps=QP,Qb.VERSION=uV;function cq(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return VS(e)}}const uq=zS;function J0(e,t,i){const n=i==="webgpu"&&t.type==="uint8"?"unorm8":t.type;return{attribute:e,format:t.size>1?`${n}x${t.size}`:t.type,byteOffset:t.offset||0}}function sf(e){return e.stride||e.size*e.bytesPerElement}function hq(e,t){return e.type===t.type&&e.size===t.size&&sf(e)===sf(t)&&(e.offset||0)===(t.offset||0)}function Zb(e,t){t.offset&&Yi.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const i=sf(e),n=t.vertexOffset!==void 0?t.vertexOffset:e.vertexOffset||0,r=t.elementOffset||0,s=n*i+r*e.bytesPerElement+(e.offset||0);return{...t,offset:s,stride:i}}function fq(e,t){const i=Zb(e,t);return{high:i,low:{...i,offset:i.offset+e.size*4}}}class dq{constructor(t,i,n){this._buffer=null,this.device=t,this.id=i.id||"",this.size=i.size||1;const r=i.logicalType||i.type,s=r==="float64";let{defaultValue:o}=i;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let l;s?l="float32":!r&&i.isIndexed?l="uint32":l=r||"float32";let h=cq(r||l);this.doublePrecision=s,s&&i.fp64===!1&&(h=Float32Array),this.value=null,this.settings={...i,defaultType:h,defaultValue:o,logicalType:r,type:l,normalized:l.includes("norm"),size:this.size,bytesPerElement:h.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*sf(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),zd.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(t=this.id,i=null){const n={};if(this.state.constant){const r=this.value;if(i){const s=Zb(this.getAccessor(),i),o=s.offset/r.BYTES_PER_ELEMENT,l=s.size||this.size;n[t]=r.subarray(o,o+l)}else n[t]=r}else n[t]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${t}64Low`]=n[t]:n[`${t}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(t=this.id,i=null){const n=this.getAccessor(),r=[],s={name:this.id,byteStride:sf(n),attributes:r};if(this.doublePrecision){const o=fq(n,i||{});r.push(J0(t,{...n,...o.high},this.device.type),J0(`${t}64Low`,{...n,...o.low},this.device.type))}else if(i){const o=Zb(n,i);r.push(J0(t,{...n,...o},this.device.type))}else r.push(J0(t,n,this.device.type));return s}setAccessor(t){this.state.bufferAccessor=t}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const i=Array.from(this.value);t=[i,i]}else{const{value:i,numInstances:n,size:r}=this,s=n*r;if(i&&s&&i.length>=s){const o=new Array(r).fill(1/0),l=new Array(r).fill(-1/0);for(let h=0;h<s;)for(let A=0;A<r;A++){const v=i[h++];v<o[A]&&(o[A]=v),v>l[A]&&(l[A]=v)}t=[o,l]}}return this.state.bounds=t,t}setData(t){const{state:i}=this;let n;ArrayBuffer.isView(t)?n={value:t}:t instanceof jr?n={buffer:t}:n=t;const r={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)r.type="float32";else{const s=uq(n.value);r.type=r.normalized?s.replace("int","norm"):s}r.bytesPerElement=n.value.BYTES_PER_ELEMENT,r.stride=sf(r)}if(i.bounds=null,n.constant){let s=n.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!i.constant||!this._areValuesEqual(s,this.value)))return!1;i.externalBuffer=null,i.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(n.buffer){const s=n.buffer;i.externalBuffer=s,i.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let s=n.value;i.externalBuffer=null,i.constant=!1,this.value=s;let{buffer:o}=this;const l=sf(r),h=(r.vertexOffset||0)*l;if(this.doublePrecision&&s instanceof Float64Array&&(s=Ib(s,r)),this.settings.isIndexed){const v=this.settings.defaultType;s.constructor!==v&&(s=new v(s))}const A=s.byteLength+h+l*2;(!o||o.byteLength<A)&&(o=this._createBuffer(A)),o.write(s,h)}return this.setAccessor(r),!0}updateSubBuffer(t={}){this.state.bounds=null;const i=this.value,{startOffset:n=0,endOffset:r}=t;this.buffer.write(this.doublePrecision&&i instanceof Float64Array?Ib(i,{size:this.size,startIndex:n,endIndex:r}):i.subarray(n,r),n*i.BYTES_PER_ELEMENT+this.byteOffset)}allocate(t,i=!1){const{state:n}=this,r=n.allocatedValue,s=zd.allocate(r,t+1,{size:this.size,type:this.settings.defaultType,copy:i});this.value=s;const{byteOffset:o}=this;let{buffer:l}=this;return(!l||l.byteLength<s.byteLength+o)&&(l=this._createBuffer(s.byteLength+o),i&&r&&l.write(r instanceof Float64Array?Ib(r,this):r,o)),n.allocatedValue=s,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(t){const{value:i}=t;if(!ArrayBuffer.isView(i))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=i.BYTES_PER_ELEMENT<4),r)throw new Error(`Attribute ${this.id} does not support ${i.constructor.name}`);!(i instanceof n)&&this.settings.normalized&&!("normalized"in t)&&Yi.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(t){switch(this.settings.type){case"snorm8":return new Float32Array(t).map(i=>(i+128)/255*2-1);case"snorm16":return new Float32Array(t).map(i=>(i+32768)/65535*2-1);case"unorm8":return new Float32Array(t).map(i=>i/255);case"unorm16":return new Float32Array(t).map(i=>i/65535);default:return t}}_normalizeValue(t,i,n){const{defaultValue:r,size:s}=this.settings;if(Number.isFinite(t))return i[n]=t,i;if(!t){let o=s;for(;--o>=0;)i[n+o]=r[o];return i}switch(s){case 4:i[n+3]=Number.isFinite(t[3])?t[3]:r[3];case 3:i[n+2]=Number.isFinite(t[2])?t[2]:r[2];case 2:i[n+1]=Number.isFinite(t[1])?t[1]:r[1];case 1:i[n+0]=Number.isFinite(t[0])?t[0]:r[0];break;default:let o=s;for(;--o>=0;)i[n+o]=Number.isFinite(t[o])?t[o]:r[o]}return i}_areValuesEqual(t,i){if(!t||!i)return!1;const{size:n}=this;for(let r=0;r<n;r++)if(t[r]!==i[r])return!1;return!0}_createBuffer(t){var i;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:(n?jr.INDEX:jr.VERTEX)|jr.COPY_DST,indexType:n?r:void 0,byteLength:t}),this._buffer}}const ZP=[],YP=[];function lc(e,t=0,i=1/0){let n=ZP;const r={index:-1,data:e,target:[]};return e?typeof e[Symbol.iterator]=="function"?n=e:e.length>0&&(YP.length=e.length,n=YP):n=ZP,(t>0||Number.isFinite(i))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(t,i),r.index=t-1),{iterable:n,objectInfo:r}}function qP(e){return e&&e[Symbol.asyncIterator]}function $P(e,t){const{size:i,stride:n,offset:r,startIndices:s,nested:o}=t,l=e.BYTES_PER_ELEMENT,h=n?n/l:i,A=r?r/l:0,v=Math.floor((e.length-A)/h);return(C,{index:S,target:L})=>{if(!s){const j=S*h+A;for(let q=0;q<i;q++)L[q]=e[j+q];return L}const N=s[S],G=s[S+1]||v;let W;if(o){W=new Array(G-N);for(let j=N;j<G;j++){const q=j*h+A;L=new Array(i);for(let Z=0;Z<i;Z++)L[Z]=e[q+Z];W[j-N]=L}}else if(h===i)W=e.subarray(N*i+A,G*i+A);else{W=new e.constructor((G-N)*i);let j=0;for(let q=N;q<G;q++){const Z=q*h+A;for(let K=0;K<i;K++)W[j++]=e[Z+K]}}return W}}const pq=[],X0=[[0,1/0]];function Aq(e,t){if(e===X0||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return e;const i=[],n=e.length;let r=0;for(let s=0;s<n;s++){const o=e[s];o[1]<t[0]?(i.push(o),r=s+1):o[0]>t[1]?i.push(o):t=[Math.min(o[0],t[0]),Math.max(o[1],t[1])]}return i.splice(r,0,t),i}const gq={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function t4(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});const i=e.type||"interpolation";return{...gq[i],...t,...e,type:i}}class e4 extends dq{constructor(t,i){super(t,i,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:X0}),this.constant=!1,this.settings.update=i.update||(i.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:t=!1}={}){const i=this.state.needsRedraw;return this.state.needsRedraw=i&&!t,i}layoutChanged(){return this.state.layoutChanged}setAccessor(t){var i;(i=this.state).layoutChanged||(i.layoutChanged=!hq(t,this.getAccessor())),super.setAccessor(t)}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:i}=this.settings,n=this.settings.transition,r=Array.isArray(i)?t[i.find(s=>t[s])]:t[i];return t4(r,n)}setNeedsUpdate(t=this.id,i){if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),i){const{startRow:n=0,endRow:r=1/0}=i;this.state.updateRanges=Aq(this.state.updateRanges,[n,r])}else this.state.updateRanges=X0}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=pq}setNeedsRedraw(t=this.id){this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:i,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(t,i.updateRanges!==X0),!0):!1}updateBuffer({numInstances:t,data:i,props:n,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:l}}=this;let h=!0;if(o){for(const[A,v]of s)o.call(r,this,{data:i,startRow:A,endRow:v,props:n,numInstances:t});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[A,v]of s){const C=Number.isFinite(A)?this.getVertexOffset(A):0,S=Number.isFinite(v)?this.getVertexOffset(v):l||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:C,endOffset:S})}this._checkAttributeArray()}else h=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),h}setConstantValue(t){return this.device.type==="webgpu"||t===void 0||typeof t=="function"?!1:(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){const{state:i}=this;return t?(this.clearNeedsUpdate(),i.lastExternalBuffer===t||(i.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(i.lastExternalBuffer=null,!1)}setBinaryValue(t,i=null){const{state:n,settings:r}=this;if(!t)return n.binaryValue=null,n.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(n.binaryValue===t)return this.clearNeedsUpdate(),!0;if(n.binaryValue=t,this.setNeedsRedraw(),r.transform||i!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const s=t;is(ArrayBuffer.isView(s.value),`invalid ${r.accessor}`);const o=!!s.size&&s.size!==this.size;return n.binaryAccessor=$P(s.value,{size:s.size||this.size,stride:s.stride,offset:s.offset,startIndices:i,nested:o}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:i}=this;return(i?t<i.length?i[t]:this.numInstances:t)*this.size}getValue(){const t=this.settings.shaderAttributes,i=super.getValue();if(!t)return i;for(const n in t)Object.assign(i,super.getValue(n,t[n]));return i}getBufferLayout(t){this.state.layoutChanged=!1;const i=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:r}=this.settings;if(r==="dynamic"?n.stepMode=t?t.isInstanced?"instance":"vertex":"instance":n.stepMode=r??"vertex",!i)return n;for(const s in i){const o=super._getBufferLayout(s,i[s]);n.attributes.push(...o.attributes)}return n}_autoUpdater(t,{data:i,startRow:n,endRow:r,props:s,numInstances:o}){if(t.constant&&this.context.device.type!=="webgpu")return;const{settings:l,state:h,value:A,size:v,startIndices:C}=t,{accessor:S,transform:L}=l;let N=h.binaryAccessor||(typeof S=="function"?S:s[S]);typeof N!="function"&&(N=()=>N),is(typeof N=="function",`accessor "${S}" is not a function`);let G=t.getVertexOffset(n);const{iterable:W,objectInfo:j}=lc(i,n,r);for(const q of W){j.index++;let Z=N(q,j);if(L&&(Z=L.call(this,Z)),C){const K=(j.index<C.length-1?C[j.index+1]:o)-C[j.index];if(Z&&Array.isArray(Z[0])){let ft=G;for(const rt of Z)t._normalizeValue(rt,A,ft),ft+=v}else Z&&Z.length>v?A.set(Z,G):(t._normalizeValue(Z,j.target,0),IQ({target:A,source:j.target,start:G,count:K}));G+=K*v}else t._normalizeValue(Z,A,G),G+=v}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:t}=this,i=Math.min(4,this.size);if(t&&t.length>=i){let n=!0;switch(i){case 4:n=n&&Number.isFinite(t[3]);case 3:n=n&&Number.isFinite(t[2]);case 2:n=n&&Number.isFinite(t[1]);case 1:n=n&&Number.isFinite(t[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Yb(e){const{source:t,target:i,start:n=0,size:r,getData:s}=e,o=e.end||i.length,l=t.length,h=o-n;if(l>h){i.set(t.subarray(0,h),n);return}if(i.set(t,n),!s)return;let A=l;for(;A<h;){const v=s(A,t);for(let C=0;C<r;C++)i[n+A]=v[C]||0,A++}}function mq({source:e,target:t,size:i,getData:n,sourceStartIndices:r,targetStartIndices:s}){if(!r||!s)return Yb({source:e,target:t,size:i,getData:n}),t;let o=0,l=0;const h=n&&((v,C)=>n(v+l,C)),A=Math.min(r.length,s.length);for(let v=1;v<A;v++){const C=r[v]*i,S=s[v]*i;Yb({source:e.subarray(o,C),target:t,start:l,end:S,size:i,getData:h}),o=C,l=S}return l<t.length&&Yb({source:[],target:t,start:l,size:i,getData:h}),t}function yq(e){const{device:t,settings:i,value:n}=e,r=new e4(t,i);return r.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:i.normalized}),r}function i4(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${e}"`)}}function n4(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function r4(e){e.push(e.shift())}function _q(e,t){const{doublePrecision:i,settings:n,value:r,size:s}=e,o=i&&r instanceof Float64Array?2:1;let l=0;const{shaderAttributes:h}=e.settings;if(h)for(const A of Object.values(h))l=Math.max(l,A.vertexOffset??0);return(n.noAlloc?r.length:(t+l)*s)*o}function o4({device:e,source:t,target:i}){return(!i||i.byteLength<t.byteLength)&&(i==null||i.destroy(),i=e.createBuffer({byteLength:t.byteLength,usage:t.usage})),i}function s4({device:e,buffer:t,attribute:i,fromLength:n,toLength:r,fromStartIndices:s,getData:o=l=>l}){const l=i.doublePrecision&&i.value instanceof Float64Array?2:1,h=i.size*l,A=i.byteOffset,v=i.settings.bytesPerElement<4?A/i.settings.bytesPerElement*4:A,C=i.startIndices,S=s&&C,L=i.isConstant;if(!S&&t&&n>=r)return t;const N=i.value instanceof Float64Array?Float32Array:i.value.constructor,G=L?i.value:new N(i.getBuffer().readSyncWebGL(A,r*N.BYTES_PER_ELEMENT).buffer);if(i.settings.normalized&&!L){const Z=o;o=(K,ft)=>i.normalizeConstant(Z(K,ft))}const W=L?(Z,K)=>o(G,K):(Z,K)=>o(G.subarray(Z+A,Z+A+h),K),j=t?new Float32Array(t.readSyncWebGL(v,n*4).buffer):new Float32Array(0),q=new Float32Array(r);return mq({source:j,target:q,sourceStartIndices:s,targetStartIndices:C,size:h,getData:W}),(!t||t.byteLength<q.byteLength+v)&&(t==null||t.destroy(),t=e.createBuffer({byteLength:q.byteLength+v,usage:35050})),t.write(q,v),t}class a4{constructor({device:t,attribute:i,timeline:n}){this.buffers=[],this.currentLength=0,this.device=t,this.transition=new z0(n),this.attribute=i,this.attributeInTransition=yq(i),this.currentStartIndices=i.startIndices}get inProgress(){return this.transition.inProgress}start(t,i,n=1/0){this.settings=t,this.currentStartIndices=this.attribute.startIndices,this.currentLength=_q(this.attribute,i),this.transition.start({...t,duration:n})}update(){const t=this.transition.update();return t&&this.onUpdate(),t}setBuffer(t){this.attributeInTransition.setData({buffer:t,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const t of this.buffers)t.destroy();this.buffers.length=0}}class vq extends a4{constructor({device:t,attribute:i,timeline:n}){super({device:t,attribute:i,timeline:n}),this.type="interpolation",this.transform=Cq(t,i)}start(t,i){const n=this.currentLength,r=this.currentStartIndices;if(super.start(t,i,t.duration),t.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:o}=this;r4(s),s[0]=s4({device:this.device,buffer:s[0],attribute:o,fromLength:n,toLength:this.currentLength,fromStartIndices:r,getData:t.enter}),s[1]=o4({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:l}=this,h=l.model;let A=Math.floor(this.currentLength/o.size);c4(o)&&(A/=2),h.setVertexCount(A),o.isConstant?(h.setAttributes({aFrom:s[0]}),h.setConstantAttributes({aTo:o.value})):h.setAttributes({aFrom:s[0],aTo:o.getBuffer()}),l.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:t,easing:i}=this.settings,{time:n}=this.transition;let r=n/t;i&&(r=i(r));const{model:s}=this.transform,o={time:r};s.shaderInputs.setProps({interpolation:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const bq=`uniform interpolationUniforms {
  float time;
} interpolation;
`,l4={name:"interpolation",vs:bq,uniformTypes:{time:"f32"}},xq=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,wq=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function c4(e){return e.doublePrecision&&e.value instanceof Float64Array}function Cq(e,t){const i=t.size,n=i4(i),r=n4(i),s=t.getBufferLayout();return c4(t)?new k0(e,{vs:wq,bufferLayout:[{name:"aFrom",byteStride:8*i,attributes:[{attribute:"aFrom",format:r,byteOffset:0},{attribute:"aFrom64Low",format:r,byteOffset:4*i}]},{name:"aTo",byteStride:8*i,attributes:[{attribute:"aTo",format:r,byteOffset:0},{attribute:"aTo64Low",format:r,byteOffset:4*i}]}],modules:[lJ,l4],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:i},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new k0(e,{vs:xq,bufferLayout:[{name:"aFrom",format:r},{name:"aTo",format:s.attributes[0].format}],modules:[l4],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class Eq extends a4{constructor({device:t,attribute:i,timeline:n}){super({device:t,attribute:i,timeline:n}),this.type="spring",this.texture=Pq(t),this.framebuffer=Rq(t,this.texture),this.transform=Mq(t,i)}start(t,i){const n=this.currentLength,r=this.currentStartIndices;super.start(t,i);const{buffers:s,attribute:o}=this;for(let h=0;h<2;h++)s[h]=s4({device:this.device,buffer:s[h],attribute:o,fromLength:n,toLength:this.currentLength,fromStartIndices:r,getData:t.enter});s[2]=o4({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:l}=this.transform;l.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?l.setConstantAttributes({aTo:o.value}):l.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:t,transform:i,framebuffer:n,transition:r}=this,s=this.settings;i.model.setAttributes({aPrev:t[0],aCur:t[1]}),i.transformFeedback.setBuffers({vNext:t[2]});const o={stiffness:s.stiffness,damping:s.damping};i.model.shaderInputs.setProps({spring:o}),i.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),r4(t),this.setBuffer(t[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||r.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const Bq=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,Tq={name:"spring",vs:Bq,uniformTypes:{damping:"f32",stiffness:"f32"}},Sq=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,Iq=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function Mq(e,t){const i=i4(t.size),n=n4(t.size);return new k0(e,{vs:Sq,fs:Iq,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[Tq],defines:{ATTRIBUTE_TYPE:i},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function Pq(e){return e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function Rq(e,t){return e.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}const Dq={interpolation:vq,spring:Eq};class Oq{constructor(t,{id:i,timeline:n}){if(!t)throw new Error("AttributeTransitionManager is constructed without device");this.id=i,this.device=t,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const t in this.transitions)this._removeTransition(t)}update({attributes:t,transitions:i,numInstances:n}){this.numInstances=n||1;for(const r in t){const s=t[r],o=s.getTransitionSetting(i);o&&this._updateAttribute(r,s,o)}for(const r in this.transitions){const s=t[r];(!s||!s.getTransitionSetting(i))&&this._removeTransition(r)}}hasAttribute(t){const i=this.transitions[t];return i&&i.inProgress}getAttributes(){const t={};for(const i in this.transitions){const n=this.transitions[i];n.inProgress&&(t[i]=n.attributeInTransition)}return t}run(){if(this.numInstances===0)return!1;for(const i in this.transitions)this.transitions[i].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].delete(),delete this.transitions[t]}_updateAttribute(t,i,n){const r=this.transitions[t];let s=!r||r.type!==n.type;if(s){r&&this._removeTransition(t);const o=Dq[n.type];o?this.transitions[t]=new o({attribute:i,timeline:this.timeline,device:this.device}):(Yi.error(`unsupported transition type '${n.type}'`)(),s=!1)}(s||i.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(n,this.numInstances))}}const u4="attributeManager.invalidate",Lq="attributeManager.updateStart",Fq="attributeManager.updateEnd",kq="attribute.updateStart",Nq="attribute.allocate",Uq="attribute.updateEnd";class K0{constructor(t,{id:i="attribute-manager",stats:n,timeline:r}={}){this.mergeBoundsMemoized=$A(SK),this.id=i,this.device=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new Oq(t,{id:`${i}-transitions`,timeline:r}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(t={clearRedrawFlags:!1}){const i=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,i&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{stepMode:"instance"})}remove(t){for(const i of t)this.attributes[i]!==void 0&&(this.attributes[i].delete(),delete this.attributes[i])}invalidate(t,i){const n=this._invalidateTrigger(t,i);As(u4,this,t,n)}invalidateAll(t){for(const i in this.attributes)this.attributes[i].setNeedsUpdate(i,t);As(u4,this,"all")}update({data:t,numInstances:i,startIndices:n=null,transitions:r,props:s={},buffers:o={},context:l={}}){let h=!1;As(Lq,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const A in this.attributes){const v=this.attributes[A],C=v.settings.accessor;v.startIndices=n,v.numInstances=i,s[A]&&Yi.removed(`props.${A}`,`data.attributes.${A}`)(),v.setExternalBuffer(o[A])||v.setBinaryValue(typeof C=="string"?o[C]:void 0,t.startIndices)||typeof C=="string"&&!o[C]&&v.setConstantValue(s[C])||v.needsUpdate()&&(h=!0,this._updateAttribute({attribute:v,numInstances:i,data:t,props:s,context:l})),this.needsRedraw=this.needsRedraw||v.needsRedraw()}h&&As(Fq,this,i),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:r})}updateTransition(){const{attributeTransitionManager:t}=this,i=t.run();return this.needsRedraw=this.needsRedraw||i,i}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(t){const i=t.map(n=>{var r;return(r=this.attributes[n])==null?void 0:r.getBounds()});return this.mergeBoundsMemoized(i)}getChangedAttributes(t={clearChangedFlags:!1}){const{attributes:i,attributeTransitionManager:n}=this,r={...n.getAttributes()};for(const s in i){const o=i[s];o.needsRedraw(t)&&!n.hasAttribute(s)&&(r[s]=o)}return r}getBufferLayouts(t){return Object.values(this.getAttributes()).map(i=>i.getBufferLayout(t))}_add(t,i){for(const n in t){const r=t[n],s={...r,id:n,size:r.isIndexed&&1||r.size||1,...i};this.attributes[n]=new e4(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const t={};for(const i in this.attributes)this.attributes[i].getUpdateTriggers().forEach(n=>{t[n]||(t[n]=[]),t[n].push(i)});this.updateTriggers=t}_invalidateTrigger(t,i){const{attributes:n,updateTriggers:r}=this,s=r[t];return s&&s.forEach(o=>{const l=n[o];l&&l.setNeedsUpdate(l.id,i)}),s}_updateAttribute(t){const{attribute:i,numInstances:n}=t;if(As(kq,i),i.constant){i.setConstantValue(i.value);return}i.allocate(n)&&As(Nq,i,n),i.updateBuffer(t)&&(this.needsRedraw=!0,As(Uq,i,n))}}class Gq extends z0{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:i,toValue:n,duration:r,easing:s}}=this,o=s(t/r);this._value=pl(i,n,o)}}const h4=1e-5;function f4(e,t,i,n,r){const s=t-e,o=(i-t)*r,l=-s*n;return o+l+s+t}function zq(e,t,i,n,r){if(Array.isArray(i)){const s=[];for(let o=0;o<i.length;o++)s[o]=f4(e[o],t[o],i[o],n,r);return s}return f4(e,t,i,n,r)}function d4(e,t){if(Array.isArray(e)){let i=0;for(let n=0;n<e.length;n++){const r=e[n]-t[n];i+=r*r}return Math.sqrt(i)}return Math.abs(e-t)}class Vq extends z0{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:i,damping:n,stiffness:r}=this.settings,{_prevValue:s=t,_currValue:o=t}=this;let l=zq(s,o,i,n,r);const h=d4(l,i),A=d4(l,o);h<h4&&A<h4&&(l=i,this.end()),this._prevValue=o,this._currValue=l}}const jq={interpolation:Gq,spring:Vq};class Hq{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,i,n,r){const{transitions:s}=this;if(s.has(t)){const h=s.get(t),{value:A=h.settings.fromValue}=h;i=A,this.remove(t)}if(r=t4(r),!r)return;const o=jq[r.type];if(!o){Yi.error(`unsupported transition type '${r.type}'`)();return}const l=new o(this.timeline);l.start({...r,fromValue:i,toValue:n}),s.set(t,l)}remove(t){const{transitions:i}=this;i.has(t)&&(i.get(t).cancel(),i.delete(t))}update(){const t={};for(const[i,n]of this.transitions)n.update(),t[i]=n.value,n.inProgress||this.remove(i);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function Wq(e){const t=e[Zu];for(const i in t){const n=t[i],{validate:r}=n;if(r&&!r(e[i],n))throw new Error(`Invalid prop ${i}: ${e[i]}`)}}function Jq(e,t){const i=qb({newProps:e,oldProps:t,propTypes:e[Zu],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=Kq(e,t);let r=!1;return n||(r=Qq(e,t)),{dataChanged:n,propsChanged:i,updateTriggersChanged:r,extensionsChanged:Zq(e,t),transitionsChanged:Xq(e,t)}}function Xq(e,t){if(!e.transitions)return!1;const i={},n=e[Zu];let r=!1;for(const s in e.transitions){const o=n[s],l=o&&o.type;(l==="number"||l==="color"||l==="array")&&$b(e[s],t[s],o)&&(i[s]=!0,r=!0)}return r?i:!1}function qb({newProps:e,oldProps:t,ignoreProps:i={},propTypes:n={},triggerName:r="props"}){if(t===e)return!1;if(typeof e!="object"||e===null)return`${r} changed shallowly`;if(typeof t!="object"||t===null)return`${r} changed shallowly`;for(const s of Object.keys(e))if(!(s in i)){if(!(s in t))return`${r}.${s} added`;const o=$b(e[s],t[s],n[s]);if(o)return`${r}.${s} ${o}`}for(const s of Object.keys(t))if(!(s in i)){if(!(s in e))return`${r}.${s} dropped`;if(!Object.hasOwnProperty.call(e,s)){const o=$b(e[s],t[s],n[s]);if(o)return`${r}.${s} ${o}`}}return!1}function $b(e,t,i){let n=i&&i.equal;return n&&!n(e,t,i)||!n&&(n=e&&t&&e.equals,n&&!n.call(e,t))?"changed deeply":!n&&t!==e?"changed shallowly":null}function Kq(e,t){if(t===null)return"oldProps is null, initial diff";let i=!1;const{dataComparator:n,_dataDiff:r}=e;return n?n(e.data,t.data)||(i="Data comparator detected a change"):e.data!==t.data&&(i="A new data container was supplied"),i&&r&&(i=r(e.data,t.data)||i),i}function Qq(e,t){if(t===null)return{all:!0};if("all"in e.updateTriggers&&p4(e,t,"all"))return{all:!0};const i={};let n=!1;for(const r in e.updateTriggers)r!=="all"&&p4(e,t,r)&&(i[r]=!0,n=!0);return n?i:!1}function Zq(e,t){if(t===null)return!0;const i=t.extensions,{extensions:n}=e;if(n===i)return!1;if(!i||!n||n.length!==i.length)return!0;for(let r=0;r<n.length;r++)if(!n[r].equals(i[r]))return!0;return!1}function p4(e,t,i){let n=e.updateTriggers[i];n=n??{};let r=t.updateTriggers[i];return r=r??{},qb({oldProps:r,newProps:n,triggerName:i})}const Yq="count(): argument not an object",qq="count(): argument not a container";function $q(e){if(!e$(e))throw new Error(Yq);if(typeof e.count=="function")return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(t$(e))return Object.keys(e).length;throw new Error(qq)}function t$(e){return e!==null&&typeof e=="object"&&e.constructor===Object}function e$(e){return e!==null&&typeof e=="object"}function A4(e,t){if(!t)return e;const i={...e,...t};if("defines"in t&&(i.defines={...e.defines,...t.defines}),"modules"in t&&(i.modules=(e.modules||[]).concat(t.modules),t.modules.some(n=>n.name==="project64"))){const n=i.modules.findIndex(r=>r.name==="project32");n>=0&&i.modules.splice(n,1)}if("inject"in t)if(!e.inject)i.inject=t.inject;else{const n={...e.inject};for(const r in t.inject)n[r]=(n[r]||"")+t.inject[r];i.inject=n}return i}const i$={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},t2={};function n$(e,t,i,n){if(i instanceof uo)return i;i.constructor&&i.constructor.name!=="Object"&&(i={data:i});let r=null;i.compressed&&(r={minFilter:"linear",mipmapFilter:i.data.length>1?"nearest":"linear"});const s=t.createTexture({...i,sampler:{...i$,...r,...n},mipmaps:!0});return t2[s.id]=e,s}function r$(e,t){!t||!(t instanceof uo)||t2[t.id]===e&&(t.delete(),delete t2[t.id])}const o$={boolean:{validate(e,t){return!0},equal(e,t,i){return!!e==!!t}},number:{validate(e,t){return Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)}},color:{validate(e,t){return t.optional&&!e||e2(e)&&(e.length===3||e.length===4)},equal(e,t,i){return $r(e,t,1)}},accessor:{validate(e,t){const i=Q0(e);return i==="function"||i===Q0(t.value)},equal(e,t,i){return typeof t=="function"?!0:$r(e,t,1)}},array:{validate(e,t){return t.optional&&!e||e2(e)},equal(e,t,i){const{compare:n}=i,r=Number.isInteger(n)?n:n?1:0;return n?$r(e,t,r):e===t}},object:{equal(e,t,i){if(i.ignore)return!0;const{compare:n}=i,r=Number.isInteger(n)?n:n?1:0;return n?$r(e,t,r):e===t}},function:{validate(e,t){return t.optional&&!e||typeof e=="function"},equal(e,t,i){return!i.compare&&i.ignore!==!1||e===t}},data:{transform:(e,t,i)=>{if(!e)return e;const{dataTransform:n}=i.props;return n?n(e):typeof e.shape=="string"&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,i)=>{const n=i.context;return!n||!n.device?null:n$(i.id,n.device,e,{...t.parameters,...i.props.textureParameters})},release:(e,t,i)=>{r$(i.id,e)}}};function s$(e){const t={},i={},n={};for(const[r,s]of Object.entries(e)){const o=s==null?void 0:s.deprecatedFor;if(o)n[r]=Array.isArray(o)?o:[o];else{const l=a$(r,s);t[r]=l,i[r]=l.value}}return{propTypes:t,defaultProps:i,deprecatedProps:n}}function a$(e,t){switch(Q0(t)){case"object":return hg(e,t);case"array":return hg(e,{type:"array",value:t,compare:!1});case"boolean":return hg(e,{type:"boolean",value:t});case"number":return hg(e,{type:"number",value:t});case"function":return hg(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function hg(e,t){return"type"in t?{name:e,...o$[t.type],...t}:"value"in t?{name:e,type:Q0(t.value),...t}:{name:e,type:"object",value:t}}function e2(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function Q0(e){return e2(e)?"array":e===null?"null":typeof e}function l$(e,t){let i;for(let s=t.length-1;s>=0;s--){const o=t[s];"extensions"in o&&(i=o.extensions)}const n=i2(e.constructor,i),r=Object.create(n);r[U0]=e,r[ef]={},r[Yu]={};for(let s=0;s<t.length;++s){const o=t[s];for(const l in o)r[l]=o[l]}return Object.freeze(r),r}const c$="_mergedDefaultProps";function i2(e,t){if(!(e instanceof Z0.constructor))return{};let i=c$;if(t)for(const r of t){const s=r.constructor;s&&(i+=`:${s.extensionName||s.name}`)}return g4(e,i)||(e[i]=u$(e,t||[]))}function u$(e,t){if(!e.prototype)return null;const i=Object.getPrototypeOf(e),n=i2(i),r=g4(e,"defaultProps")||{},s=s$(r),o=Object.assign(Object.create(null),n,s.defaultProps),l=Object.assign(Object.create(null),n==null?void 0:n[Zu],s.propTypes),h=Object.assign(Object.create(null),n==null?void 0:n[Fb],s.deprecatedProps);for(const A of t){const v=i2(A.constructor);v&&(Object.assign(o,v),Object.assign(l,v[Zu]),Object.assign(h,v[Fb]))}return h$(o,e),d$(o,l),f$(o,h),o[Zu]=l,o[Fb]=h,t.length===0&&!n2(e,"_propTypes")&&(e._propTypes=l),o}function h$(e,t){const i=A$(t);Object.defineProperties(e,{id:{writable:!0,value:i}})}function f$(e,t){for(const i in t)Object.defineProperty(e,i,{enumerable:!1,set(n){const r=`${this.id}: ${i}`;for(const s of t[i])n2(this,s)||(this[s]=n);Yi.deprecated(r,t[i].join("/"))()}})}function d$(e,t){const i={},n={};for(const r in t){const s=t[r],{name:o,value:l}=s;s.async&&(i[o]=l,n[o]=p$(o))}e[Hd]=i,e[ef]={},Object.defineProperties(e,n)}function p$(e){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||qP(t)?this[ef][e]=t:this[Yu][e]=t},get(){if(this[Yu]){if(e in this[Yu])return this[Yu][e]||this[Hd][e];if(e in this[ef]){const t=this[U0]&&this[U0].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[Hd][e]}}return this[Hd][e]}}}function n2(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function g4(e,t){return n2(e,t)&&e[t]}function A$(e){const t=e.componentName;return t||Yi.warn(`${e.name}.componentName not specified`)(),t||e.name}let g$=0;class Z0{constructor(...t){this.props=l$(this,t),this.id=this.props.id,this.count=g$++}clone(t){const{props:i}=this,n={};for(const r in i[Hd])r in i[Yu]?n[r]=i[Yu][r]:r in i[ef]&&(n[r]=i[ef][r]);return new this.constructor({...i,...n,...t})}}Z0.componentName="Component",Z0.defaultProps={};const m$=Object.freeze({});class y${constructor(t){this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const i=this.asyncProps[t];i&&i.type&&i.type.release&&i.type.release(i.resolvedValue,i.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||m$}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const i=this.asyncProps[t];return i&&i.resolvedValue}isAsyncPropLoading(t){if(t){const i=this.asyncProps[t];return!!(i&&i.pendingLoadCount>0&&i.pendingLoadCount!==i.resolvedLoadCount)}for(const i in this.asyncProps)if(this.isAsyncPropLoading(i))return!0;return!1}reloadAsyncProp(t,i){this._watchPromise(t,Promise.resolve(i))}setAsyncProps(t){this.component=t[U0]||this.component;const i=t[Yu]||{},n=t[ef]||t,r=t[Hd]||{};for(const s in i){const o=i[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,o),i[s]=this.getAsyncProp(s)}for(const s in n){const o=n[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,o)}}_fetch(t,i){return null}_onResolve(t,i){}_onError(t,i){}_updateAsyncProp(t,i){if(this._didAsyncInputValueChange(t,i)){if(typeof i=="string"&&(i=this._fetch(t,i)),i instanceof Promise){this._watchPromise(t,i);return}if(qP(i)){this._resolveAsyncIterable(t,i);return}this._setPropValue(t,i)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,i){const n=this.asyncProps[t];return i===n.resolvedValue||i===n.lastValue?!1:(n.lastValue=i,!0)}_setPropValue(t,i){this._freezeAsyncOldProps();const n=this.asyncProps[t];n&&(i=this._postProcessValue(n,i),n.resolvedValue=i,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(t,i,n){const r=this.asyncProps[t];r&&n>=r.resolvedLoadCount&&i!==void 0&&(this._freezeAsyncOldProps(),r.resolvedValue=i,r.resolvedLoadCount=n,this.onAsyncPropUpdated(t,i))}_watchPromise(t,i){const n=this.asyncProps[t];if(n){n.pendingLoadCount++;const r=n.pendingLoadCount;i.then(s=>{this.component&&(s=this._postProcessValue(n,s),this._setAsyncPropValue(t,s,r),this._onResolve(t,s))}).catch(s=>{this._onError(t,s)})}}async _resolveAsyncIterable(t,i){if(t!=="data"){this._setPropValue(t,i);return}const n=this.asyncProps[t];if(!n)return;n.pendingLoadCount++;const r=n.pendingLoadCount;let s=[],o=0;for await(const l of i){if(!this.component)return;const{dataTransform:h}=this.component.props;h?s=h(l,s):s=s.concat(l),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(t,s,r)}this._onResolve(t,s)}_postProcessValue(t,i){const n=t.type;return n&&this.component&&(n.release&&n.release(t.resolvedValue,n,this.component),n.transform)?n.transform(i,n,this.component):i}_createAsyncPropData(t,i){if(!this.asyncProps[t]){const n=this.component&&this.component.props[Zu];this.asyncProps[t]={type:n&&n[t],lastValue:null,resolvedValue:i,pendingLoadCount:0,resolvedLoadCount:0}}}}class _$ extends y${constructor({attributeManager:t,layer:i}){super(i),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,i){const n=this.layer,r=n==null?void 0:n.props.fetch;return r?r(i,{propName:t,layer:n}):super._fetch(t,i)}_onResolve(t,i){const n=this.layer;if(n){const r=n.props.onDataLoad;t==="data"&&r&&r(i,{propName:t,layer:n})}}_onError(t,i){const n=this.layer;n&&n.raiseError(i,`loading ${t} of ${this.layer}`)}}const v$="layer.changeFlag",b$="layer.initialize",x$="layer.update",w$="layer.finalize",C$="layer.matched",m4=2**24-1,E$=Object.freeze([]),B$=$A(({oldViewport:e,viewport:t})=>e.equals(t));let yl=new Uint8ClampedArray(0);const T$={data:{type:"data",value:E$,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:i,loaders:n,loadOptions:r,signal:s})=>{const{resourceManager:o}=i.context;r=r||i.getLoadOptions(),n=n||i.props.loaders,s&&(r={...r,fetch:{...r==null?void 0:r.fetch,signal:s}});let l=o.contains(e);return!l&&!r&&(o.add({resourceId:e,data:m1(e,n),persistent:!1}),l=!0),l?o.subscribe({resourceId:e,onChange:h=>{var A;return(A=i.internalState)==null?void 0:A.reloadAsyncProp(t,h)},consumerId:i.id,requestId:t}):m1(e,n,r)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:qi.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,-e*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Io extends Z0{constructor(){super(...arguments),this.internalState=null,this.lifecycle=jd.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(t){is(this.internalState);const i=this.internalState.viewport||this.context.viewport,n=WM(t,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,s,o]=MM(n,i.pixelProjectionMatrix);return t.length===2?[r,s]:[r,s,o]}unproject(t){return is(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,i){is(this.internalState);const n=this.internalState.viewport||this.context.viewport;return OK(t,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...i})}get isComposite(){return!1}get isDrawable(){return!0}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const t=this.state;return t&&(t.models||t.model&&[t.model])||[]}setShaderModuleProps(...t){for(const i of this.getModels())i.shaderInputs.setProps(...t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===qi.DEFAULT||t===qi.LNGLAT||t===qi.CARTESIAN}onHover(t,i){return this.props.onHover&&this.props.onHover(t,i)||!1}onClick(t,i){return this.props.onClick&&this.props.onClick(t,i)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t,i=[]){return i[0]=t+1&255,i[1]=t+1>>8&255,i[2]=t+1>>8>>8&255,i}decodePickingColor(t){is(t instanceof Uint8Array);const[i,n,r]=t;return i+n*256+r*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:$q(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var t;return(t=this.getAttributeManager())==null?void 0:t.getBounds(["positions","instancePositions"])}getShaders(t){t=A4(t,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const i of this.props.extensions)t=A4(t,i.getShaders.call(this,i));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const i=this.getAttributeManager(),{dataChanged:n}=t.changeFlags;if(n&&i)if(Array.isArray(n))for(const r of n)i.invalidateAll(r);else i.invalidateAll();if(i){const{props:r}=t,s=this.internalState.hasPickingBuffer,o=Number.isInteger(r.highlightedObjectIndex)||r.pickable||r.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:l,instancePickingColors:h}=i.attributes,A=l||h;A&&(o&&A.constant&&(A.constant=!1,i.invalidate(A.id)),!A.value&&!o&&(A.constant=!0,A.value=[0,0,0]))}}}finalizeState(t){for(const n of this.getModels())n.destroy();const i=this.getAttributeManager();i&&i.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const i of this.getModels())i.draw(t.renderPass)}getPickingInfo({info:t,mode:i,sourceLayer:n}){const{index:r}=t;return r>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[r]),t}raiseError(t,i){var n,r,s,o;i&&(t=new Error(`${i}: ${t.message}`,{cause:t})),(r=(n=this.props).onError)!=null&&r.call(n,t)||(o=(s=this.context)==null?void 0:s.onError)==null||o.call(s,t,this)}getNeedsRedraw(t={clearRedrawFlags:!1}){return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var t;return((t=this.internalState)==null?void 0:t.uniformTransitions.active)||!1}activateViewport(t){if(!this.internalState)return;const i=this.internalState.viewport;this.internalState.viewport=t,(!i||!B$({oldViewport:i,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(t="all"){const i=this.getAttributeManager();i&&(t==="all"?i.invalidateAll():i.invalidate(t))}updateAttributes(t){let i=!1;for(const n in t)t[n].layoutChanged()&&(i=!0);for(const n of this.getModels())this._setModelAttributes(n,t,i)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const i=this.props,n=this.getNumInstances(),r=this.getStartIndices();t.update({data:i.data,numInstances:n,startIndices:r,props:i,transitions:i.transitions,buffers:i.data.attributes,context:this});const s=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const i=t.update(),n=Object.create(this.props);for(const r in i)Object.defineProperty(n,r,{value:i[r]});return n}return this.props}calculateInstancePickingColors(t,{numInstances:i}){if(t.constant)return;const n=Math.floor(yl.length/4);if(this.internalState.usesPickingColorCache=!0,n<i){i>m4&&Yi.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),yl=zd.allocate(yl,i,{size:4,copy:!0,maxCount:Math.max(i,m4)});const r=Math.floor(yl.length/4),s=[0,0,0];for(let o=n;o<r;o++)this.encodePickingColor(o,s),yl[o*4+0]=s[0],yl[o*4+1]=s[1],yl[o*4+2]=s[2],yl[o*4+3]=0}t.value=yl.subarray(0,i*4)}_setModelAttributes(t,i,n=!1){var r;if(!Object.keys(i).length)return;if(n){const h=this.getAttributeManager();t.setBufferLayout(h.getBufferLayouts(t)),i=h.getAttributes()}const s=((r=t.userData)==null?void 0:r.excludeAttributes)||{},o={},l={};for(const h in i){if(s[h])continue;const A=i[h].getValue();for(const v in A){const C=A[v];C instanceof jr?i[h].settings.isIndexed?t.setIndexBuffer(C):o[v]=C:C&&(l[v]=C)}}t.setAttributes(o),t.setConstantAttributes(l)}disablePickingIndex(t){const i=this.props.data;if(!("attributes"in i)){this._disablePickingIndex(t);return}const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,s=n||r,o=s&&i.attributes&&i.attributes[s.id];if(o&&o.value){const l=o.value,h=this.encodePickingColor(t);for(let A=0;A<i.length;A++){const v=s.getVertexOffset(A);l[v]===h[0]&&l[v+1]===h[1]&&l[v+2]===h[2]&&this._disablePickingIndex(A)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:i,instancePickingColors:n}=this.getAttributeManager().attributes,r=i||n;if(!r)return;const s=r.getVertexOffset(t),o=r.getVertexOffset(t+1);r.buffer.write(new Uint8Array(o-s),s)}restorePickingColors(){const{pickingColors:t,instancePickingColors:i}=this.getAttributeManager().attributes,n=t||i;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==yl.buffer&&(n.value=yl.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){is(!this.internalState),is(Number.isFinite(this.props.coordinateSystem)),As(b$,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new _$({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Yi.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new Hq(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const i of this.props.extensions)i.initializeState.call(this,this.context,i);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){As(C$,this,this===t);const{state:i,internalState:n}=t;this!==t&&(this.internalState=n,this.state=i,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(As(x$,this,t),!t)return;const i=this.props,n=this.context,r=this.internalState,s=n.viewport,o=this._updateUniformTransition();r.propsInTransition=o,n.viewport=r.viewport||s,this.props=o;try{const l=this._getUpdateParams(),h=this.getModels();if(n.device)this.updateState(l);else try{this.updateState(l)}catch{}for(const v of this.props.extensions)v.updateState.call(this,l,v);this.setNeedsRedraw(),this._updateAttributes();const A=this.getModels()[0]!==h[0];this._postUpdate(l,A)}finally{n.viewport=s,this.props=i,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){As(w$,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer({renderPass:t,shaderModuleProps:i=null,uniforms:n={},parameters:r={}}){this._updateAttributeTransition();const s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;try{i&&this.setShaderModuleProps(i);const{getPolygonOffset:l}=this.props,h=l&&l(n)||[0,0];o.device instanceof $d&&o.device.setParametersWebGL({polygonOffset:h});for(const A of this.getModels())A.device.type==="webgpu"?A.setParameters({...A.parameters,...r}):A.setParameters(r);if(o.device instanceof $d)o.device.withParametersWebGL(r,()=>{const A={renderPass:t,shaderModuleProps:i,uniforms:n,parameters:r,context:o};for(const v of this.props.extensions)v.draw.call(this,A,v);this.draw(A)});else{const A={renderPass:t,shaderModuleProps:i,uniforms:n,parameters:r,context:o};for(const v of this.props.extensions)v.draw.call(this,A,v);this.draw(A)}}finally{this.props=s}}getChangeFlags(){var t;return(t=this.internalState)==null?void 0:t.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:i}=this.internalState;for(const r in t)if(t[r]){let s=!1;switch(r){case"dataChanged":const o=t[r],l=i[r];o&&Array.isArray(l)&&(i.dataChanged=Array.isArray(o)?l.concat(o):o,s=!0);default:i[r]||(i[r]=t[r],s=!0)}s&&As(v$,this,r,t)}const n=!!(i.dataChanged||i.updateTriggersChanged||i.propsChanged||i.extensionsChanged);i.propsOrDataChanged=n,i.somethingChanged=n||i.viewportChanged||i.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,i){var n;const r=Jq(t,i);if(r.updateTriggersChanged)for(const s in r.updateTriggersChanged)r.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(r.transitionsChanged)for(const s in r.transitionsChanged)this.internalState.uniformTransitions.add(s,i[s],t[s],(n=t.transitions)==null?void 0:n[s]);return this.setChangeFlags(r)}validateProps(){Wq(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const i={highlightedObjectColor:t.picked?t.color:null},{highlightColor:n}=this.props;t.picked&&typeof n=="function"&&(i.highlightColor=n(t)),this.setShaderModuleProps({picking:i}),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new K0(t.device,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,i){const{props:n,oldProps:r}=t,s=this.state.model;s!=null&&s.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:l,highlightColor:h}=n;if(i||r.autoHighlight!==o||r.highlightedObjectIndex!==l||r.highlightColor!==h){const A={};Array.isArray(h)&&(A.highlightColor=h),(i||r.autoHighlight!==o||l!==r.highlightedObjectIndex)&&(A.highlightedObjectColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setShaderModuleProps({picking:A})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let i=!1;i=i||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),r=n?n.getNeedsRedraw(t):!1;if(i=i||r,i)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,i}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Io.defaultProps=T$,Io.layerName="Layer";const S$="compositeLayer.renderLayers";class Mo extends Io{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){const{object:i}=t;return i&&i.__source&&i.__source.parent&&i.__source.parent.id===this.id&&(t.object=i.__source.object,t.index=i.__source.index),t}filterSubLayer(t){return!0}shouldRenderSubLayer(t,i){return i&&i.length}getSubLayerClass(t,i){const{_subLayerProps:n}=this.props;return n&&n[t]&&n[t].type||i}getSubLayerRow(t,i,n){return t.__source={parent:this,object:i,index:n},t}getSubLayerAccessor(t){if(typeof t=="function"){const i={index:-1,data:this.props.data,target:[]};return(n,r)=>n&&n.__source?(i.index=n.__source.index,t(n.__source.object,i)):t(n,r)}return t}getSubLayerProps(t={}){var i;const{opacity:n,pickable:r,visible:s,parameters:o,getPolygonOffset:l,highlightedObjectIndex:h,autoHighlight:A,highlightColor:v,coordinateSystem:C,coordinateOrigin:S,wrapLongitude:L,positionFormat:N,modelMatrix:G,extensions:W,fetch:j,operation:q,_subLayerProps:Z}=this.props,K={id:"",updateTriggers:{},opacity:n,pickable:r,visible:s,parameters:o,getPolygonOffset:l,highlightedObjectIndex:h,autoHighlight:A,highlightColor:v,coordinateSystem:C,coordinateOrigin:S,wrapLongitude:L,positionFormat:N,modelMatrix:G,extensions:W,fetch:j,operation:q},ft=Z&&t.id&&Z[t.id],rt=ft&&ft.updateTriggers,Lt=t.id||"sublayer";if(ft){const Vt=this.props[Zu],At=t.type?t.type._propTypes:{};for(const at in ft){const kt=At[at]||Vt[at];kt&&kt.type==="accessor"&&(ft[at]=this.getSubLayerAccessor(ft[at]))}}Object.assign(K,t,ft),K.id=`${this.props.id}-${Lt}`,K.updateTriggers={all:(i=this.props.updateTriggers)==null?void 0:i.all,...t.updateTriggers,...rt};for(const Vt of W){const At=Vt.getSubLayerProps.call(this,Vt);At&&Object.assign(K,At,{updateTriggers:Object.assign(K.updateTriggers,At.updateTriggers)})}return K}_updateAutoHighlight(t){for(const i of this.getSubLayers())i.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,i){let n=this.internalState.subLayers;const r=!n||this.needsUpdate();if(r){const s=this.renderLayers();n=G0(s,Boolean),this.internalState.subLayers=n}As(S$,this,r,n);for(const s of n)s.parent=this}}Mo.layerName="CompositeLayer";const Y0=Math.PI/180,y4=180/Math.PI,q0=6370972,tp=256;function I$(){const e=tp/q0,t=Math.PI/180*tp;return{unitsPerMeter:[e,e,e],unitsPerMeter2:[0,0,0],metersPerUnit:[1/e,1/e,1/e],unitsPerDegree:[t,t,e],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,1/e]}}class M$ extends hu{constructor(t={}){const{longitude:i=0,zoom:n=0,nearZMultiplier:r=.5,farZMultiplier:s=1,resolution:o=10}=t;let{latitude:l=0,height:h,altitude:A=1.5,fovy:v}=t;l=Math.max(Math.min(l,Cb),-85.051129),h=h||1,v?A=Tb(v):v=tg(A);const C=1/Math.PI/Math.cos(l*Math.PI/180),S=Math.pow(2,n)*C,L=t.nearZ??r,N=t.farZ??(A+tp*2*S/h)*s,G=new mn().lookAt({eye:[0,-A,0],up:[0,0,1]});G.rotateX(l*Y0),G.rotateZ(-i*Y0),G.scale(S/h),super({...t,height:h,viewMatrix:G,longitude:i,latitude:l,zoom:n,distanceScales:I$(),fovy:v,focalDistance:A,near:L,far:N}),this.scale=S,this.latitude=l,this.longitude=i,this.resolution=o}get projectionMode(){return da.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(t={}){const i={targetZ:t.z||0},n=this.unproject([0,this.height/2],i),r=this.unproject([this.width/2,0],i),s=this.unproject([this.width,this.height/2],i),o=this.unproject([this.width/2,this.height],i);return s[0]<this.longitude&&(s[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],s[0],r[0],o[0]),Math.min(n[1],s[1],r[1],o[1]),Math.max(n[0],s[0],r[0],o[0]),Math.max(n[1],s[1],r[1],o[1])]}unproject(t,{topLeft:i=!0,targetZ:n}={}){const[r,s,o]=t,l=i?s:this.height-s,{pixelUnprojectionMatrix:h}=this;let A;if(Number.isFinite(o))A=r2(h,[r,l,o,1]);else{const L=r2(h,[r,l,-1,1]),N=r2(h,[r,l,1,1]),G=((n||0)/q0+1)*tp,W=ib(PI([],L,N)),j=ib(L),q=ib(N),Z=4*((4*j*q-(W-j-q)**2)/16)/W,K=Math.sqrt(j-Z),ft=Math.sqrt(Math.max(0,G*G-Z)),rt=(K-ft)/Math.sqrt(W);A=ZH([],L,N,rt)}const[v,C,S]=this.unprojectPosition(A);return Number.isFinite(o)?[v,C,S]:Number.isFinite(n)?[v,C,n]:[v,C]}projectPosition(t){const[i,n,r=0]=t,s=i*Y0,o=n*Y0,l=Math.cos(o),h=(r/q0+1)*tp;return[Math.sin(s)*l*h,-Math.cos(s)*l*h,Math.sin(o)*h]}unprojectPosition(t){const[i,n,r]=t,s=RI(t),o=Math.asin(r/s),l=Math.atan2(i,-n)*y4,h=o*y4,A=(s/tp-1)*q0;return[l,h,A]}projectFlat(t){return t}unprojectFlat(t){return t}panByPosition(t,i){const n=this.unproject(i);return{longitude:t[0]-n[0]+this.longitude,latitude:t[1]-n[1]+this.latitude}}}function r2(e,t){const i=kd([],t,e);return ab(i,i,1/i[3]),i}class $0{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(t){t&&(this.opts=t)}equals(t){return this===t?!0:this.constructor===t.constructor&&$r(this.opts,t.opts,1)}getShaders(t){return null}getSubLayerProps(t){const{defaultProps:i}=t.constructor,n={updateTriggers:{}};for(const r in i)if(r in this.props){const s=i[r],o=this.props[r];n[r]=o,s&&s.type==="accessor"&&(n.updateTriggers[r]=this.props.updateTriggers[r],typeof o=="function"&&(n[r]=this.getSubLayerAccessor(o)))}return n}initializeState(t,i){}updateState(t,i){}onNeedsRedraw(t){}getNeedsPickingBuffer(t){return!1}draw(t,i){}finalizeState(t,i){}}$0.defaultProps={},$0.extensionName="LayerExtension";class _4{constructor(t){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:i={}}=t;this.typedArrayManager=zd,this.attributes={},this._attributeDefs=i,this.opts=t,this.updateGeometry(t)}updateGeometry(t){Object.assign(this.opts,t);const{data:i,buffers:n={},getGeometry:r,geometryBuffer:s,positionFormat:o,dataChanged:l,normalize:h=!0}=this.opts;if(this.data=i,this.getGeometry=r,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=n,this.normalize=h,s&&(is(i.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),h||(n.vertexPositions=s)),this.geometryBuffer=n.vertexPositions,Array.isArray(l))for(const A of l)this._rebuildGeometry(A);else this._rebuildGeometry()}updatePartialGeometry({startRow:t,endRow:i}){this._rebuildGeometry({startRow:t,endRow:i})}getGeometryFromBuffer(t){const i=t.value||t;return ArrayBuffer.isView(i)?$P(i,{size:this.positionSize,offset:t.offset,stride:t.stride,startIndices:this.data.startIndices}):null}_allocate(t,i){const{attributes:n,buffers:r,_attributeDefs:s,typedArrayManager:o}=this;for(const l in s)if(l in r)o.release(n[l]),n[l]=null;else{const h=s[l];h.copy=i,n[l]=o.allocate(n[l],t,h)}}_forEachGeometry(t,i,n){const{data:r,getGeometry:s}=this,{iterable:o,objectInfo:l}=lc(r,i,n);for(const h of o){l.index++;const A=s?s(h,l):null;t(A,l.index)}}_rebuildGeometry(t){if(!this.data)return;let{indexStarts:i,vertexStarts:n,instanceCount:r}=this;const{data:s,geometryBuffer:o}=this,{startRow:l=0,endRow:h=1/0}=t||{},A={};if(t||(i=[0],n=[0]),this.normalize||!o)this._forEachGeometry((C,S)=>{const L=C&&this.normalizeGeometry(C);A[S]=L,n[S+1]=n[S]+(L?this.getGeometrySize(L):0)},l,h),r=n[n.length-1];else if(n=s.startIndices,r=n[s.length]||0,ArrayBuffer.isView(o))r=r||o.length/this.positionSize;else if(o instanceof jr){const C=this.positionSize*4;r=r||o.byteLength/C}else if(o.buffer){const C=o.stride||this.positionSize*4;r=r||o.buffer.byteLength/C}else if(o.value){const C=o.value,S=o.stride/C.BYTES_PER_ELEMENT||this.positionSize;r=r||C.length/S}this._allocate(r,!!t),this.indexStarts=i,this.vertexStarts=n,this.instanceCount=r;const v={};this._forEachGeometry((C,S)=>{const L=A[S]||C;v.vertexStart=n[S],v.indexStart=i[S];const N=S<n.length-1?n[S+1]:r;v.geometrySize=N-n[S],v.geometryIndex=S,this.updateGeometryAttributes(L,v)},l,h),this.vertexCount=i[i.length-1]}}const P$=typeof window<"u"?Ie.useLayoutEffect:Ie.useEffect;function ty(e,t){for(;e;){if(e===t)return!0;e=Object.getPrototypeOf(e)}return!1}const R$={position:"absolute",zIndex:-1};function v4(e,t){if(typeof e=="function")return e(t);if(Array.isArray(e))return e.map(i=>v4(i,t));if(ey(e)){if(D$(e))return t.style=R$,Ie.cloneElement(e,t);if(O$(e))return Ie.cloneElement(e,t)}return e}function ey(e){return e&&typeof e=="object"&&"type"in e||!1}function D$(e){var t;return(t=e.props)==null?void 0:t.mapStyle}function O$(e){const t=e.type;return t&&t.deckGLViewProps}function o2(e){if(typeof e=="function")return Ie.createElement(Wd,{},e);if(Array.isArray(e))return e.map(o2);if(ey(e)){if(e.type===Ie.Fragment)return o2(e.props.children);if(ty(e.type,Wd))return e}return e}function L$({children:e,layers:t=[],views:i=null}){const n=[],r=[],s={};return Ie.Children.forEach(o2(e),o=>{if(ey(o)){const l=o.type;if(ty(l,Io)){const h=F$(l,o.props);r.push(h)}else n.push(o);if(ty(l,Wd)&&l!==Wd&&o.props.id){const h=new l(o.props);s[h.id]=h}}else o&&n.push(o)}),Object.keys(s).length>0&&(Array.isArray(i)?i.forEach(o=>{s[o.id]=o}):i&&(s[i.id]=i),i=Object.values(s)),t=r.length>0?[...r,...t]:t,{layers:t,children:n,views:i}}function F$(e,t){const i={},n=e.defaultProps||{};for(const r in t)n[r]!==t[r]&&(i[r]=t[r]);return new e(i)}const k$=Ie.createContext();function N$({children:e,deck:t,ContextProvider:i=k$.Provider}){const{viewManager:n}=t||{};if(!n||!n.views.length)return[];const r={},s=n.views[0].id;for(const o of e){let l=s,h=o;ey(o)&&ty(o.type,Wd)&&(l=o.props.id||s,h=o.props.children);const A=n.getViewport(l),v=n.getViewState(l);if(A){v.padding=A.padding;const{x:C,y:S,width:L,height:N}=A;h=v4(h,{x:C,y:S,width:L,height:N,viewport:A,viewState:v}),r[l]||(r[l]={viewport:A,children:[]}),r[l].children.push(h)}}return Object.keys(r).map(o=>{const{viewport:l,children:h}=r[o],{x:A,y:v,width:C,height:S}=l,L={position:"absolute",left:A,top:v,width:C,height:S},N=`view-${o}`,G=Ie.createElement("div",{key:N,id:N,style:L},...h),W={deck:t,viewport:l,container:t.canvas.offsetParent,eventManager:t.eventManager,onViewStateChange:q=>{q.viewId=o,t._onViewStateChange(q)},widgets:[]},j=`view-${o}-context`;return Ie.createElement(i,{key:j,value:W},G)})}const U$={mixBlendMode:null};function G$({width:e,height:t,style:i}){const n={position:"absolute",zIndex:0,left:0,top:0,width:e,height:t},r={left:0,top:0};if(i)for(const s in i)s in U$?r[s]=i[s]:n[s]=i[s];return{containerStyle:n,canvasStyle:r}}function z$(e){return{get deck(){return e.deck},pickObject:t=>e.deck.pickObject(t),pickMultipleObjects:t=>e.deck.pickMultipleObjects(t),pickObjects:t=>e.deck.pickObjects(t)}}function b4(e){e.redrawReason&&(e.deck._drawLayers(e.redrawReason),e.redrawReason=null)}function V$(e,t,i){var n,r,s;const o=new t({...i,_customRender:((s=(r=(n=i.deviceProps)==null?void 0:n.adapters)==null?void 0:r[0])==null?void 0:s.type)==="webgpu"?void 0:l=>{e.redrawReason=l;const h=o.getViewports();e.lastRenderedViewports!==h?e.forceUpdate():b4(e)}});return o}function j$(e,t){const[i,n]=Ie.useState(0),r=Ie.useRef({control:null,version:i,forceUpdate:()=>n(K=>K+1)}).current,s=Ie.useRef(null),o=Ie.useRef(null),l=Ie.useMemo(()=>L$(e),[e.layers,e.views,e.children]);let h=!0;const A=K=>{var ft;return h&&e.viewState?(r.viewStateUpdateRequested=K,null):(r.viewStateUpdateRequested=null,(ft=e.onViewStateChange)==null?void 0:ft.call(e,K))},v=K=>{var ft;h?r.interactionStateUpdateRequested=K:(r.interactionStateUpdateRequested=null,(ft=e.onInteractionStateChange)==null||ft.call(e,K))},C=Ie.useMemo(()=>{const K={widgets:[],...e,style:null,width:"100%",height:"100%",parent:s.current,canvas:o.current,layers:l.layers,views:l.views,onViewStateChange:A,onInteractionStateChange:v};return delete K._customRender,r.deck&&r.deck.setProps(K),K},[e]);Ie.useEffect(()=>{const K=e.Deck||Qb;return r.deck=V$(r,K,{...C,parent:s.current,canvas:o.current}),()=>{var ft;return(ft=r.deck)==null?void 0:ft.finalize()}},[]),P$(()=>{b4(r);const{viewStateUpdateRequested:K,interactionStateUpdateRequested:ft}=r;K&&A(K),ft&&v(ft)}),Ie.useImperativeHandle(t,()=>z$(r),[]);const S=r.deck&&r.deck.isInitialized?r.deck.getViewports():void 0,{ContextProvider:L,width:N="100%",height:G="100%",id:W,style:j}=e,{containerStyle:q,canvasStyle:Z}=Ie.useMemo(()=>G$({width:N,height:G,style:j}),[N,G,j]);if(!r.viewStateUpdateRequested&&r.lastRenderedViewports===S||r.version!==i){r.lastRenderedViewports=S,r.version=i;const K=N$({children:l.children,deck:r.deck,ContextProvider:L}),ft=Ie.createElement("canvas",{key:"canvas",id:W||"deckgl-overlay",ref:o,style:Z});r.control=Ie.createElement("div",{id:`${W||"deckgl"}-wrapper`,ref:s,style:q},[ft,K])}return h=!1,r.control}const H$=Ie.forwardRef(j$);var ys=1e-6,ep=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function W$(){var e=new ep(4);return ep!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function J$(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function X$(e,t,i){var n=t[0],r=t[1],s=t[2],o=t[3];return e[0]=i[0]*n+i[4]*r+i[8]*s+i[12]*o,e[1]=i[1]*n+i[5]*r+i[9]*s+i[13]*o,e[2]=i[2]*n+i[6]*r+i[10]*s+i[14]*o,e[3]=i[3]*n+i[7]*r+i[11]*s+i[15]*o,e}(function(){var e=W$();return function(t,i,n,r,s,o){var l,h;for(i||(i=4),n||(n=0),r?h=Math.min(r*i+n,t.length):h=t.length,l=n;l<h;l+=i)e[0]=t[l],e[1]=t[l+1],e[2]=t[l+2],e[3]=t[l+3],s(e,e,o),t[l]=e[0],t[l+1]=e[1],t[l+2]=e[2],t[l+3]=e[3];return t}})();function iy(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ip(e,t){const i=X$([],t,e);return J$(i,i,1/i[3]),i}function x4(e,t){const i=e%t;return i<0?t+i:i}function K$(e,t,i){return i*t+(1-i)*e}function s2(e,t,i){return e<t?t:e>i?i:e}function Q$(e){return Math.log(e)*Math.LOG2E}const a2=Math.log2||Q$;function Z$(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],l=t[5],h=t[6],A=t[7],v=t[8],C=t[9],S=t[10],L=t[11],N=t[12],G=t[13],W=t[14],j=t[15],q=i*l-n*o,Z=i*h-r*o,K=i*A-s*o,ft=n*h-r*l,rt=n*A-s*l,Lt=r*A-s*h,Vt=v*G-C*N,At=v*W-S*N,at=v*j-L*N,kt=C*W-S*G,X=C*j-L*G,ht=S*j-L*W,Mt=q*ht-Z*X+K*kt+ft*at-rt*At+Lt*Vt;return Mt?(Mt=1/Mt,e[0]=(l*ht-h*X+A*kt)*Mt,e[1]=(r*X-n*ht-s*kt)*Mt,e[2]=(G*Lt-W*rt+j*ft)*Mt,e[3]=(S*rt-C*Lt-L*ft)*Mt,e[4]=(h*at-o*ht-A*At)*Mt,e[5]=(i*ht-r*at+s*At)*Mt,e[6]=(W*K-N*Lt-j*Z)*Mt,e[7]=(v*Lt-S*K+L*Z)*Mt,e[8]=(o*X-l*at+A*Vt)*Mt,e[9]=(n*at-i*X-s*Vt)*Mt,e[10]=(N*rt-G*K+j*q)*Mt,e[11]=(C*K-v*rt-L*q)*Mt,e[12]=(l*At-o*kt-h*Vt)*Mt,e[13]=(i*kt-n*At+r*Vt)*Mt,e[14]=(G*Z-N*ft-W*q)*Mt,e[15]=(v*ft-C*Z+S*q)*Mt,e):null}function l2(e,t,i){var n=t[0],r=t[1],s=t[2],o=t[3],l=t[4],h=t[5],A=t[6],v=t[7],C=t[8],S=t[9],L=t[10],N=t[11],G=t[12],W=t[13],j=t[14],q=t[15],Z=i[0],K=i[1],ft=i[2],rt=i[3];return e[0]=Z*n+K*l+ft*C+rt*G,e[1]=Z*r+K*h+ft*S+rt*W,e[2]=Z*s+K*A+ft*L+rt*j,e[3]=Z*o+K*v+ft*N+rt*q,Z=i[4],K=i[5],ft=i[6],rt=i[7],e[4]=Z*n+K*l+ft*C+rt*G,e[5]=Z*r+K*h+ft*S+rt*W,e[6]=Z*s+K*A+ft*L+rt*j,e[7]=Z*o+K*v+ft*N+rt*q,Z=i[8],K=i[9],ft=i[10],rt=i[11],e[8]=Z*n+K*l+ft*C+rt*G,e[9]=Z*r+K*h+ft*S+rt*W,e[10]=Z*s+K*A+ft*L+rt*j,e[11]=Z*o+K*v+ft*N+rt*q,Z=i[12],K=i[13],ft=i[14],rt=i[15],e[12]=Z*n+K*l+ft*C+rt*G,e[13]=Z*r+K*h+ft*S+rt*W,e[14]=Z*s+K*A+ft*L+rt*j,e[15]=Z*o+K*v+ft*N+rt*q,e}function c2(e,t,i){var n=i[0],r=i[1],s=i[2],o,l,h,A,v,C,S,L,N,G,W,j;return t===e?(e[12]=t[0]*n+t[4]*r+t[8]*s+t[12],e[13]=t[1]*n+t[5]*r+t[9]*s+t[13],e[14]=t[2]*n+t[6]*r+t[10]*s+t[14],e[15]=t[3]*n+t[7]*r+t[11]*s+t[15]):(o=t[0],l=t[1],h=t[2],A=t[3],v=t[4],C=t[5],S=t[6],L=t[7],N=t[8],G=t[9],W=t[10],j=t[11],e[0]=o,e[1]=l,e[2]=h,e[3]=A,e[4]=v,e[5]=C,e[6]=S,e[7]=L,e[8]=N,e[9]=G,e[10]=W,e[11]=j,e[12]=o*n+v*r+N*s+t[12],e[13]=l*n+C*r+G*s+t[13],e[14]=h*n+S*r+W*s+t[14],e[15]=A*n+L*r+j*s+t[15]),e}function w4(e,t,i){var n=i[0],r=i[1],s=i[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Y$(e,t,i){var n=Math.sin(i),r=Math.cos(i),s=t[4],o=t[5],l=t[6],h=t[7],A=t[8],v=t[9],C=t[10],S=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*r+A*n,e[5]=o*r+v*n,e[6]=l*r+C*n,e[7]=h*r+S*n,e[8]=A*r-s*n,e[9]=v*r-o*n,e[10]=C*r-l*n,e[11]=S*r-h*n,e}function q$(e,t,i){var n=Math.sin(i),r=Math.cos(i),s=t[0],o=t[1],l=t[2],h=t[3],A=t[4],v=t[5],C=t[6],S=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r+A*n,e[1]=o*r+v*n,e[2]=l*r+C*n,e[3]=h*r+S*n,e[4]=A*r-s*n,e[5]=v*r-o*n,e[6]=C*r-l*n,e[7]=S*r-h*n,e}function $$(e,t,i,n,r){var s=1/Math.tan(t/2),o;return e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==1/0?(o=1/(n-r),e[10]=(r+n)*o,e[14]=2*r*n*o):(e[10]=-1,e[14]=-2*n),e}var ttt=$$;function C4(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],l=e[5],h=e[6],A=e[7],v=e[8],C=e[9],S=e[10],L=e[11],N=e[12],G=e[13],W=e[14],j=e[15],q=t[0],Z=t[1],K=t[2],ft=t[3],rt=t[4],Lt=t[5],Vt=t[6],At=t[7],at=t[8],kt=t[9],X=t[10],ht=t[11],Mt=t[12],pe=t[13],Ct=t[14],Dt=t[15];return Math.abs(i-q)<=ys*Math.max(1,Math.abs(i),Math.abs(q))&&Math.abs(n-Z)<=ys*Math.max(1,Math.abs(n),Math.abs(Z))&&Math.abs(r-K)<=ys*Math.max(1,Math.abs(r),Math.abs(K))&&Math.abs(s-ft)<=ys*Math.max(1,Math.abs(s),Math.abs(ft))&&Math.abs(o-rt)<=ys*Math.max(1,Math.abs(o),Math.abs(rt))&&Math.abs(l-Lt)<=ys*Math.max(1,Math.abs(l),Math.abs(Lt))&&Math.abs(h-Vt)<=ys*Math.max(1,Math.abs(h),Math.abs(Vt))&&Math.abs(A-At)<=ys*Math.max(1,Math.abs(A),Math.abs(At))&&Math.abs(v-at)<=ys*Math.max(1,Math.abs(v),Math.abs(at))&&Math.abs(C-kt)<=ys*Math.max(1,Math.abs(C),Math.abs(kt))&&Math.abs(S-X)<=ys*Math.max(1,Math.abs(S),Math.abs(X))&&Math.abs(L-ht)<=ys*Math.max(1,Math.abs(L),Math.abs(ht))&&Math.abs(N-Mt)<=ys*Math.max(1,Math.abs(N),Math.abs(Mt))&&Math.abs(G-pe)<=ys*Math.max(1,Math.abs(G),Math.abs(pe))&&Math.abs(W-Ct)<=ys*Math.max(1,Math.abs(W),Math.abs(Ct))&&Math.abs(j-Dt)<=ys*Math.max(1,Math.abs(j),Math.abs(Dt))}function ett(){var e=new ep(2);return ep!=Float32Array&&(e[0]=0,e[1]=0),e}function u2(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function itt(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function ntt(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e}function rtt(e){var t=e[0],i=e[1];return Math.hypot(t,i)}function ott(e,t){return e[0]=-t[0],e[1]=-t[1],e}function E4(e,t,i,n){var r=t[0],s=t[1];return e[0]=r+n*(i[0]-r),e[1]=s+n*(i[1]-s),e}var stt=itt;(function(){var e=ett();return function(t,i,n,r,s,o){var l,h;for(i||(i=2),n||(n=0),r?h=Math.min(r*i+n,t.length):h=t.length,l=n;l<h;l+=i)e[0]=t[l],e[1]=t[l+1],s(e,e,o),t[l]=e[0],t[l+1]=e[1];return t}})();function att(){var e=new ep(3);return ep!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function ltt(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function ctt(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function utt(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}var htt=ctt;(function(){var e=att();return function(t,i,n,r,s,o){var l,h;for(i||(i=3),n||(n=0),r?h=Math.min(r*i+n,t.length):h=t.length,l=n;l<h;l+=i)e[0]=t[l],e[1]=t[l+1],e[2]=t[l+2],s(e,e,o),t[l]=e[0],t[l+1]=e[1],t[l+2]=e[2];return t}})();function ih(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const _l=Math.PI,B4=_l/4,cc=_l/180,h2=180/_l,fg=512,T4=4003e4,S4=85.051129,I4=1.5;function f2(e){return Math.pow(2,e)}function ftt(e){return a2(e)}function nh(e){const[t,i]=e;ih(Number.isFinite(t)),ih(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");const n=t*cc,r=i*cc,s=fg*(n+_l)/(2*_l),o=fg*(_l+Math.log(Math.tan(B4+r*.5)))/(2*_l);return[s,o]}function rh(e){const[t,i]=e,n=t/fg*(2*_l)-_l,r=2*(Math.atan(Math.exp(i/fg*(2*_l)-_l))-B4);return[n*h2,r*h2]}function dtt(e){const{latitude:t,longitude:i,highPrecision:n=!1}=e;ih(Number.isFinite(t)&&Number.isFinite(i));const r=fg,s=Math.cos(t*cc),o=r/360,l=o/s,h=r/T4/s,A={unitsPerMeter:[h,h,h],metersPerUnit:[1/h,1/h,1/h],unitsPerDegree:[o,l,h],degreesPerUnit:[1/o,1/l,1/h]};if(n){const v=cc*Math.tan(t*cc)/s,C=o*v/2,S=r/T4*v,L=S/l*h;A.unitsPerDegree2=[0,C,S],A.unitsPerMeter2=[L,0,L]}return A}function ptt(e){const{height:t,pitch:i,bearing:n,altitude:r,scale:s,center:o}=e,l=iy();c2(l,l,[0,0,-r]),Y$(l,l,-i*cc),q$(l,l,n*cc);const h=s/t;return w4(l,l,[h,h,h]),o&&c2(l,l,utt([],o)),l}function Att(e){const{width:t,height:i,altitude:n,pitch:r=0,offset:s,center:o,scale:l,nearZMultiplier:h=1,farZMultiplier:A=1}=e;let{fovy:v=ny(I4)}=e;n!==void 0&&(v=ny(n));const C=v*cc,S=r*cc,L=M4(v);let N=L;o&&(N+=o[2]*l/Math.cos(S)/i);const G=C*(.5+(s?s[1]:0)/i),W=Math.sin(G)*N/Math.sin(s2(Math.PI/2-S-G,.01,Math.PI-.01)),j=Math.sin(S)*W+N,q=N*10,Z=Math.min(j*A,q);return{fov:C,aspect:t/i,focalDistance:L,near:h,far:Z}}function gtt(e){const{fov:t,aspect:i,near:n,far:r}=Att(e);return ttt([],t,i,n,r)}function ny(e){return 2*Math.atan(.5/e)*h2}function M4(e){return .5/Math.tan(.5*e*cc)}function mtt(e,t){const[i,n,r=0]=e;return ih(Number.isFinite(i)&&Number.isFinite(n)&&Number.isFinite(r)),ip(t,[i,n,r,1])}function P4(e,t,i=0){const[n,r,s]=e;if(ih(Number.isFinite(n)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(s))return ip(t,[n,r,s,1]);const o=ip(t,[n,r,0,1]),l=ip(t,[n,r,1,1]),h=o[2],A=l[2],v=h===A?0:((i||0)-h)/(A-h);return E4([],o,l,v)}function ytt(e){const{width:t,height:i,bounds:n,minExtent:r=0,maxZoom:s=24,offset:o=[0,0]}=e,[[l,h],[A,v]]=n,C=_tt(e.padding),S=nh([l,s2(v,-85.051129,S4)]),L=nh([A,s2(h,-85.051129,S4)]),N=[Math.max(Math.abs(L[0]-S[0]),r),Math.max(Math.abs(L[1]-S[1]),r)],G=[t-C.left-C.right-Math.abs(o[0])*2,i-C.top-C.bottom-Math.abs(o[1])*2];ih(G[0]>0&&G[1]>0);const W=G[0]/N[0],j=G[1]/N[1],q=(C.right-C.left)/2/W,Z=(C.top-C.bottom)/2/j,K=[(L[0]+S[0])/2+q,(L[1]+S[1])/2+Z],ft=rh(K),rt=Math.min(s,a2(Math.abs(Math.min(W,j))));return ih(Number.isFinite(rt)),{longitude:ft[0],latitude:ft[1],zoom:rt}}function _tt(e=0){return typeof e=="number"?{top:e,bottom:e,left:e,right:e}:(ih(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}const R4=Math.PI/180;function vtt(e,t=0){const{width:i,height:n,unproject:r}=e,s={targetZ:t},o=r([0,n],s),l=r([i,n],s);let h,A;const v=e.fovy?.5*e.fovy*R4:Math.atan(.5/e.altitude),C=(90-e.pitch)*R4;return v>C-.01?(h=D4(e,0,t),A=D4(e,i,t)):(h=r([0,0],s),A=r([i,0],s)),[o,l,A,h]}function D4(e,t,i){const{pixelUnprojectionMatrix:n}=e,r=ip(n,[t,0,1,1]),s=ip(n,[t,e.height,1,1]),o=(i*e.distanceScales.unitsPerMeter[2]-r[2])/(s[2]-r[2]),l=E4([],r,s,o),h=rh(l);return h.push(i),h}class vc{constructor(t={width:1,height:1}){wi(this,"latitude",void 0),wi(this,"longitude",void 0),wi(this,"zoom",void 0),wi(this,"pitch",void 0),wi(this,"bearing",void 0),wi(this,"altitude",void 0),wi(this,"fovy",void 0),wi(this,"meterOffset",void 0),wi(this,"center",void 0),wi(this,"width",void 0),wi(this,"height",void 0),wi(this,"scale",void 0),wi(this,"distanceScales",void 0),wi(this,"viewMatrix",void 0),wi(this,"projectionMatrix",void 0),wi(this,"viewProjectionMatrix",void 0),wi(this,"pixelProjectionMatrix",void 0),wi(this,"pixelUnprojectionMatrix",void 0),wi(this,"equals",j=>j instanceof vc?j.width===this.width&&j.height===this.height&&C4(j.projectionMatrix,this.projectionMatrix)&&C4(j.viewMatrix,this.viewMatrix):!1),wi(this,"project",(j,q={})=>{const{topLeft:Z=!0}=q,K=this.projectPosition(j),ft=mtt(K,this.pixelProjectionMatrix),[rt,Lt]=ft,Vt=Z?Lt:this.height-Lt;return j.length===2?[rt,Vt]:[rt,Vt,ft[2]]}),wi(this,"unproject",(j,q={})=>{const{topLeft:Z=!0,targetZ:K=void 0}=q,[ft,rt,Lt]=j,Vt=Z?rt:this.height-rt,At=K&&K*this.distanceScales.unitsPerMeter[2],at=P4([ft,Vt,Lt],this.pixelUnprojectionMatrix,At),[kt,X,ht]=this.unprojectPosition(at);return Number.isFinite(Lt)?[kt,X,ht]:Number.isFinite(K)?[kt,X,K]:[kt,X]}),wi(this,"projectPosition",j=>{const[q,Z]=nh(j),K=(j[2]||0)*this.distanceScales.unitsPerMeter[2];return[q,Z,K]}),wi(this,"unprojectPosition",j=>{const[q,Z]=rh(j),K=(j[2]||0)*this.distanceScales.metersPerUnit[2];return[q,Z,K]});let{width:i,height:n,altitude:r=null,fovy:s=null}=t;const{latitude:o=0,longitude:l=0,zoom:h=0,pitch:A=0,bearing:v=0,position:C=null,nearZMultiplier:S=.02,farZMultiplier:L=1.01}=t;i=i||1,n=n||1,s===null&&r===null?(r=I4,s=ny(r)):s===null?s=ny(r):r===null&&(r=M4(s));const N=f2(h);r=Math.max(.75,r);const G=dtt({longitude:l,latitude:o}),W=nh([l,o]);W.push(0),C&&ltt(W,W,htt([],C,G.unitsPerMeter)),this.projectionMatrix=gtt({width:i,height:n,scale:N,center:W,pitch:A,fovy:s,nearZMultiplier:S,farZMultiplier:L}),this.viewMatrix=ptt({height:n,scale:N,center:W,pitch:A,bearing:v,altitude:r}),this.width=i,this.height=n,this.scale=N,this.latitude=o,this.longitude=l,this.zoom=h,this.pitch=A,this.bearing=v,this.altitude=r,this.fovy=s,this.center=W,this.meterOffset=C||[0,0,0],this.distanceScales=G,this._initMatrices(),Object.freeze(this)}_initMatrices(){const{width:t,height:i,projectionMatrix:n,viewMatrix:r}=this,s=iy();l2(s,s,n),l2(s,s,r),this.viewProjectionMatrix=s;const o=iy();w4(o,o,[t/2,-i/2,1]),c2(o,o,[1,-1,0]),l2(o,o,s);const l=Z$(iy(),o);if(!l)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=o,this.pixelUnprojectionMatrix=l}projectFlat(t){return nh(t)}unprojectFlat(t){return rh(t)}getMapCenterByLngLatPosition({lngLat:t,pos:i}){const n=P4(i,this.pixelUnprojectionMatrix),r=nh(t),s=u2([],r,ott([],n)),o=u2([],this.center,s);return rh(o)}fitBounds(t,i={}){const{width:n,height:r}=this,{longitude:s,latitude:o,zoom:l}=ytt(Object.assign({width:n,height:r,bounds:t},i));return new vc({width:n,height:r,longitude:s,latitude:o,zoom:l})}getBounds(t){const i=this.getBoundingRegion(t),n=Math.min(...i.map(l=>l[0])),r=Math.max(...i.map(l=>l[0])),s=Math.min(...i.map(l=>l[1])),o=Math.max(...i.map(l=>l[1]));return[[n,s],[r,o]]}getBoundingRegion(t={}){return vtt(this,t.z||0)}getLocationAtPoint({lngLat:t,pos:i}){return this.getMapCenterByLngLatPosition({lngLat:t,pos:i})}}const O4=512;function btt(e){const{width:t,height:i,pitch:n=0}=e;let{longitude:r,latitude:s,zoom:o,bearing:l=0}=e;(r<-180||r>180)&&(r=x4(r+180,360)-180),(l<-180||l>180)&&(l=x4(l+180,360)-180);const h=a2(i/O4);if(o<=h)o=h,s=0;else{const A=i/2/Math.pow(2,o),v=rh([0,A])[1];if(s<v)s=v;else{const C=rh([0,O4-A])[1];s>C&&(s=C)}}return{width:t,height:i,longitude:r,latitude:s,zoom:o,pitch:n,bearing:l}}const L4=.01,xtt=["longitude","latitude","zoom"],F4={curve:1.414,speed:1.2};function wtt(e,t,i,n){const{startZoom:r,startCenterXY:s,uDelta:o,w0:l,u1:h,S:A,rho:v,rho2:C,r0:S}=k4(e,t,n);if(h<L4){const K={};for(const ft of xtt){const rt=e[ft],Lt=t[ft];K[ft]=K$(rt,Lt,i)}return K}const L=i*A,N=Math.cosh(S)/Math.cosh(S+v*L),G=l*((Math.cosh(S)*Math.tanh(S+v*L)-Math.sinh(S))/C)/h,W=1/N,j=r+ftt(W),q=ntt([],o,G);u2(q,q,s);const Z=rh(q);return{longitude:Z[0],latitude:Z[1],zoom:j}}function Ctt(e,t,i){const n={...F4,...i},{screenSpeed:r,speed:s,maxDuration:o}=n,{S:l,rho:h}=k4(e,t,n),A=1e3*l;let v;return Number.isFinite(r)?v=A/(r/h):v=A/s,Number.isFinite(o)&&v>o?0:v}function k4(e,t,i){i=Object.assign({},F4,i);const n=i.curve,r=e.zoom,s=[e.longitude,e.latitude],o=f2(r),l=t.zoom,h=[t.longitude,t.latitude],A=f2(l-r),v=nh(s),C=nh(h),S=stt([],C,v),L=Math.max(e.width,e.height),N=L/A,G=rtt(S)*o,W=Math.max(G,L4),j=n*n,q=(N*N-L*L+j*j*W*W)/(2*L*j*W),Z=(N*N-L*L-j*j*W*W)/(2*N*j*W),K=Math.log(Math.sqrt(q*q+1)-q),ft=Math.log(Math.sqrt(Z*Z+1)-Z),rt=(ft-K)/n;return{startZoom:r,startCenterXY:v,uDelta:S,w0:L,u1:G,S:rt,rho:n,rho2:j,r0:K,r1:ft}}var N4=function(){if(typeof Map<"u")return Map;function e(t,i){var n=-1;return t.some(function(r,s){return r[0]===i?(n=s,!0):!1}),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(i){var n=e(this.__entries__,i),r=this.__entries__[n];return r&&r[1]},t.prototype.set=function(i,n){var r=e(this.__entries__,i);~r?this.__entries__[r][1]=n:this.__entries__.push([i,n])},t.prototype.delete=function(i){var n=this.__entries__,r=e(n,i);~r&&n.splice(r,1)},t.prototype.has=function(i){return!!~e(this.__entries__,i)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(i,n){n===void 0&&(n=null);for(var r=0,s=this.__entries__;r<s.length;r++){var o=s[r];i.call(n,o[1],o[0])}},t}()}(),d2=typeof window<"u"&&typeof document<"u"&&window.document===document,ry=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),Ett=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(ry):function(e){return setTimeout(function(){return e(Date.now())},1e3/60)}}(),Btt=2;function Ttt(e,t){var i=!1,n=!1,r=0;function s(){i&&(i=!1,e()),n&&l()}function o(){Ett(s)}function l(){var h=Date.now();if(i){if(h-r<Btt)return;n=!0}else i=!0,n=!1,setTimeout(o,t);r=h}return l}var Stt=20,Itt=["top","right","bottom","left","width","height","size","weight"],Mtt=typeof MutationObserver<"u",Ptt=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=Ttt(this.refresh.bind(this),Stt)}return e.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},e.prototype.removeObserver=function(t){var i=this.observers_,n=i.indexOf(t);~n&&i.splice(n,1),!i.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){var t=this.updateObservers_();t&&this.refresh()},e.prototype.updateObservers_=function(){var t=this.observers_.filter(function(i){return i.gatherActive(),i.hasActive()});return t.forEach(function(i){return i.broadcastActive()}),t.length>0},e.prototype.connect_=function(){!d2||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),Mtt?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){!d2||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(t){var i=t.propertyName,n=i===void 0?"":i,r=Itt.some(function(s){return!!~n.indexOf(s)});r&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),U4=function(e,t){for(var i=0,n=Object.keys(t);i<n.length;i++){var r=n[i];Object.defineProperty(e,r,{value:t[r],enumerable:!1,writable:!1,configurable:!0})}return e},np=function(e){var t=e&&e.ownerDocument&&e.ownerDocument.defaultView;return t||ry},G4=sy(0,0,0,0);function oy(e){return parseFloat(e)||0}function z4(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return t.reduce(function(n,r){var s=e["border-"+r+"-width"];return n+oy(s)},0)}function Rtt(e){for(var t=["top","right","bottom","left"],i={},n=0,r=t;n<r.length;n++){var s=r[n],o=e["padding-"+s];i[s]=oy(o)}return i}function Dtt(e){var t=e.getBBox();return sy(0,0,t.width,t.height)}function Ott(e){var t=e.clientWidth,i=e.clientHeight;if(!t&&!i)return G4;var n=np(e).getComputedStyle(e),r=Rtt(n),s=r.left+r.right,o=r.top+r.bottom,l=oy(n.width),h=oy(n.height);if(n.boxSizing==="border-box"&&(Math.round(l+s)!==t&&(l-=z4(n,"left","right")+s),Math.round(h+o)!==i&&(h-=z4(n,"top","bottom")+o)),!Ftt(e)){var A=Math.round(l+s)-t,v=Math.round(h+o)-i;Math.abs(A)!==1&&(l-=A),Math.abs(v)!==1&&(h-=v)}return sy(r.left,r.top,l,h)}var Ltt=function(){return typeof SVGGraphicsElement<"u"?function(e){return e instanceof np(e).SVGGraphicsElement}:function(e){return e instanceof np(e).SVGElement&&typeof e.getBBox=="function"}}();function Ftt(e){return e===np(e).document.documentElement}function ktt(e){return d2?Ltt(e)?Dtt(e):Ott(e):G4}function Ntt(e){var t=e.x,i=e.y,n=e.width,r=e.height,s=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,o=Object.create(s.prototype);return U4(o,{x:t,y:i,width:n,height:r,top:i,right:t+n,bottom:r+i,left:t}),o}function sy(e,t,i,n){return{x:e,y:t,width:i,height:n}}var Utt=function(){function e(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=sy(0,0,0,0),this.target=t}return e.prototype.isActive=function(){var t=ktt(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},e}(),Gtt=function(){function e(t,i){var n=Ntt(i);U4(this,{target:t,contentRect:n})}return e}(),ztt=function(){function e(t,i,n){if(this.activeObservations_=[],this.observations_=new N4,typeof t!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=i,this.callbackCtx_=n}return e.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof np(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var i=this.observations_;i.has(t)||(i.set(t,new Utt(t)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof np(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var i=this.observations_;i.has(t)&&(i.delete(t),i.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(i){i.isActive()&&t.activeObservations_.push(i)})},e.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,i=this.activeObservations_.map(function(n){return new Gtt(n.target,n.broadcastRect())});this.callback_.call(t,i,t),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),V4=typeof WeakMap<"u"?new WeakMap:new N4,j4=function(){function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var i=Ptt.getInstance(),n=new ztt(t,i,this);V4.set(this,n)}return e}();["observe","unobserve","disconnect"].forEach(function(e){j4.prototype[e]=function(){var t;return(t=V4.get(this))[e].apply(t,arguments)}});var Vtt=function(){return typeof ry.ResizeObserver<"u"?ry.ResizeObserver:j4}(),qc=typeof document<"u"?document:{};function H4(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function ay(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?H4(Object(i),!0).forEach(function(n){wi(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):H4(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}function W4(e,t){var i;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=jtt(e))||t){i&&(e=i);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,l;return{s:function(){i=e[Symbol.iterator]()},n:function(){var h=i.next();return s=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!s&&i.return!=null&&i.return()}finally{if(o)throw l}}}}function jtt(e,t){if(e){if(typeof e=="string")return J4(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return J4(e,t)}}function J4(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var Htt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function p2(e){if(!e)return null;if(typeof e=="string")return e;e.toJS&&(e=e.toJS());var t={},i=W4(e.layers),n;try{for(i.s();!(n=i.n()).done;){var r=n.value;t[r.id]=r}}catch(o){i.e(o)}finally{i.f()}var s=e.layers.map(function(o){var l=t[o.ref],h=null;if("interactive"in o&&(h=ay({},o),delete h.interactive),l){h=h||ay({},o),delete h.ref;var A=W4(Htt),v;try{for(A.s();!(v=A.n()).done;){var C=v.value;C in l&&(h[C]=l[C])}}catch(S){A.e(S)}finally{A.f()}}return h||o});return ay(ay({},e),{},{layers:s})}function Wtt(){}function Jtt(e){e&&console.error(e.error)}var X4={container:ge.object,gl:ge.object,mapboxApiAccessToken:ge.string,mapboxApiUrl:ge.string,attributionControl:ge.bool,preserveDrawingBuffer:ge.bool,reuseMaps:ge.bool,transformRequest:ge.func,mapOptions:ge.object,mapStyle:ge.oneOfType([ge.string,ge.object]),preventStyleDiffing:ge.bool,visible:ge.bool,asyncRender:ge.bool,onLoad:ge.func,onError:ge.func,width:ge.number,height:ge.number,viewState:ge.object,longitude:ge.number,latitude:ge.number,zoom:ge.number,bearing:ge.number,pitch:ge.number,altitude:ge.number},ly={container:qc.body,mapboxApiAccessToken:Xtt(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",preventStyleDiffing:!1,visible:!0,asyncRender:!1,onLoad:Wtt,onError:Jtt,width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0,altitude:1.5};function Xtt(){var e=null;if(typeof window<"u"&&window.location){var t=window.location.search.match(/access_token=([^&\/]*)/);e=t&&t[1]}return!e&&typeof process<"u"&&(e=e||process.env.MapboxAccessToken||process.env.REACT_APP_MAPBOX_ACCESS_TOKEN),e||"no-token"}function K4(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"component";e.debug&&ge.checkPropTypes(X4,e,"prop",t)}var af=function(){function e(t){var i=this;if(Gu(this,e),wi(this,"props",ly),wi(this,"width",0),wi(this,"height",0),wi(this,"_fireLoadEvent",function(){i.props.onLoad({type:"load",target:i._map})}),wi(this,"_handleError",function(n){i.props.onError(n)}),!t.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=t.mapboxgl,e.initialized||(e.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(t)}return Uu(e,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(t){return this._update(this.props,t),this}},{key:"redraw",value:function(){var t=this._map;t.style&&(t._frame&&(t._frame.cancel(),t._frame=null),t._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(t){this._map=e.savedMap;var i=this._map.getContainer(),n=t.container;for(n.classList.add("mapboxgl-map");i.childNodes.length>0;)n.appendChild(i.childNodes[0]);this._map._container=n,e.savedMap=null,t.mapStyle&&this._map.setStyle(p2(t.mapStyle),{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(t){if(t.reuseMaps&&e.savedMap)this._reuse(t);else{if(t.gl){var i=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=i,t.gl}}var n={container:t.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:p2(t.mapStyle),interactive:!1,trackResize:!1,attributionControl:t.attributionControl,preserveDrawingBuffer:t.preserveDrawingBuffer};t.transformRequest&&(n.transformRequest=t.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},n,t.mapOptions)),this._map.once("load",this._fireLoadEvent),this._map.on("error",this._handleError)}return this}},{key:"_destroy",value:function(){this._map&&(this.props.reuseMaps&&!e.savedMap?(e.savedMap=this._map,this._map.off("load",this._fireLoadEvent),this._map.off("error",this._handleError),this._map.off("styledata",this._fireLoadEvent)):this._map.remove(),this._map=null)}},{key:"_initialize",value:function(t){var i=this;t=Object.assign({},ly,t),K4(t,"Mapbox"),this.mapboxgl.accessToken=t.mapboxApiAccessToken||ly.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=t.mapboxApiUrl,this._create(t);var n=t,r=n.container;Object.defineProperty(r,"offsetWidth",{configurable:!0,get:function(){return i.width}}),Object.defineProperty(r,"clientWidth",{configurable:!0,get:function(){return i.width}}),Object.defineProperty(r,"offsetHeight",{configurable:!0,get:function(){return i.height}}),Object.defineProperty(r,"clientHeight",{configurable:!0,get:function(){return i.height}});var s=this._map.getCanvas();s&&(s.style.outline="none"),this._updateMapViewport({},t),this._updateMapSize({},t),this.props=t}},{key:"_update",value:function(t,i){if(this._map){i=Object.assign({},this.props,i),K4(i,"Mapbox");var n=this._updateMapViewport(t,i),r=this._updateMapSize(t,i);this._updateMapStyle(t,i),!i.asyncRender&&(n||r)&&this.redraw(),this.props=i}}},{key:"_updateMapStyle",value:function(t,i){var n=t.mapStyle!==i.mapStyle;n&&this._map.setStyle(p2(i.mapStyle),{diff:!i.preventStyleDiffing})}},{key:"_updateMapSize",value:function(t,i){var n=t.width!==i.width||t.height!==i.height;return n&&(this.width=i.width,this.height=i.height,this._map.resize()),n}},{key:"_updateMapViewport",value:function(t,i){var n=this._getViewState(t),r=this._getViewState(i),s=r.latitude!==n.latitude||r.longitude!==n.longitude||r.zoom!==n.zoom||r.pitch!==n.pitch||r.bearing!==n.bearing||r.altitude!==n.altitude;return s&&(this._map.jumpTo(this._viewStateToMapboxProps(r)),r.altitude!==n.altitude&&(this._map.transform.altitude=r.altitude)),s}},{key:"_getViewState",value:function(t){var i=t.viewState||t,n=i.longitude,r=i.latitude,s=i.zoom,o=i.pitch,l=o===void 0?0:o,h=i.bearing,A=h===void 0?0:h,v=i.altitude,C=v===void 0?1.5:v;return{longitude:n,latitude:r,zoom:s,pitch:l,bearing:A,altitude:C}}},{key:"_checkStyleSheet",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"0.47.0";if(!(typeof qc>"u"))try{var i=qc.createElement("div");i.className="mapboxgl-map",i.style.display="none",qc.body.appendChild(i);var n=window.getComputedStyle(i).position!=="static";if(!n){var r=qc.createElement("link");r.setAttribute("rel","stylesheet"),r.setAttribute("type","text/css"),r.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(t,"/mapbox-gl.css")),qc.head.appendChild(r)}}catch{}}},{key:"_viewStateToMapboxProps",value:function(t){return{center:[t.longitude,t.latitude],zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}}}]),e}();wi(af,"initialized",!1),wi(af,"propTypes",X4),wi(af,"defaultProps",ly),wi(af,"savedMap",null);var A2={exports:{}},Ktt=A2.exports,Q4;function Qtt(){return Q4||(Q4=1,function(e,t){(function(i,n){e.exports=n()})(Ktt,function(){var i,n,r;function s(o,l){if(!i)i=l;else if(!n)n=l;else{var h="var sharedChunk = {}; ("+i+")(sharedChunk); ("+n+")(sharedChunk);",A={};i(A),r=l(A),typeof window<"u"&&(r.workerUrl=window.URL.createObjectURL(new Blob([h],{type:"text/javascript"})))}}return s(["exports"],function(o){function l(a,u){return a(u={exports:{}},u.exports),u.exports}var h=A;function A(a,u,p,x){this.cx=3*a,this.bx=3*(p-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(x-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=x,this.p2x=p,this.p2y=x}A.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},A.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},A.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},A.prototype.solveCurveX=function(a,u){var p,x,B,I,D;for(u===void 0&&(u=1e-6),B=a,D=0;D<8;D++){if(I=this.sampleCurveX(B)-a,Math.abs(I)<u)return B;var k=this.sampleCurveDerivativeX(B);if(Math.abs(k)<1e-6)break;B-=I/k}if((B=a)<(p=0))return p;if(B>(x=1))return x;for(;p<x;){if(I=this.sampleCurveX(B),Math.abs(I-a)<u)return B;a>I?p=B:x=B,B=.5*(x-p)+p}return B},A.prototype.solve=function(a,u){return this.sampleCurveY(this.solveCurveX(a,u))};var v=C;function C(a,u){this.x=a,this.y=u}C.prototype={clone:function(){return new C(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,u){return this.clone()._rotateAround(a,u)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var u=a.x-this.x,p=a.y-this.y;return u*u+p*p},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,u){return Math.atan2(this.x*u-this.y*a,this.x*a+this.y*u)},_matMult:function(a){var u=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=u,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var u=Math.cos(a),p=Math.sin(a),x=p*this.x+u*this.y;return this.x=u*this.x-p*this.y,this.y=x,this},_rotateAround:function(a,u){var p=Math.cos(a),x=Math.sin(a),B=u.y+x*(this.x-u.x)+p*(this.y-u.y);return this.x=u.x+p*(this.x-u.x)-x*(this.y-u.y),this.y=B,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},C.convert=function(a){return a instanceof C?a:Array.isArray(a)?new C(a[0],a[1]):a};var S=typeof self<"u"?self:{},L=Math.pow(2,53)-1;function N(a,u,p,x){var B=new h(a,u,p,x);return function(I){return B.solve(I)}}var G=N(.25,.1,.25,1);function W(a,u,p){return Math.min(p,Math.max(u,a))}function j(a,u,p){var x=p-u,B=((a-u)%x+x)%x+u;return B===u?p:B}function q(a){for(var u=[],p=arguments.length-1;p-- >0;)u[p]=arguments[p+1];for(var x=0,B=u;x<B.length;x+=1){var I=B[x];for(var D in I)a[D]=I[D]}return a}var Z=1;function K(){return Z++}function ft(){return function a(u){return u?(u^16*Math.random()>>u/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function rt(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Lt(a,u){a.forEach(function(p){u[p]&&(u[p]=u[p].bind(u))})}function Vt(a,u){return a.indexOf(u,a.length-u.length)!==-1}function At(a,u,p){var x={};for(var B in a)x[B]=u.call(p||this,a[B],B,a);return x}function at(a,u,p){var x={};for(var B in a)u.call(p||this,a[B],B,a)&&(x[B]=a[B]);return x}function kt(a){return Array.isArray(a)?a.map(kt):typeof a=="object"&&a?At(a,kt):a}var X={};function ht(a){X[a]||(typeof console<"u"&&console.warn(a),X[a]=!0)}function Mt(a,u,p){return(p.y-a.y)*(u.x-a.x)>(u.y-a.y)*(p.x-a.x)}function pe(a){for(var u=0,p=0,x=a.length,B=x-1,I=void 0,D=void 0;p<x;B=p++)u+=((D=a[B]).x-(I=a[p]).x)*(I.y+D.y);return u}function Ct(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Dt(a){var u={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(x,B,I,D){var k=I||D;return u[B]=!k||k.toLowerCase(),""}),u["max-age"]){var p=parseInt(u["max-age"],10);isNaN(p)?delete u["max-age"]:u["max-age"]=p}return u}var Gt=null;function te(a){if(Gt==null){var u=a.navigator?a.navigator.userAgent:null;Gt=!!a.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Gt}function re(a){try{var u=S[a];return u.setItem("_mapbox_test_",1),u.removeItem("_mapbox_test_"),!0}catch{return!1}}var ae,he,Pe,Se,se=S.performance&&S.performance.now?S.performance.now.bind(S.performance):Date.now.bind(Date),fi=S.requestAnimationFrame||S.mozRequestAnimationFrame||S.webkitRequestAnimationFrame||S.msRequestAnimationFrame,Ze=S.cancelAnimationFrame||S.mozCancelAnimationFrame||S.webkitCancelAnimationFrame||S.msCancelAnimationFrame,Ye={now:se,frame:function(a){var u=fi(a);return{cancel:function(){return Ze(u)}}},getImageData:function(a,u){u===void 0&&(u=0);var p=S.document.createElement("canvas"),x=p.getContext("2d");if(!x)throw new Error("failed to create canvas 2d context");return p.width=a.width,p.height=a.height,x.drawImage(a,0,0,a.width,a.height),x.getImageData(-u,-u,a.width+2*u,a.height+2*u)},resolveURL:function(a){return ae||(ae=S.document.createElement("a")),ae.href=a,ae.href},hardwareConcurrency:S.navigator&&S.navigator.hardwareConcurrency||4,get devicePixelRatio(){return S.devicePixelRatio},get prefersReducedMotion(){return!!S.matchMedia&&(he==null&&(he=S.matchMedia("(prefers-reduced-motion: reduce)")),he.matches)}},ze={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},pi={supported:!1,testSupport:function(a){!sn&&Se&&(Ii?_i(a):Pe=a)}},sn=!1,Ii=!1;function _i(a){var u=a.createTexture();a.bindTexture(a.TEXTURE_2D,u);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Se),a.isContextLost())return;pi.supported=!0}catch{}a.deleteTexture(u),sn=!0}S.document&&((Se=S.document.createElement("img")).onload=function(){Pe&&_i(Pe),Pe=null,Ii=!0},Se.onerror=function(){sn=!0,Pe=null},Se.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Fn="01",Ai=function(a,u){this._transformRequestFn=a,this._customAccessToken=u,this._createSkuToken()};function vi(a){return a.indexOf("mapbox:")===0}Ai.prototype._createSkuToken=function(){var a=function(){for(var u="",p=0;p<10;p++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Fn,u].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt},Ai.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Ai.prototype.transformRequest=function(a,u){return this._transformRequestFn&&this._transformRequestFn(a,u)||{url:a}},Ai.prototype.normalizeStyleURL=function(a,u){if(!vi(a))return a;var p=$n(a);return p.path="/styles/v1"+p.path,this._makeAPIURL(p,this._customAccessToken||u)},Ai.prototype.normalizeGlyphsURL=function(a,u){if(!vi(a))return a;var p=$n(a);return p.path="/fonts/v1"+p.path,this._makeAPIURL(p,this._customAccessToken||u)},Ai.prototype.normalizeSourceURL=function(a,u){if(!vi(a))return a;var p=$n(a);return p.path="/v4/"+p.authority+".json",p.params.push("secure"),this._makeAPIURL(p,this._customAccessToken||u)},Ai.prototype.normalizeSpriteURL=function(a,u,p,x){var B=$n(a);return vi(a)?(B.path="/styles/v1"+B.path+"/sprite"+u+p,this._makeAPIURL(B,this._customAccessToken||x)):(B.path+=""+u+p,gn(B))},Ai.prototype.normalizeTileURL=function(a,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!vi(a))return a;var p=$n(a);p.path=p.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Ye.devicePixelRatio>=2||u===512?"@2x":"")+(pi.supported?".webp":"$1")),p.path=p.path.replace(/^.+\/v4\//,"/"),p.path="/v4"+p.path;var x=this._customAccessToken||function(B){for(var I=0,D=B;I<D.length;I+=1){var k=D[I].match(/^access_token=(.*)$/);if(k)return k[1]}return null}(p.params)||ze.ACCESS_TOKEN;return ze.REQUIRE_ACCESS_TOKEN&&x&&this._skuToken&&p.params.push("sku="+this._skuToken),this._makeAPIURL(p,x)},Ai.prototype.canonicalizeTileURL=function(a,u){var p=$n(a);if(!p.path.match(/(^\/v4\/)/)||!p.path.match(/\.[\w]+$/))return a;var x="mapbox://tiles/";x+=p.path.replace("/v4/","");var B=p.params;return u&&(B=B.filter(function(I){return!I.match(/^access_token=/)})),B.length&&(x+="?"+B.join("&")),x},Ai.prototype.canonicalizeTileset=function(a,u){for(var p=!!u&&vi(u),x=[],B=0,I=a.tiles||[];B<I.length;B+=1){var D=I[B];Ri(D)?x.push(this.canonicalizeTileURL(D,p)):x.push(D)}return x},Ai.prototype._makeAPIURL=function(a,u){var p="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",x=$n(ze.API_URL);if(a.protocol=x.protocol,a.authority=x.authority,a.protocol==="http"){var B=a.params.indexOf("secure");B>=0&&a.params.splice(B,1)}if(x.path!=="/"&&(a.path=""+x.path+a.path),!ze.REQUIRE_ACCESS_TOKEN)return gn(a);if(!(u=u||ze.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+p);if(u[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+p);return a.params=a.params.filter(function(I){return I.indexOf("access_token")===-1}),a.params.push("access_token="+u),gn(a)};var cn=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Ri(a){return cn.test(a)}var ur=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function $n(a){var u=a.match(ur);if(!u)throw new Error("Unable to parse URL object");return{protocol:u[1],authority:u[2],path:u[3]||"/",params:u[4]?u[4].split("&"):[]}}function gn(a){var u=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+u}function rr(a){if(!a)return null;var u=a.split(".");if(!u||u.length!==3)return null;try{return JSON.parse(decodeURIComponent(S.atob(u[1]).split("").map(function(p){return"%"+("00"+p.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch{return null}}var Wn=function(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Wn.prototype.getStorageKey=function(a){var u,p=rr(ze.ACCESS_TOKEN);return u=p&&p.u?S.btoa(encodeURIComponent(p.u).replace(/%([0-9A-F]{2})/g,function(x,B){return String.fromCharCode(+("0x"+B))})):ze.ACCESS_TOKEN||"",a?"mapbox.eventData."+a+":"+u:"mapbox.eventData:"+u},Wn.prototype.fetchEventData=function(){var a=re("localStorage"),u=this.getStorageKey(),p=this.getStorageKey("uuid");if(a)try{var x=S.localStorage.getItem(u);x&&(this.eventData=JSON.parse(x));var B=S.localStorage.getItem(p);B&&(this.anonId=B)}catch{ht("Unable to read from LocalStorage")}},Wn.prototype.saveEventData=function(){var a=re("localStorage"),u=this.getStorageKey(),p=this.getStorageKey("uuid");if(a)try{S.localStorage.setItem(p,this.anonId),Object.keys(this.eventData).length>=1&&S.localStorage.setItem(u,JSON.stringify(this.eventData))}catch{ht("Unable to write to LocalStorage")}},Wn.prototype.processRequests=function(a){},Wn.prototype.postEvent=function(a,u,p,x){var B=this;if(ze.EVENTS_URL){var I=$n(ze.EVENTS_URL);I.params.push("access_token="+(x||ze.ACCESS_TOKEN||""));var D={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:Fn,userId:this.anonId},k=u?q(D,u):D,V={url:gn(I),headers:{"Content-Type":"text/plain"},body:JSON.stringify([k])};this.pendingRequest=ce(V,function(Q){B.pendingRequest=null,p(Q),B.saveEventData(),B.processRequests(x)})}},Wn.prototype.queueRequest=function(a,u){this.queue.push(a),this.processRequests(u)};var Tn,tr,je=function(a){function u(){a.call(this,"map.load"),this.success={},this.skuToken=""}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.postMapLoadEvent=function(p,x,B,I){this.skuToken=B;var D=!(!I&&!ze.ACCESS_TOKEN),k=Array.isArray(p)&&p.some(function(V){return vi(V)||Ri(V)});ze.EVENTS_URL&&D&&k&&this.queueRequest({id:x,timestamp:Date.now()},I)},u.prototype.processRequests=function(p){var x=this;if(!this.pendingRequest&&this.queue.length!==0){var B=this.queue.shift(),I=B.id,D=B.timestamp;I&&this.success[I]||(this.anonId||this.fetchEventData(),rt(this.anonId)||(this.anonId=ft()),this.postEvent(D,{skuToken:this.skuToken},function(k){k||I&&(x.success[I]=!0)},p))}},u}(Wn),mi=new(function(a){function u(p){a.call(this,"appUserTurnstile"),this._customAccessToken=p}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.postTurnstileEvent=function(p,x){ze.EVENTS_URL&&ze.ACCESS_TOKEN&&Array.isArray(p)&&p.some(function(B){return vi(B)||Ri(B)})&&this.queueRequest(Date.now(),x)},u.prototype.processRequests=function(p){var x=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var B=rr(ze.ACCESS_TOKEN),I=B?B.u:ze.ACCESS_TOKEN,D=I!==this.eventData.tokenU;rt(this.anonId)||(this.anonId=ft(),D=!0);var k=this.queue.shift();if(this.eventData.lastSuccess){var V=new Date(this.eventData.lastSuccess),Q=new Date(k),tt=(k-this.eventData.lastSuccess)/864e5;D=D||tt>=1||tt<-1||V.getDate()!==Q.getDate()}else D=!0;if(!D)return this.processRequests();this.postEvent(k,{"enabled.telemetry":!1},function(ot){ot||(x.eventData.lastSuccess=k,x.eventData.tokenU=I)},p)}},u}(Wn)),Mi=mi.postTurnstileEvent.bind(mi),nn=new je,_r=nn.postMapLoadEvent.bind(nn),St=500,Ne=50;function Xe(){S.caches&&!Tn&&(Tn=S.caches.open("mapbox-tiles"))}function ci(a){var u=a.indexOf("?");return u<0?a:a.slice(0,u)}var qt,De=1/0;function mt(){return qt==null&&(qt=S.OffscreenCanvas&&new S.OffscreenCanvas(1,1).getContext("2d")&&typeof S.createImageBitmap=="function"),qt}var Ve={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Ve);var Ce=function(a){function u(p,x,B){x===401&&Ri(B)&&(p+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),a.call(this,p),this.status=x,this.url=B,this.name=this.constructor.name,this.message=p}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},u}(Error),H=Ct()?function(){return self.worker&&self.worker.referrer}:function(){return(S.location.protocol==="blob:"?S.parent:S).location.href},ve,Te,wt=function(a,u){if(!(/^file:/.test(p=a.url)||/^file:/.test(H())&&!/^\w+:/.test(p))){if(S.fetch&&S.Request&&S.AbortController&&S.Request.prototype.hasOwnProperty("signal"))return function(x,B){var I,D=new S.AbortController,k=new S.Request(x.url,{method:x.method||"GET",body:x.body,credentials:x.credentials,headers:x.headers,referrer:H(),signal:D.signal}),V=!1,Q=!1,tt=(I=k.url).indexOf("sku=")>0&&Ri(I);x.type==="json"&&k.headers.set("Accept","application/json");var ot=function(_t,Nt,Ut){if(!Q){if(_t&&_t.message!=="SecurityError"&&ht(_t),Nt&&Ut)return dt(Nt);var Wt=Date.now();S.fetch(k).then(function(jt){if(jt.ok){var Yt=tt?jt.clone():null;return dt(jt,Yt,Wt)}return B(new Ce(jt.statusText,jt.status,x.url))}).catch(function(jt){jt.code!==20&&B(new Error(jt.message))})}},dt=function(_t,Nt,Ut){(x.type==="arrayBuffer"?_t.arrayBuffer():x.type==="json"?_t.json():_t.text()).then(function(Wt){Q||(Nt&&Ut&&function(jt,Yt,le){if(Xe(),Tn){var me={status:Yt.status,statusText:Yt.statusText,headers:new S.Headers};Yt.headers.forEach(function(Oe,Je){return me.headers.set(Je,Oe)});var _e=Dt(Yt.headers.get("Cache-Control")||"");_e["no-store"]||(_e["max-age"]&&me.headers.set("Expires",new Date(le+1e3*_e["max-age"]).toUTCString()),new Date(me.headers.get("Expires")).getTime()-le<42e4||function(Oe,Je){if(tr===void 0)try{new Response(new ReadableStream),tr=!0}catch{tr=!1}tr?Je(Oe.body):Oe.blob().then(Je)}(Yt,function(Oe){var Je=new S.Response(Oe,me);Xe(),Tn&&Tn.then(function(qe){return qe.put(ci(jt.url),Je)}).catch(function(qe){return ht(qe.message)})}))}}(k,Nt,Ut),V=!0,B(null,Wt,_t.headers.get("Cache-Control"),_t.headers.get("Expires")))}).catch(function(Wt){Q||B(new Error(Wt.message))})};return tt?function(_t,Nt){if(Xe(),!Tn)return Nt(null);var Ut=ci(_t.url);Tn.then(function(Wt){Wt.match(Ut).then(function(jt){var Yt=function(le){if(!le)return!1;var me=new Date(le.headers.get("Expires")||0),_e=Dt(le.headers.get("Cache-Control")||"");return me>Date.now()&&!_e["no-cache"]}(jt);Wt.delete(Ut),Yt&&Wt.put(Ut,jt.clone()),Nt(null,jt,Yt)}).catch(Nt)}).catch(Nt)}(k,ot):ot(null,null),{cancel:function(){Q=!0,V||D.abort()}}}(a,u);if(Ct()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,u,void 0,!0)}var p;return function(x,B){var I=new S.XMLHttpRequest;for(var D in I.open(x.method||"GET",x.url,!0),x.type==="arrayBuffer"&&(I.responseType="arraybuffer"),x.headers)I.setRequestHeader(D,x.headers[D]);return x.type==="json"&&(I.responseType="text",I.setRequestHeader("Accept","application/json")),I.withCredentials=x.credentials==="include",I.onerror=function(){B(new Error(I.statusText))},I.onload=function(){if((I.status>=200&&I.status<300||I.status===0)&&I.response!==null){var k=I.response;if(x.type==="json")try{k=JSON.parse(I.response)}catch(V){return B(V)}B(null,k,I.getResponseHeader("Cache-Control"),I.getResponseHeader("Expires"))}else B(new Ce(I.statusText,I.status,x.url))},I.send(x.body),{cancel:function(){return I.abort()}}}(a,u)},Kt=function(a,u){return wt(q(a,{type:"arrayBuffer"}),u)},ce=function(a,u){return wt(q(a,{method:"POST"}),u)},Y="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";ve=[],Te=0;var nt=function(a,u){if(pi.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Te>=ze.MAX_PARALLEL_IMAGE_REQUESTS){var p={requestParameters:a,callback:u,cancelled:!1,cancel:function(){this.cancelled=!0}};return ve.push(p),p}Te++;var x=!1,B=function(){if(!x)for(x=!0,Te--;ve.length&&Te<ze.MAX_PARALLEL_IMAGE_REQUESTS;){var D=ve.shift();D.cancelled||(D.cancel=nt(D.requestParameters,D.callback).cancel)}},I=Kt(a,function(D,k,V,Q){B(),D?u(D):k&&(mt()?function(tt,ot){var dt=new S.Blob([new Uint8Array(tt)],{type:"image/png"});S.createImageBitmap(dt).then(function(_t){ot(null,_t)}).catch(function(_t){ot(new Error("Could not load image because of "+_t.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(k,u):function(tt,ot,dt,_t){var Nt=new S.Image,Ut=S.URL;Nt.onload=function(){ot(null,Nt),Ut.revokeObjectURL(Nt.src),Nt.onload=null,S.requestAnimationFrame(function(){Nt.src=Y})},Nt.onerror=function(){return ot(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Wt=new S.Blob([new Uint8Array(tt)],{type:"image/png"});Nt.cacheControl=dt,Nt.expires=_t,Nt.src=tt.byteLength?Ut.createObjectURL(Wt):Y}(k,u,V,Q))});return{cancel:function(){I.cancel(),B()}}};function ct(a,u,p){p[a]&&p[a].indexOf(u)!==-1||(p[a]=p[a]||[],p[a].push(u))}function vt(a,u,p){if(p&&p[a]){var x=p[a].indexOf(u);x!==-1&&p[a].splice(x,1)}}var Ft=function(a,u){u===void 0&&(u={}),q(this,u),this.type=a},pt=function(a){function u(p,x){x===void 0&&(x={}),a.call(this,"error",q({error:p},x))}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(Ft),bt=function(){};bt.prototype.on=function(a,u){return this._listeners=this._listeners||{},ct(a,u,this._listeners),this},bt.prototype.off=function(a,u){return vt(a,u,this._listeners),vt(a,u,this._oneTimeListeners),this},bt.prototype.once=function(a,u){return this._oneTimeListeners=this._oneTimeListeners||{},ct(a,u,this._oneTimeListeners),this},bt.prototype.fire=function(a,u){typeof a=="string"&&(a=new Ft(a,u||{}));var p=a.type;if(this.listens(p)){a.target=this;for(var x=0,B=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];x<B.length;x+=1)B[x].call(this,a);for(var I=0,D=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];I<D.length;I+=1){var k=D[I];vt(p,k,this._oneTimeListeners),k.call(this,a)}var V=this._eventedParent;V&&(q(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),V.fire(a))}else a instanceof pt&&console.error(a.error);return this},bt.prototype.listens=function(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)},bt.prototype.setEventedParent=function(a,u){return this._eventedParent=a,this._eventedParentData=u,this};var lt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Et=function(a,u,p,x){this.message=(a?a+": ":"")+p,x&&(this.identifier=x),u!=null&&u.__line__&&(this.line=u.__line__)};function g(a){var u=a.value;return u?[new Et(a.key,u,"constants have been deprecated as of v8")]:[]}function ut(a){for(var u=[],p=arguments.length-1;p-- >0;)u[p]=arguments[p+1];for(var x=0,B=u;x<B.length;x+=1){var I=B[x];for(var D in I)a[D]=I[D]}return a}function Ee(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Zt(a){if(Array.isArray(a))return a.map(Zt);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){var u={};for(var p in a)u[p]=Zt(a[p]);return u}return Ee(a)}var Be=function(a){function u(p,x){a.call(this,x),this.message=x,this.key=p}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(Error),Re=function(a,u){u===void 0&&(u=[]),this.parent=a,this.bindings={};for(var p=0,x=u;p<x.length;p+=1){var B=x[p];this.bindings[B[0]]=B[1]}};Re.prototype.concat=function(a){return new Re(this,a)},Re.prototype.get=function(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(a+" not found in scope.")},Re.prototype.has=function(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)};var Fe={kind:"null"},fe={kind:"number"},ke={kind:"string"},Me={kind:"boolean"},He={kind:"color"},ki={kind:"object"},ei={kind:"value"},$i={kind:"collator"},ln={kind:"formatted"},Wi={kind:"resolvedImage"};function Ji(a,u){return{kind:"array",itemType:a,N:u}}function Gi(a){if(a.kind==="array"){var u=Gi(a.itemType);return typeof a.N=="number"?"array<"+u+", "+a.N+">":a.itemType.kind==="value"?"array":"array<"+u+">"}return a.kind}var vr=[Fe,fe,ke,Me,He,ln,ki,Ji(ei),Wi];function Xi(a,u){if(u.kind==="error")return null;if(a.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!Xi(a.itemType,u.itemType))&&(typeof a.N!="number"||a.N===u.N))return null}else{if(a.kind===u.kind)return null;if(a.kind==="value"){for(var p=0,x=vr;p<x.length;p+=1)if(!Xi(x[p],u))return null}}return"Expected "+Gi(a)+" but found "+Gi(u)+" instead."}function yi(a,u){return u.some(function(p){return p.kind===a.kind})}function Bt(a,u){return u.some(function(p){return p==="null"?a===null:p==="array"?Array.isArray(a):p==="object"?a&&!Array.isArray(a)&&typeof a=="object":p===typeof a})}var Qe=l(function(a,u){var p={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function x(k){return(k=Math.round(k))<0?0:k>255?255:k}function B(k){return x(k[k.length-1]==="%"?parseFloat(k)/100*255:parseInt(k))}function I(k){return(V=k[k.length-1]==="%"?parseFloat(k)/100:parseFloat(k))<0?0:V>1?1:V;var V}function D(k,V,Q){return Q<0?Q+=1:Q>1&&(Q-=1),6*Q<1?k+(V-k)*Q*6:2*Q<1?V:3*Q<2?k+(V-k)*(2/3-Q)*6:k}try{u.parseCSSColor=function(k){var V,Q=k.replace(/ /g,"").toLowerCase();if(Q in p)return p[Q].slice();if(Q[0]==="#")return Q.length===4?(V=parseInt(Q.substr(1),16))>=0&&V<=4095?[(3840&V)>>4|(3840&V)>>8,240&V|(240&V)>>4,15&V|(15&V)<<4,1]:null:Q.length===7&&(V=parseInt(Q.substr(1),16))>=0&&V<=16777215?[(16711680&V)>>16,(65280&V)>>8,255&V,1]:null;var tt=Q.indexOf("("),ot=Q.indexOf(")");if(tt!==-1&&ot+1===Q.length){var dt=Q.substr(0,tt),_t=Q.substr(tt+1,ot-(tt+1)).split(","),Nt=1;switch(dt){case"rgba":if(_t.length!==4)return null;Nt=I(_t.pop());case"rgb":return _t.length!==3?null:[B(_t[0]),B(_t[1]),B(_t[2]),Nt];case"hsla":if(_t.length!==4)return null;Nt=I(_t.pop());case"hsl":if(_t.length!==3)return null;var Ut=(parseFloat(_t[0])%360+360)%360/360,Wt=I(_t[1]),jt=I(_t[2]),Yt=jt<=.5?jt*(Wt+1):jt+Wt-jt*Wt,le=2*jt-Yt;return[x(255*D(le,Yt,Ut+1/3)),x(255*D(le,Yt,Ut)),x(255*D(le,Yt,Ut-1/3)),Nt];default:return null}}return null}}catch{}}).parseCSSColor,tn=function(a,u,p,x){x===void 0&&(x=1),this.r=a,this.g=u,this.b=p,this.a=x};tn.parse=function(a){if(a){if(a instanceof tn)return a;if(typeof a=="string"){var u=Qe(a);if(u)return new tn(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3])}}},tn.prototype.toString=function(){var a=this.toArray(),u=a[1],p=a[2],x=a[3];return"rgba("+Math.round(a[0])+","+Math.round(u)+","+Math.round(p)+","+x+")"},tn.prototype.toArray=function(){var a=this.a;return a===0?[0,0,0,0]:[255*this.r/a,255*this.g/a,255*this.b/a,a]},tn.black=new tn(0,0,0,1),tn.white=new tn(1,1,1,1),tn.transparent=new tn(0,0,0,0),tn.red=new tn(1,0,0,1);var Wr=function(a,u,p){this.sensitivity=a?u?"variant":"case":u?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Wr.prototype.compare=function(a,u){return this.collator.compare(a,u)},Wr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var xa=function(a,u,p,x,B){this.text=a,this.image=u,this.scale=p,this.fontStack=x,this.textColor=B},hr=function(a){this.sections=a};hr.fromString=function(a){return new hr([new xa(a,null,null,null,null)])},hr.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(a){return a.text.length!==0||a.image&&a.image.name.length!==0})},hr.factory=function(a){return a instanceof hr?a:hr.fromString(a)},hr.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(a){return a.text}).join("")},hr.prototype.serialize=function(){for(var a=["format"],u=0,p=this.sections;u<p.length;u+=1){var x=p[u];if(x.image)a.push(["image",x.image.name]);else{a.push(x.text);var B={};x.fontStack&&(B["text-font"]=["literal",x.fontStack.split(",")]),x.scale&&(B["font-scale"]=x.scale),x.textColor&&(B["text-color"]=["rgba"].concat(x.textColor.toArray())),a.push(B)}}return a};var Jn=function(a){this.name=a.name,this.available=a.available};function Tt(a,u,p,x){return typeof a=="number"&&a>=0&&a<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof p=="number"&&p>=0&&p<=255?x===void 0||typeof x=="number"&&x>=0&&x<=1?null:"Invalid rgba value ["+[a,u,p,x].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof x=="number"?[a,u,p,x]:[a,u,p]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Ks(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof tn||a instanceof Wr||a instanceof hr||a instanceof Jn)return!0;if(Array.isArray(a)){for(var u=0,p=a;u<p.length;u+=1)if(!Ks(p[u]))return!1;return!0}if(typeof a=="object"){for(var x in a)if(!Ks(a[x]))return!1;return!0}return!1}function Xn(a){if(a===null)return Fe;if(typeof a=="string")return ke;if(typeof a=="boolean")return Me;if(typeof a=="number")return fe;if(a instanceof tn)return He;if(a instanceof Wr)return $i;if(a instanceof hr)return ln;if(a instanceof Jn)return Wi;if(Array.isArray(a)){for(var u,p=a.length,x=0,B=a;x<B.length;x+=1){var I=Xn(B[x]);if(u){if(u===I)continue;u=ei;break}u=I}return Ji(u||ei,p)}return ki}function Qs(a){var u=typeof a;return a===null?"":u==="string"||u==="number"||u==="boolean"?String(a):a instanceof tn||a instanceof hr||a instanceof Jn?a.toString():JSON.stringify(a)}Jn.prototype.toString=function(){return this.name},Jn.fromString=function(a){return a?new Jn({name:a,available:!1}):null},Jn.prototype.serialize=function(){return["image",this.name]};var Lr=function(a,u){this.type=a,this.value=u};Lr.parse=function(a,u){if(a.length!==2)return u.error("'literal' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(!Ks(a[1]))return u.error("invalid value");var p=a[1],x=Xn(p),B=u.expectedType;return x.kind!=="array"||x.N!==0||!B||B.kind!=="array"||typeof B.N=="number"&&B.N!==0||(x=B),new Lr(x,p)},Lr.prototype.evaluate=function(){return this.value},Lr.prototype.eachChild=function(){},Lr.prototype.outputDefined=function(){return!0},Lr.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof tn?["rgba"].concat(this.value.toArray()):this.value instanceof hr?this.value.serialize():this.value};var fr=function(a){this.name="ExpressionEvaluationError",this.message=a};fr.prototype.toJSON=function(){return this.message};var Mr={string:ke,number:fe,boolean:Me,object:ki},Dn=function(a,u){this.type=a,this.args=u};Dn.parse=function(a,u){if(a.length<2)return u.error("Expected at least one argument.");var p,x=1,B=a[0];if(B==="array"){var I,D;if(a.length>2){var k=a[1];if(typeof k!="string"||!(k in Mr)||k==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);I=Mr[k],x++}else I=ei;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return u.error('The length argument to "array" must be a positive integer literal',2);D=a[2],x++}p=Ji(I,D)}else p=Mr[B];for(var V=[];x<a.length;x++){var Q=u.parse(a[x],x,ei);if(!Q)return null;V.push(Q)}return new Dn(p,V)},Dn.prototype.evaluate=function(a){for(var u=0;u<this.args.length;u++){var p=this.args[u].evaluate(a);if(!Xi(this.type,Xn(p)))return p;if(u===this.args.length-1)throw new fr("Expected value to be of type "+Gi(this.type)+", but found "+Gi(Xn(p))+" instead.")}return null},Dn.prototype.eachChild=function(a){this.args.forEach(a)},Dn.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Dn.prototype.serialize=function(){var a=this.type,u=[a.kind];if(a.kind==="array"){var p=a.itemType;if(p.kind==="string"||p.kind==="number"||p.kind==="boolean"){u.push(p.kind);var x=a.N;(typeof x=="number"||this.args.length>1)&&u.push(x)}}return u.concat(this.args.map(function(B){return B.serialize()}))};var vo=function(a){this.type=ln,this.sections=a};vo.parse=function(a,u){if(a.length<2)return u.error("Expected at least one argument.");var p=a[1];if(!Array.isArray(p)&&typeof p=="object")return u.error("First argument must be an image or text section.");for(var x=[],B=!1,I=1;I<=a.length-1;++I){var D=a[I];if(B&&typeof D=="object"&&!Array.isArray(D)){B=!1;var k=null;if(D["font-scale"]&&!(k=u.parse(D["font-scale"],1,fe)))return null;var V=null;if(D["text-font"]&&!(V=u.parse(D["text-font"],1,Ji(ke))))return null;var Q=null;if(D["text-color"]&&!(Q=u.parse(D["text-color"],1,He)))return null;var tt=x[x.length-1];tt.scale=k,tt.font=V,tt.textColor=Q}else{var ot=u.parse(a[I],1,ei);if(!ot)return null;var dt=ot.type.kind;if(dt!=="string"&&dt!=="value"&&dt!=="null"&&dt!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");B=!0,x.push({content:ot,scale:null,font:null,textColor:null})}}return new vo(x)},vo.prototype.evaluate=function(a){return new hr(this.sections.map(function(u){var p=u.content.evaluate(a);return Xn(p)===Wi?new xa("",p,null,null,null):new xa(Qs(p),null,u.scale?u.scale.evaluate(a):null,u.font?u.font.evaluate(a).join(","):null,u.textColor?u.textColor.evaluate(a):null)}))},vo.prototype.eachChild=function(a){for(var u=0,p=this.sections;u<p.length;u+=1){var x=p[u];a(x.content),x.scale&&a(x.scale),x.font&&a(x.font),x.textColor&&a(x.textColor)}},vo.prototype.outputDefined=function(){return!1},vo.prototype.serialize=function(){for(var a=["format"],u=0,p=this.sections;u<p.length;u+=1){var x=p[u];a.push(x.content.serialize());var B={};x.scale&&(B["font-scale"]=x.scale.serialize()),x.font&&(B["text-font"]=x.font.serialize()),x.textColor&&(B["text-color"]=x.textColor.serialize()),a.push(B)}return a};var Jr=function(a){this.type=Wi,this.input=a};Jr.parse=function(a,u){if(a.length!==2)return u.error("Expected two arguments.");var p=u.parse(a[1],1,ke);return p?new Jr(p):u.error("No image name provided.")},Jr.prototype.evaluate=function(a){var u=this.input.evaluate(a),p=Jn.fromString(u);return p&&a.availableImages&&(p.available=a.availableImages.indexOf(u)>-1),p},Jr.prototype.eachChild=function(a){a(this.input)},Jr.prototype.outputDefined=function(){return!1},Jr.prototype.serialize=function(){return["image",this.input.serialize()]};var Ho={"to-boolean":Me,"to-color":He,"to-number":fe,"to-string":ke},In=function(a,u){this.type=a,this.args=u};In.parse=function(a,u){if(a.length<2)return u.error("Expected at least one argument.");var p=a[0];if((p==="to-boolean"||p==="to-string")&&a.length!==2)return u.error("Expected one argument.");for(var x=Ho[p],B=[],I=1;I<a.length;I++){var D=u.parse(a[I],I,ei);if(!D)return null;B.push(D)}return new In(x,B)},In.prototype.evaluate=function(a){if(this.type.kind==="boolean")return!!this.args[0].evaluate(a);if(this.type.kind==="color"){for(var u,p,x=0,B=this.args;x<B.length;x+=1){if(p=null,(u=B[x].evaluate(a))instanceof tn)return u;if(typeof u=="string"){var I=a.parseColor(u);if(I)return I}else if(Array.isArray(u)&&!(p=u.length<3||u.length>4?"Invalid rbga value "+JSON.stringify(u)+": expected an array containing either three or four numeric values.":Tt(u[0],u[1],u[2],u[3])))return new tn(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new fr(p||"Could not parse color from value '"+(typeof u=="string"?u:String(JSON.stringify(u)))+"'")}if(this.type.kind==="number"){for(var D=null,k=0,V=this.args;k<V.length;k+=1){if((D=V[k].evaluate(a))===null)return 0;var Q=Number(D);if(!isNaN(Q))return Q}throw new fr("Could not convert "+JSON.stringify(D)+" to number.")}return this.type.kind==="formatted"?hr.fromString(Qs(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?Jn.fromString(Qs(this.args[0].evaluate(a))):Qs(this.args[0].evaluate(a))},In.prototype.eachChild=function(a){this.args.forEach(a)},In.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},In.prototype.serialize=function(){if(this.type.kind==="formatted")return new vo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Jr(this.args[0]).serialize();var a=["to-"+this.type.kind];return this.eachChild(function(u){a.push(u.serialize())}),a};var wc=["Unknown","Point","LineString","Polygon"],gt=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};gt.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},gt.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?wc[this.feature.type]:this.feature.type:null},gt.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},gt.prototype.canonicalID=function(){return this.canonical},gt.prototype.properties=function(){return this.feature&&this.feature.properties||{}},gt.prototype.parseColor=function(a){var u=this._parseColorCache[a];return u||(u=this._parseColorCache[a]=tn.parse(a)),u};var Pt=function(a,u,p,x){this.name=a,this.type=u,this._evaluate=p,this.args=x};Pt.prototype.evaluate=function(a){return this._evaluate(a,this.args)},Pt.prototype.eachChild=function(a){this.args.forEach(a)},Pt.prototype.outputDefined=function(){return!1},Pt.prototype.serialize=function(){return[this.name].concat(this.args.map(function(a){return a.serialize()}))},Pt.parse=function(a,u){var p,x=a[0],B=Pt.definitions[x];if(!B)return u.error('Unknown expression "'+x+'". If you wanted a literal array, use ["literal", [...]].',0);for(var I=Array.isArray(B)?B[0]:B.type,D=Array.isArray(B)?[[B[1],B[2]]]:B.overloads,k=D.filter(function(Ei){var oi=Ei[0];return!Array.isArray(oi)||oi.length===a.length-1}),V=null,Q=0,tt=k;Q<tt.length;Q+=1){var ot=tt[Q],dt=ot[0],_t=ot[1];V=new br(u.registry,u.path,null,u.scope);for(var Nt=[],Ut=!1,Wt=1;Wt<a.length;Wt++){var jt=a[Wt],Yt=Array.isArray(dt)?dt[Wt-1]:dt.type,le=V.parse(jt,1+Nt.length,Yt);if(!le){Ut=!0;break}Nt.push(le)}if(!Ut)if(Array.isArray(dt)&&dt.length!==Nt.length)V.error("Expected "+dt.length+" arguments, but found "+Nt.length+" instead.");else{for(var me=0;me<Nt.length;me++){var _e=Array.isArray(dt)?dt[me]:dt.type,Oe=Nt[me];V.concat(me+1).checkSubtype(_e,Oe.type)}if(V.errors.length===0)return new Pt(x,I,_t,Nt)}}if(k.length===1)(p=u.errors).push.apply(p,V.errors);else{for(var Je=(k.length?k:D).map(function(Ei){var oi;return oi=Ei[0],Array.isArray(oi)?"("+oi.map(Gi).join(", ")+")":"("+Gi(oi.type)+"...)"}).join(" | "),qe=[],bi=1;bi<a.length;bi++){var ri=u.parse(a[bi],1+qe.length);if(!ri)return null;qe.push(Gi(ri.type))}u.error("Expected arguments of type "+Je+", but found ("+qe.join(", ")+") instead.")}return null},Pt.register=function(a,u){for(var p in Pt.definitions=u,u)a[p]=Pt};var Jt=function(a,u,p){this.type=$i,this.locale=p,this.caseSensitive=a,this.diacriticSensitive=u};function xe(a,u){a[0]=Math.min(a[0],u[0]),a[1]=Math.min(a[1],u[1]),a[2]=Math.max(a[2],u[0]),a[3]=Math.max(a[3],u[1])}function We(a,u){return!(a[0]<=u[0]||a[2]>=u[2]||a[1]<=u[1]||a[3]>=u[3])}function zi(a,u){var p=(180+a[0])/360,x=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,B=Math.pow(2,u.z);return[Math.round(p*B*8192),Math.round(x*B*8192)]}function Si(a,u,p){return u[1]>a[1]!=p[1]>a[1]&&a[0]<(p[0]-u[0])*(a[1]-u[1])/(p[1]-u[1])+u[0]}function kn(a,u){for(var p,x,B,I,D,k,V,Q=!1,tt=0,ot=u.length;tt<ot;tt++)for(var dt=u[tt],_t=0,Nt=dt.length;_t<Nt-1;_t++){if((I=(p=a)[0]-(x=dt[_t])[0])*(V=p[1]-(B=dt[_t+1])[1])-(k=p[0]-B[0])*(D=p[1]-x[1])==0&&I*k<=0&&D*V<=0)return!1;Si(a,dt[_t],dt[_t+1])&&(Q=!Q)}return Q}function Po(a,u){for(var p=0;p<u.length;p++)if(kn(a,u[p]))return!0;return!1}function ho(a,u,p,x){var B=x[0]-p[0],I=x[1]-p[1],D=(a[0]-p[0])*I-B*(a[1]-p[1]),k=(u[0]-p[0])*I-B*(u[1]-p[1]);return D>0&&k<0||D<0&&k>0}function os(a,u,p){for(var x=0,B=p;x<B.length;x+=1)for(var I=B[x],D=0;D<I.length-1;++D)if((ot=[(tt=I[D+1])[0]-(Q=I[D])[0],tt[1]-Q[1]])[0]*(dt=[(V=u)[0]-(k=a)[0],V[1]-k[1]])[1]-ot[1]*dt[0]!=0&&ho(k,V,Q,tt)&&ho(Q,tt,k,V))return!0;var k,V,Q,tt,ot,dt;return!1}function Of(a,u){for(var p=0;p<a.length;++p)if(!kn(a[p],u))return!1;for(var x=0;x<a.length-1;++x)if(os(a[x],a[x+1],u))return!1;return!0}function bh(a,u){for(var p=0;p<u.length;p++)if(Of(a,u[p]))return!0;return!1}function wa(a,u,p){for(var x=[],B=0;B<a.length;B++){for(var I=[],D=0;D<a[B].length;D++){var k=zi(a[B][D],p);xe(u,k),I.push(k)}x.push(I)}return x}function Cc(a,u,p){for(var x=[],B=0;B<a.length;B++){var I=wa(a[B],u,p);x.push(I)}return x}function Ec(a,u,p,x){if(a[0]<p[0]||a[0]>p[2]){var B=.5*x,I=a[0]-p[0]>B?-x:p[0]-a[0]>B?x:0;I===0&&(I=a[0]-p[2]>B?-x:p[2]-a[0]>B?x:0),a[0]+=I}xe(u,a)}function Lf(a,u,p,x){for(var B=8192*Math.pow(2,x.z),I=[8192*x.x,8192*x.y],D=[],k=0,V=a;k<V.length;k+=1)for(var Q=0,tt=V[k];Q<tt.length;Q+=1){var ot=tt[Q],dt=[ot.x+I[0],ot.y+I[1]];Ec(dt,u,p,B),D.push(dt)}return D}function Bc(a,u,p,x){for(var B,I=8192*Math.pow(2,x.z),D=[8192*x.x,8192*x.y],k=[],V=0,Q=a;V<Q.length;V+=1){for(var tt=[],ot=0,dt=Q[V];ot<dt.length;ot+=1){var _t=dt[ot],Nt=[_t.x+D[0],_t.y+D[1]];xe(u,Nt),tt.push(Nt)}k.push(tt)}if(u[2]-u[0]<=I/2){(B=u)[0]=B[1]=1/0,B[2]=B[3]=-1/0;for(var Ut=0,Wt=k;Ut<Wt.length;Ut+=1)for(var jt=0,Yt=Wt[Ut];jt<Yt.length;jt+=1)Ec(Yt[jt],u,p,I)}return k}Jt.parse=function(a,u){if(a.length!==2)return u.error("Expected one argument.");var p=a[1];if(typeof p!="object"||Array.isArray(p))return u.error("Collator options argument must be an object.");var x=u.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,Me);if(!x)return null;var B=u.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,Me);if(!B)return null;var I=null;return p.locale&&!(I=u.parse(p.locale,1,ke))?null:new Jt(x,B,I)},Jt.prototype.evaluate=function(a){return new Wr(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)},Jt.prototype.eachChild=function(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)},Jt.prototype.outputDefined=function(){return!1},Jt.prototype.serialize=function(){var a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]};var Wo=function(a,u){this.type=Me,this.geojson=a,this.geometries=u};function Zs(a){if(a instanceof Pt&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Wo)return!1;var u=!0;return a.eachChild(function(p){u&&!Zs(p)&&(u=!1)}),u}function Ca(a){if(a instanceof Pt&&a.name==="feature-state")return!1;var u=!0;return a.eachChild(function(p){u&&!Ca(p)&&(u=!1)}),u}function Qa(a,u){if(a instanceof Pt&&u.indexOf(a.name)>=0)return!1;var p=!0;return a.eachChild(function(x){p&&!Qa(x,u)&&(p=!1)}),p}Wo.parse=function(a,u){if(a.length!==2)return u.error("'within' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(Ks(a[1])){var p=a[1];if(p.type==="FeatureCollection")for(var x=0;x<p.features.length;++x){var B=p.features[x].geometry.type;if(B==="Polygon"||B==="MultiPolygon")return new Wo(p,p.features[x].geometry)}else if(p.type==="Feature"){var I=p.geometry.type;if(I==="Polygon"||I==="MultiPolygon")return new Wo(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new Wo(p,p)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Wo.prototype.evaluate=function(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(u,p){var x=[1/0,1/0,-1/0,-1/0],B=[1/0,1/0,-1/0,-1/0],I=u.canonicalID();if(p.type==="Polygon"){var D=wa(p.coordinates,B,I),k=Lf(u.geometry(),x,B,I);if(!We(x,B))return!1;for(var V=0,Q=k;V<Q.length;V+=1)if(!kn(Q[V],D))return!1}if(p.type==="MultiPolygon"){var tt=Cc(p.coordinates,B,I),ot=Lf(u.geometry(),x,B,I);if(!We(x,B))return!1;for(var dt=0,_t=ot;dt<_t.length;dt+=1)if(!Po(_t[dt],tt))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(u,p){var x=[1/0,1/0,-1/0,-1/0],B=[1/0,1/0,-1/0,-1/0],I=u.canonicalID();if(p.type==="Polygon"){var D=wa(p.coordinates,B,I),k=Bc(u.geometry(),x,B,I);if(!We(x,B))return!1;for(var V=0,Q=k;V<Q.length;V+=1)if(!Of(Q[V],D))return!1}if(p.type==="MultiPolygon"){var tt=Cc(p.coordinates,B,I),ot=Bc(u.geometry(),x,B,I);if(!We(x,B))return!1;for(var dt=0,_t=ot;dt<_t.length;dt+=1)if(!bh(_t[dt],tt))return!1}return!0}(a,this.geometries)}return!1},Wo.prototype.eachChild=function(){},Wo.prototype.outputDefined=function(){return!0},Wo.prototype.serialize=function(){return["within",this.geojson]};var Ea=function(a,u){this.type=u.type,this.name=a,this.boundExpression=u};Ea.parse=function(a,u){if(a.length!==2||typeof a[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");var p=a[1];return u.scope.has(p)?new Ea(p,u.scope.get(p)):u.error('Unknown variable "'+p+'". Make sure "'+p+'" has been bound in an enclosing "let" expression before using it.',1)},Ea.prototype.evaluate=function(a){return this.boundExpression.evaluate(a)},Ea.prototype.eachChild=function(){},Ea.prototype.outputDefined=function(){return!1},Ea.prototype.serialize=function(){return["var",this.name]};var br=function(a,u,p,x,B){u===void 0&&(u=[]),x===void 0&&(x=new Re),B===void 0&&(B=[]),this.registry=a,this.path=u,this.key=u.map(function(I){return"["+I+"]"}).join(""),this.scope=x,this.errors=B,this.expectedType=p};function Ls(a,u){for(var p,x=a.length-1,B=0,I=x,D=0;B<=I;)if((p=a[D=Math.floor((B+I)/2)])<=u){if(D===x||u<a[D+1])return D;B=D+1}else{if(!(p>u))throw new fr("Input is not a number.");I=D-1}return 0}br.prototype.parse=function(a,u,p,x,B){return B===void 0&&(B={}),u?this.concat(u,p,x)._parse(a,B):this._parse(a,B)},br.prototype._parse=function(a,u){function p(Q,tt,ot){return ot==="assert"?new Dn(tt,[Q]):ot==="coerce"?new In(tt,[Q]):Q}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var x=a[0];if(typeof x!="string")return this.error("Expression name must be a string, but found "+typeof x+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var B=this.registry[x];if(B){var I=B.parse(a,this);if(!I)return null;if(this.expectedType){var D=this.expectedType,k=I.type;if(D.kind!=="string"&&D.kind!=="number"&&D.kind!=="boolean"&&D.kind!=="object"&&D.kind!=="array"||k.kind!=="value")if(D.kind!=="color"&&D.kind!=="formatted"&&D.kind!=="resolvedImage"||k.kind!=="value"&&k.kind!=="string"){if(this.checkSubtype(D,k))return null}else I=p(I,D,u.typeAnnotation||"coerce");else I=p(I,D,u.typeAnnotation||"assert")}if(!(I instanceof Lr)&&I.type.kind!=="resolvedImage"&&function Q(tt){if(tt instanceof Ea)return Q(tt.boundExpression);if(tt instanceof Pt&&tt.name==="error"||tt instanceof Jt||tt instanceof Wo)return!1;var ot=tt instanceof In||tt instanceof Dn,dt=!0;return tt.eachChild(function(_t){dt=ot?dt&&Q(_t):dt&&_t instanceof Lr}),!!dt&&Zs(tt)&&Qa(tt,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(I)){var V=new gt;try{I=new Lr(I.type,I.evaluate(V))}catch(Q){return this.error(Q.message),null}}return I}return this.error('Unknown expression "'+x+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof a+" instead.")},br.prototype.concat=function(a,u,p){var x=typeof a=="number"?this.path.concat(a):this.path,B=p?this.scope.concat(p):this.scope;return new br(this.registry,x,u||null,B,this.errors)},br.prototype.error=function(a){for(var u=[],p=arguments.length-1;p-- >0;)u[p]=arguments[p+1];var x=""+this.key+u.map(function(B){return"["+B+"]"}).join("");this.errors.push(new Be(x,a))},br.prototype.checkSubtype=function(a,u){var p=Xi(a,u);return p&&this.error(p),p};var jn=function(a,u,p){this.type=a,this.input=u,this.labels=[],this.outputs=[];for(var x=0,B=p;x<B.length;x+=1){var I=B[x],D=I[1];this.labels.push(I[0]),this.outputs.push(D)}};function dr(a,u,p){return a*(1-p)+u*p}jn.parse=function(a,u){if(a.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");var p=u.parse(a[1],1,fe);if(!p)return null;var x=[],B=null;u.expectedType&&u.expectedType.kind!=="value"&&(B=u.expectedType);for(var I=1;I<a.length;I+=2){var D=I===1?-1/0:a[I],k=a[I+1],V=I,Q=I+1;if(typeof D!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(x.length&&x[x.length-1][0]>=D)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',V);var tt=u.parse(k,Q,B);if(!tt)return null;B=B||tt.type,x.push([D,tt])}return new jn(B,p,x)},jn.prototype.evaluate=function(a){var u=this.labels,p=this.outputs;if(u.length===1)return p[0].evaluate(a);var x=this.input.evaluate(a);if(x<=u[0])return p[0].evaluate(a);var B=u.length;return x>=u[B-1]?p[B-1].evaluate(a):p[Ls(u,x)].evaluate(a)},jn.prototype.eachChild=function(a){a(this.input);for(var u=0,p=this.outputs;u<p.length;u+=1)a(p[u])},jn.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},jn.prototype.serialize=function(){for(var a=["step",this.input.serialize()],u=0;u<this.labels.length;u++)u>0&&a.push(this.labels[u]),a.push(this.outputs[u].serialize());return a};var Za=Object.freeze({__proto__:null,number:dr,color:function(a,u,p){return new tn(dr(a.r,u.r,p),dr(a.g,u.g,p),dr(a.b,u.b,p),dr(a.a,u.a,p))},array:function(a,u,p){return a.map(function(x,B){return dr(x,u[B],p)})}}),Tc=6/29*3*(6/29),aA=Math.PI/180,lA=180/Math.PI;function xh(a){return a>.008856451679035631?Math.pow(a,1/3):a/Tc+4/29}function fu(a){return a>6/29?a*a*a:Tc*(a-4/29)}function Dl(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Ys(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function wh(a){var u=Ys(a.r),p=Ys(a.g),x=Ys(a.b),B=xh((.4124564*u+.3575761*p+.1804375*x)/.95047),I=xh((.2126729*u+.7151522*p+.072175*x)/1);return{l:116*I-16,a:500*(B-I),b:200*(I-xh((.0193339*u+.119192*p+.9503041*x)/1.08883)),alpha:a.a}}function Ch(a){var u=(a.l+16)/116,p=isNaN(a.a)?u:u+a.a/500,x=isNaN(a.b)?u:u-a.b/200;return u=1*fu(u),p=.95047*fu(p),x=1.08883*fu(x),new tn(Dl(3.2404542*p-1.5371385*u-.4985314*x),Dl(-.969266*p+1.8760108*u+.041556*x),Dl(.0556434*p-.2040259*u+1.0572252*x),a.alpha)}function du(a,u,p){var x=u-a;return a+p*(x>180||x<-180?x-360*Math.round(x/360):x)}var Es={forward:wh,reverse:Ch,interpolate:function(a,u,p){return{l:dr(a.l,u.l,p),a:dr(a.a,u.a,p),b:dr(a.b,u.b,p),alpha:dr(a.alpha,u.alpha,p)}}},ss={forward:function(a){var u=wh(a),p=u.l,x=u.a,B=u.b,I=Math.atan2(B,x)*lA;return{h:I<0?I+360:I,c:Math.sqrt(x*x+B*B),l:p,alpha:a.a}},reverse:function(a){var u=a.h*aA,p=a.c;return Ch({l:a.l,a:Math.cos(u)*p,b:Math.sin(u)*p,alpha:a.alpha})},interpolate:function(a,u,p){return{h:du(a.h,u.h,p),c:dr(a.c,u.c,p),l:dr(a.l,u.l,p),alpha:dr(a.alpha,u.alpha,p)}}},Eh=Object.freeze({__proto__:null,lab:Es,hcl:ss}),Ur=function(a,u,p,x,B){this.type=a,this.operator=u,this.interpolation=p,this.input=x,this.labels=[],this.outputs=[];for(var I=0,D=B;I<D.length;I+=1){var k=D[I],V=k[1];this.labels.push(k[0]),this.outputs.push(V)}};function Sc(a,u,p,x){var B=x-p,I=a-p;return B===0?0:u===1?I/B:(Math.pow(u,I)-1)/(Math.pow(u,B)-1)}Ur.interpolationFactor=function(a,u,p,x){var B=0;if(a.name==="exponential")B=Sc(u,a.base,p,x);else if(a.name==="linear")B=Sc(u,1,p,x);else if(a.name==="cubic-bezier"){var I=a.controlPoints;B=new h(I[0],I[1],I[2],I[3]).solve(Sc(u,1,p,x))}return B},Ur.parse=function(a,u){var p=a[0],x=a[1],B=a[2],I=a.slice(3);if(!Array.isArray(x)||x.length===0)return u.error("Expected an interpolation type expression.",1);if(x[0]==="linear")x={name:"linear"};else if(x[0]==="exponential"){var D=x[1];if(typeof D!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);x={name:"exponential",base:D}}else{if(x[0]!=="cubic-bezier")return u.error("Unknown interpolation type "+String(x[0]),1,0);var k=x.slice(1);if(k.length!==4||k.some(function(Wt){return typeof Wt!="number"||Wt<0||Wt>1}))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);x={name:"cubic-bezier",controlPoints:k}}if(a.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(!(B=u.parse(B,2,fe)))return null;var V=[],Q=null;p==="interpolate-hcl"||p==="interpolate-lab"?Q=He:u.expectedType&&u.expectedType.kind!=="value"&&(Q=u.expectedType);for(var tt=0;tt<I.length;tt+=2){var ot=I[tt],dt=I[tt+1],_t=tt+3,Nt=tt+4;if(typeof ot!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',_t);if(V.length&&V[V.length-1][0]>=ot)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',_t);var Ut=u.parse(dt,Nt,Q);if(!Ut)return null;Q=Q||Ut.type,V.push([ot,Ut])}return Q.kind==="number"||Q.kind==="color"||Q.kind==="array"&&Q.itemType.kind==="number"&&typeof Q.N=="number"?new Ur(Q,p,x,B,V):u.error("Type "+Gi(Q)+" is not interpolatable.")},Ur.prototype.evaluate=function(a){var u=this.labels,p=this.outputs;if(u.length===1)return p[0].evaluate(a);var x=this.input.evaluate(a);if(x<=u[0])return p[0].evaluate(a);var B=u.length;if(x>=u[B-1])return p[B-1].evaluate(a);var I=Ls(u,x),D=Ur.interpolationFactor(this.interpolation,x,u[I],u[I+1]),k=p[I].evaluate(a),V=p[I+1].evaluate(a);return this.operator==="interpolate"?Za[this.type.kind.toLowerCase()](k,V,D):this.operator==="interpolate-hcl"?ss.reverse(ss.interpolate(ss.forward(k),ss.forward(V),D)):Es.reverse(Es.interpolate(Es.forward(k),Es.forward(V),D))},Ur.prototype.eachChild=function(a){a(this.input);for(var u=0,p=this.outputs;u<p.length;u+=1)a(p[u])},Ur.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Ur.prototype.serialize=function(){var a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var u=[this.operator,a,this.input.serialize()],p=0;p<this.labels.length;p++)u.push(this.labels[p],this.outputs[p].serialize());return u};var Ba=function(a,u){this.type=a,this.args=u};Ba.parse=function(a,u){if(a.length<2)return u.error("Expectected at least one argument.");var p=null,x=u.expectedType;x&&x.kind!=="value"&&(p=x);for(var B=[],I=0,D=a.slice(1);I<D.length;I+=1){var k=u.parse(D[I],1+B.length,p,void 0,{typeAnnotation:"omit"});if(!k)return null;p=p||k.type,B.push(k)}var V=x&&B.some(function(Q){return Xi(x,Q.type)});return new Ba(V?ei:p,B)},Ba.prototype.evaluate=function(a){for(var u,p=null,x=0,B=0,I=this.args;B<I.length&&(x++,(p=I[B].evaluate(a))&&p instanceof Jn&&!p.available&&(u||(u=p.name),p=null,x===this.args.length&&(p=u)),p===null);B+=1);return p},Ba.prototype.eachChild=function(a){this.args.forEach(a)},Ba.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Ba.prototype.serialize=function(){var a=["coalesce"];return this.eachChild(function(u){a.push(u.serialize())}),a};var Ta=function(a,u){this.type=u.type,this.bindings=[].concat(a),this.result=u};Ta.prototype.evaluate=function(a){return this.result.evaluate(a)},Ta.prototype.eachChild=function(a){for(var u=0,p=this.bindings;u<p.length;u+=1)a(p[u][1]);a(this.result)},Ta.parse=function(a,u){if(a.length<4)return u.error("Expected at least 3 arguments, but found "+(a.length-1)+" instead.");for(var p=[],x=1;x<a.length-1;x+=2){var B=a[x];if(typeof B!="string")return u.error("Expected string, but found "+typeof B+" instead.",x);if(/[^a-zA-Z0-9_]/.test(B))return u.error("Variable names must contain only alphanumeric characters or '_'.",x);var I=u.parse(a[x+1],x+1);if(!I)return null;p.push([B,I])}var D=u.parse(a[a.length-1],a.length-1,u.expectedType,p);return D?new Ta(p,D):null},Ta.prototype.outputDefined=function(){return this.result.outputDefined()},Ta.prototype.serialize=function(){for(var a=["let"],u=0,p=this.bindings;u<p.length;u+=1){var x=p[u];a.push(x[0],x[1].serialize())}return a.push(this.result.serialize()),a};var Sa=function(a,u,p){this.type=a,this.index=u,this.input=p};Sa.parse=function(a,u){if(a.length!==3)return u.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var p=u.parse(a[1],1,fe),x=u.parse(a[2],2,Ji(u.expectedType||ei));return p&&x?new Sa(x.type.itemType,p,x):null},Sa.prototype.evaluate=function(a){var u=this.index.evaluate(a),p=this.input.evaluate(a);if(u<0)throw new fr("Array index out of bounds: "+u+" < 0.");if(u>=p.length)throw new fr("Array index out of bounds: "+u+" > "+(p.length-1)+".");if(u!==Math.floor(u))throw new fr("Array index must be an integer, but found "+u+" instead.");return p[u]},Sa.prototype.eachChild=function(a){a(this.index),a(this.input)},Sa.prototype.outputDefined=function(){return!1},Sa.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Ya=function(a,u){this.type=Me,this.needle=a,this.haystack=u};Ya.parse=function(a,u){if(a.length!==3)return u.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var p=u.parse(a[1],1,ei),x=u.parse(a[2],2,ei);return p&&x?yi(p.type,[Me,ke,fe,Fe,ei])?new Ya(p,x):u.error("Expected first argument to be of type boolean, string, number or null, but found "+Gi(p.type)+" instead"):null},Ya.prototype.evaluate=function(a){var u=this.needle.evaluate(a),p=this.haystack.evaluate(a);if(!p)return!1;if(!Bt(u,["boolean","string","number","null"]))throw new fr("Expected first argument to be of type boolean, string, number or null, but found "+Gi(Xn(u))+" instead.");if(!Bt(p,["string","array"]))throw new fr("Expected second argument to be of type array or string, but found "+Gi(Xn(p))+" instead.");return p.indexOf(u)>=0},Ya.prototype.eachChild=function(a){a(this.needle),a(this.haystack)},Ya.prototype.outputDefined=function(){return!0},Ya.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Ia=function(a,u,p){this.type=fe,this.needle=a,this.haystack=u,this.fromIndex=p};Ia.parse=function(a,u){if(a.length<=2||a.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var p=u.parse(a[1],1,ei),x=u.parse(a[2],2,ei);if(!p||!x)return null;if(!yi(p.type,[Me,ke,fe,Fe,ei]))return u.error("Expected first argument to be of type boolean, string, number or null, but found "+Gi(p.type)+" instead");if(a.length===4){var B=u.parse(a[3],3,fe);return B?new Ia(p,x,B):null}return new Ia(p,x)},Ia.prototype.evaluate=function(a){var u=this.needle.evaluate(a),p=this.haystack.evaluate(a);if(!Bt(u,["boolean","string","number","null"]))throw new fr("Expected first argument to be of type boolean, string, number or null, but found "+Gi(Xn(u))+" instead.");if(!Bt(p,["string","array"]))throw new fr("Expected second argument to be of type array or string, but found "+Gi(Xn(p))+" instead.");if(this.fromIndex){var x=this.fromIndex.evaluate(a);return p.indexOf(u,x)}return p.indexOf(u)},Ia.prototype.eachChild=function(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)},Ia.prototype.outputDefined=function(){return!1},Ia.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var qa=function(a,u,p,x,B,I){this.inputType=a,this.type=u,this.input=p,this.cases=x,this.outputs=B,this.otherwise=I};qa.parse=function(a,u){if(a.length<5)return u.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(a.length%2!=1)return u.error("Expected an even number of arguments.");var p,x;u.expectedType&&u.expectedType.kind!=="value"&&(x=u.expectedType);for(var B={},I=[],D=2;D<a.length-1;D+=2){var k=a[D],V=a[D+1];Array.isArray(k)||(k=[k]);var Q=u.concat(D);if(k.length===0)return Q.error("Expected at least one branch label.");for(var tt=0,ot=k;tt<ot.length;tt+=1){var dt=ot[tt];if(typeof dt!="number"&&typeof dt!="string")return Q.error("Branch labels must be numbers or strings.");if(typeof dt=="number"&&Math.abs(dt)>Number.MAX_SAFE_INTEGER)return Q.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof dt=="number"&&Math.floor(dt)!==dt)return Q.error("Numeric branch labels must be integer values.");if(p){if(Q.checkSubtype(p,Xn(dt)))return null}else p=Xn(dt);if(B[String(dt)]!==void 0)return Q.error("Branch labels must be unique.");B[String(dt)]=I.length}var _t=u.parse(V,D,x);if(!_t)return null;x=x||_t.type,I.push(_t)}var Nt=u.parse(a[1],1,ei);if(!Nt)return null;var Ut=u.parse(a[a.length-1],a.length-1,x);return Ut?Nt.type.kind!=="value"&&u.concat(1).checkSubtype(p,Nt.type)?null:new qa(p,x,Nt,B,I,Ut):null},qa.prototype.evaluate=function(a){var u=this.input.evaluate(a);return(Xn(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(a)},qa.prototype.eachChild=function(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)},qa.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})&&this.otherwise.outputDefined()},qa.prototype.serialize=function(){for(var a=this,u=["match",this.input.serialize()],p=[],x={},B=0,I=Object.keys(this.cases).sort();B<I.length;B+=1){var D=I[B];(ot=x[this.cases[D]])===void 0?(x[this.cases[D]]=p.length,p.push([this.cases[D],[D]])):p[ot][1].push(D)}for(var k=function(_t){return a.inputType.kind==="number"?Number(_t):_t},V=0,Q=p;V<Q.length;V+=1){var tt=Q[V],ot=tt[0],dt=tt[1];u.push(dt.length===1?k(dt[0]):dt.map(k)),u.push(this.outputs[outputIndex$1].serialize())}return u.push(this.otherwise.serialize()),u};var $a=function(a,u,p){this.type=a,this.branches=u,this.otherwise=p};$a.parse=function(a,u){if(a.length<4)return u.error("Expected at least 3 arguments, but found only "+(a.length-1)+".");if(a.length%2!=0)return u.error("Expected an odd number of arguments.");var p;u.expectedType&&u.expectedType.kind!=="value"&&(p=u.expectedType);for(var x=[],B=1;B<a.length-1;B+=2){var I=u.parse(a[B],B,Me);if(!I)return null;var D=u.parse(a[B+1],B+1,p);if(!D)return null;x.push([I,D]),p=p||D.type}var k=u.parse(a[a.length-1],a.length-1,p);return k?new $a(p,x,k):null},$a.prototype.evaluate=function(a){for(var u=0,p=this.branches;u<p.length;u+=1){var x=p[u],B=x[1];if(x[0].evaluate(a))return B.evaluate(a)}return this.otherwise.evaluate(a)},$a.prototype.eachChild=function(a){for(var u=0,p=this.branches;u<p.length;u+=1){var x=p[u],B=x[1];a(x[0]),a(B)}a(this.otherwise)},$a.prototype.outputDefined=function(){return this.branches.every(function(a){return a[1].outputDefined()})&&this.otherwise.outputDefined()},$a.prototype.serialize=function(){var a=["case"];return this.eachChild(function(u){a.push(u.serialize())}),a};var Ma=function(a,u,p,x){this.type=a,this.input=u,this.beginIndex=p,this.endIndex=x};function Ff(a,u){return a==="=="||a==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function kf(a,u,p,x){return x.compare(u,p)===0}function Mn(a,u,p){var x=a!=="=="&&a!=="!=";return function(){function B(I,D,k){this.type=Me,this.lhs=I,this.rhs=D,this.collator=k,this.hasUntypedArgument=I.type.kind==="value"||D.type.kind==="value"}return B.parse=function(I,D){if(I.length!==3&&I.length!==4)return D.error("Expected two or three arguments.");var k=I[0],V=D.parse(I[1],1,ei);if(!V)return null;if(!Ff(k,V.type))return D.concat(1).error('"'+k+`" comparisons are not supported for type '`+Gi(V.type)+"'.");var Q=D.parse(I[2],2,ei);if(!Q)return null;if(!Ff(k,Q.type))return D.concat(2).error('"'+k+`" comparisons are not supported for type '`+Gi(Q.type)+"'.");if(V.type.kind!==Q.type.kind&&V.type.kind!=="value"&&Q.type.kind!=="value")return D.error("Cannot compare types '"+Gi(V.type)+"' and '"+Gi(Q.type)+"'.");x&&(V.type.kind==="value"&&Q.type.kind!=="value"?V=new Dn(Q.type,[V]):V.type.kind!=="value"&&Q.type.kind==="value"&&(Q=new Dn(V.type,[Q])));var tt=null;if(I.length===4){if(V.type.kind!=="string"&&Q.type.kind!=="string"&&V.type.kind!=="value"&&Q.type.kind!=="value")return D.error("Cannot use collator to compare non-string types.");if(!(tt=D.parse(I[3],3,$i)))return null}return new B(V,Q,tt)},B.prototype.evaluate=function(I){var D=this.lhs.evaluate(I),k=this.rhs.evaluate(I);if(x&&this.hasUntypedArgument){var V=Xn(D),Q=Xn(k);if(V.kind!==Q.kind||V.kind!=="string"&&V.kind!=="number")throw new fr('Expected arguments for "'+a+'" to be (string, string) or (number, number), but found ('+V.kind+", "+Q.kind+") instead.")}if(this.collator&&!x&&this.hasUntypedArgument){var tt=Xn(D),ot=Xn(k);if(tt.kind!=="string"||ot.kind!=="string")return u(I,D,k)}return this.collator?p(I,D,k,this.collator.evaluate(I)):u(I,D,k)},B.prototype.eachChild=function(I){I(this.lhs),I(this.rhs),this.collator&&I(this.collator)},B.prototype.outputDefined=function(){return!0},B.prototype.serialize=function(){var I=[a];return this.eachChild(function(D){I.push(D.serialize())}),I},B}()}Ma.parse=function(a,u){if(a.length<=2||a.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var p=u.parse(a[1],1,ei),x=u.parse(a[2],2,fe);if(!p||!x)return null;if(!yi(p.type,[Ji(ei),ke,ei]))return u.error("Expected first argument to be of type array or string, but found "+Gi(p.type)+" instead");if(a.length===4){var B=u.parse(a[3],3,fe);return B?new Ma(p.type,p,x,B):null}return new Ma(p.type,p,x)},Ma.prototype.evaluate=function(a){var u=this.input.evaluate(a),p=this.beginIndex.evaluate(a);if(!Bt(u,["string","array"]))throw new fr("Expected first argument to be of type array or string, but found "+Gi(Xn(u))+" instead.");if(this.endIndex){var x=this.endIndex.evaluate(a);return u.slice(p,x)}return u.slice(p)},Ma.prototype.eachChild=function(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)},Ma.prototype.outputDefined=function(){return!1},Ma.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var pu=Mn("==",function(a,u,p){return u===p},kf),Au=Mn("!=",function(a,u,p){return u!==p},function(a,u,p,x){return!kf(0,u,p,x)}),Nf=Mn("<",function(a,u,p){return u<p},function(a,u,p,x){return x.compare(u,p)<0}),Uf=Mn(">",function(a,u,p){return u>p},function(a,u,p,x){return x.compare(u,p)>0}),Ol=Mn("<=",function(a,u,p){return u<=p},function(a,u,p,x){return x.compare(u,p)<=0}),Gf=Mn(">=",function(a,u,p){return u>=p},function(a,u,p,x){return x.compare(u,p)>=0}),qs=function(a,u,p,x,B){this.type=ke,this.number=a,this.locale=u,this.currency=p,this.minFractionDigits=x,this.maxFractionDigits=B};qs.parse=function(a,u){if(a.length!==3)return u.error("Expected two arguments.");var p=u.parse(a[1],1,fe);if(!p)return null;var x=a[2];if(typeof x!="object"||Array.isArray(x))return u.error("NumberFormat options argument must be an object.");var B=null;if(x.locale&&!(B=u.parse(x.locale,1,ke)))return null;var I=null;if(x.currency&&!(I=u.parse(x.currency,1,ke)))return null;var D=null;if(x["min-fraction-digits"]&&!(D=u.parse(x["min-fraction-digits"],1,fe)))return null;var k=null;return x["max-fraction-digits"]&&!(k=u.parse(x["max-fraction-digits"],1,fe))?null:new qs(p,B,I,D,k)},qs.prototype.evaluate=function(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))},qs.prototype.eachChild=function(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)},qs.prototype.outputDefined=function(){return!1},qs.prototype.serialize=function(){var a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]};var $s=function(a){this.type=fe,this.input=a};$s.parse=function(a,u){if(a.length!==2)return u.error("Expected 1 argument, but found "+(a.length-1)+" instead.");var p=u.parse(a[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?u.error("Expected argument of type string or array, but found "+Gi(p.type)+" instead."):new $s(p):null},$s.prototype.evaluate=function(a){var u=this.input.evaluate(a);if(typeof u=="string"||Array.isArray(u))return u.length;throw new fr("Expected value to be of type string or array, but found "+Gi(Xn(u))+" instead.")},$s.prototype.eachChild=function(a){a(this.input)},$s.prototype.outputDefined=function(){return!1},$s.prototype.serialize=function(){var a=["length"];return this.eachChild(function(u){a.push(u.serialize())}),a};var as={"==":pu,"!=":Au,">":Uf,"<":Nf,">=":Gf,"<=":Ol,array:Dn,at:Sa,boolean:Dn,case:$a,coalesce:Ba,collator:Jt,format:vo,image:Jr,in:Ya,"index-of":Ia,interpolate:Ur,"interpolate-hcl":Ur,"interpolate-lab":Ur,length:$s,let:Ta,literal:Lr,match:qa,number:Dn,"number-format":qs,object:Dn,slice:Ma,step:jn,string:Dn,"to-boolean":In,"to-color":In,"to-number":In,"to-string":In,var:Ea,within:Wo};function zf(a,u){var p=u[0],x=u[1],B=u[2],I=u[3];p=p.evaluate(a),x=x.evaluate(a),B=B.evaluate(a);var D=I?I.evaluate(a):1,k=Tt(p,x,B,D);if(k)throw new fr(k);return new tn(p/255*D,x/255*D,B/255*D,D)}function gu(a,u){return a in u}function mu(a,u){var p=u[a];return p===void 0?null:p}function tl(a){return{type:a}}function Bh(a){return{result:"success",value:a}}function ta(a){return{result:"error",value:a}}function ea(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function Ic(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function On(a){return!!a.expression&&a.expression.interpolated}function Nn(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function yu(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function cA(a){return a}function Ll(a,u,p){return a!==void 0?a:u!==void 0?u:p!==void 0?p:void 0}function Vf(a,u,p,x,B){return Ll(typeof p===B?x[p]:void 0,a.default,u.default)}function uA(a,u,p){if(Nn(p)!=="number")return Ll(a.default,u.default);var x=a.stops.length;if(x===1||p<=a.stops[0][0])return a.stops[0][1];if(p>=a.stops[x-1][0])return a.stops[x-1][1];var B=Ls(a.stops.map(function(I){return I[0]}),p);return a.stops[B][1]}function jf(a,u,p){var x=a.base!==void 0?a.base:1;if(Nn(p)!=="number")return Ll(a.default,u.default);var B=a.stops.length;if(B===1||p<=a.stops[0][0])return a.stops[0][1];if(p>=a.stops[B-1][0])return a.stops[B-1][1];var I=Ls(a.stops.map(function(ot){return ot[0]}),p),D=function(ot,dt,_t,Nt){var Ut=Nt-_t,Wt=ot-_t;return Ut===0?0:dt===1?Wt/Ut:(Math.pow(dt,Wt)-1)/(Math.pow(dt,Ut)-1)}(p,x,a.stops[I][0],a.stops[I+1][0]),k=a.stops[I][1],V=a.stops[I+1][1],Q=Za[u.type]||cA;if(a.colorSpace&&a.colorSpace!=="rgb"){var tt=Eh[a.colorSpace];Q=function(ot,dt){return tt.reverse(tt.interpolate(tt.forward(ot),tt.forward(dt),D))}}return typeof k.evaluate=="function"?{evaluate:function(){for(var ot=[],dt=arguments.length;dt--;)ot[dt]=arguments[dt];var _t=k.evaluate.apply(void 0,ot),Nt=V.evaluate.apply(void 0,ot);if(_t!==void 0&&Nt!==void 0)return Q(_t,Nt,D)}}:Q(k,V,D)}function io(a,u,p){return u.type==="color"?p=tn.parse(p):u.type==="formatted"?p=hr.fromString(p.toString()):u.type==="resolvedImage"?p=Jn.fromString(p.toString()):Nn(p)===u.type||u.type==="enum"&&u.values[p]||(p=void 0),Ll(p,a.default,u.default)}Pt.register(as,{error:[{kind:"error"},[ke],function(a,u){throw new fr(u[0].evaluate(a))}],typeof:[ke,[ei],function(a,u){return Gi(Xn(u[0].evaluate(a)))}],"to-rgba":[Ji(fe,4),[He],function(a,u){return u[0].evaluate(a).toArray()}],rgb:[He,[fe,fe,fe],zf],rgba:[He,[fe,fe,fe,fe],zf],has:{type:Me,overloads:[[[ke],function(a,u){return gu(u[0].evaluate(a),a.properties())}],[[ke,ki],function(a,u){var p=u[1];return gu(u[0].evaluate(a),p.evaluate(a))}]]},get:{type:ei,overloads:[[[ke],function(a,u){return mu(u[0].evaluate(a),a.properties())}],[[ke,ki],function(a,u){var p=u[1];return mu(u[0].evaluate(a),p.evaluate(a))}]]},"feature-state":[ei,[ke],function(a,u){return mu(u[0].evaluate(a),a.featureState||{})}],properties:[ki,[],function(a){return a.properties()}],"geometry-type":[ke,[],function(a){return a.geometryType()}],id:[ei,[],function(a){return a.id()}],zoom:[fe,[],function(a){return a.globals.zoom}],"heatmap-density":[fe,[],function(a){return a.globals.heatmapDensity||0}],"line-progress":[fe,[],function(a){return a.globals.lineProgress||0}],accumulated:[ei,[],function(a){return a.globals.accumulated===void 0?null:a.globals.accumulated}],"+":[fe,tl(fe),function(a,u){for(var p=0,x=0,B=u;x<B.length;x+=1)p+=B[x].evaluate(a);return p}],"*":[fe,tl(fe),function(a,u){for(var p=1,x=0,B=u;x<B.length;x+=1)p*=B[x].evaluate(a);return p}],"-":{type:fe,overloads:[[[fe,fe],function(a,u){var p=u[1];return u[0].evaluate(a)-p.evaluate(a)}],[[fe],function(a,u){return-u[0].evaluate(a)}]]},"/":[fe,[fe,fe],function(a,u){var p=u[1];return u[0].evaluate(a)/p.evaluate(a)}],"%":[fe,[fe,fe],function(a,u){var p=u[1];return u[0].evaluate(a)%p.evaluate(a)}],ln2:[fe,[],function(){return Math.LN2}],pi:[fe,[],function(){return Math.PI}],e:[fe,[],function(){return Math.E}],"^":[fe,[fe,fe],function(a,u){var p=u[1];return Math.pow(u[0].evaluate(a),p.evaluate(a))}],sqrt:[fe,[fe],function(a,u){return Math.sqrt(u[0].evaluate(a))}],log10:[fe,[fe],function(a,u){return Math.log(u[0].evaluate(a))/Math.LN10}],ln:[fe,[fe],function(a,u){return Math.log(u[0].evaluate(a))}],log2:[fe,[fe],function(a,u){return Math.log(u[0].evaluate(a))/Math.LN2}],sin:[fe,[fe],function(a,u){return Math.sin(u[0].evaluate(a))}],cos:[fe,[fe],function(a,u){return Math.cos(u[0].evaluate(a))}],tan:[fe,[fe],function(a,u){return Math.tan(u[0].evaluate(a))}],asin:[fe,[fe],function(a,u){return Math.asin(u[0].evaluate(a))}],acos:[fe,[fe],function(a,u){return Math.acos(u[0].evaluate(a))}],atan:[fe,[fe],function(a,u){return Math.atan(u[0].evaluate(a))}],min:[fe,tl(fe),function(a,u){return Math.min.apply(Math,u.map(function(p){return p.evaluate(a)}))}],max:[fe,tl(fe),function(a,u){return Math.max.apply(Math,u.map(function(p){return p.evaluate(a)}))}],abs:[fe,[fe],function(a,u){return Math.abs(u[0].evaluate(a))}],round:[fe,[fe],function(a,u){var p=u[0].evaluate(a);return p<0?-Math.round(-p):Math.round(p)}],floor:[fe,[fe],function(a,u){return Math.floor(u[0].evaluate(a))}],ceil:[fe,[fe],function(a,u){return Math.ceil(u[0].evaluate(a))}],"filter-==":[Me,[ke,ei],function(a,u){var p=u[0],x=u[1];return a.properties()[p.value]===x.value}],"filter-id-==":[Me,[ei],function(a,u){var p=u[0];return a.id()===p.value}],"filter-type-==":[Me,[ke],function(a,u){var p=u[0];return a.geometryType()===p.value}],"filter-<":[Me,[ke,ei],function(a,u){var p=u[0],x=u[1],B=a.properties()[p.value],I=x.value;return typeof B==typeof I&&B<I}],"filter-id-<":[Me,[ei],function(a,u){var p=u[0],x=a.id(),B=p.value;return typeof x==typeof B&&x<B}],"filter->":[Me,[ke,ei],function(a,u){var p=u[0],x=u[1],B=a.properties()[p.value],I=x.value;return typeof B==typeof I&&B>I}],"filter-id->":[Me,[ei],function(a,u){var p=u[0],x=a.id(),B=p.value;return typeof x==typeof B&&x>B}],"filter-<=":[Me,[ke,ei],function(a,u){var p=u[0],x=u[1],B=a.properties()[p.value],I=x.value;return typeof B==typeof I&&B<=I}],"filter-id-<=":[Me,[ei],function(a,u){var p=u[0],x=a.id(),B=p.value;return typeof x==typeof B&&x<=B}],"filter->=":[Me,[ke,ei],function(a,u){var p=u[0],x=u[1],B=a.properties()[p.value],I=x.value;return typeof B==typeof I&&B>=I}],"filter-id->=":[Me,[ei],function(a,u){var p=u[0],x=a.id(),B=p.value;return typeof x==typeof B&&x>=B}],"filter-has":[Me,[ei],function(a,u){return u[0].value in a.properties()}],"filter-has-id":[Me,[],function(a){return a.id()!==null&&a.id()!==void 0}],"filter-type-in":[Me,[Ji(ke)],function(a,u){return u[0].value.indexOf(a.geometryType())>=0}],"filter-id-in":[Me,[Ji(ei)],function(a,u){return u[0].value.indexOf(a.id())>=0}],"filter-in-small":[Me,[ke,Ji(ei)],function(a,u){var p=u[0];return u[1].value.indexOf(a.properties()[p.value])>=0}],"filter-in-large":[Me,[ke,Ji(ei)],function(a,u){var p=u[0],x=u[1];return function(B,I,D,k){for(;D<=k;){var V=D+k>>1;if(I[V]===B)return!0;I[V]>B?k=V-1:D=V+1}return!1}(a.properties()[p.value],x.value,0,x.value.length-1)}],all:{type:Me,overloads:[[[Me,Me],function(a,u){var p=u[1];return u[0].evaluate(a)&&p.evaluate(a)}],[tl(Me),function(a,u){for(var p=0,x=u;p<x.length;p+=1)if(!x[p].evaluate(a))return!1;return!0}]]},any:{type:Me,overloads:[[[Me,Me],function(a,u){var p=u[1];return u[0].evaluate(a)||p.evaluate(a)}],[tl(Me),function(a,u){for(var p=0,x=u;p<x.length;p+=1)if(x[p].evaluate(a))return!0;return!1}]]},"!":[Me,[Me],function(a,u){return!u[0].evaluate(a)}],"is-supported-script":[Me,[ke],function(a,u){var p=a.globals&&a.globals.isSupportedScript;return!p||p(u[0].evaluate(a))}],upcase:[ke,[ke],function(a,u){return u[0].evaluate(a).toUpperCase()}],downcase:[ke,[ke],function(a,u){return u[0].evaluate(a).toLowerCase()}],concat:[ke,tl(ei),function(a,u){return u.map(function(p){return Qs(p.evaluate(a))}).join("")}],"resolved-locale":[ke,[$i],function(a,u){return u[0].evaluate(a).resolvedLocale()}]});var Pa=function(a,u){this.expression=a,this._warningHistory={},this._evaluator=new gt,this._defaultValue=u?function(p){return p.type==="color"&&yu(p.default)?new tn(0,0,0,0):p.type==="color"?tn.parse(p.default)||null:p.default===void 0?null:p.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null};function Bs(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in as}function _u(a,u){var p=new br(as,[],u?function(B){var I={color:He,string:ke,number:fe,enum:ke,boolean:Me,formatted:ln,resolvedImage:Wi};return B.type==="array"?Ji(I[B.value]||ei,B.length):I[B.type]}(u):void 0),x=p.parse(a,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return x?Bh(new Pa(x,u)):ta(p.errors)}Pa.prototype.evaluateWithoutErrorHandling=function(a,u,p,x,B,I){return this._evaluator.globals=a,this._evaluator.feature=u,this._evaluator.featureState=p,this._evaluator.canonical=x,this._evaluator.availableImages=B||null,this._evaluator.formattedSection=I,this.expression.evaluate(this._evaluator)},Pa.prototype.evaluate=function(a,u,p,x,B,I){this._evaluator.globals=a,this._evaluator.feature=u||null,this._evaluator.featureState=p||null,this._evaluator.canonical=x,this._evaluator.availableImages=B||null,this._evaluator.formattedSection=I||null;try{var D=this.expression.evaluate(this._evaluator);if(D==null||typeof D=="number"&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new fr("Expected value to be one of "+Object.keys(this._enumValues).map(function(k){return JSON.stringify(k)}).join(", ")+", but found "+JSON.stringify(D)+" instead.");return D}catch(k){return this._warningHistory[k.message]||(this._warningHistory[k.message]=!0,typeof console<"u"&&console.warn(k.message)),this._defaultValue}};var el=function(a,u){this.kind=a,this._styleExpression=u,this.isStateDependent=a!=="constant"&&!Ca(u.expression)};el.prototype.evaluateWithoutErrorHandling=function(a,u,p,x,B,I){return this._styleExpression.evaluateWithoutErrorHandling(a,u,p,x,B,I)},el.prototype.evaluate=function(a,u,p,x,B,I){return this._styleExpression.evaluate(a,u,p,x,B,I)};var Fl=function(a,u,p,x){this.kind=a,this.zoomStops=p,this._styleExpression=u,this.isStateDependent=a!=="camera"&&!Ca(u.expression),this.interpolationType=x};function Jo(a,u){if((a=_u(a,u)).result==="error")return a;var p=a.value.expression,x=Zs(p);if(!x&&!ea(u))return ta([new Be("","data expressions not supported")]);var B=Qa(p,["zoom"]);if(!B&&!Ic(u))return ta([new Be("","zoom expressions not supported")]);var I=function D(k){var V=null;if(k instanceof Ta)V=D(k.result);else if(k instanceof Ba)for(var Q=0,tt=k.args;Q<tt.length&&!(V=D(tt[Q]));Q+=1);else(k instanceof jn||k instanceof Ur)&&k.input instanceof Pt&&k.input.name==="zoom"&&(V=k);return V instanceof Be||k.eachChild(function(ot){var dt=D(ot);dt instanceof Be?V=dt:!V&&dt?V=new Be("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):V&&dt&&V!==dt&&(V=new Be("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),V}(p);return I||B?I instanceof Be?ta([I]):I instanceof Ur&&!On(u)?ta([new Be("",'"interpolate" expressions cannot be used with this property')]):Bh(I?new Fl(x?"camera":"composite",a.value,I.labels,I instanceof Ur?I.interpolation:void 0):new el(x?"constant":"source",a.value)):ta([new Be("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Fl.prototype.evaluateWithoutErrorHandling=function(a,u,p,x,B,I){return this._styleExpression.evaluateWithoutErrorHandling(a,u,p,x,B,I)},Fl.prototype.evaluate=function(a,u,p,x,B,I){return this._styleExpression.evaluate(a,u,p,x,B,I)},Fl.prototype.interpolationFactor=function(a,u,p){return this.interpolationType?Ur.interpolationFactor(this.interpolationType,a,u,p):0};var il=function(a,u){this._parameters=a,this._specification=u,ut(this,function p(x,B){var I,D,k,V=B.type==="color",Q=x.stops&&typeof x.stops[0][0]=="object",tt=Q||!(Q||x.property!==void 0),ot=x.type||(On(B)?"exponential":"interval");if(V&&((x=ut({},x)).stops&&(x.stops=x.stops.map(function(ri){return[ri[0],tn.parse(ri[1])]})),x.default=tn.parse(x.default?x.default:B.default)),x.colorSpace&&x.colorSpace!=="rgb"&&!Eh[x.colorSpace])throw new Error("Unknown color space: "+x.colorSpace);if(ot==="exponential")I=jf;else if(ot==="interval")I=uA;else if(ot==="categorical"){I=Vf,D=Object.create(null);for(var dt=0,_t=x.stops;dt<_t.length;dt+=1){var Nt=_t[dt];D[Nt[0]]=Nt[1]}k=typeof x.stops[0][0]}else{if(ot!=="identity")throw new Error('Unknown function type "'+ot+'"');I=io}if(Q){for(var Ut={},Wt=[],jt=0;jt<x.stops.length;jt++){var Yt=x.stops[jt],le=Yt[0].zoom;Ut[le]===void 0&&(Ut[le]={zoom:le,type:x.type,property:x.property,default:x.default,stops:[]},Wt.push(le)),Ut[le].stops.push([Yt[0].value,Yt[1]])}for(var me=[],_e=0,Oe=Wt;_e<Oe.length;_e+=1){var Je=Oe[_e];me.push([Ut[Je].zoom,p(Ut[Je],B)])}var qe={name:"linear"};return{kind:"composite",interpolationType:qe,interpolationFactor:Ur.interpolationFactor.bind(void 0,qe),zoomStops:me.map(function(ri){return ri[0]}),evaluate:function(ri,Ei){var oi=ri.zoom;return jf({stops:me,base:x.base},B,oi).evaluate(oi,Ei)}}}if(tt){var bi=ot==="exponential"?{name:"exponential",base:x.base!==void 0?x.base:1}:null;return{kind:"camera",interpolationType:bi,interpolationFactor:Ur.interpolationFactor.bind(void 0,bi),zoomStops:x.stops.map(function(ri){return ri[0]}),evaluate:function(ri){return I(x,B,ri.zoom,D,k)}}}return{kind:"source",evaluate:function(ri,Ei){var oi=Ei&&Ei.properties?Ei.properties[x.property]:void 0;return oi===void 0?Ll(x.default,B.default):I(x,B,oi,D,k)}}}(this._parameters,this._specification))};function Xo(a){var u=a.key,p=a.value,x=a.valueSpec||{},B=a.objectElementValidators||{},I=a.style,D=a.styleSpec,k=[],V=Nn(p);if(V!=="object")return[new Et(u,p,"object expected, "+V+" found")];for(var Q in p){var tt=Q.split(".")[0],ot=x[tt]||x["*"],dt=void 0;if(B[tt])dt=B[tt];else if(x[tt])dt=un;else if(B["*"])dt=B["*"];else{if(!x["*"]){k.push(new Et(u,p[Q],'unknown property "'+Q+'"'));continue}dt=un}k=k.concat(dt({key:(u&&u+".")+Q,value:p[Q],valueSpec:ot,style:I,styleSpec:D,object:p,objectKey:Q},p))}for(var _t in x)B[_t]||x[_t].required&&x[_t].default===void 0&&p[_t]===void 0&&k.push(new Et(u,p,'missing required property "'+_t+'"'));return k}function nl(a){var u=a.value,p=a.valueSpec,x=a.style,B=a.styleSpec,I=a.key,D=a.arrayElementValidator||un;if(Nn(u)!=="array")return[new Et(I,u,"array expected, "+Nn(u)+" found")];if(p.length&&u.length!==p.length)return[new Et(I,u,"array length "+p.length+" expected, length "+u.length+" found")];if(p["min-length"]&&u.length<p["min-length"])return[new Et(I,u,"array length at least "+p["min-length"]+" expected, length "+u.length+" found")];var k={type:p.value,values:p.values};B.$version<7&&(k.function=p.function),Nn(p.value)==="object"&&(k=p.value);for(var V=[],Q=0;Q<u.length;Q++)V=V.concat(D({array:u,arrayIndex:Q,value:u[Q],valueSpec:k,style:x,styleSpec:B,key:I+"["+Q+"]"}));return V}function kl(a){var u=a.key,p=a.value,x=a.valueSpec,B=Nn(p);return B==="number"&&p!=p&&(B="NaN"),B!=="number"?[new Et(u,p,"number expected, "+B+" found")]:"minimum"in x&&p<x.minimum?[new Et(u,p,p+" is less than the minimum value "+x.minimum)]:"maximum"in x&&p>x.maximum?[new Et(u,p,p+" is greater than the maximum value "+x.maximum)]:[]}function Nl(a){var u,p,x,B=a.valueSpec,I=Ee(a.value.type),D={},k=I!=="categorical"&&a.value.property===void 0,V=!k,Q=Nn(a.value.stops)==="array"&&Nn(a.value.stops[0])==="array"&&Nn(a.value.stops[0][0])==="object",tt=Xo({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(_t){if(I==="identity")return[new Et(_t.key,_t.value,'identity function may not have a "stops" property')];var Nt=[],Ut=_t.value;return Nt=Nt.concat(nl({key:_t.key,value:Ut,valueSpec:_t.valueSpec,style:_t.style,styleSpec:_t.styleSpec,arrayElementValidator:ot})),Nn(Ut)==="array"&&Ut.length===0&&Nt.push(new Et(_t.key,Ut,"array must have at least one stop")),Nt},default:function(_t){return un({key:_t.key,value:_t.value,valueSpec:B,style:_t.style,styleSpec:_t.styleSpec})}}});return I==="identity"&&k&&tt.push(new Et(a.key,a.value,'missing required property "property"')),I==="identity"||a.value.stops||tt.push(new Et(a.key,a.value,'missing required property "stops"')),I==="exponential"&&a.valueSpec.expression&&!On(a.valueSpec)&&tt.push(new Et(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(V&&!ea(a.valueSpec)?tt.push(new Et(a.key,a.value,"property functions not supported")):k&&!Ic(a.valueSpec)&&tt.push(new Et(a.key,a.value,"zoom functions not supported"))),I!=="categorical"&&!Q||a.value.property!==void 0||tt.push(new Et(a.key,a.value,'"property" property is required')),tt;function ot(_t){var Nt=[],Ut=_t.value,Wt=_t.key;if(Nn(Ut)!=="array")return[new Et(Wt,Ut,"array expected, "+Nn(Ut)+" found")];if(Ut.length!==2)return[new Et(Wt,Ut,"array length 2 expected, length "+Ut.length+" found")];if(Q){if(Nn(Ut[0])!=="object")return[new Et(Wt,Ut,"object expected, "+Nn(Ut[0])+" found")];if(Ut[0].zoom===void 0)return[new Et(Wt,Ut,"object stop key must have zoom")];if(Ut[0].value===void 0)return[new Et(Wt,Ut,"object stop key must have value")];if(x&&x>Ee(Ut[0].zoom))return[new Et(Wt,Ut[0].zoom,"stop zoom values must appear in ascending order")];Ee(Ut[0].zoom)!==x&&(x=Ee(Ut[0].zoom),p=void 0,D={}),Nt=Nt.concat(Xo({key:Wt+"[0]",value:Ut[0],valueSpec:{zoom:{}},style:_t.style,styleSpec:_t.styleSpec,objectElementValidators:{zoom:kl,value:dt}}))}else Nt=Nt.concat(dt({key:Wt+"[0]",value:Ut[0],style:_t.style,styleSpec:_t.styleSpec},Ut));return Bs(Zt(Ut[1]))?Nt.concat([new Et(Wt+"[1]",Ut[1],"expressions are not allowed in function stops.")]):Nt.concat(un({key:Wt+"[1]",value:Ut[1],valueSpec:B,style:_t.style,styleSpec:_t.styleSpec}))}function dt(_t,Nt){var Ut=Nn(_t.value),Wt=Ee(_t.value),jt=_t.value!==null?_t.value:Nt;if(u){if(Ut!==u)return[new Et(_t.key,jt,Ut+" stop domain type must match previous stop domain type "+u)]}else u=Ut;if(Ut!=="number"&&Ut!=="string"&&Ut!=="boolean")return[new Et(_t.key,jt,"stop domain value must be a number, string, or boolean")];if(Ut!=="number"&&I!=="categorical"){var Yt="number expected, "+Ut+" found";return ea(B)&&I===void 0&&(Yt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Et(_t.key,jt,Yt)]}return I!=="categorical"||Ut!=="number"||isFinite(Wt)&&Math.floor(Wt)===Wt?I!=="categorical"&&Ut==="number"&&p!==void 0&&Wt<p?[new Et(_t.key,jt,"stop domain values must appear in ascending order")]:(p=Wt,I==="categorical"&&Wt in D?[new Et(_t.key,jt,"stop domain values must be unique")]:(D[Wt]=!0,[])):[new Et(_t.key,jt,"integer expected, found "+Wt)]}}function rl(a){var u=(a.expressionContext==="property"?Jo:_u)(Zt(a.value),a.valueSpec);if(u.result==="error")return u.value.map(function(x){return new Et(""+a.key+x.key,a.value,x.message)});var p=u.value.expression||u.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!p.outputDefined())return[new Et(a.key,a.value,'Invalid data expression for "'+a.propertyKey+'". Output values must be contained as literals within the expression.')];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!Ca(p))return[new Et(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!Ca(p))return[new Et(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Qa(p,["zoom","feature-state"]))return[new Et(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!Zs(p))return[new Et(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ul(a){var u=a.key,p=a.value,x=a.valueSpec,B=[];return Array.isArray(x.values)?x.values.indexOf(Ee(p))===-1&&B.push(new Et(u,p,"expected one of ["+x.values.join(", ")+"], "+JSON.stringify(p)+" found")):Object.keys(x.values).indexOf(Ee(p))===-1&&B.push(new Et(u,p,"expected one of ["+Object.keys(x.values).join(", ")+"], "+JSON.stringify(p)+" found")),B}function vu(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(var u=0,p=a.slice(1);u<p.length;u+=1){var x=p[u];if(!vu(x)&&typeof x!="boolean")return!1}return!0;default:return!0}}il.deserialize=function(a){return new il(a._parameters,a._specification)},il.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};var Mc={type:"boolean",default:!1};function bu(a){if(a==null)return{filter:function(){return!0},needGeometry:!1};vu(a)||(a=Pc(a));var u=_u(a,Mc);if(u.result==="error")throw new Error(u.value.map(function(p){return p.key+": "+p.message}).join(", "));return{filter:function(p,x,B){return u.value.evaluate(p,x,{},B)},needGeometry:function p(x){if(!Array.isArray(x))return!1;if(x[0]==="within")return!0;for(var B=1;B<x.length;B++)if(p(x[B]))return!0;return!1}(a)}}function hA(a,u){return a<u?-1:a>u?1:0}function Pc(a){if(!a)return!0;var u,p=a[0];return a.length<=1?p!=="any":p==="=="?xu(a[1],a[2],"=="):p==="!="?wu(xu(a[1],a[2],"==")):p==="<"||p===">"||p==="<="||p===">="?xu(a[1],a[2],p):p==="any"?(u=a.slice(1),["any"].concat(u.map(Pc))):p==="all"?["all"].concat(a.slice(1).map(Pc)):p==="none"?["all"].concat(a.slice(1).map(Pc).map(wu)):p==="in"?Gl(a[1],a.slice(2)):p==="!in"?wu(Gl(a[1],a.slice(2))):p==="has"?ol(a[1]):p==="!has"?wu(ol(a[1])):p!=="within"||a}function xu(a,u,p){switch(a){case"$type":return["filter-type-"+p,u];case"$id":return["filter-id-"+p,u];default:return["filter-"+p,a,u]}}function Gl(a,u){if(u.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(function(p){return typeof p!=typeof u[0]})?["filter-in-large",a,["literal",u.sort(hA)]]:["filter-in-small",a,["literal",u]]}}function ol(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function wu(a){return["!",a]}function sl(a){return vu(Zt(a.value))?rl(ut({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function u(p){var x=p.value,B=p.key;if(Nn(x)!=="array")return[new Et(B,x,"array expected, "+Nn(x)+" found")];var I,D=p.styleSpec,k=[];if(x.length<1)return[new Et(B,x,"filter array must have at least 1 element")];switch(k=k.concat(Ul({key:B+"[0]",value:x[0],valueSpec:D.filter_operator,style:p.style,styleSpec:p.styleSpec})),Ee(x[0])){case"<":case"<=":case">":case">=":x.length>=2&&Ee(x[1])==="$type"&&k.push(new Et(B,x,'"$type" cannot be use with operator "'+x[0]+'"'));case"==":case"!=":x.length!==3&&k.push(new Et(B,x,'filter array for operator "'+x[0]+'" must have 3 elements'));case"in":case"!in":x.length>=2&&(I=Nn(x[1]))!=="string"&&k.push(new Et(B+"[1]",x[1],"string expected, "+I+" found"));for(var V=2;V<x.length;V++)I=Nn(x[V]),Ee(x[1])==="$type"?k=k.concat(Ul({key:B+"["+V+"]",value:x[V],valueSpec:D.geometry_type,style:p.style,styleSpec:p.styleSpec})):I!=="string"&&I!=="number"&&I!=="boolean"&&k.push(new Et(B+"["+V+"]",x[V],"string, number, or boolean expected, "+I+" found"));break;case"any":case"all":case"none":for(var Q=1;Q<x.length;Q++)k=k.concat(u({key:B+"["+Q+"]",value:x[Q],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":I=Nn(x[1]),x.length!==2?k.push(new Et(B,x,'filter array for "'+x[0]+'" operator must have 2 elements')):I!=="string"&&k.push(new Et(B+"[1]",x[1],"string expected, "+I+" found"));break;case"within":I=Nn(x[1]),x.length!==2?k.push(new Et(B,x,'filter array for "'+x[0]+'" operator must have 2 elements')):I!=="object"&&k.push(new Et(B+"[1]",x[1],"object expected, "+I+" found"))}return k}(a)}function Th(a,u){var p=a.key,x=a.style,B=a.styleSpec,I=a.value,D=a.objectKey,k=B[u+"_"+a.layerType];if(!k)return[];var V=D.match(/^(.*)-transition$/);if(u==="paint"&&V&&k[V[1]]&&k[V[1]].transition)return un({key:p,value:I,valueSpec:B.transition,style:x,styleSpec:B});var Q,tt=a.valueSpec||k[D];if(!tt)return[new Et(p,I,'unknown property "'+D+'"')];if(Nn(I)==="string"&&ea(tt)&&!tt.tokens&&(Q=/^{([^}]+)}$/.exec(I)))return[new Et(p,I,'"'+D+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(Q[1])+" }`.")];var ot=[];return a.layerType==="symbol"&&(D==="text-field"&&x&&!x.glyphs&&ot.push(new Et(p,I,'use of "text-field" requires a style "glyphs" property')),D==="text-font"&&yu(Zt(I))&&Ee(I.type)==="identity"&&ot.push(new Et(p,I,'"text-font" does not support identity functions'))),ot.concat(un({key:a.key,value:I,valueSpec:tt,style:x,styleSpec:B,expressionContext:"property",propertyType:u,propertyKey:D}))}function Sh(a){return Th(a,"paint")}function Rc(a){return Th(a,"layout")}function Hf(a){var u=[],p=a.value,x=a.key,B=a.style,I=a.styleSpec;p.type||p.ref||u.push(new Et(x,p,'either "type" or "ref" is required'));var D,k=Ee(p.type),V=Ee(p.ref);if(p.id)for(var Q=Ee(p.id),tt=0;tt<a.arrayIndex;tt++){var ot=B.layers[tt];Ee(ot.id)===Q&&u.push(new Et(x,p.id,'duplicate layer id "'+p.id+'", previously used at line '+ot.id.__line__))}if("ref"in p)["type","source","source-layer","filter","layout"].forEach(function(Nt){Nt in p&&u.push(new Et(x,p[Nt],'"'+Nt+'" is prohibited for ref layers'))}),B.layers.forEach(function(Nt){Ee(Nt.id)===V&&(D=Nt)}),D?D.ref?u.push(new Et(x,p.ref,"ref cannot reference another ref layer")):k=Ee(D.type):u.push(new Et(x,p.ref,'ref layer "'+V+'" not found'));else if(k!=="background")if(p.source){var dt=B.sources&&B.sources[p.source],_t=dt&&Ee(dt.type);dt?_t==="vector"&&k==="raster"?u.push(new Et(x,p.source,'layer "'+p.id+'" requires a raster source')):_t==="raster"&&k!=="raster"?u.push(new Et(x,p.source,'layer "'+p.id+'" requires a vector source')):_t!=="vector"||p["source-layer"]?_t==="raster-dem"&&k!=="hillshade"?u.push(new Et(x,p.source,"raster-dem source can only be used with layer type 'hillshade'.")):k!=="line"||!p.paint||!p.paint["line-gradient"]||_t==="geojson"&&dt.lineMetrics||u.push(new Et(x,p,'layer "'+p.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):u.push(new Et(x,p,'layer "'+p.id+'" must specify a "source-layer"')):u.push(new Et(x,p.source,'source "'+p.source+'" not found'))}else u.push(new Et(x,p,'missing required property "source"'));return u=u.concat(Xo({key:x,value:p,valueSpec:I.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return un({key:x+".type",value:p.type,valueSpec:I.layer.type,style:a.style,styleSpec:a.styleSpec,object:p,objectKey:"type"})},filter:sl,layout:function(Nt){return Xo({layer:p,key:Nt.key,value:Nt.value,style:Nt.style,styleSpec:Nt.styleSpec,objectElementValidators:{"*":function(Ut){return Rc(ut({layerType:k},Ut))}}})},paint:function(Nt){return Xo({layer:p,key:Nt.key,value:Nt.value,style:Nt.style,styleSpec:Nt.styleSpec,objectElementValidators:{"*":function(Ut){return Sh(ut({layerType:k},Ut))}}})}}}))}function al(a){var u=a.value,p=a.key,x=Nn(u);return x!=="string"?[new Et(p,u,"string expected, "+x+" found")]:[]}var Kn={promoteId:function(a){var u=a.key,p=a.value;if(Nn(p)==="string")return al({key:u,value:p});var x=[];for(var B in p)x.push.apply(x,al({key:u+"."+B,value:p[B]}));return x}};function Cu(a){var u=a.value,p=a.key,x=a.styleSpec,B=a.style;if(!u.type)return[new Et(p,u,'"type" is required')];var I,D=Ee(u.type);switch(D){case"vector":case"raster":case"raster-dem":return Xo({key:p,value:u,valueSpec:x["source_"+D.replace("-","_")],style:a.style,styleSpec:x,objectElementValidators:Kn});case"geojson":if(I=Xo({key:p,value:u,valueSpec:x.source_geojson,style:B,styleSpec:x,objectElementValidators:Kn}),u.cluster)for(var k in u.clusterProperties){var V=u.clusterProperties[k],Q=V[0],tt=typeof Q=="string"?[Q,["accumulated"],["get",k]]:Q;I.push.apply(I,rl({key:p+"."+k+".map",value:V[1],expressionContext:"cluster-map"})),I.push.apply(I,rl({key:p+"."+k+".reduce",value:tt,expressionContext:"cluster-reduce"}))}return I;case"video":return Xo({key:p,value:u,valueSpec:x.source_video,style:B,styleSpec:x});case"image":return Xo({key:p,value:u,valueSpec:x.source_image,style:B,styleSpec:x});case"canvas":return[new Et(p,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ul({key:p+".type",value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function ia(a){var u=a.value,p=a.styleSpec,x=p.light,B=a.style,I=[],D=Nn(u);if(u===void 0)return I;if(D!=="object")return I.concat([new Et("light",u,"object expected, "+D+" found")]);for(var k in u){var V=k.match(/^(.*)-transition$/);I=I.concat(V&&x[V[1]]&&x[V[1]].transition?un({key:k,value:u[k],valueSpec:p.transition,style:B,styleSpec:p}):x[k]?un({key:k,value:u[k],valueSpec:x[k],style:B,styleSpec:p}):[new Et(k,u[k],'unknown property "'+k+'"')])}return I}var na={"*":function(){return[]},array:nl,boolean:function(a){var u=a.value,p=a.key,x=Nn(u);return x!=="boolean"?[new Et(p,u,"boolean expected, "+x+" found")]:[]},number:kl,color:function(a){var u=a.key,p=a.value,x=Nn(p);return x!=="string"?[new Et(u,p,"color expected, "+x+" found")]:Qe(p)===null?[new Et(u,p,'color expected, "'+p+'" found')]:[]},constants:g,enum:Ul,filter:sl,function:Nl,layer:Hf,object:Xo,source:Cu,light:ia,string:al,formatted:function(a){return al(a).length===0?[]:rl(a)},resolvedImage:function(a){return al(a).length===0?[]:rl(a)}};function un(a){var u=a.value,p=a.valueSpec,x=a.styleSpec;return p.expression&&yu(Ee(u))?Nl(a):p.expression&&Bs(Zt(u))?rl(a):p.type&&na[p.type]?na[p.type](a):Xo(ut({},a,{valueSpec:p.type?x[p.type]:p}))}function Un(a){var u=a.value,p=a.key,x=al(a);return x.length||(u.indexOf("{fontstack}")===-1&&x.push(new Et(p,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&x.push(new Et(p,u,'"glyphs" url must include a "{range}" token'))),x}function Ko(a,u){u===void 0&&(u=lt);var p=[];return p=p.concat(un({key:"",value:a,valueSpec:u.$root,styleSpec:u,style:a,objectElementValidators:{glyphs:Un,"*":function(){return[]}}})),a.constants&&(p=p.concat(g({key:"constants",value:a.constants}))),Dc(p)}function Dc(a){return[].concat(a).sort(function(u,p){return u.line-p.line})}function zl(a){return function(){for(var u=[],p=arguments.length;p--;)u[p]=arguments[p];return Dc(a.apply(this,u))}}Ko.source=zl(Cu),Ko.light=zl(ia),Ko.layer=zl(Hf),Ko.filter=zl(sl),Ko.paintProperty=zl(Sh),Ko.layoutProperty=zl(Rc);var Oc=Ko,fA=Oc.light,dA=Oc.paintProperty,Vl=Oc.layoutProperty;function Lc(a,u){var p=!1;if(u&&u.length)for(var x=0,B=u;x<B.length;x+=1)a.fire(new pt(new Error(B[x].message))),p=!0;return p}var Fs=Gn;function Gn(a,u,p){var x=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var B=new Int32Array(this.arrayBuffer);a=B[0],this.d=(u=B[1])+2*(p=B[2]);for(var I=0;I<this.d*this.d;I++){var D=B[3+I],k=B[3+I+1];x.push(D===k?null:B.subarray(D,k))}var V=B[3+x.length+1];this.keys=B.subarray(B[3+x.length],V),this.bboxes=B.subarray(V),this.insert=this._insertReadonly}else{this.d=u+2*p;for(var Q=0;Q<this.d*this.d;Q++)x.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=a,this.padding=p,this.scale=u/a,this.uid=0;var tt=p/u*a;this.min=-tt,this.max=a+tt}Gn.prototype.insert=function(a,u,p,x,B){this._forEachCell(u,p,x,B,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(B)},Gn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Gn.prototype._insertCell=function(a,u,p,x,B,I){this.cells[B].push(I)},Gn.prototype.query=function(a,u,p,x,B){var I=this.min,D=this.max;if(a<=I&&u<=I&&D<=p&&D<=x&&!B)return Array.prototype.slice.call(this.keys);var k=[];return this._forEachCell(a,u,p,x,this._queryCell,k,{},B),k},Gn.prototype._queryCell=function(a,u,p,x,B,I,D,k){var V=this.cells[B];if(V!==null)for(var Q=this.keys,tt=this.bboxes,ot=0;ot<V.length;ot++){var dt=V[ot];if(D[dt]===void 0){var _t=4*dt;(k?k(tt[_t+0],tt[_t+1],tt[_t+2],tt[_t+3]):a<=tt[_t+2]&&u<=tt[_t+3]&&p>=tt[_t+0]&&x>=tt[_t+1])?(D[dt]=!0,I.push(Q[dt])):D[dt]=!1}}},Gn.prototype._forEachCell=function(a,u,p,x,B,I,D,k){for(var V=this._convertToCellCoord(a),Q=this._convertToCellCoord(u),tt=this._convertToCellCoord(p),ot=this._convertToCellCoord(x),dt=V;dt<=tt;dt++)for(var _t=Q;_t<=ot;_t++){var Nt=this.d*_t+dt;if((!k||k(this._convertFromCellCoord(dt),this._convertFromCellCoord(_t),this._convertFromCellCoord(dt+1),this._convertFromCellCoord(_t+1)))&&B.call(this,a,u,p,x,Nt,I,D,k))return}},Gn.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Gn.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Gn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,u=3+this.cells.length+1+1,p=0,x=0;x<this.cells.length;x++)p+=this.cells[x].length;var B=new Int32Array(u+p+this.keys.length+this.bboxes.length);B[0]=this.extent,B[1]=this.n,B[2]=this.padding;for(var I=u,D=0;D<a.length;D++){var k=a[D];B[3+D]=I,B.set(k,I),I+=k.length}return B[3+a.length]=I,B.set(this.keys,I),B[3+a.length+1]=I+=this.keys.length,B.set(this.bboxes,I),I+=this.bboxes.length,B.buffer};var jl=S.ImageData,Wf=S.ImageBitmap,Er={};function ai(a,u,p){p===void 0&&(p={}),Object.defineProperty(u,"_classRegistryKey",{value:a,writeable:!1}),Er[a]={klass:u,omit:p.omit||[],shallow:p.shallow||[]}}for(var Ro in ai("Object",Object),Fs.serialize=function(a,u){var p=a.toArrayBuffer();return u&&u.push(p),{buffer:p}},Fs.deserialize=function(a){return new Fs(a.buffer)},ai("Grid",Fs),ai("Color",tn),ai("Error",Error),ai("ResolvedImage",Jn),ai("StylePropertyFunction",il),ai("StyleExpression",Pa,{omit:["_evaluator"]}),ai("ZoomDependentExpression",Fl),ai("ZoomConstantExpression",el),ai("CompoundExpression",Pt,{omit:["_evaluate"]}),as)as[Ro]._classRegistryKey||ai("Expression_"+Ro,as[Ro]);function Eu(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Qo(a){return Wf&&a instanceof Wf}function ls(a,u){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Eu(a)||Qo(a))return u&&u.push(a),a;if(ArrayBuffer.isView(a)){var p=a;return u&&u.push(p.buffer),p}if(a instanceof jl)return u&&u.push(a.data.buffer),a;if(Array.isArray(a)){for(var x=[],B=0,I=a;B<I.length;B+=1)x.push(ls(I[B],u));return x}if(typeof a=="object"){var D=a.constructor,k=D._classRegistryKey;if(!k)throw new Error("can't serialize object of unregistered class");var V=D.serialize?D.serialize(a,u):{};if(!D.serialize){for(var Q in a)if(a.hasOwnProperty(Q)&&!(Er[k].omit.indexOf(Q)>=0)){var tt=a[Q];V[Q]=Er[k].shallow.indexOf(Q)>=0?tt:ls(tt,u)}a instanceof Error&&(V.message=a.message)}if(V.$name)throw new Error("$name property is reserved for worker serialization logic.");return k!=="Object"&&(V.$name=k),V}throw new Error("can't serialize object of type "+typeof a)}function bo(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Eu(a)||Qo(a)||ArrayBuffer.isView(a)||a instanceof jl)return a;if(Array.isArray(a))return a.map(bo);if(typeof a=="object"){var u=a.$name||"Object",p=Er[u].klass;if(!p)throw new Error("can't deserialize unregistered class "+u);if(p.deserialize)return p.deserialize(a);for(var x=Object.create(p.prototype),B=0,I=Object.keys(a);B<I.length;B+=1){var D=I[B];if(D!=="$name"){var k=a[D];x[D]=Er[u].shallow.indexOf(D)>=0?k:bo(k)}}return x}throw new Error("can't deserialize object of type "+typeof a)}var Ih=function(){this.first=!0};Ih.prototype.update=function(a,u){var p=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=u),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=p,!0))};var $e={"Latin-1 Supplement":function(a){return a>=128&&a<=255},Arabic:function(a){return a>=1536&&a<=1791},"Arabic Supplement":function(a){return a>=1872&&a<=1919},"Arabic Extended-A":function(a){return a>=2208&&a<=2303},"Hangul Jamo":function(a){return a>=4352&&a<=4607},"Unified Canadian Aboriginal Syllabics":function(a){return a>=5120&&a<=5759},Khmer:function(a){return a>=6016&&a<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(a){return a>=6320&&a<=6399},"General Punctuation":function(a){return a>=8192&&a<=8303},"Letterlike Symbols":function(a){return a>=8448&&a<=8527},"Number Forms":function(a){return a>=8528&&a<=8591},"Miscellaneous Technical":function(a){return a>=8960&&a<=9215},"Control Pictures":function(a){return a>=9216&&a<=9279},"Optical Character Recognition":function(a){return a>=9280&&a<=9311},"Enclosed Alphanumerics":function(a){return a>=9312&&a<=9471},"Geometric Shapes":function(a){return a>=9632&&a<=9727},"Miscellaneous Symbols":function(a){return a>=9728&&a<=9983},"Miscellaneous Symbols and Arrows":function(a){return a>=11008&&a<=11263},"CJK Radicals Supplement":function(a){return a>=11904&&a<=12031},"Kangxi Radicals":function(a){return a>=12032&&a<=12255},"Ideographic Description Characters":function(a){return a>=12272&&a<=12287},"CJK Symbols and Punctuation":function(a){return a>=12288&&a<=12351},Hiragana:function(a){return a>=12352&&a<=12447},Katakana:function(a){return a>=12448&&a<=12543},Bopomofo:function(a){return a>=12544&&a<=12591},"Hangul Compatibility Jamo":function(a){return a>=12592&&a<=12687},Kanbun:function(a){return a>=12688&&a<=12703},"Bopomofo Extended":function(a){return a>=12704&&a<=12735},"CJK Strokes":function(a){return a>=12736&&a<=12783},"Katakana Phonetic Extensions":function(a){return a>=12784&&a<=12799},"Enclosed CJK Letters and Months":function(a){return a>=12800&&a<=13055},"CJK Compatibility":function(a){return a>=13056&&a<=13311},"CJK Unified Ideographs Extension A":function(a){return a>=13312&&a<=19903},"Yijing Hexagram Symbols":function(a){return a>=19904&&a<=19967},"CJK Unified Ideographs":function(a){return a>=19968&&a<=40959},"Yi Syllables":function(a){return a>=40960&&a<=42127},"Yi Radicals":function(a){return a>=42128&&a<=42191},"Hangul Jamo Extended-A":function(a){return a>=43360&&a<=43391},"Hangul Syllables":function(a){return a>=44032&&a<=55215},"Hangul Jamo Extended-B":function(a){return a>=55216&&a<=55295},"Private Use Area":function(a){return a>=57344&&a<=63743},"CJK Compatibility Ideographs":function(a){return a>=63744&&a<=64255},"Arabic Presentation Forms-A":function(a){return a>=64336&&a<=65023},"Vertical Forms":function(a){return a>=65040&&a<=65055},"CJK Compatibility Forms":function(a){return a>=65072&&a<=65103},"Small Form Variants":function(a){return a>=65104&&a<=65135},"Arabic Presentation Forms-B":function(a){return a>=65136&&a<=65279},"Halfwidth and Fullwidth Forms":function(a){return a>=65280&&a<=65519}};function Mh(a){for(var u=0,p=a;u<p.length;u+=1)if(Bu(p[u].charCodeAt(0)))return!0;return!1}function Bu(a){return!(a!==746&&a!==747&&(a<4352||!($e["Bopomofo Extended"](a)||$e.Bopomofo(a)||$e["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||$e["CJK Compatibility Ideographs"](a)||$e["CJK Compatibility"](a)||$e["CJK Radicals Supplement"](a)||$e["CJK Strokes"](a)||!(!$e["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||$e["CJK Unified Ideographs Extension A"](a)||$e["CJK Unified Ideographs"](a)||$e["Enclosed CJK Letters and Months"](a)||$e["Hangul Compatibility Jamo"](a)||$e["Hangul Jamo Extended-A"](a)||$e["Hangul Jamo Extended-B"](a)||$e["Hangul Jamo"](a)||$e["Hangul Syllables"](a)||$e.Hiragana(a)||$e["Ideographic Description Characters"](a)||$e.Kanbun(a)||$e["Kangxi Radicals"](a)||$e["Katakana Phonetic Extensions"](a)||$e.Katakana(a)&&a!==12540||!(!$e["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!$e["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||$e["Unified Canadian Aboriginal Syllabics"](a)||$e["Unified Canadian Aboriginal Syllabics Extended"](a)||$e["Vertical Forms"](a)||$e["Yijing Hexagram Symbols"](a)||$e["Yi Syllables"](a)||$e["Yi Radicals"](a))))}function Ph(a){return!(Bu(a)||function(u){return!!($e["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||$e["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||$e["Letterlike Symbols"](u)||$e["Number Forms"](u)||$e["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||$e["Control Pictures"](u)&&u!==9251||$e["Optical Character Recognition"](u)||$e["Enclosed Alphanumerics"](u)||$e["Geometric Shapes"](u)||$e["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||$e["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||$e["CJK Symbols and Punctuation"](u)||$e.Katakana(u)||$e["Private Use Area"](u)||$e["CJK Compatibility Forms"](u)||$e["Small Form Variants"](u)||$e["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)}(a))}function cs(a){return a>=1424&&a<=2303||$e["Arabic Presentation Forms-A"](a)||$e["Arabic Presentation Forms-B"](a)}function Do(a,u){return!(!u&&cs(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||$e.Khmer(a))}function Tu(a){for(var u=0,p=a;u<p.length;u+=1)if(cs(p[u].charCodeAt(0)))return!0;return!1}var Su=null,Oo="unavailable",ra=null,Rh=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Oo="error"),Su&&Su(a)};function Hl(){Br.fire(new Ft("pluginStateChange",{pluginStatus:Oo,pluginURL:ra}))}var Br=new bt,Dh=function(){return Oo},Ts=function(){if(Oo!=="deferred"||!ra)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Oo="loading",Hl(),ra&&Kt({url:ra},function(a){a?Rh(a):(Oo="loaded",Hl())})},no={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Oo==="loaded"||no.applyArabicShaping!=null},isLoading:function(){return Oo==="loading"},setState:function(a){Oo=a.pluginStatus,ra=a.pluginURL},isParsed:function(){return no.applyArabicShaping!=null&&no.processBidirectionalText!=null&&no.processStyledBidirectionalText!=null},getPluginURL:function(){return ra}},Vi=function(a,u){this.zoom=a,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ih,this.transition={})};Vi.prototype.isSupportedScript=function(a){return function(u,p){for(var x=0,B=u;x<B.length;x+=1)if(!Do(B[x].charCodeAt(0),p))return!1;return!0}(a,no.isLoaded())},Vi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Vi.prototype.getCrossfadeParameters=function(){var a=this.zoom,u=a-Math.floor(a),p=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*u}};var ks=function(a,u){this.property=a,this.value=u,this.expression=function(p,x){if(yu(p))return new il(p,x);if(Bs(p)){var B=Jo(p,x);if(B.result==="error")throw new Error(B.value.map(function(D){return D.key+": "+D.message}).join(", "));return B.value}var I=p;return typeof p=="string"&&x.type==="color"&&(I=tn.parse(p)),{kind:"constant",evaluate:function(){return I}}}(u===void 0?a.specification.default:u,a.specification)};ks.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},ks.prototype.possiblyEvaluate=function(a,u,p){return this.property.possiblyEvaluate(this,a,u,p)};var us=function(a){this.property=a,this.value=new ks(a,void 0)};us.prototype.transitioned=function(a,u){return new Ra(this.property,this.value,u,q({},a.transition,this.transition),a.now)},us.prototype.untransitioned=function(){return new Ra(this.property,this.value,null,{},0)};var Xr=function(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)};Xr.prototype.getValue=function(a){return kt(this._values[a].value.value)},Xr.prototype.setValue=function(a,u){this._values.hasOwnProperty(a)||(this._values[a]=new us(this._values[a].property)),this._values[a].value=new ks(this._values[a].property,u===null?void 0:kt(u))},Xr.prototype.getTransition=function(a){return kt(this._values[a].transition)},Xr.prototype.setTransition=function(a,u){this._values.hasOwnProperty(a)||(this._values[a]=new us(this._values[a].property)),this._values[a].transition=kt(u)||void 0},Xr.prototype.serialize=function(){for(var a={},u=0,p=Object.keys(this._values);u<p.length;u+=1){var x=p[u],B=this.getValue(x);B!==void 0&&(a[x]=B);var I=this.getTransition(x);I!==void 0&&(a[x+"-transition"]=I)}return a},Xr.prototype.transitioned=function(a,u){for(var p=new oa(this._properties),x=0,B=Object.keys(this._values);x<B.length;x+=1){var I=B[x];p._values[I]=this._values[I].transitioned(a,u._values[I])}return p},Xr.prototype.untransitioned=function(){for(var a=new oa(this._properties),u=0,p=Object.keys(this._values);u<p.length;u+=1){var x=p[u];a._values[x]=this._values[x].untransitioned()}return a};var Ra=function(a,u,p,x,B){this.property=a,this.value=u,this.begin=B+x.delay||0,this.end=this.begin+x.duration||0,a.specification.transition&&(x.delay||x.duration)&&(this.prior=p)};Ra.prototype.possiblyEvaluate=function(a,u,p){var x=a.now||0,B=this.value.possiblyEvaluate(a,u,p),I=this.prior;if(I){if(x>this.end)return this.prior=null,B;if(this.value.isDataDriven())return this.prior=null,B;if(x<this.begin)return I.possiblyEvaluate(a,u,p);var D=(x-this.begin)/(this.end-this.begin);return this.property.interpolate(I.possiblyEvaluate(a,u,p),B,function(k){if(k<=0)return 0;if(k>=1)return 1;var V=k*k,Q=V*k;return 4*(k<.5?Q:3*(k-V)+Q-.75)}(D))}return B};var oa=function(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)};oa.prototype.possiblyEvaluate=function(a,u,p){for(var x=new Fc(this._properties),B=0,I=Object.keys(this._values);B<I.length;B+=1){var D=I[B];x._values[D]=this._values[D].possiblyEvaluate(a,u,p)}return x},oa.prototype.hasTransition=function(){for(var a=0,u=Object.keys(this._values);a<u.length;a+=1)if(this._values[u[a]].prior)return!0;return!1};var hs=function(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)};hs.prototype.getValue=function(a){return kt(this._values[a].value)},hs.prototype.setValue=function(a,u){this._values[a]=new ks(this._values[a].property,u===null?void 0:kt(u))},hs.prototype.serialize=function(){for(var a={},u=0,p=Object.keys(this._values);u<p.length;u+=1){var x=p[u],B=this.getValue(x);B!==void 0&&(a[x]=B)}return a},hs.prototype.possiblyEvaluate=function(a,u,p){for(var x=new Fc(this._properties),B=0,I=Object.keys(this._values);B<I.length;B+=1){var D=I[B];x._values[D]=this._values[D].possiblyEvaluate(a,u,p)}return x};var ro=function(a,u,p){this.property=a,this.value=u,this.parameters=p};ro.prototype.isConstant=function(){return this.value.kind==="constant"},ro.prototype.constantOr=function(a){return this.value.kind==="constant"?this.value.value:a},ro.prototype.evaluate=function(a,u,p,x){return this.property.evaluate(this.value,this.parameters,a,u,p,x)};var Fc=function(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)};Fc.prototype.get=function(a){return this._values[a]};var xi=function(a){this.specification=a};xi.prototype.possiblyEvaluate=function(a,u){return a.expression.evaluate(u)},xi.prototype.interpolate=function(a,u,p){var x=Za[this.specification.type];return x?x(a,u,p):a};var ui=function(a,u){this.specification=a,this.overrides=u};ui.prototype.possiblyEvaluate=function(a,u,p,x){return new ro(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(u,null,{},p,x)}:a.expression,u)},ui.prototype.interpolate=function(a,u,p){if(a.value.kind!=="constant"||u.value.kind!=="constant")return a;if(a.value.value===void 0||u.value.value===void 0)return new ro(this,{kind:"constant",value:void 0},a.parameters);var x=Za[this.specification.type];return x?new ro(this,{kind:"constant",value:x(a.value.value,u.value.value,p)},a.parameters):a},ui.prototype.evaluate=function(a,u,p,x,B,I){return a.kind==="constant"?a.value:a.evaluate(u,p,x,B,I)};var Iu=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(p,x,B,I){if(p.value===void 0)return new ro(this,{kind:"constant",value:void 0},x);if(p.expression.kind==="constant"){var D=p.expression.evaluate(x,null,{},B,I),k=p.property.specification.type==="resolvedImage"&&typeof D!="string"?D.name:D,V=this._calculate(k,k,k,x);return new ro(this,{kind:"constant",value:V},x)}if(p.expression.kind==="camera"){var Q=this._calculate(p.expression.evaluate({zoom:x.zoom-1}),p.expression.evaluate({zoom:x.zoom}),p.expression.evaluate({zoom:x.zoom+1}),x);return new ro(this,{kind:"constant",value:Q},x)}return new ro(this,p.expression,x)},u.prototype.evaluate=function(p,x,B,I,D,k){if(p.kind==="source"){var V=p.evaluate(x,B,I,D,k);return this._calculate(V,V,V,x)}return p.kind==="composite"?this._calculate(p.evaluate({zoom:Math.floor(x.zoom)-1},B,I),p.evaluate({zoom:Math.floor(x.zoom)},B,I),p.evaluate({zoom:Math.floor(x.zoom)+1},B,I),x):p.value},u.prototype._calculate=function(p,x,B,I){return I.zoom>I.zoomHistory.lastIntegerZoom?{from:p,to:x}:{from:B,to:x}},u.prototype.interpolate=function(p){return p},u}(ui),fo=function(a){this.specification=a};fo.prototype.possiblyEvaluate=function(a,u,p,x){if(a.value!==void 0){if(a.expression.kind==="constant"){var B=a.expression.evaluate(u,null,{},p,x);return this._calculate(B,B,B,u)}return this._calculate(a.expression.evaluate(new Vi(Math.floor(u.zoom-1),u)),a.expression.evaluate(new Vi(Math.floor(u.zoom),u)),a.expression.evaluate(new Vi(Math.floor(u.zoom+1),u)),u)}},fo.prototype._calculate=function(a,u,p,x){return x.zoom>x.zoomHistory.lastIntegerZoom?{from:a,to:u}:{from:p,to:u}},fo.prototype.interpolate=function(a){return a};var Kr=function(a){this.specification=a};Kr.prototype.possiblyEvaluate=function(a,u,p,x){return!!a.expression.evaluate(u,null,{},p,x)},Kr.prototype.interpolate=function(){return!1};var Qn=function(a){for(var u in this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],a){var p=a[u];p.specification.overridable&&this.overridableProperties.push(u);var x=this.defaultPropertyValues[u]=new ks(p,void 0),B=this.defaultTransitionablePropertyValues[u]=new us(p);this.defaultTransitioningPropertyValues[u]=B.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=x.possiblyEvaluate({})}};ai("DataDrivenProperty",ui),ai("DataConstantProperty",xi),ai("CrossFadedDataDrivenProperty",Iu),ai("CrossFadedProperty",fo),ai("ColorRampProperty",Kr);var Ni=function(a){function u(p,x){if(a.call(this),this.id=p.id,this.type=p.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},p.type!=="custom"&&(this.metadata=(p=p).metadata,this.minzoom=p.minzoom,this.maxzoom=p.maxzoom,p.type!=="background"&&(this.source=p.source,this.sourceLayer=p["source-layer"],this.filter=p.filter),x.layout&&(this._unevaluatedLayout=new hs(x.layout)),x.paint)){for(var B in this._transitionablePaint=new Xr(x.paint),p.paint)this.setPaintProperty(B,p.paint[B],{validate:!1});for(var I in p.layout)this.setLayoutProperty(I,p.layout[I],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Fc(x.paint)}}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},u.prototype.getLayoutProperty=function(p){return p==="visibility"?this.visibility:this._unevaluatedLayout.getValue(p)},u.prototype.setLayoutProperty=function(p,x,B){B===void 0&&(B={}),x!=null&&this._validate(Vl,"layers."+this.id+".layout."+p,p,x,B)||(p!=="visibility"?this._unevaluatedLayout.setValue(p,x):this.visibility=x)},u.prototype.getPaintProperty=function(p){return Vt(p,"-transition")?this._transitionablePaint.getTransition(p.slice(0,-11)):this._transitionablePaint.getValue(p)},u.prototype.setPaintProperty=function(p,x,B){if(B===void 0&&(B={}),x!=null&&this._validate(dA,"layers."+this.id+".paint."+p,p,x,B))return!1;if(Vt(p,"-transition"))return this._transitionablePaint.setTransition(p.slice(0,-11),x||void 0),!1;var I=this._transitionablePaint._values[p],D=I.property.specification["property-type"]==="cross-faded-data-driven",k=I.value.isDataDriven(),V=I.value;this._transitionablePaint.setValue(p,x),this._handleSpecialPaintPropertyUpdate(p);var Q=this._transitionablePaint._values[p].value;return Q.isDataDriven()||k||D||this._handleOverridablePaintPropertyUpdate(p,V,Q)},u.prototype._handleSpecialPaintPropertyUpdate=function(p){},u.prototype._handleOverridablePaintPropertyUpdate=function(p,x,B){return!1},u.prototype.isHidden=function(p){return!!(this.minzoom&&p<this.minzoom)||!!(this.maxzoom&&p>=this.maxzoom)||this.visibility==="none"},u.prototype.updateTransitions=function(p){this._transitioningPaint=this._transitionablePaint.transitioned(p,this._transitioningPaint)},u.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},u.prototype.recalculate=function(p,x){p.getCrossfadeParameters&&(this._crossfadeParameters=p.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(p,void 0,x)),this.paint=this._transitioningPaint.possiblyEvaluate(p,void 0,x)},u.prototype.serialize=function(){var p={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(p.layout=p.layout||{},p.layout.visibility=this.visibility),at(p,function(x,B){return!(x===void 0||B==="layout"&&!Object.keys(x).length||B==="paint"&&!Object.keys(x).length)})},u.prototype._validate=function(p,x,B,I,D){return D===void 0&&(D={}),(!D||D.validate!==!1)&&Lc(this,p.call(Oc,{key:x,layerType:this.type,objectKey:B,value:I,styleSpec:lt,style:{glyphs:!0,sprite:!0}}))},u.prototype.is3D=function(){return!1},u.prototype.isTileClipped=function(){return!1},u.prototype.hasOffscreenPass=function(){return!1},u.prototype.resize=function(){},u.prototype.isStateDependent=function(){for(var p in this.paint._values){var x=this.paint.get(p);if(x instanceof ro&&ea(x.property.specification)&&(x.value.kind==="source"||x.value.kind==="composite")&&x.value.isStateDependent)return!0}return!1},u}(bt),fs={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},pn=function(a,u){this._structArray=a,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Ki=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Fr(a,u){u===void 0&&(u=1);var p=0,x=0;return{members:a.map(function(B){var I=fs[B.type].BYTES_PER_ELEMENT,D=p=Mu(p,Math.max(u,I)),k=B.components||1;return x=Math.max(x,I),p+=I*k,{name:B.name,type:B.type,components:k,offset:D}}),size:Mu(p,Math.max(x,u)),alignment:u}}function Mu(a,u){return Math.ceil(a/u)*u}Ki.serialize=function(a,u){return a._trim(),u&&(a.isTransferred=!0,u.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}},Ki.deserialize=function(a){var u=Object.create(this.prototype);return u.arrayBuffer=a.arrayBuffer,u.length=a.length,u.capacity=a.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u},Ki.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Ki.prototype.clear=function(){this.length=0},Ki.prototype.resize=function(a){this.reserve(a),this.length=a},Ki.prototype.reserve=function(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}},Ki.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Zo=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x){var B=this.length;return this.resize(B+1),this.emplace(B,p,x)},u.prototype.emplace=function(p,x,B){var I=2*p;return this.int16[I+0]=x,this.int16[I+1]=B,p},u}(Ki);Zo.prototype.bytesPerElement=4,ai("StructArrayLayout2i4",Zo);var Oh=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I){var D=this.length;return this.resize(D+1),this.emplace(D,p,x,B,I)},u.prototype.emplace=function(p,x,B,I,D){var k=4*p;return this.int16[k+0]=x,this.int16[k+1]=B,this.int16[k+2]=I,this.int16[k+3]=D,p},u}(Ki);Oh.prototype.bytesPerElement=8,ai("StructArrayLayout4i8",Oh);var pr=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,D,k){var V=this.length;return this.resize(V+1),this.emplace(V,p,x,B,I,D,k)},u.prototype.emplace=function(p,x,B,I,D,k,V){var Q=6*p;return this.int16[Q+0]=x,this.int16[Q+1]=B,this.int16[Q+2]=I,this.int16[Q+3]=D,this.int16[Q+4]=k,this.int16[Q+5]=V,p},u}(Ki);pr.prototype.bytesPerElement=12,ai("StructArrayLayout2i4i12",pr);var oo=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,D,k){var V=this.length;return this.resize(V+1),this.emplace(V,p,x,B,I,D,k)},u.prototype.emplace=function(p,x,B,I,D,k,V){var Q=4*p,tt=8*p;return this.int16[Q+0]=x,this.int16[Q+1]=B,this.uint8[tt+4]=I,this.uint8[tt+5]=D,this.uint8[tt+6]=k,this.uint8[tt+7]=V,p},u}(Ki);oo.prototype.bytesPerElement=8,ai("StructArrayLayout2i4ub8",oo);var Ss=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x){var B=this.length;return this.resize(B+1),this.emplace(B,p,x)},u.prototype.emplace=function(p,x,B){var I=2*p;return this.float32[I+0]=x,this.float32[I+1]=B,p},u}(Ki);Ss.prototype.bytesPerElement=8,ai("StructArrayLayout2f8",Ss);var Is=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,D,k,V,Q,tt,ot){var dt=this.length;return this.resize(dt+1),this.emplace(dt,p,x,B,I,D,k,V,Q,tt,ot)},u.prototype.emplace=function(p,x,B,I,D,k,V,Q,tt,ot,dt){var _t=10*p;return this.uint16[_t+0]=x,this.uint16[_t+1]=B,this.uint16[_t+2]=I,this.uint16[_t+3]=D,this.uint16[_t+4]=k,this.uint16[_t+5]=V,this.uint16[_t+6]=Q,this.uint16[_t+7]=tt,this.uint16[_t+8]=ot,this.uint16[_t+9]=dt,p},u}(Ki);Is.prototype.bytesPerElement=20,ai("StructArrayLayout10ui20",Is);var Ke=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,D,k,V,Q,tt,ot,dt,_t){var Nt=this.length;return this.resize(Nt+1),this.emplace(Nt,p,x,B,I,D,k,V,Q,tt,ot,dt,_t)},u.prototype.emplace=function(p,x,B,I,D,k,V,Q,tt,ot,dt,_t,Nt){var Ut=12*p;return this.int16[Ut+0]=x,this.int16[Ut+1]=B,this.int16[Ut+2]=I,this.int16[Ut+3]=D,this.uint16[Ut+4]=k,this.uint16[Ut+5]=V,this.uint16[Ut+6]=Q,this.uint16[Ut+7]=tt,this.int16[Ut+8]=ot,this.int16[Ut+9]=dt,this.int16[Ut+10]=_t,this.int16[Ut+11]=Nt,p},u}(Ki);Ke.prototype.bytesPerElement=24,ai("StructArrayLayout4i4ui4i24",Ke);var ii=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B){var I=this.length;return this.resize(I+1),this.emplace(I,p,x,B)},u.prototype.emplace=function(p,x,B,I){var D=3*p;return this.float32[D+0]=x,this.float32[D+1]=B,this.float32[D+2]=I,p},u}(Ki);ii.prototype.bytesPerElement=12,ai("StructArrayLayout3f12",ii);var Wl=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p){var x=this.length;return this.resize(x+1),this.emplace(x,p)},u.prototype.emplace=function(p,x){return this.uint32[1*p+0]=x,p},u}(Ki);Wl.prototype.bytesPerElement=4,ai("StructArrayLayout1ul4",Wl);var kc=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,D,k,V,Q,tt){var ot=this.length;return this.resize(ot+1),this.emplace(ot,p,x,B,I,D,k,V,Q,tt)},u.prototype.emplace=function(p,x,B,I,D,k,V,Q,tt,ot){var dt=10*p,_t=5*p;return this.int16[dt+0]=x,this.int16[dt+1]=B,this.int16[dt+2]=I,this.int16[dt+3]=D,this.int16[dt+4]=k,this.int16[dt+5]=V,this.uint32[_t+3]=Q,this.uint16[dt+8]=tt,this.uint16[dt+9]=ot,p},u}(Ki);kc.prototype.bytesPerElement=20,ai("StructArrayLayout6i1ul2ui20",kc);var sa=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,D,k){var V=this.length;return this.resize(V+1),this.emplace(V,p,x,B,I,D,k)},u.prototype.emplace=function(p,x,B,I,D,k,V){var Q=6*p;return this.int16[Q+0]=x,this.int16[Q+1]=B,this.int16[Q+2]=I,this.int16[Q+3]=D,this.int16[Q+4]=k,this.int16[Q+5]=V,p},u}(Ki);sa.prototype.bytesPerElement=12,ai("StructArrayLayout2i2i2i12",sa);var Ns=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,D){var k=this.length;return this.resize(k+1),this.emplace(k,p,x,B,I,D)},u.prototype.emplace=function(p,x,B,I,D,k){var V=4*p,Q=8*p;return this.float32[V+0]=x,this.float32[V+1]=B,this.float32[V+2]=I,this.int16[Q+6]=D,this.int16[Q+7]=k,p},u}(Ki);Ns.prototype.bytesPerElement=16,ai("StructArrayLayout2f1f2i16",Ns);var aa=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I){var D=this.length;return this.resize(D+1),this.emplace(D,p,x,B,I)},u.prototype.emplace=function(p,x,B,I,D){var k=12*p,V=3*p;return this.uint8[k+0]=x,this.uint8[k+1]=B,this.float32[V+1]=I,this.float32[V+2]=D,p},u}(Ki);aa.prototype.bytesPerElement=12,ai("StructArrayLayout2ub2f12",aa);var la=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B){var I=this.length;return this.resize(I+1),this.emplace(I,p,x,B)},u.prototype.emplace=function(p,x,B,I){var D=3*p;return this.uint16[D+0]=x,this.uint16[D+1]=B,this.uint16[D+2]=I,p},u}(Ki);la.prototype.bytesPerElement=6,ai("StructArrayLayout3ui6",la);var xo=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,D,k,V,Q,tt,ot,dt,_t,Nt,Ut,Wt,jt,Yt){var le=this.length;return this.resize(le+1),this.emplace(le,p,x,B,I,D,k,V,Q,tt,ot,dt,_t,Nt,Ut,Wt,jt,Yt)},u.prototype.emplace=function(p,x,B,I,D,k,V,Q,tt,ot,dt,_t,Nt,Ut,Wt,jt,Yt,le){var me=24*p,_e=12*p,Oe=48*p;return this.int16[me+0]=x,this.int16[me+1]=B,this.uint16[me+2]=I,this.uint16[me+3]=D,this.uint32[_e+2]=k,this.uint32[_e+3]=V,this.uint32[_e+4]=Q,this.uint16[me+10]=tt,this.uint16[me+11]=ot,this.uint16[me+12]=dt,this.float32[_e+7]=_t,this.float32[_e+8]=Nt,this.uint8[Oe+36]=Ut,this.uint8[Oe+37]=Wt,this.uint8[Oe+38]=jt,this.uint32[_e+10]=Yt,this.int16[me+22]=le,p},u}(Ki);xo.prototype.bytesPerElement=48,ai("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",xo);var _=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,D,k,V,Q,tt,ot,dt,_t,Nt,Ut,Wt,jt,Yt,le,me,_e,Oe,Je,qe,bi,ri,Ei,oi,rn){var Oi=this.length;return this.resize(Oi+1),this.emplace(Oi,p,x,B,I,D,k,V,Q,tt,ot,dt,_t,Nt,Ut,Wt,jt,Yt,le,me,_e,Oe,Je,qe,bi,ri,Ei,oi,rn)},u.prototype.emplace=function(p,x,B,I,D,k,V,Q,tt,ot,dt,_t,Nt,Ut,Wt,jt,Yt,le,me,_e,Oe,Je,qe,bi,ri,Ei,oi,rn,Oi){var di=34*p,hn=17*p;return this.int16[di+0]=x,this.int16[di+1]=B,this.int16[di+2]=I,this.int16[di+3]=D,this.int16[di+4]=k,this.int16[di+5]=V,this.int16[di+6]=Q,this.int16[di+7]=tt,this.uint16[di+8]=ot,this.uint16[di+9]=dt,this.uint16[di+10]=_t,this.uint16[di+11]=Nt,this.uint16[di+12]=Ut,this.uint16[di+13]=Wt,this.uint16[di+14]=jt,this.uint16[di+15]=Yt,this.uint16[di+16]=le,this.uint16[di+17]=me,this.uint16[di+18]=_e,this.uint16[di+19]=Oe,this.uint16[di+20]=Je,this.uint16[di+21]=qe,this.uint16[di+22]=bi,this.uint32[hn+12]=ri,this.float32[hn+13]=Ei,this.float32[hn+14]=oi,this.float32[hn+15]=rn,this.float32[hn+16]=Oi,p},u}(Ki);_.prototype.bytesPerElement=68,ai("StructArrayLayout8i15ui1ul4f68",_);var y=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p){var x=this.length;return this.resize(x+1),this.emplace(x,p)},u.prototype.emplace=function(p,x){return this.float32[1*p+0]=x,p},u}(Ki);y.prototype.bytesPerElement=4,ai("StructArrayLayout1f4",y);var b=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B){var I=this.length;return this.resize(I+1),this.emplace(I,p,x,B)},u.prototype.emplace=function(p,x,B,I){var D=3*p;return this.int16[D+0]=x,this.int16[D+1]=B,this.int16[D+2]=I,p},u}(Ki);b.prototype.bytesPerElement=6,ai("StructArrayLayout3i6",b);var w=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B){var I=this.length;return this.resize(I+1),this.emplace(I,p,x,B)},u.prototype.emplace=function(p,x,B,I){var D=4*p;return this.uint32[2*p+0]=x,this.uint16[D+2]=B,this.uint16[D+3]=I,p},u}(Ki);w.prototype.bytesPerElement=8,ai("StructArrayLayout1ul2ui8",w);var T=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x){var B=this.length;return this.resize(B+1),this.emplace(B,p,x)},u.prototype.emplace=function(p,x,B){var I=2*p;return this.uint16[I+0]=x,this.uint16[I+1]=B,p},u}(Ki);T.prototype.bytesPerElement=4,ai("StructArrayLayout2ui4",T);var M=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p){var x=this.length;return this.resize(x+1),this.emplace(x,p)},u.prototype.emplace=function(p,x){return this.uint16[1*p+0]=x,p},u}(Ki);M.prototype.bytesPerElement=2,ai("StructArrayLayout1ui2",M);var O=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I){var D=this.length;return this.resize(D+1),this.emplace(D,p,x,B,I)},u.prototype.emplace=function(p,x,B,I,D){var k=4*p;return this.float32[k+0]=x,this.float32[k+1]=B,this.float32[k+2]=I,this.float32[k+3]=D,p},u}(Ki);O.prototype.bytesPerElement=16,ai("StructArrayLayout4f16",O);var c=function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var p={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return p.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},p.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},p.x1.get=function(){return this._structArray.int16[this._pos2+2]},p.y1.get=function(){return this._structArray.int16[this._pos2+3]},p.x2.get=function(){return this._structArray.int16[this._pos2+4]},p.y2.get=function(){return this._structArray.int16[this._pos2+5]},p.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},p.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},p.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},p.anchorPoint.get=function(){return new v(this.anchorPointX,this.anchorPointY)},Object.defineProperties(u.prototype,p),u}(pn);c.prototype.size=20;var d=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(p){return new c(this,p)},u}(kc);ai("CollisionBoxArray",d);var f=function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var p={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return p.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},p.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},p.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},p.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},p.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},p.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},p.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},p.segment.get=function(){return this._structArray.uint16[this._pos2+10]},p.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},p.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},p.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},p.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},p.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},p.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},p.placedOrientation.set=function(x){this._structArray.uint8[this._pos1+37]=x},p.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},p.hidden.set=function(x){this._structArray.uint8[this._pos1+38]=x},p.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},p.crossTileID.set=function(x){this._structArray.uint32[this._pos4+10]=x},p.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(u.prototype,p),u}(pn);f.prototype.size=48;var m=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(p){return new f(this,p)},u}(xo);ai("PlacedSymbolArray",m);var E=function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var p={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return p.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},p.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},p.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},p.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},p.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},p.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},p.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},p.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},p.key.get=function(){return this._structArray.uint16[this._pos2+8]},p.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},p.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},p.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},p.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},p.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},p.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},p.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},p.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},p.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},p.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},p.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},p.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},p.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},p.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},p.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},p.crossTileID.set=function(x){this._structArray.uint32[this._pos4+12]=x},p.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},p.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},p.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},p.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(u.prototype,p),u}(pn);E.prototype.size=68;var P=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(p){return new E(this,p)},u}(_);ai("SymbolInstanceArray",P);var R=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getoffsetX=function(p){return this.float32[1*p+0]},u}(y);ai("GlyphOffsetArray",R);var F=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getx=function(p){return this.int16[3*p+0]},u.prototype.gety=function(p){return this.int16[3*p+1]},u.prototype.gettileUnitDistanceFromAnchor=function(p){return this.int16[3*p+2]},u}(b);ai("SymbolLineVertexArray",F);var U=function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var p={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return p.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},p.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},p.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(u.prototype,p),u}(pn);U.prototype.size=8;var J=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(p){return new U(this,p)},u}(w);ai("FeatureIndexArray",J);var et=Fr([{name:"a_pos",components:2,type:"Int16"}],4).members,$=function(a){a===void 0&&(a=[]),this.segments=a};function it(a,u){return 256*(a=W(Math.floor(a),0,255))+W(Math.floor(u),0,255)}$.prototype.prepareSegment=function(a,u,p,x){var B=this.segments[this.segments.length-1];return a>$.MAX_VERTEX_ARRAY_LENGTH&&ht("Max vertices per segment is "+$.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+a),(!B||B.vertexLength+a>$.MAX_VERTEX_ARRAY_LENGTH||B.sortKey!==x)&&(B={vertexOffset:u.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},x!==void 0&&(B.sortKey=x),this.segments.push(B)),B},$.prototype.get=function(){return this.segments},$.prototype.destroy=function(){for(var a=0,u=this.segments;a<u.length;a+=1){var p=u[a];for(var x in p.vaos)p.vaos[x].destroy()}},$.simpleSegment=function(a,u,p,x){return new $([{vertexOffset:a,primitiveOffset:u,vertexLength:p,primitiveLength:x,vaos:{},sortKey:0}])},$.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ai("SegmentVector",$);var st=Fr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),xt=l(function(a){a.exports=function(u,p){var x,B,I,D,k,V,Q,tt;for(B=u.length-(x=3&u.length),I=p,k=3432918353,V=461845907,tt=0;tt<B;)Q=255&u.charCodeAt(tt)|(255&u.charCodeAt(++tt))<<8|(255&u.charCodeAt(++tt))<<16|(255&u.charCodeAt(++tt))<<24,++tt,I=27492+(65535&(D=5*(65535&(I=(I^=Q=(65535&(Q=(Q=(65535&Q)*k+(((Q>>>16)*k&65535)<<16)&4294967295)<<15|Q>>>17))*V+(((Q>>>16)*V&65535)<<16)&4294967295)<<13|I>>>19))+((5*(I>>>16)&65535)<<16)&4294967295))+((58964+(D>>>16)&65535)<<16);switch(Q=0,x){case 3:Q^=(255&u.charCodeAt(tt+2))<<16;case 2:Q^=(255&u.charCodeAt(tt+1))<<8;case 1:I^=Q=(65535&(Q=(Q=(65535&(Q^=255&u.charCodeAt(tt)))*k+(((Q>>>16)*k&65535)<<16)&4294967295)<<15|Q>>>17))*V+(((Q>>>16)*V&65535)<<16)&4294967295}return I^=u.length,I=2246822507*(65535&(I^=I>>>16))+((2246822507*(I>>>16)&65535)<<16)&4294967295,I=3266489909*(65535&(I^=I>>>13))+((3266489909*(I>>>16)&65535)<<16)&4294967295,(I^=I>>>16)>>>0}}),Rt=l(function(a){a.exports=function(u,p){for(var x,B=u.length,I=p^B,D=0;B>=4;)x=1540483477*(65535&(x=255&u.charCodeAt(D)|(255&u.charCodeAt(++D))<<8|(255&u.charCodeAt(++D))<<16|(255&u.charCodeAt(++D))<<24))+((1540483477*(x>>>16)&65535)<<16),I=1540483477*(65535&I)+((1540483477*(I>>>16)&65535)<<16)^(x=1540483477*(65535&(x^=x>>>24))+((1540483477*(x>>>16)&65535)<<16)),B-=4,++D;switch(B){case 3:I^=(255&u.charCodeAt(D+2))<<16;case 2:I^=(255&u.charCodeAt(D+1))<<8;case 1:I=1540483477*(65535&(I^=255&u.charCodeAt(D)))+((1540483477*(I>>>16)&65535)<<16)}return I=1540483477*(65535&(I^=I>>>13))+((1540483477*(I>>>16)&65535)<<16),(I^=I>>>15)>>>0}}),yt=xt,It=Rt;yt.murmur3=xt,yt.murmur2=It;var Ht=function(){this.ids=[],this.positions=[],this.indexed=!1};Ht.prototype.add=function(a,u,p,x){this.ids.push(ee(a)),this.positions.push(u,p,x)},Ht.prototype.getPositions=function(a){for(var u=ee(a),p=0,x=this.ids.length-1;p<x;){var B=p+x>>1;this.ids[B]>=u?x=B:p=B+1}for(var I=[];this.ids[p]===u;)I.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return I},Ht.serialize=function(a,u){var p=new Float64Array(a.ids),x=new Uint32Array(a.positions);return function B(I,D,k,V){for(;k<V;){for(var Q=I[k+V>>1],tt=k-1,ot=V+1;;){do tt++;while(I[tt]<Q);do ot--;while(I[ot]>Q);if(tt>=ot)break;Qt(I,tt,ot),Qt(D,3*tt,3*ot),Qt(D,3*tt+1,3*ot+1),Qt(D,3*tt+2,3*ot+2)}ot-k<V-ot?(B(I,D,k,ot),k=ot+1):(B(I,D,ot+1,V),V=ot)}}(p,x,0,p.length-1),u&&u.push(p.buffer,x.buffer),{ids:p,positions:x}},Ht.deserialize=function(a){var u=new Ht;return u.ids=a.ids,u.positions=a.positions,u.indexed=!0,u};var Xt=Math.pow(2,53)-1;function ee(a){var u=+a;return!isNaN(u)&&u<=Xt?u:yt(String(a))}function Qt(a,u,p){var x=a[u];a[u]=a[p],a[p]=x}ai("FeaturePositionMap",Ht);var $t=function(a,u){this.gl=a.gl,this.location=u},Ae=function(a){function u(p,x){a.call(this,p,x),this.current=0}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){this.current!==p&&(this.current=p,this.gl.uniform1i(this.location,p))},u}($t),Le=function(a){function u(p,x){a.call(this,p,x),this.current=0}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){this.current!==p&&(this.current=p,this.gl.uniform1f(this.location,p))},u}($t),we=function(a){function u(p,x){a.call(this,p,x),this.current=[0,0]}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){p[0]===this.current[0]&&p[1]===this.current[1]||(this.current=p,this.gl.uniform2f(this.location,p[0],p[1]))},u}($t),Ge=function(a){function u(p,x){a.call(this,p,x),this.current=[0,0,0]}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]||(this.current=p,this.gl.uniform3f(this.location,p[0],p[1],p[2]))},u}($t),si=function(a){function u(p,x){a.call(this,p,x),this.current=[0,0,0,0]}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]&&p[3]===this.current[3]||(this.current=p,this.gl.uniform4f(this.location,p[0],p[1],p[2],p[3]))},u}($t),Ci=function(a){function u(p,x){a.call(this,p,x),this.current=tn.transparent}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){p.r===this.current.r&&p.g===this.current.g&&p.b===this.current.b&&p.a===this.current.a||(this.current=p,this.gl.uniform4f(this.location,p.r,p.g,p.b,p.a))},u}($t),Ti=new Float32Array(16),xn=function(a){function u(p,x){a.call(this,p,x),this.current=Ti}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){if(p[12]!==this.current[12]||p[0]!==this.current[0])return this.current=p,void this.gl.uniformMatrix4fv(this.location,!1,p);for(var x=1;x<16;x++)if(p[x]!==this.current[x]){this.current=p,this.gl.uniformMatrix4fv(this.location,!1,p);break}},u}($t);function li(a){return[it(255*a.r,255*a.g),it(255*a.b,255*a.a)]}var Hi=function(a,u,p){this.value=a,this.uniformNames=u.map(function(x){return"u_"+x}),this.type=p};Hi.prototype.setUniform=function(a,u,p){a.set(p.constantOr(this.value))},Hi.prototype.getBinding=function(a,u,p){return this.type==="color"?new Ci(a,u):new Le(a,u)};var en=function(a,u){this.uniformNames=u.map(function(p){return"u_"+p}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};en.prototype.setConstantPatternPositions=function(a,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=a.tlbr},en.prototype.setUniform=function(a,u,p,x){var B=x==="u_pattern_to"?this.patternTo:x==="u_pattern_from"?this.patternFrom:x==="u_pixel_ratio_to"?this.pixelRatioTo:x==="u_pixel_ratio_from"?this.pixelRatioFrom:null;B&&a.set(B)},en.prototype.getBinding=function(a,u,p){return p.substr(0,9)==="u_pattern"?new si(a,u):new Le(a,u)};var ji=function(a,u,p,x){this.expression=a,this.type=p,this.maxValue=0,this.paintVertexAttributes=u.map(function(B){return{name:"a_"+B,type:"Float32",components:p==="color"?2:1,offset:0}}),this.paintVertexArray=new x};ji.prototype.populatePaintArray=function(a,u,p,x,B){var I=this.paintVertexArray.length,D=this.expression.evaluate(new Vi(0),u,{},x,[],B);this.paintVertexArray.resize(a),this._setPaintValue(I,a,D)},ji.prototype.updatePaintArray=function(a,u,p,x){var B=this.expression.evaluate({zoom:0},p,x);this._setPaintValue(a,u,B)},ji.prototype._setPaintValue=function(a,u,p){if(this.type==="color")for(var x=li(p),B=a;B<u;B++)this.paintVertexArray.emplace(B,x[0],x[1]);else{for(var I=a;I<u;I++)this.paintVertexArray.emplace(I,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}},ji.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ji.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Ui=function(a,u,p,x,B,I){this.expression=a,this.uniformNames=u.map(function(D){return"u_"+D+"_t"}),this.type=p,this.useIntegerZoom=x,this.zoom=B,this.maxValue=0,this.paintVertexAttributes=u.map(function(D){return{name:"a_"+D,type:"Float32",components:p==="color"?4:2,offset:0}}),this.paintVertexArray=new I};Ui.prototype.populatePaintArray=function(a,u,p,x,B){var I=this.expression.evaluate(new Vi(this.zoom),u,{},x,[],B),D=this.expression.evaluate(new Vi(this.zoom+1),u,{},x,[],B),k=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(k,a,I,D)},Ui.prototype.updatePaintArray=function(a,u,p,x){var B=this.expression.evaluate({zoom:this.zoom},p,x),I=this.expression.evaluate({zoom:this.zoom+1},p,x);this._setPaintValue(a,u,B,I)},Ui.prototype._setPaintValue=function(a,u,p,x){if(this.type==="color")for(var B=li(p),I=li(x),D=a;D<u;D++)this.paintVertexArray.emplace(D,B[0],B[1],I[0],I[1]);else{for(var k=a;k<u;k++)this.paintVertexArray.emplace(k,p,x);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(x))}},Ui.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Ui.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Ui.prototype.setUniform=function(a,u){var p=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,x=W(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);a.set(x)},Ui.prototype.getBinding=function(a,u,p){return new Le(a,u)};var Zi=function(a,u,p,x,B,I){this.expression=a,this.type=u,this.useIntegerZoom=p,this.zoom=x,this.layerId=I,this.zoomInPaintVertexArray=new B,this.zoomOutPaintVertexArray=new B};Zi.prototype.populatePaintArray=function(a,u,p){var x=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(x,a,u.patterns&&u.patterns[this.layerId],p)},Zi.prototype.updatePaintArray=function(a,u,p,x,B){this._setPaintValues(a,u,p.patterns&&p.patterns[this.layerId],B)},Zi.prototype._setPaintValues=function(a,u,p,x){if(x&&p){var B=x[p.min],I=x[p.mid],D=x[p.max];if(B&&I&&D)for(var k=a;k<u;k++)this.zoomInPaintVertexArray.emplace(k,I.tl[0],I.tl[1],I.br[0],I.br[1],B.tl[0],B.tl[1],B.br[0],B.br[1],I.pixelRatio,B.pixelRatio),this.zoomOutPaintVertexArray.emplace(k,I.tl[0],I.tl[1],I.br[0],I.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],I.pixelRatio,D.pixelRatio)}},Zi.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,st.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,st.members,this.expression.isStateDependent))},Zi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Li=function(a,u,p){this.binders={},this._buffers=[];var x=[];for(var B in a.paint._values)if(p(B)){var I=a.paint.get(B);if(I instanceof ro&&ea(I.property.specification)){var D=Qr(B,a.type),k=I.value,V=I.property.specification.type,Q=I.property.useIntegerZoom,tt=I.property.specification["property-type"],ot=tt==="cross-faded"||tt==="cross-faded-data-driven";if(k.kind==="constant")this.binders[B]=ot?new en(k.value,D):new Hi(k.value,D,V),x.push("/u_"+B);else if(k.kind==="source"||ot){var dt=Tr(B,V,"source");this.binders[B]=ot?new Zi(k,V,Q,u,dt,a.id):new ji(k,D,V,dt),x.push("/a_"+B)}else{var _t=Tr(B,V,"composite");this.binders[B]=new Ui(k,D,V,Q,u,_t),x.push("/z_"+B)}}}this.cacheKey=x.sort().join("")};Li.prototype.getMaxValue=function(a){var u=this.binders[a];return u instanceof ji||u instanceof Ui?u.maxValue:0},Li.prototype.populatePaintArrays=function(a,u,p,x,B){for(var I in this.binders){var D=this.binders[I];(D instanceof ji||D instanceof Ui||D instanceof Zi)&&D.populatePaintArray(a,u,p,x,B)}},Li.prototype.setConstantPatternPositions=function(a,u){for(var p in this.binders){var x=this.binders[p];x instanceof en&&x.setConstantPatternPositions(a,u)}},Li.prototype.updatePaintArrays=function(a,u,p,x,B){var I=!1;for(var D in a)for(var k=0,V=u.getPositions(D);k<V.length;k+=1){var Q=V[k],tt=p.feature(Q.index);for(var ot in this.binders){var dt=this.binders[ot];if((dt instanceof ji||dt instanceof Ui||dt instanceof Zi)&&dt.expression.isStateDependent===!0){var _t=x.paint.get(ot);dt.expression=_t.value,dt.updatePaintArray(Q.start,Q.end,tt,a[D],B),I=!0}}}return I},Li.prototype.defines=function(){var a=[];for(var u in this.binders){var p=this.binders[u];(p instanceof Hi||p instanceof en)&&a.push.apply(a,p.uniformNames.map(function(x){return"#define HAS_UNIFORM_"+x}))}return a},Li.prototype.getBinderAttributes=function(){var a=[];for(var u in this.binders){var p=this.binders[u];if(p instanceof ji||p instanceof Ui)for(var x=0;x<p.paintVertexAttributes.length;x++)a.push(p.paintVertexAttributes[x].name);else if(p instanceof Zi)for(var B=0;B<st.members.length;B++)a.push(st.members[B].name)}return a},Li.prototype.getBinderUniforms=function(){var a=[];for(var u in this.binders){var p=this.binders[u];if(p instanceof Hi||p instanceof en||p instanceof Ui)for(var x=0,B=p.uniformNames;x<B.length;x+=1)a.push(B[x])}return a},Li.prototype.getPaintVertexBuffers=function(){return this._buffers},Li.prototype.getUniforms=function(a,u){var p=[];for(var x in this.binders){var B=this.binders[x];if(B instanceof Hi||B instanceof en||B instanceof Ui)for(var I=0,D=B.uniformNames;I<D.length;I+=1){var k=D[I];if(u[k]){var V=B.getBinding(a,u[k],k);p.push({name:k,property:x,binding:V})}}}return p},Li.prototype.setUniforms=function(a,u,p,x){for(var B=0,I=u;B<I.length;B+=1){var D=I[B],k=D.name,V=D.property;this.binders[V].setUniform(D.binding,x,p.get(V),k)}},Li.prototype.updatePaintBuffers=function(a){for(var u in this._buffers=[],this.binders){var p=this.binders[u];if(a&&p instanceof Zi){var x=a.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;x&&this._buffers.push(x)}else(p instanceof ji||p instanceof Ui)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}},Li.prototype.upload=function(a){for(var u in this.binders){var p=this.binders[u];(p instanceof ji||p instanceof Ui||p instanceof Zi)&&p.upload(a)}this.updatePaintBuffers()},Li.prototype.destroy=function(){for(var a in this.binders){var u=this.binders[a];(u instanceof ji||u instanceof Ui||u instanceof Zi)&&u.destroy()}};var Di=function(a,u,p){p===void 0&&(p=function(){return!0}),this.programConfigurations={};for(var x=0,B=a;x<B.length;x+=1){var I=B[x];this.programConfigurations[I.id]=new Li(I,u,p)}this.needsUpload=!1,this._featureMap=new Ht,this._bufferOffset=0};function Qr(a,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(u+"-","").replace(/-/g,"_")]}function Tr(a,u,p){var x={color:{source:Ss,composite:O},number:{source:y,composite:Ss}},B=function(I){return{"line-pattern":{source:Is,composite:Is},"fill-pattern":{source:Is,composite:Is},"fill-extrusion-pattern":{source:Is,composite:Is}}[I]}(a);return B&&B[p]||x[u][p]}Di.prototype.populatePaintArrays=function(a,u,p,x,B,I){for(var D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(a,u,x,B,I);u.id!==void 0&&this._featureMap.add(u.id,p,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0},Di.prototype.updatePaintArrays=function(a,u,p,x){for(var B=0,I=p;B<I.length;B+=1){var D=I[B];this.needsUpload=this.programConfigurations[D.id].updatePaintArrays(a,this._featureMap,u,D,x)||this.needsUpload}},Di.prototype.get=function(a){return this.programConfigurations[a]},Di.prototype.upload=function(a){if(this.needsUpload){for(var u in this.programConfigurations)this.programConfigurations[u].upload(a);this.needsUpload=!1}},Di.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()},ai("ConstantBinder",Hi),ai("CrossFadedConstantBinder",en),ai("SourceExpressionBinder",ji),ai("CrossFadedCompositeBinder",Zi),ai("CompositeExpressionBinder",Ui),ai("ProgramConfiguration",Li,{omit:["_buffers"]}),ai("ProgramConfigurationSet",Di);var wo=Math.pow(2,14)-1,so=-wo-1;function xr(a){for(var u=8192/a.extent,p=a.loadGeometry(),x=0;x<p.length;x++)for(var B=p[x],I=0;I<B.length;I++){var D=B[I],k=Math.round(D.x*u),V=Math.round(D.y*u);D.x=W(k,so,wo),D.y=W(V,so,wo),(k<D.x||k>D.x+1||V<D.y||V>D.y+1)&&ht("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return p}function Pr(a,u){return{type:a.type,id:a.id,properties:a.properties,geometry:u?xr(a):[]}}function ds(a,u,p,x,B){a.emplaceBack(2*u+(x+1)/2,2*p+(B+1)/2)}var Lo=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Zo,this.indexArray=new la,this.segments=new $,this.programConfigurations=new Di(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function Jl(a,u){for(var p=0;p<a.length;p++)if(Da(u,a[p]))return!0;for(var x=0;x<u.length;x++)if(Da(a,u[x]))return!0;return!!Lh(a,u)}function Yo(a,u,p){return!!Da(a,u)||!!Xl(u,a,p)}function ca(a,u){if(a.length===1)return Fh(u,a[0]);for(var p=0;p<u.length;p++)for(var x=u[p],B=0;B<x.length;B++)if(Da(a,x[B]))return!0;for(var I=0;I<a.length;I++)if(Fh(u,a[I]))return!0;for(var D=0;D<u.length;D++)if(Lh(a,u[D]))return!0;return!1}function Us(a,u,p){if(a.length>1){if(Lh(a,u))return!0;for(var x=0;x<u.length;x++)if(Xl(u[x],a,p))return!0}for(var B=0;B<a.length;B++)if(Xl(a[B],u,p))return!0;return!1}function Lh(a,u){if(a.length===0||u.length===0)return!1;for(var p=0;p<a.length-1;p++)for(var x=a[p],B=a[p+1],I=0;I<u.length-1;I++)if(Pu(x,B,u[I],u[I+1]))return!0;return!1}function Pu(a,u,p,x){return Mt(a,p,x)!==Mt(u,p,x)&&Mt(a,u,p)!==Mt(a,u,x)}function Xl(a,u,p){var x=p*p;if(u.length===1)return a.distSqr(u[0])<x;for(var B=1;B<u.length;B++)if(Ru(a,u[B-1],u[B])<x)return!0;return!1}function Ru(a,u,p){var x=u.distSqr(p);if(x===0)return a.distSqr(u);var B=((a.x-u.x)*(p.x-u.x)+(a.y-u.y)*(p.y-u.y))/x;return a.distSqr(B<0?u:B>1?p:p.sub(u)._mult(B)._add(u))}function Fh(a,u){for(var p,x,B,I=!1,D=0;D<a.length;D++)for(var k=0,V=(p=a[D]).length-1;k<p.length;V=k++)(x=p[k]).y>u.y!=(B=p[V]).y>u.y&&u.x<(B.x-x.x)*(u.y-x.y)/(B.y-x.y)+x.x&&(I=!I);return I}function Da(a,u){for(var p=!1,x=0,B=a.length-1;x<a.length;B=x++){var I=a[x],D=a[B];I.y>u.y!=D.y>u.y&&u.x<(D.x-I.x)*(u.y-I.y)/(D.y-I.y)+I.x&&(p=!p)}return p}function kh(a,u,p){var x=p[0],B=p[2];if(a.x<x.x&&u.x<x.x||a.x>B.x&&u.x>B.x||a.y<x.y&&u.y<x.y||a.y>B.y&&u.y>B.y)return!1;var I=Mt(a,u,p[0]);return I!==Mt(a,u,p[1])||I!==Mt(a,u,p[2])||I!==Mt(a,u,p[3])}function Oa(a,u,p){var x=u.paint.get(a).value;return x.kind==="constant"?x.value:p.programConfigurations.get(u.id).getMaxValue(a)}function Zr(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function ll(a,u,p,x,B){if(!u[0]&&!u[1])return a;var I=v.convert(u)._mult(B);p==="viewport"&&I._rotate(-x);for(var D=[],k=0;k<a.length;k++)D.push(a[k].sub(I));return D}Lo.prototype.populate=function(a,u,p){var x=this.layers[0],B=[],I=null;x.type==="circle"&&(I=x.layout.get("circle-sort-key"));for(var D=0,k=a;D<k.length;D+=1){var V=k[D],Q=V.feature,tt=V.id,ot=V.index,dt=V.sourceLayerIndex,_t=this.layers[0]._featureFilter.needGeometry,Nt=Pr(Q,_t);if(this.layers[0]._featureFilter.filter(new Vi(this.zoom),Nt,p)){var Ut=I?I.evaluate(Nt,{},p):void 0,Wt={id:tt,properties:Q.properties,type:Q.type,sourceLayerIndex:dt,index:ot,geometry:_t?Nt.geometry:xr(Q),patterns:{},sortKey:Ut};B.push(Wt)}}I&&B.sort(function(qe,bi){return qe.sortKey-bi.sortKey});for(var jt=0,Yt=B;jt<Yt.length;jt+=1){var le=Yt[jt],me=le.geometry,_e=le.index,Oe=le.sourceLayerIndex,Je=a[_e].feature;this.addFeature(le,me,_e,p),u.featureIndex.insert(Je,me,_e,Oe,this.index)}},Lo.prototype.update=function(a,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,p)},Lo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Lo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Lo.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,et),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Lo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Lo.prototype.addFeature=function(a,u,p,x){for(var B=0,I=u;B<I.length;B+=1)for(var D=0,k=I[B];D<k.length;D+=1){var V=k[D],Q=V.x,tt=V.y;if(!(Q<0||Q>=8192||tt<0||tt>=8192)){var ot=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),dt=ot.vertexLength;ds(this.layoutVertexArray,Q,tt,-1,-1),ds(this.layoutVertexArray,Q,tt,1,-1),ds(this.layoutVertexArray,Q,tt,1,1),ds(this.layoutVertexArray,Q,tt,-1,1),this.indexArray.emplaceBack(dt,dt+1,dt+2),this.indexArray.emplaceBack(dt,dt+3,dt+2),ot.vertexLength+=4,ot.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,{},x)},ai("CircleBucket",Lo,{omit:["layers"]});var Kl=new Qn({"circle-sort-key":new ui(lt.layout_circle["circle-sort-key"])}),Nc={paint:new Qn({"circle-radius":new ui(lt.paint_circle["circle-radius"]),"circle-color":new ui(lt.paint_circle["circle-color"]),"circle-blur":new ui(lt.paint_circle["circle-blur"]),"circle-opacity":new ui(lt.paint_circle["circle-opacity"]),"circle-translate":new xi(lt.paint_circle["circle-translate"]),"circle-translate-anchor":new xi(lt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new xi(lt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new xi(lt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ui(lt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ui(lt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ui(lt.paint_circle["circle-stroke-opacity"])}),layout:Kl},Bn=typeof Float32Array<"u"?Float32Array:Array;function Ms(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function qo(a,u,p){var x=u[0],B=u[1],I=u[2],D=u[3],k=u[4],V=u[5],Q=u[6],tt=u[7],ot=u[8],dt=u[9],_t=u[10],Nt=u[11],Ut=u[12],Wt=u[13],jt=u[14],Yt=u[15],le=p[0],me=p[1],_e=p[2],Oe=p[3];return a[0]=le*x+me*k+_e*ot+Oe*Ut,a[1]=le*B+me*V+_e*dt+Oe*Wt,a[2]=le*I+me*Q+_e*_t+Oe*jt,a[3]=le*D+me*tt+_e*Nt+Oe*Yt,a[4]=(le=p[4])*x+(me=p[5])*k+(_e=p[6])*ot+(Oe=p[7])*Ut,a[5]=le*B+me*V+_e*dt+Oe*Wt,a[6]=le*I+me*Q+_e*_t+Oe*jt,a[7]=le*D+me*tt+_e*Nt+Oe*Yt,a[8]=(le=p[8])*x+(me=p[9])*k+(_e=p[10])*ot+(Oe=p[11])*Ut,a[9]=le*B+me*V+_e*dt+Oe*Wt,a[10]=le*I+me*Q+_e*_t+Oe*jt,a[11]=le*D+me*tt+_e*Nt+Oe*Yt,a[12]=(le=p[12])*x+(me=p[13])*k+(_e=p[14])*ot+(Oe=p[15])*Ut,a[13]=le*B+me*V+_e*dt+Oe*Wt,a[14]=le*I+me*Q+_e*_t+Oe*jt,a[15]=le*D+me*tt+_e*Nt+Oe*Yt,a}Math.hypot||(Math.hypot=function(){for(var a=arguments,u=0,p=arguments.length;p--;)u+=a[p]*a[p];return Math.sqrt(u)});var Uc,gv=qo;function Jf(a,u,p){var x=u[0],B=u[1],I=u[2],D=u[3];return a[0]=p[0]*x+p[4]*B+p[8]*I+p[12]*D,a[1]=p[1]*x+p[5]*B+p[9]*I+p[13]*D,a[2]=p[2]*x+p[6]*B+p[10]*I+p[14]*D,a[3]=p[3]*x+p[7]*B+p[11]*I+p[15]*D,a}Uc=new Bn(3),Bn!=Float32Array&&(Uc[0]=0,Uc[1]=0,Uc[2]=0),function(){var a=new Bn(4);Bn!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)}();var mv=(function(){var a=new Bn(2);Bn!=Float32Array&&(a[0]=0,a[1]=0)}(),function(a){function u(p){a.call(this,p,Nc)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.createBucket=function(p){return new Lo(p)},u.prototype.queryRadius=function(p){var x=p;return Oa("circle-radius",this,x)+Oa("circle-stroke-width",this,x)+Zr(this.paint.get("circle-translate"))},u.prototype.queryIntersectsFeature=function(p,x,B,I,D,k,V,Q){for(var tt=ll(p,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),k.angle,V),ot=this.paint.get("circle-radius").evaluate(x,B)+this.paint.get("circle-stroke-width").evaluate(x,B),dt=this.paint.get("circle-pitch-alignment")==="map",_t=dt?tt:function(Je,qe){return Je.map(function(bi){return Nh(bi,qe)})}(tt,Q),Nt=dt?ot*V:ot,Ut=0,Wt=I;Ut<Wt.length;Ut+=1)for(var jt=0,Yt=Wt[Ut];jt<Yt.length;jt+=1){var le=Yt[jt],me=dt?le:Nh(le,Q),_e=Nt,Oe=Jf([],[le.x,le.y,0,1],Q);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?_e*=Oe[3]/k.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(_e*=k.cameraToCenterDistance/Oe[3]),Yo(_t,me,_e))return!0}return!1},u}(Ni));function Nh(a,u){var p=Jf([],[a.x,a.y,0,1],u);return new v(p[0]/p[3],p[1]/p[3])}var dm=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(Lo);function Du(a,u,p,x){var B=u.width,I=u.height;if(x){if(x instanceof Uint8ClampedArray)x=new Uint8Array(x.buffer);else if(x.length!==B*I*p)throw new RangeError("mismatched image size")}else x=new Uint8Array(B*I*p);return a.width=B,a.height=I,a.data=x,a}function Xf(a,u,p){var x=u.width,B=u.height;if(x!==a.width||B!==a.height){var I=Du({},{width:x,height:B},p);yv(a,I,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,x),height:Math.min(a.height,B)},p),a.width=x,a.height=B,a.data=I.data}}function yv(a,u,p,x,B,I){if(B.width===0||B.height===0)return u;if(B.width>a.width||B.height>a.height||p.x>a.width-B.width||p.y>a.height-B.height)throw new RangeError("out of range source coordinates for image copy");if(B.width>u.width||B.height>u.height||x.x>u.width-B.width||x.y>u.height-B.height)throw new RangeError("out of range destination coordinates for image copy");for(var D=a.data,k=u.data,V=0;V<B.height;V++)for(var Q=((p.y+V)*a.width+p.x)*I,tt=((x.y+V)*u.width+x.x)*I,ot=0;ot<B.width*I;ot++)k[tt+ot]=D[Q+ot];return u}ai("HeatmapBucket",dm,{omit:["layers"]});var Uh=function(a,u){Du(this,a,1,u)};Uh.prototype.resize=function(a){Xf(this,a,1)},Uh.prototype.clone=function(){return new Uh({width:this.width,height:this.height},new Uint8Array(this.data))},Uh.copy=function(a,u,p,x,B){yv(a,u,p,x,B,1)};var ps=function(a,u){Du(this,a,4,u)};ps.prototype.resize=function(a){Xf(this,a,4)},ps.prototype.replace=function(a,u){u?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a},ps.prototype.clone=function(){return new ps({width:this.width,height:this.height},new Uint8Array(this.data))},ps.copy=function(a,u,p,x,B){yv(a,u,p,x,B,4)},ai("AlphaImage",Uh),ai("RGBAImage",ps);var xN={paint:new Qn({"heatmap-radius":new ui(lt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ui(lt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new xi(lt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Kr(lt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new xi(lt.paint_heatmap["heatmap-opacity"])})};function r3(a){var u={},p=a.resolution||256,x=a.clips?a.clips.length:1,B=a.image||new ps({width:p,height:x}),I=function(Nt,Ut,Wt){u[a.evaluationKey]=Wt;var jt=a.expression.evaluate(u);B.data[Nt+Ut+0]=Math.floor(255*jt.r/jt.a),B.data[Nt+Ut+1]=Math.floor(255*jt.g/jt.a),B.data[Nt+Ut+2]=Math.floor(255*jt.b/jt.a),B.data[Nt+Ut+3]=Math.floor(255*jt.a)};if(a.clips)for(var D=0,k=0;D<x;++D,k+=4*p)for(var V=0,Q=0;V<p;V++,Q+=4){var tt=V/(p-1),ot=a.clips[D];I(k,Q,ot.start*(1-tt)+ot.end*tt)}else for(var dt=0,_t=0;dt<p;dt++,_t+=4)I(0,_t,dt/(p-1));return B}var wN=function(a){function u(p){a.call(this,p,xN),this._updateColorRamp()}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.createBucket=function(p){return new dm(p)},u.prototype._handleSpecialPaintPropertyUpdate=function(p){p==="heatmap-color"&&this._updateColorRamp()},u.prototype._updateColorRamp=function(){this.colorRamp=r3({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},u.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},u}(Ni),CN={paint:new Qn({"hillshade-illumination-direction":new xi(lt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new xi(lt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new xi(lt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new xi(lt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new xi(lt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new xi(lt.paint_hillshade["hillshade-accent-color"])})},EN=function(a){function u(p){a.call(this,p,CN)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},u}(Ni),BN=Fr([{name:"a_pos",components:2,type:"Int16"}],4).members,_v=pm,TN=pm;function pm(a,u,p){p=p||2;var x,B,I,D,k,V,Q,tt=u&&u.length,ot=tt?u[0]*p:a.length,dt=o3(a,0,ot,p,!0),_t=[];if(!dt||dt.next===dt.prev)return _t;if(tt&&(dt=function(Ut,Wt,jt,Yt){var le,me,_e,Oe=[];for(le=0,me=Wt.length;le<me;le++)(_e=o3(Ut,Wt[le]*Yt,le<me-1?Wt[le+1]*Yt:Ut.length,Yt,!1))===_e.next&&(_e.steiner=!0),Oe.push(LN(_e));for(Oe.sort(RN),le=0;le<Oe.length;le++)DN(Oe[le],jt),jt=Ou(jt,jt.next);return jt}(a,u,dt,p)),a.length>80*p){x=I=a[0],B=D=a[1];for(var Nt=p;Nt<ot;Nt+=p)(k=a[Nt])<x&&(x=k),(V=a[Nt+1])<B&&(B=V),k>I&&(I=k),V>D&&(D=V);Q=(Q=Math.max(I-x,D-B))!==0?1/Q:0}return pA(dt,_t,p,x,B,Q),_t}function o3(a,u,p,x,B){var I,D;if(B===xv(a,u,p,x)>0)for(I=u;I<p;I+=x)D=l3(I,a[I],a[I+1],D);else for(I=p-x;I>=u;I-=x)D=l3(I,a[I],a[I+1],D);return D&&Am(D,D.next)&&(gA(D),D=D.next),D}function Ou(a,u){if(!a)return a;u||(u=a);var p,x=a;do if(p=!1,x.steiner||!Am(x,x.next)&&Gr(x.prev,x,x.next)!==0)x=x.next;else{if(gA(x),(x=u=x.prev)===x.next)break;p=!0}while(p||x!==u);return u}function pA(a,u,p,x,B,I,D){if(a){!D&&I&&function(tt,ot,dt,_t){var Nt=tt;do Nt.z===null&&(Nt.z=vv(Nt.x,Nt.y,ot,dt,_t)),Nt.prevZ=Nt.prev,Nt.nextZ=Nt.next,Nt=Nt.next;while(Nt!==tt);Nt.prevZ.nextZ=null,Nt.prevZ=null,function(Ut){var Wt,jt,Yt,le,me,_e,Oe,Je,qe=1;do{for(jt=Ut,Ut=null,me=null,_e=0;jt;){for(_e++,Yt=jt,Oe=0,Wt=0;Wt<qe&&(Oe++,Yt=Yt.nextZ);Wt++);for(Je=qe;Oe>0||Je>0&&Yt;)Oe!==0&&(Je===0||!Yt||jt.z<=Yt.z)?(le=jt,jt=jt.nextZ,Oe--):(le=Yt,Yt=Yt.nextZ,Je--),me?me.nextZ=le:Ut=le,le.prevZ=me,me=le;jt=Yt}me.nextZ=null,qe*=2}while(_e>1)}(Nt)}(a,x,B,I);for(var k,V,Q=a;a.prev!==a.next;)if(k=a.prev,V=a.next,I?IN(a,x,B,I):SN(a))u.push(k.i/p),u.push(a.i/p),u.push(V.i/p),gA(a),a=V.next,Q=V.next;else if((a=V)===Q){D?D===1?pA(a=MN(Ou(a),u,p),u,p,x,B,I,2):D===2&&PN(a,u,p,x,B,I):pA(Ou(a),u,p,x,B,I,1);break}}}function SN(a){var u=a.prev,p=a,x=a.next;if(Gr(u,p,x)>=0)return!1;for(var B=a.next.next;B!==a.prev;){if(Kf(u.x,u.y,p.x,p.y,x.x,x.y,B.x,B.y)&&Gr(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function IN(a,u,p,x){var B=a.prev,I=a,D=a.next;if(Gr(B,I,D)>=0)return!1;for(var k=B.x>I.x?B.x>D.x?B.x:D.x:I.x>D.x?I.x:D.x,V=B.y>I.y?B.y>D.y?B.y:D.y:I.y>D.y?I.y:D.y,Q=vv(B.x<I.x?B.x<D.x?B.x:D.x:I.x<D.x?I.x:D.x,B.y<I.y?B.y<D.y?B.y:D.y:I.y<D.y?I.y:D.y,u,p,x),tt=vv(k,V,u,p,x),ot=a.prevZ,dt=a.nextZ;ot&&ot.z>=Q&&dt&&dt.z<=tt;){if(ot!==a.prev&&ot!==a.next&&Kf(B.x,B.y,I.x,I.y,D.x,D.y,ot.x,ot.y)&&Gr(ot.prev,ot,ot.next)>=0||(ot=ot.prevZ,dt!==a.prev&&dt!==a.next&&Kf(B.x,B.y,I.x,I.y,D.x,D.y,dt.x,dt.y)&&Gr(dt.prev,dt,dt.next)>=0))return!1;dt=dt.nextZ}for(;ot&&ot.z>=Q;){if(ot!==a.prev&&ot!==a.next&&Kf(B.x,B.y,I.x,I.y,D.x,D.y,ot.x,ot.y)&&Gr(ot.prev,ot,ot.next)>=0)return!1;ot=ot.prevZ}for(;dt&&dt.z<=tt;){if(dt!==a.prev&&dt!==a.next&&Kf(B.x,B.y,I.x,I.y,D.x,D.y,dt.x,dt.y)&&Gr(dt.prev,dt,dt.next)>=0)return!1;dt=dt.nextZ}return!0}function MN(a,u,p){var x=a;do{var B=x.prev,I=x.next.next;!Am(B,I)&&s3(B,x,x.next,I)&&AA(B,I)&&AA(I,B)&&(u.push(B.i/p),u.push(x.i/p),u.push(I.i/p),gA(x),gA(x.next),x=a=I),x=x.next}while(x!==a);return Ou(x)}function PN(a,u,p,x,B,I){var D=a;do{for(var k=D.next.next;k!==D.prev;){if(D.i!==k.i&&FN(D,k)){var V=a3(D,k);return D=Ou(D,D.next),V=Ou(V,V.next),pA(D,u,p,x,B,I),void pA(V,u,p,x,B,I)}k=k.next}D=D.next}while(D!==a)}function RN(a,u){return a.x-u.x}function DN(a,u){if(u=function(x,B){var I,D=B,k=x.x,V=x.y,Q=-1/0;do{if(V<=D.y&&V>=D.next.y&&D.next.y!==D.y){var tt=D.x+(V-D.y)*(D.next.x-D.x)/(D.next.y-D.y);if(tt<=k&&tt>Q){if(Q=tt,tt===k){if(V===D.y)return D;if(V===D.next.y)return D.next}I=D.x<D.next.x?D:D.next}}D=D.next}while(D!==B);if(!I)return null;if(k===Q)return I;var ot,dt=I,_t=I.x,Nt=I.y,Ut=1/0;D=I;do k>=D.x&&D.x>=_t&&k!==D.x&&Kf(V<Nt?k:Q,V,_t,Nt,V<Nt?Q:k,V,D.x,D.y)&&(ot=Math.abs(V-D.y)/(k-D.x),AA(D,x)&&(ot<Ut||ot===Ut&&(D.x>I.x||D.x===I.x&&ON(I,D)))&&(I=D,Ut=ot)),D=D.next;while(D!==dt);return I}(a,u)){var p=a3(u,a);Ou(u,u.next),Ou(p,p.next)}}function ON(a,u){return Gr(a.prev,a,u.prev)<0&&Gr(u.next,a,a.next)<0}function vv(a,u,p,x,B){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-p)*B)|a<<8))|a<<4))|a<<2))|a<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=32767*(u-x)*B)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function LN(a){var u=a,p=a;do(u.x<p.x||u.x===p.x&&u.y<p.y)&&(p=u),u=u.next;while(u!==a);return p}function Kf(a,u,p,x,B,I,D,k){return(B-D)*(u-k)-(a-D)*(I-k)>=0&&(a-D)*(x-k)-(p-D)*(u-k)>=0&&(p-D)*(I-k)-(B-D)*(x-k)>=0}function FN(a,u){return a.next.i!==u.i&&a.prev.i!==u.i&&!function(p,x){var B=p;do{if(B.i!==p.i&&B.next.i!==p.i&&B.i!==x.i&&B.next.i!==x.i&&s3(B,B.next,p,x))return!0;B=B.next}while(B!==p);return!1}(a,u)&&(AA(a,u)&&AA(u,a)&&function(p,x){var B=p,I=!1,D=(p.x+x.x)/2,k=(p.y+x.y)/2;do B.y>k!=B.next.y>k&&B.next.y!==B.y&&D<(B.next.x-B.x)*(k-B.y)/(B.next.y-B.y)+B.x&&(I=!I),B=B.next;while(B!==p);return I}(a,u)&&(Gr(a.prev,a,u.prev)||Gr(a,u.prev,u))||Am(a,u)&&Gr(a.prev,a,a.next)>0&&Gr(u.prev,u,u.next)>0)}function Gr(a,u,p){return(u.y-a.y)*(p.x-u.x)-(u.x-a.x)*(p.y-u.y)}function Am(a,u){return a.x===u.x&&a.y===u.y}function s3(a,u,p,x){var B=mm(Gr(a,u,p)),I=mm(Gr(a,u,x)),D=mm(Gr(p,x,a)),k=mm(Gr(p,x,u));return B!==I&&D!==k||!(B!==0||!gm(a,p,u))||!(I!==0||!gm(a,x,u))||!(D!==0||!gm(p,a,x))||!(k!==0||!gm(p,u,x))}function gm(a,u,p){return u.x<=Math.max(a.x,p.x)&&u.x>=Math.min(a.x,p.x)&&u.y<=Math.max(a.y,p.y)&&u.y>=Math.min(a.y,p.y)}function mm(a){return a>0?1:a<0?-1:0}function AA(a,u){return Gr(a.prev,a,a.next)<0?Gr(a,u,a.next)>=0&&Gr(a,a.prev,u)>=0:Gr(a,u,a.prev)<0||Gr(a,a.next,u)<0}function a3(a,u){var p=new bv(a.i,a.x,a.y),x=new bv(u.i,u.x,u.y),B=a.next,I=u.prev;return a.next=u,u.prev=a,p.next=B,B.prev=p,x.next=p,p.prev=x,I.next=x,x.prev=I,x}function l3(a,u,p,x){var B=new bv(a,u,p);return x?(B.next=x.next,B.prev=x,x.next.prev=B,x.next=B):(B.prev=B,B.next=B),B}function gA(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function bv(a,u,p){this.i=a,this.x=u,this.y=p,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function xv(a,u,p,x){for(var B=0,I=u,D=p-x;I<p;I+=x)B+=(a[D]-a[I])*(a[I+1]+a[D+1]),D=I;return B}function kN(a,u,p,x,B){(function I(D,k,V,Q,tt){for(;Q>V;){if(Q-V>600){var ot=Q-V+1,dt=k-V+1,_t=Math.log(ot),Nt=.5*Math.exp(2*_t/3),Ut=.5*Math.sqrt(_t*Nt*(ot-Nt)/ot)*(dt-ot/2<0?-1:1);I(D,k,Math.max(V,Math.floor(k-dt*Nt/ot+Ut)),Math.min(Q,Math.floor(k+(ot-dt)*Nt/ot+Ut)),tt)}var Wt=D[k],jt=V,Yt=Q;for(mA(D,V,k),tt(D[Q],Wt)>0&&mA(D,V,Q);jt<Yt;){for(mA(D,jt,Yt),jt++,Yt--;tt(D[jt],Wt)<0;)jt++;for(;tt(D[Yt],Wt)>0;)Yt--}tt(D[V],Wt)===0?mA(D,V,Yt):mA(D,++Yt,Q),Yt<=k&&(V=Yt+1),k<=Yt&&(Q=Yt-1)}})(a,u,p,x||a.length-1,B||NN)}function mA(a,u,p){var x=a[u];a[u]=a[p],a[p]=x}function NN(a,u){return a<u?-1:a>u?1:0}function wv(a,u){var p=a.length;if(p<=1)return[a];for(var x,B,I=[],D=0;D<p;D++){var k=pe(a[D]);k!==0&&(a[D].area=Math.abs(k),B===void 0&&(B=k<0),B===k<0?(x&&I.push(x),x=[a[D]]):x.push(a[D]))}if(x&&I.push(x),u>1)for(var V=0;V<I.length;V++)I[V].length<=u||(kN(I[V],u,1,I[V].length-1,UN),I[V]=I[V].slice(0,u));return I}function UN(a,u){return u.area-a.area}function Cv(a,u,p){for(var x=p.patternDependencies,B=!1,I=0,D=u;I<D.length;I+=1){var k=D[I].paint.get(a+"-pattern");k.isConstant()||(B=!0);var V=k.constantOr(null);V&&(B=!0,x[V.to]=!0,x[V.from]=!0)}return B}function Ev(a,u,p,x,B){for(var I=B.patternDependencies,D=0,k=u;D<k.length;D+=1){var V=k[D],Q=V.paint.get(a+"-pattern").value;if(Q.kind!=="constant"){var tt=Q.evaluate({zoom:x-1},p,{},B.availableImages),ot=Q.evaluate({zoom:x},p,{},B.availableImages),dt=Q.evaluate({zoom:x+1},p,{},B.availableImages);ot=ot&&ot.name?ot.name:ot,dt=dt&&dt.name?dt.name:dt,I[tt=tt&&tt.name?tt.name:tt]=!0,I[ot]=!0,I[dt]=!0,p.patterns[V.id]={min:tt,mid:ot,max:dt}}}return p}pm.deviation=function(a,u,p,x){var B=u&&u.length,I=Math.abs(xv(a,0,B?u[0]*p:a.length,p));if(B)for(var D=0,k=u.length;D<k;D++)I-=Math.abs(xv(a,u[D]*p,D<k-1?u[D+1]*p:a.length,p));var V=0;for(D=0;D<x.length;D+=3){var Q=x[D]*p,tt=x[D+1]*p,ot=x[D+2]*p;V+=Math.abs((a[Q]-a[ot])*(a[tt+1]-a[Q+1])-(a[Q]-a[tt])*(a[ot+1]-a[Q+1]))}return I===0&&V===0?0:Math.abs((V-I)/I)},pm.flatten=function(a){for(var u=a[0][0].length,p={vertices:[],holes:[],dimensions:u},x=0,B=0;B<a.length;B++){for(var I=0;I<a[B].length;I++)for(var D=0;D<u;D++)p.vertices.push(a[B][I][D]);B>0&&p.holes.push(x+=a[B-1].length)}return p},_v.default=TN;var cl=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Zo,this.indexArray=new la,this.indexArray2=new T,this.programConfigurations=new Di(a.layers,a.zoom),this.segments=new $,this.segments2=new $,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};cl.prototype.populate=function(a,u,p){this.hasPattern=Cv("fill",this.layers,u);for(var x=this.layers[0].layout.get("fill-sort-key"),B=[],I=0,D=a;I<D.length;I+=1){var k=D[I],V=k.feature,Q=k.id,tt=k.index,ot=k.sourceLayerIndex,dt=this.layers[0]._featureFilter.needGeometry,_t=Pr(V,dt);if(this.layers[0]._featureFilter.filter(new Vi(this.zoom),_t,p)){var Nt=x?x.evaluate(_t,{},p,u.availableImages):void 0,Ut={id:Q,properties:V.properties,type:V.type,sourceLayerIndex:ot,index:tt,geometry:dt?_t.geometry:xr(V),patterns:{},sortKey:Nt};B.push(Ut)}}x&&B.sort(function(Je,qe){return Je.sortKey-qe.sortKey});for(var Wt=0,jt=B;Wt<jt.length;Wt+=1){var Yt=jt[Wt],le=Yt.geometry,me=Yt.index,_e=Yt.sourceLayerIndex;if(this.hasPattern){var Oe=Ev("fill",this.layers,Yt,this.zoom,u);this.patternFeatures.push(Oe)}else this.addFeature(Yt,le,me,p,{});u.featureIndex.insert(a[me].feature,le,me,_e,this.index)}},cl.prototype.update=function(a,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,p)},cl.prototype.addFeatures=function(a,u,p){for(var x=0,B=this.patternFeatures;x<B.length;x+=1){var I=B[x];this.addFeature(I,I.geometry,I.index,u,p)}},cl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},cl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},cl.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,BN),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0},cl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},cl.prototype.addFeature=function(a,u,p,x,B){for(var I=0,D=wv(u,500);I<D.length;I+=1){for(var k=D[I],V=0,Q=0,tt=k;Q<tt.length;Q+=1)V+=tt[Q].length;for(var ot=this.segments.prepareSegment(V,this.layoutVertexArray,this.indexArray),dt=ot.vertexLength,_t=[],Nt=[],Ut=0,Wt=k;Ut<Wt.length;Ut+=1){var jt=Wt[Ut];if(jt.length!==0){jt!==k[0]&&Nt.push(_t.length/2);var Yt=this.segments2.prepareSegment(jt.length,this.layoutVertexArray,this.indexArray2),le=Yt.vertexLength;this.layoutVertexArray.emplaceBack(jt[0].x,jt[0].y),this.indexArray2.emplaceBack(le+jt.length-1,le),_t.push(jt[0].x),_t.push(jt[0].y);for(var me=1;me<jt.length;me++)this.layoutVertexArray.emplaceBack(jt[me].x,jt[me].y),this.indexArray2.emplaceBack(le+me-1,le+me),_t.push(jt[me].x),_t.push(jt[me].y);Yt.vertexLength+=jt.length,Yt.primitiveLength+=jt.length}}for(var _e=_v(_t,Nt),Oe=0;Oe<_e.length;Oe+=3)this.indexArray.emplaceBack(dt+_e[Oe],dt+_e[Oe+1],dt+_e[Oe+2]);ot.vertexLength+=V,ot.primitiveLength+=_e.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,B,x)},ai("FillBucket",cl,{omit:["layers","patternFeatures"]});var GN=new Qn({"fill-sort-key":new ui(lt.layout_fill["fill-sort-key"])}),zN={paint:new Qn({"fill-antialias":new xi(lt.paint_fill["fill-antialias"]),"fill-opacity":new ui(lt.paint_fill["fill-opacity"]),"fill-color":new ui(lt.paint_fill["fill-color"]),"fill-outline-color":new ui(lt.paint_fill["fill-outline-color"]),"fill-translate":new xi(lt.paint_fill["fill-translate"]),"fill-translate-anchor":new xi(lt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Iu(lt.paint_fill["fill-pattern"])}),layout:GN},VN=function(a){function u(p){a.call(this,p,zN)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.recalculate=function(p,x){a.prototype.recalculate.call(this,p,x);var B=this.paint._values["fill-outline-color"];B.value.kind==="constant"&&B.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},u.prototype.createBucket=function(p){return new cl(p)},u.prototype.queryRadius=function(){return Zr(this.paint.get("fill-translate"))},u.prototype.queryIntersectsFeature=function(p,x,B,I,D,k,V){return ca(ll(p,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),k.angle,V),I)},u.prototype.isTileClipped=function(){return!0},u}(Ni),jN=Fr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,c3=Qf;function Qf(a,u,p,x,B){this.properties={},this.extent=p,this.type=0,this._pbf=a,this._geometry=-1,this._keys=x,this._values=B,a.readFields(HN,this,u)}function HN(a,u,p){a==1?u.id=p.readVarint():a==2?function(x,B){for(var I=x.readVarint()+x.pos;x.pos<I;){var D=B._keys[x.readVarint()],k=B._values[x.readVarint()];B.properties[D]=k}}(p,u):a==3?u.type=p.readVarint():a==4&&(u._geometry=p.pos)}function WN(a){for(var u,p,x=0,B=0,I=a.length,D=I-1;B<I;D=B++)x+=((p=a[D]).x-(u=a[B]).x)*(u.y+p.y);return x}Qf.types=["Unknown","Point","LineString","Polygon"],Qf.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var u,p=a.readVarint()+a.pos,x=1,B=0,I=0,D=0,k=[];a.pos<p;){if(B<=0){var V=a.readVarint();x=7&V,B=V>>3}if(B--,x===1||x===2)I+=a.readSVarint(),D+=a.readSVarint(),x===1&&(u&&k.push(u),u=[]),u.push(new v(I,D));else{if(x!==7)throw new Error("unknown command "+x);u&&u.push(u[0].clone())}}return u&&k.push(u),k},Qf.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var u=a.readVarint()+a.pos,p=1,x=0,B=0,I=0,D=1/0,k=-1/0,V=1/0,Q=-1/0;a.pos<u;){if(x<=0){var tt=a.readVarint();p=7&tt,x=tt>>3}if(x--,p===1||p===2)(B+=a.readSVarint())<D&&(D=B),B>k&&(k=B),(I+=a.readSVarint())<V&&(V=I),I>Q&&(Q=I);else if(p!==7)throw new Error("unknown command "+p)}return[D,V,k,Q]},Qf.prototype.toGeoJSON=function(a,u,p){var x,B,I=this.extent*Math.pow(2,p),D=this.extent*a,k=this.extent*u,V=this.loadGeometry(),Q=Qf.types[this.type];function tt(_t){for(var Nt=0;Nt<_t.length;Nt++){var Ut=_t[Nt];_t[Nt]=[360*(Ut.x+D)/I-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ut.y+k)/I)*Math.PI/180))-90]}}switch(this.type){case 1:var ot=[];for(x=0;x<V.length;x++)ot[x]=V[x][0];tt(V=ot);break;case 2:for(x=0;x<V.length;x++)tt(V[x]);break;case 3:for(V=function(_t){var Nt=_t.length;if(Nt<=1)return[_t];for(var Ut,Wt,jt=[],Yt=0;Yt<Nt;Yt++){var le=WN(_t[Yt]);le!==0&&(Wt===void 0&&(Wt=le<0),Wt===le<0?(Ut&&jt.push(Ut),Ut=[_t[Yt]]):Ut.push(_t[Yt]))}return Ut&&jt.push(Ut),jt}(V),x=0;x<V.length;x++)for(B=0;B<V[x].length;B++)tt(V[x][B])}V.length===1?V=V[0]:Q="Multi"+Q;var dt={type:"Feature",geometry:{type:Q,coordinates:V},properties:this.properties};return"id"in this&&(dt.id=this.id),dt};var u3=h3;function h3(a,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(JN,this,u),this.length=this._features.length}function JN(a,u,p){a===15?u.version=p.readVarint():a===1?u.name=p.readString():a===5?u.extent=p.readVarint():a===2?u._features.push(p.pos):a===3?u._keys.push(p.readString()):a===4&&u._values.push(function(x){for(var B=null,I=x.readVarint()+x.pos;x.pos<I;){var D=x.readVarint()>>3;B=D===1?x.readString():D===2?x.readFloat():D===3?x.readDouble():D===4?x.readVarint64():D===5?x.readVarint():D===6?x.readSVarint():D===7?x.readBoolean():null}return B}(p))}function XN(a,u,p){if(a===3){var x=new u3(p,p.readVarint()+p.pos);x.length&&(u[x.name]=x)}}h3.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var u=this._pbf.readVarint()+this._pbf.pos;return new c3(this._pbf,u,this.extent,this._keys,this._values)};var Zf={VectorTile:function(a,u){this.layers=a.readFields(XN,{},u)},VectorTileFeature:c3,VectorTileLayer:u3},KN=Zf.VectorTileFeature.types,Bv=Math.pow(2,13);function yA(a,u,p,x,B,I,D,k){a.emplaceBack(u,p,2*Math.floor(x*Bv)+D,B*Bv*2,I*Bv*2,Math.round(k))}var ul=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new pr,this.indexArray=new la,this.programConfigurations=new Di(a.layers,a.zoom),this.segments=new $,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function QN(a,u){return a.x===u.x&&(a.x<0||a.x>8192)||a.y===u.y&&(a.y<0||a.y>8192)}ul.prototype.populate=function(a,u,p){this.features=[],this.hasPattern=Cv("fill-extrusion",this.layers,u);for(var x=0,B=a;x<B.length;x+=1){var I=B[x],D=I.feature,k=I.id,V=I.index,Q=I.sourceLayerIndex,tt=this.layers[0]._featureFilter.needGeometry,ot=Pr(D,tt);if(this.layers[0]._featureFilter.filter(new Vi(this.zoom),ot,p)){var dt={id:k,sourceLayerIndex:Q,index:V,geometry:tt?ot.geometry:xr(D),properties:D.properties,type:D.type,patterns:{}};this.hasPattern?this.features.push(Ev("fill-extrusion",this.layers,dt,this.zoom,u)):this.addFeature(dt,dt.geometry,V,p,{}),u.featureIndex.insert(D,dt.geometry,V,Q,this.index,!0)}}},ul.prototype.addFeatures=function(a,u,p){for(var x=0,B=this.features;x<B.length;x+=1){var I=B[x];this.addFeature(I,I.geometry,I.index,u,p)}},ul.prototype.update=function(a,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,p)},ul.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ul.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ul.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,jN),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},ul.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ul.prototype.addFeature=function(a,u,p,x,B){for(var I=0,D=wv(u,500);I<D.length;I+=1){for(var k=D[I],V=0,Q=0,tt=k;Q<tt.length;Q+=1)V+=tt[Q].length;for(var ot=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),dt=0,_t=k;dt<_t.length;dt+=1){var Nt=_t[dt];if(Nt.length!==0&&!((hn=Nt).every(function(Qi){return Qi.x<0})||hn.every(function(Qi){return Qi.x>8192})||hn.every(function(Qi){return Qi.y<0})||hn.every(function(Qi){return Qi.y>8192})))for(var Ut=0,Wt=0;Wt<Nt.length;Wt++){var jt=Nt[Wt];if(Wt>=1){var Yt=Nt[Wt-1];if(!QN(jt,Yt)){ot.vertexLength+4>$.MAX_VERTEX_ARRAY_LENGTH&&(ot=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var le=jt.sub(Yt)._perp()._unit(),me=Yt.dist(jt);Ut+me>32768&&(Ut=0),yA(this.layoutVertexArray,jt.x,jt.y,le.x,le.y,0,0,Ut),yA(this.layoutVertexArray,jt.x,jt.y,le.x,le.y,0,1,Ut),yA(this.layoutVertexArray,Yt.x,Yt.y,le.x,le.y,0,0,Ut+=me),yA(this.layoutVertexArray,Yt.x,Yt.y,le.x,le.y,0,1,Ut);var _e=ot.vertexLength;this.indexArray.emplaceBack(_e,_e+2,_e+1),this.indexArray.emplaceBack(_e+1,_e+2,_e+3),ot.vertexLength+=4,ot.primitiveLength+=2}}}}if(ot.vertexLength+V>$.MAX_VERTEX_ARRAY_LENGTH&&(ot=this.segments.prepareSegment(V,this.layoutVertexArray,this.indexArray)),KN[a.type]==="Polygon"){for(var Oe=[],Je=[],qe=ot.vertexLength,bi=0,ri=k;bi<ri.length;bi+=1){var Ei=ri[bi];if(Ei.length!==0){Ei!==k[0]&&Je.push(Oe.length/2);for(var oi=0;oi<Ei.length;oi++){var rn=Ei[oi];yA(this.layoutVertexArray,rn.x,rn.y,0,0,1,1,0),Oe.push(rn.x),Oe.push(rn.y)}}}for(var Oi=_v(Oe,Je),di=0;di<Oi.length;di+=3)this.indexArray.emplaceBack(qe+Oi[di],qe+Oi[di+2],qe+Oi[di+1]);ot.primitiveLength+=Oi.length/3,ot.vertexLength+=V}}var hn;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,B,x)},ai("FillExtrusionBucket",ul,{omit:["layers","features"]});var ZN={paint:new Qn({"fill-extrusion-opacity":new xi(lt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ui(lt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new xi(lt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new xi(lt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Iu(lt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ui(lt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ui(lt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new xi(lt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},YN=function(a){function u(p){a.call(this,p,ZN)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.createBucket=function(p){return new ul(p)},u.prototype.queryRadius=function(){return Zr(this.paint.get("fill-extrusion-translate"))},u.prototype.is3D=function(){return!0},u.prototype.queryIntersectsFeature=function(p,x,B,I,D,k,V,Q){var tt=ll(p,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),k.angle,V),ot=this.paint.get("fill-extrusion-height").evaluate(x,B),dt=this.paint.get("fill-extrusion-base").evaluate(x,B),_t=function(Ut,Wt,jt,Yt){for(var le=[],me=0,_e=Ut;me<_e.length;me+=1){var Oe=_e[me],Je=[Oe.x,Oe.y,0,1];Jf(Je,Je,Wt),le.push(new v(Je[0]/Je[3],Je[1]/Je[3]))}return le}(tt,Q),Nt=function(Ut,Wt,jt,Yt){for(var le=[],me=[],_e=Yt[8]*Wt,Oe=Yt[9]*Wt,Je=Yt[10]*Wt,qe=Yt[11]*Wt,bi=Yt[8]*jt,ri=Yt[9]*jt,Ei=Yt[10]*jt,oi=Yt[11]*jt,rn=0,Oi=Ut;rn<Oi.length;rn+=1){for(var di=[],hn=[],Qi=0,vn=Oi[rn];Qi<vn.length;Qi+=1){var Bi=vn[Qi],Cn=Bi.x,sr=Bi.y,Sr=Yt[0]*Cn+Yt[4]*sr+Yt[12],wr=Yt[1]*Cn+Yt[5]*sr+Yt[13],ar=Yt[2]*Cn+Yt[6]*sr+Yt[14],Ir=Yt[3]*Cn+Yt[7]*sr+Yt[15],Yr=ar+Je,qr=Ir+qe,ko=Sr+bi,lo=wr+ri,No=ar+Ei,Rr=Ir+oi,co=new v((Sr+_e)/qr,(wr+Oe)/qr);co.z=Yr/qr,di.push(co);var An=new v(ko/Rr,lo/Rr);An.z=No/Rr,hn.push(An)}le.push(di),me.push(hn)}return[le,me]}(I,dt,ot,Q);return function(Ut,Wt,jt){var Yt=1/0;ca(jt,Wt)&&(Yt=f3(jt,Wt[0]));for(var le=0;le<Wt.length;le++)for(var me=Wt[le],_e=Ut[le],Oe=0;Oe<me.length-1;Oe++){var Je=me[Oe],qe=[Je,me[Oe+1],_e[Oe+1],_e[Oe],Je];Jl(jt,qe)&&(Yt=Math.min(Yt,f3(jt,qe)))}return Yt!==1/0&&Yt}(Nt[0],Nt[1],_t)},u}(Ni);function _A(a,u){return a.x*u.x+a.y*u.y}function f3(a,u){if(a.length===1){for(var p,x=0,B=u[x++];!p||B.equals(p);)if(!(p=u[x++]))return 1/0;for(;x<u.length;x++){var I=u[x],D=a[0],k=p.sub(B),V=I.sub(B),Q=D.sub(B),tt=_A(k,k),ot=_A(k,V),dt=_A(V,V),_t=_A(Q,k),Nt=_A(Q,V),Ut=tt*dt-ot*ot,Wt=(dt*_t-ot*Nt)/Ut,jt=(tt*Nt-ot*_t)/Ut,Yt=B.z*(1-Wt-jt)+p.z*Wt+I.z*jt;if(isFinite(Yt))return Yt}return 1/0}for(var le=1/0,me=0,_e=u;me<_e.length;me+=1)le=Math.min(le,_e[me].z);return le}var qN=Fr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,$N=Fr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,tU=Zf.VectorTileFeature.types,eU=Math.cos(Math.PI/180*37.5),d3=Math.pow(2,14)/.5,$o=function(a){var u=this;this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(p){return p.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(p){u.gradients[p.id]={}}),this.layoutVertexArray=new oo,this.layoutVertexArray2=new Ss,this.indexArray=new la,this.programConfigurations=new Di(a.layers,a.zoom),this.segments=new $,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(p){return p.isStateDependent()}).map(function(p){return p.id})};$o.prototype.populate=function(a,u,p){this.hasPattern=Cv("line",this.layers,u);for(var x=this.layers[0].layout.get("line-sort-key"),B=[],I=0,D=a;I<D.length;I+=1){var k=D[I],V=k.feature,Q=k.id,tt=k.index,ot=k.sourceLayerIndex,dt=this.layers[0]._featureFilter.needGeometry,_t=Pr(V,dt);if(this.layers[0]._featureFilter.filter(new Vi(this.zoom),_t,p)){var Nt=x?x.evaluate(_t,{},p):void 0,Ut={id:Q,properties:V.properties,type:V.type,sourceLayerIndex:ot,index:tt,geometry:dt?_t.geometry:xr(V),patterns:{},sortKey:Nt};B.push(Ut)}}x&&B.sort(function(Je,qe){return Je.sortKey-qe.sortKey});for(var Wt=0,jt=B;Wt<jt.length;Wt+=1){var Yt=jt[Wt],le=Yt.geometry,me=Yt.index,_e=Yt.sourceLayerIndex;if(this.hasPattern){var Oe=Ev("line",this.layers,Yt,this.zoom,u);this.patternFeatures.push(Oe)}else this.addFeature(Yt,le,me,p,{});u.featureIndex.insert(a[me].feature,le,me,_e,this.index)}},$o.prototype.update=function(a,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,p)},$o.prototype.addFeatures=function(a,u,p){for(var x=0,B=this.patternFeatures;x<B.length;x+=1){var I=B[x];this.addFeature(I,I.geometry,I.index,u,p)}},$o.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},$o.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},$o.prototype.upload=function(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,$N)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,qN),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},$o.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},$o.prototype.lineFeatureClips=function(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}},$o.prototype.addFeature=function(a,u,p,x,B){var I=this.layers[0].layout,D=I.get("line-join").evaluate(a,{}),k=I.get("line-cap"),V=I.get("line-miter-limit"),Q=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(var tt=0,ot=u;tt<ot.length;tt+=1)this.addLine(ot[tt],a,D,k,V,Q);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,B,x)},$o.prototype.addLine=function(a,u,p,x,B,I){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var D=0;D<a.length-1;D++)this.totalDistance+=a[D].dist(a[D+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var k=tU[u.type]==="Polygon",V=a.length;V>=2&&a[V-1].equals(a[V-2]);)V--;for(var Q=0;Q<V-1&&a[Q].equals(a[Q+1]);)Q++;if(!(V<(k?3:2))){p==="bevel"&&(B=1.05);var tt,ot=this.overscaling<=16?122880/(512*this.overscaling):0,dt=this.segments.prepareSegment(10*V,this.layoutVertexArray,this.indexArray),_t=void 0,Nt=void 0,Ut=void 0,Wt=void 0;this.e1=this.e2=-1,k&&(Wt=a[Q].sub(tt=a[V-2])._unit()._perp());for(var jt=Q;jt<V;jt++)if(!(Nt=jt===V-1?k?a[Q+1]:void 0:a[jt+1])||!a[jt].equals(Nt)){Wt&&(Ut=Wt),tt&&(_t=tt),tt=a[jt],Wt=Nt?Nt.sub(tt)._unit()._perp():Ut;var Yt=(Ut=Ut||Wt).add(Wt);Yt.x===0&&Yt.y===0||Yt._unit();var le=Ut.x*Wt.x+Ut.y*Wt.y,me=Yt.x*Wt.x+Yt.y*Wt.y,_e=me!==0?1/me:1/0,Oe=2*Math.sqrt(2-2*me),Je=me<eU&&_t&&Nt,qe=Ut.x*Wt.y-Ut.y*Wt.x>0;if(Je&&jt>Q){var bi=tt.dist(_t);if(bi>2*ot){var ri=tt.sub(tt.sub(_t)._mult(ot/bi)._round());this.updateDistance(_t,ri),this.addCurrentVertex(ri,Ut,0,0,dt),_t=ri}}var Ei=_t&&Nt,oi=Ei?p:k?"butt":x;if(Ei&&oi==="round"&&(_e<I?oi="miter":_e<=2&&(oi="fakeround")),oi==="miter"&&_e>B&&(oi="bevel"),oi==="bevel"&&(_e>2&&(oi="flipbevel"),_e<B&&(oi="miter")),_t&&this.updateDistance(_t,tt),oi==="miter")Yt._mult(_e),this.addCurrentVertex(tt,Yt,0,0,dt);else if(oi==="flipbevel"){if(_e>100)Yt=Wt.mult(-1);else{var rn=_e*Ut.add(Wt).mag()/Ut.sub(Wt).mag();Yt._perp()._mult(rn*(qe?-1:1))}this.addCurrentVertex(tt,Yt,0,0,dt),this.addCurrentVertex(tt,Yt.mult(-1),0,0,dt)}else if(oi==="bevel"||oi==="fakeround"){var Oi=-Math.sqrt(_e*_e-1),di=qe?Oi:0,hn=qe?0:Oi;if(_t&&this.addCurrentVertex(tt,Ut,di,hn,dt),oi==="fakeround")for(var Qi=Math.round(180*Oe/Math.PI/20),vn=1;vn<Qi;vn++){var Bi=vn/Qi;if(Bi!==.5){var Cn=Bi-.5;Bi+=Bi*Cn*(Bi-1)*((1.0904+le*(le*(3.55645-1.43519*le)-3.2452))*Cn*Cn+(.848013+le*(.215638*le-1.06021)))}var sr=Wt.sub(Ut)._mult(Bi)._add(Ut)._unit()._mult(qe?-1:1);this.addHalfVertex(tt,sr.x,sr.y,!1,qe,0,dt)}Nt&&this.addCurrentVertex(tt,Wt,-di,-hn,dt)}else if(oi==="butt")this.addCurrentVertex(tt,Yt,0,0,dt);else if(oi==="square"){var Sr=_t?1:-1;this.addCurrentVertex(tt,Yt,Sr,Sr,dt)}else oi==="round"&&(_t&&(this.addCurrentVertex(tt,Ut,0,0,dt),this.addCurrentVertex(tt,Ut,1,1,dt,!0)),Nt&&(this.addCurrentVertex(tt,Wt,-1,-1,dt,!0),this.addCurrentVertex(tt,Wt,0,0,dt)));if(Je&&jt<V-1){var wr=tt.dist(Nt);if(wr>2*ot){var ar=tt.add(Nt.sub(tt)._mult(ot/wr)._round());this.updateDistance(tt,ar),this.addCurrentVertex(ar,Wt,0,0,dt),tt=ar}}}}},$o.prototype.addCurrentVertex=function(a,u,p,x,B,I){I===void 0&&(I=!1);var D=u.y*x-u.x,k=-u.y-u.x*x;this.addHalfVertex(a,u.x+u.y*p,u.y-u.x*p,I,!1,p,B),this.addHalfVertex(a,D,k,I,!0,-x,B),this.distance>d3/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(a,u,p,x,B,I))},$o.prototype.addHalfVertex=function(a,u,p,x,B,I,D){var k=.5*(this.lineClips?this.scaledDistance*(d3-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a.x<<1)+(x?1:0),(a.y<<1)+(B?1:0),Math.round(63*u)+128,Math.round(63*p)+128,1+(I===0?0:I<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var V=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,V),D.primitiveLength++),B?this.e2=V:this.e1=V},$o.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},$o.prototype.updateDistance=function(a,u){this.distance+=a.dist(u),this.updateScaledDistance()},ai("LineBucket",$o,{omit:["layers","patternFeatures"]});var iU=new Qn({"line-cap":new xi(lt.layout_line["line-cap"]),"line-join":new ui(lt.layout_line["line-join"]),"line-miter-limit":new xi(lt.layout_line["line-miter-limit"]),"line-round-limit":new xi(lt.layout_line["line-round-limit"]),"line-sort-key":new ui(lt.layout_line["line-sort-key"])}),p3={paint:new Qn({"line-opacity":new ui(lt.paint_line["line-opacity"]),"line-color":new ui(lt.paint_line["line-color"]),"line-translate":new xi(lt.paint_line["line-translate"]),"line-translate-anchor":new xi(lt.paint_line["line-translate-anchor"]),"line-width":new ui(lt.paint_line["line-width"]),"line-gap-width":new ui(lt.paint_line["line-gap-width"]),"line-offset":new ui(lt.paint_line["line-offset"]),"line-blur":new ui(lt.paint_line["line-blur"]),"line-dasharray":new fo(lt.paint_line["line-dasharray"]),"line-pattern":new Iu(lt.paint_line["line-pattern"]),"line-gradient":new Kr(lt.paint_line["line-gradient"])}),layout:iU},A3=new(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(p,x){return x=new Vi(Math.floor(x.zoom),{now:x.now,fadeDuration:x.fadeDuration,zoomHistory:x.zoomHistory,transition:x.transition}),a.prototype.possiblyEvaluate.call(this,p,x)},u.prototype.evaluate=function(p,x,B,I){return x=q({},x,{zoom:Math.floor(x.zoom)}),a.prototype.evaluate.call(this,p,x,B,I)},u}(ui))(p3.paint.properties["line-width"].specification);A3.useIntegerZoom=!0;var nU=function(a){function u(p){a.call(this,p,p3),this.gradientVersion=0}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._handleSpecialPaintPropertyUpdate=function(p){p==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof jn,this.gradientVersion=(this.gradientVersion+1)%L)},u.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},u.prototype.recalculate=function(p,x){a.prototype.recalculate.call(this,p,x),this.paint._values["line-floorwidth"]=A3.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,p)},u.prototype.createBucket=function(p){return new $o(p)},u.prototype.queryRadius=function(p){var x=p,B=g3(Oa("line-width",this,x),Oa("line-gap-width",this,x)),I=Oa("line-offset",this,x);return B/2+Math.abs(I)+Zr(this.paint.get("line-translate"))},u.prototype.queryIntersectsFeature=function(p,x,B,I,D,k,V){var Q=ll(p,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),k.angle,V),tt=V/2*g3(this.paint.get("line-width").evaluate(x,B),this.paint.get("line-gap-width").evaluate(x,B)),ot=this.paint.get("line-offset").evaluate(x,B);return ot&&(I=function(dt,_t){for(var Nt=[],Ut=new v(0,0),Wt=0;Wt<dt.length;Wt++){for(var jt=dt[Wt],Yt=[],le=0;le<jt.length;le++){var me=jt[le],_e=jt[le+1],Oe=le===0?Ut:me.sub(jt[le-1])._unit()._perp(),Je=le===jt.length-1?Ut:_e.sub(me)._unit()._perp(),qe=Oe._add(Je)._unit();qe._mult(1/(qe.x*Je.x+qe.y*Je.y)),Yt.push(qe._mult(_t)._add(me))}Nt.push(Yt)}return Nt}(I,ot*V)),function(dt,_t,Nt){for(var Ut=0;Ut<_t.length;Ut++){var Wt=_t[Ut];if(dt.length>=3){for(var jt=0;jt<Wt.length;jt++)if(Da(dt,Wt[jt]))return!0}if(Us(dt,Wt,Nt))return!0}return!1}(Q,I,tt)},u.prototype.isTileClipped=function(){return!0},u}(Ni);function g3(a,u){return u>0?u+2*a:a}var rU=Fr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),oU=Fr([{name:"a_projected_pos",components:3,type:"Float32"}],4),sU=(Fr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Fr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),m3=(Fr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Fr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),aU=Fr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function lU(a,u,p){return a.sections.forEach(function(x){x.text=function(B,I,D){var k=I.layout.get("text-transform").evaluate(D,{});return k==="uppercase"?B=B.toLocaleUpperCase():k==="lowercase"&&(B=B.toLocaleLowerCase()),no.applyArabicShaping&&(B=no.applyArabicShaping(B)),B}(x.text,u,p)}),a}Fr([{name:"triangle",components:3,type:"Uint16"}]),Fr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Fr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Fr([{type:"Float32",name:"offsetX"}]),Fr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var vA={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},y3=function(a,u,p,x,B){var I,D,k=8*B-x-1,V=(1<<k)-1,Q=V>>1,tt=-7,ot=B-1,dt=-1,_t=a[u+ot];for(ot+=dt,I=_t&(1<<-tt)-1,_t>>=-tt,tt+=k;tt>0;I=256*I+a[u+ot],ot+=dt,tt-=8);for(D=I&(1<<-tt)-1,I>>=-tt,tt+=x;tt>0;D=256*D+a[u+ot],ot+=dt,tt-=8);if(I===0)I=1-Q;else{if(I===V)return D?NaN:1/0*(_t?-1:1);D+=Math.pow(2,x),I-=Q}return(_t?-1:1)*D*Math.pow(2,I-x)},_3=function(a,u,p,x,B,I){var D,k,V,Q=8*I-B-1,tt=(1<<Q)-1,ot=tt>>1,dt=B===23?Math.pow(2,-24)-Math.pow(2,-77):0,_t=0,Nt=1,Ut=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(k=isNaN(u)?1:0,D=tt):(D=Math.floor(Math.log(u)/Math.LN2),u*(V=Math.pow(2,-D))<1&&(D--,V*=2),(u+=D+ot>=1?dt/V:dt*Math.pow(2,1-ot))*V>=2&&(D++,V/=2),D+ot>=tt?(k=0,D=tt):D+ot>=1?(k=(u*V-1)*Math.pow(2,B),D+=ot):(k=u*Math.pow(2,ot-1)*Math.pow(2,B),D=0));B>=8;a[p+_t]=255&k,_t+=Nt,k/=256,B-=8);for(D=D<<B|k,Q+=B;Q>0;a[p+_t]=255&D,_t+=Nt,D/=256,Q-=8);a[p+_t-Nt]|=128*Ut},ym=Zn;function Zn(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Zn.Varint=0,Zn.Fixed64=1,Zn.Bytes=2,Zn.Fixed32=5;var v3=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Gc(a){return a.type===Zn.Bytes?a.readVarint()+a.pos:a.pos+1}function cU(a,u,p){return p?4294967296*u+(a>>>0):4294967296*(u>>>0)+(a>>>0)}function b3(a,u,p){var x=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));p.realloc(x);for(var B=p.pos-1;B>=a;B--)p.buf[B+x]=p.buf[B]}function uU(a,u){for(var p=0;p<a.length;p++)u.writeVarint(a[p])}function hU(a,u){for(var p=0;p<a.length;p++)u.writeSVarint(a[p])}function fU(a,u){for(var p=0;p<a.length;p++)u.writeFloat(a[p])}function dU(a,u){for(var p=0;p<a.length;p++)u.writeDouble(a[p])}function pU(a,u){for(var p=0;p<a.length;p++)u.writeBoolean(a[p])}function AU(a,u){for(var p=0;p<a.length;p++)u.writeFixed32(a[p])}function gU(a,u){for(var p=0;p<a.length;p++)u.writeSFixed32(a[p])}function mU(a,u){for(var p=0;p<a.length;p++)u.writeFixed64(a[p])}function yU(a,u){for(var p=0;p<a.length;p++)u.writeSFixed64(a[p])}function _m(a,u){return(a[u]|a[u+1]<<8|a[u+2]<<16)+16777216*a[u+3]}function Yf(a,u,p){a[p]=u,a[p+1]=u>>>8,a[p+2]=u>>>16,a[p+3]=u>>>24}function x3(a,u){return(a[u]|a[u+1]<<8|a[u+2]<<16)+(a[u+3]<<24)}function _U(a,u,p){a===1&&p.readMessage(vU,u)}function vU(a,u,p){if(a===3){var x=p.readMessage(bU,{}),B=x.width,I=x.height,D=x.left,k=x.top,V=x.advance;u.push({id:x.id,bitmap:new Uh({width:B+6,height:I+6},x.bitmap),metrics:{width:B,height:I,left:D,top:k,advance:V}})}}function bU(a,u,p){a===1?u.id=p.readVarint():a===2?u.bitmap=p.readBytes():a===3?u.width=p.readVarint():a===4?u.height=p.readVarint():a===5?u.left=p.readSVarint():a===6?u.top=p.readSVarint():a===7&&(u.advance=p.readVarint())}function w3(a){for(var u=0,p=0,x=0,B=a;x<B.length;x+=1){var I=B[x];u+=I.w*I.h,p=Math.max(p,I.w)}a.sort(function(Ut,Wt){return Wt.h-Ut.h});for(var D=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),p),h:1/0}],k=0,V=0,Q=0,tt=a;Q<tt.length;Q+=1)for(var ot=tt[Q],dt=D.length-1;dt>=0;dt--){var _t=D[dt];if(!(ot.w>_t.w||ot.h>_t.h)){if(ot.x=_t.x,ot.y=_t.y,V=Math.max(V,ot.y+ot.h),k=Math.max(k,ot.x+ot.w),ot.w===_t.w&&ot.h===_t.h){var Nt=D.pop();dt<D.length&&(D[dt]=Nt)}else ot.h===_t.h?(_t.x+=ot.w,_t.w-=ot.w):ot.w===_t.w?(_t.y+=ot.h,_t.h-=ot.h):(D.push({x:_t.x+ot.w,y:_t.y,w:_t.w-ot.w,h:ot.h}),_t.y+=ot.h,_t.h-=ot.h);break}}return{w:k,h:V,fill:u/(k*V)||0}}Zn.prototype={destroy:function(){this.buf=null},readFields:function(a,u,p){for(p=p||this.length;this.pos<p;){var x=this.readVarint(),B=x>>3,I=this.pos;this.type=7&x,a(B,u,this),this.pos===I&&this.skip(x)}return u},readMessage:function(a,u){return this.readFields(a,u,this.readVarint()+this.pos)},readFixed32:function(){var a=_m(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=x3(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=_m(this.buf,this.pos)+4294967296*_m(this.buf,this.pos+4);return this.pos+=8,a},readSFixed64:function(){var a=_m(this.buf,this.pos)+4294967296*x3(this.buf,this.pos+4);return this.pos+=8,a},readFloat:function(){var a=y3(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=y3(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var u,p,x=this.buf;return u=127&(p=x[this.pos++]),p<128?u:(u|=(127&(p=x[this.pos++]))<<7,p<128?u:(u|=(127&(p=x[this.pos++]))<<14,p<128?u:(u|=(127&(p=x[this.pos++]))<<21,p<128?u:function(B,I,D){var k,V,Q=D.buf;if(k=(112&(V=Q[D.pos++]))>>4,V<128||(k|=(127&(V=Q[D.pos++]))<<3,V<128)||(k|=(127&(V=Q[D.pos++]))<<10,V<128)||(k|=(127&(V=Q[D.pos++]))<<17,V<128)||(k|=(127&(V=Q[D.pos++]))<<24,V<128)||(k|=(1&(V=Q[D.pos++]))<<31,V<128))return cU(B,k,I);throw new Error("Expected varint not more than 10 bytes")}(u|=(15&(p=x[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,u=this.pos;return this.pos=a,a-u>=12&&v3?function(p,x,B){return v3.decode(p.subarray(x,B))}(this.buf,u,a):function(p,x,B){for(var I="",D=x;D<B;){var k,V,Q,tt=p[D],ot=null,dt=tt>239?4:tt>223?3:tt>191?2:1;if(D+dt>B)break;dt===1?tt<128&&(ot=tt):dt===2?(192&(k=p[D+1]))==128&&(ot=(31&tt)<<6|63&k)<=127&&(ot=null):dt===3?(V=p[D+2],(192&(k=p[D+1]))==128&&(192&V)==128&&((ot=(15&tt)<<12|(63&k)<<6|63&V)<=2047||ot>=55296&&ot<=57343)&&(ot=null)):dt===4&&(V=p[D+2],Q=p[D+3],(192&(k=p[D+1]))==128&&(192&V)==128&&(192&Q)==128&&((ot=(15&tt)<<18|(63&k)<<12|(63&V)<<6|63&Q)<=65535||ot>=1114112)&&(ot=null)),ot===null?(ot=65533,dt=1):ot>65535&&(ot-=65536,I+=String.fromCharCode(ot>>>10&1023|55296),ot=56320|1023&ot),I+=String.fromCharCode(ot),D+=dt}return I}(this.buf,u,a)},readBytes:function(){var a=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,a);return this.pos=a,u},readPackedVarint:function(a,u){if(this.type!==Zn.Bytes)return a.push(this.readVarint(u));var p=Gc(this);for(a=a||[];this.pos<p;)a.push(this.readVarint(u));return a},readPackedSVarint:function(a){if(this.type!==Zn.Bytes)return a.push(this.readSVarint());var u=Gc(this);for(a=a||[];this.pos<u;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Zn.Bytes)return a.push(this.readBoolean());var u=Gc(this);for(a=a||[];this.pos<u;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Zn.Bytes)return a.push(this.readFloat());var u=Gc(this);for(a=a||[];this.pos<u;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Zn.Bytes)return a.push(this.readDouble());var u=Gc(this);for(a=a||[];this.pos<u;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Zn.Bytes)return a.push(this.readFixed32());var u=Gc(this);for(a=a||[];this.pos<u;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Zn.Bytes)return a.push(this.readSFixed32());var u=Gc(this);for(a=a||[];this.pos<u;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Zn.Bytes)return a.push(this.readFixed64());var u=Gc(this);for(a=a||[];this.pos<u;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Zn.Bytes)return a.push(this.readSFixed64());var u=Gc(this);for(a=a||[];this.pos<u;)a.push(this.readSFixed64());return a},skip:function(a){var u=7&a;if(u===Zn.Varint)for(;this.buf[this.pos++]>127;);else if(u===Zn.Bytes)this.pos=this.readVarint()+this.pos;else if(u===Zn.Fixed32)this.pos+=4;else{if(u!==Zn.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(a,u){this.writeVarint(a<<3|u)},realloc:function(a){for(var u=this.length||16;u<this.pos+a;)u*=2;if(u!==this.length){var p=new Uint8Array(u);p.set(this.buf),this.buf=p,this.length=u}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Yf(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Yf(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Yf(this.buf,-1&a,this.pos),Yf(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Yf(this.buf,-1&a,this.pos),Yf(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(u,p){var x,B;if(u>=0?(x=u%4294967296|0,B=u/4294967296|0):(B=~(-u/4294967296),4294967295^(x=~(-u%4294967296))?x=x+1|0:(x=0,B=B+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");p.realloc(10),function(I,D,k){k.buf[k.pos++]=127&I|128,I>>>=7,k.buf[k.pos++]=127&I|128,I>>>=7,k.buf[k.pos++]=127&I|128,I>>>=7,k.buf[k.pos++]=127&I|128,k.buf[k.pos]=127&(I>>>=7)}(x,0,p),function(I,D){var k=(7&I)<<4;D.buf[D.pos++]|=k|((I>>>=3)?128:0),I&&(D.buf[D.pos++]=127&I|((I>>>=7)?128:0),I&&(D.buf[D.pos++]=127&I|((I>>>=7)?128:0),I&&(D.buf[D.pos++]=127&I|((I>>>=7)?128:0),I&&(D.buf[D.pos++]=127&I|((I>>>=7)?128:0),I&&(D.buf[D.pos++]=127&I)))))}(B,p)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var u=this.pos;this.pos=function(x,B,I){for(var D,k,V=0;V<B.length;V++){if((D=B.charCodeAt(V))>55295&&D<57344){if(!k){D>56319||V+1===B.length?(x[I++]=239,x[I++]=191,x[I++]=189):k=D;continue}if(D<56320){x[I++]=239,x[I++]=191,x[I++]=189,k=D;continue}D=k-55296<<10|D-56320|65536,k=null}else k&&(x[I++]=239,x[I++]=191,x[I++]=189,k=null);D<128?x[I++]=D:(D<2048?x[I++]=D>>6|192:(D<65536?x[I++]=D>>12|224:(x[I++]=D>>18|240,x[I++]=D>>12&63|128),x[I++]=D>>6&63|128),x[I++]=63&D|128)}return I}(this.buf,a,this.pos);var p=this.pos-u;p>=128&&b3(u,p,this),this.pos=u-1,this.writeVarint(p),this.pos+=p},writeFloat:function(a){this.realloc(4),_3(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),_3(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var u=a.length;this.writeVarint(u),this.realloc(u);for(var p=0;p<u;p++)this.buf[this.pos++]=a[p]},writeRawMessage:function(a,u){this.pos++;var p=this.pos;a(u,this);var x=this.pos-p;x>=128&&b3(p,x,this),this.pos=p-1,this.writeVarint(x),this.pos+=x},writeMessage:function(a,u,p){this.writeTag(a,Zn.Bytes),this.writeRawMessage(u,p)},writePackedVarint:function(a,u){u.length&&this.writeMessage(a,uU,u)},writePackedSVarint:function(a,u){u.length&&this.writeMessage(a,hU,u)},writePackedBoolean:function(a,u){u.length&&this.writeMessage(a,pU,u)},writePackedFloat:function(a,u){u.length&&this.writeMessage(a,fU,u)},writePackedDouble:function(a,u){u.length&&this.writeMessage(a,dU,u)},writePackedFixed32:function(a,u){u.length&&this.writeMessage(a,AU,u)},writePackedSFixed32:function(a,u){u.length&&this.writeMessage(a,gU,u)},writePackedFixed64:function(a,u){u.length&&this.writeMessage(a,mU,u)},writePackedSFixed64:function(a,u){u.length&&this.writeMessage(a,yU,u)},writeBytesField:function(a,u){this.writeTag(a,Zn.Bytes),this.writeBytes(u)},writeFixed32Field:function(a,u){this.writeTag(a,Zn.Fixed32),this.writeFixed32(u)},writeSFixed32Field:function(a,u){this.writeTag(a,Zn.Fixed32),this.writeSFixed32(u)},writeFixed64Field:function(a,u){this.writeTag(a,Zn.Fixed64),this.writeFixed64(u)},writeSFixed64Field:function(a,u){this.writeTag(a,Zn.Fixed64),this.writeSFixed64(u)},writeVarintField:function(a,u){this.writeTag(a,Zn.Varint),this.writeVarint(u)},writeSVarintField:function(a,u){this.writeTag(a,Zn.Varint),this.writeSVarint(u)},writeStringField:function(a,u){this.writeTag(a,Zn.Bytes),this.writeString(u)},writeFloatField:function(a,u){this.writeTag(a,Zn.Fixed32),this.writeFloat(u)},writeDoubleField:function(a,u){this.writeTag(a,Zn.Fixed64),this.writeDouble(u)},writeBooleanField:function(a,u){this.writeVarintField(a,!!u)}};var vm=function(a,u){var p=u.pixelRatio,x=u.version,B=u.stretchX,I=u.stretchY,D=u.content;this.paddedRect=a,this.pixelRatio=p,this.stretchX=B,this.stretchY=I,this.content=D,this.version=x},bA={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};bA.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},bA.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},bA.tlbr.get=function(){return this.tl.concat(this.br)},bA.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(vm.prototype,bA);var xA=function(a,u){var p={},x={};this.haveRenderCallbacks=[];var B=[];this.addImages(a,p,B),this.addImages(u,x,B);var I=w3(B),D=new ps({width:I.w||1,height:I.h||1});for(var k in a){var V=a[k],Q=p[k].paddedRect;ps.copy(V.data,D,{x:0,y:0},{x:Q.x+1,y:Q.y+1},V.data)}for(var tt in u){var ot=u[tt],dt=x[tt].paddedRect,_t=dt.x+1,Nt=dt.y+1,Ut=ot.data.width,Wt=ot.data.height;ps.copy(ot.data,D,{x:0,y:0},{x:_t,y:Nt},ot.data),ps.copy(ot.data,D,{x:0,y:Wt-1},{x:_t,y:Nt-1},{width:Ut,height:1}),ps.copy(ot.data,D,{x:0,y:0},{x:_t,y:Nt+Wt},{width:Ut,height:1}),ps.copy(ot.data,D,{x:Ut-1,y:0},{x:_t-1,y:Nt},{width:1,height:Wt}),ps.copy(ot.data,D,{x:0,y:0},{x:_t+Ut,y:Nt},{width:1,height:Wt})}this.image=D,this.iconPositions=p,this.patternPositions=x};xA.prototype.addImages=function(a,u,p){for(var x in a){var B=a[x],I={x:0,y:0,w:B.data.width+2,h:B.data.height+2};p.push(I),u[x]=new vm(I,B),B.hasRenderCallback&&this.haveRenderCallbacks.push(x)}},xA.prototype.patchUpdatedImages=function(a,u){for(var p in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[p],a.getImage(p),u),this.patchUpdatedImage(this.patternPositions[p],a.getImage(p),u)},xA.prototype.patchUpdatedImage=function(a,u,p){if(a&&u&&a.version!==u.version){a.version=u.version;var x=a.tl;p.update(u.data,void 0,{x:x[0],y:x[1]})}},ai("ImagePosition",vm),ai("ImageAtlas",xA);var Gs={horizontal:1,vertical:2,horizontalOnly:3},qf=function(){this.scale=1,this.fontStack="",this.imageName=null};qf.forText=function(a,u){var p=new qf;return p.scale=a||1,p.fontStack=u,p},qf.forImage=function(a){var u=new qf;return u.imageName=a,u};var Fo=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function bm(a,u,p,x,B,I,D,k,V,Q,tt,ot,dt,_t,Nt,Ut){var Wt,jt=Fo.fromFeature(a,B);ot===Gs.vertical&&jt.verticalizePunctuation();var Yt=no.processBidirectionalText,le=no.processStyledBidirectionalText;if(Yt&&jt.sections.length===1){Wt=[];for(var me=0,_e=Yt(jt.toString(),Tv(jt,Q,I,u,x,_t,Nt));me<_e.length;me+=1){var Oe=_e[me],Je=new Fo;Je.text=Oe,Je.sections=jt.sections;for(var qe=0;qe<Oe.length;qe++)Je.sectionIndex.push(0);Wt.push(Je)}}else if(le){Wt=[];for(var bi=0,ri=le(jt.text,jt.sectionIndex,Tv(jt,Q,I,u,x,_t,Nt));bi<ri.length;bi+=1){var Ei=ri[bi],oi=new Fo;oi.text=Ei[0],oi.sectionIndex=Ei[1],oi.sections=jt.sections,Wt.push(oi)}}else Wt=function(di,hn){for(var Qi=[],vn=di.text,Bi=0,Cn=0,sr=hn;Cn<sr.length;Cn+=1){var Sr=sr[Cn];Qi.push(di.substring(Bi,Sr)),Bi=Sr}return Bi<vn.length&&Qi.push(di.substring(Bi,vn.length)),Qi}(jt,Tv(jt,Q,I,u,x,_t,Nt));var rn=[],Oi={positionedLines:rn,text:jt.toString(),top:tt[1],bottom:tt[1],left:tt[0],right:tt[0],writingMode:ot,iconsInText:!1,verticalizable:!1};return function(di,hn,Qi,vn,Bi,Cn,sr,Sr,wr,ar,Ir,Yr){for(var qr=0,ko=-17,lo=0,No=0,Rr=Sr==="right"?1:Sr==="left"?0:.5,co=0,An=0,zn=Bi;An<zn.length;An+=1){var Pn=zn[An];Pn.trim();var wn=Pn.getMaxScale(),ts=24*(wn-1),Co={positionedGlyphs:[],lineOffset:0};di.positionedLines[co]=Co;var er=Co.positionedGlyphs,kr=0;if(Pn.length()){for(var Eo=0;Eo<Pn.length();Eo++){var En=Pn.getSection(Eo),Ql=Pn.getSectionIndex(Eo),zs=Pn.getCharCode(Eo),Zl=0,Dr=null,Yl=null,La=null,sd=24,jh=!(wr===Gs.horizontal||!Ir&&!Bu(zs)||Ir&&(xm[zs]||(Hc=zs,$e.Arabic(Hc)||$e["Arabic Supplement"](Hc)||$e["Arabic Extended-A"](Hc)||$e["Arabic Presentation Forms-A"](Hc)||$e["Arabic Presentation Forms-B"](Hc))));if(En.imageName){var ad=vn[En.imageName];if(!ad)continue;La=En.imageName,di.iconsInText=di.iconsInText||!0,Yl=ad.paddedRect;var jc=ad.displaySize;En.scale=24*En.scale/Yr,Zl=ts+(24-jc[1]*En.scale),sd=(Dr={width:jc[0],height:jc[1],left:1,top:-3,advance:jh?jc[1]:jc[0]}).advance;var ld=jh?jc[0]*En.scale-24*wn:jc[1]*En.scale-24*wn;ld>0&&ld>kr&&(kr=ld)}else{var Pm=Qi[En.fontStack],cd=Pm&&Pm[zs];if(cd&&cd.rect)Yl=cd.rect,Dr=cd.metrics;else{var EA=hn[En.fontStack],Rm=EA&&EA[zs];if(!Rm)continue;Dr=Rm.metrics}Zl=24*(wn-En.scale)}jh?(di.verticalizable=!0,er.push({glyph:zs,imageName:La,x:qr,y:ko+Zl,vertical:jh,scale:En.scale,fontStack:En.fontStack,sectionIndex:Ql,metrics:Dr,rect:Yl}),qr+=sd*En.scale+ar):(er.push({glyph:zs,imageName:La,x:qr,y:ko+Zl,vertical:jh,scale:En.scale,fontStack:En.fontStack,sectionIndex:Ql,metrics:Dr,rect:Yl}),qr+=Dr.advance*En.scale+ar)}er.length!==0&&(lo=Math.max(qr-ar,lo),wU(er,0,er.length-1,Rr,kr)),qr=0;var Dm=Cn*wn+kr;Co.lineOffset=Math.max(kr,ts),ko+=Dm,No=Math.max(Dm,No),++co}else ko+=Cn,++co}var Hc,BA=ko- -17,ud=Sv(sr),Fu=ud.horizontalAlign,hd=ud.verticalAlign;(function(Om,Lm,TA,SA,Fm,IA,MA,PA,km){var fd,Nm=(Lm-TA)*Fm;fd=IA!==MA?-PA*SA- -17:(-SA*km+.5)*MA;for(var dd=0,RA=Om;dd<RA.length;dd+=1)for(var Hh=0,DA=RA[dd].positionedGlyphs;Hh<DA.length;Hh+=1){var pd=DA[Hh];pd.x+=Nm,pd.y+=fd}})(di.positionedLines,Rr,Fu,hd,lo,No,Cn,BA,Bi.length),di.top+=-hd*BA,di.bottom=di.top+BA,di.left+=-Fu*lo,di.right=di.left+lo}(Oi,u,p,x,Wt,D,k,V,ot,Q,dt,Ut),!function(di){for(var hn=0,Qi=di;hn<Qi.length;hn+=1)if(Qi[hn].positionedGlyphs.length!==0)return!1;return!0}(rn)&&Oi}Fo.fromFeature=function(a,u){for(var p=new Fo,x=0;x<a.sections.length;x++){var B=a.sections[x];B.image?p.addImageSection(B):p.addTextSection(B,u)}return p},Fo.prototype.length=function(){return this.text.length},Fo.prototype.getSection=function(a){return this.sections[this.sectionIndex[a]]},Fo.prototype.getSectionIndex=function(a){return this.sectionIndex[a]},Fo.prototype.getCharCode=function(a){return this.text.charCodeAt(a)},Fo.prototype.verticalizePunctuation=function(){this.text=function(a){for(var u="",p=0;p<a.length;p++){var x=a.charCodeAt(p+1)||null,B=a.charCodeAt(p-1)||null;u+=x&&Ph(x)&&!vA[a[p+1]]||B&&Ph(B)&&!vA[a[p-1]]||!vA[a[p]]?a[p]:vA[a[p]]}return u}(this.text)},Fo.prototype.trim=function(){for(var a=0,u=0;u<this.text.length&&xm[this.text.charCodeAt(u)];u++)a++;for(var p=this.text.length,x=this.text.length-1;x>=0&&x>=a&&xm[this.text.charCodeAt(x)];x--)p--;this.text=this.text.substring(a,p),this.sectionIndex=this.sectionIndex.slice(a,p)},Fo.prototype.substring=function(a,u){var p=new Fo;return p.text=this.text.substring(a,u),p.sectionIndex=this.sectionIndex.slice(a,u),p.sections=this.sections,p},Fo.prototype.toString=function(){return this.text},Fo.prototype.getMaxScale=function(){var a=this;return this.sectionIndex.reduce(function(u,p){return Math.max(u,a.sections[p].scale)},0)},Fo.prototype.addTextSection=function(a,u){this.text+=a.text,this.sections.push(qf.forText(a.scale,a.fontStack||u));for(var p=this.sections.length-1,x=0;x<a.text.length;++x)this.sectionIndex.push(p)},Fo.prototype.addImageSection=function(a){var u=a.image?a.image.name:"";if(u.length!==0){var p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(qf.forImage(u)),this.sectionIndex.push(this.sections.length-1)):ht("Reached maximum number of images 6401")}else ht("Can't add FormattedSection with an empty image.")},Fo.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var xm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ps={};function C3(a,u,p,x,B,I){if(u.imageName){var D=x[u.imageName];return D?D.displaySize[0]*u.scale*24/I+B:0}var k=p[u.fontStack],V=k&&k[a];return V?V.metrics.advance*u.scale+B:0}function E3(a,u,p,x){var B=Math.pow(a-u,2);return x?a<u?B/2:2*B:B+Math.abs(p)*p}function xU(a,u,p){var x=0;return a===10&&(x-=1e4),p&&(x+=150),a!==40&&a!==65288||(x+=50),u!==41&&u!==65289||(x+=50),x}function B3(a,u,p,x,B,I){for(var D=null,k=E3(u,p,B,I),V=0,Q=x;V<Q.length;V+=1){var tt=Q[V],ot=E3(u-tt.x,p,B,I)+tt.badness;ot<=k&&(D=tt,k=ot)}return{index:a,x:u,priorBreak:D,badness:k}}function Tv(a,u,p,x,B,I,D){if(I!=="point")return[];if(!a)return[];for(var k,V=[],Q=function(Wt,jt,Yt,le,me,_e){for(var Oe=0,Je=0;Je<Wt.length();Je++){var qe=Wt.getSection(Je);Oe+=C3(Wt.getCharCode(Je),qe,le,me,jt,_e)}return Oe/Math.max(1,Math.ceil(Oe/Yt))}(a,u,p,x,B,D),tt=a.text.indexOf("\u200B")>=0,ot=0,dt=0;dt<a.length();dt++){var _t=a.getSection(dt),Nt=a.getCharCode(dt);if(xm[Nt]||(ot+=C3(Nt,_t,x,B,u,D)),dt<a.length()-1){var Ut=!((k=Nt)<11904||!($e["Bopomofo Extended"](k)||$e.Bopomofo(k)||$e["CJK Compatibility Forms"](k)||$e["CJK Compatibility Ideographs"](k)||$e["CJK Compatibility"](k)||$e["CJK Radicals Supplement"](k)||$e["CJK Strokes"](k)||$e["CJK Symbols and Punctuation"](k)||$e["CJK Unified Ideographs Extension A"](k)||$e["CJK Unified Ideographs"](k)||$e["Enclosed CJK Letters and Months"](k)||$e["Halfwidth and Fullwidth Forms"](k)||$e.Hiragana(k)||$e["Ideographic Description Characters"](k)||$e["Kangxi Radicals"](k)||$e["Katakana Phonetic Extensions"](k)||$e.Katakana(k)||$e["Vertical Forms"](k)||$e["Yi Radicals"](k)||$e["Yi Syllables"](k)));(Ps[Nt]||Ut||_t.imageName)&&V.push(B3(dt+1,ot,Q,V,xU(Nt,a.getCharCode(dt+1),Ut&&tt),!1))}}return function Wt(jt){return jt?Wt(jt.priorBreak).concat(jt.index):[]}(B3(a.length(),ot,Q,V,0,!0))}function Sv(a){var u=.5,p=.5;switch(a){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":p=1;break;case"top":case"top-right":case"top-left":p=0}return{horizontalAlign:u,verticalAlign:p}}function wU(a,u,p,x,B){if(x||B)for(var I=a[p],D=(a[p].x+I.metrics.advance*I.scale)*x,k=u;k<=p;k++)a[k].x-=D,a[k].y+=B}function T3(a,u,p,x,B,I){var D,k=a.image;if(k.content){var V=k.content,Q=k.pixelRatio||1;D=[V[0]/Q,V[1]/Q,k.displaySize[0]-V[2]/Q,k.displaySize[1]-V[3]/Q]}var tt,ot,dt,_t,Nt=u.left*I,Ut=u.right*I;p==="width"||p==="both"?(_t=B[0]+Nt-x[3],ot=B[0]+Ut+x[1]):ot=(_t=B[0]+(Nt+Ut-k.displaySize[0])/2)+k.displaySize[0];var Wt=u.top*I,jt=u.bottom*I;return p==="height"||p==="both"?(tt=B[1]+Wt-x[0],dt=B[1]+jt+x[2]):dt=(tt=B[1]+(Wt+jt-k.displaySize[1])/2)+k.displaySize[1],{image:k,top:tt,right:ot,bottom:dt,left:_t,collisionPadding:D}}Ps[10]=!0,Ps[32]=!0,Ps[38]=!0,Ps[40]=!0,Ps[41]=!0,Ps[43]=!0,Ps[45]=!0,Ps[47]=!0,Ps[173]=!0,Ps[183]=!0,Ps[8203]=!0,Ps[8208]=!0,Ps[8211]=!0,Ps[8231]=!0;var $f=function(a){function u(p,x,B,I){a.call(this,p,x),this.angle=B,I!==void 0&&(this.segment=I)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.clone=function(){return new u(this.x,this.y,this.angle,this.segment)},u}(v);function Iv(a,u){var p=u.expression;if(p.kind==="constant")return{kind:"constant",layoutSize:p.evaluate(new Vi(a+1))};if(p.kind==="source")return{kind:"source"};for(var x=p.zoomStops,B=p.interpolationType,I=0;I<x.length&&x[I]<=a;)I++;for(var D=I=Math.max(0,I-1);D<x.length&&x[D]<a+1;)D++;D=Math.min(x.length-1,D);var k=x[I],V=x[D];return p.kind==="composite"?{kind:"composite",minZoom:k,maxZoom:V,interpolationType:B}:{kind:"camera",minZoom:k,maxZoom:V,minSize:p.evaluate(new Vi(k)),maxSize:p.evaluate(new Vi(V)),interpolationType:B}}function S3(a,u,p){var x=u.uSize,B=p.lowerSize;return a.kind==="source"?B/128:a.kind==="composite"?dr(B/128,p.upperSize/128,u.uSizeT):x}function I3(a,u){var p=0,x=0;if(a.kind==="constant")x=a.layoutSize;else if(a.kind!=="source"){var B=a.interpolationType,I=B?W(Ur.interpolationFactor(B,u,a.minZoom,a.maxZoom),0,1):0;a.kind==="camera"?x=dr(a.minSize,a.maxSize,I):p=I}return{uSizeT:p,uSize:x}}ai("Anchor",$f);var CU=Object.freeze({__proto__:null,getSizeData:Iv,evaluateSizeForFeature:S3,evaluateSizeForZoom:I3,SIZE_PACK_FACTOR:128});function M3(a,u,p,x,B){if(u.segment===void 0)return!0;for(var I=u,D=u.segment+1,k=0;k>-p/2;){if(--D<0)return!1;k-=a[D].dist(I),I=a[D]}k+=a[D].dist(a[D+1]),D++;for(var V=[],Q=0;k<p/2;){var tt=a[D],ot=a[D+1];if(!ot)return!1;var dt=a[D-1].angleTo(tt)-tt.angleTo(ot);for(dt=Math.abs((dt+3*Math.PI)%(2*Math.PI)-Math.PI),V.push({distance:k,angleDelta:dt}),Q+=dt;k-V[0].distance>x;)Q-=V.shift().angleDelta;if(Q>B)return!1;D++,k+=tt.dist(ot)}return!0}function P3(a){for(var u=0,p=0;p<a.length-1;p++)u+=a[p].dist(a[p+1]);return u}function R3(a,u,p){return a?.6*u*p:0}function D3(a,u){return Math.max(a?a.right-a.left:0,u?u.right-u.left:0)}function EU(a,u,p,x,B,I){for(var D=R3(p,B,I),k=D3(p,x)*I,V=0,Q=P3(a)/2,tt=0;tt<a.length-1;tt++){var ot=a[tt],dt=a[tt+1],_t=ot.dist(dt);if(V+_t>Q){var Nt=(Q-V)/_t,Ut=dr(ot.x,dt.x,Nt),Wt=dr(ot.y,dt.y,Nt),jt=new $f(Ut,Wt,dt.angleTo(ot),tt);return jt._round(),!D||M3(a,jt,k,D,u)?jt:void 0}V+=_t}}function BU(a,u,p,x,B,I,D,k,V){var Q=R3(x,I,D),tt=D3(x,B),ot=tt*D,dt=a[0].x===0||a[0].x===V||a[0].y===0||a[0].y===V;return u-ot<u/4&&(u=ot+u/4),function _t(Nt,Ut,Wt,jt,Yt,le,me,_e,Oe){for(var Je=le/2,qe=P3(Nt),bi=0,ri=Ut-Wt,Ei=[],oi=0;oi<Nt.length-1;oi++){for(var rn=Nt[oi],Oi=Nt[oi+1],di=rn.dist(Oi),hn=Oi.angleTo(rn);ri+Wt<bi+di;){var Qi=((ri+=Wt)-bi)/di,vn=dr(rn.x,Oi.x,Qi),Bi=dr(rn.y,Oi.y,Qi);if(vn>=0&&vn<Oe&&Bi>=0&&Bi<Oe&&ri-Je>=0&&ri+Je<=qe){var Cn=new $f(vn,Bi,hn,oi);Cn._round(),jt&&!M3(Nt,Cn,le,jt,Yt)||Ei.push(Cn)}}bi+=di}return _e||Ei.length||me||(Ei=_t(Nt,bi/2,Wt,jt,Yt,le,me,!0,Oe)),Ei}(a,dt?u/2*k%u:(tt/2+2*I)*D*k%u,u,Q,p,ot,dt,!1,V)}function O3(a,u,p,x,B){for(var I=[],D=0;D<a.length;D++)for(var k=a[D],V=void 0,Q=0;Q<k.length-1;Q++){var tt=k[Q],ot=k[Q+1];tt.x<u&&ot.x<u||(tt.x<u?tt=new v(u,tt.y+(u-tt.x)/(ot.x-tt.x)*(ot.y-tt.y))._round():ot.x<u&&(ot=new v(u,tt.y+(u-tt.x)/(ot.x-tt.x)*(ot.y-tt.y))._round()),tt.y<p&&ot.y<p||(tt.y<p?tt=new v(tt.x+(p-tt.y)/(ot.y-tt.y)*(ot.x-tt.x),p)._round():ot.y<p&&(ot=new v(tt.x+(p-tt.y)/(ot.y-tt.y)*(ot.x-tt.x),p)._round()),tt.x>=x&&ot.x>=x||(tt.x>=x?tt=new v(x,tt.y+(x-tt.x)/(ot.x-tt.x)*(ot.y-tt.y))._round():ot.x>=x&&(ot=new v(x,tt.y+(x-tt.x)/(ot.x-tt.x)*(ot.y-tt.y))._round()),tt.y>=B&&ot.y>=B||(tt.y>=B?tt=new v(tt.x+(B-tt.y)/(ot.y-tt.y)*(ot.x-tt.x),B)._round():ot.y>=B&&(ot=new v(tt.x+(B-tt.y)/(ot.y-tt.y)*(ot.x-tt.x),B)._round()),V&&tt.equals(V[V.length-1])||I.push(V=[tt]),V.push(ot)))))}return I}function L3(a,u,p,x){var B=[],I=a.image,D=I.pixelRatio,k=I.paddedRect.w-2,V=I.paddedRect.h-2,Q=a.right-a.left,tt=a.bottom-a.top,ot=I.stretchX||[[0,k]],dt=I.stretchY||[[0,V]],_t=function(vn,Bi){return vn+Bi[1]-Bi[0]},Nt=ot.reduce(_t,0),Ut=dt.reduce(_t,0),Wt=k-Nt,jt=V-Ut,Yt=0,le=Nt,me=0,_e=Ut,Oe=0,Je=Wt,qe=0,bi=jt;if(I.content&&x){var ri=I.content;Yt=wm(ot,0,ri[0]),me=wm(dt,0,ri[1]),le=wm(ot,ri[0],ri[2]),_e=wm(dt,ri[1],ri[3]),Oe=ri[0]-Yt,qe=ri[1]-me,Je=ri[2]-ri[0]-le,bi=ri[3]-ri[1]-_e}var Ei=function(vn,Bi,Cn,sr){var Sr=Cm(vn.stretch-Yt,le,Q,a.left),wr=Em(vn.fixed-Oe,Je,vn.stretch,Nt),ar=Cm(Bi.stretch-me,_e,tt,a.top),Ir=Em(Bi.fixed-qe,bi,Bi.stretch,Ut),Yr=Cm(Cn.stretch-Yt,le,Q,a.left),qr=Em(Cn.fixed-Oe,Je,Cn.stretch,Nt),ko=Cm(sr.stretch-me,_e,tt,a.top),lo=Em(sr.fixed-qe,bi,sr.stretch,Ut),No=new v(Sr,ar),Rr=new v(Yr,ar),co=new v(Yr,ko),An=new v(Sr,ko),zn=new v(wr/D,Ir/D),Pn=new v(qr/D,lo/D),wn=u*Math.PI/180;if(wn){var ts=Math.sin(wn),Co=Math.cos(wn),er=[Co,-ts,ts,Co];No._matMult(er),Rr._matMult(er),An._matMult(er),co._matMult(er)}var kr=vn.stretch+vn.fixed,Eo=Bi.stretch+Bi.fixed;return{tl:No,tr:Rr,bl:An,br:co,tex:{x:I.paddedRect.x+1+kr,y:I.paddedRect.y+1+Eo,w:Cn.stretch+Cn.fixed-kr,h:sr.stretch+sr.fixed-Eo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:zn,pixelOffsetBR:Pn,minFontScaleX:Je/D/Q,minFontScaleY:bi/D/tt,isSDF:p}};if(x&&(I.stretchX||I.stretchY))for(var oi=F3(ot,Wt,Nt),rn=F3(dt,jt,Ut),Oi=0;Oi<oi.length-1;Oi++)for(var di=oi[Oi],hn=oi[Oi+1],Qi=0;Qi<rn.length-1;Qi++)B.push(Ei(di,rn[Qi],hn,rn[Qi+1]));else B.push(Ei({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:k+1},{fixed:0,stretch:V+1}));return B}function wm(a,u,p){for(var x=0,B=0,I=a;B<I.length;B+=1){var D=I[B];x+=Math.max(u,Math.min(p,D[1]))-Math.max(u,Math.min(p,D[0]))}return x}function F3(a,u,p){for(var x=[{fixed:-1,stretch:0}],B=0,I=a;B<I.length;B+=1){var D=I[B],k=D[0],V=D[1],Q=x[x.length-1];x.push({fixed:k-Q.stretch,stretch:Q.stretch}),x.push({fixed:k-Q.stretch,stretch:Q.stretch+(V-k)})}return x.push({fixed:u+1,stretch:p}),x}function Cm(a,u,p,x){return a/u*p+x}function Em(a,u,p,x){return a-u*p/x}var Bm=function(a,u,p,x,B,I,D,k,V,Q){if(this.boxStartIndex=a.length,V){var tt=I.top,ot=I.bottom,dt=I.collisionPadding;dt&&(tt-=dt[1],ot+=dt[3]);var _t=ot-tt;_t>0&&(_t=Math.max(10,_t),this.circleDiameter=_t)}else{var Nt=I.top*D-k,Ut=I.bottom*D+k,Wt=I.left*D-k,jt=I.right*D+k,Yt=I.collisionPadding;if(Yt&&(Wt-=Yt[0]*D,Nt-=Yt[1]*D,jt+=Yt[2]*D,Ut+=Yt[3]*D),Q){var le=new v(Wt,Nt),me=new v(jt,Nt),_e=new v(Wt,Ut),Oe=new v(jt,Ut),Je=Q*Math.PI/180;le._rotate(Je),me._rotate(Je),_e._rotate(Je),Oe._rotate(Je),Wt=Math.min(le.x,me.x,_e.x,Oe.x),jt=Math.max(le.x,me.x,_e.x,Oe.x),Nt=Math.min(le.y,me.y,_e.y,Oe.y),Ut=Math.max(le.y,me.y,_e.y,Oe.y)}a.emplaceBack(u.x,u.y,Wt,Nt,jt,Ut,p,x,B)}this.boxEndIndex=a.length},td=function(a,u){if(a===void 0&&(a=[]),u===void 0&&(u=TU),this.data=a,this.length=this.data.length,this.compare=u,this.length>0)for(var p=(this.length>>1)-1;p>=0;p--)this._down(p)};function TU(a,u){return a<u?-1:a>u?1:0}function SU(a,u,p){p===void 0&&(p=!1);for(var x=1/0,B=1/0,I=-1/0,D=-1/0,k=a[0],V=0;V<k.length;V++){var Q=k[V];(!V||Q.x<x)&&(x=Q.x),(!V||Q.y<B)&&(B=Q.y),(!V||Q.x>I)&&(I=Q.x),(!V||Q.y>D)&&(D=Q.y)}var tt=Math.min(I-x,D-B),ot=tt/2,dt=new td([],IU);if(tt===0)return new v(x,B);for(var _t=x;_t<I;_t+=tt)for(var Nt=B;Nt<D;Nt+=tt)dt.push(new ed(_t+ot,Nt+ot,ot,a));for(var Ut=function(Yt){for(var le=0,me=0,_e=0,Oe=Yt[0],Je=0,qe=Oe.length,bi=qe-1;Je<qe;bi=Je++){var ri=Oe[Je],Ei=Oe[bi],oi=ri.x*Ei.y-Ei.x*ri.y;me+=(ri.x+Ei.x)*oi,_e+=(ri.y+Ei.y)*oi,le+=3*oi}return new ed(me/le,_e/le,0,Yt)}(a),Wt=dt.length;dt.length;){var jt=dt.pop();(jt.d>Ut.d||!Ut.d)&&(Ut=jt,p&&console.log("found best %d after %d probes",Math.round(1e4*jt.d)/1e4,Wt)),jt.max-Ut.d<=u||(dt.push(new ed(jt.p.x-(ot=jt.h/2),jt.p.y-ot,ot,a)),dt.push(new ed(jt.p.x+ot,jt.p.y-ot,ot,a)),dt.push(new ed(jt.p.x-ot,jt.p.y+ot,ot,a)),dt.push(new ed(jt.p.x+ot,jt.p.y+ot,ot,a)),Wt+=4)}return p&&(console.log("num probes: "+Wt),console.log("best distance: "+Ut.d)),Ut.p}function IU(a,u){return u.max-a.max}function ed(a,u,p,x){this.p=new v(a,u),this.h=p,this.d=function(B,I){for(var D=!1,k=1/0,V=0;V<I.length;V++)for(var Q=I[V],tt=0,ot=Q.length,dt=ot-1;tt<ot;dt=tt++){var _t=Q[tt],Nt=Q[dt];_t.y>B.y!=Nt.y>B.y&&B.x<(Nt.x-_t.x)*(B.y-_t.y)/(Nt.y-_t.y)+_t.x&&(D=!D),k=Math.min(k,Ru(B,_t,Nt))}return(D?1:-1)*Math.sqrt(k)}(this.p,x),this.max=this.d+this.h*Math.SQRT2}td.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},td.prototype.pop=function(){if(this.length!==0){var a=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),a}},td.prototype.peek=function(){return this.data[0]},td.prototype._up=function(a){for(var u=this.data,p=this.compare,x=u[a];a>0;){var B=a-1>>1,I=u[B];if(p(x,I)>=0)break;u[a]=I,a=B}u[a]=x},td.prototype._down=function(a){for(var u=this.data,p=this.compare,x=this.length>>1,B=u[a];a<x;){var I=1+(a<<1),D=u[I],k=I+1;if(k<this.length&&p(u[k],D)<0&&(I=k,D=u[k]),p(D,B)>=0)break;u[a]=D,a=I}u[a]=B};var Mv=Number.POSITIVE_INFINITY;function k3(a,u){return u[1]!==Mv?function(p,x,B){var I=0,D=0;switch(x=Math.abs(x),B=Math.abs(B),p){case"top-right":case"top-left":case"top":D=B-7;break;case"bottom-right":case"bottom-left":case"bottom":D=7-B}switch(p){case"top-right":case"bottom-right":case"right":I=-x;break;case"top-left":case"bottom-left":case"left":I=x}return[I,D]}(a,u[0],u[1]):function(p,x){var B=0,I=0;x<0&&(x=0);var D=x/Math.sqrt(2);switch(p){case"top-right":case"top-left":I=D-7;break;case"bottom-right":case"bottom-left":I=7-D;break;case"bottom":I=7-x;break;case"top":I=x-7}switch(p){case"top-right":case"bottom-right":B=-D;break;case"top-left":case"bottom-left":B=D;break;case"left":B=x;break;case"right":B=-x}return[B,I]}(a,u[0])}function Pv(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function N3(a,u,p,x,B,I,D,k,V,Q,tt,ot,dt,_t,Nt){var Ut=function(me,_e,Oe,Je,qe,bi,ri,Ei){for(var oi=Je.layout.get("text-rotate").evaluate(bi,{})*Math.PI/180,rn=[],Oi=0,di=_e.positionedLines;Oi<di.length;Oi+=1)for(var hn=di[Oi],Qi=0,vn=hn.positionedGlyphs;Qi<vn.length;Qi+=1){var Bi=vn[Qi];if(Bi.rect){var Cn=Bi.rect||{},sr=4,Sr=!0,wr=1,ar=0,Ir=(qe||Ei)&&Bi.vertical,Yr=Bi.metrics.advance*Bi.scale/2;if(Ei&&_e.verticalizable&&(ar=hn.lineOffset/2-(Bi.imageName?-(24-Bi.metrics.width*Bi.scale)/2:24*(Bi.scale-1))),Bi.imageName){var qr=ri[Bi.imageName];Sr=qr.sdf,sr=1/(wr=qr.pixelRatio)}var ko=qe?[Bi.x+Yr,Bi.y]:[0,0],lo=qe?[0,0]:[Bi.x+Yr+Oe[0],Bi.y+Oe[1]-ar],No=[0,0];Ir&&(No=lo,lo=[0,0]);var Rr=(Bi.metrics.left-sr)*Bi.scale-Yr+lo[0],co=(-Bi.metrics.top-sr)*Bi.scale+lo[1],An=Rr+Cn.w*Bi.scale/wr,zn=co+Cn.h*Bi.scale/wr,Pn=new v(Rr,co),wn=new v(An,co),ts=new v(Rr,zn),Co=new v(An,zn);if(Ir){var er=new v(-Yr,Yr- -17),kr=-Math.PI/2,Eo=12-Yr,En=new v(22-Eo,-(Bi.imageName?Eo:0)),Ql=new(Function.prototype.bind.apply(v,[null].concat(No)));Pn._rotateAround(kr,er)._add(En)._add(Ql),wn._rotateAround(kr,er)._add(En)._add(Ql),ts._rotateAround(kr,er)._add(En)._add(Ql),Co._rotateAround(kr,er)._add(En)._add(Ql)}if(oi){var zs=Math.sin(oi),Zl=Math.cos(oi),Dr=[Zl,-zs,zs,Zl];Pn._matMult(Dr),wn._matMult(Dr),ts._matMult(Dr),Co._matMult(Dr)}var Yl=new v(0,0),La=new v(0,0);rn.push({tl:Pn,tr:wn,bl:ts,br:Co,tex:Cn,writingMode:_e.writingMode,glyphOffset:ko,sectionIndex:Bi.sectionIndex,isSDF:Sr,pixelOffsetTL:Yl,pixelOffsetBR:La,minFontScaleX:0,minFontScaleY:0})}}return rn}(0,p,k,B,I,D,x,a.allowVerticalPlacement),Wt=a.textSizeData,jt=null;Wt.kind==="source"?(jt=[128*B.layout.get("text-size").evaluate(D,{})])[0]>32640&&ht(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Wt.kind==="composite"&&((jt=[128*_t.compositeTextSizes[0].evaluate(D,{},Nt),128*_t.compositeTextSizes[1].evaluate(D,{},Nt)])[0]>32640||jt[1]>32640)&&ht(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),a.addSymbols(a.text,Ut,jt,k,I,D,Q,u,V.lineStartIndex,V.lineLength,dt,Nt);for(var Yt=0,le=tt;Yt<le.length;Yt+=1)ot[le[Yt]]=a.text.placedSymbolArray.length-1;return 4*Ut.length}function U3(a){for(var u in a)return a[u];return null}function MU(a,u,p,x){var B=a.compareText;if(u in B){for(var I=B[u],D=I.length-1;D>=0;D--)if(x.dist(I[D])<p)return!0}else B[u]=[];return B[u].push(x),!1}var PU=Zf.VectorTileFeature.types,RU=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Tm(a,u,p,x,B,I,D,k,V,Q,tt,ot,dt){var _t=k?Math.min(32640,Math.round(k[0])):0,Nt=k?Math.min(32640,Math.round(k[1])):0;a.emplaceBack(u,p,Math.round(32*x),Math.round(32*B),I,D,(_t<<1)+(V?1:0),Nt,16*Q,16*tt,256*ot,256*dt)}function Rv(a,u,p){a.emplaceBack(u.x,u.y,p),a.emplaceBack(u.x,u.y,p),a.emplaceBack(u.x,u.y,p),a.emplaceBack(u.x,u.y,p)}function DU(a){for(var u=0,p=a.sections;u<p.length;u+=1)if(Tu(p[u].text))return!0;return!1}var id=function(a){this.layoutVertexArray=new Ke,this.indexArray=new la,this.programConfigurations=a,this.segments=new $,this.dynamicLayoutVertexArray=new ii,this.opacityVertexArray=new Wl,this.placedSymbolArray=new m};id.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},id.prototype.upload=function(a,u,p,x){this.isEmpty()||(p&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,rU.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,oU.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,RU,!0),this.opacityVertexBuffer.itemSize=1),(p||x)&&this.programConfigurations.upload(a))},id.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},ai("SymbolBuffers",id);var wA=function(a,u,p){this.layoutVertexArray=new a,this.layoutAttributes=u,this.indexArray=new p,this.segments=new $,this.collisionVertexArray=new aa};wA.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,sU.members,!0)},wA.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},ai("CollisionBuffers",wA);var Ln=function(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(I){return I.id}),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ms([]),this.placementViewportMatrix=Ms([]);var u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Iv(this.zoom,u["text-size"]),this.iconSizeData=Iv(this.zoom,u["icon-size"]);var p=this.layers[0].layout,x=p.get("symbol-sort-key"),B=p.get("symbol-z-order");this.canOverlap=p.get("text-allow-overlap")||p.get("icon-allow-overlap")||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=B!=="viewport-y"&&x.constantOr(1)!==void 0,this.sortFeaturesByY=(B==="viewport-y"||B==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(function(I){return Gs[I]})),this.stateDependentLayerIds=this.layers.filter(function(I){return I.isStateDependent()}).map(function(I){return I.id}),this.sourceID=a.sourceID};Ln.prototype.createArrays=function(){this.text=new id(new Di(this.layers,this.zoom,function(a){return/^text/.test(a)})),this.icon=new id(new Di(this.layers,this.zoom,function(a){return/^icon/.test(a)})),this.glyphOffsetArray=new R,this.lineVertexArray=new F,this.symbolInstances=new P},Ln.prototype.calculateGlyphDependencies=function(a,u,p,x,B){for(var I=0;I<a.length;I++)if(u[a.charCodeAt(I)]=!0,(p||x)&&B){var D=vA[a.charAt(I)];D&&(u[D.charCodeAt(0)]=!0)}},Ln.prototype.populate=function(a,u,p){var x=this.layers[0],B=x.layout,I=B.get("text-font"),D=B.get("text-field"),k=B.get("icon-image"),V=(D.value.kind!=="constant"||D.value.value instanceof hr&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&(I.value.kind!=="constant"||I.value.value.length>0),Q=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,tt=B.get("symbol-sort-key");if(this.features=[],V||Q){for(var ot=u.iconDependencies,dt=u.glyphDependencies,_t=u.availableImages,Nt=new Vi(this.zoom),Ut=0,Wt=a;Ut<Wt.length;Ut+=1){var jt=Wt[Ut],Yt=jt.feature,le=jt.id,me=jt.index,_e=jt.sourceLayerIndex,Oe=x._featureFilter.needGeometry,Je=Pr(Yt,Oe);if(x._featureFilter.filter(Nt,Je,p)){Oe||(Je.geometry=xr(Yt));var qe=void 0;if(V){var bi=x.getValueAndResolveTokens("text-field",Je,p,_t),ri=hr.factory(bi);DU(ri)&&(this.hasRTLText=!0),(!this.hasRTLText||Dh()==="unavailable"||this.hasRTLText&&no.isParsed())&&(qe=lU(ri,x,Je))}var Ei=void 0;if(Q){var oi=x.getValueAndResolveTokens("icon-image",Je,p,_t);Ei=oi instanceof Jn?oi:Jn.fromString(oi)}if(qe||Ei){var rn=this.sortFeaturesByKey?tt.evaluate(Je,{},p):void 0;if(this.features.push({id:le,text:qe,icon:Ei,index:me,sourceLayerIndex:_e,geometry:Je.geometry,properties:Yt.properties,type:PU[Yt.type],sortKey:rn}),Ei&&(ot[Ei.name]=!0),qe){var Oi=I.evaluate(Je,{},p).join(","),di=B.get("text-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Gs.vertical)>=0;for(var hn=0,Qi=qe.sections;hn<Qi.length;hn+=1){var vn=Qi[hn];if(vn.image)ot[vn.image.name]=!0;else{var Bi=Mh(qe.toString()),Cn=vn.fontStack||Oi,sr=dt[Cn]=dt[Cn]||{};this.calculateGlyphDependencies(vn.text,sr,di,this.allowVerticalPlacement,Bi)}}}}}}B.get("symbol-placement")==="line"&&(this.features=function(Sr){var wr={},ar={},Ir=[],Yr=0;function qr(er){Ir.push(Sr[er]),Yr++}function ko(er,kr,Eo){var En=ar[er];return delete ar[er],ar[kr]=En,Ir[En].geometry[0].pop(),Ir[En].geometry[0]=Ir[En].geometry[0].concat(Eo[0]),En}function lo(er,kr,Eo){var En=wr[kr];return delete wr[kr],wr[er]=En,Ir[En].geometry[0].shift(),Ir[En].geometry[0]=Eo[0].concat(Ir[En].geometry[0]),En}function No(er,kr,Eo){var En=Eo?kr[0][kr[0].length-1]:kr[0][0];return er+":"+En.x+":"+En.y}for(var Rr=0;Rr<Sr.length;Rr++){var co=Sr[Rr],An=co.geometry,zn=co.text?co.text.toString():null;if(zn){var Pn=No(zn,An),wn=No(zn,An,!0);if(Pn in ar&&wn in wr&&ar[Pn]!==wr[wn]){var ts=lo(Pn,wn,An),Co=ko(Pn,wn,Ir[ts].geometry);delete wr[Pn],delete ar[wn],ar[No(zn,Ir[Co].geometry,!0)]=Co,Ir[ts].geometry=null}else Pn in ar?ko(Pn,wn,An):wn in wr?lo(Pn,wn,An):(qr(Rr),wr[Pn]=Yr-1,ar[wn]=Yr-1)}else qr(Rr)}return Ir.filter(function(er){return er.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Sr,wr){return Sr.sortKey-wr.sortKey})}},Ln.prototype.update=function(a,u,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,u,this.layers,p),this.icon.programConfigurations.updatePaintArrays(a,u,this.layers,p))},Ln.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Ln.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Ln.prototype.upload=function(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Ln.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Ln.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Ln.prototype.addToLineVertexArray=function(a,u){var p=this.lineVertexArray.length;if(a.segment!==void 0){for(var x=a.dist(u[a.segment+1]),B=a.dist(u[a.segment]),I={},D=a.segment+1;D<u.length;D++)I[D]={x:u[D].x,y:u[D].y,tileUnitDistanceFromAnchor:x},D<u.length-1&&(x+=u[D+1].dist(u[D]));for(var k=a.segment||0;k>=0;k--)I[k]={x:u[k].x,y:u[k].y,tileUnitDistanceFromAnchor:B},k>0&&(B+=u[k-1].dist(u[k]));for(var V=0;V<u.length;V++){var Q=I[V];this.lineVertexArray.emplaceBack(Q.x,Q.y,Q.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}},Ln.prototype.addSymbols=function(a,u,p,x,B,I,D,k,V,Q,tt,ot){for(var dt=a.indexArray,_t=a.layoutVertexArray,Nt=a.segments.prepareSegment(4*u.length,_t,dt,this.canOverlap?I.sortKey:void 0),Ut=this.glyphOffsetArray.length,Wt=Nt.vertexLength,jt=this.allowVerticalPlacement&&D===Gs.vertical?Math.PI/2:0,Yt=I.text&&I.text.sections,le=0;le<u.length;le++){var me=u[le],_e=me.tl,Oe=me.tr,Je=me.bl,qe=me.br,bi=me.tex,ri=me.pixelOffsetTL,Ei=me.pixelOffsetBR,oi=me.minFontScaleX,rn=me.minFontScaleY,Oi=me.glyphOffset,di=me.isSDF,hn=me.sectionIndex,Qi=Nt.vertexLength,vn=Oi[1];Tm(_t,k.x,k.y,_e.x,vn+_e.y,bi.x,bi.y,p,di,ri.x,ri.y,oi,rn),Tm(_t,k.x,k.y,Oe.x,vn+Oe.y,bi.x+bi.w,bi.y,p,di,Ei.x,ri.y,oi,rn),Tm(_t,k.x,k.y,Je.x,vn+Je.y,bi.x,bi.y+bi.h,p,di,ri.x,Ei.y,oi,rn),Tm(_t,k.x,k.y,qe.x,vn+qe.y,bi.x+bi.w,bi.y+bi.h,p,di,Ei.x,Ei.y,oi,rn),Rv(a.dynamicLayoutVertexArray,k,jt),dt.emplaceBack(Qi,Qi+1,Qi+2),dt.emplaceBack(Qi+1,Qi+2,Qi+3),Nt.vertexLength+=4,Nt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Oi[0]),le!==u.length-1&&hn===u[le+1].sectionIndex||a.programConfigurations.populatePaintArrays(_t.length,I,I.index,{},ot,Yt&&Yt[hn])}a.placedSymbolArray.emplaceBack(k.x,k.y,Ut,this.glyphOffsetArray.length-Ut,Wt,V,Q,k.segment,p?p[0]:0,p?p[1]:0,x[0],x[1],D,0,!1,0,tt)},Ln.prototype._addCollisionDebugVertex=function(a,u,p,x,B,I){return u.emplaceBack(0,0),a.emplaceBack(p.x,p.y,x,B,Math.round(I.x),Math.round(I.y))},Ln.prototype.addCollisionDebugVertices=function(a,u,p,x,B,I,D){var k=B.segments.prepareSegment(4,B.layoutVertexArray,B.indexArray),V=k.vertexLength,Q=B.layoutVertexArray,tt=B.collisionVertexArray,ot=D.anchorX,dt=D.anchorY;this._addCollisionDebugVertex(Q,tt,I,ot,dt,new v(a,u)),this._addCollisionDebugVertex(Q,tt,I,ot,dt,new v(p,u)),this._addCollisionDebugVertex(Q,tt,I,ot,dt,new v(p,x)),this._addCollisionDebugVertex(Q,tt,I,ot,dt,new v(a,x)),k.vertexLength+=4;var _t=B.indexArray;_t.emplaceBack(V,V+1),_t.emplaceBack(V+1,V+2),_t.emplaceBack(V+2,V+3),_t.emplaceBack(V+3,V),k.primitiveLength+=4},Ln.prototype.addDebugCollisionBoxes=function(a,u,p,x){for(var B=a;B<u;B++){var I=this.collisionBoxArray.get(B);this.addCollisionDebugVertices(I.x1,I.y1,I.x2,I.y2,x?this.textCollisionBox:this.iconCollisionBox,I.anchorPoint,p)}},Ln.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new wA(sa,m3.members,T),this.iconCollisionBox=new wA(sa,m3.members,T);for(var a=0;a<this.symbolInstances.length;a++){var u=this.symbolInstances.get(a);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}},Ln.prototype._deserializeCollisionBoxesForSymbol=function(a,u,p,x,B,I,D,k,V){for(var Q={},tt=u;tt<p;tt++){var ot=a.get(tt);Q.textBox={x1:ot.x1,y1:ot.y1,x2:ot.x2,y2:ot.y2,anchorPointX:ot.anchorPointX,anchorPointY:ot.anchorPointY},Q.textFeatureIndex=ot.featureIndex;break}for(var dt=x;dt<B;dt++){var _t=a.get(dt);Q.verticalTextBox={x1:_t.x1,y1:_t.y1,x2:_t.x2,y2:_t.y2,anchorPointX:_t.anchorPointX,anchorPointY:_t.anchorPointY},Q.verticalTextFeatureIndex=_t.featureIndex;break}for(var Nt=I;Nt<D;Nt++){var Ut=a.get(Nt);Q.iconBox={x1:Ut.x1,y1:Ut.y1,x2:Ut.x2,y2:Ut.y2,anchorPointX:Ut.anchorPointX,anchorPointY:Ut.anchorPointY},Q.iconFeatureIndex=Ut.featureIndex;break}for(var Wt=k;Wt<V;Wt++){var jt=a.get(Wt);Q.verticalIconBox={x1:jt.x1,y1:jt.y1,x2:jt.x2,y2:jt.y2,anchorPointX:jt.anchorPointX,anchorPointY:jt.anchorPointY},Q.verticalIconFeatureIndex=jt.featureIndex;break}return Q},Ln.prototype.deserializeCollisionBoxes=function(a){this.collisionArrays=[];for(var u=0;u<this.symbolInstances.length;u++){var p=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}},Ln.prototype.hasTextData=function(){return this.text.segments.get().length>0},Ln.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Ln.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Ln.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Ln.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Ln.prototype.addIndicesForPlacedSymbol=function(a,u){for(var p=a.placedSymbolArray.get(u),x=p.vertexStartIndex+4*p.numGlyphs,B=p.vertexStartIndex;B<x;B+=4)a.indexArray.emplaceBack(B,B+1,B+2),a.indexArray.emplaceBack(B+1,B+2,B+3)},Ln.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var u=Math.sin(a),p=Math.cos(a),x=[],B=[],I=[],D=0;D<this.symbolInstances.length;++D){I.push(D);var k=this.symbolInstances.get(D);x.push(0|Math.round(u*k.anchorX+p*k.anchorY)),B.push(k.featureIndex)}return I.sort(function(V,Q){return x[V]-x[Q]||B[Q]-B[V]}),I},Ln.prototype.addToSortKeyRanges=function(a,u){var p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===u?p.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:a,symbolInstanceEnd:a+1})},Ln.prototype.sortFeatures=function(a){var u=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var p=0,x=this.symbolInstanceIndexes;p<x.length;p+=1){var B=this.symbolInstances.get(x[p]);this.featureSortOrder.push(B.featureIndex),[B.rightJustifiedTextSymbolIndex,B.centerJustifiedTextSymbolIndex,B.leftJustifiedTextSymbolIndex].forEach(function(I,D,k){I>=0&&k.indexOf(I)===D&&u.addIndicesForPlacedSymbol(u.text,I)}),B.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,B.verticalPlacedTextSymbolIndex),B.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,B.placedIconSymbolIndex),B.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,B.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},ai("SymbolBucket",Ln,{omit:["layers","collisionBoxArray","features","compareText"]}),Ln.MAX_GLYPHS=65535,Ln.addDynamicAttributes=Rv;var OU=new Qn({"symbol-placement":new xi(lt.layout_symbol["symbol-placement"]),"symbol-spacing":new xi(lt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new xi(lt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ui(lt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new xi(lt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new xi(lt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new xi(lt.layout_symbol["icon-ignore-placement"]),"icon-optional":new xi(lt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new xi(lt.layout_symbol["icon-rotation-alignment"]),"icon-size":new ui(lt.layout_symbol["icon-size"]),"icon-text-fit":new xi(lt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new xi(lt.layout_symbol["icon-text-fit-padding"]),"icon-image":new ui(lt.layout_symbol["icon-image"]),"icon-rotate":new ui(lt.layout_symbol["icon-rotate"]),"icon-padding":new xi(lt.layout_symbol["icon-padding"]),"icon-keep-upright":new xi(lt.layout_symbol["icon-keep-upright"]),"icon-offset":new ui(lt.layout_symbol["icon-offset"]),"icon-anchor":new ui(lt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new xi(lt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new xi(lt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new xi(lt.layout_symbol["text-rotation-alignment"]),"text-field":new ui(lt.layout_symbol["text-field"]),"text-font":new ui(lt.layout_symbol["text-font"]),"text-size":new ui(lt.layout_symbol["text-size"]),"text-max-width":new ui(lt.layout_symbol["text-max-width"]),"text-line-height":new xi(lt.layout_symbol["text-line-height"]),"text-letter-spacing":new ui(lt.layout_symbol["text-letter-spacing"]),"text-justify":new ui(lt.layout_symbol["text-justify"]),"text-radial-offset":new ui(lt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new xi(lt.layout_symbol["text-variable-anchor"]),"text-anchor":new ui(lt.layout_symbol["text-anchor"]),"text-max-angle":new xi(lt.layout_symbol["text-max-angle"]),"text-writing-mode":new xi(lt.layout_symbol["text-writing-mode"]),"text-rotate":new ui(lt.layout_symbol["text-rotate"]),"text-padding":new xi(lt.layout_symbol["text-padding"]),"text-keep-upright":new xi(lt.layout_symbol["text-keep-upright"]),"text-transform":new ui(lt.layout_symbol["text-transform"]),"text-offset":new ui(lt.layout_symbol["text-offset"]),"text-allow-overlap":new xi(lt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new xi(lt.layout_symbol["text-ignore-placement"]),"text-optional":new xi(lt.layout_symbol["text-optional"])}),Dv={paint:new Qn({"icon-opacity":new ui(lt.paint_symbol["icon-opacity"]),"icon-color":new ui(lt.paint_symbol["icon-color"]),"icon-halo-color":new ui(lt.paint_symbol["icon-halo-color"]),"icon-halo-width":new ui(lt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ui(lt.paint_symbol["icon-halo-blur"]),"icon-translate":new xi(lt.paint_symbol["icon-translate"]),"icon-translate-anchor":new xi(lt.paint_symbol["icon-translate-anchor"]),"text-opacity":new ui(lt.paint_symbol["text-opacity"]),"text-color":new ui(lt.paint_symbol["text-color"],{runtimeType:He,getOverride:function(a){return a.textColor},hasOverride:function(a){return!!a.textColor}}),"text-halo-color":new ui(lt.paint_symbol["text-halo-color"]),"text-halo-width":new ui(lt.paint_symbol["text-halo-width"]),"text-halo-blur":new ui(lt.paint_symbol["text-halo-blur"]),"text-translate":new xi(lt.paint_symbol["text-translate"]),"text-translate-anchor":new xi(lt.paint_symbol["text-translate-anchor"])}),layout:OU},nd=function(a){this.type=a.property.overrides?a.property.overrides.runtimeType:Fe,this.defaultValue=a};nd.prototype.evaluate=function(a){if(a.formattedSection){var u=this.defaultValue.property.overrides;if(u&&u.hasOverride(a.formattedSection))return u.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default},nd.prototype.eachChild=function(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)},nd.prototype.outputDefined=function(){return!1},nd.prototype.serialize=function(){return null},ai("FormatSectionOverride",nd,{omit:["defaultValue"]});var LU=function(a){function u(p){a.call(this,p,Dv)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.recalculate=function(p,x){if(a.prototype.recalculate.call(this,p,x),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var B=this.layout.get("text-writing-mode");if(B){for(var I=[],D=0,k=B;D<k.length;D+=1){var V=k[D];I.indexOf(V)<0&&I.push(V)}this.layout._values["text-writing-mode"]=I}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},u.prototype.getValueAndResolveTokens=function(p,x,B,I){var D=this.layout.get(p).evaluate(x,{},B,I),k=this._unevaluatedLayout._values[p];return k.isDataDriven()||Bs(k.value)||!D?D:function(V,Q){return Q.replace(/{([^{}]+)}/g,function(tt,ot){return ot in V?String(V[ot]):""})}(x.properties,D)},u.prototype.createBucket=function(p){return new Ln(p)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype._setPaintOverrides=function(){for(var p=0,x=Dv.paint.overridableProperties;p<x.length;p+=1){var B=x[p];if(u.hasPaintOverride(this.layout,B)){var I,D=this.paint.get(B),k=new nd(D),V=new Pa(k,D.property.specification);I=D.value.kind==="constant"||D.value.kind==="source"?new el("source",V):new Fl("composite",V,D.value.zoomStops,D.value._interpolationType),this.paint._values[B]=new ro(D.property,I,D.parameters)}}},u.prototype._handleOverridablePaintPropertyUpdate=function(p,x,B){return!(!this.layout||x.isDataDriven()||B.isDataDriven())&&u.hasPaintOverride(this.layout,p)},u.hasPaintOverride=function(p,x){var B=p.get("text-field"),I=Dv.paint.properties[x],D=!1,k=function(tt){for(var ot=0,dt=tt;ot<dt.length;ot+=1)if(I.overrides&&I.overrides.hasOverride(dt[ot]))return void(D=!0)};if(B.value.kind==="constant"&&B.value.value instanceof hr)k(B.value.value.sections);else if(B.value.kind==="source"){var V=function(tt){D||(tt instanceof Lr&&Xn(tt.value)===ln?k(tt.value.sections):tt instanceof vo?k(tt.sections):tt.eachChild(V))},Q=B.value;Q._styleExpression&&V(Q._styleExpression.expression)}return D},u}(Ni),FU={paint:new Qn({"background-color":new xi(lt.paint_background["background-color"]),"background-pattern":new fo(lt.paint_background["background-pattern"]),"background-opacity":new xi(lt.paint_background["background-opacity"])})},kU=function(a){function u(p){a.call(this,p,FU)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(Ni),NU={paint:new Qn({"raster-opacity":new xi(lt.paint_raster["raster-opacity"]),"raster-hue-rotate":new xi(lt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new xi(lt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new xi(lt.paint_raster["raster-brightness-max"]),"raster-saturation":new xi(lt.paint_raster["raster-saturation"]),"raster-contrast":new xi(lt.paint_raster["raster-contrast"]),"raster-resampling":new xi(lt.paint_raster["raster-resampling"]),"raster-fade-duration":new xi(lt.paint_raster["raster-fade-duration"])})},UU=function(a){function u(p){a.call(this,p,NU)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(Ni),GU=function(a){function u(p){a.call(this,p,{}),this.implementation=p}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},u.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},u.prototype.recalculate=function(){},u.prototype.updateTransitions=function(){},u.prototype.hasTransition=function(){},u.prototype.serialize=function(){},u.prototype.onAdd=function(p){this.implementation.onAdd&&this.implementation.onAdd(p,p.painter.context.gl)},u.prototype.onRemove=function(p){this.implementation.onRemove&&this.implementation.onRemove(p,p.painter.context.gl)},u}(Ni),zU={circle:mv,heatmap:wN,hillshade:EN,fill:VN,"fill-extrusion":YN,line:nU,symbol:LU,background:kU,raster:UU},G3=S.HTMLImageElement,z3=S.HTMLCanvasElement,V3=S.HTMLVideoElement,j3=S.ImageData,Sm=S.ImageBitmap,Gh=function(a,u,p,x){this.context=a,this.format=p,this.texture=a.gl.createTexture(),this.update(u,x)};Gh.prototype.update=function(a,u,p){var x=a.width,B=a.height,I=!(this.size&&this.size[0]===x&&this.size[1]===B||p),D=this.context,k=D.gl;if(this.useMipmap=!!(u&&u.useMipmap),k.bindTexture(k.TEXTURE_2D,this.texture),D.pixelStoreUnpackFlipY.set(!1),D.pixelStoreUnpack.set(1),D.pixelStoreUnpackPremultiplyAlpha.set(this.format===k.RGBA&&(!u||u.premultiply!==!1)),I)this.size=[x,B],a instanceof G3||a instanceof z3||a instanceof V3||a instanceof j3||Sm&&a instanceof Sm?k.texImage2D(k.TEXTURE_2D,0,this.format,this.format,k.UNSIGNED_BYTE,a):k.texImage2D(k.TEXTURE_2D,0,this.format,x,B,0,this.format,k.UNSIGNED_BYTE,a.data);else{var V=p||{x:0,y:0},Q=V.x,tt=V.y;a instanceof G3||a instanceof z3||a instanceof V3||a instanceof j3||Sm&&a instanceof Sm?k.texSubImage2D(k.TEXTURE_2D,0,Q,tt,k.RGBA,k.UNSIGNED_BYTE,a):k.texSubImage2D(k.TEXTURE_2D,0,Q,tt,x,B,k.RGBA,k.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&k.generateMipmap(k.TEXTURE_2D)},Gh.prototype.bind=function(a,u,p){var x=this.context.gl;x.bindTexture(x.TEXTURE_2D,this.texture),p!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=x.LINEAR),a!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,a),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,p||a),this.filter=a),u!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,u),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,u),this.wrap=u)},Gh.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Gh.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Ov=function(a){var u=this;this._callback=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){u._triggered=!1,u._callback()})};Ov.prototype.trigger=function(){var a=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){a._triggered=!1,a._callback()},0))},Ov.prototype.remove=function(){delete this._channel,this._callback=function(){}};var rd=function(a,u,p){this.target=a,this.parent=u,this.mapId=p,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Lt(["receive","process"],this),this.invoker=new Ov(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ct()?a:S};function H3(a,u,p){var x=2*Math.PI*6378137/256/Math.pow(2,p);return[a*x-2*Math.PI*6378137/2,u*x-2*Math.PI*6378137/2]}rd.prototype.send=function(a,u,p,x,B){var I=this;B===void 0&&(B=!1);var D=Math.round(1e18*Math.random()).toString(36).substring(0,10);p&&(this.callbacks[D]=p);var k=te(this.globalScope)?void 0:[];return this.target.postMessage({id:D,type:a,hasCallback:!!p,targetMapId:x,mustQueue:B,sourceMapId:this.mapId,data:ls(u,k)},k),{cancel:function(){p&&delete I.callbacks[D],I.target.postMessage({id:D,type:"<cancel>",targetMapId:x,sourceMapId:I.mapId})}}},rd.prototype.receive=function(a){var u=a.data,p=u.id;if(p&&(!u.targetMapId||this.mapId===u.targetMapId))if(u.type==="<cancel>"){delete this.tasks[p];var x=this.cancelCallbacks[p];delete this.cancelCallbacks[p],x&&x()}else Ct()||u.mustQueue?(this.tasks[p]=u,this.taskQueue.push(p),this.invoker.trigger()):this.processTask(p,u)},rd.prototype.process=function(){if(this.taskQueue.length){var a=this.taskQueue.shift(),u=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),u&&this.processTask(a,u)}},rd.prototype.processTask=function(a,u){var p=this;if(u.type==="<response>"){var x=this.callbacks[a];delete this.callbacks[a],x&&(u.error?x(bo(u.error)):x(null,bo(u.data)))}else{var B=!1,I=te(this.globalScope)?void 0:[],D=u.hasCallback?function(tt,ot){B=!0,delete p.cancelCallbacks[a],p.target.postMessage({id:a,type:"<response>",sourceMapId:p.mapId,error:tt?ls(tt):null,data:ls(ot,I)},I)}:function(tt){B=!0},k=null,V=bo(u.data);if(this.parent[u.type])k=this.parent[u.type](u.sourceMapId,V,D);else if(this.parent.getWorkerSource){var Q=u.type.split(".");k=this.parent.getWorkerSource(u.sourceMapId,Q[0],V.source)[Q[1]](V,D)}else D(new Error("Could not find function "+u.type));!B&&k&&k.cancel&&(this.cancelCallbacks[a]=k.cancel)}},rd.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var zr=function(a,u){a&&(u?this.setSouthWest(a).setNorthEast(u):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))};zr.prototype.setNorthEast=function(a){return this._ne=a instanceof or?new or(a.lng,a.lat):or.convert(a),this},zr.prototype.setSouthWest=function(a){return this._sw=a instanceof or?new or(a.lng,a.lat):or.convert(a),this},zr.prototype.extend=function(a){var u,p,x=this._sw,B=this._ne;if(a instanceof or)u=a,p=a;else{if(!(a instanceof zr))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(zr.convert(a)):this.extend(or.convert(a)):this;if(p=a._ne,!(u=a._sw)||!p)return this}return x||B?(x.lng=Math.min(u.lng,x.lng),x.lat=Math.min(u.lat,x.lat),B.lng=Math.max(p.lng,B.lng),B.lat=Math.max(p.lat,B.lat)):(this._sw=new or(u.lng,u.lat),this._ne=new or(p.lng,p.lat)),this},zr.prototype.getCenter=function(){return new or((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},zr.prototype.getSouthWest=function(){return this._sw},zr.prototype.getNorthEast=function(){return this._ne},zr.prototype.getNorthWest=function(){return new or(this.getWest(),this.getNorth())},zr.prototype.getSouthEast=function(){return new or(this.getEast(),this.getSouth())},zr.prototype.getWest=function(){return this._sw.lng},zr.prototype.getSouth=function(){return this._sw.lat},zr.prototype.getEast=function(){return this._ne.lng},zr.prototype.getNorth=function(){return this._ne.lat},zr.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},zr.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},zr.prototype.isEmpty=function(){return!(this._sw&&this._ne)},zr.prototype.contains=function(a){var u=or.convert(a),p=u.lng,x=u.lat,B=this._sw.lng<=p&&p<=this._ne.lng;return this._sw.lng>this._ne.lng&&(B=this._sw.lng>=p&&p>=this._ne.lng),this._sw.lat<=x&&x<=this._ne.lat&&B},zr.convert=function(a){return!a||a instanceof zr?a:new zr(a)};var or=function(a,u){if(isNaN(a)||isNaN(u))throw new Error("Invalid LngLat object: ("+a+", "+u+")");if(this.lng=+a,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};or.prototype.wrap=function(){return new or(j(this.lng,-180,180),this.lat)},or.prototype.toArray=function(){return[this.lng,this.lat]},or.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},or.prototype.distanceTo=function(a){var u=Math.PI/180,p=this.lat*u,x=a.lat*u,B=Math.sin(p)*Math.sin(x)+Math.cos(p)*Math.cos(x)*Math.cos((a.lng-this.lng)*u);return 63710088e-1*Math.acos(Math.min(B,1))},or.prototype.toBounds=function(a){a===void 0&&(a=0);var u=360*a/40075017,p=u/Math.cos(Math.PI/180*this.lat);return new zr(new or(this.lng-p,this.lat-u),new or(this.lng+p,this.lat+u))},or.convert=function(a){if(a instanceof or)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new or(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new or(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var W3=2*Math.PI*63710088e-1;function J3(a){return W3*Math.cos(a*Math.PI/180)}function X3(a){return(180+a)/360}function K3(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Q3(a,u){return a/J3(u)}function Lv(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var zh=function(a,u,p){p===void 0&&(p=0),this.x=+a,this.y=+u,this.z=+p};zh.fromLngLat=function(a,u){u===void 0&&(u=0);var p=or.convert(a);return new zh(X3(p.lng),K3(p.lat),Q3(u,p.lat))},zh.prototype.toLngLat=function(){return new or(360*this.x-180,Lv(this.y))},zh.prototype.toAltitude=function(){return this.z*J3(Lv(this.y))},zh.prototype.meterInMercatorCoordinateUnits=function(){return 1/W3*(a=Lv(this.y),1/Math.cos(a*Math.PI/180));var a};var Vh=function(a,u,p){this.z=a,this.x=u,this.y=p,this.key=CA(0,a,a,u,p)};Vh.prototype.equals=function(a){return this.z===a.z&&this.x===a.x&&this.y===a.y},Vh.prototype.url=function(a,u){var p,x,B,I,D,k=(x=this.y,B=this.z,I=H3(256*(p=this.x),256*(x=Math.pow(2,B)-x-1),B),D=H3(256*(p+1),256*(x+1),B),I[0]+","+I[1]+","+D[0]+","+D[1]),V=function(Q,tt,ot){for(var dt,_t="",Nt=Q;Nt>0;Nt--)_t+=(tt&(dt=1<<Nt-1)?1:0)+(ot&dt?2:0);return _t}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",V).replace("{bbox-epsg-3857}",k)},Vh.prototype.getTilePoint=function(a){var u=Math.pow(2,this.z);return new v(8192*(a.x*u-this.x),8192*(a.y*u-this.y))},Vh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Z3=function(a,u){this.wrap=a,this.canonical=u,this.key=CA(a,u.z,u.z,u.x,u.y)},Vr=function(a,u,p,x,B){this.overscaledZ=a,this.wrap=u,this.canonical=new Vh(p,+x,+B),this.key=CA(u,a,p,x,B)};function CA(a,u,p,x,B){(a*=2)<0&&(a=-1*a-1);var I=1<<p;return(I*I*a+I*B+x).toString(36)+p.toString(36)+u.toString(36)}Vr.prototype.equals=function(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)},Vr.prototype.scaledTo=function(a){var u=this.canonical.z-a;return a>this.canonical.z?new Vr(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Vr(a,this.wrap,a,this.canonical.x>>u,this.canonical.y>>u)},Vr.prototype.calculateScaledKey=function(a,u){var p=this.canonical.z-a;return a>this.canonical.z?CA(this.wrap*+u,a,this.canonical.z,this.canonical.x,this.canonical.y):CA(this.wrap*+u,a,a,this.canonical.x>>p,this.canonical.y>>p)},Vr.prototype.isChildOf=function(a){if(a.wrap!==this.wrap)return!1;var u=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>u&&a.canonical.y===this.canonical.y>>u},Vr.prototype.children=function(a){if(this.overscaledZ>=a)return[new Vr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var u=this.canonical.z+1,p=2*this.canonical.x,x=2*this.canonical.y;return[new Vr(u,this.wrap,u,p,x),new Vr(u,this.wrap,u,p+1,x),new Vr(u,this.wrap,u,p,x+1),new Vr(u,this.wrap,u,p+1,x+1)]},Vr.prototype.isLessThan=function(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))},Vr.prototype.wrapped=function(){return new Vr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Vr.prototype.unwrapTo=function(a){return new Vr(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)},Vr.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Vr.prototype.toUnwrapped=function(){return new Z3(this.wrap,this.canonical)},Vr.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Vr.prototype.getTilePoint=function(a){return this.canonical.getTilePoint(new zh(a.x-this.wrap,a.y))},ai("CanonicalTileID",Vh),ai("OverscaledTileID",Vr,{omit:["posMatrix"]});var zc=function(a,u,p){if(this.uid=a,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(p&&p!=="mapbox"&&p!=="terrarium")return ht('"'+p+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=u.height;var x=this.dim=u.height-2;this.data=new Uint32Array(u.data.buffer),this.encoding=p||"mapbox";for(var B=0;B<x;B++)this.data[this._idx(-1,B)]=this.data[this._idx(0,B)],this.data[this._idx(x,B)]=this.data[this._idx(x-1,B)],this.data[this._idx(B,-1)]=this.data[this._idx(B,0)],this.data[this._idx(B,x)]=this.data[this._idx(B,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)]};zc.prototype.get=function(a,u){var p=new Uint8Array(this.data.buffer),x=4*this._idx(a,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(p[x],p[x+1],p[x+2])},zc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},zc.prototype._idx=function(a,u){if(a<-1||a>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(a+1)},zc.prototype._unpackMapbox=function(a,u,p){return(256*a*256+256*u+p)/10-1e4},zc.prototype._unpackTerrarium=function(a,u,p){return 256*a+u+p/256-32768},zc.prototype.getPixels=function(){return new ps({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},zc.prototype.backfillBorder=function(a,u,p){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");var x=u*this.dim,B=u*this.dim+this.dim,I=p*this.dim,D=p*this.dim+this.dim;switch(u){case-1:x=B-1;break;case 1:B=x+1}switch(p){case-1:I=D-1;break;case 1:D=I+1}for(var k=-u*this.dim,V=-p*this.dim,Q=I;Q<D;Q++)for(var tt=x;tt<B;tt++)this.data[this._idx(tt,Q)]=a.data[this._idx(tt+k,Q+V)]},ai("DEMData",zc);var Im=function(a){this._stringToNumber={},this._numberToString=[];for(var u=0;u<a.length;u++){var p=a[u];this._stringToNumber[p]=u,this._numberToString[u]=p}};Im.prototype.encode=function(a){return this._stringToNumber[a]},Im.prototype.decode=function(a){return this._numberToString[a]};var Mm=function(a,u,p,x,B){this.type="Feature",this._vectorTileFeature=a,a._z=u,a._x=p,a._y=x,this.properties=a.properties,this.id=B},Fv={geometry:{configurable:!0}};Fv.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Fv.geometry.set=function(a){this._geometry=a},Mm.prototype.toJSON=function(){var a={geometry:this.geometry};for(var u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(a[u]=this[u]);return a},Object.defineProperties(Mm.prototype,Fv);var od=function(){this.state={},this.stateChanges={},this.deletedStates={}};od.prototype.updateState=function(a,u,p){var x=String(u);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][x]=this.stateChanges[a][x]||{},q(this.stateChanges[a][x],p),this.deletedStates[a]===null)for(var B in this.deletedStates[a]={},this.state[a])B!==x&&(this.deletedStates[a][B]=null);else if(this.deletedStates[a]&&this.deletedStates[a][x]===null)for(var I in this.deletedStates[a][x]={},this.state[a][x])p[I]||(this.deletedStates[a][x][I]=null);else for(var D in p)this.deletedStates[a]&&this.deletedStates[a][x]&&this.deletedStates[a][x][D]===null&&delete this.deletedStates[a][x][D]},od.prototype.removeFeatureState=function(a,u,p){if(this.deletedStates[a]!==null){var x=String(u);if(this.deletedStates[a]=this.deletedStates[a]||{},p&&u!==void 0)this.deletedStates[a][x]!==null&&(this.deletedStates[a][x]=this.deletedStates[a][x]||{},this.deletedStates[a][x][p]=null);else if(u!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][x])for(p in this.deletedStates[a][x]={},this.stateChanges[a][x])this.deletedStates[a][x][p]=null;else this.deletedStates[a][x]=null;else this.deletedStates[a]=null}},od.prototype.getState=function(a,u){var p=String(u),x=q({},(this.state[a]||{})[p],(this.stateChanges[a]||{})[p]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){var B=this.deletedStates[a][u];if(B===null)return{};for(var I in B)delete x[I]}return x},od.prototype.initializeTileState=function(a,u){a.setFeatureState(this.state,u)},od.prototype.coalesceChanges=function(a,u){var p={};for(var x in this.stateChanges){this.state[x]=this.state[x]||{};var B={};for(var I in this.stateChanges[x])this.state[x][I]||(this.state[x][I]={}),q(this.state[x][I],this.stateChanges[x][I]),B[I]=this.state[x][I];p[x]=B}for(var D in this.deletedStates){this.state[D]=this.state[D]||{};var k={};if(this.deletedStates[D]===null)for(var V in this.state[D])k[V]={},this.state[D][V]={};else for(var Q in this.deletedStates[D]){if(this.deletedStates[D][Q]===null)this.state[D][Q]={};else for(var tt=0,ot=Object.keys(this.deletedStates[D][Q]);tt<ot.length;tt+=1)delete this.state[D][Q][ot[tt]];k[Q]=this.state[D][Q]}p[D]=p[D]||{},q(p[D],k)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(var dt in a)a[dt].setFeatureState(p,u)};var Vc=function(a,u){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Fs(8192,16,0),this.grid3D=new Fs(8192,16,0),this.featureIndexArray=new J,this.promoteId=u};function Y3(a,u,p,x,B){return At(a,function(I,D){var k=u instanceof Fc?u.get(D):null;return k&&k.evaluate?k.evaluate(p,x,B):k})}function q3(a){for(var u=1/0,p=1/0,x=-1/0,B=-1/0,I=0,D=a;I<D.length;I+=1){var k=D[I];u=Math.min(u,k.x),p=Math.min(p,k.y),x=Math.max(x,k.x),B=Math.max(B,k.y)}return{minX:u,minY:p,maxX:x,maxY:B}}function VU(a,u){return u-a}Vc.prototype.insert=function(a,u,p,x,B,I){var D=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,x,B);for(var k=I?this.grid3D:this.grid,V=0;V<u.length;V++){for(var Q=u[V],tt=[1/0,1/0,-1/0,-1/0],ot=0;ot<Q.length;ot++){var dt=Q[ot];tt[0]=Math.min(tt[0],dt.x),tt[1]=Math.min(tt[1],dt.y),tt[2]=Math.max(tt[2],dt.x),tt[3]=Math.max(tt[3],dt.y)}tt[0]<8192&&tt[1]<8192&&tt[2]>=0&&tt[3]>=0&&k.insert(D,tt[0],tt[1],tt[2],tt[3])}},Vc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Zf.VectorTile(new ym(this.rawTileData)).layers,this.sourceLayerCoder=new Im(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Vc.prototype.query=function(a,u,p,x){var B=this;this.loadVTLayers();for(var I=a.params||{},D=8192/a.tileSize/a.scale,k=bu(I.filter),V=a.queryGeometry,Q=a.queryPadding*D,tt=q3(V),ot=this.grid.query(tt.minX-Q,tt.minY-Q,tt.maxX+Q,tt.maxY+Q),dt=q3(a.cameraQueryGeometry),_t=this.grid3D.query(dt.minX-Q,dt.minY-Q,dt.maxX+Q,dt.maxY+Q,function(me,_e,Oe,Je){return function(qe,bi,ri,Ei,oi){for(var rn=0,Oi=qe;rn<Oi.length;rn+=1){var di=Oi[rn];if(bi<=di.x&&ri<=di.y&&Ei>=di.x&&oi>=di.y)return!0}var hn=[new v(bi,ri),new v(bi,oi),new v(Ei,oi),new v(Ei,ri)];if(qe.length>2){for(var Qi=0,vn=hn;Qi<vn.length;Qi+=1)if(Da(qe,vn[Qi]))return!0}for(var Bi=0;Bi<qe.length-1;Bi++)if(kh(qe[Bi],qe[Bi+1],hn))return!0;return!1}(a.cameraQueryGeometry,me-Q,_e-Q,Oe+Q,Je+Q)}),Nt=0,Ut=_t;Nt<Ut.length;Nt+=1)ot.push(Ut[Nt]);ot.sort(VU);for(var Wt,jt={},Yt=function(me){var _e=ot[me];if(_e!==Wt){Wt=_e;var Oe=B.featureIndexArray.get(_e),Je=null;B.loadMatchingFeature(jt,Oe.bucketIndex,Oe.sourceLayerIndex,Oe.featureIndex,k,I.layers,I.availableImages,u,p,x,function(qe,bi,ri){return Je||(Je=xr(qe)),bi.queryIntersectsFeature(V,qe,ri,Je,B.z,a.transform,D,a.pixelPosMatrix)})}},le=0;le<ot.length;le++)Yt(le);return jt},Vc.prototype.loadMatchingFeature=function(a,u,p,x,B,I,D,k,V,Q,tt){var ot=this.bucketLayerIDs[u];if(!I||function(qe,bi){for(var ri=0;ri<qe.length;ri++)if(bi.indexOf(qe[ri])>=0)return!0;return!1}(I,ot)){var dt=this.sourceLayerCoder.decode(p),_t=this.vtLayers[dt].feature(x);if(B.needGeometry){var Nt=Pr(_t,!0);if(!B.filter(new Vi(this.tileID.overscaledZ),Nt,this.tileID.canonical))return}else if(!B.filter(new Vi(this.tileID.overscaledZ),_t))return;for(var Ut=this.getId(_t,dt),Wt=0;Wt<ot.length;Wt++){var jt=ot[Wt];if(!(I&&I.indexOf(jt)<0)){var Yt=k[jt];if(Yt){var le={};Ut!==void 0&&Q&&(le=Q.getState(Yt.sourceLayer||"_geojsonTileLayer",Ut));var me=q({},V[jt]);me.paint=Y3(me.paint,Yt.paint,_t,le,D),me.layout=Y3(me.layout,Yt.layout,_t,le,D);var _e=!tt||tt(_t,Yt,le);if(_e){var Oe=new Mm(_t,this.z,this.x,this.y,Ut);Oe.layer=me;var Je=a[jt];Je===void 0&&(Je=a[jt]=[]),Je.push({featureIndex:x,feature:Oe,intersectionZ:_e})}}}}}},Vc.prototype.lookupSymbolFeatures=function(a,u,p,x,B,I,D,k){var V={};this.loadVTLayers();for(var Q=bu(B),tt=0,ot=a;tt<ot.length;tt+=1)this.loadMatchingFeature(V,p,x,ot[tt],Q,I,D,k,u);return V},Vc.prototype.hasLayer=function(a){for(var u=0,p=this.bucketLayerIDs;u<p.length;u+=1)for(var x=0,B=p[u];x<B.length;x+=1)if(a===B[x])return!0;return!1},Vc.prototype.getId=function(a,u){var p=a.id;return this.promoteId&&typeof(p=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]])=="boolean"&&(p=Number(p)),p},ai("FeatureIndex",Vc,{omit:["rawTileData","sourceLayerCoder"]});var ao=function(a,u){this.tileID=a,this.uid=K(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ao.prototype.registerFadeDuration=function(a){var u=a+this.timeAdded;u<Ye.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)},ao.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},ao.prototype.loadVectorData=function(a,u,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){for(var x in a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(Q,tt){var ot={};if(!tt)return ot;for(var dt=function(){var Ut=Nt[_t],Wt=Ut.layerIds.map(function(le){return tt.getLayer(le)}).filter(Boolean);if(Wt.length!==0){Ut.layers=Wt,Ut.stateDependentLayerIds&&(Ut.stateDependentLayers=Ut.stateDependentLayerIds.map(function(le){return Wt.filter(function(me){return me.id===le})[0]}));for(var jt=0,Yt=Wt;jt<Yt.length;jt+=1)ot[Yt[jt].id]=Ut}},_t=0,Nt=Q;_t<Nt.length;_t+=1)dt();return ot}(a.buckets,u.style),this.hasSymbolBuckets=!1,this.buckets){var B=this.buckets[x];if(B instanceof Ln){if(this.hasSymbolBuckets=!0,!p)break;B.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var I in this.buckets){var D=this.buckets[I];if(D instanceof Ln&&D.hasRTLText){this.hasRTLText=!0,no.isLoading()||no.isLoaded()||Dh()!=="deferred"||Ts();break}}for(var k in this.queryPadding=0,this.buckets){var V=this.buckets[k];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(k).queryRadius(V))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new d},ao.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ao.prototype.getBucket=function(a){return this.buckets[a.id]},ao.prototype.upload=function(a){for(var u in this.buckets){var p=this.buckets[u];p.uploadPending()&&p.upload(a)}var x=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Gh(a,this.imageAtlas.image,x.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Gh(a,this.glyphAtlasImage,x.ALPHA),this.glyphAtlasImage=null)},ao.prototype.prepare=function(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)},ao.prototype.queryRenderedFeatures=function(a,u,p,x,B,I,D,k,V,Q){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:x,cameraQueryGeometry:B,scale:I,tileSize:this.tileSize,pixelPosMatrix:Q,transform:k,params:D,queryPadding:this.queryPadding*V},a,u,p):{}},ao.prototype.querySourceFeatures=function(a,u){var p=this.latestFeatureIndex;if(p&&p.rawTileData){var x=p.loadVTLayers(),B=u?u.sourceLayer:"",I=x._geojsonTileLayer||x[B];if(I)for(var D=bu(u&&u.filter),k=this.tileID.canonical,V=k.z,Q=k.x,tt=k.y,ot={z:V,x:Q,y:tt},dt=0;dt<I.length;dt++){var _t=I.feature(dt);if(D.needGeometry){var Nt=Pr(_t,!0);if(!D.filter(new Vi(this.tileID.overscaledZ),Nt,this.tileID.canonical))continue}else if(!D.filter(new Vi(this.tileID.overscaledZ),_t))continue;var Ut=p.getId(_t,B),Wt=new Mm(_t,V,Q,tt,Ut);Wt.tile=ot,a.push(Wt)}}},ao.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},ao.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ao.prototype.setExpiryData=function(a){var u=this.expirationTime;if(a.cacheControl){var p=Dt(a.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){var x=Date.now(),B=!1;if(this.expirationTime>x)B=!1;else if(u)if(this.expirationTime<u)B=!0;else{var I=this.expirationTime-u;I?this.expirationTime=x+Math.max(I,3e4):B=!0}else B=!0;B?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ao.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},ao.prototype.setFeatureState=function(a,u){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0){var p=this.latestFeatureIndex.loadVTLayers();for(var x in this.buckets)if(u.style.hasLayer(x)){var B=this.buckets[x],I=B.layers[0].sourceLayer||"_geojsonTileLayer",D=p[I],k=a[I];if(D&&k&&Object.keys(k).length!==0){B.update(k,D,this.imageAtlas&&this.imageAtlas.patternPositions||{});var V=u&&u.style&&u.style.getLayer(x);V&&(this.queryPadding=Math.max(this.queryPadding,V.queryRadius(B)))}}}},ao.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},ao.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ye.now()},ao.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ao.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=Ye.now()+a},ao.prototype.setDependencies=function(a,u){for(var p={},x=0,B=u;x<B.length;x+=1)p[B[x]]=!0;this.dependencies[a]=p},ao.prototype.hasDependency=function(a,u){for(var p=0,x=a;p<x.length;p+=1){var B=this.dependencies[x[p]];if(B){for(var I=0,D=u;I<D.length;I+=1)if(B[D[I]])return!0}}return!1};var Lu=S.performance,$3=function(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},Lu.mark(this._marks.start)};$3.prototype.finish=function(){Lu.mark(this._marks.end);var a=Lu.getEntriesByName(this._marks.measure);return a.length===0&&(Lu.measure(this._marks.measure,this._marks.start,this._marks.end),a=Lu.getEntriesByName(this._marks.measure),Lu.clearMarks(this._marks.start),Lu.clearMarks(this._marks.end),Lu.clearMeasures(this._marks.measure)),a},o.Actor=rd,o.AlphaImage=Uh,o.CanonicalTileID=Vh,o.CollisionBoxArray=d,o.Color=tn,o.DEMData=zc,o.DataConstantProperty=xi,o.DictionaryCoder=Im,o.EXTENT=8192,o.ErrorEvent=pt,o.EvaluationParameters=Vi,o.Event=Ft,o.Evented=bt,o.FeatureIndex=Vc,o.FillBucket=cl,o.FillExtrusionBucket=ul,o.ImageAtlas=xA,o.ImagePosition=vm,o.LineBucket=$o,o.LngLat=or,o.LngLatBounds=zr,o.MercatorCoordinate=zh,o.ONE_EM=24,o.OverscaledTileID=Vr,o.Point=v,o.Point$1=v,o.Properties=Qn,o.Protobuf=ym,o.RGBAImage=ps,o.RequestManager=Ai,o.RequestPerformance=$3,o.ResourceType=Ve,o.SegmentVector=$,o.SourceFeatureState=od,o.StructArrayLayout1ui2=M,o.StructArrayLayout2f1f2i16=Ns,o.StructArrayLayout2i4=Zo,o.StructArrayLayout3ui6=la,o.StructArrayLayout4i8=Oh,o.SymbolBucket=Ln,o.Texture=Gh,o.Tile=ao,o.Transitionable=Xr,o.Uniform1f=Le,o.Uniform1i=Ae,o.Uniform2f=we,o.Uniform3f=Ge,o.Uniform4f=si,o.UniformColor=Ci,o.UniformMatrix4f=xn,o.UnwrappedTileID=Z3,o.ValidationError=Et,o.WritingMode=Gs,o.ZoomHistory=Ih,o.add=function(a,u,p){return a[0]=u[0]+p[0],a[1]=u[1]+p[1],a[2]=u[2]+p[2],a},o.addDynamicAttributes=Rv,o.asyncAll=function(a,u,p){if(!a.length)return p(null,[]);var x=a.length,B=new Array(a.length),I=null;a.forEach(function(D,k){u(D,function(V,Q){V&&(I=V),B[k]=Q,--x==0&&p(I,B)})})},o.bezier=N,o.bindAll=Lt,o.browser=Ye,o.cacheEntryPossiblyAdded=function(a){++De>Ne&&(a.getActor().send("enforceCacheSizeLimit",St),De=0)},o.clamp=W,o.clearTileCache=function(a){var u=S.caches.delete("mapbox-tiles");a&&u.catch(a).then(function(){return a()})},o.clipLine=O3,o.clone=function(a){var u=new Bn(16);return u[0]=a[0],u[1]=a[1],u[2]=a[2],u[3]=a[3],u[4]=a[4],u[5]=a[5],u[6]=a[6],u[7]=a[7],u[8]=a[8],u[9]=a[9],u[10]=a[10],u[11]=a[11],u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15],u},o.clone$1=kt,o.clone$2=function(a){var u=new Bn(3);return u[0]=a[0],u[1]=a[1],u[2]=a[2],u},o.collisionCircleLayout=aU,o.config=ze,o.create=function(){var a=new Bn(16);return Bn!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},o.create$1=function(){var a=new Bn(9);return Bn!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},o.create$2=function(){var a=new Bn(4);return Bn!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},o.createCommonjsModule=l,o.createExpression=_u,o.createLayout=Fr,o.createStyleLayer=function(a){return a.type==="custom"?new GU(a):new zU[a.type](a)},o.cross=function(a,u,p){var x=u[0],B=u[1],I=u[2],D=p[0],k=p[1],V=p[2];return a[0]=B*V-I*k,a[1]=I*D-x*V,a[2]=x*k-B*D,a},o.deepEqual=function a(u,p){if(Array.isArray(u)){if(!Array.isArray(p)||u.length!==p.length)return!1;for(var x=0;x<u.length;x++)if(!a(u[x],p[x]))return!1;return!0}if(typeof u=="object"&&u!==null&&p!==null){if(typeof p!="object"||Object.keys(u).length!==Object.keys(p).length)return!1;for(var B in u)if(!a(u[B],p[B]))return!1;return!0}return u===p},o.dot=function(a,u){return a[0]*u[0]+a[1]*u[1]+a[2]*u[2]},o.dot$1=function(a,u){return a[0]*u[0]+a[1]*u[1]+a[2]*u[2]+a[3]*u[3]},o.ease=G,o.emitValidationErrors=Lc,o.endsWith=Vt,o.enforceCacheSizeLimit=function(a){Xe(),Tn&&Tn.then(function(u){u.keys().then(function(p){for(var x=0;x<p.length-a;x++)u.delete(p[x])})})},o.evaluateSizeForFeature=S3,o.evaluateSizeForZoom=I3,o.evaluateVariableOffset=k3,o.evented=Br,o.extend=q,o.featureFilter=bu,o.filterObject=at,o.fromRotation=function(a,u){var p=Math.sin(u),x=Math.cos(u);return a[0]=x,a[1]=p,a[2]=0,a[3]=-p,a[4]=x,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},o.getAnchorAlignment=Sv,o.getAnchorJustification=Pv,o.getArrayBuffer=Kt,o.getImage=nt,o.getJSON=function(a,u){return wt(q(a,{type:"json"}),u)},o.getRTLTextPluginStatus=Dh,o.getReferrer=H,o.getVideo=function(a,u){var p,x,B=S.document.createElement("video");B.muted=!0,B.onloadstart=function(){u(null,B)};for(var I=0;I<a.length;I++){var D=S.document.createElement("source");p=a[I],x=void 0,(x=S.document.createElement("a")).href=p,(x.protocol!==S.document.location.protocol||x.host!==S.document.location.host)&&(B.crossOrigin="Anonymous"),D.src=a[I],B.appendChild(D)}return{cancel:function(){}}},o.identity=Ms,o.invert=function(a,u){var p=u[0],x=u[1],B=u[2],I=u[3],D=u[4],k=u[5],V=u[6],Q=u[7],tt=u[8],ot=u[9],dt=u[10],_t=u[11],Nt=u[12],Ut=u[13],Wt=u[14],jt=u[15],Yt=p*k-x*D,le=p*V-B*D,me=p*Q-I*D,_e=x*V-B*k,Oe=x*Q-I*k,Je=B*Q-I*V,qe=tt*Ut-ot*Nt,bi=tt*Wt-dt*Nt,ri=tt*jt-_t*Nt,Ei=ot*Wt-dt*Ut,oi=ot*jt-_t*Ut,rn=dt*jt-_t*Wt,Oi=Yt*rn-le*oi+me*Ei+_e*ri-Oe*bi+Je*qe;return Oi?(a[0]=(k*rn-V*oi+Q*Ei)*(Oi=1/Oi),a[1]=(B*oi-x*rn-I*Ei)*Oi,a[2]=(Ut*Je-Wt*Oe+jt*_e)*Oi,a[3]=(dt*Oe-ot*Je-_t*_e)*Oi,a[4]=(V*ri-D*rn-Q*bi)*Oi,a[5]=(p*rn-B*ri+I*bi)*Oi,a[6]=(Wt*me-Nt*Je-jt*le)*Oi,a[7]=(tt*Je-dt*me+_t*le)*Oi,a[8]=(D*oi-k*ri+Q*qe)*Oi,a[9]=(x*ri-p*oi-I*qe)*Oi,a[10]=(Nt*Oe-Ut*me+jt*Yt)*Oi,a[11]=(ot*me-tt*Oe-_t*Yt)*Oi,a[12]=(k*bi-D*Ei-V*qe)*Oi,a[13]=(p*Ei-x*bi+B*qe)*Oi,a[14]=(Ut*le-Nt*_e-Wt*Yt)*Oi,a[15]=(tt*_e-ot*le+dt*Yt)*Oi,a):null},o.isChar=$e,o.isMapboxURL=vi,o.keysDifference=function(a,u){var p=[];for(var x in a)x in u||p.push(x);return p},o.makeRequest=wt,o.mapObject=At,o.mercatorXfromLng=X3,o.mercatorYfromLat=K3,o.mercatorZfromAltitude=Q3,o.mul=gv,o.multiply=qo,o.mvt=Zf,o.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},o.normalize=function(a,u){var p=u[0],x=u[1],B=u[2],I=p*p+x*x+B*B;return I>0&&(I=1/Math.sqrt(I)),a[0]=u[0]*I,a[1]=u[1]*I,a[2]=u[2]*I,a},o.number=dr,o.offscreenCanvasSupported=mt,o.ortho=function(a,u,p,x,B,I,D){var k=1/(u-p),V=1/(x-B),Q=1/(I-D);return a[0]=-2*k,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*V,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*Q,a[11]=0,a[12]=(u+p)*k,a[13]=(B+x)*V,a[14]=(D+I)*Q,a[15]=1,a},o.parseGlyphPBF=function(a){return new ym(a).readFields(_U,[])},o.pbf=ym,o.performSymbolLayout=function(a,u,p,x,B,I,D){a.createArrays(),a.tilePixelRatio=8192/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;var k=a.layers[0].layout,V=a.layers[0]._unevaluatedLayout._values,Q={};if(a.textSizeData.kind==="composite"){var tt=a.textSizeData,ot=tt.maxZoom;Q.compositeTextSizes=[V["text-size"].possiblyEvaluate(new Vi(tt.minZoom),D),V["text-size"].possiblyEvaluate(new Vi(ot),D)]}if(a.iconSizeData.kind==="composite"){var dt=a.iconSizeData,_t=dt.maxZoom;Q.compositeIconSizes=[V["icon-size"].possiblyEvaluate(new Vi(dt.minZoom),D),V["icon-size"].possiblyEvaluate(new Vi(_t),D)]}Q.layoutTextSize=V["text-size"].possiblyEvaluate(new Vi(a.zoom+1),D),Q.layoutIconSize=V["icon-size"].possiblyEvaluate(new Vi(a.zoom+1),D),Q.textMaxSize=V["text-size"].possiblyEvaluate(new Vi(18));for(var Nt=24*k.get("text-line-height"),Ut=k.get("text-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",Wt=k.get("text-keep-upright"),jt=k.get("text-size"),Yt=function(){var _e=me[le],Oe=k.get("text-font").evaluate(_e,{},D).join(","),Je=jt.evaluate(_e,{},D),qe=Q.layoutTextSize.evaluate(_e,{},D),bi=Q.layoutIconSize.evaluate(_e,{},D),ri={horizontal:{},vertical:void 0},Ei=_e.text,oi=[0,0];if(Ei){var rn=Ei.toString(),Oi=24*k.get("text-letter-spacing").evaluate(_e,{},D),di=function(An){for(var zn=0,Pn=An;zn<Pn.length;zn+=1)if(wn=Pn[zn].charCodeAt(0),$e.Arabic(wn)||$e["Arabic Supplement"](wn)||$e["Arabic Extended-A"](wn)||$e["Arabic Presentation Forms-A"](wn)||$e["Arabic Presentation Forms-B"](wn))return!1;var wn;return!0}(rn)?Oi:0,hn=k.get("text-anchor").evaluate(_e,{},D),Qi=k.get("text-variable-anchor");if(!Qi){var vn=k.get("text-radial-offset").evaluate(_e,{},D);oi=vn?k3(hn,[24*vn,Mv]):k.get("text-offset").evaluate(_e,{},D).map(function(An){return 24*An})}var Bi=Ut?"center":k.get("text-justify").evaluate(_e,{},D),Cn=k.get("symbol-placement"),sr=Cn==="point"?24*k.get("text-max-width").evaluate(_e,{},D):0,Sr=function(){a.allowVerticalPlacement&&Mh(rn)&&(ri.vertical=bm(Ei,u,p,B,Oe,sr,Nt,hn,"left",di,oi,Gs.vertical,!0,Cn,qe,Je))};if(!Ut&&Qi){for(var wr=Bi==="auto"?Qi.map(function(An){return Pv(An)}):[Bi],ar=!1,Ir=0;Ir<wr.length;Ir++){var Yr=wr[Ir];if(!ri.horizontal[Yr])if(ar)ri.horizontal[Yr]=ri.horizontal[0];else{var qr=bm(Ei,u,p,B,Oe,sr,Nt,"center",Yr,di,oi,Gs.horizontal,!1,Cn,qe,Je);qr&&(ri.horizontal[Yr]=qr,ar=qr.positionedLines.length===1)}}Sr()}else{Bi==="auto"&&(Bi=Pv(hn));var ko=bm(Ei,u,p,B,Oe,sr,Nt,hn,Bi,di,oi,Gs.horizontal,!1,Cn,qe,Je);ko&&(ri.horizontal[Bi]=ko),Sr(),Mh(rn)&&Ut&&Wt&&(ri.vertical=bm(Ei,u,p,B,Oe,sr,Nt,hn,Bi,di,oi,Gs.vertical,!1,Cn,qe,Je))}}var lo=void 0,No=!1;if(_e.icon&&_e.icon.name){var Rr=x[_e.icon.name];Rr&&(lo=function(An,zn,Pn){var wn=Sv(Pn),ts=zn[0]-An.displaySize[0]*wn.horizontalAlign,Co=zn[1]-An.displaySize[1]*wn.verticalAlign;return{image:An,top:Co,bottom:Co+An.displaySize[1],left:ts,right:ts+An.displaySize[0]}}(B[_e.icon.name],k.get("icon-offset").evaluate(_e,{},D),k.get("icon-anchor").evaluate(_e,{},D)),No=Rr.sdf,a.sdfIcons===void 0?a.sdfIcons=Rr.sdf:a.sdfIcons!==Rr.sdf&&ht("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Rr.pixelRatio!==a.pixelRatio||k.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}var co=U3(ri.horizontal)||ri.vertical;a.iconsInText=!!co&&co.iconsInText,(co||lo)&&function(An,zn,Pn,wn,ts,Co,er,kr,Eo,En,Ql){var zs=Co.textMaxSize.evaluate(zn,{});zs===void 0&&(zs=er);var Zl,Dr=An.layers[0].layout,Yl=Dr.get("icon-offset").evaluate(zn,{},Ql),La=U3(Pn.horizontal),sd=er/24,jh=An.tilePixelRatio*sd,ad=An.tilePixelRatio*zs/24,jc=An.tilePixelRatio*kr,ld=An.tilePixelRatio*Dr.get("symbol-spacing"),Pm=Dr.get("text-padding")*An.tilePixelRatio,cd=Dr.get("icon-padding")*An.tilePixelRatio,EA=Dr.get("text-max-angle")/180*Math.PI,Rm=Dr.get("text-rotation-alignment")==="map"&&Dr.get("symbol-placement")!=="point",Dm=Dr.get("icon-rotation-alignment")==="map"&&Dr.get("symbol-placement")!=="point",Hc=Dr.get("symbol-placement"),BA=ld/2,ud=Dr.get("icon-text-fit");wn&&ud!=="none"&&(An.allowVerticalPlacement&&Pn.vertical&&(Zl=T3(wn,Pn.vertical,ud,Dr.get("icon-text-fit-padding"),Yl,sd)),La&&(wn=T3(wn,La,ud,Dr.get("icon-text-fit-padding"),Yl,sd)));var Fu=function(jU,OA){OA.x<0||OA.x>=8192||OA.y<0||OA.y>=8192||function(Or,hl,HU,ku,Gv,iB,Um,ql,Gm,LA,zm,Vm,zv,nB,FA,rB,oB,sB,aB,lB,Vs,jm,cB,$l,WU){var uB,Wh,Ad,gd,md,yd=Or.addToLineVertexArray(hl,HU),hB=0,fB=0,dB=0,pB=0,Vv=-1,jv=-1,Wc={},AB=yt(""),Hv=0,Wv=0;if(ql._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Hv=(uB=ql.layout.get("text-offset").evaluate(Vs,{},$l).map(function(NA){return 24*NA}))[0],Wv=uB[1]):(Hv=24*ql.layout.get("text-radial-offset").evaluate(Vs,{},$l),Wv=Mv),Or.allowVerticalPlacement&&ku.vertical){var gB=ql.layout.get("text-rotate").evaluate(Vs,{},$l)+90;gd=new Bm(Gm,hl,LA,zm,Vm,ku.vertical,zv,nB,FA,gB),Um&&(md=new Bm(Gm,hl,LA,zm,Vm,Um,oB,sB,FA,gB))}if(Gv){var Jv=ql.layout.get("icon-rotate").evaluate(Vs,{}),mB=ql.layout.get("icon-text-fit")!=="none",yB=L3(Gv,Jv,cB,mB),Xv=Um?L3(Um,Jv,cB,mB):void 0;Ad=new Bm(Gm,hl,LA,zm,Vm,Gv,oB,sB,!1,Jv),hB=4*yB.length;var _B=Or.iconSizeData,kA=null;_B.kind==="source"?(kA=[128*ql.layout.get("icon-size").evaluate(Vs,{})])[0]>32640&&ht(Or.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):_B.kind==="composite"&&((kA=[128*jm.compositeIconSizes[0].evaluate(Vs,{},$l),128*jm.compositeIconSizes[1].evaluate(Vs,{},$l)])[0]>32640||kA[1]>32640)&&ht(Or.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Or.addSymbols(Or.icon,yB,kA,lB,aB,Vs,!1,hl,yd.lineStartIndex,yd.lineLength,-1,$l),Vv=Or.icon.placedSymbolArray.length-1,Xv&&(fB=4*Xv.length,Or.addSymbols(Or.icon,Xv,kA,lB,aB,Vs,Gs.vertical,hl,yd.lineStartIndex,yd.lineLength,-1,$l),jv=Or.icon.placedSymbolArray.length-1)}for(var vB in ku.horizontal){var Hm=ku.horizontal[vB];if(!Wh){AB=yt(Hm.text);var JU=ql.layout.get("text-rotate").evaluate(Vs,{},$l);Wh=new Bm(Gm,hl,LA,zm,Vm,Hm,zv,nB,FA,JU)}var bB=Hm.positionedLines.length===1;if(dB+=N3(Or,hl,Hm,iB,ql,FA,Vs,rB,yd,ku.vertical?Gs.horizontal:Gs.horizontalOnly,bB?Object.keys(ku.horizontal):[vB],Wc,Vv,jm,$l),bB)break}ku.vertical&&(pB+=N3(Or,hl,ku.vertical,iB,ql,FA,Vs,rB,yd,Gs.vertical,["vertical"],Wc,jv,jm,$l));var XU=Wh?Wh.boxStartIndex:Or.collisionBoxArray.length,KU=Wh?Wh.boxEndIndex:Or.collisionBoxArray.length,QU=gd?gd.boxStartIndex:Or.collisionBoxArray.length,ZU=gd?gd.boxEndIndex:Or.collisionBoxArray.length,YU=Ad?Ad.boxStartIndex:Or.collisionBoxArray.length,qU=Ad?Ad.boxEndIndex:Or.collisionBoxArray.length,$U=md?md.boxStartIndex:Or.collisionBoxArray.length,tG=md?md.boxEndIndex:Or.collisionBoxArray.length,tc=-1,Wm=function(NA,wB){return NA&&NA.circleDiameter?Math.max(NA.circleDiameter,wB):wB};tc=Wm(Wh,tc),tc=Wm(gd,tc),tc=Wm(Ad,tc);var xB=(tc=Wm(md,tc))>-1?1:0;xB&&(tc*=WU/24),Or.glyphOffsetArray.length>=Ln.MAX_GLYPHS&&ht("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Vs.sortKey!==void 0&&Or.addToSortKeyRanges(Or.symbolInstances.length,Vs.sortKey),Or.symbolInstances.emplaceBack(hl.x,hl.y,Wc.right>=0?Wc.right:-1,Wc.center>=0?Wc.center:-1,Wc.left>=0?Wc.left:-1,Wc.vertical||-1,Vv,jv,AB,XU,KU,QU,ZU,YU,qU,$U,tG,LA,dB,pB,hB,fB,xB,0,zv,Hv,Wv,tc)}(An,OA,jU,Pn,wn,ts,Zl,An.layers[0],An.collisionBoxArray,zn.index,zn.sourceLayerIndex,An.index,jh,Pm,Rm,Eo,jc,cd,Dm,Yl,zn,Co,En,Ql,er)};if(Hc==="line")for(var hd=0,Om=O3(zn.geometry,0,0,8192,8192);hd<Om.length;hd+=1)for(var Lm=Om[hd],TA=0,SA=BU(Lm,ld,EA,Pn.vertical||La,wn,24,ad,An.overscaling,8192);TA<SA.length;TA+=1){var Fm=SA[TA];La&&MU(An,La.text,BA,Fm)||Fu(Lm,Fm)}else if(Hc==="line-center")for(var IA=0,MA=zn.geometry;IA<MA.length;IA+=1){var PA=MA[IA];if(PA.length>1){var km=EU(PA,EA,Pn.vertical||La,wn,24,ad);km&&Fu(PA,km)}}else if(zn.type==="Polygon")for(var fd=0,Nm=wv(zn.geometry,0);fd<Nm.length;fd+=1){var dd=Nm[fd],RA=SU(dd,16);Fu(dd[0],new $f(RA.x,RA.y,0))}else if(zn.type==="LineString")for(var Hh=0,DA=zn.geometry;Hh<DA.length;Hh+=1){var pd=DA[Hh];Fu(pd,new $f(pd[0].x,pd[0].y,0))}else if(zn.type==="Point")for(var kv=0,tB=zn.geometry;kv<tB.length;kv+=1)for(var Nv=0,eB=tB[kv];Nv<eB.length;Nv+=1){var Uv=eB[Nv];Fu([Uv],new $f(Uv.x,Uv.y,0))}}(a,_e,ri,lo,x,Q,qe,bi,oi,No,D)},le=0,me=a.features;le<me.length;le+=1)Yt();I&&a.generateCollisionDebugBuffers()},o.perspective=function(a,u,p,x,B){var I,D=1/Math.tan(u/2);return a[0]=D/p,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=D,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,B!=null&&B!==1/0?(a[10]=(B+x)*(I=1/(x-B)),a[14]=2*B*x*I):(a[10]=-1,a[14]=-2*x),a},o.pick=function(a,u){for(var p={},x=0;x<u.length;x++){var B=u[x];B in a&&(p[B]=a[B])}return p},o.plugin=no,o.polygonIntersectsPolygon=Jl,o.postMapLoadEvent=_r,o.postTurnstileEvent=Mi,o.potpack=w3,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.register=ai,o.registerForPluginStateChange=function(a){return a({pluginStatus:Oo,pluginURL:ra}),Br.on("pluginStateChange",a),a},o.renderColorRamp=r3,o.rotate=function(a,u,p){var x=u[0],B=u[1],I=u[2],D=u[3],k=Math.sin(p),V=Math.cos(p);return a[0]=x*V+I*k,a[1]=B*V+D*k,a[2]=x*-k+I*V,a[3]=B*-k+D*V,a},o.rotateX=function(a,u,p){var x=Math.sin(p),B=Math.cos(p),I=u[4],D=u[5],k=u[6],V=u[7],Q=u[8],tt=u[9],ot=u[10],dt=u[11];return u!==a&&(a[0]=u[0],a[1]=u[1],a[2]=u[2],a[3]=u[3],a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15]),a[4]=I*B+Q*x,a[5]=D*B+tt*x,a[6]=k*B+ot*x,a[7]=V*B+dt*x,a[8]=Q*B-I*x,a[9]=tt*B-D*x,a[10]=ot*B-k*x,a[11]=dt*B-V*x,a},o.rotateZ=function(a,u,p){var x=Math.sin(p),B=Math.cos(p),I=u[0],D=u[1],k=u[2],V=u[3],Q=u[4],tt=u[5],ot=u[6],dt=u[7];return u!==a&&(a[8]=u[8],a[9]=u[9],a[10]=u[10],a[11]=u[11],a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15]),a[0]=I*B+Q*x,a[1]=D*B+tt*x,a[2]=k*B+ot*x,a[3]=V*B+dt*x,a[4]=Q*B-I*x,a[5]=tt*B-D*x,a[6]=ot*B-k*x,a[7]=dt*B-V*x,a},o.scale=function(a,u,p){var x=p[0],B=p[1],I=p[2];return a[0]=u[0]*x,a[1]=u[1]*x,a[2]=u[2]*x,a[3]=u[3]*x,a[4]=u[4]*B,a[5]=u[5]*B,a[6]=u[6]*B,a[7]=u[7]*B,a[8]=u[8]*I,a[9]=u[9]*I,a[10]=u[10]*I,a[11]=u[11]*I,a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15],a},o.scale$1=function(a,u,p){return a[0]=u[0]*p,a[1]=u[1]*p,a[2]=u[2]*p,a[3]=u[3]*p,a},o.scale$2=function(a,u,p){return a[0]=u[0]*p,a[1]=u[1]*p,a[2]=u[2]*p,a},o.setCacheLimits=function(a,u){St=a,Ne=u},o.setRTLTextPlugin=function(a,u,p){if(p===void 0&&(p=!1),Oo==="deferred"||Oo==="loading"||Oo==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");ra=Ye.resolveURL(a),Oo="deferred",Su=u,Hl(),p||Ts()},o.sphericalToCartesian=function(a){var u=a[0],p=a[1],x=a[2];return p+=90,p*=Math.PI/180,x*=Math.PI/180,{x:u*Math.cos(p)*Math.sin(x),y:u*Math.sin(p)*Math.sin(x),z:u*Math.cos(x)}},o.sqrLen=function(a){var u=a[0],p=a[1];return u*u+p*p},o.styleSpec=lt,o.sub=function(a,u,p){return a[0]=u[0]-p[0],a[1]=u[1]-p[1],a[2]=u[2]-p[2],a},o.symbolSize=CU,o.transformMat3=function(a,u,p){var x=u[0],B=u[1],I=u[2];return a[0]=x*p[0]+B*p[3]+I*p[6],a[1]=x*p[1]+B*p[4]+I*p[7],a[2]=x*p[2]+B*p[5]+I*p[8],a},o.transformMat4=Jf,o.translate=function(a,u,p){var x,B,I,D,k,V,Q,tt,ot,dt,_t,Nt,Ut=p[0],Wt=p[1],jt=p[2];return u===a?(a[12]=u[0]*Ut+u[4]*Wt+u[8]*jt+u[12],a[13]=u[1]*Ut+u[5]*Wt+u[9]*jt+u[13],a[14]=u[2]*Ut+u[6]*Wt+u[10]*jt+u[14],a[15]=u[3]*Ut+u[7]*Wt+u[11]*jt+u[15]):(B=u[1],I=u[2],D=u[3],k=u[4],V=u[5],Q=u[6],tt=u[7],ot=u[8],dt=u[9],_t=u[10],Nt=u[11],a[0]=x=u[0],a[1]=B,a[2]=I,a[3]=D,a[4]=k,a[5]=V,a[6]=Q,a[7]=tt,a[8]=ot,a[9]=dt,a[10]=_t,a[11]=Nt,a[12]=x*Ut+k*Wt+ot*jt+u[12],a[13]=B*Ut+V*Wt+dt*jt+u[13],a[14]=I*Ut+Q*Wt+_t*jt+u[14],a[15]=D*Ut+tt*Wt+Nt*jt+u[15]),a},o.triggerPluginCompletionEvent=Rh,o.uniqueId=K,o.validateCustomStyleLayer=function(a){var u=[],p=a.id;return p===void 0&&u.push({message:"layers."+p+': missing required property "id"'}),a.render===void 0&&u.push({message:"layers."+p+': missing required method "render"'}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&u.push({message:"layers."+p+': property "renderingMode" must be either "2d" or "3d"'}),u},o.validateLight=fA,o.validateStyle=Oc,o.values=function(a){var u=[];for(var p in a)u.push(a[p]);return u},o.vectorTile=Zf,o.version="1.13.3",o.warnOnce=ht,o.webpSupported=pi,o.window=S,o.wrap=j}),s(["./shared"],function(o){function l(Y){var nt=typeof Y;if(nt==="number"||nt==="boolean"||nt==="string"||Y==null)return JSON.stringify(Y);if(Array.isArray(Y)){for(var ct="[",vt=0,Ft=Y;vt<Ft.length;vt+=1)ct+=l(Ft[vt])+",";return ct+"]"}for(var pt=Object.keys(Y).sort(),bt="{",lt=0;lt<pt.length;lt++)bt+=JSON.stringify(pt[lt])+":"+l(Y[pt[lt]])+",";return bt+"}"}function h(Y){for(var nt="",ct=0,vt=o.refProperties;ct<vt.length;ct+=1)nt+="/"+l(Y[vt[ct]]);return nt}var A=function(Y){this.keyCache={},Y&&this.replace(Y)};A.prototype.replace=function(Y){this._layerConfigs={},this._layers={},this.update(Y,[])},A.prototype.update=function(Y,nt){for(var ct=this,vt=0,Ft=Y;vt<Ft.length;vt+=1){var pt=Ft[vt];this._layerConfigs[pt.id]=pt;var bt=this._layers[pt.id]=o.createStyleLayer(pt);bt._featureFilter=o.featureFilter(bt.filter),this.keyCache[pt.id]&&delete this.keyCache[pt.id]}for(var lt=0,Et=nt;lt<Et.length;lt+=1){var g=Et[lt];delete this.keyCache[g],delete this._layerConfigs[g],delete this._layers[g]}this.familiesBySource={};for(var ut=0,Ee=function(Me,He){for(var ki={},ei=0;ei<Me.length;ei++){var $i=He&&He[Me[ei].id]||h(Me[ei]);He&&(He[Me[ei].id]=$i);var ln=ki[$i];ln||(ln=ki[$i]=[]),ln.push(Me[ei])}var Wi=[];for(var Ji in ki)Wi.push(ki[Ji]);return Wi}(o.values(this._layerConfigs),this.keyCache);ut<Ee.length;ut+=1){var Zt=Ee[ut].map(function(Me){return ct._layers[Me.id]}),Be=Zt[0];if(Be.visibility!=="none"){var Re=Be.source||"",Fe=this.familiesBySource[Re];Fe||(Fe=this.familiesBySource[Re]={});var fe=Be.sourceLayer||"_geojsonTileLayer",ke=Fe[fe];ke||(ke=Fe[fe]=[]),ke.push(Zt)}}};var v=function(Y){var nt={},ct=[];for(var vt in Y){var Ft=Y[vt],pt=nt[vt]={};for(var bt in Ft){var lt=Ft[+bt];if(lt&&lt.bitmap.width!==0&&lt.bitmap.height!==0){var Et={x:0,y:0,w:lt.bitmap.width+2,h:lt.bitmap.height+2};ct.push(Et),pt[bt]={rect:Et,metrics:lt.metrics}}}}var g=o.potpack(ct),ut=new o.AlphaImage({width:g.w||1,height:g.h||1});for(var Ee in Y){var Zt=Y[Ee];for(var Be in Zt){var Re=Zt[+Be];if(Re&&Re.bitmap.width!==0&&Re.bitmap.height!==0){var Fe=nt[Ee][Be].rect;o.AlphaImage.copy(Re.bitmap,ut,{x:0,y:0},{x:Fe.x+1,y:Fe.y+1},Re.bitmap)}}}this.image=ut,this.positions=nt};o.register("GlyphAtlas",v);var C=function(Y){this.tileID=new o.OverscaledTileID(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.uid=Y.uid,this.zoom=Y.zoom,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.collectResourceTiming,this.returnDependencies=!!Y.returnDependencies,this.promoteId=Y.promoteId};function S(Y,nt,ct){for(var vt=new o.EvaluationParameters(nt),Ft=0,pt=Y;Ft<pt.length;Ft+=1)pt[Ft].recalculate(vt,ct)}function L(Y,nt){var ct=o.getArrayBuffer(Y.request,function(vt,Ft,pt,bt){vt?nt(vt):Ft&&nt(null,{vectorTile:new o.vectorTile.VectorTile(new o.pbf(Ft)),rawData:Ft,cacheControl:pt,expires:bt})});return function(){ct.cancel(),nt()}}C.prototype.parse=function(Y,nt,ct,vt,Ft){var pt=this;this.status="parsing",this.data=Y,this.collisionBoxArray=new o.CollisionBoxArray;var bt=new o.DictionaryCoder(Object.keys(Y.layers).sort()),lt=new o.FeatureIndex(this.tileID,this.promoteId);lt.bucketLayerIDs=[];var Et,g,ut,Ee,Zt={},Be={featureIndex:lt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ct},Re=nt.familiesBySource[this.source];for(var Fe in Re){var fe=Y.layers[Fe];if(fe){fe.version===1&&o.warnOnce('Vector tile source "'+this.source+'" layer "'+Fe+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var ke=bt.encode(Fe),Me=[],He=0;He<fe.length;He++){var ki=fe.feature(He),ei=lt.getId(ki,Fe);Me.push({feature:ki,id:ei,index:He,sourceLayerIndex:ke})}for(var $i=0,ln=Re[Fe];$i<ln.length;$i+=1){var Wi=ln[$i],Ji=Wi[0];Ji.minzoom&&this.zoom<Math.floor(Ji.minzoom)||Ji.maxzoom&&this.zoom>=Ji.maxzoom||Ji.visibility!=="none"&&(S(Wi,this.zoom,ct),(Zt[Ji.id]=Ji.createBucket({index:lt.bucketLayerIDs.length,layers:Wi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ke,sourceID:this.source})).populate(Me,Be,this.tileID.canonical),lt.bucketLayerIDs.push(Wi.map(function(Bt){return Bt.id})))}}}var Gi=o.mapObject(Be.glyphDependencies,function(Bt){return Object.keys(Bt).map(Number)});Object.keys(Gi).length?vt.send("getGlyphs",{uid:this.uid,stacks:Gi},function(Bt,Qe){Et||(Et=Bt,g=Qe,yi.call(pt))}):g={};var vr=Object.keys(Be.iconDependencies);vr.length?vt.send("getImages",{icons:vr,source:this.source,tileID:this.tileID,type:"icons"},function(Bt,Qe){Et||(Et=Bt,ut=Qe,yi.call(pt))}):ut={};var Xi=Object.keys(Be.patternDependencies);function yi(){if(Et)return Ft(Et);if(g&&ut&&Ee){var Bt=new v(g),Qe=new o.ImageAtlas(ut,Ee);for(var tn in Zt){var Wr=Zt[tn];Wr instanceof o.SymbolBucket?(S(Wr.layers,this.zoom,ct),o.performSymbolLayout(Wr,g,Bt.positions,ut,Qe.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Wr.hasPattern&&(Wr instanceof o.LineBucket||Wr instanceof o.FillBucket||Wr instanceof o.FillExtrusionBucket)&&(S(Wr.layers,this.zoom,ct),Wr.addFeatures(Be,this.tileID.canonical,Qe.patternPositions))}this.status="done",Ft(null,{buckets:o.values(Zt).filter(function(xa){return!xa.isEmpty()}),featureIndex:lt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Bt.image,imageAtlas:Qe,glyphMap:this.returnDependencies?g:null,iconMap:this.returnDependencies?ut:null,glyphPositions:this.returnDependencies?Bt.positions:null})}}Xi.length?vt.send("getImages",{icons:Xi,source:this.source,tileID:this.tileID,type:"patterns"},function(Bt,Qe){Et||(Et=Bt,Ee=Qe,yi.call(pt))}):Ee={},yi.call(this)};var N=function(Y,nt,ct,vt){this.actor=Y,this.layerIndex=nt,this.availableImages=ct,this.loadVectorData=vt||L,this.loading={},this.loaded={}};N.prototype.loadTile=function(Y,nt){var ct=this,vt=Y.uid;this.loading||(this.loading={});var Ft=!!(Y&&Y.request&&Y.request.collectResourceTiming)&&new o.RequestPerformance(Y.request),pt=this.loading[vt]=new C(Y);pt.abort=this.loadVectorData(Y,function(bt,lt){if(delete ct.loading[vt],bt||!lt)return pt.status="done",ct.loaded[vt]=pt,nt(bt);var Et=lt.rawData,g={};lt.expires&&(g.expires=lt.expires),lt.cacheControl&&(g.cacheControl=lt.cacheControl);var ut={};if(Ft){var Ee=Ft.finish();Ee&&(ut.resourceTiming=JSON.parse(JSON.stringify(Ee)))}pt.vectorTile=lt.vectorTile,pt.parse(lt.vectorTile,ct.layerIndex,ct.availableImages,ct.actor,function(Zt,Be){if(Zt||!Be)return nt(Zt);nt(null,o.extend({rawTileData:Et.slice(0)},Be,g,ut))}),ct.loaded=ct.loaded||{},ct.loaded[vt]=pt})},N.prototype.reloadTile=function(Y,nt){var ct=this,vt=this.loaded,Ft=Y.uid,pt=this;if(vt&&vt[Ft]){var bt=vt[Ft];bt.showCollisionBoxes=Y.showCollisionBoxes;var lt=function(Et,g){var ut=bt.reloadCallback;ut&&(delete bt.reloadCallback,bt.parse(bt.vectorTile,pt.layerIndex,ct.availableImages,pt.actor,ut)),nt(Et,g)};bt.status==="parsing"?bt.reloadCallback=lt:bt.status==="done"&&(bt.vectorTile?bt.parse(bt.vectorTile,this.layerIndex,this.availableImages,this.actor,lt):lt())}},N.prototype.abortTile=function(Y,nt){var ct=this.loading,vt=Y.uid;ct&&ct[vt]&&ct[vt].abort&&(ct[vt].abort(),delete ct[vt]),nt()},N.prototype.removeTile=function(Y,nt){var ct=this.loaded,vt=Y.uid;ct&&ct[vt]&&delete ct[vt],nt()};var G=o.window.ImageBitmap,W=function(){this.loaded={}};function j(Y,nt){if(Y.length!==0){q(Y[0],nt);for(var ct=1;ct<Y.length;ct++)q(Y[ct],!1)}}function q(Y,nt){for(var ct=0,vt=0,Ft=0,pt=Y.length,bt=pt-1;Ft<pt;bt=Ft++){var lt=(Y[Ft][0]-Y[bt][0])*(Y[bt][1]+Y[Ft][1]),Et=ct+lt;vt+=Math.abs(ct)>=Math.abs(lt)?ct-Et+lt:lt-Et+ct,ct=Et}ct+vt>=0!=!!nt&&Y.reverse()}W.prototype.loadTile=function(Y,nt){var ct=Y.uid,vt=Y.encoding,Ft=Y.rawImageData,pt=G&&Ft instanceof G?this.getImageData(Ft):Ft,bt=new o.DEMData(ct,pt,vt);this.loaded=this.loaded||{},this.loaded[ct]=bt,nt(null,bt)},W.prototype.getImageData=function(Y){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);var nt=this.offscreenCanvasContext.getImageData(-1,-1,Y.width+2,Y.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:nt.width,height:nt.height},nt.data)},W.prototype.removeTile=function(Y){var nt=this.loaded,ct=Y.uid;nt&&nt[ct]&&delete nt[ct]};var Z=o.vectorTile.VectorTileFeature.prototype.toGeoJSON,K=function(Y){this._feature=Y,this.extent=o.EXTENT,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))};K.prototype.loadGeometry=function(){if(this._feature.type===1){for(var Y=[],nt=0,ct=this._feature.geometry;nt<ct.length;nt+=1){var vt=ct[nt];Y.push([new o.Point$1(vt[0],vt[1])])}return Y}for(var Ft=[],pt=0,bt=this._feature.geometry;pt<bt.length;pt+=1){for(var lt=[],Et=0,g=bt[pt];Et<g.length;Et+=1){var ut=g[Et];lt.push(new o.Point$1(ut[0],ut[1]))}Ft.push(lt)}return Ft},K.prototype.toGeoJSON=function(Y,nt,ct){return Z.call(this,Y,nt,ct)};var ft=function(Y){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=Y.length,this._features=Y};ft.prototype.feature=function(Y){return new K(this._features[Y])};var rt=o.vectorTile.VectorTileFeature,Lt=Vt;function Vt(Y,nt){this.options=nt||{},this.features=Y,this.length=Y.length}function At(Y,nt){this.id=typeof Y.id=="number"?Y.id:void 0,this.type=Y.type,this.rawGeometry=Y.type===1?[Y.geometry]:Y.geometry,this.properties=Y.tags,this.extent=nt||4096}Vt.prototype.feature=function(Y){return new At(this.features[Y],this.options.extent)},At.prototype.loadGeometry=function(){var Y=this.rawGeometry;this.geometry=[];for(var nt=0;nt<Y.length;nt++){for(var ct=Y[nt],vt=[],Ft=0;Ft<ct.length;Ft++)vt.push(new o.Point$1(ct[Ft][0],ct[Ft][1]));this.geometry.push(vt)}return this.geometry},At.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Y=this.geometry,nt=1/0,ct=-1/0,vt=1/0,Ft=-1/0,pt=0;pt<Y.length;pt++)for(var bt=Y[pt],lt=0;lt<bt.length;lt++){var Et=bt[lt];nt=Math.min(nt,Et.x),ct=Math.max(ct,Et.x),vt=Math.min(vt,Et.y),Ft=Math.max(Ft,Et.y)}return[nt,vt,ct,Ft]},At.prototype.toGeoJSON=rt.prototype.toGeoJSON;var at=X,kt=Lt;function X(Y){var nt=new o.pbf;return function(ct,vt){for(var Ft in ct.layers)vt.writeMessage(3,ht,ct.layers[Ft])}(Y,nt),nt.finish()}function ht(Y,nt){var ct;nt.writeVarintField(15,Y.version||1),nt.writeStringField(1,Y.name||""),nt.writeVarintField(5,Y.extent||4096);var vt={keys:[],values:[],keycache:{},valuecache:{}};for(ct=0;ct<Y.length;ct++)vt.feature=Y.feature(ct),nt.writeMessage(2,Mt,vt);var Ft=vt.keys;for(ct=0;ct<Ft.length;ct++)nt.writeStringField(3,Ft[ct]);var pt=vt.values;for(ct=0;ct<pt.length;ct++)nt.writeMessage(4,te,pt[ct])}function Mt(Y,nt){var ct=Y.feature;ct.id!==void 0&&nt.writeVarintField(1,ct.id),nt.writeMessage(2,pe,Y),nt.writeVarintField(3,ct.type),nt.writeMessage(4,Gt,ct)}function pe(Y,nt){var ct=Y.feature,vt=Y.keys,Ft=Y.values,pt=Y.keycache,bt=Y.valuecache;for(var lt in ct.properties){var Et=pt[lt];Et===void 0&&(vt.push(lt),pt[lt]=Et=vt.length-1),nt.writeVarint(Et);var g=ct.properties[lt],ut=typeof g;ut!=="string"&&ut!=="boolean"&&ut!=="number"&&(g=JSON.stringify(g));var Ee=ut+":"+g,Zt=bt[Ee];Zt===void 0&&(Ft.push(g),bt[Ee]=Zt=Ft.length-1),nt.writeVarint(Zt)}}function Ct(Y,nt){return(nt<<3)+(7&Y)}function Dt(Y){return Y<<1^Y>>31}function Gt(Y,nt){for(var ct=Y.loadGeometry(),vt=Y.type,Ft=0,pt=0,bt=ct.length,lt=0;lt<bt;lt++){var Et=ct[lt],g=1;vt===1&&(g=Et.length),nt.writeVarint(Ct(1,g));for(var ut=vt===3?Et.length-1:Et.length,Ee=0;Ee<ut;Ee++){Ee===1&&vt!==1&&nt.writeVarint(Ct(2,ut-1));var Zt=Et[Ee].x-Ft,Be=Et[Ee].y-pt;nt.writeVarint(Dt(Zt)),nt.writeVarint(Dt(Be)),Ft+=Zt,pt+=Be}vt===3&&nt.writeVarint(Ct(7,1))}}function te(Y,nt){var ct=typeof Y;ct==="string"?nt.writeStringField(1,Y):ct==="boolean"?nt.writeBooleanField(7,Y):ct==="number"&&(Y%1!=0?nt.writeDoubleField(3,Y):Y<0?nt.writeSVarintField(6,Y):nt.writeVarintField(5,Y))}function re(Y,nt,ct,vt){ae(Y,ct,vt),ae(nt,2*ct,2*vt),ae(nt,2*ct+1,2*vt+1)}function ae(Y,nt,ct){var vt=Y[nt];Y[nt]=Y[ct],Y[ct]=vt}function he(Y,nt,ct,vt){var Ft=Y-ct,pt=nt-vt;return Ft*Ft+pt*pt}at.fromVectorTileJs=X,at.fromGeojsonVt=function(Y,nt){nt=nt||{};var ct={};for(var vt in Y)ct[vt]=new Lt(Y[vt].features,nt),ct[vt].name=vt,ct[vt].version=nt.version,ct[vt].extent=nt.extent;return X({layers:ct})},at.GeoJSONWrapper=kt;var Pe=function(Y){return Y[0]},Se=function(Y){return Y[1]},se=function(Y,nt,ct,vt,Ft){nt===void 0&&(nt=Pe),ct===void 0&&(ct=Se),vt===void 0&&(vt=64),Ft===void 0&&(Ft=Float64Array),this.nodeSize=vt,this.points=Y;for(var pt=Y.length<65536?Uint16Array:Uint32Array,bt=this.ids=new pt(Y.length),lt=this.coords=new Ft(2*Y.length),Et=0;Et<Y.length;Et++)bt[Et]=Et,lt[2*Et]=nt(Y[Et]),lt[2*Et+1]=ct(Y[Et]);(function g(ut,Ee,Zt,Be,Re,Fe){if(!(Re-Be<=Zt)){var fe=Be+Re>>1;(function ke(Me,He,ki,ei,$i,ln){for(;$i>ei;){if($i-ei>600){var Wi=$i-ei+1,Ji=ki-ei+1,Gi=Math.log(Wi),vr=.5*Math.exp(2*Gi/3),Xi=.5*Math.sqrt(Gi*vr*(Wi-vr)/Wi)*(Ji-Wi/2<0?-1:1);ke(Me,He,ki,Math.max(ei,Math.floor(ki-Ji*vr/Wi+Xi)),Math.min($i,Math.floor(ki+(Wi-Ji)*vr/Wi+Xi)),ln)}var yi=He[2*ki+ln],Bt=ei,Qe=$i;for(re(Me,He,ei,ki),He[2*$i+ln]>yi&&re(Me,He,ei,$i);Bt<Qe;){for(re(Me,He,Bt,Qe),Bt++,Qe--;He[2*Bt+ln]<yi;)Bt++;for(;He[2*Qe+ln]>yi;)Qe--}He[2*ei+ln]===yi?re(Me,He,ei,Qe):re(Me,He,++Qe,$i),Qe<=ki&&(ei=Qe+1),ki<=Qe&&($i=Qe-1)}})(ut,Ee,fe,Be,Re,Fe%2),g(ut,Ee,Zt,Be,fe-1,Fe+1),g(ut,Ee,Zt,fe+1,Re,Fe+1)}})(bt,lt,vt,0,bt.length-1,0)};se.prototype.range=function(Y,nt,ct,vt){return function(Ft,pt,bt,lt,Et,g,ut){for(var Ee,Zt,Be=[0,Ft.length-1,0],Re=[];Be.length;){var Fe=Be.pop(),fe=Be.pop(),ke=Be.pop();if(fe-ke<=ut)for(var Me=ke;Me<=fe;Me++)Zt=pt[2*Me+1],(Ee=pt[2*Me])>=bt&&Ee<=Et&&Zt>=lt&&Zt<=g&&Re.push(Ft[Me]);else{var He=Math.floor((ke+fe)/2);Zt=pt[2*He+1],(Ee=pt[2*He])>=bt&&Ee<=Et&&Zt>=lt&&Zt<=g&&Re.push(Ft[He]);var ki=(Fe+1)%2;(Fe===0?bt<=Ee:lt<=Zt)&&(Be.push(ke),Be.push(He-1),Be.push(ki)),(Fe===0?Et>=Ee:g>=Zt)&&(Be.push(He+1),Be.push(fe),Be.push(ki))}}return Re}(this.ids,this.coords,Y,nt,ct,vt,this.nodeSize)},se.prototype.within=function(Y,nt,ct){return function(vt,Ft,pt,bt,lt,Et){for(var g=[0,vt.length-1,0],ut=[],Ee=lt*lt;g.length;){var Zt=g.pop(),Be=g.pop(),Re=g.pop();if(Be-Re<=Et)for(var Fe=Re;Fe<=Be;Fe++)he(Ft[2*Fe],Ft[2*Fe+1],pt,bt)<=Ee&&ut.push(vt[Fe]);else{var fe=Math.floor((Re+Be)/2),ke=Ft[2*fe],Me=Ft[2*fe+1];he(ke,Me,pt,bt)<=Ee&&ut.push(vt[fe]);var He=(Zt+1)%2;(Zt===0?pt-lt<=ke:bt-lt<=Me)&&(g.push(Re),g.push(fe-1),g.push(He)),(Zt===0?pt+lt>=ke:bt+lt>=Me)&&(g.push(fe+1),g.push(Be),g.push(He))}}return ut}(this.ids,this.coords,Y,nt,ct,this.nodeSize)};var fi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Y){return Y}},Ze=function(Y){this.options=Fn(Object.create(fi),Y),this.trees=new Array(this.options.maxZoom+1)};function Ye(Y,nt,ct,vt,Ft){return{x:Y,y:nt,zoom:1/0,id:ct,parentId:-1,numPoints:vt,properties:Ft}}function ze(Y,nt){var ct=Y.geometry.coordinates,vt=ct[1];return{x:Ii(ct[0]),y:_i(vt),zoom:1/0,index:nt,parentId:-1}}function pi(Y){return{type:"Feature",id:Y.id,properties:sn(Y),geometry:{type:"Point",coordinates:[(vt=Y.x,360*(vt-.5)),(nt=Y.y,ct=(180-360*nt)*Math.PI/180,360*Math.atan(Math.exp(ct))/Math.PI-90)]}};var nt,ct,vt}function sn(Y){var nt=Y.numPoints,ct=nt>=1e4?Math.round(nt/1e3)+"k":nt>=1e3?Math.round(nt/100)/10+"k":nt;return Fn(Fn({},Y.properties),{cluster:!0,cluster_id:Y.id,point_count:nt,point_count_abbreviated:ct})}function Ii(Y){return Y/360+.5}function _i(Y){var nt=Math.sin(Y*Math.PI/180),ct=.5-.25*Math.log((1+nt)/(1-nt))/Math.PI;return ct<0?0:ct>1?1:ct}function Fn(Y,nt){for(var ct in nt)Y[ct]=nt[ct];return Y}function Ai(Y){return Y.x}function vi(Y){return Y.y}function cn(Y,nt,ct,vt,Ft,pt){var bt=Ft-ct,lt=pt-vt;if(bt!==0||lt!==0){var Et=((Y-ct)*bt+(nt-vt)*lt)/(bt*bt+lt*lt);Et>1?(ct=Ft,vt=pt):Et>0&&(ct+=bt*Et,vt+=lt*Et)}return(bt=Y-ct)*bt+(lt=nt-vt)*lt}function Ri(Y,nt,ct,vt){var Ft={id:Y===void 0?null:Y,type:nt,geometry:ct,tags:vt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(pt){var bt=pt.geometry,lt=pt.type;if(lt==="Point"||lt==="MultiPoint"||lt==="LineString")ur(pt,bt);else if(lt==="Polygon"||lt==="MultiLineString")for(var Et=0;Et<bt.length;Et++)ur(pt,bt[Et]);else if(lt==="MultiPolygon")for(Et=0;Et<bt.length;Et++)for(var g=0;g<bt[Et].length;g++)ur(pt,bt[Et][g])}(Ft),Ft}function ur(Y,nt){for(var ct=0;ct<nt.length;ct+=3)Y.minX=Math.min(Y.minX,nt[ct]),Y.minY=Math.min(Y.minY,nt[ct+1]),Y.maxX=Math.max(Y.maxX,nt[ct]),Y.maxY=Math.max(Y.maxY,nt[ct+1])}function $n(Y,nt,ct,vt){if(nt.geometry){var Ft=nt.geometry.coordinates,pt=nt.geometry.type,bt=Math.pow(ct.tolerance/((1<<ct.maxZoom)*ct.extent),2),lt=[],Et=nt.id;if(ct.promoteId?Et=nt.properties[ct.promoteId]:ct.generateId&&(Et=vt||0),pt==="Point")gn(Ft,lt);else if(pt==="MultiPoint")for(var g=0;g<Ft.length;g++)gn(Ft[g],lt);else if(pt==="LineString")rr(Ft,lt,bt,!1);else if(pt==="MultiLineString"){if(ct.lineMetrics){for(g=0;g<Ft.length;g++)rr(Ft[g],lt=[],bt,!1),Y.push(Ri(Et,"LineString",lt,nt.properties));return}Wn(Ft,lt,bt,!1)}else if(pt==="Polygon")Wn(Ft,lt,bt,!0);else{if(pt!=="MultiPolygon"){if(pt==="GeometryCollection"){for(g=0;g<nt.geometry.geometries.length;g++)$n(Y,{id:Et,geometry:nt.geometry.geometries[g],properties:nt.properties},ct,vt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(g=0;g<Ft.length;g++){var ut=[];Wn(Ft[g],ut,bt,!0),lt.push(ut)}}Y.push(Ri(Et,pt,lt,nt.properties))}}function gn(Y,nt){nt.push(Tn(Y[0])),nt.push(tr(Y[1])),nt.push(0)}function rr(Y,nt,ct,vt){for(var Ft,pt,bt=0,lt=0;lt<Y.length;lt++){var Et=Tn(Y[lt][0]),g=tr(Y[lt][1]);nt.push(Et),nt.push(g),nt.push(0),lt>0&&(bt+=vt?(Ft*g-Et*pt)/2:Math.sqrt(Math.pow(Et-Ft,2)+Math.pow(g-pt,2))),Ft=Et,pt=g}var ut=nt.length-3;nt[2]=1,function Ee(Zt,Be,Re,Fe){for(var fe,ke=Fe,Me=Re-Be>>1,He=Re-Be,ki=Zt[Be],ei=Zt[Be+1],$i=Zt[Re],ln=Zt[Re+1],Wi=Be+3;Wi<Re;Wi+=3){var Ji=cn(Zt[Wi],Zt[Wi+1],ki,ei,$i,ln);if(Ji>ke)fe=Wi,ke=Ji;else if(Ji===ke){var Gi=Math.abs(Wi-Me);Gi<He&&(fe=Wi,He=Gi)}}ke>Fe&&(fe-Be>3&&Ee(Zt,Be,fe,Fe),Zt[fe+2]=ke,Re-fe>3&&Ee(Zt,fe,Re,Fe))}(nt,0,ut,ct),nt[ut+2]=1,nt.size=Math.abs(bt),nt.start=0,nt.end=nt.size}function Wn(Y,nt,ct,vt){for(var Ft=0;Ft<Y.length;Ft++){var pt=[];rr(Y[Ft],pt,ct,vt),nt.push(pt)}}function Tn(Y){return Y/360+.5}function tr(Y){var nt=Math.sin(Y*Math.PI/180),ct=.5-.25*Math.log((1+nt)/(1-nt))/Math.PI;return ct<0?0:ct>1?1:ct}function je(Y,nt,ct,vt,Ft,pt,bt,lt){if(vt/=nt,pt>=(ct/=nt)&&bt<vt)return Y;if(bt<ct||pt>=vt)return null;for(var Et=[],g=0;g<Y.length;g++){var ut=Y[g],Ee=ut.geometry,Zt=ut.type,Be=Ft===0?ut.minX:ut.minY,Re=Ft===0?ut.maxX:ut.maxY;if(Be>=ct&&Re<vt)Et.push(ut);else if(!(Re<ct||Be>=vt)){var Fe=[];if(Zt==="Point"||Zt==="MultiPoint")mi(Ee,Fe,ct,vt,Ft);else if(Zt==="LineString")Mi(Ee,Fe,ct,vt,Ft,!1,lt.lineMetrics);else if(Zt==="MultiLineString")_r(Ee,Fe,ct,vt,Ft,!1);else if(Zt==="Polygon")_r(Ee,Fe,ct,vt,Ft,!0);else if(Zt==="MultiPolygon")for(var fe=0;fe<Ee.length;fe++){var ke=[];_r(Ee[fe],ke,ct,vt,Ft,!0),ke.length&&Fe.push(ke)}if(Fe.length){if(lt.lineMetrics&&Zt==="LineString"){for(fe=0;fe<Fe.length;fe++)Et.push(Ri(ut.id,Zt,Fe[fe],ut.tags));continue}Zt!=="LineString"&&Zt!=="MultiLineString"||(Fe.length===1?(Zt="LineString",Fe=Fe[0]):Zt="MultiLineString"),Zt!=="Point"&&Zt!=="MultiPoint"||(Zt=Fe.length===3?"Point":"MultiPoint"),Et.push(Ri(ut.id,Zt,Fe,ut.tags))}}}return Et.length?Et:null}function mi(Y,nt,ct,vt,Ft){for(var pt=0;pt<Y.length;pt+=3){var bt=Y[pt+Ft];bt>=ct&&bt<=vt&&(nt.push(Y[pt]),nt.push(Y[pt+1]),nt.push(Y[pt+2]))}}function Mi(Y,nt,ct,vt,Ft,pt,bt){for(var lt,Et,g=nn(Y),ut=Ft===0?Ne:Xe,Ee=Y.start,Zt=0;Zt<Y.length-3;Zt+=3){var Be=Y[Zt],Re=Y[Zt+1],Fe=Y[Zt+2],fe=Y[Zt+3],ke=Y[Zt+4],Me=Ft===0?Be:Re,He=Ft===0?fe:ke,ki=!1;bt&&(lt=Math.sqrt(Math.pow(Be-fe,2)+Math.pow(Re-ke,2))),Me<ct?He>ct&&(Et=ut(g,Be,Re,fe,ke,ct),bt&&(g.start=Ee+lt*Et)):Me>vt?He<vt&&(Et=ut(g,Be,Re,fe,ke,vt),bt&&(g.start=Ee+lt*Et)):St(g,Be,Re,Fe),He<ct&&Me>=ct&&(Et=ut(g,Be,Re,fe,ke,ct),ki=!0),He>vt&&Me<=vt&&(Et=ut(g,Be,Re,fe,ke,vt),ki=!0),!pt&&ki&&(bt&&(g.end=Ee+lt*Et),nt.push(g),g=nn(Y)),bt&&(Ee+=lt)}var ei=Y.length-3;Be=Y[ei],Re=Y[ei+1],Fe=Y[ei+2],(Me=Ft===0?Be:Re)>=ct&&Me<=vt&&St(g,Be,Re,Fe),ei=g.length-3,pt&&ei>=3&&(g[ei]!==g[0]||g[ei+1]!==g[1])&&St(g,g[0],g[1],g[2]),g.length&&nt.push(g)}function nn(Y){var nt=[];return nt.size=Y.size,nt.start=Y.start,nt.end=Y.end,nt}function _r(Y,nt,ct,vt,Ft,pt){for(var bt=0;bt<Y.length;bt++)Mi(Y[bt],nt,ct,vt,Ft,pt,!1)}function St(Y,nt,ct,vt){Y.push(nt),Y.push(ct),Y.push(vt)}function Ne(Y,nt,ct,vt,Ft,pt){var bt=(pt-nt)/(vt-nt);return Y.push(pt),Y.push(ct+(Ft-ct)*bt),Y.push(1),bt}function Xe(Y,nt,ct,vt,Ft,pt){var bt=(pt-ct)/(Ft-ct);return Y.push(nt+(vt-nt)*bt),Y.push(pt),Y.push(1),bt}function ci(Y,nt){for(var ct=[],vt=0;vt<Y.length;vt++){var Ft,pt=Y[vt],bt=pt.type;if(bt==="Point"||bt==="MultiPoint"||bt==="LineString")Ft=qt(pt.geometry,nt);else if(bt==="MultiLineString"||bt==="Polygon"){Ft=[];for(var lt=0;lt<pt.geometry.length;lt++)Ft.push(qt(pt.geometry[lt],nt))}else if(bt==="MultiPolygon")for(Ft=[],lt=0;lt<pt.geometry.length;lt++){for(var Et=[],g=0;g<pt.geometry[lt].length;g++)Et.push(qt(pt.geometry[lt][g],nt));Ft.push(Et)}ct.push(Ri(pt.id,bt,Ft,pt.tags))}return ct}function qt(Y,nt){var ct=[];ct.size=Y.size,Y.start!==void 0&&(ct.start=Y.start,ct.end=Y.end);for(var vt=0;vt<Y.length;vt+=3)ct.push(Y[vt]+nt,Y[vt+1],Y[vt+2]);return ct}function De(Y,nt){if(Y.transformed)return Y;var ct,vt,Ft,pt=1<<Y.z,bt=Y.x,lt=Y.y;for(ct=0;ct<Y.features.length;ct++){var Et=Y.features[ct],g=Et.geometry,ut=Et.type;if(Et.geometry=[],ut===1)for(vt=0;vt<g.length;vt+=2)Et.geometry.push(mt(g[vt],g[vt+1],nt,pt,bt,lt));else for(vt=0;vt<g.length;vt++){var Ee=[];for(Ft=0;Ft<g[vt].length;Ft+=2)Ee.push(mt(g[vt][Ft],g[vt][Ft+1],nt,pt,bt,lt));Et.geometry.push(Ee)}}return Y.transformed=!0,Y}function mt(Y,nt,ct,vt,Ft,pt){return[Math.round(ct*(Y*vt-Ft)),Math.round(ct*(nt*vt-pt))]}function Ve(Y,nt,ct,vt,Ft){for(var pt=nt===Ft.maxZoom?0:Ft.tolerance/((1<<nt)*Ft.extent),bt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ct,y:vt,z:nt,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},lt=0;lt<Y.length;lt++){bt.numFeatures++,Ce(bt,Y[lt],pt,Ft);var Et=Y[lt].minX,g=Y[lt].minY,ut=Y[lt].maxX,Ee=Y[lt].maxY;Et<bt.minX&&(bt.minX=Et),g<bt.minY&&(bt.minY=g),ut>bt.maxX&&(bt.maxX=ut),Ee>bt.maxY&&(bt.maxY=Ee)}return bt}function Ce(Y,nt,ct,vt){var Ft=nt.geometry,pt=nt.type,bt=[];if(pt==="Point"||pt==="MultiPoint")for(var lt=0;lt<Ft.length;lt+=3)bt.push(Ft[lt]),bt.push(Ft[lt+1]),Y.numPoints++,Y.numSimplified++;else if(pt==="LineString")H(bt,Ft,Y,ct,!1,!1);else if(pt==="MultiLineString"||pt==="Polygon")for(lt=0;lt<Ft.length;lt++)H(bt,Ft[lt],Y,ct,pt==="Polygon",lt===0);else if(pt==="MultiPolygon")for(var Et=0;Et<Ft.length;Et++){var g=Ft[Et];for(lt=0;lt<g.length;lt++)H(bt,g[lt],Y,ct,!0,lt===0)}if(bt.length){var ut=nt.tags||null;if(pt==="LineString"&&vt.lineMetrics){for(var Ee in ut={},nt.tags)ut[Ee]=nt.tags[Ee];ut.mapbox_clip_start=Ft.start/Ft.size,ut.mapbox_clip_end=Ft.end/Ft.size}var Zt={geometry:bt,type:pt==="Polygon"||pt==="MultiPolygon"?3:pt==="LineString"||pt==="MultiLineString"?2:1,tags:ut};nt.id!==null&&(Zt.id=nt.id),Y.features.push(Zt)}}function H(Y,nt,ct,vt,Ft,pt){var bt=vt*vt;if(vt>0&&nt.size<(Ft?bt:vt))ct.numPoints+=nt.length/3;else{for(var lt=[],Et=0;Et<nt.length;Et+=3)(vt===0||nt[Et+2]>bt)&&(ct.numSimplified++,lt.push(nt[Et]),lt.push(nt[Et+1])),ct.numPoints++;Ft&&function(g,ut){for(var Ee=0,Zt=0,Be=g.length,Re=Be-2;Zt<Be;Re=Zt,Zt+=2)Ee+=(g[Zt]-g[Re])*(g[Zt+1]+g[Re+1]);if(Ee>0===ut)for(Zt=0,Be=g.length;Zt<Be/2;Zt+=2){var Fe=g[Zt],fe=g[Zt+1];g[Zt]=g[Be-2-Zt],g[Zt+1]=g[Be-1-Zt],g[Be-2-Zt]=Fe,g[Be-1-Zt]=fe}}(lt,pt),Y.push(lt)}}function ve(Y,nt){var ct=(nt=this.options=function(Ft,pt){for(var bt in pt)Ft[bt]=pt[bt];return Ft}(Object.create(this.options),nt)).debug;if(ct&&console.time("preprocess data"),nt.maxZoom<0||nt.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(nt.promoteId&&nt.generateId)throw new Error("promoteId and generateId cannot be used together.");var vt=function(Ft,pt){var bt=[];if(Ft.type==="FeatureCollection")for(var lt=0;lt<Ft.features.length;lt++)$n(bt,Ft.features[lt],pt,lt);else $n(bt,Ft.type==="Feature"?Ft:{geometry:Ft},pt);return bt}(Y,nt);this.tiles={},this.tileCoords=[],ct&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",nt.indexMaxZoom,nt.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(vt=function(Ft,pt){var bt=pt.buffer/pt.extent,lt=Ft,Et=je(Ft,1,-1-bt,bt,0,-1,2,pt),g=je(Ft,1,1-bt,2+bt,0,-1,2,pt);return(Et||g)&&(lt=je(Ft,1,-bt,1+bt,0,-1,2,pt)||[],Et&&(lt=ci(Et,1).concat(lt)),g&&(lt=lt.concat(ci(g,-1)))),lt}(vt,nt)).length&&this.splitTile(vt,0,0,0),ct&&(vt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Te(Y,nt,ct){return 32*((1<<Y)*ct+nt)+Y}function wt(Y,nt){var ct=Y.tileID.canonical;if(!this._geoJSONIndex)return nt(null,null);var vt=this._geoJSONIndex.getTile(ct.z,ct.x,ct.y);if(!vt)return nt(null,null);var Ft=new ft(vt.features),pt=at(Ft);pt.byteOffset===0&&pt.byteLength===pt.buffer.byteLength||(pt=new Uint8Array(pt)),nt(null,{vectorTile:Ft,rawData:pt.buffer})}Ze.prototype.load=function(Y){var nt=this.options,ct=nt.log,vt=nt.minZoom,Ft=nt.maxZoom,pt=nt.nodeSize;ct&&console.time("total time");var bt="prepare "+Y.length+" points";ct&&console.time(bt),this.points=Y;for(var lt=[],Et=0;Et<Y.length;Et++)Y[Et].geometry&&lt.push(ze(Y[Et],Et));this.trees[Ft+1]=new se(lt,Ai,vi,pt,Float32Array),ct&&console.timeEnd(bt);for(var g=Ft;g>=vt;g--){var ut=+Date.now();lt=this._cluster(lt,g),this.trees[g]=new se(lt,Ai,vi,pt,Float32Array),ct&&console.log("z%d: %d clusters in %dms",g,lt.length,+Date.now()-ut)}return ct&&console.timeEnd("total time"),this},Ze.prototype.getClusters=function(Y,nt){var ct=((Y[0]+180)%360+360)%360-180,vt=Math.max(-90,Math.min(90,Y[1])),Ft=Y[2]===180?180:((Y[2]+180)%360+360)%360-180,pt=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)ct=-180,Ft=180;else if(ct>Ft){var bt=this.getClusters([ct,vt,180,pt],nt),lt=this.getClusters([-180,vt,Ft,pt],nt);return bt.concat(lt)}for(var Et=this.trees[this._limitZoom(nt)],g=[],ut=0,Ee=Et.range(Ii(ct),_i(pt),Ii(Ft),_i(vt));ut<Ee.length;ut+=1){var Zt=Et.points[Ee[ut]];g.push(Zt.numPoints?pi(Zt):this.points[Zt.index])}return g},Ze.prototype.getChildren=function(Y){var nt=this._getOriginId(Y),ct=this._getOriginZoom(Y),vt="No cluster with the specified id.",Ft=this.trees[ct];if(!Ft)throw new Error(vt);var pt=Ft.points[nt];if(!pt)throw new Error(vt);for(var bt=this.options.radius/(this.options.extent*Math.pow(2,ct-1)),lt=[],Et=0,g=Ft.within(pt.x,pt.y,bt);Et<g.length;Et+=1){var ut=Ft.points[g[Et]];ut.parentId===Y&&lt.push(ut.numPoints?pi(ut):this.points[ut.index])}if(lt.length===0)throw new Error(vt);return lt},Ze.prototype.getLeaves=function(Y,nt,ct){var vt=[];return this._appendLeaves(vt,Y,nt=nt||10,ct=ct||0,0),vt},Ze.prototype.getTile=function(Y,nt,ct){var vt=this.trees[this._limitZoom(Y)],Ft=Math.pow(2,Y),pt=this.options,bt=pt.radius/pt.extent,lt=(ct-bt)/Ft,Et=(ct+1+bt)/Ft,g={features:[]};return this._addTileFeatures(vt.range((nt-bt)/Ft,lt,(nt+1+bt)/Ft,Et),vt.points,nt,ct,Ft,g),nt===0&&this._addTileFeatures(vt.range(1-bt/Ft,lt,1,Et),vt.points,Ft,ct,Ft,g),nt===Ft-1&&this._addTileFeatures(vt.range(0,lt,bt/Ft,Et),vt.points,-1,ct,Ft,g),g.features.length?g:null},Ze.prototype.getClusterExpansionZoom=function(Y){for(var nt=this._getOriginZoom(Y)-1;nt<=this.options.maxZoom;){var ct=this.getChildren(Y);if(nt++,ct.length!==1)break;Y=ct[0].properties.cluster_id}return nt},Ze.prototype._appendLeaves=function(Y,nt,ct,vt,Ft){for(var pt=0,bt=this.getChildren(nt);pt<bt.length;pt+=1){var lt=bt[pt],Et=lt.properties;if(Et&&Et.cluster?Ft+Et.point_count<=vt?Ft+=Et.point_count:Ft=this._appendLeaves(Y,Et.cluster_id,ct,vt,Ft):Ft<vt?Ft++:Y.push(lt),Y.length===ct)break}return Ft},Ze.prototype._addTileFeatures=function(Y,nt,ct,vt,Ft,pt){for(var bt=0,lt=Y;bt<lt.length;bt+=1){var Et=nt[lt[bt]],g=Et.numPoints,ut={type:1,geometry:[[Math.round(this.options.extent*(Et.x*Ft-ct)),Math.round(this.options.extent*(Et.y*Ft-vt))]],tags:g?sn(Et):this.points[Et.index].properties},Ee=void 0;g?Ee=Et.id:this.options.generateId?Ee=Et.index:this.points[Et.index].id&&(Ee=this.points[Et.index].id),Ee!==void 0&&(ut.id=Ee),pt.features.push(ut)}},Ze.prototype._limitZoom=function(Y){return Math.max(this.options.minZoom,Math.min(+Y,this.options.maxZoom+1))},Ze.prototype._cluster=function(Y,nt){for(var ct=[],vt=this.options,Ft=vt.reduce,pt=vt.minPoints,bt=vt.radius/(vt.extent*Math.pow(2,nt)),lt=0;lt<Y.length;lt++){var Et=Y[lt];if(!(Et.zoom<=nt)){Et.zoom=nt;for(var g=this.trees[nt+1],ut=g.within(Et.x,Et.y,bt),Ee=Et.numPoints||1,Zt=Ee,Be=0,Re=ut;Be<Re.length;Be+=1){var Fe=g.points[Re[Be]];Fe.zoom>nt&&(Zt+=Fe.numPoints||1)}if(Zt>=pt){for(var fe=Et.x*Ee,ke=Et.y*Ee,Me=Ft&&Ee>1?this._map(Et,!0):null,He=(lt<<5)+(nt+1)+this.points.length,ki=0,ei=ut;ki<ei.length;ki+=1){var $i=g.points[ei[ki]];if(!($i.zoom<=nt)){$i.zoom=nt;var ln=$i.numPoints||1;fe+=$i.x*ln,ke+=$i.y*ln,$i.parentId=He,Ft&&(Me||(Me=this._map(Et,!0)),Ft(Me,this._map($i)))}}Et.parentId=He,ct.push(Ye(fe/Zt,ke/Zt,He,Zt,Me))}else if(ct.push(Et),Zt>1)for(var Wi=0,Ji=ut;Wi<Ji.length;Wi+=1){var Gi=g.points[Ji[Wi]];Gi.zoom<=nt||(Gi.zoom=nt,ct.push(Gi))}}}return ct},Ze.prototype._getOriginId=function(Y){return Y-this.points.length>>5},Ze.prototype._getOriginZoom=function(Y){return(Y-this.points.length)%32},Ze.prototype._map=function(Y,nt){if(Y.numPoints)return nt?Fn({},Y.properties):Y.properties;var ct=this.points[Y.index].properties,vt=this.options.map(ct);return nt&&vt===ct?Fn({},vt):vt},ve.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ve.prototype.splitTile=function(Y,nt,ct,vt,Ft,pt,bt){for(var lt=[Y,nt,ct,vt],Et=this.options,g=Et.debug;lt.length;){vt=lt.pop(),ct=lt.pop(),nt=lt.pop(),Y=lt.pop();var ut=1<<nt,Ee=Te(nt,ct,vt),Zt=this.tiles[Ee];if(!Zt&&(g>1&&console.time("creation"),Zt=this.tiles[Ee]=Ve(Y,nt,ct,vt,Et),this.tileCoords.push({z:nt,x:ct,y:vt}),g)){g>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",nt,ct,vt,Zt.numFeatures,Zt.numPoints,Zt.numSimplified),console.timeEnd("creation"));var Be="z"+nt;this.stats[Be]=(this.stats[Be]||0)+1,this.total++}if(Zt.source=Y,Ft){if(nt===Et.maxZoom||nt===Ft)continue;var Re=1<<Ft-nt;if(ct!==Math.floor(pt/Re)||vt!==Math.floor(bt/Re))continue}else if(nt===Et.indexMaxZoom||Zt.numPoints<=Et.indexMaxPoints)continue;if(Zt.source=null,Y.length!==0){g>1&&console.time("clipping");var Fe,fe,ke,Me,He,ki,ei=.5*Et.buffer/Et.extent,$i=.5-ei,ln=.5+ei,Wi=1+ei;Fe=fe=ke=Me=null,He=je(Y,ut,ct-ei,ct+ln,0,Zt.minX,Zt.maxX,Et),ki=je(Y,ut,ct+$i,ct+Wi,0,Zt.minX,Zt.maxX,Et),Y=null,He&&(Fe=je(He,ut,vt-ei,vt+ln,1,Zt.minY,Zt.maxY,Et),fe=je(He,ut,vt+$i,vt+Wi,1,Zt.minY,Zt.maxY,Et),He=null),ki&&(ke=je(ki,ut,vt-ei,vt+ln,1,Zt.minY,Zt.maxY,Et),Me=je(ki,ut,vt+$i,vt+Wi,1,Zt.minY,Zt.maxY,Et),ki=null),g>1&&console.timeEnd("clipping"),lt.push(Fe||[],nt+1,2*ct,2*vt),lt.push(fe||[],nt+1,2*ct,2*vt+1),lt.push(ke||[],nt+1,2*ct+1,2*vt),lt.push(Me||[],nt+1,2*ct+1,2*vt+1)}}},ve.prototype.getTile=function(Y,nt,ct){var vt=this.options,Ft=vt.extent,pt=vt.debug;if(Y<0||Y>24)return null;var bt=1<<Y,lt=Te(Y,nt=(nt%bt+bt)%bt,ct);if(this.tiles[lt])return De(this.tiles[lt],Ft);pt>1&&console.log("drilling down to z%d-%d-%d",Y,nt,ct);for(var Et,g=Y,ut=nt,Ee=ct;!Et&&g>0;)g--,ut=Math.floor(ut/2),Ee=Math.floor(Ee/2),Et=this.tiles[Te(g,ut,Ee)];return Et&&Et.source?(pt>1&&console.log("found parent tile z%d-%d-%d",g,ut,Ee),pt>1&&console.time("drilling down"),this.splitTile(Et.source,g,ut,Ee,Y,nt,ct),pt>1&&console.timeEnd("drilling down"),this.tiles[lt]?De(this.tiles[lt],Ft):null):null};var Kt=function(Y){function nt(ct,vt,Ft,pt){Y.call(this,ct,vt,Ft,wt),pt&&(this.loadGeoJSON=pt)}return Y&&(nt.__proto__=Y),(nt.prototype=Object.create(Y&&Y.prototype)).constructor=nt,nt.prototype.loadData=function(ct,vt){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=vt,this._pendingLoadDataParams=ct,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},nt.prototype._loadData=function(){var ct=this;if(this._pendingCallback&&this._pendingLoadDataParams){var vt=this._pendingCallback,Ft=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var pt=!!(Ft&&Ft.request&&Ft.request.collectResourceTiming)&&new o.RequestPerformance(Ft.request);this.loadGeoJSON(Ft,function(bt,lt){if(bt||!lt)return vt(bt);if(typeof lt!="object")return vt(new Error("Input data given to '"+Ft.source+"' is not a valid GeoJSON object."));(function Zt(Be,Re){var Fe,fe=Be&&Be.type;if(fe==="FeatureCollection")for(Fe=0;Fe<Be.features.length;Fe++)Zt(Be.features[Fe],Re);else if(fe==="GeometryCollection")for(Fe=0;Fe<Be.geometries.length;Fe++)Zt(Be.geometries[Fe],Re);else if(fe==="Feature")Zt(Be.geometry,Re);else if(fe==="Polygon")j(Be.coordinates,Re);else if(fe==="MultiPolygon")for(Fe=0;Fe<Be.coordinates.length;Fe++)j(Be.coordinates[Fe],Re);return Be})(lt,!0);try{if(Ft.filter){var Et=o.createExpression(Ft.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Et.result==="error")throw new Error(Et.value.map(function(Zt){return Zt.key+": "+Zt.message}).join(", "));var g=lt.features.filter(function(Zt){return Et.value.evaluate({zoom:0},Zt)});lt={type:"FeatureCollection",features:g}}ct._geoJSONIndex=Ft.cluster?new Ze(function(Zt){var Be=Zt.superclusterOptions,Re=Zt.clusterProperties;if(!Re||!Be)return Be;for(var Fe={},fe={},ke={accumulated:null,zoom:0},Me={properties:null},He=Object.keys(Re),ki=0,ei=He;ki<ei.length;ki+=1){var $i=ei[ki],ln=Re[$i],Wi=ln[0],Ji=o.createExpression(ln[1]),Gi=o.createExpression(typeof Wi=="string"?[Wi,["accumulated"],["get",$i]]:Wi);Fe[$i]=Ji.value,fe[$i]=Gi.value}return Be.map=function(vr){Me.properties=vr;for(var Xi={},yi=0,Bt=He;yi<Bt.length;yi+=1){var Qe=Bt[yi];Xi[Qe]=Fe[Qe].evaluate(ke,Me)}return Xi},Be.reduce=function(vr,Xi){Me.properties=Xi;for(var yi=0,Bt=He;yi<Bt.length;yi+=1){var Qe=Bt[yi];ke.accumulated=vr[Qe],vr[Qe]=fe[Qe].evaluate(ke,Me)}},Be}(Ft)).load(lt.features):function(Zt,Be){return new ve(Zt,Be)}(lt,Ft.geojsonVtOptions)}catch(Zt){return vt(Zt)}ct.loaded={};var ut={};if(pt){var Ee=pt.finish();Ee&&(ut.resourceTiming={},ut.resourceTiming[Ft.source]=JSON.parse(JSON.stringify(Ee)))}vt(null,ut)})}},nt.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},nt.prototype.reloadTile=function(ct,vt){var Ft=this.loaded;return Ft&&Ft[ct.uid]?Y.prototype.reloadTile.call(this,ct,vt):this.loadTile(ct,vt)},nt.prototype.loadGeoJSON=function(ct,vt){if(ct.request)o.getJSON(ct.request,vt);else{if(typeof ct.data!="string")return vt(new Error("Input data given to '"+ct.source+"' is not a valid GeoJSON object."));try{return vt(null,JSON.parse(ct.data))}catch{return vt(new Error("Input data given to '"+ct.source+"' is not a valid GeoJSON object."))}}},nt.prototype.removeSource=function(ct,vt){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),vt()},nt.prototype.getClusterExpansionZoom=function(ct,vt){try{vt(null,this._geoJSONIndex.getClusterExpansionZoom(ct.clusterId))}catch(Ft){vt(Ft)}},nt.prototype.getClusterChildren=function(ct,vt){try{vt(null,this._geoJSONIndex.getChildren(ct.clusterId))}catch(Ft){vt(Ft)}},nt.prototype.getClusterLeaves=function(ct,vt){try{vt(null,this._geoJSONIndex.getLeaves(ct.clusterId,ct.limit,ct.offset))}catch(Ft){vt(Ft)}},nt}(N),ce=function(Y){var nt=this;this.self=Y,this.actor=new o.Actor(Y,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:N,geojson:Kt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ct,vt){if(nt.workerSourceTypes[ct])throw new Error('Worker source with name "'+ct+'" already registered.');nt.workerSourceTypes[ct]=vt},this.self.registerRTLTextPlugin=function(ct){if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=ct.applyArabicShaping,o.plugin.processBidirectionalText=ct.processBidirectionalText,o.plugin.processStyledBidirectionalText=ct.processStyledBidirectionalText}};return ce.prototype.setReferrer=function(Y,nt){this.referrer=nt},ce.prototype.setImages=function(Y,nt,ct){for(var vt in this.availableImages[Y]=nt,this.workerSources[Y]){var Ft=this.workerSources[Y][vt];for(var pt in Ft)Ft[pt].availableImages=nt}ct()},ce.prototype.setLayers=function(Y,nt,ct){this.getLayerIndex(Y).replace(nt),ct()},ce.prototype.updateLayers=function(Y,nt,ct){this.getLayerIndex(Y).update(nt.layers,nt.removedIds),ct()},ce.prototype.loadTile=function(Y,nt,ct){this.getWorkerSource(Y,nt.type,nt.source).loadTile(nt,ct)},ce.prototype.loadDEMTile=function(Y,nt,ct){this.getDEMWorkerSource(Y,nt.source).loadTile(nt,ct)},ce.prototype.reloadTile=function(Y,nt,ct){this.getWorkerSource(Y,nt.type,nt.source).reloadTile(nt,ct)},ce.prototype.abortTile=function(Y,nt,ct){this.getWorkerSource(Y,nt.type,nt.source).abortTile(nt,ct)},ce.prototype.removeTile=function(Y,nt,ct){this.getWorkerSource(Y,nt.type,nt.source).removeTile(nt,ct)},ce.prototype.removeDEMTile=function(Y,nt){this.getDEMWorkerSource(Y,nt.source).removeTile(nt)},ce.prototype.removeSource=function(Y,nt,ct){if(this.workerSources[Y]&&this.workerSources[Y][nt.type]&&this.workerSources[Y][nt.type][nt.source]){var vt=this.workerSources[Y][nt.type][nt.source];delete this.workerSources[Y][nt.type][nt.source],vt.removeSource!==void 0?vt.removeSource(nt,ct):ct()}},ce.prototype.loadWorkerSource=function(Y,nt,ct){try{this.self.importScripts(nt.url),ct()}catch(vt){ct(vt.toString())}},ce.prototype.syncRTLPluginState=function(Y,nt,ct){try{o.plugin.setState(nt);var vt=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&vt!=null){this.self.importScripts(vt);var Ft=o.plugin.isParsed();ct(Ft?void 0:new Error("RTL Text Plugin failed to import scripts from "+vt),Ft)}}catch(pt){ct(pt.toString())}},ce.prototype.getAvailableImages=function(Y){var nt=this.availableImages[Y];return nt||(nt=[]),nt},ce.prototype.getLayerIndex=function(Y){var nt=this.layerIndexes[Y];return nt||(nt=this.layerIndexes[Y]=new A),nt},ce.prototype.getWorkerSource=function(Y,nt,ct){var vt=this;return this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][nt]||(this.workerSources[Y][nt]={}),this.workerSources[Y][nt][ct]||(this.workerSources[Y][nt][ct]=new this.workerSourceTypes[nt]({send:function(Ft,pt,bt){vt.actor.send(Ft,pt,bt,Y)}},this.getLayerIndex(Y),this.getAvailableImages(Y))),this.workerSources[Y][nt][ct]},ce.prototype.getDEMWorkerSource=function(Y,nt){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][nt]||(this.demWorkerSources[Y][nt]=new W),this.demWorkerSources[Y][nt]},ce.prototype.enforceCacheSizeLimit=function(Y,nt){o.enforceCacheSizeLimit(nt)},typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ce(self)),ce}),s(["./shared"],function(o){var l=o.createCommonjsModule(function(c){function d(E){return!f(E)}function f(E){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var R,F,U=new Blob([""],{type:"text/javascript"}),J=URL.createObjectURL(U);try{F=new Worker(J),R=!0}catch{R=!1}return F&&F.terminate(),URL.revokeObjectURL(J),R}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var R=document.createElement("canvas");R.width=R.height=1;var F=R.getContext("2d");if(!F)return!1;var U=F.getImageData(0,0,1,1);return U&&U.width===R.width}()?(m[P=E&&E.failIfMajorPerformanceCaveat]===void 0&&(m[P]=function(R){var F=function(J){var et=document.createElement("canvas"),$=Object.create(d.webGLContextAttributes);return $.failIfMajorPerformanceCaveat=J,et.probablySupportsContext?et.probablySupportsContext("webgl",$)||et.probablySupportsContext("experimental-webgl",$):et.supportsContext?et.supportsContext("webgl",$)||et.supportsContext("experimental-webgl",$):et.getContext("webgl",$)||et.getContext("experimental-webgl",$)}(R);if(!F)return!1;var U=F.createShader(F.VERTEX_SHADER);return!(!U||F.isContextLost())&&(F.shaderSource(U,"void main() {}"),F.compileShader(U),F.getShaderParameter(U,F.COMPILE_STATUS)===!0)}(P)),m[P]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var P}c.exports?c.exports=d:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=d,window.mapboxgl.notSupportedReason=f);var m={};d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),h={create:function(c,d,f){var m=o.window.document.createElement(c);return d!==void 0&&(m.className=d),f&&f.appendChild(m),m},createNS:function(c,d){return o.window.document.createElementNS(c,d)}},A=o.window.document&&o.window.document.documentElement.style;function v(c){if(!A)return c[0];for(var d=0;d<c.length;d++)if(c[d]in A)return c[d];return c[0]}var C,S=v(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);h.disableDrag=function(){A&&S&&(C=A[S],A[S]="none")},h.enableDrag=function(){A&&S&&(A[S]=C)};var L=v(["transform","WebkitTransform"]);h.setTransform=function(c,d){c.style[L]=d};var N=!1;try{var G=Object.defineProperty({},"passive",{get:function(){N=!0}});o.window.addEventListener("test",G,G),o.window.removeEventListener("test",G,G)}catch{N=!1}h.addEventListener=function(c,d,f,m){m===void 0&&(m={}),c.addEventListener(d,f,"passive"in m&&N?m:m.capture)},h.removeEventListener=function(c,d,f,m){m===void 0&&(m={}),c.removeEventListener(d,f,"passive"in m&&N?m:m.capture)};var W=function(c){c.preventDefault(),c.stopPropagation(),o.window.removeEventListener("click",W,!0)};function j(c){var d=c.userImage;return!!(d&&d.render&&d.render())&&(c.data.replace(new Uint8Array(d.data.buffer)),!0)}h.suppressClick=function(){o.window.addEventListener("click",W,!0),o.window.setTimeout(function(){o.window.removeEventListener("click",W,!0)},0)},h.mousePos=function(c,d){var f=c.getBoundingClientRect();return new o.Point(d.clientX-f.left-c.clientLeft,d.clientY-f.top-c.clientTop)},h.touchPos=function(c,d){for(var f=c.getBoundingClientRect(),m=[],E=0;E<d.length;E++)m.push(new o.Point(d[E].clientX-f.left-c.clientLeft,d[E].clientY-f.top-c.clientTop));return m},h.mouseButton=function(c){return o.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button},h.remove=function(c){c.parentNode&&c.parentNode.removeChild(c)};var q=function(c){function d(){c.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.isLoaded=function(){return this.loaded},d.prototype.setLoaded=function(f){if(this.loaded!==f&&(this.loaded=f,f)){for(var m=0,E=this.requestors;m<E.length;m+=1){var P=E[m];this._notify(P.ids,P.callback)}this.requestors=[]}},d.prototype.getImage=function(f){return this.images[f]},d.prototype.addImage=function(f,m){this._validate(f,m)&&(this.images[f]=m)},d.prototype._validate=function(f,m){var E=!0;return this._validateStretch(m.stretchX,m.data&&m.data.width)||(this.fire(new o.ErrorEvent(new Error('Image "'+f+'" has invalid "stretchX" value'))),E=!1),this._validateStretch(m.stretchY,m.data&&m.data.height)||(this.fire(new o.ErrorEvent(new Error('Image "'+f+'" has invalid "stretchY" value'))),E=!1),this._validateContent(m.content,m)||(this.fire(new o.ErrorEvent(new Error('Image "'+f+'" has invalid "content" value'))),E=!1),E},d.prototype._validateStretch=function(f,m){if(!f)return!0;for(var E=0,P=0,R=f;P<R.length;P+=1){var F=R[P];if(F[0]<E||F[1]<F[0]||m<F[1])return!1;E=F[1]}return!0},d.prototype._validateContent=function(f,m){return!(f&&(f.length!==4||f[0]<0||m.data.width<f[0]||f[1]<0||m.data.height<f[1]||f[2]<0||m.data.width<f[2]||f[3]<0||m.data.height<f[3]||f[2]<f[0]||f[3]<f[1]))},d.prototype.updateImage=function(f,m){m.version=this.images[f].version+1,this.images[f]=m,this.updatedImages[f]=!0},d.prototype.removeImage=function(f){var m=this.images[f];delete this.images[f],delete this.patterns[f],m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()},d.prototype.listImages=function(){return Object.keys(this.images)},d.prototype.getImages=function(f,m){var E=!0;if(!this.isLoaded())for(var P=0,R=f;P<R.length;P+=1)this.images[R[P]]||(E=!1);this.isLoaded()||E?this._notify(f,m):this.requestors.push({ids:f,callback:m})},d.prototype._notify=function(f,m){for(var E={},P=0,R=f;P<R.length;P+=1){var F=R[P];this.images[F]||this.fire(new o.Event("styleimagemissing",{id:F}));var U=this.images[F];U?E[F]={data:U.data.clone(),pixelRatio:U.pixelRatio,sdf:U.sdf,version:U.version,stretchX:U.stretchX,stretchY:U.stretchY,content:U.content,hasRenderCallback:!!(U.userImage&&U.userImage.render)}:o.warnOnce('Image "'+F+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}m(null,E)},d.prototype.getPixelSize=function(){var f=this.atlasImage;return{width:f.width,height:f.height}},d.prototype.getPattern=function(f){var m=this.patterns[f],E=this.getImage(f);if(!E)return null;if(m&&m.position.version===E.version)return m.position;if(m)m.position.version=E.version;else{var P={w:E.data.width+2,h:E.data.height+2,x:0,y:0},R=new o.ImagePosition(P,E);this.patterns[f]={bin:P,position:R}}return this._updatePatternAtlas(),this.patterns[f].position},d.prototype.bind=function(f){var m=f.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(f,this.atlasImage,m.RGBA),this.atlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE)},d.prototype._updatePatternAtlas=function(){var f=[];for(var m in this.patterns)f.push(this.patterns[m].bin);var E=o.potpack(f),P=E.w,R=E.h,F=this.atlasImage;for(var U in F.resize({width:P||1,height:R||1}),this.patterns){var J=this.patterns[U].bin,et=J.x+1,$=J.y+1,it=this.images[U].data,st=it.width,xt=it.height;o.RGBAImage.copy(it,F,{x:0,y:0},{x:et,y:$},{width:st,height:xt}),o.RGBAImage.copy(it,F,{x:0,y:xt-1},{x:et,y:$-1},{width:st,height:1}),o.RGBAImage.copy(it,F,{x:0,y:0},{x:et,y:$+xt},{width:st,height:1}),o.RGBAImage.copy(it,F,{x:st-1,y:0},{x:et-1,y:$},{width:1,height:xt}),o.RGBAImage.copy(it,F,{x:0,y:0},{x:et+st,y:$},{width:1,height:xt})}this.dirty=!0},d.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},d.prototype.dispatchRenderCallbacks=function(f){for(var m=0,E=f;m<E.length;m+=1){var P=E[m];if(!this.callbackDispatchedThisFrame[P]){this.callbackDispatchedThisFrame[P]=!0;var R=this.images[P];j(R)&&this.updateImage(P,R)}}},d}(o.Evented),Z=rt,K=rt,ft=1e20;function rt(c,d,f,m,E,P){this.fontSize=c||24,this.buffer=d===void 0?3:d,this.cutoff=m||.25,this.fontFamily=E||"sans-serif",this.fontWeight=P||"normal",this.radius=f||8;var R=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=R,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.d=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Int16Array(R),this.middle=Math.round(R/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Lt(c,d,f,m,E,P,R){for(var F=0;F<d;F++){for(var U=0;U<f;U++)m[U]=c[U*d+F];for(Vt(m,E,P,R,f),U=0;U<f;U++)c[U*d+F]=E[U]}for(U=0;U<f;U++){for(F=0;F<d;F++)m[F]=c[U*d+F];for(Vt(m,E,P,R,d),F=0;F<d;F++)c[U*d+F]=Math.sqrt(E[F])}}function Vt(c,d,f,m,E){f[0]=0,m[0]=-1e20,m[1]=1e20;for(var P=1,R=0;P<E;P++){for(var F=(c[P]+P*P-(c[f[R]]+f[R]*f[R]))/(2*P-2*f[R]);F<=m[R];)R--,F=(c[P]+P*P-(c[f[R]]+f[R]*f[R]))/(2*P-2*f[R]);f[++R]=P,m[R]=F,m[R+1]=1e20}for(P=0,R=0;P<E;P++){for(;m[R+1]<P;)R++;d[P]=(P-f[R])*(P-f[R])+c[f[R]]}}rt.prototype.draw=function(c){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(c,this.buffer,this.middle);for(var d=this.ctx.getImageData(0,0,this.size,this.size),f=new Uint8ClampedArray(this.size*this.size),m=0;m<this.size*this.size;m++){var E=d.data[4*m+3]/255;this.gridOuter[m]=E===1?0:E===0?ft:Math.pow(Math.max(0,.5-E),2),this.gridInner[m]=E===1?ft:E===0?0:Math.pow(Math.max(0,E-.5),2)}for(Lt(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Lt(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),m=0;m<this.size*this.size;m++)f[m]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[m]-this.gridInner[m])/this.radius+this.cutoff))));return f},Z.default=K;var At=function(c,d){this.requestManager=c,this.localIdeographFontFamily=d,this.entries={}};At.prototype.setURL=function(c){this.url=c},At.prototype.getGlyphs=function(c,d){var f=this,m=[];for(var E in c)for(var P=0,R=c[E];P<R.length;P+=1)m.push({stack:E,id:R[P]});o.asyncAll(m,function(F,U){var J=F.stack,et=F.id,$=f.entries[J];$||($=f.entries[J]={glyphs:{},requests:{},ranges:{}});var it=$.glyphs[et];if(it===void 0){if(it=f._tinySDF($,J,et))return $.glyphs[et]=it,void U(null,{stack:J,id:et,glyph:it});var st=Math.floor(et/256);if(256*st>65535)U(new Error("glyphs > 65535 not supported"));else if($.ranges[st])U(null,{stack:J,id:et,glyph:it});else{var xt=$.requests[st];xt||(xt=$.requests[st]=[],At.loadGlyphRange(J,st,f.url,f.requestManager,function(Rt,yt){if(yt){for(var It in yt)f._doesCharSupportLocalGlyph(+It)||($.glyphs[+It]=yt[+It]);$.ranges[st]=!0}for(var Ht=0,Xt=xt;Ht<Xt.length;Ht+=1)(0,Xt[Ht])(Rt,yt);delete $.requests[st]})),xt.push(function(Rt,yt){Rt?U(Rt):yt&&U(null,{stack:J,id:et,glyph:yt[et]||null})})}}else U(null,{stack:J,id:et,glyph:it})},function(F,U){if(F)d(F);else if(U){for(var J={},et=0,$=U;et<$.length;et+=1){var it=$[et],st=it.stack,xt=it.id,Rt=it.glyph;(J[st]||(J[st]={}))[xt]=Rt&&{id:Rt.id,bitmap:Rt.bitmap.clone(),metrics:Rt.metrics}}d(null,J)}})},At.prototype._doesCharSupportLocalGlyph=function(c){return!!this.localIdeographFontFamily&&(o.isChar["CJK Unified Ideographs"](c)||o.isChar["Hangul Syllables"](c)||o.isChar.Hiragana(c)||o.isChar.Katakana(c))},At.prototype._tinySDF=function(c,d,f){var m=this.localIdeographFontFamily;if(m&&this._doesCharSupportLocalGlyph(f)){var E=c.tinySDF;if(!E){var P="400";/bold/i.test(d)?P="900":/medium/i.test(d)?P="500":/light/i.test(d)&&(P="200"),E=c.tinySDF=new At.TinySDF(24,3,8,.25,m,P)}return{id:f,bitmap:new o.AlphaImage({width:30,height:30},E.draw(String.fromCharCode(f))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},At.loadGlyphRange=function(c,d,f,m,E){var P=256*d,R=P+255,F=m.transformRequest(m.normalizeGlyphsURL(f).replace("{fontstack}",c).replace("{range}",P+"-"+R),o.ResourceType.Glyphs);o.getArrayBuffer(F,function(U,J){if(U)E(U);else if(J){for(var et={},$=0,it=o.parseGlyphPBF(J);$<it.length;$+=1){var st=it[$];et[st.id]=st}E(null,et)}})},At.TinySDF=Z;var at=function(){this.specification=o.styleSpec.light.position};at.prototype.possiblyEvaluate=function(c,d){return o.sphericalToCartesian(c.expression.evaluate(d))},at.prototype.interpolate=function(c,d,f){return{x:o.number(c.x,d.x,f),y:o.number(c.y,d.y,f),z:o.number(c.z,d.z,f)}};var kt=new o.Properties({anchor:new o.DataConstantProperty(o.styleSpec.light.anchor),position:new at,color:new o.DataConstantProperty(o.styleSpec.light.color),intensity:new o.DataConstantProperty(o.styleSpec.light.intensity)}),X=function(c){function d(f){c.call(this),this._transitionable=new o.Transitionable(kt),this.setLight(f),this._transitioning=this._transitionable.untransitioned()}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getLight=function(){return this._transitionable.serialize()},d.prototype.setLight=function(f,m){if(m===void 0&&(m={}),!this._validate(o.validateLight,f,m))for(var E in f){var P=f[E];o.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-11),P):this._transitionable.setValue(E,P)}},d.prototype.updateTransitions=function(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)},d.prototype.hasTransition=function(){return this._transitioning.hasTransition()},d.prototype.recalculate=function(f){this.properties=this._transitioning.possiblyEvaluate(f)},d.prototype._validate=function(f,m,E){return(!E||E.validate!==!1)&&o.emitValidationErrors(this,f.call(o.validateStyle,o.extend({value:m,style:{glyphs:!0,sprite:!0},styleSpec:o.styleSpec})))},d}(o.Evented),ht=function(c,d){this.width=c,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};ht.prototype.getDash=function(c,d){var f=c.join(",")+String(d);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(c,d)),this.dashEntry[f]},ht.prototype.getDashRanges=function(c,d,f){var m=[],E=c.length%2==1?-c[c.length-1]*f:0,P=c[0]*f,R=!0;m.push({left:E,right:P,isDash:R,zeroLength:c[0]===0});for(var F=c[0],U=1;U<c.length;U++){var J=c[U];m.push({left:E=F*f,right:P=(F+=J)*f,isDash:R=!R,zeroLength:J===0})}return m},ht.prototype.addRoundDash=function(c,d,f){for(var m=d/2,E=-f;E<=f;E++)for(var P=this.width*(this.nextRow+f+E),R=0,F=c[R],U=0;U<this.width;U++){U/F.right>1&&(F=c[++R]);var J=Math.abs(U-F.left),et=Math.abs(U-F.right),$=Math.min(J,et),it=void 0,st=E/f*(m+1);if(F.isDash){var xt=m-Math.abs(st);it=Math.sqrt($*$+xt*xt)}else it=m-Math.sqrt($*$+st*st);this.data[P+U]=Math.max(0,Math.min(255,it+128))}},ht.prototype.addRegularDash=function(c){for(var d=c.length-1;d>=0;--d){var f=c[d],m=c[d+1];f.zeroLength?c.splice(d,1):m&&m.isDash===f.isDash&&(m.left=f.left,c.splice(d,1))}var E=c[0],P=c[c.length-1];E.isDash===P.isDash&&(E.left=P.left-this.width,P.right=E.right+this.width);for(var R=this.width*this.nextRow,F=0,U=c[F],J=0;J<this.width;J++){J/U.right>1&&(U=c[++F]);var et=Math.abs(J-U.left),$=Math.abs(J-U.right),it=Math.min(et,$);this.data[R+J]=Math.max(0,Math.min(255,(U.isDash?it:-it)+128))}},ht.prototype.addDash=function(c,d){var f=d?7:0,m=2*f+1;if(this.nextRow+m>this.height)return o.warnOnce("LineAtlas out of space"),null;for(var E=0,P=0;P<c.length;P++)E+=c[P];if(E!==0){var R=this.width/E,F=this.getDashRanges(c,this.width,R);d?this.addRoundDash(F,R,f):this.addRegularDash(F)}var U={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:E};return this.nextRow+=m,this.dirty=!0,U},ht.prototype.bind=function(c){var d=c.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))};var Mt=function c(d,f){this.workerPool=d,this.actors=[],this.currentActor=0,this.id=o.uniqueId();for(var m=this.workerPool.acquire(this.id),E=0;E<m.length;E++){var P=new c.Actor(m[E],f,this.id);P.name="Worker "+E,this.actors.push(P)}};function pe(c,d,f){var m=function(E,P){if(E)return f(E);if(P){var R=o.pick(o.extend(P,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);P.vector_layers&&(R.vectorLayers=P.vector_layers,R.vectorLayerIds=R.vectorLayers.map(function(F){return F.id})),R.tiles=d.canonicalizeTileset(R,c.url),f(null,R)}};return c.url?o.getJSON(d.transformRequest(d.normalizeSourceURL(c.url),o.ResourceType.Source),m):o.browser.frame(function(){return m(null,c)})}Mt.prototype.broadcast=function(c,d,f){o.asyncAll(this.actors,function(m,E){m.send(c,d,E)},f=f||function(){})},Mt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Mt.prototype.remove=function(){this.actors.forEach(function(c){c.remove()}),this.actors=[],this.workerPool.release(this.id)},Mt.Actor=o.Actor;var Ct=function(c,d,f){this.bounds=o.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=d||0,this.maxzoom=f||24};Ct.prototype.validateBounds=function(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]},Ct.prototype.contains=function(c){var d=Math.pow(2,c.z),f=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*d),m=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*d),E=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*d),P=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*d);return c.x>=f&&c.x<E&&c.y>=m&&c.y<P};var Dt=function(c){function d(f,m,E,P){if(c.call(this),this.id=f,this.dispatcher=E,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(m,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},m),this._collectResourceTiming=m.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(P)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.load=function(){var f=this;this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=pe(this._options,this.map._requestManager,function(m,E){f._tileJSONRequest=null,f._loaded=!0,m?f.fire(new o.ErrorEvent(m)):E&&(o.extend(f,E),E.bounds&&(f.tileBounds=new Ct(E.bounds,f.minzoom,f.maxzoom)),o.postTurnstileEvent(E.tiles,f.map._requestManager._customAccessToken),o.postMapLoadEvent(E.tiles,f.map._getMapId(),f.map._requestManager._skuToken,f.map._requestManager._customAccessToken),f.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),f.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.hasTile=function(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)},d.prototype.onAdd=function(f){this.map=f,this.load()},d.prototype.setSourceProperty=function(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},d.prototype.setTiles=function(f){var m=this;return this.setSourceProperty(function(){m._options.tiles=f}),this},d.prototype.setUrl=function(f){var m=this;return this.setSourceProperty(function(){m.url=f,m._options.url=f}),this},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return o.extend({},this._options)},d.prototype.loadTile=function(f,m){var E=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),P={request:this.map._requestManager.transformRequest(E,o.ResourceType.Tile),uid:f.uid,tileID:f.tileID,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function R(F,U){return delete f.request,f.aborted?m(null):F&&F.status!==404?m(F):(U&&U.resourceTiming&&(f.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&f.setExpiryData(U),f.loadVectorData(U,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),m(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}P.request.collectResourceTiming=this._collectResourceTiming,f.actor&&f.state!=="expired"?f.state==="loading"?f.reloadCallback=m:f.request=f.actor.send("reloadTile",P,R.bind(this)):(f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",P,R.bind(this)))},d.prototype.abortTile=function(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id},void 0)},d.prototype.unloadTile=function(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id},void 0)},d.prototype.hasTransition=function(){return!1},d}(o.Evented),Gt=function(c){function d(f,m,E,P){c.call(this),this.id=f,this.dispatcher=E,this.setEventedParent(P),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},m),o.extend(this,o.pick(m,["url","scheme","tileSize"]))}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.load=function(){var f=this;this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=pe(this._options,this.map._requestManager,function(m,E){f._tileJSONRequest=null,f._loaded=!0,m?f.fire(new o.ErrorEvent(m)):E&&(o.extend(f,E),E.bounds&&(f.tileBounds=new Ct(E.bounds,f.minzoom,f.maxzoom)),o.postTurnstileEvent(E.tiles),o.postMapLoadEvent(E.tiles,f.map._getMapId(),f.map._requestManager._skuToken),f.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),f.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.onAdd=function(f){this.map=f,this.load()},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return o.extend({},this._options)},d.prototype.hasTile=function(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)},d.prototype.loadTile=function(f,m){var E=this,P=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);f.request=o.getImage(this.map._requestManager.transformRequest(P,o.ResourceType.Tile),function(R,F){if(delete f.request,f.aborted)f.state="unloaded",m(null);else if(R)f.state="errored",m(R);else if(F){E.map._refreshExpiredTiles&&f.setExpiryData(F),delete F.cacheControl,delete F.expires;var U=E.map.painter.context,J=U.gl;f.texture=E.map.painter.getTileTexture(F.width),f.texture?f.texture.update(F,{useMipmap:!0}):(f.texture=new o.Texture(U,F,J.RGBA,{useMipmap:!0}),f.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST),U.extTextureFilterAnisotropic&&J.texParameterf(J.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax)),f.state="loaded",o.cacheEntryPossiblyAdded(E.dispatcher),m(null)}})},d.prototype.abortTile=function(f,m){f.request&&(f.request.cancel(),delete f.request),m()},d.prototype.unloadTile=function(f,m){f.texture&&this.map.painter.saveTileTexture(f.texture),m()},d.prototype.hasTransition=function(){return!1},d}(o.Evented),te=function(c){function d(f,m,E,P){c.call(this,f,m,E,P),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},m),this.encoding=m.encoding||"mapbox"}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},d.prototype.loadTile=function(f,m){var E=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function P(R,F){R&&(f.state="errored",m(R)),F&&(f.dem=F,f.needsHillshadePrepare=!0,f.state="loaded",m(null))}f.request=o.getImage(this.map._requestManager.transformRequest(E,o.ResourceType.Tile),(function(R,F){if(delete f.request,f.aborted)f.state="unloaded",m(null);else if(R)f.state="errored",m(R);else if(F){this.map._refreshExpiredTiles&&f.setExpiryData(F),delete F.cacheControl,delete F.expires;var U=o.window.ImageBitmap&&F instanceof o.window.ImageBitmap&&o.offscreenCanvasSupported()?F:o.browser.getImageData(F,1),J={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:U,encoding:this.encoding};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",J,P.bind(this)))}}).bind(this)),f.neighboringTiles=this._getNeighboringTiles(f.tileID)},d.prototype._getNeighboringTiles=function(f){var m=f.canonical,E=Math.pow(2,m.z),P=(m.x-1+E)%E,R=m.x===0?f.wrap-1:f.wrap,F=(m.x+1+E)%E,U=m.x+1===E?f.wrap+1:f.wrap,J={};return J[new o.OverscaledTileID(f.overscaledZ,R,m.z,P,m.y).key]={backfilled:!1},J[new o.OverscaledTileID(f.overscaledZ,U,m.z,F,m.y).key]={backfilled:!1},m.y>0&&(J[new o.OverscaledTileID(f.overscaledZ,R,m.z,P,m.y-1).key]={backfilled:!1},J[new o.OverscaledTileID(f.overscaledZ,f.wrap,m.z,m.x,m.y-1).key]={backfilled:!1},J[new o.OverscaledTileID(f.overscaledZ,U,m.z,F,m.y-1).key]={backfilled:!1}),m.y+1<E&&(J[new o.OverscaledTileID(f.overscaledZ,R,m.z,P,m.y+1).key]={backfilled:!1},J[new o.OverscaledTileID(f.overscaledZ,f.wrap,m.z,m.x,m.y+1).key]={backfilled:!1},J[new o.OverscaledTileID(f.overscaledZ,U,m.z,F,m.y+1).key]={backfilled:!1}),J},d.prototype.unloadTile=function(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded",f.actor&&f.actor.send("removeDEMTile",{uid:f.uid,source:this.id})},d}(Gt),re=function(c){function d(f,m,E,P){c.call(this),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(P),this._data=m.data,this._options=o.extend({},m),this._collectResourceTiming=m.collectResourceTiming,this._resourceTiming=[],m.maxzoom!==void 0&&(this.maxzoom=m.maxzoom),m.type&&(this.type=m.type),m.attribution&&(this.attribution=m.attribution),this.promoteId=m.promoteId;var R=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:m.cluster||!1,geojsonVtOptions:{buffer:(m.buffer!==void 0?m.buffer:128)*R,tolerance:(m.tolerance!==void 0?m.tolerance:.375)*R,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:m.lineMetrics||!1,generateId:m.generateId||!1},superclusterOptions:{maxZoom:m.clusterMaxZoom!==void 0?Math.min(m.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,m.clusterMinPoints||2),extent:o.EXTENT,radius:(m.clusterRadius||50)*R,log:!1,generateId:m.generateId||!1},clusterProperties:m.clusterProperties,filter:m.filter},m.workerOptions)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.load=function(){var f=this;this.fire(new o.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(m){if(m)f.fire(new o.ErrorEvent(m));else{var E={dataType:"source",sourceDataType:"metadata"};f._collectResourceTiming&&f._resourceTiming&&f._resourceTiming.length>0&&(E.resourceTiming=f._resourceTiming,f._resourceTiming=[]),f.fire(new o.Event("data",E))}})},d.prototype.onAdd=function(f){this.map=f,this.load()},d.prototype.setData=function(f){var m=this;return this._data=f,this.fire(new o.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(E){if(E)m.fire(new o.ErrorEvent(E));else{var P={dataType:"source",sourceDataType:"content"};m._collectResourceTiming&&m._resourceTiming&&m._resourceTiming.length>0&&(P.resourceTiming=m._resourceTiming,m._resourceTiming=[]),m.fire(new o.Event("data",P))}}),this},d.prototype.getClusterExpansionZoom=function(f,m){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},m),this},d.prototype.getClusterChildren=function(f,m){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},m),this},d.prototype.getClusterLeaves=function(f,m,E,P){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:m,offset:E},P),this},d.prototype._updateWorkerData=function(f){var m=this;this._loaded=!1;var E=o.extend({},this.workerOptions),P=this._data;typeof P=="string"?(E.request=this.map._requestManager.transformRequest(o.browser.resolveURL(P),o.ResourceType.Source),E.request.collectResourceTiming=this._collectResourceTiming):E.data=JSON.stringify(P),this.actor.send(this.type+".loadData",E,function(R,F){m._removed||F&&F.abandoned||(m._loaded=!0,F&&F.resourceTiming&&F.resourceTiming[m.id]&&(m._resourceTiming=F.resourceTiming[m.id].slice(0)),m.actor.send(m.type+".coalesce",{source:E.source},null),f(R))})},d.prototype.loaded=function(){return this._loaded},d.prototype.loadTile=function(f,m){var E=this,P=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(P,{type:this.type,uid:f.uid,tileID:f.tileID,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(R,F){return delete f.request,f.unloadVectorData(),f.aborted?m(null):R?m(R):(f.loadVectorData(F,E.map.painter,P==="reloadTile"),m(null))})},d.prototype.abortTile=function(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0},d.prototype.unloadTile=function(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})},d.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},d.prototype.serialize=function(){return o.extend({},this._options,{type:this.type,data:this._data})},d.prototype.hasTransition=function(){return!1},d}(o.Evented),ae=o.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),he=function(c){function d(f,m,E,P){c.call(this),this.id=f,this.dispatcher=E,this.coordinates=m.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(P),this.options=m}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.load=function(f,m){var E=this;this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),function(P,R){E._loaded=!0,P?E.fire(new o.ErrorEvent(P)):R&&(E.image=R,f&&(E.coordinates=f),m&&m(),E._finishLoading())})},d.prototype.loaded=function(){return this._loaded},d.prototype.updateImage=function(f){var m=this;return this.image&&f.url?(this.options.url=f.url,this.load(f.coordinates,function(){m.texture=null}),this):this},d.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))},d.prototype.onAdd=function(f){this.map=f,this.load()},d.prototype.setCoordinates=function(f){var m=this;this.coordinates=f;var E=f.map(o.MercatorCoordinate.fromLngLat);this.tileID=function(R){for(var F=1/0,U=1/0,J=-1/0,et=-1/0,$=0,it=R;$<it.length;$+=1){var st=it[$];F=Math.min(F,st.x),U=Math.min(U,st.y),J=Math.max(J,st.x),et=Math.max(et,st.y)}var xt=Math.max(J-F,et-U),Rt=Math.max(0,Math.floor(-Math.log(xt)/Math.LN2)),yt=Math.pow(2,Rt);return new o.CanonicalTileID(Rt,Math.floor((F+J)/2*yt),Math.floor((U+et)/2*yt))}(E),this.minzoom=this.maxzoom=this.tileID.z;var P=E.map(function(R){return m.tileID.getTilePoint(R)._round()});return this._boundsArray=new o.StructArrayLayout4i8,this._boundsArray.emplaceBack(P[0].x,P[0].y,0,0),this._boundsArray.emplaceBack(P[1].x,P[1].y,o.EXTENT,0),this._boundsArray.emplaceBack(P[3].x,P[3].y,0,o.EXTENT),this._boundsArray.emplaceBack(P[2].x,P[2].y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this},d.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var f=this.map.painter.context,m=f.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,ae.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new o.Texture(f,this.image,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this.tiles){var P=this.tiles[E];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},d.prototype.loadTile=function(f,m){this.tileID&&this.tileID.equals(f.tileID.canonical)?(this.tiles[String(f.tileID.wrap)]=f,f.buckets={},m(null)):(f.state="errored",m(null))},d.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return!1},d}(o.Evented),Pe=function(c){function d(f,m,E,P){c.call(this,f,m,E,P),this.roundZoom=!0,this.type="video",this.options=m}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.load=function(){var f=this;this._loaded=!1;var m=this.options;this.urls=[];for(var E=0,P=m.urls;E<P.length;E+=1)this.urls.push(this.map._requestManager.transformRequest(P[E],o.ResourceType.Source).url);o.getVideo(this.urls,function(R,F){f._loaded=!0,R?f.fire(new o.ErrorEvent(R)):F&&(f.video=F,f.video.loop=!0,f.video.setAttribute("playsinline",""),f.video.addEventListener("playing",function(){f.map.triggerRepaint()}),f.map&&f.video.play(),f._finishLoading())})},d.prototype.pause=function(){this.video&&this.video.pause()},d.prototype.play=function(){this.video&&this.video.play()},d.prototype.seek=function(f){if(this.video){var m=this.video.seekable;f<m.start(0)||f>m.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+m.start(0)+" and "+m.end(0)+"-second mark."))):this.video.currentTime=f}},d.prototype.getVideo=function(){return this.video},d.prototype.onAdd=function(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},d.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var f=this.map.painter.context,m=f.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,ae.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE),m.texSubImage2D(m.TEXTURE_2D,0,0,0,m.RGBA,m.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(f,this.video,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this.tiles){var P=this.tiles[E];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this.video&&!this.video.paused},d}(he),Se=function(c){function d(f,m,E,P){c.call(this,f,m,E,P),m.coordinates?Array.isArray(m.coordinates)&&m.coordinates.length===4&&!m.coordinates.some(function(R){return!Array.isArray(R)||R.length!==2||R.some(function(F){return typeof F!="number"})})||this.fire(new o.ErrorEvent(new o.ValidationError("sources."+f,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError("sources."+f,null,'missing required property "coordinates"'))),m.animate&&typeof m.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError("sources."+f,null,'optional "animate" property must be a boolean value'))),m.canvas?typeof m.canvas=="string"||m.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError("sources."+f,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError("sources."+f,null,'missing required property "canvas"'))),this.options=m,this.animate=m.animate===void 0||m.animate}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},d.prototype.getCanvas=function(){return this.canvas},d.prototype.onAdd=function(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()},d.prototype.onRemove=function(){this.pause()},d.prototype.prepare=function(){var f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var m=this.map.painter.context,E=m.gl;for(var P in this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,ae.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(m,this.canvas,E.RGBA,{premultiply:!0}),this.tiles){var R=this.tiles[P];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this._playing},d.prototype._hasInvalidDimensions=function(){for(var f=0,m=[this.canvas.width,this.canvas.height];f<m.length;f+=1){var E=m[f];if(isNaN(E)||E<=0)return!0}return!1},d}(he),se={vector:Dt,raster:Gt,"raster-dem":te,geojson:re,video:Pe,image:he,canvas:Se};function fi(c,d){var f=o.identity([]);return o.translate(f,f,[1,1,0]),o.scale(f,f,[.5*c.width,.5*c.height,1]),o.multiply(f,f,c.calculatePosMatrix(d.toUnwrapped()))}function Ze(c,d,f,m,E,P){var R=function(Rt,yt,It){if(Rt)for(var Ht=0,Xt=Rt;Ht<Xt.length;Ht+=1){var ee=yt[Xt[Ht]];if(ee&&ee.source===It&&ee.type==="fill-extrusion")return!0}else for(var Qt in yt){var $t=yt[Qt];if($t.source===It&&$t.type==="fill-extrusion")return!0}return!1}(E&&E.layers,d,c.id),F=P.maxPitchScaleFactor(),U=c.tilesIn(m,F,R);U.sort(Ye);for(var J=[],et=0,$=U;et<$.length;et+=1){var it=$[et];J.push({wrappedTileID:it.tileID.wrapped().key,queryResults:it.tile.queryRenderedFeatures(d,f,c._state,it.queryGeometry,it.cameraQueryGeometry,it.scale,E,P,F,fi(c.transform,it.tileID))})}var st=function(Rt){for(var yt={},It={},Ht=0,Xt=Rt;Ht<Xt.length;Ht+=1){var ee=Xt[Ht],Qt=ee.queryResults,$t=ee.wrappedTileID,Ae=It[$t]=It[$t]||{};for(var Le in Qt)for(var we=Qt[Le],Ge=Ae[Le]=Ae[Le]||{},si=yt[Le]=yt[Le]||[],Ci=0,Ti=we;Ci<Ti.length;Ci+=1){var xn=Ti[Ci];Ge[xn.featureIndex]||(Ge[xn.featureIndex]=!0,si.push(xn))}}return yt}(J);for(var xt in st)st[xt].forEach(function(Rt){var yt=Rt.feature,It=c.getFeatureState(yt.layer["source-layer"],yt.id);yt.source=yt.layer.source,yt.layer["source-layer"]&&(yt.sourceLayer=yt.layer["source-layer"]),yt.state=It});return st}function Ye(c,d){var f=c.tileID,m=d.tileID;return f.overscaledZ-m.overscaledZ||f.canonical.y-m.canonical.y||f.wrap-m.wrap||f.canonical.x-m.canonical.x}var ze=function(c,d){this.max=c,this.onRemove=d,this.reset()};ze.prototype.reset=function(){for(var c in this.data)for(var d=0,f=this.data[c];d<f.length;d+=1){var m=f[d];m.timeout&&clearTimeout(m.timeout),this.onRemove(m.value)}return this.data={},this.order=[],this},ze.prototype.add=function(c,d,f){var m=this,E=c.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);var P={value:d,timeout:void 0};if(f!==void 0&&(P.timeout=setTimeout(function(){m.remove(c,P)},f)),this.data[E].push(P),this.order.push(E),this.order.length>this.max){var R=this._getAndRemoveByKey(this.order[0]);R&&this.onRemove(R)}return this},ze.prototype.has=function(c){return c.wrapped().key in this.data},ze.prototype.getAndRemove=function(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null},ze.prototype._getAndRemoveByKey=function(c){var d=this.data[c].shift();return d.timeout&&clearTimeout(d.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),d.value},ze.prototype.getByKey=function(c){var d=this.data[c];return d?d[0].value:null},ze.prototype.get=function(c){return this.has(c)?this.data[c.wrapped().key][0].value:null},ze.prototype.remove=function(c,d){if(!this.has(c))return this;var f=c.wrapped().key,m=d===void 0?0:this.data[f].indexOf(d),E=this.data[f][m];return this.data[f].splice(m,1),E.timeout&&clearTimeout(E.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(E.value),this.order.splice(this.order.indexOf(f),1),this},ze.prototype.setMaxSize=function(c){for(this.max=c;this.order.length>this.max;){var d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this},ze.prototype.filter=function(c){var d=[];for(var f in this.data)for(var m=0,E=this.data[f];m<E.length;m+=1){var P=E[m];c(P.value)||d.push(P)}for(var R=0,F=d;R<F.length;R+=1){var U=F[R];this.remove(U.value.tileID,U)}};var pi=function(c,d,f){this.context=c;var m=c.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};pi.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},pi.prototype.updateData=function(c){var d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)},pi.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var sn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Ii=function(c,d,f,m){this.length=d.length,this.attributes=f,this.itemSize=d.bytesPerElement,this.dynamicDraw=m,this.context=c;var E=c.gl;this.buffer=E.createBuffer(),c.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};Ii.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Ii.prototype.updateData=function(c){var d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,c.arrayBuffer)},Ii.prototype.enableAttributes=function(c,d){for(var f=0;f<this.attributes.length;f++){var m=d.attributes[this.attributes[f].name];m!==void 0&&c.enableVertexAttribArray(m)}},Ii.prototype.setVertexAttribPointers=function(c,d,f){for(var m=0;m<this.attributes.length;m++){var E=this.attributes[m],P=d.attributes[E.name];P!==void 0&&c.vertexAttribPointer(P,E.components,c[sn[E.type]],!1,this.itemSize,E.offset+this.itemSize*(f||0))}},Ii.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var _i=function(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};_i.prototype.get=function(){return this.current},_i.prototype.set=function(c){},_i.prototype.getDefault=function(){return this.default},_i.prototype.setDefault=function(){this.set(this.default)};var Fn=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return o.Color.transparent},d.prototype.set=function(f){var m=this.current;(f.r!==m.r||f.g!==m.g||f.b!==m.b||f.a!==m.a||this.dirty)&&(this.gl.clearColor(f.r,f.g,f.b,f.a),this.current=f,this.dirty=!1)},d}(_i),Ai=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return 1},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.clearDepth(f),this.current=f,this.dirty=!1)},d}(_i),vi=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return 0},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.clearStencil(f),this.current=f,this.dirty=!1)},d}(_i),cn=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return[!0,!0,!0,!0]},d.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||f[2]!==m[2]||f[3]!==m[3]||this.dirty)&&(this.gl.colorMask(f[0],f[1],f[2],f[3]),this.current=f,this.dirty=!1)},d}(_i),Ri=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return!0},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.depthMask(f),this.current=f,this.dirty=!1)},d}(_i),ur=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return 255},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.stencilMask(f),this.current=f,this.dirty=!1)},d}(_i),$n=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},d.prototype.set=function(f){var m=this.current;(f.func!==m.func||f.ref!==m.ref||f.mask!==m.mask||this.dirty)&&(this.gl.stencilFunc(f.func,f.ref,f.mask),this.current=f,this.dirty=!1)},d}(_i),gn=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){var f=this.gl;return[f.KEEP,f.KEEP,f.KEEP]},d.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||f[2]!==m[2]||this.dirty)&&(this.gl.stencilOp(f[0],f[1],f[2]),this.current=f,this.dirty=!1)},d}(_i),rr=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.STENCIL_TEST):m.disable(m.STENCIL_TEST),this.current=f,this.dirty=!1}},d}(_i),Wn=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return[0,1]},d.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||this.dirty)&&(this.gl.depthRange(f[0],f[1]),this.current=f,this.dirty=!1)},d}(_i),Tn=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST),this.current=f,this.dirty=!1}},d}(_i),tr=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.LESS},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.depthFunc(f),this.current=f,this.dirty=!1)},d}(_i),je=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.BLEND):m.disable(m.BLEND),this.current=f,this.dirty=!1}},d}(_i),mi=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){var f=this.gl;return[f.ONE,f.ZERO]},d.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||this.dirty)&&(this.gl.blendFunc(f[0],f[1]),this.current=f,this.dirty=!1)},d}(_i),Mi=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return o.Color.transparent},d.prototype.set=function(f){var m=this.current;(f.r!==m.r||f.g!==m.g||f.b!==m.b||f.a!==m.a||this.dirty)&&(this.gl.blendColor(f.r,f.g,f.b,f.a),this.current=f,this.dirty=!1)},d}(_i),nn=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.FUNC_ADD},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.blendEquation(f),this.current=f,this.dirty=!1)},d}(_i),_r=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.CULL_FACE):m.disable(m.CULL_FACE),this.current=f,this.dirty=!1}},d}(_i),St=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.BACK},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.cullFace(f),this.current=f,this.dirty=!1)},d}(_i),Ne=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.CCW},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.frontFace(f),this.current=f,this.dirty=!1)},d}(_i),Xe=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)},d}(_i),ci=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.TEXTURE0},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.activeTexture(f),this.current=f,this.dirty=!1)},d}(_i),qt=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){var f=this.gl;return[0,0,f.drawingBufferWidth,f.drawingBufferHeight]},d.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||f[2]!==m[2]||f[3]!==m[3]||this.dirty)&&(this.gl.viewport(f[0],f[1],f[2],f[3]),this.current=f,this.dirty=!1)},d}(_i),De=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindFramebuffer(m.FRAMEBUFFER,f),this.current=f,this.dirty=!1}},d}(_i),mt=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindRenderbuffer(m.RENDERBUFFER,f),this.current=f,this.dirty=!1}},d}(_i),Ve=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindTexture(m.TEXTURE_2D,f),this.current=f,this.dirty=!1}},d}(_i),Ce=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindBuffer(m.ARRAY_BUFFER,f),this.current=f,this.dirty=!1}},d}(_i),H=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(f){var m=this.gl;m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,f),this.current=f,this.dirty=!1},d}(_i),ve=function(c){function d(f){c.call(this,f),this.vao=f.extVertexArrayObject}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(f){this.vao&&(f!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(f),this.current=f,this.dirty=!1)},d}(_i),Te=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return 4},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_ALIGNMENT,f),this.current=f,this.dirty=!1}},d}(_i),wt=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),this.current=f,this.dirty=!1}},d}(_i),Kt=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,f),this.current=f,this.dirty=!1}},d}(_i),ce=function(c){function d(f,m){c.call(this,f),this.context=f,this.parent=m}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d}(_i),Y=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.setDirty=function(){this.dirty=!0},d.prototype.set=function(f){if(f!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var m=this.gl;m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,f,0),this.current=f,this.dirty=!1}},d}(ce),nt=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.set=function(f){if(f!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var m=this.gl;m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,f),this.current=f,this.dirty=!1}},d}(ce),ct=function(c,d,f,m){this.context=c,this.width=d,this.height=f;var E=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new Y(c,E),m&&(this.depthAttachment=new nt(c,E))};ct.prototype.destroy=function(){var c=this.context.gl,d=this.colorAttachment.get();if(d&&c.deleteTexture(d),this.depthAttachment){var f=this.depthAttachment.get();f&&c.deleteRenderbuffer(f)}c.deleteFramebuffer(this.framebuffer)};var vt=function(c,d,f){this.func=c,this.mask=d,this.range=f};vt.ReadOnly=!1,vt.ReadWrite=!0,vt.disabled=new vt(519,vt.ReadOnly,[0,1]);var Ft=function(c,d,f,m,E,P){this.test=c,this.ref=d,this.mask=f,this.fail=m,this.depthFail=E,this.pass=P};Ft.disabled=new Ft({func:519,mask:0},0,0,7680,7680,7680);var pt=function(c,d,f){this.blendFunction=c,this.blendColor=d,this.mask=f};pt.disabled=new pt(pt.Replace=[1,0],o.Color.transparent,[!1,!1,!1,!1]),pt.unblended=new pt(pt.Replace,o.Color.transparent,[!0,!0,!0,!0]),pt.alphaBlended=new pt([1,771],o.Color.transparent,[!0,!0,!0,!0]);var bt=function(c,d,f){this.enable=c,this.mode=d,this.frontFace=f};bt.disabled=new bt(!1,1029,2305),bt.backCCW=new bt(!0,1029,2305);var lt=function(c){this.gl=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Fn(this),this.clearDepth=new Ai(this),this.clearStencil=new vi(this),this.colorMask=new cn(this),this.depthMask=new Ri(this),this.stencilMask=new ur(this),this.stencilFunc=new $n(this),this.stencilOp=new gn(this),this.stencilTest=new rr(this),this.depthRange=new Wn(this),this.depthTest=new Tn(this),this.depthFunc=new tr(this),this.blend=new je(this),this.blendFunc=new mi(this),this.blendColor=new Mi(this),this.blendEquation=new nn(this),this.cullFace=new _r(this),this.cullFaceSide=new St(this),this.frontFace=new Ne(this),this.program=new Xe(this),this.activeTexture=new ci(this),this.viewport=new qt(this),this.bindFramebuffer=new De(this),this.bindRenderbuffer=new mt(this),this.bindTexture=new Ve(this),this.bindVertexBuffer=new Ce(this),this.bindElementBuffer=new H(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ve(this),this.pixelStoreUnpack=new Te(this),this.pixelStoreUnpackPremultiplyAlpha=new wt(this),this.pixelStoreUnpackFlipY=new Kt(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=c.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(c.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)};lt.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},lt.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},lt.prototype.createIndexBuffer=function(c,d){return new pi(this,c,d)},lt.prototype.createVertexBuffer=function(c,d,f){return new Ii(this,c,d,f)},lt.prototype.createRenderbuffer=function(c,d,f){var m=this.gl,E=m.createRenderbuffer();return this.bindRenderbuffer.set(E),m.renderbufferStorage(m.RENDERBUFFER,c,d,f),this.bindRenderbuffer.set(null),E},lt.prototype.createFramebuffer=function(c,d,f){return new ct(this,c,d,f)},lt.prototype.clear=function(c){var d=c.color,f=c.depth,m=this.gl,E=0;d&&(E|=m.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(E|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),m.clear(E)},lt.prototype.setCullFace=function(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))},lt.prototype.setDepthMode=function(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)},lt.prototype.setStencilMode=function(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)},lt.prototype.setColorMode=function(c){o.deepEqual(c.blendFunction,pt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)},lt.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Et=function(c){function d(f,m,E){var P=this;c.call(this),this.id=f,this.dispatcher=E,this.on("data",function(R){R.dataType==="source"&&R.sourceDataType==="metadata"&&(P._sourceLoaded=!0),P._sourceLoaded&&!P._paused&&R.dataType==="source"&&R.sourceDataType==="content"&&(P.reload(),P.transform&&P.update(P.transform))}),this.on("error",function(){P._sourceErrored=!0}),this._source=function(R,F,U,J){var et=new se[F.type](R,F,U,J);if(et.id!==R)throw new Error("Expected Source id to be "+R+" instead of "+et.id);return o.bindAll(["load","abort","unload","serialize","prepare"],et),et}(f,m,E,this),this._tiles={},this._cache=new ze(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new o.SourceFeatureState}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.onAdd=function(f){this.map=f,this._maxTileCacheSize=f?f._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(f)},d.prototype.onRemove=function(f){this._source&&this._source.onRemove&&this._source.onRemove(f)},d.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var f in this._tiles){var m=this._tiles[f];if(m.state!=="loaded"&&m.state!=="errored")return!1}return!0},d.prototype.getSource=function(){return this._source},d.prototype.pause=function(){this._paused=!0},d.prototype.resume=function(){if(this._paused){var f=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,f&&this.reload(),this.transform&&this.update(this.transform)}},d.prototype._loadTile=function(f,m){return this._source.loadTile(f,m)},d.prototype._unloadTile=function(f){if(this._source.unloadTile)return this._source.unloadTile(f,function(){})},d.prototype._abortTile=function(f){if(this._source.abortTile)return this._source.abortTile(f,function(){})},d.prototype.serialize=function(){return this._source.serialize()},d.prototype.prepare=function(f){for(var m in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var E=this._tiles[m];E.upload(f),E.prepare(this.map.style.imageManager)}},d.prototype.getIds=function(){return o.values(this._tiles).map(function(f){return f.tileID}).sort(g).map(function(f){return f.key})},d.prototype.getRenderableIds=function(f){var m=this,E=[];for(var P in this._tiles)this._isIdRenderable(P,f)&&E.push(this._tiles[P]);return f?E.sort(function(R,F){var U=R.tileID,J=F.tileID,et=new o.Point(U.canonical.x,U.canonical.y)._rotate(m.transform.angle),$=new o.Point(J.canonical.x,J.canonical.y)._rotate(m.transform.angle);return U.overscaledZ-J.overscaledZ||$.y-et.y||$.x-et.x}).map(function(R){return R.tileID.key}):E.map(function(R){return R.tileID}).sort(g).map(function(R){return R.key})},d.prototype.hasRenderableParent=function(f){var m=this.findLoadedParent(f,0);return!!m&&this._isIdRenderable(m.tileID.key)},d.prototype._isIdRenderable=function(f,m){return this._tiles[f]&&this._tiles[f].hasData()&&!this._coveredTiles[f]&&(m||!this._tiles[f].holdingForFade())},d.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var f in this._cache.reset(),this._tiles)this._tiles[f].state!=="errored"&&this._reloadTile(f,"reloading")},d.prototype._reloadTile=function(f,m){var E=this._tiles[f];E&&(E.state!=="loading"&&(E.state=m),this._loadTile(E,this._tileLoaded.bind(this,E,f,m)))},d.prototype._tileLoaded=function(f,m,E,P){if(P)return f.state="errored",void(P.status!==404?this._source.fire(new o.ErrorEvent(P,{tile:f})):this.update(this.transform));f.timeAdded=o.browser.now(),E==="expired"&&(f.refreshedUponExpiration=!0),this._setTileReloadTimer(m,f),this.getSource().type==="raster-dem"&&f.dem&&this._backfillDEM(f),this._state.initializeTileState(f,this.map?this.map.painter:null),this._source.fire(new o.Event("data",{dataType:"source",tile:f,coord:f.tileID}))},d.prototype._backfillDEM=function(f){for(var m=this.getRenderableIds(),E=0;E<m.length;E++){var P=m[E];if(f.neighboringTiles&&f.neighboringTiles[P]){var R=this.getTileByID(P);F(f,R),F(R,f)}}function F(U,J){U.needsHillshadePrepare=!0;var et=J.tileID.canonical.x-U.tileID.canonical.x,$=J.tileID.canonical.y-U.tileID.canonical.y,it=Math.pow(2,U.tileID.canonical.z),st=J.tileID.key;et===0&&$===0||Math.abs($)>1||(Math.abs(et)>1&&(Math.abs(et+it)===1?et+=it:Math.abs(et-it)===1&&(et-=it)),J.dem&&U.dem&&(U.dem.backfillBorder(J.dem,et,$),U.neighboringTiles&&U.neighboringTiles[st]&&(U.neighboringTiles[st].backfilled=!0)))}},d.prototype.getTile=function(f){return this.getTileByID(f.key)},d.prototype.getTileByID=function(f){return this._tiles[f]},d.prototype._retainLoadedChildren=function(f,m,E,P){for(var R in this._tiles){var F=this._tiles[R];if(!(P[R]||!F.hasData()||F.tileID.overscaledZ<=m||F.tileID.overscaledZ>E)){for(var U=F.tileID;F&&F.tileID.overscaledZ>m+1;){var J=F.tileID.scaledTo(F.tileID.overscaledZ-1);(F=this._tiles[J.key])&&F.hasData()&&(U=J)}for(var et=U;et.overscaledZ>m;)if(f[(et=et.scaledTo(et.overscaledZ-1)).key]){P[U.key]=U;break}}}},d.prototype.findLoadedParent=function(f,m){if(f.key in this._loadedParentTiles){var E=this._loadedParentTiles[f.key];return E&&E.tileID.overscaledZ>=m?E:null}for(var P=f.overscaledZ-1;P>=m;P--){var R=f.scaledTo(P),F=this._getLoadedTile(R);if(F)return F}},d.prototype._getLoadedTile=function(f){var m=this._tiles[f.key];return m&&m.hasData()?m:this._cache.getByKey(f.wrapped().key)},d.prototype.updateCacheSize=function(f){var m=Math.ceil(f.width/this._source.tileSize)+1,E=Math.ceil(f.height/this._source.tileSize)+1,P=Math.floor(m*E*5),R=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,P):P;this._cache.setMaxSize(R)},d.prototype.handleWrapJump=function(f){var m=Math.round((f-(this._prevLng===void 0?f:this._prevLng))/360);if(this._prevLng=f,m){var E={};for(var P in this._tiles){var R=this._tiles[P];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+m),E[R.tileID.key]=R}for(var F in this._tiles=E,this._timers)clearTimeout(this._timers[F]),delete this._timers[F];for(var U in this._tiles)this._setTileReloadTimer(U,this._tiles[U])}},d.prototype.update=function(f){var m=this;if(this.transform=f,this._sourceLoaded&&!this._paused){var E;this.updateCacheSize(f),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?E=f.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Ae){return new o.OverscaledTileID(Ae.canonical.z,Ae.wrap,Ae.canonical.z,Ae.canonical.x,Ae.canonical.y)}):(E=f.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(E=E.filter(function(Ae){return m._source.hasTile(Ae)}))):E=[];var P=f.coveringZoomLevel(this._source),R=Math.max(P-d.maxOverzooming,this._source.minzoom),F=Math.max(P+d.maxUnderzooming,this._source.minzoom),U=this._updateRetainedTiles(E,P);if(ut(this._source.type)){for(var J={},et={},$=0,it=Object.keys(U);$<it.length;$+=1){var st=it[$],xt=U[st],Rt=this._tiles[st];if(Rt&&!(Rt.fadeEndTime&&Rt.fadeEndTime<=o.browser.now())){var yt=this.findLoadedParent(xt,R);yt&&(this._addTile(yt.tileID),J[yt.tileID.key]=yt.tileID),et[st]=xt}}for(var It in this._retainLoadedChildren(et,P,F,U),J)U[It]||(this._coveredTiles[It]=!0,U[It]=J[It])}for(var Ht in U)this._tiles[Ht].clearFadeHold();for(var Xt=0,ee=o.keysDifference(this._tiles,U);Xt<ee.length;Xt+=1){var Qt=ee[Xt],$t=this._tiles[Qt];$t.hasSymbolBuckets&&!$t.holdingForFade()?$t.setHoldDuration(this.map._fadeDuration):$t.hasSymbolBuckets&&!$t.symbolFadeFinished()||this._removeTile(Qt)}this._updateLoadedParentTileCache()}},d.prototype.releaseSymbolFadeTiles=function(){for(var f in this._tiles)this._tiles[f].holdingForFade()&&this._removeTile(f)},d.prototype._updateRetainedTiles=function(f,m){for(var E={},P={},R=Math.max(m-d.maxOverzooming,this._source.minzoom),F=Math.max(m+d.maxUnderzooming,this._source.minzoom),U={},J=0,et=f;J<et.length;J+=1){var $=et[J],it=this._addTile($);E[$.key]=$,it.hasData()||m<this._source.maxzoom&&(U[$.key]=$)}this._retainLoadedChildren(U,m,F,E);for(var st=0,xt=f;st<xt.length;st+=1){var Rt=xt[st],yt=this._tiles[Rt.key];if(!yt.hasData()){if(m+1>this._source.maxzoom){var It=Rt.children(this._source.maxzoom)[0],Ht=this.getTile(It);if(Ht&&Ht.hasData()){E[It.key]=It;continue}}else{var Xt=Rt.children(this._source.maxzoom);if(E[Xt[0].key]&&E[Xt[1].key]&&E[Xt[2].key]&&E[Xt[3].key])continue}for(var ee=yt.wasRequested(),Qt=Rt.overscaledZ-1;Qt>=R;--Qt){var $t=Rt.scaledTo(Qt);if(P[$t.key]||(P[$t.key]=!0,!(yt=this.getTile($t))&&ee&&(yt=this._addTile($t)),yt&&(E[$t.key]=$t,ee=yt.wasRequested(),yt.hasData())))break}}}return E},d.prototype._updateLoadedParentTileCache=function(){for(var f in this._loadedParentTiles={},this._tiles){for(var m=[],E=void 0,P=this._tiles[f].tileID;P.overscaledZ>0;){if(P.key in this._loadedParentTiles){E=this._loadedParentTiles[P.key];break}m.push(P.key);var R=P.scaledTo(P.overscaledZ-1);if(E=this._getLoadedTile(R))break;P=R}for(var F=0,U=m;F<U.length;F+=1)this._loadedParentTiles[U[F]]=E}},d.prototype._addTile=function(f){var m=this._tiles[f.key];if(m)return m;(m=this._cache.getAndRemove(f))&&(this._setTileReloadTimer(f.key,m),m.tileID=f,this._state.initializeTileState(m,this.map?this.map.painter:null),this._cacheTimers[f.key]&&(clearTimeout(this._cacheTimers[f.key]),delete this._cacheTimers[f.key],this._setTileReloadTimer(f.key,m)));var E=!!m;return E||(m=new o.Tile(f,this._source.tileSize*f.overscaleFactor()),this._loadTile(m,this._tileLoaded.bind(this,m,f.key,m.state))),m?(m.uses++,this._tiles[f.key]=m,E||this._source.fire(new o.Event("dataloading",{tile:m,coord:m.tileID,dataType:"source"})),m):null},d.prototype._setTileReloadTimer=function(f,m){var E=this;f in this._timers&&(clearTimeout(this._timers[f]),delete this._timers[f]);var P=m.getExpiryTimeout();P&&(this._timers[f]=setTimeout(function(){E._reloadTile(f,"expired"),delete E._timers[f]},P))},d.prototype._removeTile=function(f){var m=this._tiles[f];m&&(m.uses--,delete this._tiles[f],this._timers[f]&&(clearTimeout(this._timers[f]),delete this._timers[f]),m.uses>0||(m.hasData()&&m.state!=="reloading"?this._cache.add(m.tileID,m,m.getExpiryTimeout()):(m.aborted=!0,this._abortTile(m),this._unloadTile(m))))},d.prototype.clearTiles=function(){for(var f in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(f);this._cache.reset()},d.prototype.tilesIn=function(f,m,E){var P=this,R=[],F=this.transform;if(!F)return R;for(var U=E?F.getCameraQueryGeometry(f):f,J=f.map(function(Qt){return F.pointCoordinate(Qt)}),et=U.map(function(Qt){return F.pointCoordinate(Qt)}),$=this.getIds(),it=1/0,st=1/0,xt=-1/0,Rt=-1/0,yt=0,It=et;yt<It.length;yt+=1){var Ht=It[yt];it=Math.min(it,Ht.x),st=Math.min(st,Ht.y),xt=Math.max(xt,Ht.x),Rt=Math.max(Rt,Ht.y)}for(var Xt=function(Qt){var $t=P._tiles[$[Qt]];if(!$t.holdingForFade()){var Ae=$t.tileID,Le=Math.pow(2,F.zoom-$t.tileID.overscaledZ),we=m*$t.queryPadding*o.EXTENT/$t.tileSize/Le,Ge=[Ae.getTilePoint(new o.MercatorCoordinate(it,st)),Ae.getTilePoint(new o.MercatorCoordinate(xt,Rt))];if(Ge[0].x-we<o.EXTENT&&Ge[0].y-we<o.EXTENT&&Ge[1].x+we>=0&&Ge[1].y+we>=0){var si=J.map(function(Ti){return Ae.getTilePoint(Ti)}),Ci=et.map(function(Ti){return Ae.getTilePoint(Ti)});R.push({tile:$t,tileID:Ae,queryGeometry:si,cameraQueryGeometry:Ci,scale:Le})}}},ee=0;ee<$.length;ee++)Xt(ee);return R},d.prototype.getVisibleCoordinates=function(f){for(var m=this,E=this.getRenderableIds(f).map(function(U){return m._tiles[U].tileID}),P=0,R=E;P<R.length;P+=1){var F=R[P];F.posMatrix=this.transform.calculatePosMatrix(F.toUnwrapped())}return E},d.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(ut(this._source.type))for(var f in this._tiles){var m=this._tiles[f];if(m.fadeEndTime!==void 0&&m.fadeEndTime>=o.browser.now())return!0}return!1},d.prototype.setFeatureState=function(f,m,E){this._state.updateState(f=f||"_geojsonTileLayer",m,E)},d.prototype.removeFeatureState=function(f,m,E){this._state.removeFeatureState(f=f||"_geojsonTileLayer",m,E)},d.prototype.getFeatureState=function(f,m){return this._state.getState(f=f||"_geojsonTileLayer",m)},d.prototype.setDependencies=function(f,m,E){var P=this._tiles[f];P&&P.setDependencies(m,E)},d.prototype.reloadTilesForDependencies=function(f,m){for(var E in this._tiles)this._tiles[E].hasDependency(f,m)&&this._reloadTile(E,"reloading");this._cache.filter(function(P){return!P.hasDependency(f,m)})},d}(o.Evented);function g(c,d){var f=Math.abs(2*c.wrap)-+(c.wrap<0),m=Math.abs(2*d.wrap)-+(d.wrap<0);return c.overscaledZ-d.overscaledZ||m-f||d.canonical.y-c.canonical.y||d.canonical.x-c.canonical.x}function ut(c){return c==="raster"||c==="image"||c==="video"}function Ee(){return new o.window.Worker(O.workerUrl)}Et.maxOverzooming=10,Et.maxUnderzooming=3;var Zt="mapboxgl_preloaded_worker_pool",Be=function(){this.active={}};Be.prototype.acquire=function(c){if(!this.workers)for(this.workers=[];this.workers.length<Be.workerCount;)this.workers.push(new Ee);return this.active[c]=!0,this.workers.slice()},Be.prototype.release=function(c){delete this.active[c],this.numActive()===0&&(this.workers.forEach(function(d){d.terminate()}),this.workers=null)},Be.prototype.isPreloaded=function(){return!!this.active[Zt]},Be.prototype.numActive=function(){return Object.keys(this.active).length};var Re,Fe=Math.floor(o.browser.hardwareConcurrency/2);function fe(){return Re||(Re=new Be),Re}function ke(c,d){var f={};for(var m in c)m!=="ref"&&(f[m]=c[m]);return o.refProperties.forEach(function(E){E in d&&(f[E]=d[E])}),f}function Me(c){c=c.slice();for(var d=Object.create(null),f=0;f<c.length;f++)d[c[f].id]=c[f];for(var m=0;m<c.length;m++)"ref"in c[m]&&(c[m]=ke(c[m],d[c[m].ref]));return c}Be.workerCount=Math.max(Math.min(Fe,6),1);var He={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ki(c,d,f){f.push({command:He.addSource,args:[c,d[c]]})}function ei(c,d,f){d.push({command:He.removeSource,args:[c]}),f[c]=!0}function $i(c,d,f,m){ei(c,f,m),ki(c,d,f)}function ln(c,d,f){var m;for(m in c[f])if(c[f].hasOwnProperty(m)&&m!=="data"&&!o.deepEqual(c[f][m],d[f][m]))return!1;for(m in d[f])if(d[f].hasOwnProperty(m)&&m!=="data"&&!o.deepEqual(c[f][m],d[f][m]))return!1;return!0}function Wi(c,d,f,m,E,P){var R;for(R in d=d||{},c=c||{})c.hasOwnProperty(R)&&(o.deepEqual(c[R],d[R])||f.push({command:P,args:[m,R,d[R],E]}));for(R in d)d.hasOwnProperty(R)&&!c.hasOwnProperty(R)&&(o.deepEqual(c[R],d[R])||f.push({command:P,args:[m,R,d[R],E]}))}function Ji(c){return c.id}function Gi(c,d){return c[d.id]=d,c}var vr=function(c,d){this.reset(c,d)};vr.prototype.reset=function(c,d){this.points=c||[],this._distances=[0];for(var f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding},vr.prototype.lerp=function(c){if(this.points.length===1)return this.points[0];c=o.clamp(c,0,1);for(var d=1,f=this._distances[d],m=c*this.paddedLength+this.padding;f<m&&d<this._distances.length;)f=this._distances[++d];var E=d-1,P=this._distances[E],R=f-P,F=R>0?(m-P)/R:0;return this.points[E].mult(1-F).add(this.points[d].mult(F))};var Xi=function(c,d,f){var m=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(c/f),this.yCellCount=Math.ceil(d/f);for(var P=0;P<this.xCellCount*this.yCellCount;P++)m.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=d,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0};function yi(c,d,f,m,E){var P=o.create();return d?(o.scale(P,P,[1/E,1/E,1]),f||o.rotateZ(P,P,m.angle)):o.multiply(P,m.labelPlaneMatrix,c),P}function Bt(c,d,f,m,E){if(d){var P=o.clone(c);return o.scale(P,P,[E,E,1]),f||o.rotateZ(P,P,-m.angle),P}return m.glCoordMatrix}function Qe(c,d){var f=[c.x,c.y,0,1];fr(f,f,d);var m=f[3];return{point:new o.Point(f[0]/m,f[1]/m),signedDistanceFromCamera:m}}function tn(c,d){return .5+c/d*.5}function Wr(c,d){var f=c[0]/c[3],m=c[1]/c[3];return f>=-d[0]&&f<=d[0]&&m>=-d[1]&&m<=d[1]}function xa(c,d,f,m,E,P,R,F){var U=m?c.textSizeData:c.iconSizeData,J=o.evaluateSizeForZoom(U,f.transform.zoom),et=[256/f.width*2+1,256/f.height*2+1],$=m?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;$.clear();for(var it=c.lineVertexArray,st=m?c.text.placedSymbolArray:c.icon.placedSymbolArray,xt=f.transform.width/f.transform.height,Rt=!1,yt=0;yt<st.length;yt++){var It=st.get(yt);if(It.hidden||It.writingMode===o.WritingMode.vertical&&!Rt)Lr(It.numGlyphs,$);else{Rt=!1;var Ht=[It.anchorX,It.anchorY,0,1];if(o.transformMat4(Ht,Ht,d),Wr(Ht,et)){var Xt=tn(f.transform.cameraToCenterDistance,Ht[3]),ee=o.evaluateSizeForFeature(U,J,It),Qt=R?ee/Xt:ee*Xt,$t=new o.Point(It.anchorX,It.anchorY),Ae=Qe($t,E).point,Le={},we=Tt(It,Qt,!1,F,d,E,P,c.glyphOffsetArray,it,$,Ae,$t,Le,xt);Rt=we.useVertical,(we.notEnoughRoom||Rt||we.needsFlipping&&Tt(It,Qt,!0,F,d,E,P,c.glyphOffsetArray,it,$,Ae,$t,Le,xt).notEnoughRoom)&&Lr(It.numGlyphs,$)}else Lr(It.numGlyphs,$)}}m?c.text.dynamicLayoutVertexBuffer.updateData($):c.icon.dynamicLayoutVertexBuffer.updateData($)}function hr(c,d,f,m,E,P,R,F,U,J,et){var $=F.glyphStartIndex+F.numGlyphs,it=F.lineStartIndex,st=F.lineStartIndex+F.lineLength,xt=d.getoffsetX(F.glyphStartIndex),Rt=d.getoffsetX($-1),yt=Xn(c*xt,f,m,E,P,R,F.segment,it,st,U,J,et);if(!yt)return null;var It=Xn(c*Rt,f,m,E,P,R,F.segment,it,st,U,J,et);return It?{first:yt,last:It}:null}function Jn(c,d,f,m){return c===o.WritingMode.horizontal&&Math.abs(f.y-d.y)>Math.abs(f.x-d.x)*m?{useVertical:!0}:(c===o.WritingMode.vertical?d.y<f.y:d.x>f.x)?{needsFlipping:!0}:null}function Tt(c,d,f,m,E,P,R,F,U,J,et,$,it,st){var xt,Rt=d/24,yt=c.lineOffsetX*Rt,It=c.lineOffsetY*Rt;if(c.numGlyphs>1){var Ht=c.glyphStartIndex+c.numGlyphs,Xt=c.lineStartIndex,ee=c.lineStartIndex+c.lineLength,Qt=hr(Rt,F,yt,It,f,et,$,c,U,P,it);if(!Qt)return{notEnoughRoom:!0};var $t=Qe(Qt.first.point,R).point,Ae=Qe(Qt.last.point,R).point;if(m&&!f){var Le=Jn(c.writingMode,$t,Ae,st);if(Le)return Le}xt=[Qt.first];for(var we=c.glyphStartIndex+1;we<Ht-1;we++)xt.push(Xn(Rt*F.getoffsetX(we),yt,It,f,et,$,c.segment,Xt,ee,U,P,it));xt.push(Qt.last)}else{if(m&&!f){var Ge=Qe($,E).point,si=c.lineStartIndex+c.segment+1,Ci=new o.Point(U.getx(si),U.gety(si)),Ti=Qe(Ci,E),xn=Ti.signedDistanceFromCamera>0?Ti.point:Ks($,Ci,Ge,1,E),li=Jn(c.writingMode,Ge,xn,st);if(li)return li}var Hi=Xn(Rt*F.getoffsetX(c.glyphStartIndex),yt,It,f,et,$,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,U,P,it);if(!Hi)return{notEnoughRoom:!0};xt=[Hi]}for(var en=0,ji=xt;en<ji.length;en+=1){var Ui=ji[en];o.addDynamicAttributes(J,Ui.point,Ui.angle)}return{}}function Ks(c,d,f,m,E){var P=Qe(c.add(c.sub(d)._unit()),E).point,R=f.sub(P);return f.add(R._mult(m/R.mag()))}function Xn(c,d,f,m,E,P,R,F,U,J,et,$){var it=m?c-d:c+d,st=it>0?1:-1,xt=0;m&&(st*=-1,xt=Math.PI),st<0&&(xt+=Math.PI);for(var Rt=st>0?F+R:F+R+1,yt=E,It=E,Ht=0,Xt=0,ee=Math.abs(it),Qt=[];Ht+Xt<=ee;){if((Rt+=st)<F||Rt>=U)return null;if(It=yt,Qt.push(yt),(yt=$[Rt])===void 0){var $t=new o.Point(J.getx(Rt),J.gety(Rt)),Ae=Qe($t,et);if(Ae.signedDistanceFromCamera>0)yt=$[Rt]=Ae.point;else{var Le=Rt-st;yt=Ks(Ht===0?P:new o.Point(J.getx(Le),J.gety(Le)),$t,It,ee-Ht+1,et)}}Ht+=Xt,Xt=It.dist(yt)}var we=(ee-Ht)/Xt,Ge=yt.sub(It),si=Ge.mult(we)._add(It);si._add(Ge._unit()._perp()._mult(f*st));var Ci=xt+Math.atan2(yt.y-It.y,yt.x-It.x);return Qt.push(si),{point:si,angle:Ci,path:Qt}}Xi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Xi.prototype.insert=function(c,d,f,m,E){this._forEachCell(d,f,m,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(d),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(E)},Xi.prototype.insertCircle=function(c,d,f,m){this._forEachCell(d-m,f-m,d+m,f+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(d),this.circles.push(f),this.circles.push(m)},Xi.prototype._insertBoxCell=function(c,d,f,m,E,P){this.boxCells[E].push(P)},Xi.prototype._insertCircleCell=function(c,d,f,m,E,P){this.circleCells[E].push(P)},Xi.prototype._query=function(c,d,f,m,E,P){if(f<0||c>this.width||m<0||d>this.height)return!E&&[];var R=[];if(c<=0&&d<=0&&this.width<=f&&this.height<=m){if(E)return!0;for(var F=0;F<this.boxKeys.length;F++)R.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(var U=0;U<this.circleKeys.length;U++){var J=this.circles[3*U],et=this.circles[3*U+1],$=this.circles[3*U+2];R.push({key:this.circleKeys[U],x1:J-$,y1:et-$,x2:J+$,y2:et+$})}return P?R.filter(P):R}return this._forEachCell(c,d,f,m,this._queryCell,R,{hitTest:E,seenUids:{box:{},circle:{}}},P),E?R.length>0:R},Xi.prototype._queryCircle=function(c,d,f,m,E){var P=c-f,R=c+f,F=d-f,U=d+f;if(R<0||P>this.width||U<0||F>this.height)return!m&&[];var J=[];return this._forEachCell(P,F,R,U,this._queryCellCircle,J,{hitTest:m,circle:{x:c,y:d,radius:f},seenUids:{box:{},circle:{}}},E),m?J.length>0:J},Xi.prototype.query=function(c,d,f,m,E){return this._query(c,d,f,m,!1,E)},Xi.prototype.hitTest=function(c,d,f,m,E){return this._query(c,d,f,m,!0,E)},Xi.prototype.hitTestCircle=function(c,d,f,m){return this._queryCircle(c,d,f,!0,m)},Xi.prototype._queryCell=function(c,d,f,m,E,P,R,F){var U=R.seenUids,J=this.boxCells[E];if(J!==null)for(var et=this.bboxes,$=0,it=J;$<it.length;$+=1){var st=it[$];if(!U.box[st]){U.box[st]=!0;var xt=4*st;if(c<=et[xt+2]&&d<=et[xt+3]&&f>=et[xt+0]&&m>=et[xt+1]&&(!F||F(this.boxKeys[st]))){if(R.hitTest)return P.push(!0),!0;P.push({key:this.boxKeys[st],x1:et[xt],y1:et[xt+1],x2:et[xt+2],y2:et[xt+3]})}}}var Rt=this.circleCells[E];if(Rt!==null)for(var yt=this.circles,It=0,Ht=Rt;It<Ht.length;It+=1){var Xt=Ht[It];if(!U.circle[Xt]){U.circle[Xt]=!0;var ee=3*Xt;if(this._circleAndRectCollide(yt[ee],yt[ee+1],yt[ee+2],c,d,f,m)&&(!F||F(this.circleKeys[Xt]))){if(R.hitTest)return P.push(!0),!0;var Qt=yt[ee],$t=yt[ee+1],Ae=yt[ee+2];P.push({key:this.circleKeys[Xt],x1:Qt-Ae,y1:$t-Ae,x2:Qt+Ae,y2:$t+Ae})}}}},Xi.prototype._queryCellCircle=function(c,d,f,m,E,P,R,F){var U=R.circle,J=R.seenUids,et=this.boxCells[E];if(et!==null)for(var $=this.bboxes,it=0,st=et;it<st.length;it+=1){var xt=st[it];if(!J.box[xt]){J.box[xt]=!0;var Rt=4*xt;if(this._circleAndRectCollide(U.x,U.y,U.radius,$[Rt+0],$[Rt+1],$[Rt+2],$[Rt+3])&&(!F||F(this.boxKeys[xt])))return P.push(!0),!0}}var yt=this.circleCells[E];if(yt!==null)for(var It=this.circles,Ht=0,Xt=yt;Ht<Xt.length;Ht+=1){var ee=Xt[Ht];if(!J.circle[ee]){J.circle[ee]=!0;var Qt=3*ee;if(this._circlesCollide(It[Qt],It[Qt+1],It[Qt+2],U.x,U.y,U.radius)&&(!F||F(this.circleKeys[ee])))return P.push(!0),!0}}},Xi.prototype._forEachCell=function(c,d,f,m,E,P,R,F){for(var U=this._convertToXCellCoord(c),J=this._convertToYCellCoord(d),et=this._convertToXCellCoord(f),$=this._convertToYCellCoord(m),it=U;it<=et;it++)for(var st=J;st<=$;st++)if(E.call(this,c,d,f,m,this.xCellCount*st+it,P,R,F))return},Xi.prototype._convertToXCellCoord=function(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))},Xi.prototype._convertToYCellCoord=function(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))},Xi.prototype._circlesCollide=function(c,d,f,m,E,P){var R=m-c,F=E-d,U=f+P;return U*U>R*R+F*F},Xi.prototype._circleAndRectCollide=function(c,d,f,m,E,P,R){var F=(P-m)/2,U=Math.abs(c-(m+F));if(U>F+f)return!1;var J=(R-E)/2,et=Math.abs(d-(E+J));if(et>J+f)return!1;if(U<=F||et<=J)return!0;var $=U-F,it=et-J;return $*$+it*it<=f*f};var Qs=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Lr(c,d){for(var f=0;f<c;f++){var m=d.length;d.resize(m+4),d.float32.set(Qs,3*m)}}function fr(c,d,f){var m=d[0],E=d[1];return c[0]=f[0]*m+f[4]*E+f[12],c[1]=f[1]*m+f[5]*E+f[13],c[3]=f[3]*m+f[7]*E+f[15],c}var Mr=function(c,d,f){d===void 0&&(d=new Xi(c.width+200,c.height+200,25)),f===void 0&&(f=new Xi(c.width+200,c.height+200,25)),this.transform=c,this.grid=d,this.ignoredGrid=f,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+100,this.screenBottomBoundary=c.height+100,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200};function Dn(c,d,f){return d*(o.EXTENT/(c.tileSize*Math.pow(2,f-c.tileID.overscaledZ)))}Mr.prototype.placeCollisionBox=function(c,d,f,m,E){var P=this.projectAndGetPerspectiveRatio(m,c.anchorPointX,c.anchorPointY),R=f*P.perspectiveRatio,F=c.x1*R+P.point.x,U=c.y1*R+P.point.y,J=c.x2*R+P.point.x,et=c.y2*R+P.point.y;return!this.isInsideGrid(F,U,J,et)||!d&&this.grid.hitTest(F,U,J,et,E)?{box:[],offscreen:!1}:{box:[F,U,J,et],offscreen:this.isOffscreen(F,U,J,et)}},Mr.prototype.placeCollisionCircles=function(c,d,f,m,E,P,R,F,U,J,et,$,it){var st=[],xt=new o.Point(d.anchorX,d.anchorY),Rt=Qe(xt,P),yt=tn(this.transform.cameraToCenterDistance,Rt.signedDistanceFromCamera),It=(J?E/yt:E*yt)/o.ONE_EM,Ht=Qe(xt,R).point,Xt=hr(It,m,d.lineOffsetX*It,d.lineOffsetY*It,!1,Ht,xt,d,f,R,{}),ee=!1,Qt=!1,$t=!0;if(Xt){for(var Ae=.5*$*yt+it,Le=new o.Point(-100,-100),we=new o.Point(this.screenRightBoundary,this.screenBottomBoundary),Ge=new vr,si=Xt.first,Ci=Xt.last,Ti=[],xn=si.path.length-1;xn>=1;xn--)Ti.push(si.path[xn]);for(var li=1;li<Ci.path.length;li++)Ti.push(Ci.path[li]);var Hi=2.5*Ae;if(F){var en=Ti.map(function(Us){return Qe(Us,F)});Ti=en.some(function(Us){return Us.signedDistanceFromCamera<=0})?[]:en.map(function(Us){return Us.point})}var ji=[];if(Ti.length>0){for(var Ui=Ti[0].clone(),Zi=Ti[0].clone(),Li=1;Li<Ti.length;Li++)Ui.x=Math.min(Ui.x,Ti[Li].x),Ui.y=Math.min(Ui.y,Ti[Li].y),Zi.x=Math.max(Zi.x,Ti[Li].x),Zi.y=Math.max(Zi.y,Ti[Li].y);ji=Ui.x>=Le.x&&Zi.x<=we.x&&Ui.y>=Le.y&&Zi.y<=we.y?[Ti]:Zi.x<Le.x||Ui.x>we.x||Zi.y<Le.y||Ui.y>we.y?[]:o.clipLine([Ti],Le.x,Le.y,we.x,we.y)}for(var Di=0,Qr=ji;Di<Qr.length;Di+=1){var Tr;Ge.reset(Qr[Di],.25*Ae),Tr=Ge.length<=.5*Ae?1:Math.ceil(Ge.paddedLength/Hi)+1;for(var wo=0;wo<Tr;wo++){var so=wo/Math.max(Tr-1,1),xr=Ge.lerp(so),Pr=xr.x+100,ds=xr.y+100;st.push(Pr,ds,Ae,0);var Lo=Pr-Ae,Jl=ds-Ae,Yo=Pr+Ae,ca=ds+Ae;if($t=$t&&this.isOffscreen(Lo,Jl,Yo,ca),Qt=Qt||this.isInsideGrid(Lo,Jl,Yo,ca),!c&&this.grid.hitTestCircle(Pr,ds,Ae,et)&&(ee=!0,!U))return{circles:[],offscreen:!1,collisionDetected:ee}}}}return{circles:!U&&ee||!Qt?[]:st,offscreen:$t,collisionDetected:ee}},Mr.prototype.queryRenderedSymbols=function(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var d=[],f=1/0,m=1/0,E=-1/0,P=-1/0,R=0,F=c;R<F.length;R+=1){var U=F[R],J=new o.Point(U.x+100,U.y+100);f=Math.min(f,J.x),m=Math.min(m,J.y),E=Math.max(E,J.x),P=Math.max(P,J.y),d.push(J)}for(var et={},$={},it=0,st=this.grid.query(f,m,E,P).concat(this.ignoredGrid.query(f,m,E,P));it<st.length;it+=1){var xt=st[it],Rt=xt.key;if(et[Rt.bucketInstanceId]===void 0&&(et[Rt.bucketInstanceId]={}),!et[Rt.bucketInstanceId][Rt.featureIndex]){var yt=[new o.Point(xt.x1,xt.y1),new o.Point(xt.x2,xt.y1),new o.Point(xt.x2,xt.y2),new o.Point(xt.x1,xt.y2)];o.polygonIntersectsPolygon(d,yt)&&(et[Rt.bucketInstanceId][Rt.featureIndex]=!0,$[Rt.bucketInstanceId]===void 0&&($[Rt.bucketInstanceId]=[]),$[Rt.bucketInstanceId].push(Rt.featureIndex))}}return $},Mr.prototype.insertCollisionBox=function(c,d,f,m,E){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:m,collisionGroupID:E},c[0],c[1],c[2],c[3])},Mr.prototype.insertCollisionCircles=function(c,d,f,m,E){for(var P=d?this.ignoredGrid:this.grid,R={bucketInstanceId:f,featureIndex:m,collisionGroupID:E},F=0;F<c.length;F+=4)P.insertCircle(R,c[F],c[F+1],c[F+2])},Mr.prototype.projectAndGetPerspectiveRatio=function(c,d,f){var m=[d,f,0,1];return fr(m,m,c),{point:new o.Point((m[0]/m[3]+1)/2*this.transform.width+100,(-m[1]/m[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/m[3]*.5}},Mr.prototype.isOffscreen=function(c,d,f,m){return f<100||c>=this.screenRightBoundary||m<100||d>this.screenBottomBoundary},Mr.prototype.isInsideGrid=function(c,d,f,m){return f>=0&&c<this.gridRightBoundary&&m>=0&&d<this.gridBottomBoundary},Mr.prototype.getViewportMatrix=function(){var c=o.identity([]);return o.translate(c,c,[-100,-100,0]),c};var vo=function(c,d,f,m){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?d:-d))):m&&f?1:0,this.placed=f};vo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Jr=function(c,d,f,m,E){this.text=new vo(c?c.text:null,d,f,E),this.icon=new vo(c?c.icon:null,d,m,E)};Jr.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Ho=function(c,d,f){this.text=c,this.icon=d,this.skipFade=f},In=function(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]},wc=function(c,d,f,m,E){this.bucketInstanceId=c,this.featureIndex=d,this.sourceLayerIndex=f,this.bucketIndex=m,this.tileID=E},gt=function(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}};function Pt(c,d,f,m,E){var P=o.getAnchorAlignment(c),R=-(P.horizontalAlign-.5)*d,F=-(P.verticalAlign-.5)*f,U=o.evaluateVariableOffset(c,m);return new o.Point(R+U[0]*E,F+U[1]*E)}function Jt(c,d,f,m,E,P){var R=c.x1,F=c.x2,U=c.y1,J=c.y2,et=c.anchorPointX,$=c.anchorPointY,it=new o.Point(d,f);return m&&it._rotate(E?P:-P),{x1:R+it.x,y1:U+it.y,x2:F+it.x,y2:J+it.y,anchorPointX:et,anchorPointY:$}}gt.prototype.get=function(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){var d=++this.maxGroupID;this.collisionGroups[c]={ID:d,predicate:function(f){return f.collisionGroupID===d}}}return this.collisionGroups[c]};var xe=function(c,d,f,m){this.transform=c.clone(),this.collisionIndex=new Mr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new gt(f),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}};function We(c,d,f,m,E){c.emplaceBack(d?1:0,f?1:0,m||0,E||0),c.emplaceBack(d?1:0,f?1:0,m||0,E||0),c.emplaceBack(d?1:0,f?1:0,m||0,E||0),c.emplaceBack(d?1:0,f?1:0,m||0,E||0)}xe.prototype.getBucketParts=function(c,d,f,m){var E=f.getBucket(d),P=f.latestFeatureIndex;if(E&&P&&d.id===E.layerIds[0]){var R=f.collisionBoxArray,F=E.layers[0].layout,U=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),J=f.tileSize/o.EXTENT,et=this.transform.calculatePosMatrix(f.tileID.toUnwrapped()),$=F.get("text-pitch-alignment")==="map",it=F.get("text-rotation-alignment")==="map",st=Dn(f,1,this.transform.zoom),xt=yi(et,$,it,this.transform,st),Rt=null;if($){var yt=Bt(et,$,it,this.transform,st);Rt=o.multiply([],this.transform.labelPlaneMatrix,yt)}this.retainedQueryData[E.bucketInstanceId]=new wc(E.bucketInstanceId,P,E.sourceLayerIndex,E.index,f.tileID);var It={bucket:E,layout:F,posMatrix:et,textLabelPlaneMatrix:xt,labelToScreenMatrix:Rt,scale:U,textPixelRatio:J,holdingForFade:f.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(m)for(var Ht=0,Xt=E.sortKeyRanges;Ht<Xt.length;Ht+=1){var ee=Xt[Ht];c.push({sortKey:ee.sortKey,symbolInstanceStart:ee.symbolInstanceStart,symbolInstanceEnd:ee.symbolInstanceEnd,parameters:It})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:It})}},xe.prototype.attemptAnchorPlacement=function(c,d,f,m,E,P,R,F,U,J,et,$,it,st,xt){var Rt,yt=[$.textOffset0,$.textOffset1],It=Pt(c,f,m,yt,E),Ht=this.collisionIndex.placeCollisionBox(Jt(d,It.x,It.y,P,R,this.transform.angle),et,F,U,J.predicate);if(!xt||this.collisionIndex.placeCollisionBox(Jt(xt,It.x,It.y,P,R,this.transform.angle),et,F,U,J.predicate).box.length!==0)return Ht.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(Rt=this.prevPlacement.variableOffsets[$.crossTileID].anchor),this.variableOffsets[$.crossTileID]={textOffset:yt,width:f,height:m,anchor:c,textBoxScale:E,prevAnchor:Rt},this.markUsedJustification(it,c,$,st),it.allowVerticalPlacement&&(this.markUsedOrientation(it,st,$),this.placedOrientations[$.crossTileID]=st),{shift:It,placedGlyphBoxes:Ht}):void 0},xe.prototype.placeLayerBucketPart=function(c,d,f){var m=this,E=c.parameters,P=E.bucket,R=E.layout,F=E.posMatrix,U=E.textLabelPlaneMatrix,J=E.labelToScreenMatrix,et=E.textPixelRatio,$=E.holdingForFade,it=E.collisionBoxArray,st=E.partiallyEvaluatedTextSize,xt=E.collisionGroup,Rt=R.get("text-optional"),yt=R.get("icon-optional"),It=R.get("text-allow-overlap"),Ht=R.get("icon-allow-overlap"),Xt=R.get("text-rotation-alignment")==="map",ee=R.get("text-pitch-alignment")==="map",Qt=R.get("icon-text-fit")!=="none",$t=R.get("symbol-z-order")==="viewport-y",Ae=It&&(Ht||!P.hasIconData()||yt),Le=Ht&&(It||!P.hasTextData()||Rt);!P.collisionArrays&&it&&P.deserializeCollisionBoxes(it);var we=function(li,Hi){if(!d[li.crossTileID])if($)m.placements[li.crossTileID]=new Ho(!1,!1,!1);else{var en,ji=!1,Ui=!1,Zi=!0,Li=null,Di={box:null,offscreen:null},Qr={box:null,offscreen:null},Tr=null,wo=null,so=0,xr=0,Pr=0;Hi.textFeatureIndex?so=Hi.textFeatureIndex:li.useRuntimeCollisionCircles&&(so=li.featureIndex),Hi.verticalTextFeatureIndex&&(xr=Hi.verticalTextFeatureIndex);var ds=Hi.textBox;if(ds){var Lo=function(Bn){var Ms=o.WritingMode.horizontal;if(P.allowVerticalPlacement&&!Bn&&m.prevPlacement){var qo=m.prevPlacement.placedOrientations[li.crossTileID];qo&&(m.placedOrientations[li.crossTileID]=qo,m.markUsedOrientation(P,Ms=qo,li))}return Ms},Jl=function(Bn,Ms){if(P.allowVerticalPlacement&&li.numVerticalGlyphVertices>0&&Hi.verticalTextBox)for(var qo=0,Uc=P.writingModes;qo<Uc.length&&(Uc[qo]===o.WritingMode.vertical?(Di=Ms(),Qr=Di):Di=Bn(),!(Di&&Di.box&&Di.box.length));qo+=1);else Di=Bn()};if(R.get("text-variable-anchor")){var Yo=R.get("text-variable-anchor");if(m.prevPlacement&&m.prevPlacement.variableOffsets[li.crossTileID]){var ca=m.prevPlacement.variableOffsets[li.crossTileID];Yo.indexOf(ca.anchor)>0&&(Yo=Yo.filter(function(Bn){return Bn!==ca.anchor})).unshift(ca.anchor)}var Us=function(Bn,Ms,qo){for(var Uc=Bn.x2-Bn.x1,gv=Bn.y2-Bn.y1,Jf=li.textBoxScale,mv=Qt&&!Ht?Ms:null,Nh={box:[],offscreen:!1},dm=It?2*Yo.length:Yo.length,Du=0;Du<dm;++Du){var Xf=m.attemptAnchorPlacement(Yo[Du%Yo.length],Bn,Uc,gv,Jf,Xt,ee,et,F,xt,Du>=Yo.length,li,P,qo,mv);if(Xf&&(Nh=Xf.placedGlyphBoxes)&&Nh.box&&Nh.box.length){ji=!0,Li=Xf.shift;break}}return Nh};Jl(function(){return Us(ds,Hi.iconBox,o.WritingMode.horizontal)},function(){var Bn=Hi.verticalTextBox;return P.allowVerticalPlacement&&!(Di&&Di.box&&Di.box.length)&&li.numVerticalGlyphVertices>0&&Bn?Us(Bn,Hi.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),Di&&(ji=Di.box,Zi=Di.offscreen);var Lh=Lo(Di&&Di.box);if(!ji&&m.prevPlacement){var Pu=m.prevPlacement.variableOffsets[li.crossTileID];Pu&&(m.variableOffsets[li.crossTileID]=Pu,m.markUsedJustification(P,Pu.anchor,li,Lh))}}else{var Xl=function(Bn,Ms){var qo=m.collisionIndex.placeCollisionBox(Bn,It,et,F,xt.predicate);return qo&&qo.box&&qo.box.length&&(m.markUsedOrientation(P,Ms,li),m.placedOrientations[li.crossTileID]=Ms),qo};Jl(function(){return Xl(ds,o.WritingMode.horizontal)},function(){var Bn=Hi.verticalTextBox;return P.allowVerticalPlacement&&li.numVerticalGlyphVertices>0&&Bn?Xl(Bn,o.WritingMode.vertical):{box:null,offscreen:null}}),Lo(Di&&Di.box&&Di.box.length)}}if(ji=(en=Di)&&en.box&&en.box.length>0,Zi=en&&en.offscreen,li.useRuntimeCollisionCircles){var Ru=P.text.placedSymbolArray.get(li.centerJustifiedTextSymbolIndex),Fh=o.evaluateSizeForFeature(P.textSizeData,st,Ru),Da=R.get("text-padding");Tr=m.collisionIndex.placeCollisionCircles(It,Ru,P.lineVertexArray,P.glyphOffsetArray,Fh,F,U,J,f,ee,xt.predicate,li.collisionCircleDiameter,Da),ji=It||Tr.circles.length>0&&!Tr.collisionDetected,Zi=Zi&&Tr.offscreen}if(Hi.iconFeatureIndex&&(Pr=Hi.iconFeatureIndex),Hi.iconBox){var kh=function(Bn){var Ms=Qt&&Li?Jt(Bn,Li.x,Li.y,Xt,ee,m.transform.angle):Bn;return m.collisionIndex.placeCollisionBox(Ms,Ht,et,F,xt.predicate)};Ui=Qr&&Qr.box&&Qr.box.length&&Hi.verticalIconBox?(wo=kh(Hi.verticalIconBox)).box.length>0:(wo=kh(Hi.iconBox)).box.length>0,Zi=Zi&&wo.offscreen}var Oa=Rt||li.numHorizontalGlyphVertices===0&&li.numVerticalGlyphVertices===0,Zr=yt||li.numIconVertices===0;if(Oa||Zr?Zr?Oa||(Ui=Ui&&ji):ji=Ui&&ji:Ui=ji=Ui&&ji,ji&&en&&en.box&&m.collisionIndex.insertCollisionBox(en.box,R.get("text-ignore-placement"),P.bucketInstanceId,Qr&&Qr.box&&xr?xr:so,xt.ID),Ui&&wo&&m.collisionIndex.insertCollisionBox(wo.box,R.get("icon-ignore-placement"),P.bucketInstanceId,Pr,xt.ID),Tr&&(ji&&m.collisionIndex.insertCollisionCircles(Tr.circles,R.get("text-ignore-placement"),P.bucketInstanceId,so,xt.ID),f)){var ll=P.bucketInstanceId,Kl=m.collisionCircleArrays[ll];Kl===void 0&&(Kl=m.collisionCircleArrays[ll]=new In);for(var Nc=0;Nc<Tr.circles.length;Nc+=4)Kl.circles.push(Tr.circles[Nc+0]),Kl.circles.push(Tr.circles[Nc+1]),Kl.circles.push(Tr.circles[Nc+2]),Kl.circles.push(Tr.collisionDetected?1:0)}m.placements[li.crossTileID]=new Ho(ji||Ae,Ui||Le,Zi||P.justReloaded),d[li.crossTileID]=!0}};if($t)for(var Ge=P.getSortedSymbolIndexes(this.transform.angle),si=Ge.length-1;si>=0;--si){var Ci=Ge[si];we(P.symbolInstances.get(Ci),P.collisionArrays[Ci])}else for(var Ti=c.symbolInstanceStart;Ti<c.symbolInstanceEnd;Ti++)we(P.symbolInstances.get(Ti),P.collisionArrays[Ti]);if(f&&P.bucketInstanceId in this.collisionCircleArrays){var xn=this.collisionCircleArrays[P.bucketInstanceId];o.invert(xn.invProjMatrix,F),xn.viewportMatrix=this.collisionIndex.getViewportMatrix()}P.justReloaded=!1},xe.prototype.markUsedJustification=function(c,d,f,m){var E;E=m===o.WritingMode.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(d)];for(var P=0,R=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];P<R.length;P+=1){var F=R[P];F>=0&&(c.text.placedSymbolArray.get(F).crossTileID=E>=0&&F!==E?0:f.crossTileID)}},xe.prototype.markUsedOrientation=function(c,d,f){for(var m=d===o.WritingMode.horizontal||d===o.WritingMode.horizontalOnly?d:0,E=d===o.WritingMode.vertical?d:0,P=0,R=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];P<R.length;P+=1)c.text.placedSymbolArray.get(R[P]).placedOrientation=m;f.verticalPlacedTextSymbolIndex&&(c.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=E)},xe.prototype.commit=function(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;var d=this.prevPlacement,f=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;var m=d?d.symbolFadeChange(c):1,E=d?d.opacities:{},P=d?d.variableOffsets:{},R=d?d.placedOrientations:{};for(var F in this.placements){var U=this.placements[F],J=E[F];J?(this.opacities[F]=new Jr(J,m,U.text,U.icon),f=f||U.text!==J.text.placed||U.icon!==J.icon.placed):(this.opacities[F]=new Jr(null,m,U.text,U.icon,U.skipFade),f=f||U.text||U.icon)}for(var et in E){var $=E[et];if(!this.opacities[et]){var it=new Jr($,m,!1,!1);it.isHidden()||(this.opacities[et]=it,f=f||$.text.placed||$.icon.placed)}}for(var st in P)this.variableOffsets[st]||!this.opacities[st]||this.opacities[st].isHidden()||(this.variableOffsets[st]=P[st]);for(var xt in R)this.placedOrientations[xt]||!this.opacities[xt]||this.opacities[xt].isHidden()||(this.placedOrientations[xt]=R[xt]);f?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:c)},xe.prototype.updateLayerOpacities=function(c,d){for(var f={},m=0,E=d;m<E.length;m+=1){var P=E[m],R=P.getBucket(c);R&&P.latestFeatureIndex&&c.id===R.layerIds[0]&&this.updateBucketOpacities(R,f,P.collisionBoxArray)}},xe.prototype.updateBucketOpacities=function(c,d,f){var m=this;c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();var E=c.layers[0].layout,P=new Jr(null,0,!1,!1,!0),R=E.get("text-allow-overlap"),F=E.get("icon-allow-overlap"),U=E.get("text-variable-anchor"),J=E.get("text-rotation-alignment")==="map",et=E.get("text-pitch-alignment")==="map",$=E.get("icon-text-fit")!=="none",it=new Jr(null,0,R&&(F||!c.hasIconData()||E.get("icon-optional")),F&&(R||!c.hasTextData()||E.get("text-optional")),!0);!c.collisionArrays&&f&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(f);for(var st=function(It,Ht,Xt){for(var ee=0;ee<Ht/4;ee++)It.opacityVertexArray.emplaceBack(Xt)},xt=function(It){var Ht=c.symbolInstances.get(It),Xt=Ht.numHorizontalGlyphVertices,ee=Ht.numVerticalGlyphVertices,Qt=Ht.crossTileID,$t=m.opacities[Qt];d[Qt]?$t=P:$t||(m.opacities[Qt]=$t=it),d[Qt]=!0;var Ae=Ht.numIconVertices>0,Le=m.placedOrientations[Ht.crossTileID],we=Le===o.WritingMode.vertical,Ge=Le===o.WritingMode.horizontal||Le===o.WritingMode.horizontalOnly;if(Xt>0||ee>0){var si=bh($t.text);st(c.text,Xt,we?wa:si),st(c.text,ee,Ge?wa:si);var Ci=$t.text.isHidden();[Ht.rightJustifiedTextSymbolIndex,Ht.centerJustifiedTextSymbolIndex,Ht.leftJustifiedTextSymbolIndex].forEach(function(Di){Di>=0&&(c.text.placedSymbolArray.get(Di).hidden=Ci||we?1:0)}),Ht.verticalPlacedTextSymbolIndex>=0&&(c.text.placedSymbolArray.get(Ht.verticalPlacedTextSymbolIndex).hidden=Ci||Ge?1:0);var Ti=m.variableOffsets[Ht.crossTileID];Ti&&m.markUsedJustification(c,Ti.anchor,Ht,Le);var xn=m.placedOrientations[Ht.crossTileID];xn&&(m.markUsedJustification(c,"left",Ht,xn),m.markUsedOrientation(c,xn,Ht))}if(Ae){var li=bh($t.icon),Hi=!($&&Ht.verticalPlacedIconSymbolIndex&&we);Ht.placedIconSymbolIndex>=0&&(st(c.icon,Ht.numIconVertices,Hi?li:wa),c.icon.placedSymbolArray.get(Ht.placedIconSymbolIndex).hidden=$t.icon.isHidden()),Ht.verticalPlacedIconSymbolIndex>=0&&(st(c.icon,Ht.numVerticalIconVertices,Hi?wa:li),c.icon.placedSymbolArray.get(Ht.verticalPlacedIconSymbolIndex).hidden=$t.icon.isHidden())}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){var en=c.collisionArrays[It];if(en){var ji=new o.Point(0,0);if(en.textBox||en.verticalTextBox){var Ui=!0;if(U){var Zi=m.variableOffsets[Qt];Zi?(ji=Pt(Zi.anchor,Zi.width,Zi.height,Zi.textOffset,Zi.textBoxScale),J&&ji._rotate(et?m.transform.angle:-m.transform.angle)):Ui=!1}en.textBox&&We(c.textCollisionBox.collisionVertexArray,$t.text.placed,!Ui||we,ji.x,ji.y),en.verticalTextBox&&We(c.textCollisionBox.collisionVertexArray,$t.text.placed,!Ui||Ge,ji.x,ji.y)}var Li=!!(!Ge&&en.verticalIconBox);en.iconBox&&We(c.iconCollisionBox.collisionVertexArray,$t.icon.placed,Li,$?ji.x:0,$?ji.y:0),en.verticalIconBox&&We(c.iconCollisionBox.collisionVertexArray,$t.icon.placed,!Li,$?ji.x:0,$?ji.y:0)}}},Rt=0;Rt<c.symbolInstances.length;Rt++)xt(Rt);if(c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){var yt=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=yt.invProjMatrix,c.placementViewportMatrix=yt.viewportMatrix,c.collisionCircleArray=yt.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}},xe.prototype.symbolFadeChange=function(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},xe.prototype.zoomAdjustment=function(c){return Math.max(0,(this.transform.zoom-c)/1.5)},xe.prototype.hasTransitions=function(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration},xe.prototype.stillRecent=function(c,d){var f=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*f>c},xe.prototype.setStale=function(){this.stale=!0};var zi=Math.pow(2,25),Si=Math.pow(2,24),kn=Math.pow(2,17),Po=Math.pow(2,16),ho=Math.pow(2,9),os=Math.pow(2,8),Of=Math.pow(2,1);function bh(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;var d=c.placed?1:0,f=Math.floor(127*c.opacity);return f*zi+d*Si+f*kn+d*Po+f*ho+d*os+f*Of+d}var wa=0,Cc=function(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&c.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Cc.prototype.continuePlacement=function(c,d,f,m,E){for(var P=this._bucketParts;this._currentTileIndex<c.length;)if(d.getBucketParts(P,m,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort(function(R,F){return R.sortKey-F.sortKey}));this._currentPartIndex<P.length;)if(d.placeLayerBucketPart(P[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,E())return!0;return!1};var Ec=function(c,d,f,m,E,P,R){this.placement=new xe(c,E,P,R),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=m,this._done=!1};Ec.prototype.isDone=function(){return this._done},Ec.prototype.continuePlacement=function(c,d,f){for(var m=this,E=o.browser.now(),P=function(){var U=o.browser.now()-E;return!m._forceFullPlacement&&U>2};this._currentPlacementIndex>=0;){var R=d[c[this._currentPlacementIndex]],F=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=F)&&(!R.maxzoom||R.maxzoom>F)){if(this._inProgressLayer||(this._inProgressLayer=new Cc(R)),this._inProgressLayer.continuePlacement(f[R.source],this.placement,this._showCollisionBoxes,R,P))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Ec.prototype.commit=function(c){return this.placement.commit(c),this.placement};var Lf=512/o.EXTENT/2,Bc=function(c,d,f){this.tileID=c,this.indexedSymbolInstances={},this.bucketInstanceId=f;for(var m=0;m<d.length;m++){var E=d.get(m),P=E.key;this.indexedSymbolInstances[P]||(this.indexedSymbolInstances[P]=[]),this.indexedSymbolInstances[P].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,c)})}};Bc.prototype.getScaledCoordinates=function(c,d){var f=Lf/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*o.EXTENT+c.anchorX)*f),y:Math.floor((d.canonical.y*o.EXTENT+c.anchorY)*f)}},Bc.prototype.findMatches=function(c,d,f){for(var m=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),E=0;E<c.length;E++){var P=c.get(E);if(!P.crossTileID){var R=this.indexedSymbolInstances[P.key];if(R)for(var F=this.getScaledCoordinates(P,d),U=0,J=R;U<J.length;U+=1){var et=J[U];if(Math.abs(et.coord.x-F.x)<=m&&Math.abs(et.coord.y-F.y)<=m&&!f[et.crossTileID]){f[et.crossTileID]=!0,P.crossTileID=et.crossTileID;break}}}}};var Wo=function(){this.maxCrossTileID=0};Wo.prototype.generate=function(){return++this.maxCrossTileID};var Zs=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Zs.prototype.handleWrapJump=function(c){var d=Math.round((c-this.lng)/360);if(d!==0)for(var f in this.indexes){var m=this.indexes[f],E={};for(var P in m){var R=m[P];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+d),E[R.tileID.key]=R}this.indexes[f]=E}this.lng=c},Zs.prototype.addBucket=function(c,d,f){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(var m=0;m<d.symbolInstances.length;m++)d.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});var E=this.usedCrossTileIDs[c.overscaledZ];for(var P in this.indexes){var R=this.indexes[P];if(Number(P)>c.overscaledZ)for(var F in R){var U=R[F];U.tileID.isChildOf(c)&&U.findMatches(d.symbolInstances,c,E)}else{var J=R[c.scaledTo(Number(P)).key];J&&J.findMatches(d.symbolInstances,c,E)}}for(var et=0;et<d.symbolInstances.length;et++){var $=d.symbolInstances.get(et);$.crossTileID||($.crossTileID=f.generate(),E[$.crossTileID]=!0)}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new Bc(c,d.symbolInstances,d.bucketInstanceId),!0},Zs.prototype.removeBucketCrossTileIDs=function(c,d){for(var f in d.indexedSymbolInstances)for(var m=0,E=d.indexedSymbolInstances[f];m<E.length;m+=1)delete this.usedCrossTileIDs[c][E[m].crossTileID]},Zs.prototype.removeStaleBuckets=function(c){var d=!1;for(var f in this.indexes){var m=this.indexes[f];for(var E in m)c[m[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,m[E]),delete m[E],d=!0)}return d};var Ca=function(){this.layerIndexes={},this.crossTileIDs=new Wo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Ca.prototype.addLayer=function(c,d,f){var m=this.layerIndexes[c.id];m===void 0&&(m=this.layerIndexes[c.id]=new Zs);var E=!1,P={};m.handleWrapJump(f);for(var R=0,F=d;R<F.length;R+=1){var U=F[R],J=U.getBucket(c);J&&c.id===J.layerIds[0]&&(J.bucketInstanceId||(J.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(U.tileID,J,this.crossTileIDs)&&(E=!0),P[J.bucketInstanceId]=!0)}return m.removeStaleBuckets(P)&&(E=!0),E},Ca.prototype.pruneUnusedLayers=function(c){var d={};for(var f in c.forEach(function(m){d[m]=!0}),this.layerIndexes)d[f]||delete this.layerIndexes[f]};var Qa=function(c,d){return o.emitValidationErrors(c,d&&d.filter(function(f){return f.identifier!=="source.canvas"}))},Ea=o.pick(He,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),br=o.pick(He,["setCenter","setZoom","setBearing","setPitch"]),Ls=function(){var c={},d=o.styleSpec.$version;for(var f in o.styleSpec.$root){var m,E=o.styleSpec.$root[f];E.required&&(m=f==="version"?d:E.type==="array"?[]:{})!=null&&(c[f]=m)}return c}(),jn=function(c){function d(f,m){var E=this;m===void 0&&(m={}),c.call(this),this.map=f,this.dispatcher=new Mt(fe(),this),this.imageManager=new q,this.imageManager.setEventedParent(this),this.glyphManager=new At(f._requestManager,m.localIdeographFontFamily),this.lineAtlas=new ht(256,512),this.crossTileSymbolIndex=new Ca,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());var P=this;this._rtlTextPluginCallback=d.registerForPluginStateChange(function(R){P.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:R.pluginStatus,pluginURL:R.pluginURL},function(F,U){if(o.triggerPluginCompletionEvent(F),U&&U.every(function(et){return et}))for(var J in P.sourceCaches)P.sourceCaches[J].reload()})}),this.on("data",function(R){if(R.dataType==="source"&&R.sourceDataType==="metadata"){var F=E.sourceCaches[R.sourceId];if(F){var U=F.getSource();if(U&&U.vectorLayerIds)for(var J in E._layers){var et=E._layers[J];et.source===U.id&&E._validateLayer(et)}}}})}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.loadURL=function(f,m){var E=this;m===void 0&&(m={}),this.fire(new o.Event("dataloading",{dataType:"style"}));var P=typeof m.validate=="boolean"?m.validate:!o.isMapboxURL(f);f=this.map._requestManager.normalizeStyleURL(f,m.accessToken);var R=this.map._requestManager.transformRequest(f,o.ResourceType.Style);this._request=o.getJSON(R,function(F,U){E._request=null,F?E.fire(new o.ErrorEvent(F)):U&&E._load(U,P)})},d.prototype.loadJSON=function(f,m){var E=this;m===void 0&&(m={}),this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.browser.frame(function(){E._request=null,E._load(f,m.validate!==!1)})},d.prototype.loadEmpty=function(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(Ls,!1)},d.prototype._load=function(f,m){if(!m||!Qa(this,o.validateStyle(f))){for(var E in this._loaded=!0,this.stylesheet=f,f.sources)this.addSource(E,f.sources[E],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs);var P=Me(this.stylesheet.layers);this._order=P.map(function(J){return J.id}),this._layers={},this._serializedLayers={};for(var R=0,F=P;R<F.length;R+=1){var U=F[R];(U=o.createStyleLayer(U)).setEventedParent(this,{layer:{id:U.id}}),this._layers[U.id]=U,this._serializedLayers[U.id]=U.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new X(this.stylesheet.light),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}},d.prototype._loadSprite=function(f){var m=this;this._spriteRequest=function(E,P,R){var F,U,J,et=o.browser.devicePixelRatio>1?"@2x":"",$=o.getJSON(P.transformRequest(P.normalizeSpriteURL(E,et,".json"),o.ResourceType.SpriteJSON),function(xt,Rt){$=null,J||(J=xt,F=Rt,st())}),it=o.getImage(P.transformRequest(P.normalizeSpriteURL(E,et,".png"),o.ResourceType.SpriteImage),function(xt,Rt){it=null,J||(J=xt,U=Rt,st())});function st(){if(J)R(J);else if(F&&U){var xt=o.browser.getImageData(U),Rt={};for(var yt in F){var It=F[yt],Ht=It.width,Xt=It.height,ee=It.x,Qt=It.y,$t=It.sdf,Ae=It.pixelRatio,Le=It.stretchX,we=It.stretchY,Ge=It.content,si=new o.RGBAImage({width:Ht,height:Xt});o.RGBAImage.copy(xt,si,{x:ee,y:Qt},{x:0,y:0},{width:Ht,height:Xt}),Rt[yt]={data:si,pixelRatio:Ae,sdf:$t,stretchX:Le,stretchY:we,content:Ge}}R(null,Rt)}}return{cancel:function(){$&&($.cancel(),$=null),it&&(it.cancel(),it=null)}}}(f,this.map._requestManager,function(E,P){if(m._spriteRequest=null,E)m.fire(new o.ErrorEvent(E));else if(P)for(var R in P)m.imageManager.addImage(R,P[R]);m.imageManager.setLoaded(!0),m._availableImages=m.imageManager.listImages(),m.dispatcher.broadcast("setImages",m._availableImages),m.fire(new o.Event("data",{dataType:"style"}))})},d.prototype._validateLayer=function(f){var m=this.sourceCaches[f.source];if(m){var E=f.sourceLayer;if(E){var P=m.getSource();(P.type==="geojson"||P.vectorLayerIds&&P.vectorLayerIds.indexOf(E)===-1)&&this.fire(new o.ErrorEvent(new Error('Source layer "'+E+'" does not exist on source "'+P.id+'" as specified by style layer "'+f.id+'"')))}}},d.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var f in this.sourceCaches)if(!this.sourceCaches[f].loaded())return!1;return!!this.imageManager.isLoaded()},d.prototype._serializeLayers=function(f){for(var m=[],E=0,P=f;E<P.length;E+=1){var R=this._layers[P[E]];R.type!=="custom"&&m.push(R.serialize())}return m},d.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var f in this.sourceCaches)if(this.sourceCaches[f].hasTransition())return!0;for(var m in this._layers)if(this._layers[m].hasTransition())return!0;return!1},d.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},d.prototype.update=function(f){if(this._loaded){var m=this._changed;if(this._changed){var E=Object.keys(this._updatedLayers),P=Object.keys(this._removedLayers);for(var R in(E.length||P.length)&&this._updateWorkerLayers(E,P),this._updatedSources){var F=this._updatedSources[R];F==="reload"?this._reloadSource(R):F==="clear"&&this._clearSource(R)}for(var U in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[U].updateTransitions(f);this.light.updateTransitions(f),this._resetUpdates()}var J={};for(var et in this.sourceCaches){var $=this.sourceCaches[et];J[et]=$.used,$.used=!1}for(var it=0,st=this._order;it<st.length;it+=1){var xt=this._layers[st[it]];xt.recalculate(f,this._availableImages),!xt.isHidden(f.zoom)&&xt.source&&(this.sourceCaches[xt.source].used=!0)}for(var Rt in J){var yt=this.sourceCaches[Rt];J[Rt]!==yt.used&&yt.fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Rt}))}this.light.recalculate(f),this.z=f.zoom,m&&this.fire(new o.Event("data",{dataType:"style"}))}},d.prototype._updateTilesForChangedImages=function(){var f=Object.keys(this._changedImages);if(f.length){for(var m in this.sourceCaches)this.sourceCaches[m].reloadTilesForDependencies(["icons","patterns"],f);this._changedImages={}}},d.prototype._updateWorkerLayers=function(f,m){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(f),removedIds:m})},d.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},d.prototype.setState=function(f){var m=this;if(this._checkLoaded(),Qa(this,o.validateStyle(f)))return!1;(f=o.clone$1(f)).layers=Me(f.layers);var E=function(R,F){if(!R)return[{command:He.setStyle,args:[F]}];var U=[];try{if(!o.deepEqual(R.version,F.version))return[{command:He.setStyle,args:[F]}];o.deepEqual(R.center,F.center)||U.push({command:He.setCenter,args:[F.center]}),o.deepEqual(R.zoom,F.zoom)||U.push({command:He.setZoom,args:[F.zoom]}),o.deepEqual(R.bearing,F.bearing)||U.push({command:He.setBearing,args:[F.bearing]}),o.deepEqual(R.pitch,F.pitch)||U.push({command:He.setPitch,args:[F.pitch]}),o.deepEqual(R.sprite,F.sprite)||U.push({command:He.setSprite,args:[F.sprite]}),o.deepEqual(R.glyphs,F.glyphs)||U.push({command:He.setGlyphs,args:[F.glyphs]}),o.deepEqual(R.transition,F.transition)||U.push({command:He.setTransition,args:[F.transition]}),o.deepEqual(R.light,F.light)||U.push({command:He.setLight,args:[F.light]});var J={},et=[];(function(it,st,xt,Rt){var yt;for(yt in st=st||{},it=it||{})it.hasOwnProperty(yt)&&(st.hasOwnProperty(yt)||ei(yt,xt,Rt));for(yt in st)st.hasOwnProperty(yt)&&(it.hasOwnProperty(yt)?o.deepEqual(it[yt],st[yt])||(it[yt].type==="geojson"&&st[yt].type==="geojson"&&ln(it,st,yt)?xt.push({command:He.setGeoJSONSourceData,args:[yt,st[yt].data]}):$i(yt,st,xt,Rt)):ki(yt,st,xt))})(R.sources,F.sources,et,J);var $=[];R.layers&&R.layers.forEach(function(it){J[it.source]?U.push({command:He.removeLayer,args:[it.id]}):$.push(it)}),U=U.concat(et),function(it,st,xt){st=st||[];var Rt,yt,It,Ht,Xt,ee,Qt,$t=(it=it||[]).map(Ji),Ae=st.map(Ji),Le=it.reduce(Gi,{}),we=st.reduce(Gi,{}),Ge=$t.slice(),si=Object.create(null);for(Rt=0,yt=0;Rt<$t.length;Rt++)we.hasOwnProperty(It=$t[Rt])?yt++:(xt.push({command:He.removeLayer,args:[It]}),Ge.splice(Ge.indexOf(It,yt),1));for(Rt=0,yt=0;Rt<Ae.length;Rt++)Ge[Ge.length-1-Rt]!==(It=Ae[Ae.length-1-Rt])&&(Le.hasOwnProperty(It)?(xt.push({command:He.removeLayer,args:[It]}),Ge.splice(Ge.lastIndexOf(It,Ge.length-yt),1)):yt++,xt.push({command:He.addLayer,args:[we[It],ee=Ge[Ge.length-Rt]]}),Ge.splice(Ge.length-Rt,0,It),si[It]=!0);for(Rt=0;Rt<Ae.length;Rt++)if(Ht=Le[It=Ae[Rt]],Xt=we[It],!si[It]&&!o.deepEqual(Ht,Xt))if(o.deepEqual(Ht.source,Xt.source)&&o.deepEqual(Ht["source-layer"],Xt["source-layer"])&&o.deepEqual(Ht.type,Xt.type)){for(Qt in Wi(Ht.layout,Xt.layout,xt,It,null,He.setLayoutProperty),Wi(Ht.paint,Xt.paint,xt,It,null,He.setPaintProperty),o.deepEqual(Ht.filter,Xt.filter)||xt.push({command:He.setFilter,args:[It,Xt.filter]}),o.deepEqual(Ht.minzoom,Xt.minzoom)&&o.deepEqual(Ht.maxzoom,Xt.maxzoom)||xt.push({command:He.setLayerZoomRange,args:[It,Xt.minzoom,Xt.maxzoom]}),Ht)Ht.hasOwnProperty(Qt)&&Qt!=="layout"&&Qt!=="paint"&&Qt!=="filter"&&Qt!=="metadata"&&Qt!=="minzoom"&&Qt!=="maxzoom"&&(Qt.indexOf("paint.")===0?Wi(Ht[Qt],Xt[Qt],xt,It,Qt.slice(6),He.setPaintProperty):o.deepEqual(Ht[Qt],Xt[Qt])||xt.push({command:He.setLayerProperty,args:[It,Qt,Xt[Qt]]}));for(Qt in Xt)Xt.hasOwnProperty(Qt)&&!Ht.hasOwnProperty(Qt)&&Qt!=="layout"&&Qt!=="paint"&&Qt!=="filter"&&Qt!=="metadata"&&Qt!=="minzoom"&&Qt!=="maxzoom"&&(Qt.indexOf("paint.")===0?Wi(Ht[Qt],Xt[Qt],xt,It,Qt.slice(6),He.setPaintProperty):o.deepEqual(Ht[Qt],Xt[Qt])||xt.push({command:He.setLayerProperty,args:[It,Qt,Xt[Qt]]}))}else xt.push({command:He.removeLayer,args:[It]}),ee=Ge[Ge.lastIndexOf(It)+1],xt.push({command:He.addLayer,args:[Xt,ee]})}($,F.layers,U)}catch(it){console.warn("Unable to compute style diff:",it),U=[{command:He.setStyle,args:[F]}]}return U}(this.serialize(),f).filter(function(R){return!(R.command in br)});if(E.length===0)return!1;var P=E.filter(function(R){return!(R.command in Ea)});if(P.length>0)throw new Error("Unimplemented: "+P.map(function(R){return R.command}).join(", ")+".");return E.forEach(function(R){R.command!=="setTransition"&&m[R.command].apply(m,R.args)}),this.stylesheet=f,!0},d.prototype.addImage=function(f,m){if(this.getImage(f))return this.fire(new o.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(f,m),this._afterImageUpdated(f)},d.prototype.updateImage=function(f,m){this.imageManager.updateImage(f,m)},d.prototype.getImage=function(f){return this.imageManager.getImage(f)},d.prototype.removeImage=function(f){if(!this.getImage(f))return this.fire(new o.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(f),this._afterImageUpdated(f)},d.prototype._afterImageUpdated=function(f){this._availableImages=this.imageManager.listImages(),this._changedImages[f]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))},d.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},d.prototype.addSource=function(f,m,E){var P=this;if(E===void 0&&(E={}),this._checkLoaded(),this.sourceCaches[f]!==void 0)throw new Error("There is already a source with this ID");if(!m.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(m).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(m.type)>=0&&this._validate(o.validateStyle.source,"sources."+f,m,null,E))){this.map&&this.map._collectResourceTiming&&(m.collectResourceTiming=!0);var R=this.sourceCaches[f]=new Et(f,m,this.dispatcher);R.style=this,R.setEventedParent(this,function(){return{isSourceLoaded:P.loaded(),source:R.serialize(),sourceId:f}}),R.onAdd(this.map),this._changed=!0}},d.prototype.removeSource=function(f){if(this._checkLoaded(),this.sourceCaches[f]===void 0)throw new Error("There is no source with this ID");for(var m in this._layers)if(this._layers[m].source===f)return this.fire(new o.ErrorEvent(new Error('Source "'+f+'" cannot be removed while layer "'+m+'" is using it.')));var E=this.sourceCaches[f];delete this.sourceCaches[f],delete this._updatedSources[f],E.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:f})),E.setEventedParent(null),E.clearTiles(),E.onRemove&&E.onRemove(this.map),this._changed=!0},d.prototype.setGeoJSONSourceData=function(f,m){this._checkLoaded(),this.sourceCaches[f].getSource().setData(m),this._changed=!0},d.prototype.getSource=function(f){return this.sourceCaches[f]&&this.sourceCaches[f].getSource()},d.prototype.addLayer=function(f,m,E){E===void 0&&(E={}),this._checkLoaded();var P=f.id;if(this.getLayer(P))this.fire(new o.ErrorEvent(new Error('Layer with id "'+P+'" already exists on this map')));else{var R;if(f.type==="custom"){if(Qa(this,o.validateCustomStyleLayer(f)))return;R=o.createStyleLayer(f)}else{if(typeof f.source=="object"&&(this.addSource(P,f.source),f=o.clone$1(f),f=o.extend(f,{source:P})),this._validate(o.validateStyle.layer,"layers."+P,f,{arrayIndex:-1},E))return;R=o.createStyleLayer(f),this._validateLayer(R),R.setEventedParent(this,{layer:{id:P}}),this._serializedLayers[R.id]=R.serialize()}var F=m?this._order.indexOf(m):this._order.length;if(m&&F===-1)this.fire(new o.ErrorEvent(new Error('Layer with id "'+m+'" does not exist on this map.')));else{if(this._order.splice(F,0,P),this._layerOrderChanged=!0,this._layers[P]=R,this._removedLayers[P]&&R.source&&R.type!=="custom"){var U=this._removedLayers[P];delete this._removedLayers[P],U.type!==R.type?this._updatedSources[R.source]="clear":(this._updatedSources[R.source]="reload",this.sourceCaches[R.source].pause())}this._updateLayer(R),R.onAdd&&R.onAdd(this.map)}}},d.prototype.moveLayer=function(f,m){if(this._checkLoaded(),this._changed=!0,this._layers[f]){if(f!==m){var E=this._order.indexOf(f);this._order.splice(E,1);var P=m?this._order.indexOf(m):this._order.length;m&&P===-1?this.fire(new o.ErrorEvent(new Error('Layer with id "'+m+'" does not exist on this map.'))):(this._order.splice(P,0,f),this._layerOrderChanged=!0)}}else this.fire(new o.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be moved.")))},d.prototype.removeLayer=function(f){this._checkLoaded();var m=this._layers[f];if(m){m.setEventedParent(null);var E=this._order.indexOf(f);this._order.splice(E,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[f]=m,delete this._layers[f],delete this._serializedLayers[f],delete this._updatedLayers[f],delete this._updatedPaintProps[f],m.onRemove&&m.onRemove(this.map)}else this.fire(new o.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be removed.")))},d.prototype.getLayer=function(f){return this._layers[f]},d.prototype.hasLayer=function(f){return f in this._layers},d.prototype.setLayerZoomRange=function(f,m,E){this._checkLoaded();var P=this.getLayer(f);P?P.minzoom===m&&P.maxzoom===E||(m!=null&&(P.minzoom=m),E!=null&&(P.maxzoom=E),this._updateLayer(P)):this.fire(new o.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot have zoom extent.")))},d.prototype.setFilter=function(f,m,E){E===void 0&&(E={}),this._checkLoaded();var P=this.getLayer(f);if(P){if(!o.deepEqual(P.filter,m))return m==null?(P.filter=void 0,void this._updateLayer(P)):void(this._validate(o.validateStyle.filter,"layers."+P.id+".filter",m,null,E)||(P.filter=o.clone$1(m),this._updateLayer(P)))}else this.fire(new o.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be filtered.")))},d.prototype.getFilter=function(f){return o.clone$1(this.getLayer(f).filter)},d.prototype.setLayoutProperty=function(f,m,E,P){P===void 0&&(P={}),this._checkLoaded();var R=this.getLayer(f);R?o.deepEqual(R.getLayoutProperty(m),E)||(R.setLayoutProperty(m,E,P),this._updateLayer(R)):this.fire(new o.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getLayoutProperty=function(f,m){var E=this.getLayer(f);if(E)return E.getLayoutProperty(m);this.fire(new o.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style.")))},d.prototype.setPaintProperty=function(f,m,E,P){P===void 0&&(P={}),this._checkLoaded();var R=this.getLayer(f);R?o.deepEqual(R.getPaintProperty(m),E)||(R.setPaintProperty(m,E,P)&&this._updateLayer(R),this._changed=!0,this._updatedPaintProps[f]=!0):this.fire(new o.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getPaintProperty=function(f,m){return this.getLayer(f).getPaintProperty(m)},d.prototype.setFeatureState=function(f,m){this._checkLoaded();var E=f.source,P=f.sourceLayer,R=this.sourceCaches[E];if(R!==void 0){var F=R.getSource().type;F==="geojson"&&P?this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):F!=="vector"||P?(f.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),R.setFeatureState(P,f.id,m)):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},d.prototype.removeFeatureState=function(f,m){this._checkLoaded();var E=f.source,P=this.sourceCaches[E];if(P!==void 0){var R=P.getSource().type,F=R==="vector"?f.sourceLayer:void 0;R!=="vector"||F?m&&typeof f.id!="string"&&typeof f.id!="number"?this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):P.removeFeatureState(F,f.id,m):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},d.prototype.getFeatureState=function(f){this._checkLoaded();var m=f.source,E=f.sourceLayer,P=this.sourceCaches[m];if(P!==void 0){if(P.getSource().type!=="vector"||E)return f.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),P.getFeatureState(E,f.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error("The source '"+m+"' does not exist in the map's style.")))},d.prototype.getTransition=function(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},d.prototype.serialize=function(){return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:o.mapObject(this.sourceCaches,function(f){return f.serialize()}),layers:this._serializeLayers(this._order)},function(f){return f!==void 0})},d.prototype._updateLayer=function(f){this._updatedLayers[f.id]=!0,f.source&&!this._updatedSources[f.source]&&this.sourceCaches[f.source].getSource().type!=="raster"&&(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause()),this._changed=!0},d.prototype._flattenAndSortRenderedFeatures=function(f){for(var m=this,E=function(Le){return m._layers[Le].type==="fill-extrusion"},P={},R=[],F=this._order.length-1;F>=0;F--){var U=this._order[F];if(E(U)){P[U]=F;for(var J=0,et=f;J<et.length;J+=1){var $=et[J][U];if($)for(var it=0,st=$;it<st.length;it+=1)R.push(st[it])}}}R.sort(function(Le,we){return we.intersectionZ-Le.intersectionZ});for(var xt=[],Rt=this._order.length-1;Rt>=0;Rt--){var yt=this._order[Rt];if(E(yt))for(var It=R.length-1;It>=0;It--){var Ht=R[It].feature;if(P[Ht.layer.id]<Rt)break;xt.push(Ht),R.pop()}else for(var Xt=0,ee=f;Xt<ee.length;Xt+=1){var Qt=ee[Xt][yt];if(Qt)for(var $t=0,Ae=Qt;$t<Ae.length;$t+=1)xt.push(Ae[$t].feature)}}return xt},d.prototype.queryRenderedFeatures=function(f,m,E){m&&m.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",m.filter,null,m);var P={};if(m&&m.layers){if(!Array.isArray(m.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var R=0,F=m.layers;R<F.length;R+=1){var U=F[R],J=this._layers[U];if(!J)return this.fire(new o.ErrorEvent(new Error("The layer '"+U+"' does not exist in the map's style and cannot be queried for features."))),[];P[J.source]=!0}}var et=[];for(var $ in m.availableImages=this._availableImages,this.sourceCaches)m.layers&&!P[$]||et.push(Ze(this.sourceCaches[$],this._layers,this._serializedLayers,f,m,E));return this.placement&&et.push(function(it,st,xt,Rt,yt,It,Ht){for(var Xt={},ee=It.queryRenderedSymbols(Rt),Qt=[],$t=0,Ae=Object.keys(ee).map(Number);$t<Ae.length;$t+=1)Qt.push(Ht[Ae[$t]]);Qt.sort(Ye);for(var Le=function(){var Ti=Ge[we],xn=Ti.featureIndex.lookupSymbolFeatures(ee[Ti.bucketInstanceId],st,Ti.bucketIndex,Ti.sourceLayerIndex,yt.filter,yt.layers,yt.availableImages,it);for(var li in xn){var Hi=Xt[li]=Xt[li]||[],en=xn[li];en.sort(function(Zi,Li){var Di=Ti.featureSortOrder;if(Di){var Qr=Di.indexOf(Zi.featureIndex);return Di.indexOf(Li.featureIndex)-Qr}return Li.featureIndex-Zi.featureIndex});for(var ji=0,Ui=en;ji<Ui.length;ji+=1)Hi.push(Ui[ji])}},we=0,Ge=Qt;we<Ge.length;we+=1)Le();var si=function(Ti){Xt[Ti].forEach(function(xn){var li=xn.feature,Hi=xt[it[Ti].source].getFeatureState(li.layer["source-layer"],li.id);li.source=li.layer.source,li.layer["source-layer"]&&(li.sourceLayer=li.layer["source-layer"]),li.state=Hi})};for(var Ci in Xt)si(Ci);return Xt}(this._layers,this._serializedLayers,this.sourceCaches,f,m,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(et)},d.prototype.querySourceFeatures=function(f,m){m&&m.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",m.filter,null,m);var E=this.sourceCaches[f];return E?function(P,R){for(var F=P.getRenderableIds().map(function(st){return P.getTileByID(st)}),U=[],J={},et=0;et<F.length;et++){var $=F[et],it=$.tileID.canonical.key;J[it]||(J[it]=!0,$.querySourceFeatures(U,R))}return U}(E,m):[]},d.prototype.addSourceType=function(f,m,E){return d.getSourceType(f)?E(new Error('A source type called "'+f+'" already exists.')):(d.setSourceType(f,m),m.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:f,url:m.workerSourceURL},E):E(null,null))},d.prototype.getLight=function(){return this.light.getLight()},d.prototype.setLight=function(f,m){m===void 0&&(m={}),this._checkLoaded();var E=this.light.getLight(),P=!1;for(var R in f)if(!o.deepEqual(f[R],E[R])){P=!0;break}if(P){var F={now:o.browser.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(f,m),this.light.updateTransitions(F)}},d.prototype._validate=function(f,m,E,P,R){return R===void 0&&(R={}),(!R||R.validate!==!1)&&Qa(this,f.call(o.validateStyle,o.extend({key:m,style:this.serialize(),value:E,styleSpec:o.styleSpec},P)))},d.prototype._remove=function(){for(var f in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[f].setEventedParent(null);for(var m in this.sourceCaches)this.sourceCaches[m].clearTiles(),this.sourceCaches[m].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},d.prototype._clearSource=function(f){this.sourceCaches[f].clearTiles()},d.prototype._reloadSource=function(f){this.sourceCaches[f].resume(),this.sourceCaches[f].reload()},d.prototype._updateSources=function(f){for(var m in this.sourceCaches)this.sourceCaches[m].update(f)},d.prototype._generateCollisionBoxes=function(){for(var f in this.sourceCaches)this._reloadSource(f)},d.prototype._updatePlacement=function(f,m,E,P,R){R===void 0&&(R=!1);for(var F=!1,U=!1,J={},et=0,$=this._order;et<$.length;et+=1){var it=this._layers[$[et]];if(it.type==="symbol"){if(!J[it.source]){var st=this.sourceCaches[it.source];J[it.source]=st.getRenderableIds(!0).map(function(Ht){return st.getTileByID(Ht)}).sort(function(Ht,Xt){return Xt.tileID.overscaledZ-Ht.tileID.overscaledZ||(Ht.tileID.isLessThan(Xt.tileID)?-1:1)})}var xt=this.crossTileSymbolIndex.addLayer(it,J[it.source],f.center.lng);F=F||xt}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((R=R||this._layerOrderChanged||E===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.browser.now(),f.zoom))&&(this.pauseablePlacement=new Ec(f,this._order,R,m,E,P,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,J),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.browser.now()),U=!0),F&&this.pauseablePlacement.placement.setStale()),U||F)for(var Rt=0,yt=this._order;Rt<yt.length;Rt+=1){var It=this._layers[yt[Rt]];It.type==="symbol"&&this.placement.updateLayerOpacities(It,J[It.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.browser.now())},d.prototype._releaseSymbolFadeTiles=function(){for(var f in this.sourceCaches)this.sourceCaches[f].releaseSymbolFadeTiles()},d.prototype.getImages=function(f,m,E){this.imageManager.getImages(m.icons,E),this._updateTilesForChangedImages();var P=this.sourceCaches[m.source];P&&P.setDependencies(m.tileID.key,m.type,m.icons)},d.prototype.getGlyphs=function(f,m,E){this.glyphManager.getGlyphs(m.stacks,E)},d.prototype.getResource=function(f,m,E){return o.makeRequest(m,E)},d}(o.Evented);jn.getSourceType=function(c){return se[c]},jn.setSourceType=function(c,d){se[c]=d},jn.registerForPluginStateChange=o.registerForPluginStateChange;var dr=o.createLayout([{name:"a_pos",type:"Int16",components:2}]),Za=Mn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Tc=Mn(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),aA=Mn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),lA=Mn(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),xh=Mn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),fu=Mn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Dl=Mn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Ys=Mn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),wh=Mn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),Ch=Mn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),du=Mn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Es=Mn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ss=Mn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Eh=Mn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Ur=Mn(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Sc=Mn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Ba=Mn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Ta=Mn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Sa=Mn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Ya=Mn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Ia=Mn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),qa=Mn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),$a=Mn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Ma=Mn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Ff=Mn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),kf=Mn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Mn(c,d){var f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=d.match(/attribute ([\w]+) ([\w]+)/g),E=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=P?P.concat(E):E,F={};return{fragmentSource:c=c.replace(f,function(U,J,et,$,it){return F[it]=!0,J==="define"?`
#ifndef HAS_UNIFORM_u_`+it+`
varying `+et+" "+$+" "+it+`;
#else
uniform `+et+" "+$+" u_"+it+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+it+`
    `+et+" "+$+" "+it+" = u_"+it+`;
#endif
`}),vertexSource:d=d.replace(f,function(U,J,et,$,it){var st=$==="float"?"vec2":"vec4",xt=it.match(/color/)?"color":st;return F[it]?J==="define"?`
#ifndef HAS_UNIFORM_u_`+it+`
uniform lowp float u_`+it+`_t;
attribute `+et+" "+st+" a_"+it+`;
varying `+et+" "+$+" "+it+`;
#else
uniform `+et+" "+$+" u_"+it+`;
#endif
`:xt==="vec4"?`
#ifndef HAS_UNIFORM_u_`+it+`
    `+it+" = a_"+it+`;
#else
    `+et+" "+$+" "+it+" = u_"+it+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+it+`
    `+it+" = unpack_mix_"+xt+"(a_"+it+", u_"+it+`_t);
#else
    `+et+" "+$+" "+it+" = u_"+it+`;
#endif
`:J==="define"?`
#ifndef HAS_UNIFORM_u_`+it+`
uniform lowp float u_`+it+`_t;
attribute `+et+" "+st+" a_"+it+`;
#else
uniform `+et+" "+$+" u_"+it+`;
#endif
`:xt==="vec4"?`
#ifndef HAS_UNIFORM_u_`+it+`
    `+et+" "+$+" "+it+" = a_"+it+`;
#else
    `+et+" "+$+" "+it+" = u_"+it+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+it+`
    `+et+" "+$+" "+it+" = unpack_mix_"+xt+"(a_"+it+", u_"+it+`_t);
#else
    `+et+" "+$+" "+it+" = u_"+it+`;
#endif
`}),staticAttributes:m,staticUniforms:R}}var pu=Object.freeze({__proto__:null,prelude:Za,background:Tc,backgroundPattern:aA,circle:lA,clippingMask:xh,heatmap:fu,heatmapTexture:Dl,collisionBox:Ys,collisionCircle:wh,debug:Ch,fill:du,fillOutline:Es,fillOutlinePattern:ss,fillPattern:Eh,fillExtrusion:Ur,fillExtrusionPattern:Sc,hillshadePrepare:Ba,hillshade:Ta,line:Sa,lineGradient:Ya,linePattern:Ia,lineSDF:qa,raster:$a,symbolIcon:Ma,symbolSDF:Ff,symbolTextAndIcon:kf}),Au=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Nf(c){for(var d=[],f=0;f<c.length;f++)if(c[f]!==null){var m=c[f].split(" ");d.push(m.pop())}return d}Au.prototype.bind=function(c,d,f,m,E,P,R,F){this.context=c;for(var U=this.boundPaintVertexBuffers.length!==m.length,J=0;!U&&J<m.length;J++)this.boundPaintVertexBuffers[J]!==m[J]&&(U=!0);c.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===f&&!U&&this.boundIndexBuffer===E&&this.boundVertexOffset===P&&this.boundDynamicVertexBuffer===R&&this.boundDynamicVertexBuffer2===F?(c.bindVertexArrayOES.set(this.vao),R&&R.bind(),E&&E.dynamicDraw&&E.bind(),F&&F.bind()):this.freshBind(d,f,m,E,P,R,F)},Au.prototype.freshBind=function(c,d,f,m,E,P,R){var F,U=c.numAttributes,J=this.context,et=J.gl;if(J.extVertexArrayObject)this.vao&&this.destroy(),this.vao=J.extVertexArrayObject.createVertexArrayOES(),J.bindVertexArrayOES.set(this.vao),F=0,this.boundProgram=c,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=m,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=R;else{F=J.currentNumAttributes||0;for(var $=U;$<F;$++)et.disableVertexAttribArray($)}d.enableAttributes(et,c);for(var it=0,st=f;it<st.length;it+=1)st[it].enableAttributes(et,c);P&&P.enableAttributes(et,c),R&&R.enableAttributes(et,c),d.bind(),d.setVertexAttribPointers(et,c,E);for(var xt=0,Rt=f;xt<Rt.length;xt+=1){var yt=Rt[xt];yt.bind(),yt.setVertexAttribPointers(et,c,E)}P&&(P.bind(),P.setVertexAttribPointers(et,c,E)),m&&m.bind(),R&&(R.bind(),R.setVertexAttribPointers(et,c,E)),J.currentNumAttributes=U},Au.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Uf=function(c,d,f,m,E,P){var R=c.gl;this.program=R.createProgram();for(var F=Nf(f.staticAttributes),U=m?m.getBinderAttributes():[],J=F.concat(U),et=f.staticUniforms?Nf(f.staticUniforms):[],$=m?m.getBinderUniforms():[],it=[],st=0,xt=et.concat($);st<xt.length;st+=1){var Rt=xt[st];it.indexOf(Rt)<0&&it.push(Rt)}var yt=m?m.defines():[];P&&yt.push("#define OVERDRAW_INSPECTOR;");var It=yt.concat(Za.fragmentSource,f.fragmentSource).join(`
`),Ht=yt.concat(Za.vertexSource,f.vertexSource).join(`
`),Xt=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(Xt,It),R.compileShader(Xt),R.attachShader(this.program,Xt);var ee=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(ee,Ht),R.compileShader(ee),R.attachShader(this.program,ee),this.attributes={};var Qt={};this.numAttributes=J.length;for(var $t=0;$t<this.numAttributes;$t++)J[$t]&&(R.bindAttribLocation(this.program,$t,J[$t]),this.attributes[J[$t]]=$t);R.linkProgram(this.program),R.deleteShader(ee),R.deleteShader(Xt);for(var Ae=0;Ae<it.length;Ae++){var Le=it[Ae];if(Le&&!Qt[Le]){var we=R.getUniformLocation(this.program,Le);we&&(Qt[Le]=we)}}this.fixedUniforms=E(c,Qt),this.binderUniforms=m?m.getUniforms(c,Qt):[]}}};function Ol(c,d,f){var m=1/Dn(f,1,d.transform.tileZoom),E=Math.pow(2,f.tileID.overscaledZ),P=f.tileSize*Math.pow(2,d.transform.tileZoom)/E,R=P*(f.tileID.canonical.x+f.tileID.wrap*E),F=P*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[m,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[R>>16,F>>16],u_pixel_coord_lower:[65535&R,65535&F]}}Uf.prototype.draw=function(c,d,f,m,E,P,R,F,U,J,et,$,it,st,xt,Rt){var yt,It=c.gl;if(!this.failedToCreate){for(var Ht in c.program.set(this.program),c.setDepthMode(f),c.setStencilMode(m),c.setColorMode(E),c.setCullFace(P),this.fixedUniforms)this.fixedUniforms[Ht].set(R[Ht]);st&&st.setUniforms(c,this.binderUniforms,$,{zoom:it});for(var Xt=(yt={},yt[It.LINES]=2,yt[It.TRIANGLES]=3,yt[It.LINE_STRIP]=1,yt)[d],ee=0,Qt=et.get();ee<Qt.length;ee+=1){var $t=Qt[ee],Ae=$t.vaos||($t.vaos={});(Ae[F]||(Ae[F]=new Au)).bind(c,this,U,st?st.getPaintVertexBuffers():[],J,$t.vertexOffset,xt,Rt),It.drawElements(d,$t.primitiveLength*Xt,It.UNSIGNED_SHORT,$t.primitiveOffset*Xt*2)}}};var Gf=function(c,d,f,m){var E=d.style.light,P=E.properties.get("position"),R=[P.x,P.y,P.z],F=o.create$1();E.properties.get("anchor")==="viewport"&&o.fromRotation(F,-d.transform.angle),o.transformMat3(R,R,F);var U=E.properties.get("color");return{u_matrix:c,u_lightpos:R,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[U.r,U.g,U.b],u_vertical_gradient:+f,u_opacity:m}},qs=function(c,d,f,m,E,P,R){return o.extend(Gf(c,d,f,m),Ol(P,d,R),{u_height_factor:-Math.pow(2,E.overscaledZ)/R.tileSize/8})},$s=function(c){return{u_matrix:c}},as=function(c,d,f,m){return o.extend($s(c),Ol(f,d,m))},zf=function(c,d){return{u_matrix:c,u_world:d}},gu=function(c,d,f,m,E){return o.extend(as(c,d,f,m),{u_world:E})},mu=function(c,d,f,m){var E,P,R=c.transform;if(m.paint.get("circle-pitch-alignment")==="map"){var F=Dn(f,1,R.zoom);E=!0,P=[F,F]}else E=!1,P=R.pixelsToGLUnits;return{u_camera_to_center_distance:R.cameraToCenterDistance,u_scale_with_map:+(m.paint.get("circle-pitch-scale")==="map"),u_matrix:c.translatePosMatrix(d.posMatrix,f,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:o.browser.devicePixelRatio,u_extrude_scale:P}},tl=function(c,d,f){var m=Dn(f,1,d.zoom),E=Math.pow(2,d.zoom-f.tileID.overscaledZ),P=f.tileID.overscaleFactor();return{u_matrix:c,u_camera_to_center_distance:d.cameraToCenterDistance,u_pixels_to_tile_units:m,u_extrude_scale:[d.pixelsToGLUnits[0]/(m*E),d.pixelsToGLUnits[1]/(m*E)],u_overscale_factor:P}},Bh=function(c,d,f){return{u_matrix:c,u_inv_matrix:d,u_camera_to_center_distance:f.cameraToCenterDistance,u_viewport_size:[f.width,f.height]}},ta=function(c,d,f){return f===void 0&&(f=1),{u_matrix:c,u_color:d,u_overlay:0,u_overlay_scale:f}},ea=function(c){return{u_matrix:c}},Ic=function(c,d,f,m){return{u_matrix:c,u_extrude_scale:Dn(d,1,f),u_intensity:m}},On=function(c,d,f){var m=c.transform;return{u_matrix:Vf(c,d,f),u_ratio:1/Dn(d,1,m.zoom),u_device_pixel_ratio:o.browser.devicePixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Nn=function(c,d,f,m){return o.extend(On(c,d,f),{u_image:0,u_image_height:m})},yu=function(c,d,f,m){var E=c.transform,P=Ll(d,E);return{u_matrix:Vf(c,d,f),u_texsize:d.imageAtlasTexture.size,u_ratio:1/Dn(d,1,E.zoom),u_device_pixel_ratio:o.browser.devicePixelRatio,u_image:0,u_scale:[P,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},cA=function(c,d,f,m,E){var P=c.lineAtlas,R=Ll(d,c.transform),F=f.layout.get("line-cap")==="round",U=P.getDash(m.from,F),J=P.getDash(m.to,F),et=U.width*E.fromScale,$=J.width*E.toScale;return o.extend(On(c,d,f),{u_patternscale_a:[R/et,-U.height/2],u_patternscale_b:[R/$,-J.height/2],u_sdfgamma:P.width/(256*Math.min(et,$)*o.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:U.y,u_tex_y_b:J.y,u_mix:E.t})};function Ll(c,d){return 1/Dn(c,1,d.tileZoom)}function Vf(c,d,f){return c.translatePosMatrix(d.tileID.posMatrix,d,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}var uA=function(c,d,f,m,E){return{u_matrix:c,u_tl_parent:d,u_scale_parent:f,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(R=E.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(P=E.paint.get("raster-contrast"),P>0?1/(1-P):1+P),u_spin_weights:jf(E.paint.get("raster-hue-rotate"))};var P,R};function jf(c){c*=Math.PI/180;var d=Math.sin(c),f=Math.cos(c);return[(2*f+1)/3,(-Math.sqrt(3)*d-f+1)/3,(Math.sqrt(3)*d-f+1)/3]}var io,Pa=function(c,d,f,m,E,P,R,F,U,J){var et=E.transform;return{u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:d?d.uSizeT:0,u_size:d?d.uSize:0,u_camera_to_center_distance:et.cameraToCenterDistance,u_pitch:et.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:et.width/et.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:P,u_label_plane_matrix:R,u_coord_matrix:F,u_is_text:+U,u_pitch_with_map:+m,u_texsize:J,u_texture:0}},Bs=function(c,d,f,m,E,P,R,F,U,J,et){var $=E.transform;return o.extend(Pa(c,d,f,m,E,P,R,F,U,J),{u_gamma_scale:m?Math.cos($._pitch)*$.cameraToCenterDistance:1,u_device_pixel_ratio:o.browser.devicePixelRatio,u_is_halo:1})},_u=function(c,d,f,m,E,P,R,F,U,J){return o.extend(Bs(c,d,f,m,E,P,R,F,!0,U),{u_texsize_icon:J,u_texture_icon:1})},el=function(c,d,f){return{u_matrix:c,u_opacity:d,u_color:f}},Fl=function(c,d,f,m,E,P){return o.extend(function(R,F,U,J){var et=U.imageManager.getPattern(R.from.toString()),$=U.imageManager.getPattern(R.to.toString()),it=U.imageManager.getPixelSize(),st=it.width,xt=it.height,Rt=Math.pow(2,J.tileID.overscaledZ),yt=J.tileSize*Math.pow(2,U.transform.tileZoom)/Rt,It=yt*(J.tileID.canonical.x+J.tileID.wrap*Rt),Ht=yt*J.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:et.tl,u_pattern_br_a:et.br,u_pattern_tl_b:$.tl,u_pattern_br_b:$.br,u_texsize:[st,xt],u_mix:F.t,u_pattern_size_a:et.displaySize,u_pattern_size_b:$.displaySize,u_scale_a:F.fromScale,u_scale_b:F.toScale,u_tile_units_to_pixels:1/Dn(J,1,U.transform.tileZoom),u_pixel_coord_upper:[It>>16,Ht>>16],u_pixel_coord_lower:[65535&It,65535&Ht]}}(m,P,f,E),{u_matrix:c,u_opacity:d})},Jo={fillExtrusion:function(c,d){return{u_matrix:new o.UniformMatrix4f(c,d.u_matrix),u_lightpos:new o.Uniform3f(c,d.u_lightpos),u_lightintensity:new o.Uniform1f(c,d.u_lightintensity),u_lightcolor:new o.Uniform3f(c,d.u_lightcolor),u_vertical_gradient:new o.Uniform1f(c,d.u_vertical_gradient),u_opacity:new o.Uniform1f(c,d.u_opacity)}},fillExtrusionPattern:function(c,d){return{u_matrix:new o.UniformMatrix4f(c,d.u_matrix),u_lightpos:new o.Uniform3f(c,d.u_lightpos),u_lightintensity:new o.Uniform1f(c,d.u_lightintensity),u_lightcolor:new o.Uniform3f(c,d.u_lightcolor),u_vertical_gradient:new o.Uniform1f(c,d.u_vertical_gradient),u_height_factor:new o.Uniform1f(c,d.u_height_factor),u_image:new o.Uniform1i(c,d.u_image),u_texsize:new o.Uniform2f(c,d.u_texsize),u_pixel_coord_upper:new o.Uniform2f(c,d.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(c,d.u_pixel_coord_lower),u_scale:new o.Uniform3f(c,d.u_scale),u_fade:new o.Uniform1f(c,d.u_fade),u_opacity:new o.Uniform1f(c,d.u_opacity)}},fill:function(c,d){return{u_matrix:new o.UniformMatrix4f(c,d.u_matrix)}},fillPattern:function(c,d){return{u_matrix:new o.UniformMatrix4f(c,d.u_matrix),u_image:new o.Uniform1i(c,d.u_image),u_texsize:new o.Uniform2f(c,d.u_texsize),u_pixel_coord_upper:new o.Uniform2f(c,d.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(c,d.u_pixel_coord_lower),u_scale:new o.Uniform3f(c,d.u_scale),u_fade:new o.Uniform1f(c,d.u_fade)}},fillOutline:function(c,d){return{u_matrix:new o.UniformMatrix4f(c,d.u_matrix),u_world:new o.Uniform2f(c,d.u_world)}},fillOutlinePattern:function(c,d){return{u_matrix:new o.UniformMatrix4f(c,d.u_matrix),u_world:new o.Uniform2f(c,d.u_world),u_image:new o.Uniform1i(c,d.u_image),u_texsize:new o.Uniform2f(c,d.u_texsize),u_pixel_coord_upper:new o.Uniform2f(c,d.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(c,d.u_pixel_coord_lower),u_scale:new o.Uniform3f(c,d.u_scale),u_fade:new o.Uniform1f(c,d.u_fade)}},circle:function(c,d){return{u_camera_to_center_distance:new o.Uniform1f(c,d.u_camera_to_center_distance),u_scale_with_map:new o.Uniform1i(c,d.u_scale_with_map),u_pitch_with_map:new o.Uniform1i(c,d.u_pitch_with_map),u_extrude_scale:new o.Uniform2f(c,d.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(c,d.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(c,d.u_matrix)}},collisionBox:function(c,d){return{u_matrix:new o.UniformMatrix4f(c,d.u_matrix),u_camera_to_center_distance:new o.Uniform1f(c,d.u_camera_to_center_distance),u_pixels_to_tile_units:new o.Uniform1f(c,d.u_pixels_to_tile_units),u_extrude_scale:new o.Uniform2f(c,d.u_extrude_scale),u_overscale_factor:new o.Uniform1f(c,d.u_overscale_factor)}},collisionCircle:function(c,d){return{u_matrix:new o.UniformMatrix4f(c,d.u_matrix),u_inv_matrix:new o.UniformMatrix4f(c,d.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(c,d.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(c,d.u_viewport_size)}},debug:function(c,d){return{u_color:new o.UniformColor(c,d.u_color),u_matrix:new o.UniformMatrix4f(c,d.u_matrix),u_overlay:new o.Uniform1i(c,d.u_overlay),u_overlay_scale:new o.Uniform1f(c,d.u_overlay_scale)}},clippingMask:function(c,d){return{u_matrix:new o.UniformMatrix4f(c,d.u_matrix)}},heatmap:function(c,d){return{u_extrude_scale:new o.Uniform1f(c,d.u_extrude_scale),u_intensity:new o.Uniform1f(c,d.u_intensity),u_matrix:new o.UniformMatrix4f(c,d.u_matrix)}},heatmapTexture:function(c,d){return{u_matrix:new o.UniformMatrix4f(c,d.u_matrix),u_world:new o.Uniform2f(c,d.u_world),u_image:new o.Uniform1i(c,d.u_image),u_color_ramp:new o.Uniform1i(c,d.u_color_ramp),u_opacity:new o.Uniform1f(c,d.u_opacity)}},hillshade:function(c,d){return{u_matrix:new o.UniformMatrix4f(c,d.u_matrix),u_image:new o.Uniform1i(c,d.u_image),u_latrange:new o.Uniform2f(c,d.u_latrange),u_light:new o.Uniform2f(c,d.u_light),u_shadow:new o.UniformColor(c,d.u_shadow),u_highlight:new o.UniformColor(c,d.u_highlight),u_accent:new o.UniformColor(c,d.u_accent)}},hillshadePrepare:function(c,d){return{u_matrix:new o.UniformMatrix4f(c,d.u_matrix),u_image:new o.Uniform1i(c,d.u_image),u_dimension:new o.Uniform2f(c,d.u_dimension),u_zoom:new o.Uniform1f(c,d.u_zoom),u_unpack:new o.Uniform4f(c,d.u_unpack)}},line:function(c,d){return{u_matrix:new o.UniformMatrix4f(c,d.u_matrix),u_ratio:new o.Uniform1f(c,d.u_ratio),u_device_pixel_ratio:new o.Uniform1f(c,d.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(c,d.u_units_to_pixels)}},lineGradient:function(c,d){return{u_matrix:new o.UniformMatrix4f(c,d.u_matrix),u_ratio:new o.Uniform1f(c,d.u_ratio),u_device_pixel_ratio:new o.Uniform1f(c,d.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(c,d.u_units_to_pixels),u_image:new o.Uniform1i(c,d.u_image),u_image_height:new o.Uniform1f(c,d.u_image_height)}},linePattern:function(c,d){return{u_matrix:new o.UniformMatrix4f(c,d.u_matrix),u_texsize:new o.Uniform2f(c,d.u_texsize),u_ratio:new o.Uniform1f(c,d.u_ratio),u_device_pixel_ratio:new o.Uniform1f(c,d.u_device_pixel_ratio),u_image:new o.Uniform1i(c,d.u_image),u_units_to_pixels:new o.Uniform2f(c,d.u_units_to_pixels),u_scale:new o.Uniform3f(c,d.u_scale),u_fade:new o.Uniform1f(c,d.u_fade)}},lineSDF:function(c,d){return{u_matrix:new o.UniformMatrix4f(c,d.u_matrix),u_ratio:new o.Uniform1f(c,d.u_ratio),u_device_pixel_ratio:new o.Uniform1f(c,d.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(c,d.u_units_to_pixels),u_patternscale_a:new o.Uniform2f(c,d.u_patternscale_a),u_patternscale_b:new o.Uniform2f(c,d.u_patternscale_b),u_sdfgamma:new o.Uniform1f(c,d.u_sdfgamma),u_image:new o.Uniform1i(c,d.u_image),u_tex_y_a:new o.Uniform1f(c,d.u_tex_y_a),u_tex_y_b:new o.Uniform1f(c,d.u_tex_y_b),u_mix:new o.Uniform1f(c,d.u_mix)}},raster:function(c,d){return{u_matrix:new o.UniformMatrix4f(c,d.u_matrix),u_tl_parent:new o.Uniform2f(c,d.u_tl_parent),u_scale_parent:new o.Uniform1f(c,d.u_scale_parent),u_buffer_scale:new o.Uniform1f(c,d.u_buffer_scale),u_fade_t:new o.Uniform1f(c,d.u_fade_t),u_opacity:new o.Uniform1f(c,d.u_opacity),u_image0:new o.Uniform1i(c,d.u_image0),u_image1:new o.Uniform1i(c,d.u_image1),u_brightness_low:new o.Uniform1f(c,d.u_brightness_low),u_brightness_high:new o.Uniform1f(c,d.u_brightness_high),u_saturation_factor:new o.Uniform1f(c,d.u_saturation_factor),u_contrast_factor:new o.Uniform1f(c,d.u_contrast_factor),u_spin_weights:new o.Uniform3f(c,d.u_spin_weights)}},symbolIcon:function(c,d){return{u_is_size_zoom_constant:new o.Uniform1i(c,d.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(c,d.u_is_size_feature_constant),u_size_t:new o.Uniform1f(c,d.u_size_t),u_size:new o.Uniform1f(c,d.u_size),u_camera_to_center_distance:new o.Uniform1f(c,d.u_camera_to_center_distance),u_pitch:new o.Uniform1f(c,d.u_pitch),u_rotate_symbol:new o.Uniform1i(c,d.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(c,d.u_aspect_ratio),u_fade_change:new o.Uniform1f(c,d.u_fade_change),u_matrix:new o.UniformMatrix4f(c,d.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(c,d.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(c,d.u_coord_matrix),u_is_text:new o.Uniform1i(c,d.u_is_text),u_pitch_with_map:new o.Uniform1i(c,d.u_pitch_with_map),u_texsize:new o.Uniform2f(c,d.u_texsize),u_texture:new o.Uniform1i(c,d.u_texture)}},symbolSDF:function(c,d){return{u_is_size_zoom_constant:new o.Uniform1i(c,d.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(c,d.u_is_size_feature_constant),u_size_t:new o.Uniform1f(c,d.u_size_t),u_size:new o.Uniform1f(c,d.u_size),u_camera_to_center_distance:new o.Uniform1f(c,d.u_camera_to_center_distance),u_pitch:new o.Uniform1f(c,d.u_pitch),u_rotate_symbol:new o.Uniform1i(c,d.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(c,d.u_aspect_ratio),u_fade_change:new o.Uniform1f(c,d.u_fade_change),u_matrix:new o.UniformMatrix4f(c,d.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(c,d.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(c,d.u_coord_matrix),u_is_text:new o.Uniform1i(c,d.u_is_text),u_pitch_with_map:new o.Uniform1i(c,d.u_pitch_with_map),u_texsize:new o.Uniform2f(c,d.u_texsize),u_texture:new o.Uniform1i(c,d.u_texture),u_gamma_scale:new o.Uniform1f(c,d.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(c,d.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(c,d.u_is_halo)}},symbolTextAndIcon:function(c,d){return{u_is_size_zoom_constant:new o.Uniform1i(c,d.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(c,d.u_is_size_feature_constant),u_size_t:new o.Uniform1f(c,d.u_size_t),u_size:new o.Uniform1f(c,d.u_size),u_camera_to_center_distance:new o.Uniform1f(c,d.u_camera_to_center_distance),u_pitch:new o.Uniform1f(c,d.u_pitch),u_rotate_symbol:new o.Uniform1i(c,d.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(c,d.u_aspect_ratio),u_fade_change:new o.Uniform1f(c,d.u_fade_change),u_matrix:new o.UniformMatrix4f(c,d.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(c,d.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(c,d.u_coord_matrix),u_is_text:new o.Uniform1i(c,d.u_is_text),u_pitch_with_map:new o.Uniform1i(c,d.u_pitch_with_map),u_texsize:new o.Uniform2f(c,d.u_texsize),u_texsize_icon:new o.Uniform2f(c,d.u_texsize_icon),u_texture:new o.Uniform1i(c,d.u_texture),u_texture_icon:new o.Uniform1i(c,d.u_texture_icon),u_gamma_scale:new o.Uniform1f(c,d.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(c,d.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(c,d.u_is_halo)}},background:function(c,d){return{u_matrix:new o.UniformMatrix4f(c,d.u_matrix),u_opacity:new o.Uniform1f(c,d.u_opacity),u_color:new o.UniformColor(c,d.u_color)}},backgroundPattern:function(c,d){return{u_matrix:new o.UniformMatrix4f(c,d.u_matrix),u_opacity:new o.Uniform1f(c,d.u_opacity),u_image:new o.Uniform1i(c,d.u_image),u_pattern_tl_a:new o.Uniform2f(c,d.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(c,d.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(c,d.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(c,d.u_pattern_br_b),u_texsize:new o.Uniform2f(c,d.u_texsize),u_mix:new o.Uniform1f(c,d.u_mix),u_pattern_size_a:new o.Uniform2f(c,d.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(c,d.u_pattern_size_b),u_scale_a:new o.Uniform1f(c,d.u_scale_a),u_scale_b:new o.Uniform1f(c,d.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(c,d.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(c,d.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(c,d.u_tile_units_to_pixels)}}};function il(c,d,f,m,E,P,R){for(var F=c.context,U=F.gl,J=c.useProgram("collisionBox"),et=[],$=0,it=0,st=0;st<m.length;st++){var xt=m[st],Rt=d.getTile(xt),yt=Rt.getBucket(f);if(yt){var It=xt.posMatrix;E[0]===0&&E[1]===0||(It=c.translatePosMatrix(xt.posMatrix,Rt,E,P));var Ht=R?yt.textCollisionBox:yt.iconCollisionBox,Xt=yt.collisionCircleArray;if(Xt.length>0){var ee=o.create(),Qt=It;o.mul(ee,yt.placementInvProjMatrix,c.transform.glCoordMatrix),o.mul(ee,ee,yt.placementViewportMatrix),et.push({circleArray:Xt,circleOffset:it,transform:Qt,invTransform:ee}),it=$+=Xt.length/4}Ht&&J.draw(F,U.LINES,vt.disabled,Ft.disabled,c.colorModeForRenderPass(),bt.disabled,tl(It,c.transform,Rt),f.id,Ht.layoutVertexBuffer,Ht.indexBuffer,Ht.segments,null,c.transform.zoom,null,null,Ht.collisionVertexBuffer)}}if(R&&et.length){var $t=c.useProgram("collisionCircle"),Ae=new o.StructArrayLayout2f1f2i16;Ae.resize(4*$),Ae._trim();for(var Le=0,we=0,Ge=et;we<Ge.length;we+=1)for(var si=Ge[we],Ci=0;Ci<si.circleArray.length/4;Ci++){var Ti=4*Ci,xn=si.circleArray[Ti+0],li=si.circleArray[Ti+1],Hi=si.circleArray[Ti+2],en=si.circleArray[Ti+3];Ae.emplace(Le++,xn,li,Hi,en,0),Ae.emplace(Le++,xn,li,Hi,en,1),Ae.emplace(Le++,xn,li,Hi,en,2),Ae.emplace(Le++,xn,li,Hi,en,3)}(!io||io.length<2*$)&&(io=function(Tr){var wo=2*Tr,so=new o.StructArrayLayout3ui6;so.resize(wo),so._trim();for(var xr=0;xr<wo;xr++){var Pr=6*xr;so.uint16[Pr+0]=4*xr+0,so.uint16[Pr+1]=4*xr+1,so.uint16[Pr+2]=4*xr+2,so.uint16[Pr+3]=4*xr+2,so.uint16[Pr+4]=4*xr+3,so.uint16[Pr+5]=4*xr+0}return so}($));for(var ji=F.createIndexBuffer(io,!0),Ui=F.createVertexBuffer(Ae,o.collisionCircleLayout.members,!0),Zi=0,Li=et;Zi<Li.length;Zi+=1){var Di=Li[Zi],Qr=Bh(Di.transform,Di.invTransform,c.transform);$t.draw(F,U.TRIANGLES,vt.disabled,Ft.disabled,c.colorModeForRenderPass(),bt.disabled,Qr,f.id,Ui,ji,o.SegmentVector.simpleSegment(0,2*Di.circleOffset,Di.circleArray.length,Di.circleArray.length/2),null,c.transform.zoom,null,null,null)}Ui.destroy(),ji.destroy()}}var Xo=o.identity(new Float32Array(16));function nl(c,d,f,m,E,P){var R=o.getAnchorAlignment(c),F=-(R.horizontalAlign-.5)*d,U=-(R.verticalAlign-.5)*f,J=o.evaluateVariableOffset(c,m);return new o.Point((F/E+J[0])*P,(U/E+J[1])*P)}function kl(c,d,f,m,E,P,R,F,U,J,et){var $=c.text.placedSymbolArray,it=c.text.dynamicLayoutVertexArray,st=c.icon.dynamicLayoutVertexArray,xt={};it.clear();for(var Rt=0;Rt<$.length;Rt++){var yt=$.get(Rt),It=yt.hidden||!yt.crossTileID||c.allowVerticalPlacement&&!yt.placedOrientation?null:m[yt.crossTileID];if(It){var Ht=new o.Point(yt.anchorX,yt.anchorY),Xt=Qe(Ht,f?F:R),ee=tn(P.cameraToCenterDistance,Xt.signedDistanceFromCamera),Qt=E.evaluateSizeForFeature(c.textSizeData,J,yt)*ee/o.ONE_EM;f&&(Qt*=c.tilePixelRatio/U);for(var $t=nl(It.anchor,It.width,It.height,It.textOffset,It.textBoxScale,Qt),Ae=f?Qe(Ht.add($t),R).point:Xt.point.add(d?$t.rotate(-P.angle):$t),Le=c.allowVerticalPlacement&&yt.placedOrientation===o.WritingMode.vertical?Math.PI/2:0,we=0;we<yt.numGlyphs;we++)o.addDynamicAttributes(it,Ae,Le);et&&yt.associatedIconIndex>=0&&(xt[yt.associatedIconIndex]={shiftedAnchor:Ae,angle:Le})}else Lr(yt.numGlyphs,it)}if(et){st.clear();for(var Ge=c.icon.placedSymbolArray,si=0;si<Ge.length;si++){var Ci=Ge.get(si);if(Ci.hidden)Lr(Ci.numGlyphs,st);else{var Ti=xt[si];if(Ti)for(var xn=0;xn<Ci.numGlyphs;xn++)o.addDynamicAttributes(st,Ti.shiftedAnchor,Ti.angle);else Lr(Ci.numGlyphs,st)}}c.icon.dynamicLayoutVertexBuffer.updateData(st)}c.text.dynamicLayoutVertexBuffer.updateData(it)}function Nl(c,d,f){return f.iconsInText&&d?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function rl(c,d,f,m,E,P,R,F,U,J,et,$){for(var it=c.context,st=it.gl,xt=c.transform,Rt=F==="map",yt=U==="map",It=Rt&&f.layout.get("symbol-placement")!=="point",Ht=Rt&&!yt&&!It,Xt=f.layout.get("symbol-sort-key").constantOr(1)!==void 0,ee=!1,Qt=c.depthModeForSublayer(0,vt.ReadOnly),$t=f.layout.get("text-variable-anchor"),Ae=[],Le=0,we=m;Le<we.length;Le+=1){var Ge=we[Le],si=d.getTile(Ge),Ci=si.getBucket(f);if(Ci){var Ti=E?Ci.text:Ci.icon;if(Ti&&Ti.segments.get().length){var xn=Ti.programConfigurations.get(f.id),li=E||Ci.sdfIcons,Hi=E?Ci.textSizeData:Ci.iconSizeData,en=yt||xt.pitch!==0,ji=c.useProgram(Nl(li,E,Ci),xn),Ui=o.evaluateSizeForZoom(Hi,xt.zoom),Zi=void 0,Li=[0,0],Di=void 0,Qr=void 0,Tr=null,wo=void 0;if(E)Di=si.glyphAtlasTexture,Qr=st.LINEAR,Zi=si.glyphAtlasTexture.size,Ci.iconsInText&&(Li=si.imageAtlasTexture.size,Tr=si.imageAtlasTexture,wo=en||c.options.rotating||c.options.zooming||Hi.kind==="composite"||Hi.kind==="camera"?st.LINEAR:st.NEAREST);else{var so=f.layout.get("icon-size").constantOr(0)!==1||Ci.iconsNeedLinear;Di=si.imageAtlasTexture,Qr=li||c.options.rotating||c.options.zooming||so||en?st.LINEAR:st.NEAREST,Zi=si.imageAtlasTexture.size}var xr=Dn(si,1,c.transform.zoom),Pr=yi(Ge.posMatrix,yt,Rt,c.transform,xr),ds=Bt(Ge.posMatrix,yt,Rt,c.transform,xr),Lo=$t&&Ci.hasTextData(),Jl=f.layout.get("icon-text-fit")!=="none"&&Lo&&Ci.hasIconData();It&&xa(Ci,Ge.posMatrix,c,E,Pr,ds,yt,J);var Yo=c.translatePosMatrix(Ge.posMatrix,si,P,R),ca=It||E&&$t||Jl?Xo:Pr,Us=c.translatePosMatrix(ds,si,P,R,!0),Lh=li&&f.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Pu={program:ji,buffers:Ti,uniformValues:li?Ci.iconsInText?_u(Hi.kind,Ui,Ht,yt,c,Yo,ca,Us,Zi,Li):Bs(Hi.kind,Ui,Ht,yt,c,Yo,ca,Us,E,Zi):Pa(Hi.kind,Ui,Ht,yt,c,Yo,ca,Us,E,Zi),atlasTexture:Di,atlasTextureIcon:Tr,atlasInterpolation:Qr,atlasInterpolationIcon:wo,isSDF:li,hasHalo:Lh};if(Xt&&Ci.canOverlap){ee=!0;for(var Xl=0,Ru=Ti.segments.get();Xl<Ru.length;Xl+=1){var Fh=Ru[Xl];Ae.push({segments:new o.SegmentVector([Fh]),sortKey:Fh.sortKey,state:Pu})}}else Ae.push({segments:Ti.segments,sortKey:0,state:Pu})}}}ee&&Ae.sort(function(Kl,Nc){return Kl.sortKey-Nc.sortKey});for(var Da=0,kh=Ae;Da<kh.length;Da+=1){var Oa=kh[Da],Zr=Oa.state;if(it.activeTexture.set(st.TEXTURE0),Zr.atlasTexture.bind(Zr.atlasInterpolation,st.CLAMP_TO_EDGE),Zr.atlasTextureIcon&&(it.activeTexture.set(st.TEXTURE1),Zr.atlasTextureIcon&&Zr.atlasTextureIcon.bind(Zr.atlasInterpolationIcon,st.CLAMP_TO_EDGE)),Zr.isSDF){var ll=Zr.uniformValues;Zr.hasHalo&&(ll.u_is_halo=1,Ul(Zr.buffers,Oa.segments,f,c,Zr.program,Qt,et,$,ll)),ll.u_is_halo=0}Ul(Zr.buffers,Oa.segments,f,c,Zr.program,Qt,et,$,Zr.uniformValues)}}function Ul(c,d,f,m,E,P,R,F,U){var J=m.context;E.draw(J,J.gl.TRIANGLES,P,R,F,bt.disabled,U,f.id,c.layoutVertexBuffer,c.indexBuffer,d,f.paint,m.transform.zoom,c.programConfigurations.get(f.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function vu(c,d,f,m,E,P,R){var F,U,J,et,$,it=c.context.gl,st=f.paint.get("fill-pattern"),xt=st&&st.constantOr(1),Rt=f.getCrossfadeParameters();R?(U=xt&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=it.LINES):(U=xt?"fillPattern":"fill",F=it.TRIANGLES);for(var yt=0,It=m;yt<It.length;yt+=1){var Ht=It[yt],Xt=d.getTile(Ht);if(!xt||Xt.patternsLoaded()){var ee=Xt.getBucket(f);if(ee){var Qt=ee.programConfigurations.get(f.id),$t=c.useProgram(U,Qt);xt&&(c.context.activeTexture.set(it.TEXTURE0),Xt.imageAtlasTexture.bind(it.LINEAR,it.CLAMP_TO_EDGE),Qt.updatePaintBuffers(Rt));var Ae=st.constantOr(null);if(Ae&&Xt.imageAtlas){var Le=Xt.imageAtlas,we=Le.patternPositions[Ae.to.toString()],Ge=Le.patternPositions[Ae.from.toString()];we&&Ge&&Qt.setConstantPatternPositions(we,Ge)}var si=c.translatePosMatrix(Ht.posMatrix,Xt,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(R){et=ee.indexBuffer2,$=ee.segments2;var Ci=[it.drawingBufferWidth,it.drawingBufferHeight];J=U==="fillOutlinePattern"&&xt?gu(si,c,Rt,Xt,Ci):zf(si,Ci)}else et=ee.indexBuffer,$=ee.segments,J=xt?as(si,c,Rt,Xt):$s(si);$t.draw(c.context,F,E,c.stencilModeForClipping(Ht),P,bt.disabled,J,f.id,ee.layoutVertexBuffer,et,$,f.paint,c.transform.zoom,Qt)}}}}function Mc(c,d,f,m,E,P,R){for(var F=c.context,U=F.gl,J=f.paint.get("fill-extrusion-pattern"),et=J.constantOr(1),$=f.getCrossfadeParameters(),it=f.paint.get("fill-extrusion-opacity"),st=0,xt=m;st<xt.length;st+=1){var Rt=xt[st],yt=d.getTile(Rt),It=yt.getBucket(f);if(It){var Ht=It.programConfigurations.get(f.id),Xt=c.useProgram(et?"fillExtrusionPattern":"fillExtrusion",Ht);et&&(c.context.activeTexture.set(U.TEXTURE0),yt.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Ht.updatePaintBuffers($));var ee=J.constantOr(null);if(ee&&yt.imageAtlas){var Qt=yt.imageAtlas,$t=Qt.patternPositions[ee.to.toString()],Ae=Qt.patternPositions[ee.from.toString()];$t&&Ae&&Ht.setConstantPatternPositions($t,Ae)}var Le=c.translatePosMatrix(Rt.posMatrix,yt,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),we=f.paint.get("fill-extrusion-vertical-gradient"),Ge=et?qs(Le,c,we,it,Rt,$,yt):Gf(Le,c,we,it);Xt.draw(F,F.gl.TRIANGLES,E,P,R,bt.backCCW,Ge,f.id,It.layoutVertexBuffer,It.indexBuffer,It.segments,f.paint,c.transform.zoom,Ht)}}}function bu(c,d,f,m,E,P){var R=c.context,F=R.gl,U=d.fbo;if(U){var J=c.useProgram("hillshade");R.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,U.colorAttachment.get());var et=function($,it,st){var xt=st.paint.get("hillshade-shadow-color"),Rt=st.paint.get("hillshade-highlight-color"),yt=st.paint.get("hillshade-accent-color"),It=st.paint.get("hillshade-illumination-direction")*(Math.PI/180);st.paint.get("hillshade-illumination-anchor")==="viewport"&&(It-=$.transform.angle);var Ht,Xt,ee,Qt=!$.options.moving;return{u_matrix:$.transform.calculatePosMatrix(it.tileID.toUnwrapped(),Qt),u_image:0,u_latrange:(Ht=it.tileID,Xt=Math.pow(2,Ht.canonical.z),ee=Ht.canonical.y,[new o.MercatorCoordinate(0,ee/Xt).toLngLat().lat,new o.MercatorCoordinate(0,(ee+1)/Xt).toLngLat().lat]),u_light:[st.paint.get("hillshade-exaggeration"),It],u_shadow:xt,u_highlight:Rt,u_accent:yt}}(c,d,f);J.draw(R,F.TRIANGLES,m,E,P,bt.disabled,et,f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}}function hA(c,d,f,m,E,P){var R=c.context,F=R.gl,U=d.dem;if(U&&U.data){var J=U.dim,et=U.stride,$=U.getPixels();if(R.activeTexture.set(F.TEXTURE1),R.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||c.getTileTexture(et),d.demTexture){var it=d.demTexture;it.update($,{premultiply:!1}),it.bind(F.NEAREST,F.CLAMP_TO_EDGE)}else d.demTexture=new o.Texture(R,$,F.RGBA,{premultiply:!1}),d.demTexture.bind(F.NEAREST,F.CLAMP_TO_EDGE);R.activeTexture.set(F.TEXTURE0);var st=d.fbo;if(!st){var xt=new o.Texture(R,{width:J,height:J,data:null},F.RGBA);xt.bind(F.LINEAR,F.CLAMP_TO_EDGE),(st=d.fbo=R.createFramebuffer(J,J,!0)).colorAttachment.set(xt.texture)}R.bindFramebuffer.set(st.framebuffer),R.viewport.set([0,0,J,J]),c.useProgram("hillshadePrepare").draw(R,F.TRIANGLES,m,E,P,bt.disabled,function(Rt,yt){var It=yt.stride,Ht=o.create();return o.ortho(Ht,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(Ht,Ht,[0,-o.EXTENT,0]),{u_matrix:Ht,u_image:1,u_dimension:[It,It],u_zoom:Rt.overscaledZ,u_unpack:yt.getUnpackVector()}}(d.tileID,U),f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments),d.needsHillshadePrepare=!1}}function Pc(c,d,f,m,E){var P=m.paint.get("raster-fade-duration");if(P>0){var R=o.browser.now(),F=(R-c.timeAdded)/P,U=d?(R-d.timeAdded)/P:-1,J=f.getSource(),et=E.coveringZoomLevel({tileSize:J.tileSize,roundZoom:J.roundZoom}),$=!d||Math.abs(d.tileID.overscaledZ-et)>Math.abs(c.tileID.overscaledZ-et),it=$&&c.refreshedUponExpiration?1:o.clamp($?F:1-U,0,1);return c.refreshedUponExpiration&&F>=1&&(c.refreshedUponExpiration=!1),d?{opacity:1,mix:1-it}:{opacity:it,mix:0}}return{opacity:1,mix:0}}var xu=new o.Color(1,0,0,1),Gl=new o.Color(0,1,0,1),ol=new o.Color(0,0,1,1),wu=new o.Color(1,0,1,1),sl=new o.Color(0,1,1,1);function Th(c,d,f,m){Rc(c,0,d+f/2,c.transform.width,f,m)}function Sh(c,d,f,m){Rc(c,d-f/2,0,f,c.transform.height,m)}function Rc(c,d,f,m,E,P){var R=c.context,F=R.gl;F.enable(F.SCISSOR_TEST),F.scissor(d*o.browser.devicePixelRatio,f*o.browser.devicePixelRatio,m*o.browser.devicePixelRatio,E*o.browser.devicePixelRatio),R.clear({color:P}),F.disable(F.SCISSOR_TEST)}function Hf(c,d,f){var m=c.context,E=m.gl,P=f.posMatrix,R=c.useProgram("debug"),F=vt.disabled,U=Ft.disabled,J=c.colorModeForRenderPass();m.activeTexture.set(E.TEXTURE0),c.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),R.draw(m,E.LINE_STRIP,F,U,J,bt.disabled,ta(P,o.Color.red),"$debug",c.debugBuffer,c.tileBorderIndexBuffer,c.debugSegments);var et=d.getTileByID(f.key).latestRawTileData,$=Math.floor((et&&et.byteLength||0)/1024),it=d.getTile(f).tileSize,st=512/Math.min(it,512)*(f.overscaledZ/c.transform.zoom)*.5,xt=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(xt+=" => "+f.overscaledZ),function(Rt,yt){Rt.initDebugOverlayCanvas();var It=Rt.debugOverlayCanvas,Ht=Rt.context.gl,Xt=Rt.debugOverlayCanvas.getContext("2d");Xt.clearRect(0,0,It.width,It.height),Xt.shadowColor="white",Xt.shadowBlur=2,Xt.lineWidth=1.5,Xt.strokeStyle="white",Xt.textBaseline="top",Xt.font="bold 36px Open Sans, sans-serif",Xt.fillText(yt,5,5),Xt.strokeText(yt,5,5),Rt.debugOverlayTexture.update(It),Rt.debugOverlayTexture.bind(Ht.LINEAR,Ht.CLAMP_TO_EDGE)}(c,xt+" "+$+"kb"),R.draw(m,E.TRIANGLES,F,U,pt.alphaBlended,bt.disabled,ta(P,o.Color.transparent,st),"$debug",c.debugBuffer,c.quadTriangleIndexBuffer,c.debugSegments)}var al={symbol:function(c,d,f,m,E){if(c.renderPass==="translucent"){var P=Ft.disabled,R=c.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&function(F,U,J,et,$,it,st){for(var xt=U.transform,Rt=$==="map",yt=it==="map",It=0,Ht=F;It<Ht.length;It+=1){var Xt=Ht[It],ee=et.getTile(Xt),Qt=ee.getBucket(J);if(Qt&&Qt.text&&Qt.text.segments.get().length){var $t=o.evaluateSizeForZoom(Qt.textSizeData,xt.zoom),Ae=Dn(ee,1,U.transform.zoom),Le=yi(Xt.posMatrix,yt,Rt,U.transform,Ae),we=J.layout.get("icon-text-fit")!=="none"&&Qt.hasIconData();if($t){var Ge=Math.pow(2,xt.zoom-ee.tileID.overscaledZ);kl(Qt,Rt,yt,st,o.symbolSize,xt,Le,Xt.posMatrix,Ge,$t,we)}}}}(m,c,f,d,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),E),f.paint.get("icon-opacity").constantOr(1)!==0&&rl(c,d,f,m,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),P,R),f.paint.get("text-opacity").constantOr(1)!==0&&rl(c,d,f,m,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),P,R),d.map.showCollisionBoxes&&(il(c,d,f,m,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),il(c,d,f,m,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))}},circle:function(c,d,f,m){if(c.renderPass==="translucent"){var E=f.paint.get("circle-opacity"),P=f.paint.get("circle-stroke-width"),R=f.paint.get("circle-stroke-opacity"),F=f.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)!==0||P.constantOr(1)!==0&&R.constantOr(1)!==0){for(var U=c.context,J=U.gl,et=c.depthModeForSublayer(0,vt.ReadOnly),$=Ft.disabled,it=c.colorModeForRenderPass(),st=[],xt=0;xt<m.length;xt++){var Rt=m[xt],yt=d.getTile(Rt),It=yt.getBucket(f);if(It){var Ht=It.programConfigurations.get(f.id),Xt={programConfiguration:Ht,program:c.useProgram("circle",Ht),layoutVertexBuffer:It.layoutVertexBuffer,indexBuffer:It.indexBuffer,uniformValues:mu(c,Rt,yt,f)};if(F)for(var ee=0,Qt=It.segments.get();ee<Qt.length;ee+=1){var $t=Qt[ee];st.push({segments:new o.SegmentVector([$t]),sortKey:$t.sortKey,state:Xt})}else st.push({segments:It.segments,sortKey:0,state:Xt})}}F&&st.sort(function(si,Ci){return si.sortKey-Ci.sortKey});for(var Ae=0,Le=st;Ae<Le.length;Ae+=1){var we=Le[Ae],Ge=we.state;Ge.program.draw(U,J.TRIANGLES,et,$,it,bt.disabled,Ge.uniformValues,f.id,Ge.layoutVertexBuffer,Ge.indexBuffer,we.segments,f.paint,c.transform.zoom,Ge.programConfiguration)}}}},heatmap:function(c,d,f,m){if(f.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){var E=c.context,P=E.gl,R=Ft.disabled,F=new pt([P.ONE,P.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(st,xt,Rt){var yt=st.gl;st.activeTexture.set(yt.TEXTURE1),st.viewport.set([0,0,xt.width/4,xt.height/4]);var It=Rt.heatmapFbo;if(It)yt.bindTexture(yt.TEXTURE_2D,It.colorAttachment.get()),st.bindFramebuffer.set(It.framebuffer);else{var Ht=yt.createTexture();yt.bindTexture(yt.TEXTURE_2D,Ht),yt.texParameteri(yt.TEXTURE_2D,yt.TEXTURE_WRAP_S,yt.CLAMP_TO_EDGE),yt.texParameteri(yt.TEXTURE_2D,yt.TEXTURE_WRAP_T,yt.CLAMP_TO_EDGE),yt.texParameteri(yt.TEXTURE_2D,yt.TEXTURE_MIN_FILTER,yt.LINEAR),yt.texParameteri(yt.TEXTURE_2D,yt.TEXTURE_MAG_FILTER,yt.LINEAR),It=Rt.heatmapFbo=st.createFramebuffer(xt.width/4,xt.height/4,!1),function(Xt,ee,Qt,$t){var Ae=Xt.gl;Ae.texImage2D(Ae.TEXTURE_2D,0,Ae.RGBA,ee.width/4,ee.height/4,0,Ae.RGBA,Xt.extRenderToTextureHalfFloat?Xt.extTextureHalfFloat.HALF_FLOAT_OES:Ae.UNSIGNED_BYTE,null),$t.colorAttachment.set(Qt)}(st,xt,Ht,It)}})(E,c,f),E.clear({color:o.Color.transparent});for(var U=0;U<m.length;U++){var J=m[U];if(!d.hasRenderableParent(J)){var et=d.getTile(J),$=et.getBucket(f);if($){var it=$.programConfigurations.get(f.id);c.useProgram("heatmap",it).draw(E,P.TRIANGLES,vt.disabled,R,F,bt.disabled,Ic(J.posMatrix,et,c.transform.zoom,f.paint.get("heatmap-intensity")),f.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,f.paint,c.transform.zoom,it)}}}E.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(st,xt){var Rt=st.context,yt=Rt.gl,It=xt.heatmapFbo;if(It){Rt.activeTexture.set(yt.TEXTURE0),yt.bindTexture(yt.TEXTURE_2D,It.colorAttachment.get()),Rt.activeTexture.set(yt.TEXTURE1);var Ht=xt.colorRampTexture;Ht||(Ht=xt.colorRampTexture=new o.Texture(Rt,xt.colorRamp,yt.RGBA)),Ht.bind(yt.LINEAR,yt.CLAMP_TO_EDGE),st.useProgram("heatmapTexture").draw(Rt,yt.TRIANGLES,vt.disabled,Ft.disabled,st.colorModeForRenderPass(),bt.disabled,function(Xt,ee,Qt,$t){var Ae=o.create();o.ortho(Ae,0,Xt.width,Xt.height,0,0,1);var Le=Xt.context.gl;return{u_matrix:Ae,u_world:[Le.drawingBufferWidth,Le.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ee.paint.get("heatmap-opacity")}}(st,xt),xt.id,st.viewportBuffer,st.quadTriangleIndexBuffer,st.viewportSegments,xt.paint,st.transform.zoom)}}(c,f))},line:function(c,d,f,m){if(c.renderPass==="translucent"){var E=f.paint.get("line-opacity"),P=f.paint.get("line-width");if(E.constantOr(1)!==0&&P.constantOr(1)!==0)for(var R=c.depthModeForSublayer(0,vt.ReadOnly),F=c.colorModeForRenderPass(),U=f.paint.get("line-dasharray"),J=f.paint.get("line-pattern"),et=J.constantOr(1),$=f.paint.get("line-gradient"),it=f.getCrossfadeParameters(),st=et?"linePattern":U?"lineSDF":$?"lineGradient":"line",xt=c.context,Rt=xt.gl,yt=!0,It=0,Ht=m;It<Ht.length;It+=1){var Xt=Ht[It],ee=d.getTile(Xt);if(!et||ee.patternsLoaded()){var Qt=ee.getBucket(f);if(Qt){var $t=Qt.programConfigurations.get(f.id),Ae=c.context.program.get(),Le=c.useProgram(st,$t),we=yt||Le.program!==Ae,Ge=J.constantOr(null);if(Ge&&ee.imageAtlas){var si=ee.imageAtlas,Ci=si.patternPositions[Ge.to.toString()],Ti=si.patternPositions[Ge.from.toString()];Ci&&Ti&&$t.setConstantPatternPositions(Ci,Ti)}var xn=et?yu(c,ee,f,it):U?cA(c,ee,f,U,it):$?Nn(c,ee,f,Qt.lineClipsArray.length):On(c,ee,f);if(et)xt.activeTexture.set(Rt.TEXTURE0),ee.imageAtlasTexture.bind(Rt.LINEAR,Rt.CLAMP_TO_EDGE),$t.updatePaintBuffers(it);else if(U&&(we||c.lineAtlas.dirty))xt.activeTexture.set(Rt.TEXTURE0),c.lineAtlas.bind(xt);else if($){var li=Qt.gradients[f.id],Hi=li.texture;if(f.gradientVersion!==li.version){var en=256;if(f.stepInterpolant){var ji=d.getSource().maxzoom,Ui=Xt.canonical.z===ji?Math.ceil(1<<c.transform.maxZoom-Xt.canonical.z):1;en=o.clamp(o.nextPowerOfTwo(Qt.maxLineLength/o.EXTENT*1024*Ui),256,xt.maxTextureSize)}li.gradient=o.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:en,image:li.gradient||void 0,clips:Qt.lineClipsArray}),li.texture?li.texture.update(li.gradient):li.texture=new o.Texture(xt,li.gradient,Rt.RGBA),li.version=f.gradientVersion,Hi=li.texture}xt.activeTexture.set(Rt.TEXTURE0),Hi.bind(f.stepInterpolant?Rt.NEAREST:Rt.LINEAR,Rt.CLAMP_TO_EDGE)}Le.draw(xt,Rt.TRIANGLES,R,c.stencilModeForClipping(Xt),F,bt.disabled,xn,f.id,Qt.layoutVertexBuffer,Qt.indexBuffer,Qt.segments,f.paint,c.transform.zoom,$t,Qt.layoutVertexBuffer2),yt=!1}}}}},fill:function(c,d,f,m){var E=f.paint.get("fill-color"),P=f.paint.get("fill-opacity");if(P.constantOr(1)!==0){var R=c.colorModeForRenderPass(),F=f.paint.get("fill-pattern"),U=c.opaquePassEnabledForLayer()&&!F.constantOr(1)&&E.constantOr(o.Color.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===U){var J=c.depthModeForSublayer(1,c.renderPass==="opaque"?vt.ReadWrite:vt.ReadOnly);vu(c,d,f,m,J,R,!1)}if(c.renderPass==="translucent"&&f.paint.get("fill-antialias")){var et=c.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,vt.ReadOnly);vu(c,d,f,m,et,R,!0)}}},"fill-extrusion":function(c,d,f,m){var E=f.paint.get("fill-extrusion-opacity");if(E!==0&&c.renderPass==="translucent"){var P=new vt(c.context.gl.LEQUAL,vt.ReadWrite,c.depthRangeFor3D);if(E!==1||f.paint.get("fill-extrusion-pattern").constantOr(1))Mc(c,d,f,m,P,Ft.disabled,pt.disabled),Mc(c,d,f,m,P,c.stencilModeFor3D(),c.colorModeForRenderPass());else{var R=c.colorModeForRenderPass();Mc(c,d,f,m,P,Ft.disabled,R)}}},hillshade:function(c,d,f,m){if(c.renderPass==="offscreen"||c.renderPass==="translucent"){for(var E=c.context,P=c.depthModeForSublayer(0,vt.ReadOnly),R=c.colorModeForRenderPass(),F=c.renderPass==="translucent"?c.stencilConfigForOverlap(m):[{},m],U=F[0],J=0,et=F[1];J<et.length;J+=1){var $=et[J],it=d.getTile($);it.needsHillshadePrepare&&c.renderPass==="offscreen"?hA(c,it,f,P,Ft.disabled,R):c.renderPass==="translucent"&&bu(c,it,f,P,U[$.overscaledZ],R)}E.viewport.set([0,0,c.width,c.height])}},raster:function(c,d,f,m){if(c.renderPass==="translucent"&&f.paint.get("raster-opacity")!==0&&m.length)for(var E=c.context,P=E.gl,R=d.getSource(),F=c.useProgram("raster"),U=c.colorModeForRenderPass(),J=R instanceof he?[{},m]:c.stencilConfigForOverlap(m),et=J[0],$=J[1],it=$[$.length-1].overscaledZ,st=!c.options.moving,xt=0,Rt=$;xt<Rt.length;xt+=1){var yt=Rt[xt],It=c.depthModeForSublayer(yt.overscaledZ-it,f.paint.get("raster-opacity")===1?vt.ReadWrite:vt.ReadOnly,P.LESS),Ht=d.getTile(yt),Xt=c.transform.calculatePosMatrix(yt.toUnwrapped(),st);Ht.registerFadeDuration(f.paint.get("raster-fade-duration"));var ee=d.findLoadedParent(yt,0),Qt=Pc(Ht,ee,d,f,c.transform),$t=void 0,Ae=void 0,Le=f.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;E.activeTexture.set(P.TEXTURE0),Ht.texture.bind(Le,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(P.TEXTURE1),ee?(ee.texture.bind(Le,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),$t=Math.pow(2,ee.tileID.overscaledZ-Ht.tileID.overscaledZ),Ae=[Ht.tileID.canonical.x*$t%1,Ht.tileID.canonical.y*$t%1]):Ht.texture.bind(Le,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST);var we=uA(Xt,Ae||[0,0],$t||1,Qt,f);R instanceof he?F.draw(E,P.TRIANGLES,It,Ft.disabled,U,bt.disabled,we,f.id,R.boundsBuffer,c.quadTriangleIndexBuffer,R.boundsSegments):F.draw(E,P.TRIANGLES,It,et[yt.overscaledZ],U,bt.disabled,we,f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}},background:function(c,d,f){var m=f.paint.get("background-color"),E=f.paint.get("background-opacity");if(E!==0){var P=c.context,R=P.gl,F=c.transform,U=F.tileSize,J=f.paint.get("background-pattern");if(!c.isPatternMissing(J)){var et=!J&&m.a===1&&E===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass===et){var $=Ft.disabled,it=c.depthModeForSublayer(0,et==="opaque"?vt.ReadWrite:vt.ReadOnly),st=c.colorModeForRenderPass(),xt=c.useProgram(J?"backgroundPattern":"background"),Rt=F.coveringTiles({tileSize:U});J&&(P.activeTexture.set(R.TEXTURE0),c.imageManager.bind(c.context));for(var yt=f.getCrossfadeParameters(),It=0,Ht=Rt;It<Ht.length;It+=1){var Xt=Ht[It],ee=c.transform.calculatePosMatrix(Xt.toUnwrapped()),Qt=J?Fl(ee,E,c,J,{tileID:Xt,tileSize:U},yt):el(ee,E,m);xt.draw(P,R.TRIANGLES,it,$,st,bt.disabled,Qt,f.id,c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}}}},debug:function(c,d,f){for(var m=0;m<f.length;m++)Hf(c,d,f[m])},custom:function(c,d,f){var m=c.context,E=f.implementation;if(c.renderPass==="offscreen"){var P=E.prerender;P&&(c.setCustomLayerDefaults(),m.setColorMode(c.colorModeForRenderPass()),P.call(E,m.gl,c.transform.customLayerMatrix()),m.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),m.setColorMode(c.colorModeForRenderPass()),m.setStencilMode(Ft.disabled);var R=E.renderingMode==="3d"?new vt(c.context.gl.LEQUAL,vt.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,vt.ReadOnly);m.setDepthMode(R),E.render(m.gl,c.transform.customLayerMatrix()),m.setDirty(),c.setBaseState(),m.bindFramebuffer.set(null)}}},Kn=function(c,d){this.context=new lt(c),this.transform=d,this._tileTextures={},this.setup(),this.numSublayers=Et.maxUnderzooming+Et.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ca,this.gpuTimers={}};Kn.prototype.resize=function(c,d){if(this.width=c*o.browser.devicePixelRatio,this.height=d*o.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var f=0,m=this.style._order;f<m.length;f+=1)this.style._layers[m[f]].resize()},Kn.prototype.setup=function(){var c=this.context,d=new o.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(o.EXTENT,0),d.emplaceBack(0,o.EXTENT),d.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(d,dr.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);var f=new o.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(o.EXTENT,0),f.emplaceBack(0,o.EXTENT),f.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=c.createVertexBuffer(f,dr.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);var m=new o.StructArrayLayout4i8;m.emplaceBack(0,0,0,0),m.emplaceBack(o.EXTENT,0,o.EXTENT,0),m.emplaceBack(0,o.EXTENT,0,o.EXTENT),m.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.rasterBoundsBuffer=c.createVertexBuffer(m,ae.members),this.rasterBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);var E=new o.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(E,dr.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);var P=new o.StructArrayLayout1ui2;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=c.createIndexBuffer(P);var R=new o.StructArrayLayout3ui6;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(R),this.emptyTexture=new o.Texture(c,{width:1,height:1,data:new Uint8Array([0,0,0,0])},c.gl.RGBA);var F=this.context.gl;this.stencilClearMode=new Ft({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO)},Kn.prototype.clearStencil=function(){var c=this.context,d=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var f=o.create();o.ortho(f,0,this.width,this.height,0,0,1),o.scale(f,f,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(c,d.TRIANGLES,vt.disabled,this.stencilClearMode,pt.disabled,bt.disabled,ea(f),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Kn.prototype._renderTileClippingMasks=function(c,d){if(this.currentStencilSource!==c.source&&c.isTileClipped()&&d&&d.length){this.currentStencilSource=c.source;var f=this.context,m=f.gl;this.nextStencilID+d.length>256&&this.clearStencil(),f.setColorMode(pt.disabled),f.setDepthMode(vt.disabled);var E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var P=0,R=d;P<R.length;P+=1){var F=R[P],U=this._tileClippingMaskIDs[F.key]=this.nextStencilID++;E.draw(f,m.TRIANGLES,vt.disabled,new Ft({func:m.ALWAYS,mask:0},U,255,m.KEEP,m.KEEP,m.REPLACE),pt.disabled,bt.disabled,ea(F.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Kn.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var c=this.nextStencilID++,d=this.context.gl;return new Ft({func:d.NOTEQUAL,mask:255},c,255,d.KEEP,d.KEEP,d.REPLACE)},Kn.prototype.stencilModeForClipping=function(c){var d=this.context.gl;return new Ft({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,d.KEEP,d.KEEP,d.REPLACE)},Kn.prototype.stencilConfigForOverlap=function(c){var d,f=this.context.gl,m=c.sort(function(U,J){return J.overscaledZ-U.overscaledZ}),E=m[m.length-1].overscaledZ,P=m[0].overscaledZ-E+1;if(P>1){this.currentStencilSource=void 0,this.nextStencilID+P>256&&this.clearStencil();for(var R={},F=0;F<P;F++)R[F+E]=new Ft({func:f.GEQUAL,mask:255},F+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=P,[R,m]}return[(d={},d[E]=Ft.disabled,d),m]},Kn.prototype.colorModeForRenderPass=function(){var c=this.context.gl;return this._showOverdrawInspector?new pt([c.CONSTANT_COLOR,c.ONE],new o.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?pt.unblended:pt.alphaBlended},Kn.prototype.depthModeForSublayer=function(c,d,f){if(!this.opaquePassEnabledForLayer())return vt.disabled;var m=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new vt(f||this.context.gl.LEQUAL,d,[m,m])},Kn.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Kn.prototype.render=function(c,d){var f=this;this.style=c,this.options=d,this.lineAtlas=c.lineAtlas,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(o.browser.now()),this.imageManager.beginFrame();var m=this.style._order,E=this.style.sourceCaches;for(var P in E){var R=E[P];R.used&&R.prepare(this.context)}var F,U,J={},et={},$={};for(var it in E){var st=E[it];J[it]=st.getVisibleCoordinates(),et[it]=J[it].slice().reverse(),$[it]=st.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var xt=0;xt<m.length;xt++)if(this.style._layers[m[xt]].is3D()){this.opaquePassCutoff=xt;break}this.renderPass="offscreen";for(var Rt=0,yt=m;Rt<yt.length;Rt+=1){var It=this.style._layers[yt[Rt]];if(It.hasOffscreenPass()&&!It.isHidden(this.transform.zoom)){var Ht=et[It.source];(It.type==="custom"||Ht.length)&&this.renderLayer(this,E[It.source],It,Ht)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(c._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){var Xt=this.style._layers[m[this.currentLayer]],ee=E[Xt.source],Qt=J[Xt.source];this._renderTileClippingMasks(Xt,Qt),this.renderLayer(this,ee,Xt,Qt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){var $t=this.style._layers[m[this.currentLayer]],Ae=E[$t.source],Le=($t.type==="symbol"?$:et)[$t.source];this._renderTileClippingMasks($t,J[$t.source]),this.renderLayer(this,Ae,$t,Le)}this.options.showTileBoundaries&&(o.values(this.style._layers).forEach(function(we){we.source&&!we.isHidden(f.transform.zoom)&&(we.source!==(U&&U.id)&&(U=f.style.sourceCaches[we.source]),(!F||F.getSource().maxzoom<U.getSource().maxzoom)&&(F=U))}),F&&al.debug(this,F,F.getVisibleCoordinates())),this.options.showPadding&&function(we){var Ge=we.transform.padding;Th(we,we.transform.height-(Ge.top||0),3,xu),Th(we,Ge.bottom||0,3,Gl),Sh(we,Ge.left||0,3,ol),Sh(we,we.transform.width-(Ge.right||0),3,wu);var si=we.transform.centerPoint;(function(Ci,Ti,xn,li){Rc(Ci,Ti-1,xn-10,2,20,li),Rc(Ci,Ti-10,xn-1,20,2,li)})(we,si.x,we.transform.height-si.y,sl)}(this),this.context.setDefault()},Kn.prototype.renderLayer=function(c,d,f,m){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="custom"||m.length)&&(this.id=f.id,this.gpuTimingStart(f),al[f.type](c,d,f,m,this.style.placement.variableOffsets),this.gpuTimingEnd())},Kn.prototype.gpuTimingStart=function(c){if(this.options.gpuTiming){var d=this.context.extTimerQuery,f=this.gpuTimers[c.id];f||(f=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),f.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,f.query)}},Kn.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}},Kn.prototype.collectGpuTimers=function(){var c=this.gpuTimers;return this.gpuTimers={},c},Kn.prototype.queryGpuTimers=function(c){var d={};for(var f in c){var m=c[f],E=this.context.extTimerQuery,P=E.getQueryObjectEXT(m.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(m.query),d[f]=P}return d},Kn.prototype.translatePosMatrix=function(c,d,f,m,E){if(!f[0]&&!f[1])return c;var P=E?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(P){var R=Math.sin(P),F=Math.cos(P);f=[f[0]*F-f[1]*R,f[0]*R+f[1]*F]}var U=[E?f[0]:Dn(d,f[0],this.transform.zoom),E?f[1]:Dn(d,f[1],this.transform.zoom),0],J=new Float32Array(16);return o.translate(J,c,U),J},Kn.prototype.saveTileTexture=function(c){var d=this._tileTextures[c.size[0]];d?d.push(c):this._tileTextures[c.size[0]]=[c]},Kn.prototype.getTileTexture=function(c){var d=this._tileTextures[c];return d&&d.length>0?d.pop():null},Kn.prototype.isPatternMissing=function(c){if(!c)return!1;if(!c.from||!c.to)return!0;var d=this.imageManager.getPattern(c.from.toString()),f=this.imageManager.getPattern(c.to.toString());return!d||!f},Kn.prototype.useProgram=function(c,d){this.cache=this.cache||{};var f=""+c+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[f]||(this.cache[f]=new Uf(this.context,c,pu[c],d,Jo[c],this._showOverdrawInspector)),this.cache[f]},Kn.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Kn.prototype.setBaseState=function(){var c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)},Kn.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Kn.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Cu=function(c,d){this.points=c,this.planes=d};Cu.fromInvProjectionMatrix=function(c,d,f){var m=Math.pow(2,f),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(R){return o.transformMat4([],R,c)}).map(function(R){return o.scale$1([],R,1/R[3]/d*m)}),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(R){var F=o.sub([],E[R[0]],E[R[1]]),U=o.sub([],E[R[2]],E[R[1]]),J=o.normalize([],o.cross([],F,U)),et=-o.dot(J,E[R[1]]);return J.concat(et)});return new Cu(E,P)};var ia=function(c,d){this.min=c,this.max=d,this.center=o.scale$2([],o.add([],this.min,this.max),.5)};ia.prototype.quadrant=function(c){for(var d=[c%2==0,c<2],f=o.clone$2(this.min),m=o.clone$2(this.max),E=0;E<d.length;E++)f[E]=d[E]?this.min[E]:this.center[E],m[E]=d[E]?this.center[E]:this.max[E];return m[2]=this.max[2],new ia(f,m)},ia.prototype.distanceX=function(c){return Math.max(Math.min(this.max[0],c[0]),this.min[0])-c[0]},ia.prototype.distanceY=function(c){return Math.max(Math.min(this.max[1],c[1]),this.min[1])-c[1]},ia.prototype.intersects=function(c){for(var d=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],f=!0,m=0;m<c.planes.length;m++){for(var E=c.planes[m],P=0,R=0;R<d.length;R++)P+=o.dot$1(E,d[R])>=0;if(P===0)return 0;P!==d.length&&(f=!1)}if(f)return 2;for(var F=0;F<3;F++){for(var U=Number.MAX_VALUE,J=-Number.MAX_VALUE,et=0;et<c.points.length;et++){var $=c.points[et][F]-this.min[F];U=Math.min(U,$),J=Math.max(J,$)}if(J<0||U>this.max[F]-this.min[F])return 0}return 1};var na=function(c,d,f,m){if(c===void 0&&(c=0),d===void 0&&(d=0),f===void 0&&(f=0),m===void 0&&(m=0),isNaN(c)||c<0||isNaN(d)||d<0||isNaN(f)||f<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=d,this.left=f,this.right=m};na.prototype.interpolate=function(c,d,f){return d.top!=null&&c.top!=null&&(this.top=o.number(c.top,d.top,f)),d.bottom!=null&&c.bottom!=null&&(this.bottom=o.number(c.bottom,d.bottom,f)),d.left!=null&&c.left!=null&&(this.left=o.number(c.left,d.left,f)),d.right!=null&&c.right!=null&&(this.right=o.number(c.right,d.right,f)),this},na.prototype.getCenter=function(c,d){var f=o.clamp((this.left+c-this.right)/2,0,c),m=o.clamp((this.top+d-this.bottom)/2,0,d);return new o.Point(f,m)},na.prototype.equals=function(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right},na.prototype.clone=function(){return new na(this.top,this.bottom,this.left,this.right)},na.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var un=function(c,d,f,m,E){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=E===void 0||E,this._minZoom=c||0,this._maxZoom=d||22,this._minPitch=f??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new na,this._posMatrixCache={},this._alignedPosMatrixCache={}},Un={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};un.prototype.clone=function(){var c=new un(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return c.tileSize=this.tileSize,c.latRange=this.latRange,c.width=this.width,c.height=this.height,c._center=this._center,c.zoom=this.zoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._calcMatrices(),c},Un.minZoom.get=function(){return this._minZoom},Un.minZoom.set=function(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))},Un.maxZoom.get=function(){return this._maxZoom},Un.maxZoom.set=function(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))},Un.minPitch.get=function(){return this._minPitch},Un.minPitch.set=function(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))},Un.maxPitch.get=function(){return this._maxPitch},Un.maxPitch.set=function(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))},Un.renderWorldCopies.get=function(){return this._renderWorldCopies},Un.renderWorldCopies.set=function(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c},Un.worldSize.get=function(){return this.tileSize*this.scale},Un.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Un.size.get=function(){return new o.Point(this.width,this.height)},Un.bearing.get=function(){return-this.angle/Math.PI*180},Un.bearing.set=function(c){var d=-o.wrap(c,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=o.create$2(),o.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Un.pitch.get=function(){return this._pitch/Math.PI*180},Un.pitch.set=function(c){var d=o.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())},Un.fov.get=function(){return this._fov/Math.PI*180},Un.fov.set=function(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=c/180*Math.PI,this._calcMatrices())},Un.zoom.get=function(){return this._zoom},Un.zoom.set=function(c){var d=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom,this._constrain(),this._calcMatrices())},Un.center.get=function(){return this._center},Un.center.set=function(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._constrain(),this._calcMatrices())},Un.padding.get=function(){return this._edgeInsets.toJSON()},Un.padding.set=function(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())},Un.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},un.prototype.isPaddingEqual=function(c){return this._edgeInsets.equals(c)},un.prototype.interpolatePadding=function(c,d,f){this._unmodified=!1,this._edgeInsets.interpolate(c,d,f),this._constrain(),this._calcMatrices()},un.prototype.coveringZoomLevel=function(c){var d=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,d)},un.prototype.getVisibleUnwrappedCoordinates=function(c){var d=[new o.UnwrappedTileID(0,c)];if(this._renderWorldCopies)for(var f=this.pointCoordinate(new o.Point(0,0)),m=this.pointCoordinate(new o.Point(this.width,0)),E=this.pointCoordinate(new o.Point(this.width,this.height)),P=this.pointCoordinate(new o.Point(0,this.height)),R=Math.floor(Math.min(f.x,m.x,E.x,P.x)),F=Math.floor(Math.max(f.x,m.x,E.x,P.x)),U=R-1;U<=F+1;U++)U!==0&&d.push(new o.UnwrappedTileID(U,c));return d},un.prototype.coveringTiles=function(c){var d=this.coveringZoomLevel(c),f=d;if(c.minzoom!==void 0&&d<c.minzoom)return[];c.maxzoom!==void 0&&d>c.maxzoom&&(d=c.maxzoom);var m=o.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,d),P=[E*m.x,E*m.y,0],R=Cu.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d),F=c.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(F=d);var U=function(we){return{aabb:new ia([we*E,0,0],[(we+1)*E,E,0]),zoom:0,x:0,y:0,wrap:we,fullyVisible:!1}},J=[],et=[],$=d,it=c.reparseOverscaled?f:d;if(this._renderWorldCopies)for(var st=1;st<=3;st++)J.push(U(-st)),J.push(U(st));for(J.push(U(0));J.length>0;){var xt=J.pop(),Rt=xt.x,yt=xt.y,It=xt.fullyVisible;if(!It){var Ht=xt.aabb.intersects(R);if(Ht===0)continue;It=Ht===2}var Xt=xt.aabb.distanceX(P),ee=xt.aabb.distanceY(P),Qt=Math.max(Math.abs(Xt),Math.abs(ee));if(xt.zoom===$||Qt>3+(1<<$-xt.zoom)-2&&xt.zoom>=F)et.push({tileID:new o.OverscaledTileID(xt.zoom===$?it:xt.zoom,xt.wrap,xt.zoom,Rt,yt),distanceSq:o.sqrLen([P[0]-.5-Rt,P[1]-.5-yt])});else for(var $t=0;$t<4;$t++){var Ae=(Rt<<1)+$t%2,Le=(yt<<1)+($t>>1);J.push({aabb:xt.aabb.quadrant($t),zoom:xt.zoom+1,x:Ae,y:Le,wrap:xt.wrap,fullyVisible:It})}}return et.sort(function(we,Ge){return we.distanceSq-Ge.distanceSq}).map(function(we){return we.tileID})},un.prototype.resize=function(c,d){this.width=c,this.height=d,this.pixelsToGLUnits=[2/c,-2/d],this._constrain(),this._calcMatrices()},Un.unmodified.get=function(){return this._unmodified},un.prototype.zoomScale=function(c){return Math.pow(2,c)},un.prototype.scaleZoom=function(c){return Math.log(c)/Math.LN2},un.prototype.project=function(c){var d=o.clamp(c.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.Point(o.mercatorXfromLng(c.lng)*this.worldSize,o.mercatorYfromLat(d)*this.worldSize)},un.prototype.unproject=function(c){return new o.MercatorCoordinate(c.x/this.worldSize,c.y/this.worldSize).toLngLat()},Un.point.get=function(){return this.project(this.center)},un.prototype.setLocationAtPoint=function(c,d){var f=this.pointCoordinate(d),m=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(c),P=new o.MercatorCoordinate(E.x-(f.x-m.x),E.y-(f.y-m.y));this.center=this.coordinateLocation(P),this._renderWorldCopies&&(this.center=this.center.wrap())},un.prototype.locationPoint=function(c){return this.coordinatePoint(this.locationCoordinate(c))},un.prototype.pointLocation=function(c){return this.coordinateLocation(this.pointCoordinate(c))},un.prototype.locationCoordinate=function(c){return o.MercatorCoordinate.fromLngLat(c)},un.prototype.coordinateLocation=function(c){return c.toLngLat()},un.prototype.pointCoordinate=function(c){var d=[c.x,c.y,0,1],f=[c.x,c.y,1,1];o.transformMat4(d,d,this.pixelMatrixInverse),o.transformMat4(f,f,this.pixelMatrixInverse);var m=d[3],E=f[3],P=d[1]/m,R=f[1]/E,F=d[2]/m,U=f[2]/E,J=F===U?0:(0-F)/(U-F);return new o.MercatorCoordinate(o.number(d[0]/m,f[0]/E,J)/this.worldSize,o.number(P,R,J)/this.worldSize)},un.prototype.coordinatePoint=function(c){var d=[c.x*this.worldSize,c.y*this.worldSize,0,1];return o.transformMat4(d,d,this.pixelMatrix),new o.Point(d[0]/d[3],d[1]/d[3])},un.prototype.getBounds=function(){return new o.LngLatBounds().extend(this.pointLocation(new o.Point(0,0))).extend(this.pointLocation(new o.Point(this.width,0))).extend(this.pointLocation(new o.Point(this.width,this.height))).extend(this.pointLocation(new o.Point(0,this.height)))},un.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new o.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},un.prototype.setMaxBounds=function(c){c?(this.lngRange=[c.getWest(),c.getEast()],this.latRange=[c.getSouth(),c.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},un.prototype.calculatePosMatrix=function(c,d){d===void 0&&(d=!1);var f=c.key,m=d?this._alignedPosMatrixCache:this._posMatrixCache;if(m[f])return m[f];var E=c.canonical,P=this.worldSize/this.zoomScale(E.z),R=E.x+Math.pow(2,E.z)*c.wrap,F=o.identity(new Float64Array(16));return o.translate(F,F,[R*P,E.y*P,0]),o.scale(F,F,[P/o.EXTENT,P/o.EXTENT,1]),o.multiply(F,d?this.alignedProjMatrix:this.projMatrix,F),m[f]=new Float32Array(F),m[f]},un.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},un.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var c,d,f,m,E=-90,P=90,R=-180,F=180,U=this.size,J=this._unmodified;if(this.latRange){var et=this.latRange;E=o.mercatorYfromLat(et[1])*this.worldSize,c=(P=o.mercatorYfromLat(et[0])*this.worldSize)-E<U.y?U.y/(P-E):0}if(this.lngRange){var $=this.lngRange;R=o.mercatorXfromLng($[0])*this.worldSize,d=(F=o.mercatorXfromLng($[1])*this.worldSize)-R<U.x?U.x/(F-R):0}var it=this.point,st=Math.max(d||0,c||0);if(st)return this.center=this.unproject(new o.Point(d?(F+R)/2:it.x,c?(P+E)/2:it.y)),this.zoom+=this.scaleZoom(st),this._unmodified=J,void(this._constraining=!1);if(this.latRange){var xt=it.y,Rt=U.y/2;xt-Rt<E&&(m=E+Rt),xt+Rt>P&&(m=P-Rt)}if(this.lngRange){var yt=it.x,It=U.x/2;yt-It<R&&(f=R+It),yt+It>F&&(f=F-It)}f===void 0&&m===void 0||(this.center=this.unproject(new o.Point(f!==void 0?f:it.x,m!==void 0?m:it.y))),this._unmodified=J,this._constraining=!1}},un.prototype._calcMatrices=function(){if(this.height){var c=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var d=Math.PI/2+this._pitch,f=this._fov*(.5+c.y/this.height),m=Math.sin(f)*this.cameraToCenterDistance/Math.sin(o.clamp(Math.PI-d-f,.01,Math.PI-.01)),E=this.point,P=E.x,R=E.y,F=1.01*(Math.cos(Math.PI/2-this._pitch)*m+this.cameraToCenterDistance),U=this.height/50,J=new Float64Array(16);o.perspective(J,this._fov,this.width/this.height,U,F),J[8]=2*-c.x/this.width,J[9]=2*c.y/this.height,o.scale(J,J,[1,-1,1]),o.translate(J,J,[0,0,-this.cameraToCenterDistance]),o.rotateX(J,J,this._pitch),o.rotateZ(J,J,this.angle),o.translate(J,J,[-P,-R,0]),this.mercatorMatrix=o.scale([],J,[this.worldSize,this.worldSize,this.worldSize]),o.scale(J,J,[1,1,o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=J,this.invProjMatrix=o.invert([],this.projMatrix);var et=this.width%2/2,$=this.height%2/2,it=Math.cos(this.angle),st=Math.sin(this.angle),xt=P-Math.round(P)+it*et+st*$,Rt=R-Math.round(R)+it*$+st*et,yt=new Float64Array(J);if(o.translate(yt,yt,[xt>.5?xt-1:xt,Rt>.5?Rt-1:Rt,0]),this.alignedProjMatrix=yt,J=o.create(),o.scale(J,J,[this.width/2,-this.height/2,1]),o.translate(J,J,[1,-1,0]),this.labelPlaneMatrix=J,J=o.create(),o.scale(J,J,[1,-1,1]),o.translate(J,J,[-1,-1,0]),o.scale(J,J,[2/this.width,2/this.height,1]),this.glCoordMatrix=J,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(J=o.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=J,this._posMatrixCache={},this._alignedPosMatrixCache={}}},un.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var c=this.pointCoordinate(new o.Point(0,0)),d=[c.x*this.worldSize,c.y*this.worldSize,0,1];return o.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance},un.prototype.getCameraPoint=function(){var c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.Point(0,c))},un.prototype.getCameraQueryGeometry=function(c){var d=this.getCameraPoint();if(c.length===1)return[c[0],d];for(var f=d.x,m=d.y,E=d.x,P=d.y,R=0,F=c;R<F.length;R+=1){var U=F[R];f=Math.min(f,U.x),m=Math.min(m,U.y),E=Math.max(E,U.x),P=Math.max(P,U.y)}return[new o.Point(f,m),new o.Point(E,m),new o.Point(E,P),new o.Point(f,P),new o.Point(f,m)]},Object.defineProperties(un.prototype,Un);var Ko=function(c){var d,f,m,E;this._hashName=c&&encodeURIComponent(c),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(d=this._updateHashUnthrottled.bind(this),f=!1,m=null,E=function(){m=null,f&&(d(),m=setTimeout(E,300),f=!1)},function(){return f=!0,m||E(),m})};Ko.prototype.addTo=function(c){return this._map=c,o.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ko.prototype.remove=function(){return o.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ko.prototype.getHashString=function(c){var d=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,m=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,m),P=Math.round(d.lng*E)/E,R=Math.round(d.lat*E)/E,F=this._map.getBearing(),U=this._map.getPitch(),J="";if(J+=c?"/"+P+"/"+R+"/"+f:f+"/"+R+"/"+P,(F||U)&&(J+="/"+Math.round(10*F)/10),U&&(J+="/"+Math.round(U)),this._hashName){var et=this._hashName,$=!1,it=o.window.location.hash.slice(1).split("&").map(function(st){var xt=st.split("=")[0];return xt===et?($=!0,xt+"="+J):st}).filter(function(st){return st});return $||it.push(et+"="+J),"#"+it.join("&")}return"#"+J},Ko.prototype._getCurrentHash=function(){var c,d=this,f=o.window.location.hash.replace("#","");return this._hashName?(f.split("&").map(function(m){return m.split("=")}).forEach(function(m){m[0]===d._hashName&&(c=m)}),(c&&c[1]||"").split("/")):f.split("/")},Ko.prototype._onHashChange=function(){var c=this._getCurrentHash();if(c.length>=3&&!c.some(function(f){return isNaN(f)})){var d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(c[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:d,pitch:+(c[4]||0)}),!0}return!1},Ko.prototype._updateHashUnthrottled=function(){var c=o.window.location.href.replace(/(#.+)?$/,this.getHashString());try{o.window.history.replaceState(o.window.history.state,null,c)}catch{}};var Dc={linearity:.3,easing:o.bezier(0,0,.3,1)},zl=o.extend({deceleration:2500,maxSpeed:1400},Dc),Oc=o.extend({deceleration:20,maxSpeed:1400},Dc),fA=o.extend({deceleration:1e3,maxSpeed:360},Dc),dA=o.extend({deceleration:1e3,maxSpeed:90},Dc),Vl=function(c){this._map=c,this.clear()};function Lc(c,d){(!c.duration||c.duration<d.duration)&&(c.duration=d.duration,c.easing=d.easing)}function Fs(c,d,f){var m=f.maxSpeed,E=f.linearity,P=f.deceleration,R=o.clamp(c*E/(d/1e3),-m,m),F=Math.abs(R)/(P*E);return{easing:f.easing,duration:1e3*F,amount:R*(F/2)}}Vl.prototype.clear=function(){this._inertiaBuffer=[]},Vl.prototype.record=function(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.browser.now(),settings:c})},Vl.prototype._drainInertiaBuffer=function(){for(var c=this._inertiaBuffer,d=o.browser.now();c.length>0&&d-c[0].time>160;)c.shift()},Vl.prototype._onMoveEnd=function(c){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var d={zoom:0,bearing:0,pitch:0,pan:new o.Point(0,0),pinchAround:void 0,around:void 0},f=0,m=this._inertiaBuffer;f<m.length;f+=1){var E=m[f].settings;d.zoom+=E.zoomDelta||0,d.bearing+=E.bearingDelta||0,d.pitch+=E.pitchDelta||0,E.panDelta&&d.pan._add(E.panDelta),E.around&&(d.around=E.around),E.pinchAround&&(d.pinchAround=E.pinchAround)}var P=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,R={};if(d.pan.mag()){var F=Fs(d.pan.mag(),P,o.extend({},zl,c||{}));R.offset=d.pan.mult(F.amount/d.pan.mag()),R.center=this._map.transform.center,Lc(R,F)}if(d.zoom){var U=Fs(d.zoom,P,Oc);R.zoom=this._map.transform.zoom+U.amount,Lc(R,U)}if(d.bearing){var J=Fs(d.bearing,P,fA);R.bearing=this._map.transform.bearing+o.clamp(J.amount,-179,179),Lc(R,J)}if(d.pitch){var et=Fs(d.pitch,P,dA);R.pitch=this._map.transform.pitch+et.amount,Lc(R,et)}if(R.zoom||R.bearing){var $=d.pinchAround===void 0?d.around:d.pinchAround;R.around=$?this._map.unproject($):this._map.getCenter()}return this.clear(),o.extend(R,{noMoveStart:!0})}};var Gn=function(c){function d(m,E,P,R){R===void 0&&(R={});var F=h.mousePos(E.getCanvasContainer(),P),U=E.unproject(F);c.call(this,m,o.extend({point:F,lngLat:U,originalEvent:P},R)),this._defaultPrevented=!1,this.target=E}c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d;var f={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,f),d}(o.Event),jl=function(c){function d(m,E,P){var R=m==="touchend"?P.changedTouches:P.touches,F=h.touchPos(E.getCanvasContainer(),R),U=F.map(function($){return E.unproject($)}),J=F.reduce(function($,it,st,xt){return $.add(it.div(xt.length))},new o.Point(0,0)),et=E.unproject(J);c.call(this,m,{points:F,point:J,lngLats:U,lngLat:et,originalEvent:P}),this._defaultPrevented=!1}c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d;var f={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,f),d}(o.Event),Wf=function(c){function d(m,E,P){c.call(this,m,{originalEvent:P}),this._defaultPrevented=!1}c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d;var f={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,f),d}(o.Event),Er=function(c,d){this._map=c,this._clickTolerance=d.clickTolerance};Er.prototype.reset=function(){delete this._mousedownPos},Er.prototype.wheel=function(c){return this._firePreventable(new Wf(c.type,this._map,c))},Er.prototype.mousedown=function(c,d){return this._mousedownPos=d,this._firePreventable(new Gn(c.type,this._map,c))},Er.prototype.mouseup=function(c){this._map.fire(new Gn(c.type,this._map,c))},Er.prototype.click=function(c,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Gn(c.type,this._map,c))},Er.prototype.dblclick=function(c){return this._firePreventable(new Gn(c.type,this._map,c))},Er.prototype.mouseover=function(c){this._map.fire(new Gn(c.type,this._map,c))},Er.prototype.mouseout=function(c){this._map.fire(new Gn(c.type,this._map,c))},Er.prototype.touchstart=function(c){return this._firePreventable(new jl(c.type,this._map,c))},Er.prototype.touchmove=function(c){this._map.fire(new jl(c.type,this._map,c))},Er.prototype.touchend=function(c){this._map.fire(new jl(c.type,this._map,c))},Er.prototype.touchcancel=function(c){this._map.fire(new jl(c.type,this._map,c))},Er.prototype._firePreventable=function(c){if(this._map.fire(c),c.defaultPrevented)return{}},Er.prototype.isEnabled=function(){return!0},Er.prototype.isActive=function(){return!1},Er.prototype.enable=function(){},Er.prototype.disable=function(){};var ai=function(c){this._map=c};ai.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},ai.prototype.mousemove=function(c){this._map.fire(new Gn(c.type,this._map,c))},ai.prototype.mousedown=function(){this._delayContextMenu=!0},ai.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Gn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},ai.prototype.contextmenu=function(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new Gn(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()},ai.prototype.isEnabled=function(){return!0},ai.prototype.isActive=function(){return!1},ai.prototype.enable=function(){},ai.prototype.disable=function(){};var Ro=function(c,d){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=d.clickTolerance||1};function Eu(c,d){for(var f={},m=0;m<c.length;m++)f[c[m].identifier]=d[m];return f}Ro.prototype.isEnabled=function(){return!!this._enabled},Ro.prototype.isActive=function(){return!!this._active},Ro.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Ro.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ro.prototype.mousedown=function(c,d){this.isEnabled()&&c.shiftKey&&c.button===0&&(h.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)},Ro.prototype.mousemoveWindow=function(c,d){if(this._active){var f=d;if(!(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)){var m=this._startPos;this._lastPos=f,this._box||(this._box=h.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));var E=Math.min(m.x,f.x),P=Math.max(m.x,f.x),R=Math.min(m.y,f.y),F=Math.max(m.y,f.y);h.setTransform(this._box,"translate("+E+"px,"+R+"px)"),this._box.style.width=P-E+"px",this._box.style.height=F-R+"px"}}},Ro.prototype.mouseupWindow=function(c,d){var f=this;if(this._active&&c.button===0){var m=this._startPos,E=d;if(this.reset(),h.suppressClick(),m.x!==E.x||m.y!==E.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:function(P){return P.fitScreenCoordinates(m,E,f._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",c)}},Ro.prototype.keydown=function(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))},Ro.prototype.blur=function(){this.reset()},Ro.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(h.remove(this._box),this._box=null),h.enableDrag(),delete this._startPos,delete this._lastPos},Ro.prototype._fireEvent=function(c,d){return this._map.fire(new o.Event(c,{originalEvent:d}))};var Qo=function(c){this.reset(),this.numTouches=c.numTouches};Qo.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Qo.prototype.touchstart=function(c,d,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=c.timeStamp),f.length===this.numTouches&&(this.centroid=function(m){for(var E=new o.Point(0,0),P=0,R=m;P<R.length;P+=1)E._add(R[P]);return E.div(m.length)}(d),this.touches=Eu(f,d)))},Qo.prototype.touchmove=function(c,d,f){if(!this.aborted&&this.centroid){var m=Eu(f,d);for(var E in this.touches){var P=m[E];(!P||P.dist(this.touches[E])>30)&&(this.aborted=!0)}}},Qo.prototype.touchend=function(c,d,f){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){var m=!this.aborted&&this.centroid;if(this.reset(),m)return m}};var ls=function(c){this.singleTap=new Qo(c),this.numTaps=c.numTaps,this.reset()};ls.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},ls.prototype.touchstart=function(c,d,f){this.singleTap.touchstart(c,d,f)},ls.prototype.touchmove=function(c,d,f){this.singleTap.touchmove(c,d,f)},ls.prototype.touchend=function(c,d,f){var m=this.singleTap.touchend(c,d,f);if(m){var E=c.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(m)<30;if(E&&P||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}};var bo=function(){this._zoomIn=new ls({numTouches:1,numTaps:2}),this._zoomOut=new ls({numTouches:2,numTaps:1}),this.reset()};bo.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},bo.prototype.touchstart=function(c,d,f){this._zoomIn.touchstart(c,d,f),this._zoomOut.touchstart(c,d,f)},bo.prototype.touchmove=function(c,d,f){this._zoomIn.touchmove(c,d,f),this._zoomOut.touchmove(c,d,f)},bo.prototype.touchend=function(c,d,f){var m=this,E=this._zoomIn.touchend(c,d,f),P=this._zoomOut.touchend(c,d,f);return E?(this._active=!0,c.preventDefault(),setTimeout(function(){return m.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()+1,around:R.unproject(E)},{originalEvent:c})}}):P?(this._active=!0,c.preventDefault(),setTimeout(function(){return m.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()-1,around:R.unproject(P)},{originalEvent:c})}}):void 0},bo.prototype.touchcancel=function(){this.reset()},bo.prototype.enable=function(){this._enabled=!0},bo.prototype.disable=function(){this._enabled=!1,this.reset()},bo.prototype.isEnabled=function(){return this._enabled},bo.prototype.isActive=function(){return this._active};var Ih={0:1,2:2},$e=function(c){this.reset(),this._clickTolerance=c.clickTolerance||1};$e.prototype.blur=function(){this.reset()},$e.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},$e.prototype._correctButton=function(c,d){return!1},$e.prototype._move=function(c,d){return{}},$e.prototype.mousedown=function(c,d){if(!this._lastPoint){var f=h.mouseButton(c);this._correctButton(c,f)&&(this._lastPoint=d,this._eventButton=f)}},$e.prototype.mousemoveWindow=function(c,d){var f=this._lastPoint;if(f){if(c.preventDefault(),function(m,E){var P=Ih[E];return m.buttons===void 0||(m.buttons&P)!==P}(c,this._eventButton))this.reset();else if(this._moved||!(d.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(f,d)}},$e.prototype.mouseupWindow=function(c){this._lastPoint&&h.mouseButton(c)===this._eventButton&&(this._moved&&h.suppressClick(),this.reset())},$e.prototype.enable=function(){this._enabled=!0},$e.prototype.disable=function(){this._enabled=!1,this.reset()},$e.prototype.isEnabled=function(){return this._enabled},$e.prototype.isActive=function(){return this._active};var Mh=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.mousedown=function(f,m){c.prototype.mousedown.call(this,f,m),this._lastPoint&&(this._active=!0)},d.prototype._correctButton=function(f,m){return m===0&&!f.ctrlKey},d.prototype._move=function(f,m){return{around:m,panDelta:m.sub(f)}},d}($e),Bu=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype._correctButton=function(f,m){return m===0&&f.ctrlKey||m===2},d.prototype._move=function(f,m){var E=.8*(m.x-f.x);if(E)return this._active=!0,{bearingDelta:E}},d.prototype.contextmenu=function(f){f.preventDefault()},d}($e),Ph=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype._correctButton=function(f,m){return m===0&&f.ctrlKey||m===2},d.prototype._move=function(f,m){var E=-.5*(m.y-f.y);if(E)return this._active=!0,{pitchDelta:E}},d.prototype.contextmenu=function(f){f.preventDefault()},d}($e),cs=function(c){this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset()};cs.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new o.Point(0,0)},cs.prototype.touchstart=function(c,d,f){return this._calculateTransform(c,d,f)},cs.prototype.touchmove=function(c,d,f){if(this._active&&!(f.length<this._minTouches))return c.preventDefault(),this._calculateTransform(c,d,f)},cs.prototype.touchend=function(c,d,f){this._calculateTransform(c,d,f),this._active&&f.length<this._minTouches&&this.reset()},cs.prototype.touchcancel=function(){this.reset()},cs.prototype._calculateTransform=function(c,d,f){f.length>0&&(this._active=!0);var m=Eu(f,d),E=new o.Point(0,0),P=new o.Point(0,0),R=0;for(var F in m){var U=m[F],J=this._touches[F];J&&(E._add(U),P._add(U.sub(J)),R++,m[F]=U)}if(this._touches=m,!(R<this._minTouches)&&P.mag()){var et=P.div(R);if(this._sum._add(et),!(this._sum.mag()<this._clickTolerance))return{around:E.div(R),panDelta:et}}},cs.prototype.enable=function(){this._enabled=!0},cs.prototype.disable=function(){this._enabled=!1,this.reset()},cs.prototype.isEnabled=function(){return this._enabled},cs.prototype.isActive=function(){return this._active};var Do=function(){this.reset()};function Tu(c,d,f){for(var m=0;m<c.length;m++)if(c[m].identifier===f)return d[m]}function Su(c,d){return Math.log(c/d)/Math.LN2}Do.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Do.prototype._start=function(c){},Do.prototype._move=function(c,d,f){return{}},Do.prototype.touchstart=function(c,d,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([d[0],d[1]]))},Do.prototype.touchmove=function(c,d,f){if(this._firstTwoTouches){c.preventDefault();var m=this._firstTwoTouches,E=m[1],P=Tu(f,d,m[0]),R=Tu(f,d,E);if(P&&R){var F=this._aroundCenter?null:P.add(R).div(2);return this._move([P,R],F,c)}}},Do.prototype.touchend=function(c,d,f){if(this._firstTwoTouches){var m=this._firstTwoTouches,E=m[1],P=Tu(f,d,m[0]),R=Tu(f,d,E);P&&R||(this._active&&h.suppressClick(),this.reset())}},Do.prototype.touchcancel=function(){this.reset()},Do.prototype.enable=function(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"},Do.prototype.disable=function(){this._enabled=!1,this.reset()},Do.prototype.isEnabled=function(){return this._enabled},Do.prototype.isActive=function(){return this._active};var Oo=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.reset=function(){c.prototype.reset.call(this),delete this._distance,delete this._startDistance},d.prototype._start=function(f){this._startDistance=this._distance=f[0].dist(f[1])},d.prototype._move=function(f,m){var E=this._distance;if(this._distance=f[0].dist(f[1]),this._active||!(Math.abs(Su(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Su(this._distance,E),pinchAround:m}},d}(Do);function ra(c,d){return 180*c.angleWith(d)/Math.PI}var Rh=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.reset=function(){c.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},d.prototype._start=function(f){this._startVector=this._vector=f[0].sub(f[1]),this._minDiameter=f[0].dist(f[1])},d.prototype._move=function(f,m){var E=this._vector;if(this._vector=f[0].sub(f[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ra(this._vector,E),pinchAround:m}},d.prototype._isBelowThreshold=function(f){this._minDiameter=Math.min(this._minDiameter,f.mag());var m=25/(Math.PI*this._minDiameter)*360,E=ra(f,this._startVector);return Math.abs(E)<m},d}(Do);function Hl(c){return Math.abs(c.y)>Math.abs(c.x)}var Br=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.reset=function(){c.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},d.prototype._start=function(f){this._lastPoints=f,Hl(f[0].sub(f[1]))&&(this._valid=!1)},d.prototype._move=function(f,m,E){var P=f[0].sub(this._lastPoints[0]),R=f[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(P,R,E.timeStamp),this._valid)return this._lastPoints=f,this._active=!0,{pitchDelta:(P.y+R.y)/2*-.5}},d.prototype.gestureBeginsVertically=function(f,m,E){if(this._valid!==void 0)return this._valid;var P=f.mag()>=2,R=m.mag()>=2;if(P||R){if(!P||!R)return this._firstMove===void 0&&(this._firstMove=E),E-this._firstMove<100&&void 0;var F=f.y>0==m.y>0;return Hl(f)&&Hl(m)&&F}},d}(Do),Dh={panStep:100,bearingStep:15,pitchStep:10},Ts=function(){var c=Dh;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1};function no(c){return c*(2-c)}Ts.prototype.blur=function(){this.reset()},Ts.prototype.reset=function(){this._active=!1},Ts.prototype.keydown=function(c){var d=this;if(!(c.altKey||c.ctrlKey||c.metaKey)){var f=0,m=0,E=0,P=0,R=0;switch(c.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:c.shiftKey?m=-1:(c.preventDefault(),P=-1);break;case 39:c.shiftKey?m=1:(c.preventDefault(),P=1);break;case 38:c.shiftKey?E=1:(c.preventDefault(),R=-1);break;case 40:c.shiftKey?E=-1:(c.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(m=0,E=0),{cameraAnimation:function(F){var U=F.getZoom();F.easeTo({duration:300,easeId:"keyboardHandler",easing:no,zoom:f?Math.round(U)+f*(c.shiftKey?2:1):U,bearing:F.getBearing()+m*d._bearingStep,pitch:F.getPitch()+E*d._pitchStep,offset:[-P*d._panStep,-R*d._panStep],center:F.getCenter()},{originalEvent:c})}}}},Ts.prototype.enable=function(){this._enabled=!0},Ts.prototype.disable=function(){this._enabled=!1,this.reset()},Ts.prototype.isEnabled=function(){return this._enabled},Ts.prototype.isActive=function(){return this._active},Ts.prototype.disableRotation=function(){this._rotationDisabled=!0},Ts.prototype.enableRotation=function(){this._rotationDisabled=!1};var Vi=function(c,d){this._map=c,this._el=c.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,o.bindAll(["_onTimeout"],this)};Vi.prototype.setZoomRate=function(c){this._defaultZoomRate=c},Vi.prototype.setWheelZoomRate=function(c){this._wheelZoomRate=c},Vi.prototype.isEnabled=function(){return!!this._enabled},Vi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Vi.prototype.isZooming=function(){return!!this._zooming},Vi.prototype.enable=function(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=c&&c.around==="center")},Vi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Vi.prototype.wheel=function(c){if(this.isEnabled()){var d=c.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY,f=o.browser.now(),m=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,d!==0&&d%4.000244140625==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(m*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),c.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=c,this._delta-=d,this._active||this._start(c)),c.preventDefault()}},Vi.prototype._onTimeout=function(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},Vi.prototype._start=function(c){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var d=h.mousePos(this._el,c);this._around=o.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Vi.prototype.renderFrame=function(){var c=this;if(this._frameId&&(this._frameId=null,this.isActive())){var d=this._map.transform;if(this._delta!==0){var f=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,m=2/(1+Math.exp(-Math.abs(this._delta*f)));this._delta<0&&m!==0&&(m=1/m);var E=typeof this._targetZoom=="number"?d.zoomScale(this._targetZoom):d.scale;this._targetZoom=Math.min(d.maxZoom,Math.max(d.minZoom,d.scaleZoom(E*m))),this._type==="wheel"&&(this._startZoom=d.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var P,R=typeof this._targetZoom=="number"?this._targetZoom:d.zoom,F=this._startZoom,U=this._easing,J=!1;if(this._type==="wheel"&&F&&U){var et=Math.min((o.browser.now()-this._lastWheelEventTime)/200,1),$=U(et);P=o.number(F,R,$),et<1?this._frameId||(this._frameId=!0):J=!0}else P=R,J=!0;return this._active=!0,J&&(this._active=!1,this._finishTimeout=setTimeout(function(){c._zooming=!1,c._handler._triggerRenderFrame(),delete c._targetZoom,delete c._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!J,zoomDelta:P-d.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Vi.prototype._smoothOutEasing=function(c){var d=o.ease;if(this._prevEase){var f=this._prevEase,m=(o.browser.now()-f.start)/f.duration,E=f.easing(m+.01)-f.easing(m),P=.27/Math.sqrt(E*E+1e-4)*.01,R=Math.sqrt(.0729-P*P);d=o.bezier(P,R,.25,1)}return this._prevEase={start:o.browser.now(),duration:c,easing:d},d},Vi.prototype.blur=function(){this.reset()},Vi.prototype.reset=function(){this._active=!1};var ks=function(c,d){this._clickZoom=c,this._tapZoom=d};ks.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},ks.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},ks.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},ks.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var us=function(){this.reset()};us.prototype.reset=function(){this._active=!1},us.prototype.blur=function(){this.reset()},us.prototype.dblclick=function(c,d){return c.preventDefault(),{cameraAnimation:function(f){f.easeTo({duration:300,zoom:f.getZoom()+(c.shiftKey?-1:1),around:f.unproject(d)},{originalEvent:c})}}},us.prototype.enable=function(){this._enabled=!0},us.prototype.disable=function(){this._enabled=!1,this.reset()},us.prototype.isEnabled=function(){return this._enabled},us.prototype.isActive=function(){return this._active};var Xr=function(){this._tap=new ls({numTouches:1,numTaps:1}),this.reset()};Xr.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Xr.prototype.touchstart=function(c,d,f){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=d[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(c,d,f))},Xr.prototype.touchmove=function(c,d,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;var m=d[0],E=m.y-this._swipePoint.y;return this._swipePoint=m,c.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(c,d,f)},Xr.prototype.touchend=function(c,d,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(c,d,f)&&(this._tapTime=c.timeStamp)},Xr.prototype.touchcancel=function(){this.reset()},Xr.prototype.enable=function(){this._enabled=!0},Xr.prototype.disable=function(){this._enabled=!1,this.reset()},Xr.prototype.isEnabled=function(){return this._enabled},Xr.prototype.isActive=function(){return this._active};var Ra=function(c,d,f){this._el=c,this._mousePan=d,this._touchPan=f};Ra.prototype.enable=function(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Ra.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Ra.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Ra.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var oa=function(c,d,f){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=d,this._mousePitch=f};oa.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},oa.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},oa.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},oa.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var hs=function(c,d,f,m){this._el=c,this._touchZoom=d,this._touchRotate=f,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0};hs.prototype.enable=function(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},hs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},hs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},hs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},hs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},hs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var ro=function(c){return c.zoom||c.drag||c.pitch||c.rotate},Fc=function(c){function d(){c.apply(this,arguments)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d}(o.Event);function xi(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}var ui=function(c,d){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Vl(c),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d),o.bindAll(["handleEvent","handleWindowEvent"],this);var f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[o.window,"blur",void 0]];for(var m=0,E=this._listeners;m<E.length;m+=1){var P=E[m],R=P[0];h.addEventListener(R,P[1],R===o.window.document?this.handleWindowEvent:this.handleEvent,P[2])}};ui.prototype.destroy=function(){for(var c=0,d=this._listeners;c<d.length;c+=1){var f=d[c],m=f[0];h.removeEventListener(m,f[1],m===o.window.document?this.handleWindowEvent:this.handleEvent,f[2])}},ui.prototype._addDefaultHandlers=function(c){var d=this._map,f=d.getCanvasContainer();this._add("mapEvent",new Er(d,c));var m=d.boxZoom=new Ro(d,c);this._add("boxZoom",m);var E=new bo,P=new us;d.doubleClickZoom=new ks(P,E),this._add("tapZoom",E),this._add("clickZoom",P);var R=new Xr;this._add("tapDragZoom",R);var F=d.touchPitch=new Br;this._add("touchPitch",F);var U=new Bu(c),J=new Ph(c);d.dragRotate=new oa(c,U,J),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",J,["mouseRotate"]);var et=new Mh(c),$=new cs(c);d.dragPan=new Ra(f,et,$),this._add("mousePan",et),this._add("touchPan",$,["touchZoom","touchRotate"]);var it=new Rh,st=new Oo;d.touchZoomRotate=new hs(f,st,it,R),this._add("touchRotate",it,["touchPan","touchZoom"]),this._add("touchZoom",st,["touchPan","touchRotate"]);var xt=d.scrollZoom=new Vi(d,this);this._add("scrollZoom",xt,["mousePan"]);var Rt=d.keyboard=new Ts;this._add("keyboard",Rt),this._add("blockableMapEvent",new ai(d));for(var yt=0,It=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];yt<It.length;yt+=1){var Ht=It[yt];c.interactive&&c[Ht]&&d[Ht].enable(c[Ht])}},ui.prototype._add=function(c,d,f){this._handlers.push({handlerName:c,handler:d,allowed:f}),this._handlersById[c]=d},ui.prototype.stop=function(c){if(!this._updatingCamera){for(var d=0,f=this._handlers;d<f.length;d+=1)f[d].handler.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}},ui.prototype.isActive=function(){for(var c=0,d=this._handlers;c<d.length;c+=1)if(d[c].handler.isActive())return!0;return!1},ui.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},ui.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},ui.prototype.isMoving=function(){return!!ro(this._eventsInProgress)||this.isZooming()},ui.prototype._blockedByActive=function(c,d,f){for(var m in c)if(m!==f&&(!d||d.indexOf(m)<0))return!0;return!1},ui.prototype.handleWindowEvent=function(c){this.handleEvent(c,c.type+"Window")},ui.prototype._getMapTouches=function(c){for(var d=[],f=0,m=c;f<m.length;f+=1){var E=m[f];this._el.contains(E.target)&&d.push(E)}return d},ui.prototype.handleEvent=function(c,d){this._updatingCamera=!0;for(var f=c.type==="renderFrame"?void 0:c,m={needsRenderFrame:!1},E={},P={},R=c.touches?this._getMapTouches(c.touches):void 0,F=R?h.touchPos(this._el,R):h.mousePos(this._el,c),U=0,J=this._handlers;U<J.length;U+=1){var et=J[U],$=et.handlerName,it=et.handler,st=et.allowed;if(it.isEnabled()){var xt=void 0;this._blockedByActive(P,st,$)?it.reset():it[d||c.type]&&(xt=it[d||c.type](c,F,R),this.mergeHandlerResult(m,E,xt,$,f),xt&&xt.needsRenderFrame&&this._triggerRenderFrame()),(xt||it.isActive())&&(P[$]=it)}}var Rt={};for(var yt in this._previousActiveHandlers)P[yt]||(Rt[yt]=f);this._previousActiveHandlers=P,(Object.keys(Rt).length||xi(m))&&(this._changes.push([m,E,Rt]),this._triggerRenderFrame()),(Object.keys(P).length||xi(m))&&this._map._stop(!0),this._updatingCamera=!1;var It=m.cameraAnimation;It&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],It(this._map))},ui.prototype.mergeHandlerResult=function(c,d,f,m,E){if(f){o.extend(c,f);var P={handlerName:m,originalEvent:f.originalEvent||E};f.zoomDelta!==void 0&&(d.zoom=P),f.panDelta!==void 0&&(d.drag=P),f.pitchDelta!==void 0&&(d.pitch=P),f.bearingDelta!==void 0&&(d.rotate=P)}},ui.prototype._applyChanges=function(){for(var c={},d={},f={},m=0,E=this._changes;m<E.length;m+=1){var P=E[m],R=P[0],F=P[1],U=P[2];R.panDelta&&(c.panDelta=(c.panDelta||new o.Point(0,0))._add(R.panDelta)),R.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+R.zoomDelta),R.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+R.bearingDelta),R.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+R.pitchDelta),R.around!==void 0&&(c.around=R.around),R.pinchAround!==void 0&&(c.pinchAround=R.pinchAround),R.noInertia&&(c.noInertia=R.noInertia),o.extend(d,F),o.extend(f,U)}this._updateMapTransform(c,d,f),this._changes=[]},ui.prototype._updateMapTransform=function(c,d,f){var m=this._map,E=m.transform;if(!xi(c))return this._fireEvents(d,f,!0);var P=c.panDelta,R=c.zoomDelta,F=c.bearingDelta,U=c.pitchDelta,J=c.around,et=c.pinchAround;et!==void 0&&(J=et),m._stop(!0),J=J||m.transform.centerPoint;var $=E.pointLocation(P?J.sub(P):J);F&&(E.bearing+=F),U&&(E.pitch+=U),R&&(E.zoom+=R),E.setLocationAtPoint($,J),this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(d,f,!0)},ui.prototype._fireEvents=function(c,d,f){var m=this,E=ro(this._eventsInProgress),P=ro(c),R={};for(var F in c)this._eventsInProgress[F]||(R[F+"start"]=c[F].originalEvent),this._eventsInProgress[F]=c[F];for(var U in!E&&P&&this._fireEvent("movestart",P.originalEvent),R)this._fireEvent(U,R[U]);for(var J in P&&this._fireEvent("move",P.originalEvent),c)this._fireEvent(J,c[J].originalEvent);var et,$={};for(var it in this._eventsInProgress){var st=this._eventsInProgress[it],xt=st.handlerName,Rt=st.originalEvent;this._handlersById[xt].isActive()||(delete this._eventsInProgress[it],$[it+"end"]=et=d[xt]||Rt)}for(var yt in $)this._fireEvent(yt,$[yt]);var It=ro(this._eventsInProgress);if(f&&(E||P)&&!It){this._updatingCamera=!0;var Ht=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Xt=function(ee){return ee!==0&&-m._bearingSnap<ee&&ee<m._bearingSnap};Ht?(Xt(Ht.bearing||this._map.getBearing())&&(Ht.bearing=0),this._map.easeTo(Ht,{originalEvent:et})):(this._map.fire(new o.Event("moveend",{originalEvent:et})),Xt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},ui.prototype._fireEvent=function(c,d){this._map.fire(new o.Event(c,d?{originalEvent:d}:{}))},ui.prototype._requestFrame=function(){var c=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(d){delete c._frameId,c.handleEvent(new Fc("renderFrame",{timeStamp:d})),c._applyChanges()})},ui.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Iu=function(c){function d(f,m){c.call(this),this._moving=!1,this._zooming=!1,this.transform=f,this._bearingSnap=m.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.getCenter=function(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)},d.prototype.setCenter=function(f,m){return this.jumpTo({center:f},m)},d.prototype.panBy=function(f,m,E){return f=o.Point.convert(f).mult(-1),this.panTo(this.transform.center,o.extend({offset:f},m),E)},d.prototype.panTo=function(f,m,E){return this.easeTo(o.extend({center:f},m),E)},d.prototype.getZoom=function(){return this.transform.zoom},d.prototype.setZoom=function(f,m){return this.jumpTo({zoom:f},m),this},d.prototype.zoomTo=function(f,m,E){return this.easeTo(o.extend({zoom:f},m),E)},d.prototype.zoomIn=function(f,m){return this.zoomTo(this.getZoom()+1,f,m),this},d.prototype.zoomOut=function(f,m){return this.zoomTo(this.getZoom()-1,f,m),this},d.prototype.getBearing=function(){return this.transform.bearing},d.prototype.setBearing=function(f,m){return this.jumpTo({bearing:f},m),this},d.prototype.getPadding=function(){return this.transform.padding},d.prototype.setPadding=function(f,m){return this.jumpTo({padding:f},m),this},d.prototype.rotateTo=function(f,m,E){return this.easeTo(o.extend({bearing:f},m),E)},d.prototype.resetNorth=function(f,m){return this.rotateTo(0,o.extend({duration:1e3},f),m),this},d.prototype.resetNorthPitch=function(f,m){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},f),m),this},d.prototype.snapToNorth=function(f,m){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(f,m):this},d.prototype.getPitch=function(){return this.transform.pitch},d.prototype.setPitch=function(f,m){return this.jumpTo({pitch:f},m),this},d.prototype.cameraForBounds=function(f,m){f=o.LngLatBounds.convert(f);var E=m&&m.bearing||0;return this._cameraForBoxAndBearing(f.getNorthWest(),f.getSouthEast(),E,m)},d.prototype._cameraForBoxAndBearing=function(f,m,E,P){var R={top:0,bottom:0,right:0,left:0};if(typeof(P=o.extend({padding:R,offset:[0,0],maxZoom:this.transform.maxZoom},P)).padding=="number"){var F=P.padding;P.padding={top:F,bottom:F,right:F,left:F}}P.padding=o.extend(R,P.padding);var U=this.transform,J=U.padding,et=U.project(o.LngLat.convert(f)),$=U.project(o.LngLat.convert(m)),it=et.rotate(-E*Math.PI/180),st=$.rotate(-E*Math.PI/180),xt=new o.Point(Math.max(it.x,st.x),Math.max(it.y,st.y)),Rt=new o.Point(Math.min(it.x,st.x),Math.min(it.y,st.y)),yt=xt.sub(Rt),It=(U.width-(J.left+J.right+P.padding.left+P.padding.right))/yt.x,Ht=(U.height-(J.top+J.bottom+P.padding.top+P.padding.bottom))/yt.y;if(!(Ht<0||It<0)){var Xt=Math.min(U.scaleZoom(U.scale*Math.min(It,Ht)),P.maxZoom),ee=typeof P.offset.x=="number"?new o.Point(P.offset.x,P.offset.y):o.Point.convert(P.offset),Qt=new o.Point((P.padding.left-P.padding.right)/2,(P.padding.top-P.padding.bottom)/2).rotate(E*Math.PI/180),$t=ee.add(Qt).mult(U.scale/U.zoomScale(Xt));return{center:U.unproject(et.add($).div(2).sub($t)),zoom:Xt,bearing:E}}o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},d.prototype.fitBounds=function(f,m,E){return this._fitInternal(this.cameraForBounds(f,m),m,E)},d.prototype.fitScreenCoordinates=function(f,m,E,P,R){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.Point.convert(f)),this.transform.pointLocation(o.Point.convert(m)),E,P),P,R)},d.prototype._fitInternal=function(f,m,E){return f?(delete(m=o.extend(f,m)).padding,m.linear?this.easeTo(m,E):this.flyTo(m,E)):this},d.prototype.jumpTo=function(f,m){this.stop();var E=this.transform,P=!1,R=!1,F=!1;return"zoom"in f&&E.zoom!==+f.zoom&&(P=!0,E.zoom=+f.zoom),f.center!==void 0&&(E.center=o.LngLat.convert(f.center)),"bearing"in f&&E.bearing!==+f.bearing&&(R=!0,E.bearing=+f.bearing),"pitch"in f&&E.pitch!==+f.pitch&&(F=!0,E.pitch=+f.pitch),f.padding==null||E.isPaddingEqual(f.padding)||(E.padding=f.padding),this.fire(new o.Event("movestart",m)).fire(new o.Event("move",m)),P&&this.fire(new o.Event("zoomstart",m)).fire(new o.Event("zoom",m)).fire(new o.Event("zoomend",m)),R&&this.fire(new o.Event("rotatestart",m)).fire(new o.Event("rotate",m)).fire(new o.Event("rotateend",m)),F&&this.fire(new o.Event("pitchstart",m)).fire(new o.Event("pitch",m)).fire(new o.Event("pitchend",m)),this.fire(new o.Event("moveend",m))},d.prototype.easeTo=function(f,m){var E=this;this._stop(!1,f.easeId),((f=o.extend({offset:[0,0],duration:500,easing:o.ease},f)).animate===!1||!f.essential&&o.browser.prefersReducedMotion)&&(f.duration=0);var P=this.transform,R=this.getZoom(),F=this.getBearing(),U=this.getPitch(),J=this.getPadding(),et="zoom"in f?+f.zoom:R,$="bearing"in f?this._normalizeBearing(f.bearing,F):F,it="pitch"in f?+f.pitch:U,st="padding"in f?f.padding:P.padding,xt=o.Point.convert(f.offset),Rt=P.centerPoint.add(xt),yt=P.pointLocation(Rt),It=o.LngLat.convert(f.center||yt);this._normalizeCenter(It);var Ht,Xt,ee=P.project(yt),Qt=P.project(It).sub(ee),$t=P.zoomScale(et-R);f.around&&(Ht=o.LngLat.convert(f.around),Xt=P.locationPoint(Ht));var Ae={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||et!==R,this._rotating=this._rotating||F!==$,this._pitching=this._pitching||it!==U,this._padding=!P.isPaddingEqual(st),this._easeId=f.easeId,this._prepareEase(m,f.noMoveStart,Ae),this._ease(function(Le){if(E._zooming&&(P.zoom=o.number(R,et,Le)),E._rotating&&(P.bearing=o.number(F,$,Le)),E._pitching&&(P.pitch=o.number(U,it,Le)),E._padding&&(P.interpolatePadding(J,st,Le),Rt=P.centerPoint.add(xt)),Ht)P.setLocationAtPoint(Ht,Xt);else{var we=P.zoomScale(P.zoom-R),Ge=et>R?Math.min(2,$t):Math.max(.5,$t),si=Math.pow(Ge,1-Le),Ci=P.unproject(ee.add(Qt.mult(Le*si)).mult(we));P.setLocationAtPoint(P.renderWorldCopies?Ci.wrap():Ci,Rt)}E._fireMoveEvents(m)},function(Le){E._afterEase(m,Le)},f),this},d.prototype._prepareEase=function(f,m,E){E===void 0&&(E={}),this._moving=!0,m||E.moving||this.fire(new o.Event("movestart",f)),this._zooming&&!E.zooming&&this.fire(new o.Event("zoomstart",f)),this._rotating&&!E.rotating&&this.fire(new o.Event("rotatestart",f)),this._pitching&&!E.pitching&&this.fire(new o.Event("pitchstart",f))},d.prototype._fireMoveEvents=function(f){this.fire(new o.Event("move",f)),this._zooming&&this.fire(new o.Event("zoom",f)),this._rotating&&this.fire(new o.Event("rotate",f)),this._pitching&&this.fire(new o.Event("pitch",f))},d.prototype._afterEase=function(f,m){if(!this._easeId||!m||this._easeId!==m){delete this._easeId;var E=this._zooming,P=this._rotating,R=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,E&&this.fire(new o.Event("zoomend",f)),P&&this.fire(new o.Event("rotateend",f)),R&&this.fire(new o.Event("pitchend",f)),this.fire(new o.Event("moveend",f))}},d.prototype.flyTo=function(f,m){var E=this;if(!f.essential&&o.browser.prefersReducedMotion){var P=o.pick(f,["center","zoom","bearing","pitch","around"]);return this.jumpTo(P,m)}this.stop(),f=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},f);var R=this.transform,F=this.getZoom(),U=this.getBearing(),J=this.getPitch(),et=this.getPadding(),$="zoom"in f?o.clamp(+f.zoom,R.minZoom,R.maxZoom):F,it="bearing"in f?this._normalizeBearing(f.bearing,U):U,st="pitch"in f?+f.pitch:J,xt="padding"in f?f.padding:R.padding,Rt=R.zoomScale($-F),yt=o.Point.convert(f.offset),It=R.centerPoint.add(yt),Ht=R.pointLocation(It),Xt=o.LngLat.convert(f.center||Ht);this._normalizeCenter(Xt);var ee=R.project(Ht),Qt=R.project(Xt).sub(ee),$t=f.curve,Ae=Math.max(R.width,R.height),Le=Ae/Rt,we=Qt.mag();if("minZoom"in f){var Ge=o.clamp(Math.min(f.minZoom,F,$),R.minZoom,R.maxZoom),si=Ae/R.zoomScale(Ge-F);$t=Math.sqrt(si/we*2)}var Ci=$t*$t;function Ti(Li){var Di=(Le*Le-Ae*Ae+(Li?-1:1)*Ci*Ci*we*we)/(2*(Li?Le:Ae)*Ci*we);return Math.log(Math.sqrt(Di*Di+1)-Di)}function xn(Li){return(Math.exp(Li)-Math.exp(-Li))/2}function li(Li){return(Math.exp(Li)+Math.exp(-Li))/2}var Hi=Ti(0),en=function(Li){return li(Hi)/li(Hi+$t*Li)},ji=function(Li){return Ae*((li(Hi)*(xn(Di=Hi+$t*Li)/li(Di))-xn(Hi))/Ci)/we;var Di},Ui=(Ti(1)-Hi)/$t;if(Math.abs(we)<1e-6||!isFinite(Ui)){if(Math.abs(Ae-Le)<1e-6)return this.easeTo(f,m);var Zi=Le<Ae?-1:1;Ui=Math.abs(Math.log(Le/Ae))/$t,ji=function(){return 0},en=function(Li){return Math.exp(Zi*$t*Li)}}return f.duration="duration"in f?+f.duration:1e3*Ui/("screenSpeed"in f?+f.screenSpeed/$t:+f.speed),f.maxDuration&&f.duration>f.maxDuration&&(f.duration=0),this._zooming=!0,this._rotating=U!==it,this._pitching=st!==J,this._padding=!R.isPaddingEqual(xt),this._prepareEase(m,!1),this._ease(function(Li){var Di=Li*Ui,Qr=1/en(Di);R.zoom=Li===1?$:F+R.scaleZoom(Qr),E._rotating&&(R.bearing=o.number(U,it,Li)),E._pitching&&(R.pitch=o.number(J,st,Li)),E._padding&&(R.interpolatePadding(et,xt,Li),It=R.centerPoint.add(yt));var Tr=Li===1?Xt:R.unproject(ee.add(Qt.mult(ji(Di))).mult(Qr));R.setLocationAtPoint(R.renderWorldCopies?Tr.wrap():Tr,It),E._fireMoveEvents(m)},function(){return E._afterEase(m)},f),this},d.prototype.isEasing=function(){return!!this._easeFrameId},d.prototype.stop=function(){return this._stop()},d.prototype._stop=function(f,m){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var E=this._onEaseEnd;delete this._onEaseEnd,E.call(this,m)}if(!f){var P=this.handlers;P&&P.stop(!1)}return this},d.prototype._ease=function(f,m,E){E.animate===!1||E.duration===0?(f(1),m()):(this._easeStart=o.browser.now(),this._easeOptions=E,this._onEaseFrame=f,this._onEaseEnd=m,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},d.prototype._renderFrameCallback=function(){var f=Math.min((o.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},d.prototype._normalizeBearing=function(f,m){f=o.wrap(f,-180,180);var E=Math.abs(f-m);return Math.abs(f-360-m)<E&&(f-=360),Math.abs(f+360-m)<E&&(f+=360),f},d.prototype._normalizeCenter=function(f){var m=this.transform;if(m.renderWorldCopies&&!m.lngRange){var E=f.lng-m.center.lng;f.lng+=E>180?-360:E<-180?360:0}},d}(o.Evented),fo=function(c){c===void 0&&(c={}),this.options=c,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};fo.prototype.getDefaultPosition=function(){return"bottom-right"},fo.prototype.onAdd=function(c){var d=this.options&&this.options.compact;return this._map=c,this._container=h.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=h.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=h.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},fo.prototype.onRemove=function(){h.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},fo.prototype._setElementTitle=function(c,d){var f=this._map._getUIString("AttributionControl."+d);c.title=f,c.setAttribute("aria-label",f)},fo.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},fo.prototype._updateEditLink=function(){var c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));var d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(c){var f=d.reduce(function(m,E,P){return E.value&&(m+=E.key+"="+E.value+(P<d.length-1?"&":"")),m},"?");c.href=o.config.FEEDBACK_URL+"/"+f+(this._map._hash?this._map._hash.getHashString(!0):""),c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}},fo.prototype._updateData=function(c){!c||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility"&&c.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},fo.prototype._updateAttributions=function(){if(this._map.style){var c=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=c.concat(this.options.customAttribution.map(function(F){return typeof F!="string"?"":F})):typeof this.options.customAttribution=="string"&&c.push(this.options.customAttribution)),this._map.style.stylesheet){var d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}var f=this._map.style.sourceCaches;for(var m in f){var E=f[m];if(E.used){var P=E.getSource();P.attribution&&c.indexOf(P.attribution)<0&&c.push(P.attribution)}}c.sort(function(F,U){return F.length-U.length});var R=(c=c.filter(function(F,U){for(var J=U+1;J<c.length;J++)if(c[J].indexOf(F)>=0)return!1;return!0})).join(" | ");R!==this._attribHTML&&(this._attribHTML=R,c.length?(this._innerContainer.innerHTML=R,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},fo.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Kr=function(){o.bindAll(["_updateLogo"],this),o.bindAll(["_updateCompact"],this)};Kr.prototype.onAdd=function(c){this._map=c,this._container=h.create("div","mapboxgl-ctrl");var d=h.create("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Kr.prototype.onRemove=function(){h.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Kr.prototype.getDefaultPosition=function(){return"bottom-left"},Kr.prototype._updateLogo=function(c){c&&c.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Kr.prototype._logoRequired=function(){if(this._map.style){var c=this._map.style.sourceCaches;for(var d in c)if(c[d].getSource().mapbox_logo)return!0;return!1}},Kr.prototype._updateCompact=function(){var c=this._container.children;if(c.length){var d=c[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}};var Qn=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Qn.prototype.add=function(c){var d=++this._id;return this._queue.push({callback:c,id:d,cancelled:!1}),d},Qn.prototype.remove=function(c){for(var d=this._currentlyRunning,f=0,m=d?this._queue.concat(d):this._queue;f<m.length;f+=1){var E=m[f];if(E.id===c)return void(E.cancelled=!0)}},Qn.prototype.run=function(c){c===void 0&&(c=0);var d=this._currentlyRunning=this._queue;this._queue=[];for(var f=0,m=d;f<m.length;f+=1){var E=m[f];if(!E.cancelled&&(E.callback(c),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Qn.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Ni={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},fs=o.window.HTMLImageElement,pn=o.window.HTMLElement,Ki=o.window.ImageBitmap,Fr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Mu=function(c){function d(m){var E=this;if((m=o.extend({},Fr,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var P=new un(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies);if(c.call(this,P,m),this._interactive=m.interactive,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new Qn,this._controls=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Ni,m.locale),this._clickTolerance=m.clickTolerance,this._requestManager=new o.RequestManager(m.transformRequest,m.accessToken),typeof m.container=="string"){if(this._container=o.window.document.getElementById(m.container),!this._container)throw new Error("Container '"+m.container+"' not found.")}else{if(!(m.container instanceof pn))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return E._update(!1)}),this.on("moveend",function(){return E._update(!1)}),this.on("zoom",function(){return E._update(!0)}),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new ui(this,m),this._hash=m.hash&&new Ko(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,o.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new fo({customAttribution:m.customAttribution})),this.addControl(new Kr,m.logoPosition),this.on("style.load",function(){E.transform.unmodified&&E.jumpTo(E.style.stylesheet)}),this.on("data",function(R){E._update(R.dataType==="style"),E.fire(new o.Event(R.dataType+"data",R))}),this.on("dataloading",function(R){E.fire(new o.Event(R.dataType+"dataloading",R))})}c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d;var f={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return d.prototype._getMapId=function(){return this._mapId},d.prototype.addControl=function(m,E){if(E===void 0&&(E=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var P=m.onAdd(this);this._controls.push(m);var R=this._controlPositions[E];return E.indexOf("bottom")!==-1?R.insertBefore(P,R.firstChild):R.appendChild(P),this},d.prototype.removeControl=function(m){if(!m||!m.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var E=this._controls.indexOf(m);return E>-1&&this._controls.splice(E,1),m.onRemove(this),this},d.prototype.hasControl=function(m){return this._controls.indexOf(m)>-1},d.prototype.resize=function(m){var E=this._containerDimensions(),P=E[0],R=E[1];if(P===this.transform.width&&R===this.transform.height)return this;this._resizeCanvas(P,R),this.transform.resize(P,R),this.painter.resize(P,R);var F=!this._moving;return F&&this.fire(new o.Event("movestart",m)).fire(new o.Event("move",m)),this.fire(new o.Event("resize",m)),F&&this.fire(new o.Event("moveend",m)),this},d.prototype.getBounds=function(){return this.transform.getBounds()},d.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},d.prototype.setMaxBounds=function(m){return this.transform.setMaxBounds(o.LngLatBounds.convert(m)),this._update()},d.prototype.setMinZoom=function(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},d.prototype.getMinZoom=function(){return this.transform.minZoom},d.prototype.setMaxZoom=function(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")},d.prototype.getMaxZoom=function(){return this.transform.maxZoom},d.prototype.setMinPitch=function(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},d.prototype.getMinPitch=function(){return this.transform.minPitch},d.prototype.setMaxPitch=function(m){if((m=m??60)>60)throw new Error("maxPitch must be less than or equal to 60");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")},d.prototype.getMaxPitch=function(){return this.transform.maxPitch},d.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},d.prototype.setRenderWorldCopies=function(m){return this.transform.renderWorldCopies=m,this._update()},d.prototype.project=function(m){return this.transform.locationPoint(o.LngLat.convert(m))},d.prototype.unproject=function(m){return this.transform.pointLocation(o.Point.convert(m))},d.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},d.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},d.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},d.prototype._createDelegatedListener=function(m,E,P){var R,F=this;if(m==="mouseenter"||m==="mouseover"){var U=!1;return{layer:E,listener:P,delegates:{mousemove:function(et){var $=F.getLayer(E)?F.queryRenderedFeatures(et.point,{layers:[E]}):[];$.length?U||(U=!0,P.call(F,new Gn(m,F,et.originalEvent,{features:$}))):U=!1},mouseout:function(){U=!1}}}}if(m==="mouseleave"||m==="mouseout"){var J=!1;return{layer:E,listener:P,delegates:{mousemove:function(et){(F.getLayer(E)?F.queryRenderedFeatures(et.point,{layers:[E]}):[]).length?J=!0:J&&(J=!1,P.call(F,new Gn(m,F,et.originalEvent)))},mouseout:function(et){J&&(J=!1,P.call(F,new Gn(m,F,et.originalEvent)))}}}}return{layer:E,listener:P,delegates:(R={},R[m]=function(et){var $=F.getLayer(E)?F.queryRenderedFeatures(et.point,{layers:[E]}):[];$.length&&(et.features=$,P.call(F,et),delete et.features)},R)}},d.prototype.on=function(m,E,P){if(P===void 0)return c.prototype.on.call(this,m,E);var R=this._createDelegatedListener(m,E,P);for(var F in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(R),R.delegates)this.on(F,R.delegates[F]);return this},d.prototype.once=function(m,E,P){if(P===void 0)return c.prototype.once.call(this,m,E);var R=this._createDelegatedListener(m,E,P);for(var F in R.delegates)this.once(F,R.delegates[F]);return this},d.prototype.off=function(m,E,P){var R=this;return P===void 0?c.prototype.off.call(this,m,E):(this._delegatedListeners&&this._delegatedListeners[m]&&function(F){for(var U=F[m],J=0;J<U.length;J++){var et=U[J];if(et.layer===E&&et.listener===P){for(var $ in et.delegates)R.off($,et.delegates[$]);return U.splice(J,1),R}}}(this._delegatedListeners),this)},d.prototype.queryRenderedFeatures=function(m,E){if(!this.style)return[];var P;if(E!==void 0||m===void 0||m instanceof o.Point||Array.isArray(m)||(E=m,m=void 0),E=E||{},(m=m||[[0,0],[this.transform.width,this.transform.height]])instanceof o.Point||typeof m[0]=="number")P=[o.Point.convert(m)];else{var R=o.Point.convert(m[0]),F=o.Point.convert(m[1]);P=[R,new o.Point(F.x,R.y),F,new o.Point(R.x,F.y),R]}return this.style.queryRenderedFeatures(P,E,this.transform)},d.prototype.querySourceFeatures=function(m,E){return this.style.querySourceFeatures(m,E)},d.prototype.setStyle=function(m,E){return(E=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},E)).diff!==!1&&E.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,E),this):(this._localIdeographFontFamily=E.localIdeographFontFamily,this._updateStyle(m,E))},d.prototype._getUIString=function(m){var E=this._locale[m];if(E==null)throw new Error("Missing UI string '"+m+"'");return E},d.prototype._updateStyle=function(m,E){return this.style&&(this.style.setEventedParent(null),this.style._remove()),m?(this.style=new jn(this,E||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m),this):(delete this.style,this)},d.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new jn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},d.prototype._diffStyle=function(m,E){var P=this;if(typeof m=="string"){var R=this._requestManager.normalizeStyleURL(m),F=this._requestManager.transformRequest(R,o.ResourceType.Style);o.getJSON(F,function(U,J){U?P.fire(new o.ErrorEvent(U)):J&&P._updateDiff(J,E)})}else typeof m=="object"&&this._updateDiff(m,E)},d.prototype._updateDiff=function(m,E){try{this.style.setState(m)&&this._update(!0)}catch(P){o.warnOnce("Unable to perform style diff: "+(P.message||P.error||P)+".  Rebuilding the style from scratch."),this._updateStyle(m,E)}},d.prototype.getStyle=function(){if(this.style)return this.style.serialize()},d.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")},d.prototype.addSource=function(m,E){return this._lazyInitEmptyStyle(),this.style.addSource(m,E),this._update(!0)},d.prototype.isSourceLoaded=function(m){var E=this.style&&this.style.sourceCaches[m];if(E!==void 0)return E.loaded();this.fire(new o.ErrorEvent(new Error("There is no source with ID '"+m+"'")))},d.prototype.areTilesLoaded=function(){var m=this.style&&this.style.sourceCaches;for(var E in m){var P=m[E]._tiles;for(var R in P){var F=P[R];if(F.state!=="loaded"&&F.state!=="errored")return!1}}return!0},d.prototype.addSourceType=function(m,E,P){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,E,P)},d.prototype.removeSource=function(m){return this.style.removeSource(m),this._update(!0)},d.prototype.getSource=function(m){return this.style.getSource(m)},d.prototype.addImage=function(m,E,P){P===void 0&&(P={});var R=P.pixelRatio;R===void 0&&(R=1);var F=P.sdf;F===void 0&&(F=!1);var U=P.stretchX,J=P.stretchY,et=P.content;if(this._lazyInitEmptyStyle(),E instanceof fs||Ki&&E instanceof Ki){var $=o.browser.getImageData(E);this.style.addImage(m,{data:new o.RGBAImage({width:$.width,height:$.height},$.data),pixelRatio:R,stretchX:U,stretchY:J,content:et,sdf:F,version:0})}else{if(E.width===void 0||E.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var it=E;this.style.addImage(m,{data:new o.RGBAImage({width:E.width,height:E.height},new Uint8Array(E.data)),pixelRatio:R,stretchX:U,stretchY:J,content:et,sdf:F,version:0,userImage:it}),it.onAdd&&it.onAdd(this,m)}},d.prototype.updateImage=function(m,E){var P=this.style.getImage(m);if(!P)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var R=E instanceof fs||Ki&&E instanceof Ki?o.browser.getImageData(E):E,F=R.width,U=R.height,J=R.data;return F===void 0||U===void 0?this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):F!==P.data.width||U!==P.data.height?this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(P.data.replace(J,!(E instanceof fs||Ki&&E instanceof Ki)),void this.style.updateImage(m,P))},d.prototype.hasImage=function(m){return m?!!this.style.getImage(m):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)},d.prototype.removeImage=function(m){this.style.removeImage(m)},d.prototype.loadImage=function(m,E){o.getImage(this._requestManager.transformRequest(m,o.ResourceType.Image),E)},d.prototype.listImages=function(){return this.style.listImages()},d.prototype.addLayer=function(m,E){return this._lazyInitEmptyStyle(),this.style.addLayer(m,E),this._update(!0)},d.prototype.moveLayer=function(m,E){return this.style.moveLayer(m,E),this._update(!0)},d.prototype.removeLayer=function(m){return this.style.removeLayer(m),this._update(!0)},d.prototype.getLayer=function(m){return this.style.getLayer(m)},d.prototype.setLayerZoomRange=function(m,E,P){return this.style.setLayerZoomRange(m,E,P),this._update(!0)},d.prototype.setFilter=function(m,E,P){return P===void 0&&(P={}),this.style.setFilter(m,E,P),this._update(!0)},d.prototype.getFilter=function(m){return this.style.getFilter(m)},d.prototype.setPaintProperty=function(m,E,P,R){return R===void 0&&(R={}),this.style.setPaintProperty(m,E,P,R),this._update(!0)},d.prototype.getPaintProperty=function(m,E){return this.style.getPaintProperty(m,E)},d.prototype.setLayoutProperty=function(m,E,P,R){return R===void 0&&(R={}),this.style.setLayoutProperty(m,E,P,R),this._update(!0)},d.prototype.getLayoutProperty=function(m,E){return this.style.getLayoutProperty(m,E)},d.prototype.setLight=function(m,E){return E===void 0&&(E={}),this._lazyInitEmptyStyle(),this.style.setLight(m,E),this._update(!0)},d.prototype.getLight=function(){return this.style.getLight()},d.prototype.setFeatureState=function(m,E){return this.style.setFeatureState(m,E),this._update()},d.prototype.removeFeatureState=function(m,E){return this.style.removeFeatureState(m,E),this._update()},d.prototype.getFeatureState=function(m){return this.style.getFeatureState(m)},d.prototype.getContainer=function(){return this._container},d.prototype.getCanvasContainer=function(){return this._canvasContainer},d.prototype.getCanvas=function(){return this._canvas},d.prototype._containerDimensions=function(){var m=0,E=0;return this._container&&(m=this._container.clientWidth||400,E=this._container.clientHeight||300),[m,E]},d.prototype._detectMissingCSS=function(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},d.prototype._setupContainer=function(){var m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=h.create("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();var E=this._canvasContainer=h.create("div","mapboxgl-canvas-container",m);this._interactive&&E.classList.add("mapboxgl-interactive"),this._canvas=h.create("canvas","mapboxgl-canvas",E),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var P=this._containerDimensions();this._resizeCanvas(P[0],P[1]);var R=this._controlContainer=h.create("div","mapboxgl-control-container",m),F=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(U){F[U]=h.create("div","mapboxgl-ctrl-"+U,R)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},d.prototype._resizeCanvas=function(m,E){var P=o.browser.devicePixelRatio||1;this._canvas.width=P*m,this._canvas.height=P*E,this._canvas.style.width=m+"px",this._canvas.style.height=E+"px"},d.prototype._setupPainter=function(){var m=o.extend({},l.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),E=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);E?(this.painter=new Kn(E,this.transform),o.webpSupported.testSupport(E)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))},d.prototype._contextLost=function(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:m}))},d.prototype._contextRestored=function(m){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:m}))},d.prototype._onMapScroll=function(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},d.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},d.prototype._update=function(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this},d.prototype._requestRenderFrame=function(m){return this._update(),this._renderTaskQueue.add(m)},d.prototype._cancelRenderFrame=function(m){this._renderTaskQueue.remove(m)},d.prototype._render=function(m){var E,P=this,R=0,F=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(E=F.createQueryEXT(),F.beginQueryEXT(F.TIME_ELAPSED_EXT,E),R=o.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),!this._removed){var U=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var J=this.transform.zoom,et=o.browser.now();this.style.zoomHistory.update(J,et);var $=new o.EvaluationParameters(J,{now:et,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),it=$.crossFadingFactor();it===1&&it===this._crossFadingFactor||(U=!0,this._crossFadingFactor=it),this.style.update($)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||U)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var st=o.browser.now()-R;F.endQueryEXT(F.TIME_ELAPSED_EXT,E),setTimeout(function(){var yt=F.getQueryObjectEXT(E,F.QUERY_RESULT_EXT)/1e6;F.deleteQueryEXT(E),P.fire(new o.Event("gpu-timing-frame",{cpuTime:st,gpuTime:yt}))},50)}if(this.listens("gpu-timing-layer")){var xt=this.painter.collectGpuTimers();setTimeout(function(){var yt=P.painter.queryGpuTimers(xt);P.fire(new o.Event("gpu-timing-layer",{layerTimes:yt}))},50)}var Rt=this._sourcesDirty||this._styleDirty||this._placementDirty;return Rt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.Event("idle")),!this._loaded||this._fullyLoaded||Rt||(this._fullyLoaded=!0),this}},d.prototype.remove=function(){this._hash&&this._hash.remove();for(var m=0,E=this._controls;m<E.length;m+=1)E[m].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1));var P=this.painter.context.gl.getExtension("WEBGL_lose_context");P&&P.loseContext(),Zo(this._canvasContainer),Zo(this._controlContainer),Zo(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new o.Event("remove"))},d.prototype.triggerRepaint=function(){var m=this;this.style&&!this._frame&&(this._frame=o.browser.frame(function(E){m._frame=null,m._render(E)}))},d.prototype._onWindowOnline=function(){this._update()},d.prototype._onWindowResize=function(m){this._trackResize&&this.resize({originalEvent:m})._update()},f.showTileBoundaries.get=function(){return!!this._showTileBoundaries},f.showTileBoundaries.set=function(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())},f.showPadding.get=function(){return!!this._showPadding},f.showPadding.set=function(m){this._showPadding!==m&&(this._showPadding=m,this._update())},f.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},f.showCollisionBoxes.set=function(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())},f.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},f.showOverdrawInspector.set=function(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())},f.repaint.get=function(){return!!this._repaint},f.repaint.set=function(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())},f.vertices.get=function(){return!!this._vertices},f.vertices.set=function(m){this._vertices=m,this._update()},d.prototype._setCacheLimits=function(m,E){o.setCacheLimits(m,E)},f.version.get=function(){return o.version},Object.defineProperties(d.prototype,f),d}(Iu);function Zo(c){c.parentNode&&c.parentNode.removeChild(c)}var Oh={showCompass:!0,showZoom:!0,visualizePitch:!1},pr=function(c){var d=this;this.options=o.extend({},Oh,c),this._container=h.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(f){return f.preventDefault()}),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(f){return d._map.zoomIn({},{originalEvent:f})}),h.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(f){return d._map.zoomOut({},{originalEvent:f})}),h.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(f){d.options.visualizePitch?d._map.resetNorthPitch({},{originalEvent:f}):d._map.resetNorth({},{originalEvent:f})}),this._compassIcon=h.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};pr.prototype._updateZoomButtons=function(){var c=this._map.getZoom(),d=c===this._map.getMaxZoom(),f=c===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},pr.prototype._rotateCompassArrow=function(){var c=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=c},pr.prototype.onAdd=function(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new oo(this._map,this._compass,this.options.visualizePitch)),this._container},pr.prototype.onRemove=function(){h.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},pr.prototype._createButton=function(c,d){var f=h.create("button",c,this._container);return f.type="button",f.addEventListener("click",d),f},pr.prototype._setButtonTitle=function(c,d){var f=this._map._getUIString("NavigationControl."+d);c.title=f,c.setAttribute("aria-label",f)};var oo=function(c,d,f){f===void 0&&(f=!1),this._clickTolerance=10,this.element=d,this.mouseRotate=new Bu({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,f&&(this.mousePitch=new Ph({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener(d,"mousedown",this.mousedown),h.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),h.addEventListener(d,"touchmove",this.touchmove),h.addEventListener(d,"touchend",this.touchend),h.addEventListener(d,"touchcancel",this.reset)};function Ss(c,d,f){if(c=new o.LngLat(c.lng,c.lat),d){var m=new o.LngLat(c.lng-360,c.lat),E=new o.LngLat(c.lng+360,c.lat),P=f.locationPoint(c).distSqr(d);f.locationPoint(m).distSqr(d)<P?c=m:f.locationPoint(E).distSqr(d)<P&&(c=E)}for(;Math.abs(c.lng-f.center.lng)>180;){var R=f.locationPoint(c);if(R.x>=0&&R.y>=0&&R.x<=f.width&&R.y<=f.height)break;c.lng>f.center.lng?c.lng-=360:c.lng+=360}return c}oo.prototype.down=function(c,d){this.mouseRotate.mousedown(c,d),this.mousePitch&&this.mousePitch.mousedown(c,d),h.disableDrag()},oo.prototype.move=function(c,d){var f=this.map,m=this.mouseRotate.mousemoveWindow(c,d);if(m&&m.bearingDelta&&f.setBearing(f.getBearing()+m.bearingDelta),this.mousePitch){var E=this.mousePitch.mousemoveWindow(c,d);E&&E.pitchDelta&&f.setPitch(f.getPitch()+E.pitchDelta)}},oo.prototype.off=function(){var c=this.element;h.removeEventListener(c,"mousedown",this.mousedown),h.removeEventListener(c,"touchstart",this.touchstart,{passive:!1}),h.removeEventListener(c,"touchmove",this.touchmove),h.removeEventListener(c,"touchend",this.touchend),h.removeEventListener(c,"touchcancel",this.reset),this.offTemp()},oo.prototype.offTemp=function(){h.enableDrag(),h.removeEventListener(o.window,"mousemove",this.mousemove),h.removeEventListener(o.window,"mouseup",this.mouseup)},oo.prototype.mousedown=function(c){this.down(o.extend({},c,{ctrlKey:!0,preventDefault:function(){return c.preventDefault()}}),h.mousePos(this.element,c)),h.addEventListener(o.window,"mousemove",this.mousemove),h.addEventListener(o.window,"mouseup",this.mouseup)},oo.prototype.mousemove=function(c){this.move(c,h.mousePos(this.element,c))},oo.prototype.mouseup=function(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()},oo.prototype.touchstart=function(c){c.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=h.touchPos(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return c.preventDefault()}},this._startPos))},oo.prototype.touchmove=function(c){c.targetTouches.length!==1?this.reset():(this._lastPos=h.touchPos(this.element,c.targetTouches)[0],this.move({preventDefault:function(){return c.preventDefault()}},this._lastPos))},oo.prototype.touchend=function(c){c.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},oo.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Is={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ke(c,d,f){var m=c.classList;for(var E in Is)m.remove("mapboxgl-"+f+"-anchor-"+E);m.add("mapboxgl-"+f+"-anchor-"+d)}var ii,Wl=function(c){function d(f,m){if(c.call(this),(f instanceof o.window.HTMLElement||m)&&(f=o.extend({element:f},m)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=f&&f.anchor||"center",this._color=f&&f.color||"#3FB1CE",this._scale=f&&f.scale||1,this._draggable=f&&f.draggable||!1,this._clickTolerance=f&&f.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=f&&f.rotation||0,this._rotationAlignment=f&&f.rotationAlignment||"auto",this._pitchAlignment=f&&f.pitchAlignment&&f.pitchAlignment!=="auto"?f.pitchAlignment:this._rotationAlignment,f&&f.element)this._element=f.element,this._offset=o.Point.convert(f&&f.offset||[0,0]);else{this._defaultMarker=!0,this._element=h.create("div"),this._element.setAttribute("aria-label","Map marker");var E=h.createNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","41px"),E.setAttributeNS(null,"width","27px"),E.setAttributeNS(null,"viewBox","0 0 27 41");var P=h.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"stroke","none"),P.setAttributeNS(null,"stroke-width","1"),P.setAttributeNS(null,"fill","none"),P.setAttributeNS(null,"fill-rule","evenodd");var R=h.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill-rule","nonzero");var F=h.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(3.0, 29.0)"),F.setAttributeNS(null,"fill","#000000");for(var U=0,J=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];U<J.length;U+=1){var et=J[U],$=h.createNS("http://www.w3.org/2000/svg","ellipse");$.setAttributeNS(null,"opacity","0.04"),$.setAttributeNS(null,"cx","10.5"),$.setAttributeNS(null,"cy","5.80029008"),$.setAttributeNS(null,"rx",et.rx),$.setAttributeNS(null,"ry",et.ry),F.appendChild($)}var it=h.createNS("http://www.w3.org/2000/svg","g");it.setAttributeNS(null,"fill",this._color);var st=h.createNS("http://www.w3.org/2000/svg","path");st.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),it.appendChild(st);var xt=h.createNS("http://www.w3.org/2000/svg","g");xt.setAttributeNS(null,"opacity","0.25"),xt.setAttributeNS(null,"fill","#000000");var Rt=h.createNS("http://www.w3.org/2000/svg","path");Rt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),xt.appendChild(Rt);var yt=h.createNS("http://www.w3.org/2000/svg","g");yt.setAttributeNS(null,"transform","translate(6.0, 7.0)"),yt.setAttributeNS(null,"fill","#FFFFFF");var It=h.createNS("http://www.w3.org/2000/svg","g");It.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Ht=h.createNS("http://www.w3.org/2000/svg","circle");Ht.setAttributeNS(null,"fill","#000000"),Ht.setAttributeNS(null,"opacity","0.25"),Ht.setAttributeNS(null,"cx","5.5"),Ht.setAttributeNS(null,"cy","5.5"),Ht.setAttributeNS(null,"r","5.4999962");var Xt=h.createNS("http://www.w3.org/2000/svg","circle");Xt.setAttributeNS(null,"fill","#FFFFFF"),Xt.setAttributeNS(null,"cx","5.5"),Xt.setAttributeNS(null,"cy","5.5"),Xt.setAttributeNS(null,"r","5.4999962"),It.appendChild(Ht),It.appendChild(Xt),R.appendChild(F),R.appendChild(it),R.appendChild(xt),R.appendChild(yt),R.appendChild(It),E.appendChild(R),E.setAttributeNS(null,"height",41*this._scale+"px"),E.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(E),this._offset=o.Point.convert(f&&f.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(ee){ee.preventDefault()}),this._element.addEventListener("mousedown",function(ee){ee.preventDefault()}),Ke(this._element,this._anchor,"marker"),this._popup=null}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.addTo=function(f){return this.remove(),this._map=f,f.getCanvasContainer().appendChild(this._element),f.on("move",this._update),f.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},d.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),h.remove(this._element),this._popup&&this._popup.remove(),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(f){return this._lngLat=o.LngLat.convert(f),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},d.prototype.getElement=function(){return this._element},d.prototype.setPopup=function(f){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),f){if(!("offset"in f.options)){var m=Math.sqrt(Math.pow(13.5,2)/2);f.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(24.6+m)],"bottom-right":[-m,-1*(24.6+m)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=f,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},d.prototype._onKeyPress=function(f){var m=f.code,E=f.charCode||f.keyCode;m!=="Space"&&m!=="Enter"&&E!==32&&E!==13||this.togglePopup()},d.prototype._onMapClick=function(f){var m=f.originalEvent.target,E=this._element;this._popup&&(m===E||E.contains(m))&&this.togglePopup()},d.prototype.getPopup=function(){return this._popup},d.prototype.togglePopup=function(){var f=this._popup;return f?(f.isOpen()?f.remove():f.addTo(this._map),this):this},d.prototype._update=function(f){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Ss(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(m="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E="rotateX("+this._map.getPitch()+"deg)"),f&&f.type!=="moveend"||(this._pos=this._pos.round()),h.setTransform(this._element,Is[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+E+" "+m)}},d.prototype.getOffset=function(){return this._offset},d.prototype.setOffset=function(f){return this._offset=o.Point.convert(f),this._update(),this},d.prototype._onMove=function(f){if(!this._isDragging){var m=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))},d.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"},d.prototype._addDragHandler=function(f){this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},d.prototype.setDraggable=function(f){return this._draggable=!!f,this._map&&(f?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},d.prototype.isDraggable=function(){return this._draggable},d.prototype.setRotation=function(f){return this._rotation=f||0,this._update(),this},d.prototype.getRotation=function(){return this._rotation},d.prototype.setRotationAlignment=function(f){return this._rotationAlignment=f||"auto",this._update(),this},d.prototype.getRotationAlignment=function(){return this._rotationAlignment},d.prototype.setPitchAlignment=function(f){return this._pitchAlignment=f&&f!=="auto"?f:this._rotationAlignment,this._update(),this},d.prototype.getPitchAlignment=function(){return this._pitchAlignment},d}(o.Evented),kc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},sa=0,Ns=!1,aa=function(c){function d(f){c.call(this),this.options=o.extend({},kc,f),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.onAdd=function(f){var m;return this._map=f,this._container=h.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),m=this._setupUI,ii!==void 0?m(ii):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(function(E){m(ii=E.state!=="denied")}):m(ii=!!o.window.navigator.geolocation),this._container},d.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),h.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,sa=0,Ns=!1},d.prototype._isOutOfMapMaxBounds=function(f){var m=this._map.getMaxBounds(),E=f.coords;return m&&(E.longitude<m.getWest()||E.longitude>m.getEast()||E.latitude<m.getSouth()||E.latitude>m.getNorth())},d.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},d.prototype._onSuccess=function(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",f)),this._finish()}},d.prototype._updateCamera=function(f){var m=new o.LngLat(f.coords.longitude,f.coords.latitude),E=f.coords.accuracy,P=this._map.getBearing(),R=o.extend({bearing:P},this.options.fitBoundsOptions);this._map.fitBounds(m.toBounds(E),R,{geolocateSource:!0})},d.prototype._updateMarker=function(f){if(f){var m=new o.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(m).addTo(this._map),this._userLocationDotMarker.setLngLat(m).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},d.prototype._updateCircleRadius=function(){var f=this._map._container.clientHeight/2,m=this._map.unproject([0,f]),E=this._map.unproject([1,f]),P=m.distanceTo(E),R=Math.ceil(2*this._accuracy/P);this._circleElement.style.width=R+"px",this._circleElement.style.height=R+"px"},d.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},d.prototype._onError=function(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var m=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=m,this._geolocateButton.setAttribute("aria-label",m),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&Ns)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",f)),this._finish()}},d.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},d.prototype._setupUI=function(f){var m=this;if(this._container.addEventListener("contextmenu",function(R){return R.preventDefault()}),this._geolocateButton=h.create("button","mapboxgl-ctrl-geolocate",this._container),h.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",f===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var E=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}else{var P=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=P,this._geolocateButton.setAttribute("aria-label",P)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=h.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Wl(this._dotElement),this._circleElement=h.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Wl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(R){R.geolocateSource||m._watchState!=="ACTIVE_LOCK"||R.originalEvent&&R.originalEvent.type==="resize"||(m._watchState="BACKGROUND",m._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),m._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),m.fire(new o.Event("trackuserlocationend")))})},d.prototype.trigger=function(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":sa--,Ns=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++sa>1?(f={maximumAge:6e5,timeout:0},Ns=!0):(f=this.options.positionOptions,Ns=!1),this._geolocationWatchID=o.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else o.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},d.prototype._clearWatch=function(){o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},d}(o.Evented),la={maxWidth:100,unit:"metric"},xo=function(c){this.options=o.extend({},la,c),o.bindAll(["_onMove","setUnit"],this)};function _(c,d,f){var m=f&&f.maxWidth||100,E=c._container.clientHeight/2,P=c.unproject([0,E]),R=c.unproject([m,E]),F=P.distanceTo(R);if(f&&f.unit==="imperial"){var U=3.2808*F;U>5280?y(d,m,U/5280,c._getUIString("ScaleControl.Miles")):y(d,m,U,c._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?y(d,m,F/1852,c._getUIString("ScaleControl.NauticalMiles")):F>=1e3?y(d,m,F/1e3,c._getUIString("ScaleControl.Kilometers")):y(d,m,F,c._getUIString("ScaleControl.Meters"))}function y(c,d,f,m){var E,P,R,F=(E=f,(P=Math.pow(10,(""+Math.floor(E)).length-1))*(R=(R=E/P)>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(U){var J=Math.pow(10,Math.ceil(-Math.log(U)/Math.LN10));return Math.round(U*J)/J}(R)));c.style.width=d*(F/f)+"px",c.innerHTML=F+"&nbsp;"+m}xo.prototype.getDefaultPosition=function(){return"bottom-left"},xo.prototype._onMove=function(){_(this._map,this._container,this.options)},xo.prototype.onAdd=function(c){return this._map=c,this._container=h.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},xo.prototype.onRemove=function(){h.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},xo.prototype.setUnit=function(c){this.options.unit=c,_(this._map,this._container,this.options)};var b=function(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof o.window.HTMLElement?this._container=c.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in o.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in o.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in o.window.document&&(this._fullscreenchange="MSFullscreenChange")};b.prototype.onAdd=function(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=h.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},b.prototype.onRemove=function(){h.remove(this._controlContainer),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},b.prototype._checkFullscreenSupport=function(){return!!(o.window.document.fullscreenEnabled||o.window.document.mozFullScreenEnabled||o.window.document.msFullscreenEnabled||o.window.document.webkitFullscreenEnabled)},b.prototype._setupUI=function(){var c=this._fullscreenButton=h.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);h.create("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden",!0),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},b.prototype._updateTitle=function(){var c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.title=c},b.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},b.prototype._isFullscreen=function(){return this._fullscreen},b.prototype._changeIcon=function(){(o.window.document.fullscreenElement||o.window.document.mozFullScreenElement||o.window.document.webkitFullscreenElement||o.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},b.prototype._onClickFullscreen=function(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.mozCancelFullScreen?o.window.document.mozCancelFullScreen():o.window.document.msExitFullscreen?o.window.document.msExitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var w={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},T=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),M=function(c){function d(f){c.call(this),this.options=o.extend(Object.create(w),f),o.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return c&&(d.__proto__=c),(d.prototype=Object.create(c&&c.prototype)).constructor=d,d.prototype.addTo=function(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this},d.prototype.isOpen=function(){return!!this._map},d.prototype.remove=function(){return this._content&&h.remove(this._content),this._container&&(h.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(f){return this._lngLat=o.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},d.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},d.prototype.getElement=function(){return this._container},d.prototype.setText=function(f){return this.setDOMContent(o.window.document.createTextNode(f))},d.prototype.setHTML=function(f){var m,E=o.window.document.createDocumentFragment(),P=o.window.document.createElement("body");for(P.innerHTML=f;m=P.firstChild;)E.appendChild(m);return this.setDOMContent(E)},d.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},d.prototype.setMaxWidth=function(f){return this.options.maxWidth=f,this._update(),this},d.prototype.setDOMContent=function(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=h.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this},d.prototype.addClassName=function(f){this._container&&this._container.classList.add(f)},d.prototype.removeClassName=function(f){this._container&&this._container.classList.remove(f)},d.prototype.setOffset=function(f){return this.options.offset=f,this._update(),this},d.prototype.toggleClassName=function(f){if(this._container)return this._container.classList.toggle(f)},d.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=h.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},d.prototype._onMouseUp=function(f){this._update(f.point)},d.prototype._onMouseMove=function(f){this._update(f.point)},d.prototype._onDrag=function(f){this._update(f.point)},d.prototype._update=function(f){var m=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=h.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=h.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function($){return m._container.classList.add($)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ss(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||f)){var E=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat),P=this.options.anchor,R=function $(it){if(it){if(typeof it=="number"){var st=Math.round(Math.sqrt(.5*Math.pow(it,2)));return{center:new o.Point(0,0),top:new o.Point(0,it),"top-left":new o.Point(st,st),"top-right":new o.Point(-st,st),bottom:new o.Point(0,-it),"bottom-left":new o.Point(st,-st),"bottom-right":new o.Point(-st,-st),left:new o.Point(it,0),right:new o.Point(-it,0)}}if(it instanceof o.Point||Array.isArray(it)){var xt=o.Point.convert(it);return{center:xt,top:xt,"top-left":xt,"top-right":xt,bottom:xt,"bottom-left":xt,"bottom-right":xt,left:xt,right:xt}}return{center:o.Point.convert(it.center||[0,0]),top:o.Point.convert(it.top||[0,0]),"top-left":o.Point.convert(it["top-left"]||[0,0]),"top-right":o.Point.convert(it["top-right"]||[0,0]),bottom:o.Point.convert(it.bottom||[0,0]),"bottom-left":o.Point.convert(it["bottom-left"]||[0,0]),"bottom-right":o.Point.convert(it["bottom-right"]||[0,0]),left:o.Point.convert(it.left||[0,0]),right:o.Point.convert(it.right||[0,0])}}return $(new o.Point(0,0))}(this.options.offset);if(!P){var F,U=this._container.offsetWidth,J=this._container.offsetHeight;F=E.y+R.bottom.y<J?["top"]:E.y>this._map.transform.height-J?["bottom"]:[],E.x<U/2?F.push("left"):E.x>this._map.transform.width-U/2&&F.push("right"),P=F.length===0?"bottom":F.join("-")}var et=E.add(R[P]).round();h.setTransform(this._container,Is[P]+" translate("+et.x+"px,"+et.y+"px)"),Ke(this._container,P,"popup")}},d.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var f=this._container.querySelector(T);f&&f.focus()}},d.prototype._onClose=function(){this.remove()},d}(o.Evented),O={version:o.version,supported:l,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:Mu,NavigationControl:pr,GeolocateControl:aa,AttributionControl:fo,ScaleControl:xo,FullscreenControl:b,Popup:M,Marker:Wl,Style:jn,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.Point,MercatorCoordinate:o.MercatorCoordinate,Evented:o.Evented,config:o.config,prewarm:function(){fe().acquire(Zt)},clearPrewarmedResources:function(){var c=Re;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(Zt),Re=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(c){o.config.ACCESS_TOKEN=c},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(c){o.config.API_URL=c},get workerCount(){return Be.workerCount},set workerCount(c){Be.workerCount=c},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){o.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage:function(c){o.clearTileCache(c)},workerUrl:""};return O}),r})}(A2)),A2.exports}var Ztt=Qtt();const uc=Jh(Ztt);var Ytt=1e-7;function g2(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function Z4(e,t){if(e===t)return!0;if(g2(e)&&g2(t)){if(e.length!==t.length)return!1;for(var i=0;i<e.length;++i)if(!Z4(e[i],t[i]))return!1;return!0}return Math.abs(e-t)<=Ytt}function cy(e,t,i){return Math.max(t,Math.min(i,e))}function uy(e,t,i){return g2(e)?e.map(function(n,r){return uy(n,t[r],i)}):i*t+(1-i)*e}function vl(e,t){if(!e)throw new Error(t||"react-map-gl: assertion failed.")}function Y4(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function q4(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Y4(Object(i),!0).forEach(function(n){wi(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Y4(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var lf={minZoom:0,maxZoom:24,minPitch:0,maxPitch:60},m2={pitch:0,bearing:0,altitude:1.5},$4=5,qtt=1.2,rp=function(){function e(t){var i=t.width,n=t.height,r=t.latitude,s=t.longitude,o=t.zoom,l=t.bearing,h=l===void 0?m2.bearing:l,A=t.pitch,v=A===void 0?m2.pitch:A,C=t.altitude,S=C===void 0?m2.altitude:C,L=t.maxZoom,N=L===void 0?lf.maxZoom:L,G=t.minZoom,W=G===void 0?lf.minZoom:G,j=t.maxPitch,q=j===void 0?lf.maxPitch:j,Z=t.minPitch,K=Z===void 0?lf.minPitch:Z,ft=t.transitionDuration,rt=t.transitionEasing,Lt=t.transitionInterpolator,Vt=t.transitionInterruption,At=t.startPanLngLat,at=t.startZoomLngLat,kt=t.startRotatePos,X=t.startBearing,ht=t.startPitch,Mt=t.startZoom;Gu(this,e),vl(Number.isFinite(i),"`width` must be supplied"),vl(Number.isFinite(n),"`height` must be supplied"),vl(Number.isFinite(s),"`longitude` must be supplied"),vl(Number.isFinite(r),"`latitude` must be supplied"),vl(Number.isFinite(o),"`zoom` must be supplied"),this._viewportProps=this._applyConstraints({width:i,height:n,latitude:r,longitude:s,zoom:o,bearing:h,pitch:v,altitude:S,maxZoom:N,minZoom:W,maxPitch:q,minPitch:K,transitionDuration:ft,transitionEasing:rt,transitionInterpolator:Lt,transitionInterruption:Vt}),this._state={startPanLngLat:At,startZoomLngLat:at,startRotatePos:kt,startBearing:X,startPitch:ht,startZoom:Mt}}return Uu(e,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getState",value:function(){return this._state}},{key:"panStart",value:function(t){var i=t.pos;return this._getUpdatedMapState({startPanLngLat:this._unproject(i)})}},{key:"pan",value:function(t){var i=t.pos,n=t.startPos,r=this._state.startPanLngLat||this._unproject(n);if(!r)return this;var s=this._calculateNewLngLat({startPanLngLat:r,pos:i}),o=po(s,2),l=o[0],h=o[1];return this._getUpdatedMapState({longitude:l,latitude:h})}},{key:"panEnd",value:function(){return this._getUpdatedMapState({startPanLngLat:null})}},{key:"rotateStart",value:function(t){var i=t.pos;return this._getUpdatedMapState({startRotatePos:i,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(t){var i=t.pos,n=t.deltaAngleX,r=n===void 0?0:n,s=t.deltaAngleY,o=s===void 0?0:s,l=this._state,h=l.startRotatePos,A=l.startBearing,v=l.startPitch;if(!Number.isFinite(A)||!Number.isFinite(v))return this;var C;return i?C=this._calculateNewPitchAndBearing(q4(q4({},this._getRotationParams(i,h)),{},{startBearing:A,startPitch:v})):C={bearing:A+r,pitch:v+o},this._getUpdatedMapState(C)}},{key:"rotateEnd",value:function(){return this._getUpdatedMapState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(t){var i=t.pos;return this._getUpdatedMapState({startZoomLngLat:this._unproject(i),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var i=t.pos,n=t.startPos,r=t.scale;vl(r>0,"`scale` must be a positive number");var s=this._state,o=s.startZoom,l=s.startZoomLngLat;Number.isFinite(o)||(o=this._viewportProps.zoom,l=this._unproject(n)||this._unproject(i)),vl(l,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var h=this._calculateNewZoom({scale:r,startZoom:o||0}),A=new vc(Object.assign({},this._viewportProps,{zoom:h})),v=A.getMapCenterByLngLatPosition({lngLat:l,pos:i}),C=po(v,2),S=C[0],L=C[1];return this._getUpdatedMapState({zoom:h,longitude:S,latitude:L})}},{key:"zoomEnd",value:function(){return this._getUpdatedMapState({startZoomLngLat:null,startZoom:null})}},{key:"_getUpdatedMapState",value:function(t){return new e(Object.assign({},this._viewportProps,this._state,t))}},{key:"_applyConstraints",value:function(t){var i=t.maxZoom,n=t.minZoom,r=t.zoom;t.zoom=cy(r,n,i);var s=t.maxPitch,o=t.minPitch,l=t.pitch;return t.pitch=cy(l,o,s),Object.assign(t,btt(t)),t}},{key:"_unproject",value:function(t){var i=new vc(this._viewportProps);return t&&i.unproject(t)}},{key:"_calculateNewLngLat",value:function(t){var i=t.startPanLngLat,n=t.pos,r=new vc(this._viewportProps);return r.getMapCenterByLngLatPosition({lngLat:i,pos:n})}},{key:"_calculateNewZoom",value:function(t){var i=t.scale,n=t.startZoom,r=this._viewportProps,s=r.maxZoom,o=r.minZoom,l=n+Math.log2(i);return cy(l,o,s)}},{key:"_calculateNewPitchAndBearing",value:function(t){var i=t.deltaScaleX,n=t.deltaScaleY,r=t.startBearing,s=t.startPitch;n=cy(n,-1,1);var o=this._viewportProps,l=o.minPitch,h=o.maxPitch,A=r+180*i,v=s;return n>0?v=s+n*(h-s):n<0&&(v=s-n*(l-s)),{pitch:v,bearing:A}}},{key:"_getRotationParams",value:function(t,i){var n=t[0]-i[0],r=t[1]-i[1],s=t[1],o=i[1],l=this._viewportProps,h=l.width,A=l.height,v=n/h,C=0;return r>0?Math.abs(A-o)>$4&&(C=r/(o-A)*qtt):r<0&&o>$4&&(C=1-s/o),C=Math.min(1,Math.max(-1,C)),{deltaScaleX:v,deltaScaleY:C}}}]),e}();function $tt(e){return e[0].toLowerCase()+e.slice(1)}function tet(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:lf;for(var i in t){var n=i.slice(0,3),r=$tt(i.slice(3));if(n==="min"&&e[r]<t[i]||n==="max"&&e[r]>t[i])return!1}return!0}function tR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function eR(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?tR(Object(i),!0).forEach(function(n){wi(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):tR(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var cf=Ie.createContext({viewport:null,map:null,container:null,onViewportChange:null,onViewStateChange:null,eventManager:null}),y2=cf.Provider;function eet(e){var t=e.value,i=e.children,n=Ie.useState(null),r=po(n,2),s=r[0],o=r[1],l=Ie.useContext(cf);return t=eR(eR({setMap:o},l),{},{map:l&&l.map||s},t),Ie.createElement(y2,{value:t},i)}cf.Provider=eet;var _2=typeof window<"u"?Ie.useLayoutEffect:Ie.useEffect;function iR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function bl(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?iR(Object(i),!0).forEach(function(n){wi(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):iR(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var iet="https://visgl.github.io/react-map-gl/docs/get-started/mapbox-tokens",nR="A valid API access token is required to use Mapbox data";function net(){}function rR(e){var t=e.props,i=e.width,n=e.height;return new vc(bl(bl(bl({},t),t.viewState),{},{width:i,height:n}))}var ret=401,oR={position:"absolute",width:"100%",height:"100%",overflow:"hidden"},oet=Object.assign({},af.propTypes,{width:ge.oneOfType([ge.number,ge.string]),height:ge.oneOfType([ge.number,ge.string]),onResize:ge.func,disableTokenWarning:ge.bool,visible:ge.bool,className:ge.string,style:ge.object,visibilityConstraints:ge.object}),set=Object.assign({},af.defaultProps,{disableTokenWarning:!1,visible:!0,onResize:net,className:"",style:null,visibilityConstraints:lf});function aet(){var e={position:"absolute",left:0,top:0};return Ie.createElement("div",{key:"warning",id:"no-token-warning",style:e},Ie.createElement("h3",{key:"header"},nR),Ie.createElement("div",{key:"text"},"For information on setting up your basemap, read"),Ie.createElement("a",{key:"link",href:iet},"Note on Map Tokens"))}function cet(e){return{getMap:function(){return e.current&&e.current.getMap()},queryRenderedFeatures:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.current&&e.current.getMap();return n&&n.queryRenderedFeatures(t,i)}}}var $c=Ie.forwardRef(function(e,t){var i=Ie.useState(!0),n=po(i,2),r=n[0],s=n[1],o=Ie.useState({width:0,height:0}),l=po(o,2),h=l[0],A=l[1],v=Ie.useRef(null),C=Ie.useRef(null),S=Ie.useRef(null),L=Ie.useRef(null),N=Ie.useContext(cf);_2(function(){if($c.supported()){var at=new af(bl(bl(bl({},e),h),{},{mapboxgl:uc,container:C.current,onError:function(X){var ht=X.error&&X.error.status||X.status;ht===ret&&r&&(console.error(nR),s(!1)),e.onError(X)}}));v.current=at,N&&N.setMap&&N.setMap(at.getMap());var kt=new Vtt(function(X){if(X[0].contentRect){var ht=X[0].contentRect,Mt=ht.width,pe=ht.height;A({width:Mt,height:pe}),e.onResize({width:Mt,height:pe})}});return kt.observe(S.current),function(){at.finalize(),v.current=null,kt.disconnect()}}},[]),_2(function(){v.current&&v.current.setProps(bl(bl({},e),h))});var G=v.current&&v.current.getMap();Ie.useImperativeHandle(t,function(){return cet(v)},[]);var W=Ie.useCallback(function(at){var kt=at.target;kt===L.current&&kt.scrollTo(0,0)},[]),j=G&&Ie.createElement(y2,{value:bl(bl({},N),{},{viewport:N.viewport||rR(bl({map:G,props:e},h)),map:G,container:N.container||S.current})},Ie.createElement("div",{key:"map-overlays",className:"overlays",ref:L,style:oR,onScroll:W},e.children)),q=e.className,Z=e.width,K=e.height,ft=e.style,rt=e.visibilityConstraints,Lt=Object.assign({position:"relative"},ft,{width:Z,height:K}),Vt=e.visible&&tet(e.viewState||e,rt),At=Object.assign({},oR,{visibility:Vt?"inherit":"hidden"});return Ie.createElement("div",{key:"map-container",ref:S,style:Lt},Ie.createElement("div",{key:"map-mapbox",ref:C,style:At,className:q}),j,!r&&!e.disableTokenWarning&&Ie.createElement(aet,null))});$c.supported=function(){return uc&&uc.supported()},$c.propTypes=oet,$c.defaultProps=set;function uet(e,t){var i;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=het(e))||t){i&&(e=i);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,l;return{s:function(){i=e[Symbol.iterator]()},n:function(){var h=i.next();return s=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!s&&i.return!=null&&i.return()}finally{if(o)throw l}}}}function het(e,t){if(e){if(typeof e=="string")return sR(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return sR(e,t)}}function sR(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var aR=function(){function e(){Gu(this,e),wi(this,"propNames",[])}return Uu(e,[{key:"arePropsEqual",value:function(t,i){var n=uet(this.propNames||[]),r;try{for(n.s();!(r=n.n()).done;){var s=r.value;if(!Z4(t[s],i[s]))return!1}}catch(o){n.e(o)}finally{n.f()}return!0}},{key:"initializeProps",value:function(t,i){return{start:t,end:i}}},{key:"interpolateProps",value:function(t,i,n){vl(!1,"interpolateProps is not implemented")}},{key:"getDuration",value:function(t,i){return i.transitionDuration}}]),e}(),fet={longitude:1,bearing:1};function hy(e){return Number.isFinite(e)||Array.isArray(e)}function det(e){return e in fet}function v2(e,t,i){return det(e)&&Math.abs(i-t)>180&&(i=i<0?i+360:i-360),i}function b2(e,t){var i;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=pet(e))||t){i&&(e=i);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,l;return{s:function(){i=e[Symbol.iterator]()},n:function(){var h=i.next();return s=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!s&&i.return!=null&&i.return()}finally{if(o)throw l}}}}function pet(e,t){if(e){if(typeof e=="string")return lR(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return lR(e,t)}}function lR(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function Aet(e){var t=get();return function(){var i=_d(e),n;if(t){var r=_d(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return qv(this,n)}}function get(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var met=["longitude","latitude","zoom","bearing","pitch"],yet=["latitude","longitude","zoom","width","height"],cR=["bearing","pitch"],_et={speed:1.2,curve:1.414};(function(e){Yv(i,e);var t=Aet(i);function i(){var n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Gu(this,i),n=t.call(this),wi(Nu(n),"propNames",met),n.props=Object.assign({},_et,r),n}return Uu(i,[{key:"initializeProps",value:function(n,r){var s={},o={},l=b2(yet),h;try{for(l.s();!(h=l.n()).done;){var A=h.value,v=n[A],C=r[A];vl(hy(v)&&hy(C),"".concat(A," must be supplied for transition")),s[A]=v,o[A]=v2(A,v,C)}}catch(j){l.e(j)}finally{l.f()}var S=b2(cR),L;try{for(S.s();!(L=S.n()).done;){var N=L.value,G=n[N]||0,W=r[N]||0;s[N]=G,o[N]=v2(N,G,W)}}catch(j){S.e(j)}finally{S.f()}return{start:s,end:o}}},{key:"interpolateProps",value:function(n,r,s){var o=wtt(n,r,s,this.props),l=b2(cR),h;try{for(l.s();!(h=l.n()).done;){var A=h.value;o[A]=uy(n[A],r[A],s)}}catch(v){l.e(v)}finally{l.f()}return o}},{key:"getDuration",value:function(n,r){var s=r.transitionDuration;return s==="auto"&&(s=Ctt(n,r,this.props)),s}}]),i})(aR);function uR(e,t){var i;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=vet(e))||t){i&&(e=i);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,l;return{s:function(){i=e[Symbol.iterator]()},n:function(){var h=i.next();return s=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!s&&i.return!=null&&i.return()}finally{if(o)throw l}}}}function vet(e,t){if(e){if(typeof e=="string")return hR(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return hR(e,t)}}function hR(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function bet(e){var t=xet();return function(){var i=_d(e),n;if(t){var r=_d(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return qv(this,n)}}function xet(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var wet=["longitude","latitude","zoom","bearing","pitch"],dg=function(e){Yv(i,e);var t=bet(i);function i(){var n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Gu(this,i),n=t.call(this),Array.isArray(r)&&(r={transitionProps:r}),n.propNames=r.transitionProps||wet,r.around&&(n.around=r.around),n}return Uu(i,[{key:"initializeProps",value:function(n,r){var s={},o={};if(this.around){s.around=this.around;var l=new vc(n).unproject(this.around);Object.assign(o,r,{around:new vc(r).project(l),aroundLngLat:l})}var h=uR(this.propNames),A;try{for(h.s();!(A=h.n()).done;){var v=A.value,C=n[v],S=r[v];vl(hy(C)&&hy(S),"".concat(v," must be supplied for transition")),s[v]=C,o[v]=v2(v,C,S)}}catch(L){h.e(L)}finally{h.f()}return{start:s,end:o}}},{key:"interpolateProps",value:function(n,r,s){var o={},l=uR(this.propNames),h;try{for(l.s();!(h=l.n()).done;){var A=h.value;o[A]=uy(n[A],r[A],s)}}catch(N){l.e(N)}finally{l.f()}if(r.around){var v=new vc(Object.assign({},r,o)).getMapCenterByLngLatPosition({lngLat:r.aroundLngLat,pos:uy(n.around,r.around,s)}),C=po(v,2),S=C[0],L=C[1];o.longitude=S,o.latitude=L}return o}}]),i}(aR),pg=function(){};function Cet(e,t){var i=e(t);return function(n){return 1/(1-i)*(e(n*(1-t)+t)-i)}}var Ag={BREAK:1,SNAP_TO_END:2,IGNORE:3,UPDATE:4},Eet={transitionDuration:0,transitionEasing:function(e){return e},transitionInterpolator:new dg,transitionInterruption:Ag.BREAK,onTransitionStart:pg,onTransitionInterrupt:pg,onTransitionEnd:pg},x2=function(){function e(){var t=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Gu(this,e),wi(this,"_animationFrame",null),wi(this,"_onTransitionFrame",function(){t._animationFrame=requestAnimationFrame(t._onTransitionFrame),t._updateViewport()}),this.props=null,this.onViewportChange=i.onViewportChange||pg,this.onStateChange=i.onStateChange||pg,this.time=i.getTime||Date.now}return Uu(e,[{key:"getViewportInTransition",value:function(){return this._animationFrame?this.state.propsInTransition:null}},{key:"processViewportChange",value:function(t){var i=this.props;if(this.props=t,!i||this._shouldIgnoreViewportChange(i,t))return!1;if(this._isTransitionEnabled(t)){var n=Object.assign({},i),r=Object.assign({},t);if(this._isTransitionInProgress()&&(i.onTransitionInterrupt(),this.state.interruption===Ag.SNAP_TO_END?Object.assign(n,this.state.endProps):Object.assign(n,this.state.propsInTransition),this.state.interruption===Ag.UPDATE)){var s=this.time(),o=(s-this.state.startTime)/this.state.duration;r.transitionDuration=this.state.duration-(s-this.state.startTime),r.transitionEasing=Cet(this.state.easing,o),r.transitionInterpolator=n.transitionInterpolator}return r.onTransitionStart(),this._triggerTransition(n,r),!0}return this._isTransitionInProgress()&&(i.onTransitionInterrupt(),this._endTransition()),!1}},{key:"_isTransitionInProgress",value:function(){return!!this._animationFrame}},{key:"_isTransitionEnabled",value:function(t){var i=t.transitionDuration,n=t.transitionInterpolator;return(i>0||i==="auto")&&!!n}},{key:"_isUpdateDueToCurrentTransition",value:function(t){return this.state.propsInTransition?this.state.interpolator.arePropsEqual(t,this.state.propsInTransition):!1}},{key:"_shouldIgnoreViewportChange",value:function(t,i){return t?this._isTransitionInProgress()?this.state.interruption===Ag.IGNORE||this._isUpdateDueToCurrentTransition(i):this._isTransitionEnabled(i)?i.transitionInterpolator.arePropsEqual(t,i):!0:!0}},{key:"_triggerTransition",value:function(t,i){vl(this._isTransitionEnabled(i)),this._animationFrame&&cancelAnimationFrame(this._animationFrame);var n=i.transitionInterpolator,r=n.getDuration?n.getDuration(t,i):i.transitionDuration;if(r!==0){var s=i.transitionInterpolator.initializeProps(t,i),o={inTransition:!0,isZooming:t.zoom!==i.zoom,isPanning:t.longitude!==i.longitude||t.latitude!==i.latitude,isRotating:t.bearing!==i.bearing||t.pitch!==i.pitch};this.state={duration:r,easing:i.transitionEasing,interpolator:i.transitionInterpolator,interruption:i.transitionInterruption,startTime:this.time(),startProps:s.start,endProps:s.end,animation:null,propsInTransition:{}},this._onTransitionFrame(),this.onStateChange(o)}}},{key:"_endTransition",value:function(){this._animationFrame&&(cancelAnimationFrame(this._animationFrame),this._animationFrame=null),this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1})}},{key:"_updateViewport",value:function(){var t=this.time(),i=this.state,n=i.startTime,r=i.duration,s=i.easing,o=i.interpolator,l=i.startProps,h=i.endProps,A=!1,v=(t-n)/r;v>=1&&(v=1,A=!0),v=s(v);var C=o.interpolateProps(l,h,v),S=new rp(Object.assign({},this.props,C));this.state.propsInTransition=S.getViewportProps(),this.onViewportChange(this.state.propsInTransition,this.props),A&&(this._endTransition(),this.props.onTransitionEnd())}}]),e}();wi(x2,"defaultProps",Eet);var fR={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */var dR;function Bet(){return dR||(dR=1,function(e){(function(t,i,n,r){var s=["","webkit","Moz","MS","ms","o"],o=i.createElement("div"),l="function",h=Math.round,A=Math.abs,v=Date.now;function C(gt,Pt,Jt){return setTimeout(Z(gt,Jt),Pt)}function S(gt,Pt,Jt){return Array.isArray(gt)?(L(gt,Jt[Pt],Jt),!0):!1}function L(gt,Pt,Jt){var xe;if(gt)if(gt.forEach)gt.forEach(Pt,Jt);else if(gt.length!==r)for(xe=0;xe<gt.length;)Pt.call(Jt,gt[xe],xe,gt),xe++;else for(xe in gt)gt.hasOwnProperty(xe)&&Pt.call(Jt,gt[xe],xe,gt)}function N(gt,Pt,Jt){var xe="DEPRECATED METHOD: "+Pt+`
`+Jt+` AT 
`;return function(){var We=new Error("get-stack-trace"),zi=We&&We.stack?We.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Si=t.console&&(t.console.warn||t.console.log);return Si&&Si.call(t.console,xe,zi),gt.apply(this,arguments)}}var G;typeof Object.assign!="function"?G=function(gt){if(gt===r||gt===null)throw new TypeError("Cannot convert undefined or null to object");for(var Pt=Object(gt),Jt=1;Jt<arguments.length;Jt++){var xe=arguments[Jt];if(xe!==r&&xe!==null)for(var We in xe)xe.hasOwnProperty(We)&&(Pt[We]=xe[We])}return Pt}:G=Object.assign;var W=N(function(gt,Pt,Jt){for(var xe=Object.keys(Pt),We=0;We<xe.length;)(!Jt||Jt&&gt[xe[We]]===r)&&(gt[xe[We]]=Pt[xe[We]]),We++;return gt},"extend","Use `assign`."),j=N(function(gt,Pt){return W(gt,Pt,!0)},"merge","Use `assign`.");function q(gt,Pt,Jt){var xe=Pt.prototype,We;We=gt.prototype=Object.create(xe),We.constructor=gt,We._super=xe,Jt&&G(We,Jt)}function Z(gt,Pt){return function(){return gt.apply(Pt,arguments)}}function K(gt,Pt){return typeof gt==l?gt.apply(Pt&&Pt[0]||r,Pt):gt}function ft(gt,Pt){return gt===r?Pt:gt}function rt(gt,Pt,Jt){L(at(Pt),function(xe){gt.addEventListener(xe,Jt,!1)})}function Lt(gt,Pt,Jt){L(at(Pt),function(xe){gt.removeEventListener(xe,Jt,!1)})}function Vt(gt,Pt){for(;gt;){if(gt==Pt)return!0;gt=gt.parentNode}return!1}function At(gt,Pt){return gt.indexOf(Pt)>-1}function at(gt){return gt.trim().split(/\s+/g)}function kt(gt,Pt,Jt){if(gt.indexOf&&!Jt)return gt.indexOf(Pt);for(var xe=0;xe<gt.length;){if(Jt&&gt[xe][Jt]==Pt||!Jt&&gt[xe]===Pt)return xe;xe++}return-1}function X(gt){return Array.prototype.slice.call(gt,0)}function ht(gt,Pt,Jt){for(var xe=[],We=[],zi=0;zi<gt.length;){var Si=gt[zi][Pt];kt(We,Si)<0&&xe.push(gt[zi]),We[zi]=Si,zi++}return xe=xe.sort(function(kn,Po){return kn[Pt]>Po[Pt]}),xe}function Mt(gt,Pt){for(var Jt,xe,We=Pt[0].toUpperCase()+Pt.slice(1),zi=0;zi<s.length;){if(Jt=s[zi],xe=Jt?Jt+We:Pt,xe in gt)return xe;zi++}return r}var pe=1;function Ct(){return pe++}function Dt(gt){var Pt=gt.ownerDocument||gt;return Pt.defaultView||Pt.parentWindow||t}var Gt=/mobile|tablet|ip(ad|hone|od)|android/i,te="ontouchstart"in t,re=Mt(t,"PointerEvent")!==r,ae=te&&Gt.test(navigator.userAgent),he="touch",Pe="pen",Se="mouse",se="kinect",fi=25,Ze=1,Ye=2,ze=4,pi=8,sn=1,Ii=2,_i=4,Fn=8,Ai=16,vi=Ii|_i,cn=Fn|Ai,Ri=vi|cn,ur=["x","y"],$n=["clientX","clientY"];function gn(gt,Pt){var Jt=this;this.manager=gt,this.callback=Pt,this.element=gt.element,this.target=gt.options.inputTarget,this.domHandler=function(xe){K(gt.options.enable,[gt])&&Jt.handler(xe)},this.init()}gn.prototype={handler:function(){},init:function(){this.evEl&&rt(this.element,this.evEl,this.domHandler),this.evTarget&&rt(this.target,this.evTarget,this.domHandler),this.evWin&&rt(Dt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Lt(this.element,this.evEl,this.domHandler),this.evTarget&&Lt(this.target,this.evTarget,this.domHandler),this.evWin&&Lt(Dt(this.element),this.evWin,this.domHandler)}};function rr(gt){var Pt,Jt=gt.options.inputClass;return Jt?Pt=Jt:re?Pt=wt:ae?Pt=pt:te?Pt=g:Pt=Ve,new Pt(gt,Wn)}function Wn(gt,Pt,Jt){var xe=Jt.pointers.length,We=Jt.changedPointers.length,zi=Pt&Ze&&xe-We===0,Si=Pt&(ze|pi)&&xe-We===0;Jt.isFirst=!!zi,Jt.isFinal=!!Si,zi&&(gt.session={}),Jt.eventType=Pt,Tn(gt,Jt),gt.emit("hammer.input",Jt),gt.recognize(Jt),gt.session.prevInput=Jt}function Tn(gt,Pt){var Jt=gt.session,xe=Pt.pointers,We=xe.length;Jt.firstInput||(Jt.firstInput=mi(Pt)),We>1&&!Jt.firstMultiple?Jt.firstMultiple=mi(Pt):We===1&&(Jt.firstMultiple=!1);var zi=Jt.firstInput,Si=Jt.firstMultiple,kn=Si?Si.center:zi.center,Po=Pt.center=Mi(xe);Pt.timeStamp=v(),Pt.deltaTime=Pt.timeStamp-zi.timeStamp,Pt.angle=Ne(kn,Po),Pt.distance=St(kn,Po),tr(Jt,Pt),Pt.offsetDirection=_r(Pt.deltaX,Pt.deltaY);var ho=nn(Pt.deltaTime,Pt.deltaX,Pt.deltaY);Pt.overallVelocityX=ho.x,Pt.overallVelocityY=ho.y,Pt.overallVelocity=A(ho.x)>A(ho.y)?ho.x:ho.y,Pt.scale=Si?ci(Si.pointers,xe):1,Pt.rotation=Si?Xe(Si.pointers,xe):0,Pt.maxPointers=Jt.prevInput?Pt.pointers.length>Jt.prevInput.maxPointers?Pt.pointers.length:Jt.prevInput.maxPointers:Pt.pointers.length,je(Jt,Pt);var os=gt.element;Vt(Pt.srcEvent.target,os)&&(os=Pt.srcEvent.target),Pt.target=os}function tr(gt,Pt){var Jt=Pt.center,xe=gt.offsetDelta||{},We=gt.prevDelta||{},zi=gt.prevInput||{};(Pt.eventType===Ze||zi.eventType===ze)&&(We=gt.prevDelta={x:zi.deltaX||0,y:zi.deltaY||0},xe=gt.offsetDelta={x:Jt.x,y:Jt.y}),Pt.deltaX=We.x+(Jt.x-xe.x),Pt.deltaY=We.y+(Jt.y-xe.y)}function je(gt,Pt){var Jt=gt.lastInterval||Pt,xe=Pt.timeStamp-Jt.timeStamp,We,zi,Si,kn;if(Pt.eventType!=pi&&(xe>fi||Jt.velocity===r)){var Po=Pt.deltaX-Jt.deltaX,ho=Pt.deltaY-Jt.deltaY,os=nn(xe,Po,ho);zi=os.x,Si=os.y,We=A(os.x)>A(os.y)?os.x:os.y,kn=_r(Po,ho),gt.lastInterval=Pt}else We=Jt.velocity,zi=Jt.velocityX,Si=Jt.velocityY,kn=Jt.direction;Pt.velocity=We,Pt.velocityX=zi,Pt.velocityY=Si,Pt.direction=kn}function mi(gt){for(var Pt=[],Jt=0;Jt<gt.pointers.length;)Pt[Jt]={clientX:h(gt.pointers[Jt].clientX),clientY:h(gt.pointers[Jt].clientY)},Jt++;return{timeStamp:v(),pointers:Pt,center:Mi(Pt),deltaX:gt.deltaX,deltaY:gt.deltaY}}function Mi(gt){var Pt=gt.length;if(Pt===1)return{x:h(gt[0].clientX),y:h(gt[0].clientY)};for(var Jt=0,xe=0,We=0;We<Pt;)Jt+=gt[We].clientX,xe+=gt[We].clientY,We++;return{x:h(Jt/Pt),y:h(xe/Pt)}}function nn(gt,Pt,Jt){return{x:Pt/gt||0,y:Jt/gt||0}}function _r(gt,Pt){return gt===Pt?sn:A(gt)>=A(Pt)?gt<0?Ii:_i:Pt<0?Fn:Ai}function St(gt,Pt,Jt){Jt||(Jt=ur);var xe=Pt[Jt[0]]-gt[Jt[0]],We=Pt[Jt[1]]-gt[Jt[1]];return Math.sqrt(xe*xe+We*We)}function Ne(gt,Pt,Jt){Jt||(Jt=ur);var xe=Pt[Jt[0]]-gt[Jt[0]],We=Pt[Jt[1]]-gt[Jt[1]];return Math.atan2(We,xe)*180/Math.PI}function Xe(gt,Pt){return Ne(Pt[1],Pt[0],$n)+Ne(gt[1],gt[0],$n)}function ci(gt,Pt){return St(Pt[0],Pt[1],$n)/St(gt[0],gt[1],$n)}var qt={mousedown:Ze,mousemove:Ye,mouseup:ze},De="mousedown",mt="mousemove mouseup";function Ve(){this.evEl=De,this.evWin=mt,this.pressed=!1,gn.apply(this,arguments)}q(Ve,gn,{handler:function(gt){var Pt=qt[gt.type];Pt&Ze&&gt.button===0&&(this.pressed=!0),Pt&Ye&&gt.which!==1&&(Pt=ze),this.pressed&&(Pt&ze&&(this.pressed=!1),this.callback(this.manager,Pt,{pointers:[gt],changedPointers:[gt],pointerType:Se,srcEvent:gt}))}});var Ce={pointerdown:Ze,pointermove:Ye,pointerup:ze,pointercancel:pi,pointerout:pi},H={2:he,3:Pe,4:Se,5:se},ve="pointerdown",Te="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(ve="MSPointerDown",Te="MSPointerMove MSPointerUp MSPointerCancel");function wt(){this.evEl=ve,this.evWin=Te,gn.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}q(wt,gn,{handler:function(gt){var Pt=this.store,Jt=!1,xe=gt.type.toLowerCase().replace("ms",""),We=Ce[xe],zi=H[gt.pointerType]||gt.pointerType,Si=zi==he,kn=kt(Pt,gt.pointerId,"pointerId");We&Ze&&(gt.button===0||Si)?kn<0&&(Pt.push(gt),kn=Pt.length-1):We&(ze|pi)&&(Jt=!0),!(kn<0)&&(Pt[kn]=gt,this.callback(this.manager,We,{pointers:Pt,changedPointers:[gt],pointerType:zi,srcEvent:gt}),Jt&&Pt.splice(kn,1))}});var Kt={touchstart:Ze,touchmove:Ye,touchend:ze,touchcancel:pi},ce="touchstart",Y="touchstart touchmove touchend touchcancel";function nt(){this.evTarget=ce,this.evWin=Y,this.started=!1,gn.apply(this,arguments)}q(nt,gn,{handler:function(gt){var Pt=Kt[gt.type];if(Pt===Ze&&(this.started=!0),!!this.started){var Jt=ct.call(this,gt,Pt);Pt&(ze|pi)&&Jt[0].length-Jt[1].length===0&&(this.started=!1),this.callback(this.manager,Pt,{pointers:Jt[0],changedPointers:Jt[1],pointerType:he,srcEvent:gt})}}});function ct(gt,Pt){var Jt=X(gt.touches),xe=X(gt.changedTouches);return Pt&(ze|pi)&&(Jt=ht(Jt.concat(xe),"identifier")),[Jt,xe]}var vt={touchstart:Ze,touchmove:Ye,touchend:ze,touchcancel:pi},Ft="touchstart touchmove touchend touchcancel";function pt(){this.evTarget=Ft,this.targetIds={},gn.apply(this,arguments)}q(pt,gn,{handler:function(gt){var Pt=vt[gt.type],Jt=bt.call(this,gt,Pt);Jt&&this.callback(this.manager,Pt,{pointers:Jt[0],changedPointers:Jt[1],pointerType:he,srcEvent:gt})}});function bt(gt,Pt){var Jt=X(gt.touches),xe=this.targetIds;if(Pt&(Ze|Ye)&&Jt.length===1)return xe[Jt[0].identifier]=!0,[Jt,Jt];var We,zi,Si=X(gt.changedTouches),kn=[],Po=this.target;if(zi=Jt.filter(function(ho){return Vt(ho.target,Po)}),Pt===Ze)for(We=0;We<zi.length;)xe[zi[We].identifier]=!0,We++;for(We=0;We<Si.length;)xe[Si[We].identifier]&&kn.push(Si[We]),Pt&(ze|pi)&&delete xe[Si[We].identifier],We++;if(kn.length)return[ht(zi.concat(kn),"identifier"),kn]}var lt=2500,Et=25;function g(){gn.apply(this,arguments);var gt=Z(this.handler,this);this.touch=new pt(this.manager,gt),this.mouse=new Ve(this.manager,gt),this.primaryTouch=null,this.lastTouches=[]}q(g,gn,{handler:function(gt,Pt,Jt){var xe=Jt.pointerType==he,We=Jt.pointerType==Se;if(!(We&&Jt.sourceCapabilities&&Jt.sourceCapabilities.firesTouchEvents)){if(xe)ut.call(this,Pt,Jt);else if(We&&Zt.call(this,Jt))return;this.callback(gt,Pt,Jt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function ut(gt,Pt){gt&Ze?(this.primaryTouch=Pt.changedPointers[0].identifier,Ee.call(this,Pt)):gt&(ze|pi)&&Ee.call(this,Pt)}function Ee(gt){var Pt=gt.changedPointers[0];if(Pt.identifier===this.primaryTouch){var Jt={x:Pt.clientX,y:Pt.clientY};this.lastTouches.push(Jt);var xe=this.lastTouches,We=function(){var zi=xe.indexOf(Jt);zi>-1&&xe.splice(zi,1)};setTimeout(We,lt)}}function Zt(gt){for(var Pt=gt.srcEvent.clientX,Jt=gt.srcEvent.clientY,xe=0;xe<this.lastTouches.length;xe++){var We=this.lastTouches[xe],zi=Math.abs(Pt-We.x),Si=Math.abs(Jt-We.y);if(zi<=Et&&Si<=Et)return!0}return!1}var Be=Mt(o.style,"touchAction"),Re=Be!==r,Fe="compute",fe="auto",ke="manipulation",Me="none",He="pan-x",ki="pan-y",ei=Wi();function $i(gt,Pt){this.manager=gt,this.set(Pt)}$i.prototype={set:function(gt){gt==Fe&&(gt=this.compute()),Re&&this.manager.element.style&&ei[gt]&&(this.manager.element.style[Be]=gt),this.actions=gt.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var gt=[];return L(this.manager.recognizers,function(Pt){K(Pt.options.enable,[Pt])&&(gt=gt.concat(Pt.getTouchAction()))}),ln(gt.join(" "))},preventDefaults:function(gt){var Pt=gt.srcEvent,Jt=gt.offsetDirection;if(this.manager.session.prevented){Pt.preventDefault();return}var xe=this.actions,We=At(xe,Me)&&!ei[Me],zi=At(xe,ki)&&!ei[ki],Si=At(xe,He)&&!ei[He];if(We){var kn=gt.pointers.length===1,Po=gt.distance<2,ho=gt.deltaTime<250;if(kn&&Po&&ho)return}if(!(Si&&zi)&&(We||zi&&Jt&vi||Si&&Jt&cn))return this.preventSrc(Pt)},preventSrc:function(gt){this.manager.session.prevented=!0,gt.preventDefault()}};function ln(gt){if(At(gt,Me))return Me;var Pt=At(gt,He),Jt=At(gt,ki);return Pt&&Jt?Me:Pt||Jt?Pt?He:ki:At(gt,ke)?ke:fe}function Wi(){if(!Re)return!1;var gt={},Pt=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Jt){gt[Jt]=Pt?t.CSS.supports("touch-action",Jt):!0}),gt}var Ji=1,Gi=2,vr=4,Xi=8,yi=Xi,Bt=16,Qe=32;function tn(gt){this.options=G({},this.defaults,gt||{}),this.id=Ct(),this.manager=null,this.options.enable=ft(this.options.enable,!0),this.state=Ji,this.simultaneous={},this.requireFail=[]}tn.prototype={defaults:{},set:function(gt){return G(this.options,gt),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(gt){if(S(gt,"recognizeWith",this))return this;var Pt=this.simultaneous;return gt=hr(gt,this),Pt[gt.id]||(Pt[gt.id]=gt,gt.recognizeWith(this)),this},dropRecognizeWith:function(gt){return S(gt,"dropRecognizeWith",this)?this:(gt=hr(gt,this),delete this.simultaneous[gt.id],this)},requireFailure:function(gt){if(S(gt,"requireFailure",this))return this;var Pt=this.requireFail;return gt=hr(gt,this),kt(Pt,gt)===-1&&(Pt.push(gt),gt.requireFailure(this)),this},dropRequireFailure:function(gt){if(S(gt,"dropRequireFailure",this))return this;gt=hr(gt,this);var Pt=kt(this.requireFail,gt);return Pt>-1&&this.requireFail.splice(Pt,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(gt){return!!this.simultaneous[gt.id]},emit:function(gt){var Pt=this,Jt=this.state;function xe(We){Pt.manager.emit(We,gt)}Jt<Xi&&xe(Pt.options.event+Wr(Jt)),xe(Pt.options.event),gt.additionalEvent&&xe(gt.additionalEvent),Jt>=Xi&&xe(Pt.options.event+Wr(Jt))},tryEmit:function(gt){if(this.canEmit())return this.emit(gt);this.state=Qe},canEmit:function(){for(var gt=0;gt<this.requireFail.length;){if(!(this.requireFail[gt].state&(Qe|Ji)))return!1;gt++}return!0},recognize:function(gt){var Pt=G({},gt);if(!K(this.options.enable,[this,Pt])){this.reset(),this.state=Qe;return}this.state&(yi|Bt|Qe)&&(this.state=Ji),this.state=this.process(Pt),this.state&(Gi|vr|Xi|Bt)&&this.tryEmit(Pt)},process:function(gt){},getTouchAction:function(){},reset:function(){}};function Wr(gt){return gt&Bt?"cancel":gt&Xi?"end":gt&vr?"move":gt&Gi?"start":""}function xa(gt){return gt==Ai?"down":gt==Fn?"up":gt==Ii?"left":gt==_i?"right":""}function hr(gt,Pt){var Jt=Pt.manager;return Jt?Jt.get(gt):gt}function Jn(){tn.apply(this,arguments)}q(Jn,tn,{defaults:{pointers:1},attrTest:function(gt){var Pt=this.options.pointers;return Pt===0||gt.pointers.length===Pt},process:function(gt){var Pt=this.state,Jt=gt.eventType,xe=Pt&(Gi|vr),We=this.attrTest(gt);return xe&&(Jt&pi||!We)?Pt|Bt:xe||We?Jt&ze?Pt|Xi:Pt&Gi?Pt|vr:Gi:Qe}});function Tt(){Jn.apply(this,arguments),this.pX=null,this.pY=null}q(Tt,Jn,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ri},getTouchAction:function(){var gt=this.options.direction,Pt=[];return gt&vi&&Pt.push(ki),gt&cn&&Pt.push(He),Pt},directionTest:function(gt){var Pt=this.options,Jt=!0,xe=gt.distance,We=gt.direction,zi=gt.deltaX,Si=gt.deltaY;return We&Pt.direction||(Pt.direction&vi?(We=zi===0?sn:zi<0?Ii:_i,Jt=zi!=this.pX,xe=Math.abs(gt.deltaX)):(We=Si===0?sn:Si<0?Fn:Ai,Jt=Si!=this.pY,xe=Math.abs(gt.deltaY))),gt.direction=We,Jt&&xe>Pt.threshold&&We&Pt.direction},attrTest:function(gt){return Jn.prototype.attrTest.call(this,gt)&&(this.state&Gi||!(this.state&Gi)&&this.directionTest(gt))},emit:function(gt){this.pX=gt.deltaX,this.pY=gt.deltaY;var Pt=xa(gt.direction);Pt&&(gt.additionalEvent=this.options.event+Pt),this._super.emit.call(this,gt)}});function Ks(){Jn.apply(this,arguments)}q(Ks,Jn,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Me]},attrTest:function(gt){return this._super.attrTest.call(this,gt)&&(Math.abs(gt.scale-1)>this.options.threshold||this.state&Gi)},emit:function(gt){if(gt.scale!==1){var Pt=gt.scale<1?"in":"out";gt.additionalEvent=this.options.event+Pt}this._super.emit.call(this,gt)}});function Xn(){tn.apply(this,arguments),this._timer=null,this._input=null}q(Xn,tn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[fe]},process:function(gt){var Pt=this.options,Jt=gt.pointers.length===Pt.pointers,xe=gt.distance<Pt.threshold,We=gt.deltaTime>Pt.time;if(this._input=gt,!xe||!Jt||gt.eventType&(ze|pi)&&!We)this.reset();else if(gt.eventType&Ze)this.reset(),this._timer=C(function(){this.state=yi,this.tryEmit()},Pt.time,this);else if(gt.eventType&ze)return yi;return Qe},reset:function(){clearTimeout(this._timer)},emit:function(gt){this.state===yi&&(gt&&gt.eventType&ze?this.manager.emit(this.options.event+"up",gt):(this._input.timeStamp=v(),this.manager.emit(this.options.event,this._input)))}});function Qs(){Jn.apply(this,arguments)}q(Qs,Jn,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Me]},attrTest:function(gt){return this._super.attrTest.call(this,gt)&&(Math.abs(gt.rotation)>this.options.threshold||this.state&Gi)}});function Lr(){Jn.apply(this,arguments)}q(Lr,Jn,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:vi|cn,pointers:1},getTouchAction:function(){return Tt.prototype.getTouchAction.call(this)},attrTest:function(gt){var Pt=this.options.direction,Jt;return Pt&(vi|cn)?Jt=gt.overallVelocity:Pt&vi?Jt=gt.overallVelocityX:Pt&cn&&(Jt=gt.overallVelocityY),this._super.attrTest.call(this,gt)&&Pt&gt.offsetDirection&&gt.distance>this.options.threshold&&gt.maxPointers==this.options.pointers&&A(Jt)>this.options.velocity&&gt.eventType&ze},emit:function(gt){var Pt=xa(gt.offsetDirection);Pt&&this.manager.emit(this.options.event+Pt,gt),this.manager.emit(this.options.event,gt)}});function fr(){tn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}q(fr,tn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ke]},process:function(gt){var Pt=this.options,Jt=gt.pointers.length===Pt.pointers,xe=gt.distance<Pt.threshold,We=gt.deltaTime<Pt.time;if(this.reset(),gt.eventType&Ze&&this.count===0)return this.failTimeout();if(xe&&We&&Jt){if(gt.eventType!=ze)return this.failTimeout();var zi=this.pTime?gt.timeStamp-this.pTime<Pt.interval:!0,Si=!this.pCenter||St(this.pCenter,gt.center)<Pt.posThreshold;this.pTime=gt.timeStamp,this.pCenter=gt.center,!Si||!zi?this.count=1:this.count+=1,this._input=gt;var kn=this.count%Pt.taps;if(kn===0)return this.hasRequireFailures()?(this._timer=C(function(){this.state=yi,this.tryEmit()},Pt.interval,this),Gi):yi}return Qe},failTimeout:function(){return this._timer=C(function(){this.state=Qe},this.options.interval,this),Qe},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==yi&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Mr(gt,Pt){return Pt=Pt||{},Pt.recognizers=ft(Pt.recognizers,Mr.defaults.preset),new Jr(gt,Pt)}Mr.VERSION="2.0.7",Mr.defaults={domEvents:!1,touchAction:Fe,enable:!0,inputTarget:null,inputClass:null,preset:[[Qs,{enable:!1}],[Ks,{enable:!1},["rotate"]],[Lr,{direction:vi}],[Tt,{direction:vi},["swipe"]],[fr],[fr,{event:"doubletap",taps:2},["tap"]],[Xn]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Dn=1,vo=2;function Jr(gt,Pt){this.options=G({},Mr.defaults,Pt||{}),this.options.inputTarget=this.options.inputTarget||gt,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=gt,this.input=rr(this),this.touchAction=new $i(this,this.options.touchAction),Ho(this,!0),L(this.options.recognizers,function(Jt){var xe=this.add(new Jt[0](Jt[1]));Jt[2]&&xe.recognizeWith(Jt[2]),Jt[3]&&xe.requireFailure(Jt[3])},this)}Jr.prototype={set:function(gt){return G(this.options,gt),gt.touchAction&&this.touchAction.update(),gt.inputTarget&&(this.input.destroy(),this.input.target=gt.inputTarget,this.input.init()),this},stop:function(gt){this.session.stopped=gt?vo:Dn},recognize:function(gt){var Pt=this.session;if(!Pt.stopped){this.touchAction.preventDefaults(gt);var Jt,xe=this.recognizers,We=Pt.curRecognizer;(!We||We&&We.state&yi)&&(We=Pt.curRecognizer=null);for(var zi=0;zi<xe.length;)Jt=xe[zi],Pt.stopped!==vo&&(!We||Jt==We||Jt.canRecognizeWith(We))?Jt.recognize(gt):Jt.reset(),!We&&Jt.state&(Gi|vr|Xi)&&(We=Pt.curRecognizer=Jt),zi++}},get:function(gt){if(gt instanceof tn)return gt;for(var Pt=this.recognizers,Jt=0;Jt<Pt.length;Jt++)if(Pt[Jt].options.event==gt)return Pt[Jt];return null},add:function(gt){if(S(gt,"add",this))return this;var Pt=this.get(gt.options.event);return Pt&&this.remove(Pt),this.recognizers.push(gt),gt.manager=this,this.touchAction.update(),gt},remove:function(gt){if(S(gt,"remove",this))return this;if(gt=this.get(gt),gt){var Pt=this.recognizers,Jt=kt(Pt,gt);Jt!==-1&&(Pt.splice(Jt,1),this.touchAction.update())}return this},on:function(gt,Pt){if(gt!==r&&Pt!==r){var Jt=this.handlers;return L(at(gt),function(xe){Jt[xe]=Jt[xe]||[],Jt[xe].push(Pt)}),this}},off:function(gt,Pt){if(gt!==r){var Jt=this.handlers;return L(at(gt),function(xe){Pt?Jt[xe]&&Jt[xe].splice(kt(Jt[xe],Pt),1):delete Jt[xe]}),this}},emit:function(gt,Pt){this.options.domEvents&&In(gt,Pt);var Jt=this.handlers[gt]&&this.handlers[gt].slice();if(!(!Jt||!Jt.length)){Pt.type=gt,Pt.preventDefault=function(){Pt.srcEvent.preventDefault()};for(var xe=0;xe<Jt.length;)Jt[xe](Pt),xe++}},destroy:function(){this.element&&Ho(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ho(gt,Pt){var Jt=gt.element;if(Jt.style){var xe;L(gt.options.cssProps,function(We,zi){xe=Mt(Jt.style,zi),Pt?(gt.oldCssProps[xe]=Jt.style[xe],Jt.style[xe]=We):Jt.style[xe]=gt.oldCssProps[xe]||""}),Pt||(gt.oldCssProps={})}}function In(gt,Pt){var Jt=i.createEvent("Event");Jt.initEvent(gt,!0,!0),Jt.gesture=Pt,Pt.target.dispatchEvent(Jt)}G(Mr,{INPUT_START:Ze,INPUT_MOVE:Ye,INPUT_END:ze,INPUT_CANCEL:pi,STATE_POSSIBLE:Ji,STATE_BEGAN:Gi,STATE_CHANGED:vr,STATE_ENDED:Xi,STATE_RECOGNIZED:yi,STATE_CANCELLED:Bt,STATE_FAILED:Qe,DIRECTION_NONE:sn,DIRECTION_LEFT:Ii,DIRECTION_RIGHT:_i,DIRECTION_UP:Fn,DIRECTION_DOWN:Ai,DIRECTION_HORIZONTAL:vi,DIRECTION_VERTICAL:cn,DIRECTION_ALL:Ri,Manager:Jr,Input:gn,TouchAction:$i,TouchInput:pt,MouseInput:Ve,PointerEventInput:wt,TouchMouseInput:g,SingleTouchInput:nt,Recognizer:tn,AttrRecognizer:Jn,Tap:fr,Pan:Tt,Swipe:Lr,Pinch:Ks,Rotate:Qs,Press:Xn,on:rt,off:Lt,each:L,merge:j,extend:W,assign:G,inherit:q,bindFn:Z,prefixed:Mt});var wc=typeof t<"u"?t:typeof self<"u"?self:{};wc.Hammer=Mr,e.exports?e.exports=Mr:t[n]=Mr})(window,document,"Hammer")}(fR)),fR.exports}var gg=Bet();const Tet=Jh(gg),hc=_G({__proto__:null,default:Tet},[gg]),pR=1,AR=2,w2=4,Iet={mousedown:pR,mousemove:AR,mouseup:w2};function Met(e,t){for(let i=0;i<e.length;i++)if(t(e[i]))return!0;return!1}function Pet(e){const t=e.prototype.handler;e.prototype.handler=function(i){const n=this.store;i.button>0&&i.type==="pointerdown"&&(Met(n,r=>r.pointerId===i.pointerId)||n.push(i)),t.call(this,i)}}function Ret(e){e.prototype.handler=function(t){let i=Iet[t.type];i&pR&&t.button>=0&&(this.pressed=!0),i&AR&&t.which===0&&(i=w2),this.pressed&&(i&w2&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}Pet(gg.PointerEventInput),Ret(gg.MouseInput);const Det=gg.Manager;class fy{constructor(t,i,n){this.element=t,this.callback=i,this.options={enable:!0,...n}}}const Oet=hc?[[hc.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[hc.Rotate,{enable:!1}],[hc.Pinch,{enable:!1}],[hc.Swipe,{enable:!1}],[hc.Pan,{threshold:0,enable:!1}],[hc.Press,{enable:!1}],[hc.Tap,{event:"doubletap",taps:2,enable:!1}],[hc.Tap,{event:"anytap",enable:!1}],[hc.Tap,{enable:!1}]]:null,gR={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},Let={doubletap:["tap"]},Fet={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},C2={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},ket={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},mR={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},Net=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",op=typeof window<"u"?window:global;let E2=!1;try{const e={get passive(){return E2=!0,!0}};op.addEventListener("test",null,e),op.removeEventListener("test",null)}catch{E2=!1}const Uet=Net.indexOf("firefox")!==-1,{WHEEL_EVENTS:Get}=C2,yR="wheel",_R=4.000244140625,zet=40,Vet=.25;class jet extends fy{constructor(t,i,n){super(t,i,n),this.handleEvent=r=>{if(!this.options.enable)return;let s=r.deltaY;op.WheelEvent&&(Uet&&r.deltaMode===op.WheelEvent.DOM_DELTA_PIXEL&&(s/=op.devicePixelRatio),r.deltaMode===op.WheelEvent.DOM_DELTA_LINE&&(s*=zet)),s!==0&&s%_R===0&&(s=Math.floor(s/_R)),r.shiftKey&&s&&(s=s*Vet),this.callback({type:yR,center:{x:r.clientX,y:r.clientY},delta:-s,srcEvent:r,pointerType:"mouse",target:r.target})},this.events=(this.options.events||[]).concat(Get),this.events.forEach(r=>t.addEventListener(r,this.handleEvent,E2?{passive:!1}:!1))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,i){t===yR&&(this.options.enable=i)}}const{MOUSE_EVENTS:Het}=C2,vR="pointermove",bR="pointerover",xR="pointerout",wR="pointerenter",CR="pointerleave";class Wet extends fy{constructor(t,i,n){super(t,i,n),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,this.events=(this.options.events||[]).concat(Het),this.events.forEach(s=>t.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,i){t===vR&&(this.enableMoveEvent=i),t===bR&&(this.enableOverEvent=i),t===xR&&(this.enableOutEvent=i),t===wR&&(this.enableEnterEvent=i),t===CR&&(this.enableLeaveEvent=i)}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit(bR,t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit(xR,t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit(wR,t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit(CR,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.which===0&&(this.pressed=!1),this.pressed||this._emit(vR,t);break;case"mouseup":this.pressed=!1;break}}_emit(t,i){this.callback({type:t,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})}}const{KEY_EVENTS:Jet}=C2,ER="keydown",BR="keyup";class Xet extends fy{constructor(t,i,n){super(t,i,n),this.handleEvent=r=>{const s=r.target||r.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&r.type==="keydown"&&this.callback({type:ER,srcEvent:r,key:r.key,target:r.target}),this.enableUpEvent&&r.type==="keyup"&&this.callback({type:BR,srcEvent:r,key:r.key,target:r.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(Jet),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach(r=>t.addEventListener(r,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,i){t===ER&&(this.enableDownEvent=i),t===BR&&(this.enableUpEvent=i)}}const TR="contextmenu";class Ket extends fy{constructor(t,i,n){super(t,i,n),this.handleEvent=r=>{this.options.enable&&this.callback({type:TR,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,i){t===TR&&(this.options.enable=i)}}const B2=1,dy=2,T2=4,Qet={pointerdown:B2,pointermove:dy,pointerup:T2,mousedown:B2,mousemove:dy,mouseup:T2},Zet=1,Yet=2,qet=3,$et=0,tit=1,eit=2,iit=1,nit=2,rit=4;function oit(e){const t=Qet[e.srcEvent.type];if(!t)return null;const{buttons:i,button:n,which:r}=e.srcEvent;let s=!1,o=!1,l=!1;return t===T2||t===dy&&!Number.isFinite(i)?(s=r===Zet,o=r===Yet,l=r===qet):t===dy?(s=!!(i&iit),o=!!(i&rit),l=!!(i&nit)):t===B2&&(s=n===$et,o=n===tit,l=n===eit),{leftButton:s,middleButton:o,rightButton:l}}function sit(e,t){const i=e.center;if(!i)return null;const n=t.getBoundingClientRect(),r=n.width/t.offsetWidth||1,s=n.height/t.offsetHeight||1,o={x:(i.x-n.left-t.clientLeft)/r,y:(i.y-n.top-t.clientTop)/s};return{center:i,offsetCenter:o}}const S2={srcElement:"root",priority:0};class ait{constructor(t){this.handleEvent=i=>{if(this.isEmpty())return;const n=this._normalizeEvent(i);let r=i.srcEvent.target;for(;r&&r!==n.rootElement;){if(this._emit(n,r),n.handled)return;r=r.parentNode}this._emit(n,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,i,n,r=!1,s=!1){const{handlers:o,handlersByElement:l}=this;let h=S2;typeof n=="string"||n&&n.addEventListener?h={...S2,srcElement:n}:n&&(h={...S2,...n});let A=l.get(h.srcElement);A||(A=[],l.set(h.srcElement,A));const v={type:t,handler:i,srcElement:h.srcElement,priority:h.priority};r&&(v.once=!0),s&&(v.passive=!0),o.push(v),this._active=this._active||!v.passive;let C=A.length-1;for(;C>=0&&!(A[C].priority>=v.priority);)C--;A.splice(C+1,0,v)}remove(t,i){const{handlers:n,handlersByElement:r}=this;for(let s=n.length-1;s>=0;s--){const o=n[s];if(o.type===t&&o.handler===i){n.splice(s,1);const l=r.get(o.srcElement);l.splice(l.indexOf(o),1),l.length===0&&r.delete(o.srcElement)}}this._active=n.some(s=>!s.passive)}_emit(t,i){const n=this.handlersByElement.get(i);if(n){let r=!1;const s=()=>{t.handled=!0},o=()=>{t.handled=!0,r=!0},l=[];for(let h=0;h<n.length;h++){const{type:A,handler:v,once:C}=n[h];if(v({...t,type:A,stopPropagation:s,stopImmediatePropagation:o}),C&&l.push(n[h]),r)break}for(let h=0;h<l.length;h++){const{type:A,handler:v}=l[h];this.remove(A,v)}}}_normalizeEvent(t){const i=this.eventManager.getElement();return{...t,...oit(t),...sit(t,i),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:i}}}const lit={events:null,recognizers:null,recognizerOptions:{},Manager:Det,touchAction:"none",tabIndex:0};class cit{constructor(t=null,i){this._onBasicInput=r=>{const{srcEvent:s}=r,o=Fet[s.type];o&&this.manager.emit(o,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={...lit,...i},this.events=new Map,this.setElement(t);const{events:n}=this.options;n&&this.on(n)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;const{options:i}=this,n=i.Manager;this.manager=new n(t,{touchAction:i.touchAction,recognizers:i.recognizers||Oet}).on("hammer.input",this._onBasicInput),i.recognizers||Object.keys(gR).forEach(r=>{const s=this.manager.get(r);s&&gR[r].forEach(o=>{s.recognizeWith(o)})});for(const r in i.recognizerOptions){const s=this.manager.get(r);if(s){const o=i.recognizerOptions[r];delete o.enable,s.set(o)}}this.wheelInput=new jet(t,this._onOtherEvent,{enable:!1}),this.moveInput=new Wet(t,this._onOtherEvent,{enable:!1}),this.keyInput=new Xet(t,this._onOtherEvent,{enable:!1,tabIndex:i.tabIndex}),this.contextmenuInput=new Ket(t,this._onOtherEvent,{enable:!1});for(const[r,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(r,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,i,n){this._addEventHandler(t,i,n,!1)}once(t,i,n){this._addEventHandler(t,i,n,!0)}watch(t,i,n){this._addEventHandler(t,i,n,!1,!0)}off(t,i){this._removeEventHandler(t,i)}_toggleRecognizer(t,i){const{manager:n}=this;if(!n)return;const r=n.get(t);if(r&&r.options.enable!==i){r.set({enable:i});const s=Let[t];s&&!this.options.recognizers&&s.forEach(o=>{const l=n.get(o);i?(l.requireFailure(t),r.dropRequireFailure(o)):l.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,i),this.moveInput.enableEventType(t,i),this.keyInput.enableEventType(t,i),this.contextmenuInput.enableEventType(t,i)}_addEventHandler(t,i,n,r,s){if(typeof t!="string"){n=i;for(const v in t)this._addEventHandler(v,t[v],n,r,s);return}const{manager:o,events:l}=this,h=mR[t]||t;let A=l.get(h);A||(A=new ait(this),l.set(h,A),A.recognizerName=ket[h]||h,o&&o.on(h,A.handleEvent)),A.add(t,i,n,r,s),A.isEmpty()||this._toggleRecognizer(A.recognizerName,!0)}_removeEventHandler(t,i){if(typeof t!="string"){for(const o in t)this._removeEventHandler(o,t[o]);return}const{events:n}=this,r=mR[t]||t,s=n.get(r);if(s&&(s.remove(t,i),s.isEmpty())){const{recognizerName:o}=s;let l=!1;for(const h of n.values())if(h.recognizerName===o&&!h.isEmpty()){l=!0;break}l||this._toggleRecognizer(o,!1)}}}function SR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function Os(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?SR(Object(i),!0).forEach(function(n){wi(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):SR(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var uf={transitionDuration:0},tu={transitionDuration:300,transitionEasing:function(e){return e},transitionInterpolator:new dg,transitionInterruption:Ag.BREAK},py=300,Ay=function(e){return 1-(1-e)*(1-e)},sp={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},IR=function(){function e(){var t=this;Gu(this,e),wi(this,"events",[]),wi(this,"scrollZoom",!0),wi(this,"dragPan",!0),wi(this,"dragRotate",!0),wi(this,"doubleClickZoom",!0),wi(this,"touchZoom",!0),wi(this,"touchRotate",!1),wi(this,"keyboard",!0),wi(this,"_interactionState",{isDragging:!1}),wi(this,"_events",{}),wi(this,"_setInteractionState",function(i){Object.assign(t._interactionState,i),t.onStateChange&&t.onStateChange(t._interactionState)}),wi(this,"_onTransition",function(i,n){t.onViewportChange(i,t._interactionState,n)}),this.handleEvent=this.handleEvent.bind(this),this._transitionManager=new x2({onViewportChange:this._onTransition,onStateChange:this._setInteractionState})}return Uu(e,[{key:"handleEvent",value:function(t){this.mapState=this.getMapState();var i=this._eventStartBlocked;switch(t.type){case"panstart":return i?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return i?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return i?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}},{key:"getCenter",value:function(t){var i=t.offsetCenter,n=i.x,r=i.y;return[n,r]}},{key:"isFunctionKeyPressed",value:function(t){var i=t.srcEvent;return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}},{key:"blockEvents",value:function(t){var i=this,n=setTimeout(function(){i._eventStartBlocked===n&&(i._eventStartBlocked=null)},t);this._eventStartBlocked=n}},{key:"updateViewport",value:function(t,i,n){var r=this.mapState instanceof rp?this.mapState.getViewportProps():this.mapState,s=Os(Os({},t.getViewportProps()),i),o=Object.keys(s).some(function(l){return r[l]!==s[l]});this._state=t.getState(),this._setInteractionState(n),o&&this.onViewportChange(s,this._interactionState,r)}},{key:"getMapState",value:function(t){return new rp(Os(Os(Os({},this.mapStateProps),this._state),t))}},{key:"isDragging",value:function(){return this._interactionState.isDragging}},{key:"setOptions",value:function(t){var i=t.onViewportChange,n=t.onStateChange,r=t.eventManager,s=r===void 0?this.eventManager:r,o=t.isInteractive,l=o===void 0?!0:o,h=t.scrollZoom,A=h===void 0?this.scrollZoom:h,v=t.dragPan,C=v===void 0?this.dragPan:v,S=t.dragRotate,L=S===void 0?this.dragRotate:S,N=t.doubleClickZoom,G=N===void 0?this.doubleClickZoom:N,W=t.touchZoom,j=W===void 0?this.touchZoom:W,q=t.touchRotate,Z=q===void 0?this.touchRotate:q,K=t.keyboard,ft=K===void 0?this.keyboard:K;this.onViewportChange=i,this.onStateChange=n;var rt=this.mapStateProps||{},Lt=rt.height!==t.height||rt.width!==t.width;this.mapStateProps=t,Lt&&(this.mapState=rt,this.updateViewport(new rp(t))),this._transitionManager.processViewportChange(t),this.eventManager!==s&&(this.eventManager=s,this._events={},this.toggleEvents(this.events,!0)),this.toggleEvents(sp.WHEEL,l&&!!A),this.toggleEvents(sp.PAN,l&&!!(C||L)),this.toggleEvents(sp.PINCH,l&&!!(j||Z)),this.toggleEvents(sp.TRIPLE_PAN,l&&!!Z),this.toggleEvents(sp.DOUBLE_TAP,l&&!!G),this.toggleEvents(sp.KEYBOARD,l&&!!ft),this.scrollZoom=A,this.dragPan=C,this.dragRotate=L,this.doubleClickZoom=G,this.touchZoom=j,this.touchRotate=Z,this.keyboard=ft}},{key:"toggleEvents",value:function(t,i){var n=this;this.eventManager&&t.forEach(function(r){n._events[r]!==i&&(n._events[r]=i,i?n.eventManager.on(r,n.handleEvent):n.eventManager.off(r,n.handleEvent))})}},{key:"_onPanStart",value:function(t){var i=this.getCenter(t);this._panRotate=this.isFunctionKeyPressed(t)||t.rightButton;var n=this._panRotate?this.mapState.rotateStart({pos:i}):this.mapState.panStart({pos:i});return this.updateViewport(n,uf,{isDragging:!0}),!0}},{key:"_onPan",value:function(t){return this.isDragging()?this._panRotate?this._onPanRotate(t):this._onPanMove(t):!1}},{key:"_onPanEnd",value:function(t){return this.isDragging()?this._panRotate?this._onPanRotateEnd(t):this._onPanMoveEnd(t):!1}},{key:"_onPanMove",value:function(t){if(!this.dragPan)return!1;var i=this.getCenter(t),n=this.mapState.pan({pos:i});return this.updateViewport(n,uf,{isPanning:!0}),!0}},{key:"_onPanMoveEnd",value:function(t){if(this.dragPan){var i=this.dragPan.inertia,n=i===void 0?py:i;if(n&&t.velocity){var r=this.getCenter(t),s=[r[0]+t.velocityX*n/2,r[1]+t.velocityY*n/2],o=this.mapState.pan({pos:s}).panEnd();return this.updateViewport(o,Os(Os({},tu),{},{transitionDuration:n,transitionEasing:Ay}),{isDragging:!1,isPanning:!0}),!0}}var l=this.mapState.panEnd();return this.updateViewport(l,null,{isDragging:!1,isPanning:!1}),!0}},{key:"_onPanRotate",value:function(t){if(!this.dragRotate)return!1;var i=this.getCenter(t),n=this.mapState.rotate({pos:i});return this.updateViewport(n,uf,{isRotating:!0}),!0}},{key:"_onPanRotateEnd",value:function(t){if(this.dragRotate){var i=this.dragRotate.inertia,n=i===void 0?py:i;if(n&&t.velocity){var r=this.getCenter(t),s=[r[0]+t.velocityX*n/2,r[1]+t.velocityY*n/2],o=this.mapState.rotate({pos:s}).rotateEnd();return this.updateViewport(o,Os(Os({},tu),{},{transitionDuration:n,transitionEasing:Ay}),{isDragging:!1,isRotating:!0}),!0}}var l=this.mapState.panEnd();return this.updateViewport(l,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onWheel",value:function(t){if(!this.scrollZoom)return!1;var i=this.scrollZoom,n=i.speed,r=n===void 0?.01:n,s=i.smooth,o=s===void 0?!1:s;t.preventDefault();var l=this.getCenter(t),h=t.delta,A=2/(1+Math.exp(-Math.abs(h*r)));h<0&&A!==0&&(A=1/A);var v=this.mapState.zoom({pos:l,scale:A});return v.getViewportProps().zoom===this.mapStateProps.zoom?!1:(this.updateViewport(v,Os(Os({},tu),{},{transitionInterpolator:new dg({around:l}),transitionDuration:o?250:1}),{isPanning:!0,isZooming:!0}),!0)}},{key:"_onPinchStart",value:function(t){var i=this.getCenter(t),n=this.mapState.zoomStart({pos:i}).rotateStart({pos:i});return this._startPinchRotation=t.rotation,this._lastPinchEvent=t,this.updateViewport(n,uf,{isDragging:!0}),!0}},{key:"_onPinch",value:function(t){if(!this.isDragging()||!this.touchZoom&&!this.touchRotate)return!1;var i=this.mapState;if(this.touchZoom){var n=t.scale,r=this.getCenter(t);i=i.zoom({pos:r,scale:n})}if(this.touchRotate){var s=t.rotation;i=i.rotate({deltaAngleX:this._startPinchRotation-s})}return this.updateViewport(i,uf,{isDragging:!0,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!!this.touchRotate}),this._lastPinchEvent=t,!0}},{key:"_onPinchEnd",value:function(t){if(!this.isDragging())return!1;if(this.touchZoom){var i=this.touchZoom.inertia,n=i===void 0?py:i,r=this._lastPinchEvent;if(n&&r&&t.scale!==r.scale){var s=this.getCenter(t),o=this.mapState.rotateEnd(),l=Math.log2(t.scale),h=(l-Math.log2(r.scale))/(t.deltaTime-r.deltaTime),A=Math.pow(2,l+h*n/2);return o=o.zoom({pos:s,scale:A}).zoomEnd(),this.updateViewport(o,Os(Os({},tu),{},{transitionInterpolator:new dg({around:s}),transitionDuration:n,transitionEasing:Ay}),{isDragging:!1,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!1}),this.blockEvents(n),!0}}var v=this.mapState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(v,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1}),this._startPinchRotation=null,this._lastPinchEvent=null,!0}},{key:"_onTriplePanStart",value:function(t){var i=this.getCenter(t),n=this.mapState.rotateStart({pos:i});return this.updateViewport(n,uf,{isDragging:!0}),!0}},{key:"_onTriplePan",value:function(t){if(!this.isDragging()||!this.touchRotate)return!1;var i=this.getCenter(t);i[0]-=t.deltaX;var n=this.mapState.rotate({pos:i});return this.updateViewport(n,uf,{isRotating:!0}),!0}},{key:"_onTriplePanEnd",value:function(t){if(!this.isDragging())return!1;if(this.touchRotate){var i=this.touchRotate.inertia,n=i===void 0?py:i;if(n&&t.velocityY){var r=this.getCenter(t),s=[r[0],r[1]+=t.velocityY*n/2],o=this.mapState.rotate({pos:s});return this.updateViewport(o,Os(Os({},tu),{},{transitionDuration:n,transitionEasing:Ay}),{isDragging:!1,isRotating:!0}),this.blockEvents(n),!1}}var l=this.mapState.rotateEnd();return this.updateViewport(l,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onDoubleTap",value:function(t){if(!this.doubleClickZoom)return!1;var i=this.getCenter(t),n=this.isFunctionKeyPressed(t),r=this.mapState.zoom({pos:i,scale:n?.5:2});return this.updateViewport(r,Object.assign({},tu,{transitionInterpolator:new dg({around:i})}),{isZooming:!0}),!0}},{key:"_onKeyDown",value:function(t){if(!this.keyboard)return!1;var i=this.isFunctionKeyPressed(t),n=this.keyboard,r=n.zoomSpeed,s=r===void 0?2:r,o=n.moveSpeed,l=o===void 0?100:o,h=n.rotateSpeedX,A=h===void 0?15:h,v=n.rotateSpeedY,C=v===void 0?10:v,S=this.mapStateProps,L;switch(t.srcEvent.keyCode){case 189:i?L=this.getMapState({zoom:S.zoom-Math.log2(s)-1}):L=this.getMapState({zoom:S.zoom-Math.log2(s)});break;case 187:i?L=this.getMapState({zoom:S.zoom+Math.log2(s)+1}):L=this.getMapState({zoom:S.zoom+Math.log2(s)});break;case 37:i?L=this.getMapState({bearing:S.bearing-A}):L=this.mapState.pan({pos:[l,0],startPos:[0,0]});break;case 39:i?L=this.getMapState({bearing:S.bearing+A}):L=this.mapState.pan({pos:[-l,0],startPos:[0,0]});break;case 38:i?L=this.getMapState({pitch:S.pitch+C}):L=this.mapState.pan({pos:[0,l],startPos:[0,0]});break;case 40:i?L=this.getMapState({pitch:S.pitch-C}):L=this.mapState.pan({pos:[0,-l],startPos:[0,0]});break;default:return!1}return this.updateViewport(L,tu)}}]),e}();function MR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function eu(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?MR(Object(i),!0).forEach(function(n){wi(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):MR(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var uit=Object.assign({},$c.propTypes,{maxZoom:ge.number,minZoom:ge.number,maxPitch:ge.number,minPitch:ge.number,onViewStateChange:ge.func,onViewportChange:ge.func,onInteractionStateChange:ge.func,transitionDuration:ge.oneOfType([ge.number,ge.string]),transitionInterpolator:ge.object,transitionInterruption:ge.number,transitionEasing:ge.func,onTransitionStart:ge.func,onTransitionInterrupt:ge.func,onTransitionEnd:ge.func,scrollZoom:ge.oneOfType([ge.bool,ge.object]),dragPan:ge.oneOfType([ge.bool,ge.object]),dragRotate:ge.oneOfType([ge.bool,ge.object]),doubleClickZoom:ge.bool,touchZoom:ge.oneOfType([ge.bool,ge.object]),touchRotate:ge.oneOfType([ge.bool,ge.object]),keyboard:ge.oneOfType([ge.bool,ge.object]),onHover:ge.func,onClick:ge.func,onDblClick:ge.func,onContextMenu:ge.func,onMouseDown:ge.func,onMouseMove:ge.func,onMouseUp:ge.func,onTouchStart:ge.func,onTouchMove:ge.func,onTouchEnd:ge.func,onMouseEnter:ge.func,onMouseLeave:ge.func,onMouseOut:ge.func,onWheel:ge.func,touchAction:ge.string,eventRecognizerOptions:ge.object,clickRadius:ge.number,interactiveLayerIds:ge.array,getCursor:ge.func,controller:ge.instanceOf(IR)}),hit=function(e){var t=e.isDragging,i=e.isHovering;return t?"grabbing":i?"pointer":"grab"},fit=Object.assign({},$c.defaultProps,lf,x2.defaultProps,{onViewStateChange:null,onViewportChange:null,onClick:null,onNativeClick:null,onHover:null,onContextMenu:function(e){return e.preventDefault()},scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!1,keyboard:!0,touchAction:"none",eventRecognizerOptions:{},clickRadius:0,getCursor:hit});function I2(e){if(e.lngLat||!e.offsetCenter)return e;var t=e.offsetCenter,i=t.x,n=t.y;if(!Number.isFinite(i)||!Number.isFinite(n))return e;var r=[i,n];return e.point=r,e.lngLat=this.viewport.unproject(r),e}function PR(e){var t=this.map;if(!t||!e)return null;var i={},n=this.props.clickRadius;this.props.interactiveLayerIds&&(i.layers=this.props.interactiveLayerIds);try{return t.queryRenderedFeatures(n?[[e[0]-n,e[1]+n],[e[0]+n,e[1]-n]]:e,i)}catch{return null}}function iu(e,t){var i=this.props[e];i&&i(I2.call(this,t))}function dit(e){iu.call(this,e.pointerType==="touch"?"onTouchStart":"onMouseDown",e)}function pit(e){iu.call(this,e.pointerType==="touch"?"onTouchEnd":"onMouseUp",e)}function Ait(e){if(iu.call(this,e.pointerType==="touch"?"onTouchMove":"onMouseMove",e),!this.state.isDragging){var t=this.props,i=t.onHover,n=t.interactiveLayerIds,r;e=I2.call(this,e),(n||i)&&(r=PR.call(this,e.point));var s=!!(n&&r&&r.length>0),o=s&&!this.state.isHovering,l=!s&&this.state.isHovering;(i||o)&&(e.features=r,i&&i(e)),o&&iu.call(this,"onMouseEnter",e),l&&iu.call(this,"onMouseLeave",e),(o||l)&&this.setState({isHovering:s})}}function RR(e){var t=this.props,i=t.onClick,n=t.onNativeClick,r=t.onDblClick,s=t.doubleClickZoom,o=[],l=r||s;switch(e.type){case"anyclick":o.push(n),l||o.push(i);break;case"click":l&&o.push(i);break}o=o.filter(Boolean),o.length&&(e=I2.call(this,e),e.features=PR.call(this,e.point),o.forEach(function(h){return h(e)}))}function git(e){return{getMap:e.current&&e.current.getMap,queryRenderedFeatures:e.current&&e.current.queryRenderedFeatures}}var M2=Ie.forwardRef(function(e,t){var i=Ie.useContext(cf),n=Ie.useMemo(function(){return e.controller||new IR},[]),r=Ie.useMemo(function(){return new cit(null,{touchAction:e.touchAction,recognizerOptions:e.eventRecognizerOptions})},[]),s=Ie.useRef(null),o=Ie.useRef(null),l=Ie.useRef({width:0,height:0,state:{isHovering:!1,isDragging:!1}}),h=l.current;h.props=e,h.map=o.current&&o.current.getMap(),h.setState=function(rt){h.state=eu(eu({},h.state),rt),s.current.style.cursor=e.getCursor(h.state)};var A=!0,v,C,S=function(rt,Lt,Vt){if(A){v=[rt,Lt,Vt];return}var At=h.props,at=At.onViewStateChange,kt=At.onViewportChange;at&&at({viewState:rt,interactionState:Lt,oldViewState:Vt}),kt&&kt(rt,Lt,Vt)};Ie.useImperativeHandle(t,function(){return git(o)},[]);var L=Ie.useMemo(function(){return eu(eu({},i),{},{eventManager:r,container:i.container||s.current})},[i,s.current]);L.onViewportChange=S,L.viewport=i.viewport||rR(h),h.viewport=L.viewport;var N=function(rt){var Lt=rt.isDragging,Vt=Lt===void 0?!1:Lt;if(Vt!==h.state.isDragging&&h.setState({isDragging:Vt}),A){C=rt;return}var At=h.props.onInteractionStateChange;At&&At(rt)},G=function(){h.width&&h.height&&n.setOptions(eu(eu(eu({},h.props),h.props.viewState),{},{isInteractive:!!(h.props.onViewStateChange||h.props.onViewportChange),onViewportChange:S,onStateChange:N,eventManager:r,width:h.width,height:h.height}))},W=function(rt){var Lt=rt.width,Vt=rt.height;h.width=Lt,h.height=Vt,G(),h.props.onResize({width:Lt,height:Vt})};Ie.useEffect(function(){return r.setElement(s.current),r.on({pointerdown:dit.bind(h),pointermove:Ait.bind(h),pointerup:pit.bind(h),pointerleave:iu.bind(h,"onMouseOut"),click:RR.bind(h),anyclick:RR.bind(h),dblclick:iu.bind(h,"onDblClick"),wheel:iu.bind(h,"onWheel"),contextmenu:iu.bind(h,"onContextMenu")}),function(){r.destroy()}},[]),_2(function(){v&&S.apply(void 0,nG(v)),C&&N(C)}),G();var j=e.width,q=e.height,Z=e.style,K=e.getCursor,ft=Ie.useMemo(function(){return eu(eu({position:"relative"},Z),{},{width:j,height:q,cursor:K(h.state)})},[Z,j,q,K,h.state]);return(!v||!h._child)&&(h._child=Ie.createElement(y2,{value:L},Ie.createElement("div",{key:"event-canvas",ref:s,style:ft},Ie.createElement($c,CB({},e,{width:"100%",height:"100%",style:null,onResize:W,ref:o}))))),A=!1,h._child});M2.supported=$c.supported,M2.propTypes=uit,M2.defaultProps=fit,ge.string.isRequired;var mit=["fill","line","symbol","circle","fill-extrusion","raster","background","heatmap","hillshade"];ge.oneOf(mit).isRequired;var oh={captureScroll:!1,captureDrag:!0,captureClick:!0,captureDoubleClick:!0,capturePointerMove:!1},xl={captureScroll:ge.bool,captureDrag:ge.bool,captureClick:ge.bool,captureDoubleClick:ge.bool,capturePointerMove:ge.bool};function yit(e){var t=e.containerRef.current,i=e.context.eventManager;if(!(!t||!i)){var n={wheel:function(r){var s=e.props;s.captureScroll&&r.stopPropagation(),s.onScroll&&s.onScroll(r,e)},panstart:function(r){var s=e.props;s.captureDrag&&r.stopPropagation(),s.onDragStart&&s.onDragStart(r,e)},anyclick:function(r){var s=e.props;s.captureClick&&r.stopPropagation(),s.onNativeClick&&s.onNativeClick(r,e)},click:function(r){var s=e.props;s.captureClick&&r.stopPropagation(),s.onClick&&s.onClick(r,e)},dblclick:function(r){var s=e.props;s.captureDoubleClick&&r.stopPropagation(),s.onDoubleClick&&s.onDoubleClick(r,e)},pointermove:function(r){var s=e.props;s.capturePointerMove&&r.stopPropagation(),s.onPointerMove&&s.onPointerMove(r,e)}};return i.watch(n,t),function(){i.off(n)}}}function sh(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Ie.useContext(cf),i=Ie.useRef(null),n=Ie.useRef({props:e,state:{},context:t,containerRef:i}),r=n.current;return r.props=e,r.context=t,Ie.useEffect(function(){return yit(r)},[t.eventManager]),r}function _it(e){var t=vit();return function(){var i=_d(e),n;if(t){var r=_d(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return qv(this,n)}}function vit(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function bit(e){var t=e.instance,i=sh(e),n=i.context,r=i.containerRef;return t._context=n,t._containerRef=r,t._render()}var DR=function(e){Yv(i,e);var t=_it(i);function i(){var n;Gu(this,i);for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return n=t.call.apply(t,[this].concat(s)),wi(Nu(n),"_context",{}),wi(Nu(n),"_containerRef",Ie.createRef()),wi(Nu(n),"_onScroll",function(l){}),wi(Nu(n),"_onDragStart",function(l){}),wi(Nu(n),"_onDblClick",function(l){}),wi(Nu(n),"_onClick",function(l){}),wi(Nu(n),"_onPointerMove",function(l){}),n}return Uu(i,[{key:"_render",value:function(){throw new Error("_render() not implemented")}},{key:"render",value:function(){return Ie.createElement(bit,CB({instance:this},this.props,{onScroll:this._onScroll,onDragStart:this._onDragStart,onDblClick:this._onDblClick,onClick:this._onClick,onPointerMove:this._onPointerMove}))}}]),i}(Ie.PureComponent);wi(DR,"propTypes",xl),wi(DR,"defaultProps",oh);function OR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function LR(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?OR(Object(i),!0).forEach(function(n){wi(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):OR(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var xit=Object.assign({},xl,{draggable:ge.bool,onDrag:ge.func,onDragEnd:ge.func,onDragStart:ge.func,offsetLeft:ge.number,offsetTop:ge.number}),wit=Object.assign({},oh,{draggable:!1,offsetLeft:0,offsetTop:0});function FR(e){var t=e.offsetCenter,i=t.x,n=t.y;return[i,n]}function Cit(e,t){var i=e.center,n=i.x,r=i.y;if(t){var s=t.getBoundingClientRect();return[s.left-n,s.top-r]}return null}function P2(e,t,i,n){var r=e[0]+t[0]-i.offsetLeft,s=e[1]+t[1]-i.offsetTop;return n.viewport.unproject([r,s])}function Eit(e,t){var i=t.props,n=t.callbacks,r=t.state,s=t.context,o=t.containerRef,l=i.draggable;if(l){e.stopPropagation();var h=FR(e),A=Cit(e,o.current);if(r.setDragPos(h),r.setDragOffset(A),n.onDragStart&&A){var v=Object.assign({},e);v.lngLat=P2(h,A,i,s),n.onDragStart(v)}}}function Bit(e,t){var i=t.props,n=t.callbacks,r=t.state,s=t.context;e.stopPropagation();var o=FR(e);r.setDragPos(o);var l=r.dragOffset;if(n.onDrag&&l){var h=Object.assign({},e);h.lngLat=P2(o,l,i,s),n.onDrag(h)}}function Tit(e,t){var i=t.props,n=t.callbacks,r=t.state,s=t.context;e.stopPropagation();var o=r.dragPos,l=r.dragOffset;if(r.setDragPos(null),r.setDragOffset(null),n.onDragEnd&&o&&l){var h=Object.assign({},e);h.lngLat=P2(o,l,i,s),n.onDragEnd(h)}}function Sit(e,t){var i=t.state;e.stopPropagation(),i.setDragPos(null),i.setDragOffset(null)}function Iit(e){var t=e.context.eventManager;if(!(!t||!e.state.dragPos)){var i={panmove:function(n){return Bit(n,e)},panend:function(n){return Tit(n,e)},pancancel:function(n){return Sit(n,e)}};return t.watch(i),function(){t.off(i)}}}function Mit(e){var t=Ie.useState(null),i=po(t,2),n=i[0],r=i[1],s=Ie.useState(null),o=po(s,2),l=o[0],h=o[1],A=sh(LR(LR({},e),{},{onDragStart:Eit}));return A.callbacks=e,A.state.dragPos=n,A.state.setDragPos=r,A.state.dragOffset=l,A.state.setDragOffset=h,Ie.useEffect(function(){return Iit(A)},[A.context.eventManager,!!n]),A}var kR=typeof window<"u"&&window.devicePixelRatio||1,mg=function(e){return Math.round(e*kR)/kR},NR=function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"x";if(e===null)return t;var n=i==="x"?e.offsetWidth:e.offsetHeight;return mg(t/100*n)/n*100};function UR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function Pit(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?UR(Object(i),!0).forEach(function(n){wi(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):UR(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var Rit=Object.assign({},xit,{className:ge.string,longitude:ge.number.isRequired,latitude:ge.number.isRequired,style:ge.object}),Dit=Object.assign({},wit,{className:""});function Oit(e){var t=e.props,i=e.state,n=e.context,r=t.longitude,s=t.latitude,o=t.offsetLeft,l=t.offsetTop,h=i.dragPos,A=i.dragOffset;if(h&&A)return[h[0]+A[0],h[1]+A[1]];var v=n.viewport.project([r,s]),C=po(v,2),S=C[0],L=C[1];return S+=o,L+=l,[S,L]}function R2(e){var t=Mit(e),i=t.state,n=t.containerRef,r=e.children,s=e.className,o=e.draggable,l=e.style,h=i.dragPos,A=Oit(t),v=po(A,2),C=v[0],S=v[1],L="translate(".concat(mg(C),"px, ").concat(mg(S),"px)"),N=o?h?"grabbing":"grab":"auto",G=Ie.useMemo(function(){var j=Pit({position:"absolute",left:0,top:0,transform:L,cursor:N},l);return Ie.createElement("div",{className:"mapboxgl-marker ".concat(s),ref:t.containerRef,style:j},r)},[r,s]),W=n.current;return W&&(W.style.transform=L,W.style.cursor=N),G}R2.defaultProps=Dit,R2.propTypes=Rit,Ie.memo(R2);var yg={top:{x:.5,y:0},"top-left":{x:0,y:0},"top-right":{x:1,y:0},bottom:{x:.5,y:1},"bottom-left":{x:0,y:1},"bottom-right":{x:1,y:1},left:{x:0,y:.5},right:{x:1,y:.5}},Lit=Object.keys(yg);function Fit(e){var t=e.x,i=e.y,n=e.width,r=e.height,s=e.selfWidth,o=e.selfHeight,l=e.anchor,h=e.padding,A=h===void 0?0:h,v=yg[l],C=v.x,S=v.y,L=i-S*o,N=L+o,G=Math.max(0,A-L)+Math.max(0,N-r+A);if(G>0){var W=S,j=G;for(S=0;S<=1;S+=.5)L=i-S*o,N=L+o,G=Math.max(0,A-L)+Math.max(0,N-r+A),G<j&&(j=G,W=S);S=W}var q=.5;S===.5&&(C=Math.floor(C),q=1);var Z=t-C*s,K=Z+s,ft=Math.max(0,A-Z)+Math.max(0,K-n+A);if(ft>0){var rt=C,Lt=ft;for(C=0;C<=1;C+=q)Z=t-C*s,K=Z+s,ft=Math.max(0,A-Z)+Math.max(0,K-n+A),ft<Lt&&(Lt=ft,rt=C);C=rt}return Lit.find(function(Vt){var At=yg[Vt];return At.x===C&&At.y===S})||l}var kit=Object.assign({},xl,{className:ge.string,longitude:ge.number.isRequired,latitude:ge.number.isRequired,altitude:ge.number,offsetLeft:ge.number,offsetTop:ge.number,tipSize:ge.number,closeButton:ge.bool,closeOnClick:ge.bool,anchor:ge.oneOf(Object.keys(yg)),dynamicPosition:ge.bool,sortByDepth:ge.bool,onClose:ge.func}),Nit=Object.assign({},oh,{className:"",altitude:0,offsetLeft:0,offsetTop:0,tipSize:10,anchor:"bottom",dynamicPosition:!0,sortByDepth:!1,closeButton:!0,closeOnClick:!0,onClose:function(){}});function Uit(e,t,i,n){var r=po(n,2),s=r[0],o=r[1],l=e.anchor,h=e.dynamicPosition,A=e.tipSize;return i&&h?Fit({x:s,y:o,anchor:l,padding:A,width:t.width,height:t.height,selfWidth:i.clientWidth,selfHeight:i.clientHeight}):l}function Git(e,t,i,n,r){var s=po(n,3),o=s[0],l=s[1],h=s[2],A=e.offsetLeft,v=e.offsetTop,C=e.sortByDepth,S=yg[r],L=o+A,N=l+v,G=NR(i,-S.x*100),W=NR(i,-S.y*100,"y"),j={position:"absolute",transform:`
      translate(`.concat(G,"%, ").concat(W,`%)
      translate(`).concat(mg(L),"px, ").concat(mg(N),`px)
    `),display:void 0,zIndex:void 0};return C&&(h>1||h<-1||o<0||o>t.width||l<0||l>t.height?j.display="none":j.zIndex=Math.floor((1-h)/2*1e5)),j}function D2(e){var t=Ie.useRef(null),i=sh(e),n=i.context,r=i.containerRef,s=Ie.useState(!1),o=po(s,2),l=o[1];Ie.useEffect(function(){l(!0)},[t.current]),Ie.useEffect(function(){if(n.eventManager&&e.closeOnClick){var K=function(){return i.props.onClose()};return n.eventManager.on("anyclick",K),function(){n.eventManager.off("anyclick",K)}}},[n.eventManager,e.closeOnClick]);var h=n.viewport,A=e.className,v=e.longitude,C=e.latitude,S=e.altitude,L=e.tipSize,N=e.closeButton,G=e.children,W=h.project([v,C,S]),j=Uit(e,h,t.current,W),q=Git(e,h,r.current,W,j),Z=Ie.useCallback(function(K){i.props.onClose();var ft=i.context.eventManager;ft&&ft.once("click",function(rt){return rt.stopPropagation()},K.target)},[]);return Ie.createElement("div",{className:"mapboxgl-popup mapboxgl-popup-anchor-".concat(j," ").concat(A),style:q,ref:r},Ie.createElement("div",{key:"tip",className:"mapboxgl-popup-tip",style:{borderWidth:L}}),Ie.createElement("div",{key:"content",ref:t,className:"mapboxgl-popup-content"},N&&Ie.createElement("button",{key:"close-button",className:"mapboxgl-popup-close-button",type:"button",onClick:Z},"\xD7"),G))}D2.propTypes=kit,D2.defaultProps=Nit,Ie.memo(D2);function GR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function zit(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?GR(Object(i),!0).forEach(function(n){wi(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):GR(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var Vit=Object.assign({},xl,{toggleLabel:ge.string,className:ge.string,style:ge.object,compact:ge.bool,customAttribution:ge.oneOfType([ge.string,ge.arrayOf(ge.string)])}),jit=Object.assign({},oh,{className:"",toggleLabel:"Toggle Attribution"});function Hit(e,t,i,n){var r=new uc.AttributionControl(e);return r._map=t,r._container=i,r._innerContainer=n,r._updateAttributions(),r._updateEditLink(),t.on("styledata",r._updateData),t.on("sourcedata",r._updateData),r}function Wit(e){e._map.off("styledata",e._updateData),e._map.off("sourcedata",e._updateData)}function O2(e){var t=sh(e),i=t.context,n=t.containerRef,r=Ie.useRef(null),s=Ie.useState(!1),o=po(s,2),l=o[0],h=o[1];Ie.useEffect(function(){var S;return i.map&&(S=Hit({customAttribution:e.customAttribution},i.map,n.current,r.current)),function(){return S&&Wit(S)}},[i.map]);var A=e.compact===void 0?i.viewport.width<=640:e.compact;Ie.useEffect(function(){!A&&l&&h(!1)},[A]);var v=Ie.useCallback(function(){return h(function(S){return!S})},[]),C=Ie.useMemo(function(){return zit({position:"absolute"},e.style)},[e.style]);return Ie.createElement("div",{style:C,className:e.className},Ie.createElement("div",{ref:n,"aria-pressed":l,className:"mapboxgl-ctrl mapboxgl-ctrl-attrib ".concat(A?"mapboxgl-compact":""," ").concat(l?"mapboxgl-compact-show":"")},Ie.createElement("button",{type:"button",className:"mapboxgl-ctrl-attrib-button",title:e.toggleLabel,onClick:v}),Ie.createElement("div",{ref:r,className:"mapboxgl-ctrl-attrib-inner",role:"list"})))}O2.propTypes=Vit,O2.defaultProps=jit,Ie.memo(O2);function zR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function Jit(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?zR(Object(i),!0).forEach(function(n){wi(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):zR(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var Xit=Object.assign({},xl,{className:ge.string,style:ge.object,container:ge.object,label:ge.string}),Kit=Object.assign({},oh,{className:"",container:null,label:"Toggle fullscreen"});function L2(e){var t=sh(e),i=t.context,n=t.containerRef,r=Ie.useState(!1),s=po(r,2),o=s[0],l=s[1],h=Ie.useState(!1),A=po(h,2),v=A[0],C=A[1],S=Ie.useState(null),L=po(S,2),N=L[0],G=L[1];Ie.useEffect(function(){var ft=new uc.FullscreenControl;G(ft),C(ft._checkFullscreenSupport());var rt=function(){var Lt=!ft._fullscreen;ft._fullscreen=Lt,l(Lt)};return qc.addEventListener(ft._fullscreenchange,rt),function(){qc.removeEventListener(ft._fullscreenchange,rt)}},[]);var W=function(){N&&(N._container=e.container||i.container,N._onClickFullscreen())},j=Ie.useMemo(function(){return Jit({position:"absolute"},e.style)},[e.style]);if(!v)return null;var q=e.className,Z=e.label,K=o?"shrink":"fullscreen";return Ie.createElement("div",{style:j,className:q},Ie.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:n},Ie.createElement("button",{key:K,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(K),type:"button",title:Z,onClick:W},Ie.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}L2.propTypes=Xit,L2.defaultProps=Kit,Ie.memo(L2);var ap;function Qit(){return ap!==void 0?Promise.resolve(ap):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(function(e){return ap=e.state!=="denied",ap}):(ap=!!window.navigator.geolocation,Promise.resolve(ap))}function VR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function Zit(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?VR(Object(i),!0).forEach(function(n){wi(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):VR(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var jR=function(){},Yit=Object.assign({},xl,{className:ge.string,style:ge.object,label:ge.string,disabledLabel:ge.string,auto:ge.bool,positionOptions:ge.object,fitBoundsOptions:ge.object,trackUserLocation:ge.bool,showUserLocation:ge.bool,showAccuracyCircle:ge.bool,showUserHeading:ge.bool,onViewStateChange:ge.func,onViewportChange:ge.func,onGeolocate:ge.func}),qit=Object.assign({},oh,{className:"",label:"Find My Location",disabledLabel:"Location Not Available",auto:!1,positionOptions:{enableHighAccuracy:!1,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0,showUserHeading:!1,showAccuracyCircle:!0,onGeolocate:function(){}});function $it(e){var t=new uc.LngLat(e.coords.longitude,e.coords.latitude),i=e.coords.accuracy,n=t.toBounds(i);return[[n._ne.lng,n._ne.lat],[n._sw.lng,n._sw.lat]]}function tnt(e,t,i){var n=new uc.GeolocateControl(t);n._container=qc.createElement("div"),n._map={on:function(){},_getUIString:function(){return""}},n._setupUI(!0),n._map=e.map,n._geolocateButton=i;var r=e.eventManager;return n.options.trackUserLocation&&r&&r.on("panstart",function(){n._watchState==="ACTIVE_LOCK"&&(n._watchState="BACKGROUND",i.classList.add("mapboxgl-ctrl-geolocate-background"),i.classList.remove("mapboxgl-ctrl-geolocate-active"))}),n.on("geolocate",t.onGeolocate),n}function ent(e,t){var i=t.context,n=t.props,r=$it(e),s=i.viewport.fitBounds(r,n.fitBoundsOptions),o=s.longitude,l=s.latitude,h=s.zoom,A=Object.assign({},i.viewport,{longitude:o,latitude:l,zoom:h}),v=new rp(A),C=Object.assign({},v.getViewportProps(),tu),S=n.onViewportChange||i.onViewportChange||jR,L=n.onViewStateChange||i.onViewStateChange||jR;L({viewState:C}),S(C)}function F2(e){var t=sh(e),i=t.context,n=t.containerRef,r=Ie.useRef(null),s=Ie.useState(null),o=po(s,2),l=o[0],h=o[1],A=Ie.useState(!1),v=po(A,2),C=v[0],S=v[1];Ie.useEffect(function(){var Z;return i.map&&Qit().then(function(K){S(K),r.current&&(Z=tnt(i,e,r.current),Z._updateCamera=function(ft){return ent(ft,t)},h(Z))}),function(){Z&&Z._clearWatch()}},[i.map]);var L=Ie.useCallback(function(){l&&(l.options=t.props,l.trigger())},[l]);Ie.useEffect(function(){e.auto&&L()},[l,e.auto]),Ie.useEffect(function(){l&&l._onZoom()},[i.viewport.zoom]);var N=e.className,G=e.label,W=e.disabledLabel,j=e.trackUserLocation,q=Ie.useMemo(function(){return Zit({position:"absolute"},e.style)},[e.style]);return Ie.createElement("div",{style:q,className:N},Ie.createElement("div",{key:"geolocate-control",className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:n},Ie.createElement("button",{key:"geolocate",className:"mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate",ref:r,disabled:!C,"aria-pressed":!j,type:"button",title:C?G:W,"aria-label":C?G:W,onClick:L},Ie.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}F2.propTypes=Yit,F2.defaultProps=qit,Ie.memo(F2);function int(e,t){for(var i=(e||"").split(".").map(Number),n=t.split(".").map(Number),r=0;r<3;r++){var s=i[r]||0,o=n[r]||0;if(s<o)return-1;if(s>o)return 1}return 0}function HR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function nnt(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?HR(Object(i),!0).forEach(function(n){wi(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):HR(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var WR=function(){},rnt=Object.assign({},xl,{className:ge.string,style:ge.object,onViewStateChange:ge.func,onViewportChange:ge.func,showCompass:ge.bool,showZoom:ge.bool,zoomInLabel:ge.string,zoomOutLabel:ge.string,compassLabel:ge.string}),ont=Object.assign({},oh,{className:"",showCompass:!0,showZoom:!0,zoomInLabel:"Zoom In",zoomOutLabel:"Zoom Out",compassLabel:"Reset North"}),snt=1,k2=2;function ant(e){return int(e,"1.6.0")>=0?k2:snt}function N2(e,t,i){var n=e.viewport,r=new rp(Object.assign({},n,i)),s=Object.assign({},r.getViewportProps(),tu),o=t.onViewportChange||e.onViewportChange||WR,l=t.onViewStateChange||e.onViewStateChange||WR;l({viewState:s}),o(s)}function U2(e,t,i,n){return Ie.createElement("button",{key:e,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(e),type:"button",title:t,onClick:i},n||Ie.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))}function lnt(e){var t=Ie.useMemo(function(){return e.map?ant(e.map.version):k2},[e.map]),i=e.viewport.bearing,n={transform:"rotate(".concat(-i,"deg)")};return t===k2?Ie.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true",style:n}):Ie.createElement("span",{className:"mapboxgl-ctrl-compass-arrow",style:n})}function G2(e){var t=sh(e),i=t.context,n=t.containerRef,r=function(){N2(i,e,{zoom:i.viewport.zoom+1})},s=function(){N2(i,e,{zoom:i.viewport.zoom-1})},o=function(){N2(i,e,{bearing:0,pitch:0})},l=e.className,h=e.showCompass,A=e.showZoom,v=e.zoomInLabel,C=e.zoomOutLabel,S=e.compassLabel,L=Ie.useMemo(function(){return nnt({position:"absolute"},e.style)},[e.style]);return Ie.createElement("div",{style:L,className:l},Ie.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:n},A&&U2("zoom-in",v,r),A&&U2("zoom-out",C,s),h&&U2("compass",S,o,lnt(i))))}G2.propTypes=rnt,G2.defaultProps=ont;const cnt=Ie.memo(G2);function JR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function unt(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?JR(Object(i),!0).forEach(function(n){wi(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):JR(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var hnt=Object.assign({},xl,{className:ge.string,style:ge.object,maxWidth:ge.number,unit:ge.oneOf(["imperial","metric","nautical"])}),fnt=Object.assign({},oh,{className:"",maxWidth:100,unit:"metric"});function z2(e){var t=sh(e),i=t.context,n=t.containerRef,r=Ie.useState(null),s=po(r,2),o=s[0],l=s[1];Ie.useEffect(function(){if(i.map){var A=new uc.ScaleControl;A._map=i.map,A._container=n.current,l(A)}},[i.map]),o&&(o.options=e,o._onMove&&o._onMove());var h=Ie.useMemo(function(){return unt({position:"absolute"},e.style)},[e.style]);return Ie.createElement("div",{style:h,className:e.className},Ie.createElement("div",{ref:n,className:"mapboxgl-ctrl mapboxgl-ctrl-scale"}))}z2.propTypes=hnt,z2.defaultProps=fnt,Ie.memo(z2),Object.assign({},xl,{redraw:ge.func.isRequired}),Object.assign({},xl,{redraw:ge.func.isRequired,style:ge.object}),Object.assign({},xl,{redraw:ge.func.isRequired,style:ge.object}),uc&&uc.setRTLTextPlugin;const XR=100;class dnt{constructor(t,i){if(z(this,"schema"),z(this,"options"),z(this,"shape"),z(this,"length",0),z(this,"rows",null),z(this,"cursor",0),z(this,"_headers",[]),this.options=i,this.schema=t,!Array.isArray(t)){this._headers=[];for(const n in t)this._headers[t[n].index]=t[n].name}}rowCount(){return this.length}addArrayRow(t,i){Number.isFinite(i)&&(this.cursor=i),this.shape="array-row-table",this.rows=this.rows||new Array(XR),this.rows[this.length]=t,this.length++}addObjectRow(t,i){Number.isFinite(i)&&(this.cursor=i),this.shape="object-row-table",this.rows=this.rows||new Array(XR),this.rows[this.length]=t,this.length++}getBatch(){let t=this.rows;return t?(t=t.slice(0,this.length),this.rows=null,{shape:this.shape||"array-row-table",batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}):null}}function KR(e,t){if(!e)throw new Error("null row");const i={};if(t)for(let n=0;n<t.length;n++)i[t[n]]=e[n];else for(let n=0;n<e.length;n++){const r=`column-${n}`;i[r]=e[n]}return i}function QR(e,t){if(!e)throw new Error("null row");if(t){const i=new Array(t.length);for(let n=0;n<t.length;n++)i[n]=e[t[n]];return i}return Object.values(e)}function pnt(e){const t=[];for(let i=0;i<e.length;i++){const n=`column-${i}`;t.push(n)}return t}function Ant(e){return Object.keys(e)}const ZR=100;class gnt{constructor(t,i){if(z(this,"schema"),z(this,"options"),z(this,"length",0),z(this,"objectRows",null),z(this,"arrayRows",null),z(this,"cursor",0),z(this,"_headers",null),this.options=i,this.schema=t,t){this._headers=[];for(const n in t)this._headers[t[n].index]=t[n].name}}rowCount(){return this.length}addArrayRow(t,i){switch(Number.isFinite(i)&&(this.cursor=i),this._headers||(this._headers=pnt(t)),this.options.shape){case"object-row-table":const n=KR(t,this._headers);this.addObjectRow(n,i);break;case"array-row-table":this.arrayRows=this.arrayRows||new Array(ZR),this.arrayRows[this.length]=t,this.length++;break}}addObjectRow(t,i){switch(Number.isFinite(i)&&(this.cursor=i),this._headers||(this._headers=Ant(t)),this.options.shape){case"array-row-table":const n=QR(t,this._headers);this.addArrayRow(n,i);break;case"object-row-table":this.objectRows=this.objectRows||new Array(ZR),this.objectRows[this.length]=t,this.length++;break}}getBatch(){let t=this.arrayRows||this.objectRows;return t?(t=t.slice(0,this.length),this.arrayRows=null,this.objectRows=null,{shape:this.options.shape,batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}):null}}const mnt=100;class ynt{constructor(t,i){z(this,"schema"),z(this,"length",0),z(this,"allocated",0),z(this,"columns",{}),this.schema=t,this._reallocateColumns()}rowCount(){return this.length}addArrayRow(t){this._reallocateColumns();let i=0;for(const n in this.columns)this.columns[n][this.length]=t[i++];this.length++}addObjectRow(t){this._reallocateColumns();for(const i in t)this.columns[i][this.length]=t[i];this.length++}getBatch(){this._pruneColumns();const t=Array.isArray(this.schema)?this.columns:{};if(!Array.isArray(this.schema))for(const i in this.schema){const n=this.schema[i];t[n.name]=this.columns[n.index]}return this.columns={},{shape:"columnar-table",batchType:"data",data:t,schema:this.schema,length:this.length}}_reallocateColumns(){if(!(this.length<this.allocated)){this.allocated=this.allocated>0?this.allocated*=2:mnt,this.columns={};for(const t in this.schema){const i=this.schema[t],n=i.type||Float32Array,r=this.columns[i.index];if(r&&ArrayBuffer.isView(r)){const s=new n(this.allocated);s.set(r),this.columns[i.index]=s}else r?(r.length=this.allocated,this.columns[i.index]=r):this.columns[i.index]=new n(this.allocated)}}}_pruneColumns(){for(const[t,i]of Object.entries(this.columns))this.columns[t]=i.slice(0,this.length)}}const _nt={shape:void 0,batchSize:"auto",batchDebounceMs:0,limit:0,_limitMB:0},vnt="TableBatchBuilder",YR=class VE{constructor(t,i){z(this,"schema"),z(this,"options"),z(this,"aggregator",null),z(this,"batchCount",0),z(this,"bytesUsed",0),z(this,"isChunkComplete",!1),z(this,"lastBatchEmittedMs",Date.now()),z(this,"totalLength",0),z(this,"totalBytes",0),z(this,"rowBytes",0),this.schema=t,this.options={..._nt,...i}}limitReached(){var t,i;return!!((t=this.options)!=null&&t.limit&&this.totalLength>=this.options.limit||(i=this.options)!=null&&i._limitMB&&this.totalBytes/1e6>=this.options._limitMB)}addRow(t){this.limitReached()||(this.totalLength++,this.rowBytes=this.rowBytes||this._estimateRowMB(t),this.totalBytes+=this.rowBytes,Array.isArray(t)?this.addArrayRow(t):this.addObjectRow(t))}addArrayRow(t){if(!this.aggregator){const i=this._getTableBatchType();this.aggregator=new i(this.schema,this.options)}this.aggregator.addArrayRow(t)}addObjectRow(t){if(!this.aggregator){const i=this._getTableBatchType();this.aggregator=new i(this.schema,this.options)}this.aggregator.addObjectRow(t)}chunkComplete(t){t instanceof ArrayBuffer&&(this.bytesUsed+=t.byteLength),typeof t=="string"&&(this.bytesUsed+=t.length),this.isChunkComplete=!0}getFullBatch(t){return this._isFull()?this._getBatch(t):null}getFinalBatch(t){return this._getBatch(t)}_estimateRowMB(t){return Array.isArray(t)?t.length*8:Object.keys(t).length*8}_isFull(){if(!this.aggregator||this.aggregator.rowCount()===0)return!1;if(this.options.batchSize==="auto"){if(!this.isChunkComplete)return!1}else if(this.options.batchSize>this.aggregator.rowCount())return!1;return this.options.batchDebounceMs>Date.now()-this.lastBatchEmittedMs?!1:(this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),!0)}_getBatch(t){if(!this.aggregator)return null;t!=null&&t.bytesUsed&&(this.bytesUsed=t.bytesUsed);const i=this.aggregator.getBatch();return i.count=this.batchCount,i.bytesUsed=this.bytesUsed,Object.assign(i,t),this.batchCount++,this.aggregator=null,i}_getTableBatchType(){switch(this.options.shape){case"array-row-table":case"object-row-table":return gnt;case"columnar-table":return ynt;case"arrow-table":if(!VE.ArrowBatch)throw new Error(vnt);return VE.ArrowBatch;default:return dnt}}};z(YR,"ArrowBatch");let bnt=YR;class qR extends Array{enqueue(t){return this.push(t)}dequeue(){return this.shift()}}class xnt{constructor(){z(this,"_values"),z(this,"_settlers"),z(this,"_closed"),this._values=new qR,this._settlers=new qR,this._closed=!1}close(){for(;this._settlers.length>0;)this._settlers.dequeue().resolve({done:!0});this._closed=!0}[Symbol.asyncIterator](){return this}enqueue(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");const i=this._settlers.dequeue();t instanceof Error?i.reject(t):i.resolve({value:t})}else this._values.enqueue(t)}next(){if(this._values.length>0){const t=this._values.dequeue();return t instanceof Error?Promise.reject(t):Promise.resolve({value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0})}return new Promise((t,i)=>{this._settlers.enqueue({resolve:t,reject:i})})}}/* @license
Papa Parse
v5.0.0-beta.0
https://github.com/mholt/PapaParse
License: MIT
*/const $R="\uFEFF";function wnt(e,t={},i=Ent){t=t||{};var n=t.dynamicTyping||!1;wl(n)&&(t.dynamicTypingFunction=n,n={}),t.dynamicTyping=n,t.transform=wl(t.transform)?t.transform:!1;var r=new i(t);return r.stream(e)}function Cnt(e,t){var i=!1,n=!0,r=",",s=`\r
`,o='"',l=o+o,h=!1,A=null;C();var v=new RegExp(_g(o),"g");if(typeof e=="string"&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return S(null,e,h);if(typeof e[0]=="object")return S(A||Object.keys(e[0]),e,h)}else if(typeof e=="object")return typeof e.data=="string"&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:Object.keys(e.data[0])),!Array.isArray(e.data[0])&&typeof e.data[0]!="object"&&(e.data=[e.data])),S(e.fields||[],e.data||[],h);throw new Error("Unable to serialize unrecognized input");function C(){if(typeof t=="object"){if(typeof t.delimiter=="string"&&!Na.BAD_DELIMITERS.filter(function(G){return t.delimiter.indexOf(G)!==-1}).length&&(r=t.delimiter),(typeof t.quotes=="boolean"||Array.isArray(t.quotes))&&(i=t.quotes),(typeof t.skipEmptyLines=="boolean"||typeof t.skipEmptyLines=="string")&&(h=t.skipEmptyLines),typeof t.newline=="string"&&(s=t.newline),typeof t.quoteChar=="string"&&(o=t.quoteChar),typeof t.header=="boolean"&&(n=t.header),Array.isArray(t.columns)){if(t.columns.length===0)throw new Error("Option columns is empty");A=t.columns}t.escapeChar!==void 0&&(l=t.escapeChar+o)}}function S(G,W,j){var q="";typeof G=="string"&&(G=JSON.parse(G)),typeof W=="string"&&(W=JSON.parse(W));var Z=Array.isArray(G)&&G.length>0,K=!Array.isArray(W[0]);if(Z&&n){for(var ft=0;ft<G.length;ft++)ft>0&&(q+=r),q+=L(G[ft],ft);W.length>0&&(q+=s)}for(var rt=0;rt<W.length;rt++){var Lt=Z?G.length:W[rt].length,Vt=!1,At=Z?Object.keys(W[rt]).length===0:W[rt].length===0;if(j&&!Z&&(Vt=j==="greedy"?W[rt].join("").trim()==="":W[rt].length===1&&W[rt][0].length===0),j==="greedy"&&Z){for(var at=[],kt=0;kt<Lt;kt++){var X=K?G[kt]:kt;at.push(W[rt][X])}Vt=at.join("").trim()===""}if(!Vt){for(var ht=0;ht<Lt;ht++){ht>0&&!At&&(q+=r);var Mt=Z&&K?G[ht]:ht;q+=L(W[rt][Mt],ht)}rt<W.length-1&&(!j||Lt>0&&!At)&&(q+=s)}}return q}function L(G,W){if(typeof G>"u"||G===null)return"";if(G.constructor===Date)return JSON.stringify(G).slice(1,25);G=G.toString().replace(v,l);var j=typeof i=="boolean"&&i||Array.isArray(i)&&i[W]||N(G,Na.BAD_DELIMITERS)||G.indexOf(r)>-1||G.charAt(0)===" "||G.charAt(G.length-1)===" ";return j?o+G+o:G}function N(G,W){for(var j=0;j<W.length;j++)if(G.indexOf(W[j])>-1)return!0;return!1}}let t6=class{constructor(e){z(this,"_handle"),z(this,"_config"),z(this,"_finished",!1),z(this,"_completed",!1),z(this,"_input",null),z(this,"_baseIndex",0),z(this,"_partialLine",""),z(this,"_rowCount",0),z(this,"_start",0),z(this,"isFirstChunk",!0),z(this,"_completeResults",{data:[],errors:[],meta:{}});var t={...e};t.chunkSize=parseInt(t.chunkSize),!e.step&&!e.chunk&&(t.chunkSize=null),this._handle=new e6(t),this._handle.streamer=this,this._config=t}parseChunk(e,t){if(this.isFirstChunk&&wl(this._config.beforeFirstChunk)){var i=this._config.beforeFirstChunk(e);i!==void 0&&(e=i)}this.isFirstChunk=!1;var n=this._partialLine+e;this._partialLine="";var r=this._handle.parse(n,this._baseIndex,!this._finished);if(!(this._handle.paused()||this._handle.aborted())){var s=r.meta.cursor;this._finished||(this._partialLine=n.substring(s-this._baseIndex),this._baseIndex=s),r&&r.data&&(this._rowCount+=r.data.length);var o=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(wl(this._config.chunk)&&!t){if(this._config.chunk(r,this._handle),this._handle.paused()||this._handle.aborted())return;r=void 0,this._completeResults=void 0}return!this._config.step&&!this._config.chunk&&(this._completeResults.data=this._completeResults.data.concat(r.data),this._completeResults.errors=this._completeResults.errors.concat(r.errors),this._completeResults.meta=r.meta),!this._completed&&o&&wl(this._config.complete)&&(!r||!r.meta.aborted)&&(this._config.complete(this._completeResults,this._input),this._completed=!0),r}}_sendError(e){wl(this._config.error)&&this._config.error(e)}};class Ent extends t6{constructor(t={}){super(t),z(this,"remaining")}stream(t){return this.remaining=t,this._nextChunk()}_nextChunk(){if(!this._finished){var t=this._config.chunkSize,i=t?this.remaining.substr(0,t):this.remaining;return this.remaining=t?this.remaining.substr(t):"",this._finished=!this.remaining,this.parseChunk(i)}}}const Bnt=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,Tnt=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/;class e6{constructor(t){if(z(this,"_config"),z(this,"_stepCounter",0),z(this,"_rowCounter",0),z(this,"_input"),z(this,"_parser"),z(this,"_paused",!1),z(this,"_aborted",!1),z(this,"_delimiterError",!1),z(this,"_fields",[]),z(this,"_results",{data:[],errors:[],meta:{}}),wl(t.step)){var i=t.step;t.step=n=>{if(this._results=n,this.needsHeaderRow())this.processResults();else{if(this.processResults(),!this._results.data||this._results.data.length===0)return;this._stepCounter+=n.data.length,t.preview&&this._stepCounter>t.preview?this._parser.abort():i(this._results,this)}}}this._config=t}parse(t,i,n){var r=this._config.quoteChar||'"';if(this._config.newline||(this._config.newline=Snt(t,r)),this._delimiterError=!1,this._config.delimiter)wl(this._config.delimiter)&&(this._config.delimiter=this._config.delimiter(t),this._results.meta.delimiter=this._config.delimiter);else{var s=this.guessDelimiter(t,this._config.newline,this._config.skipEmptyLines,this._config.comments,this._config.delimitersToGuess);s.successful?this._config.delimiter=s.bestDelimiter:(this._delimiterError=!0,this._config.delimiter=Na.DefaultDelimiter),this._results.meta.delimiter=this._config.delimiter}var o=i6(this._config);return this._config.preview&&this._config.header&&o.preview++,this._input=t,this._parser=new V2(o),this._results=this._parser.parse(this._input,i,n),this.processResults(),this._paused?{meta:{paused:!0}}:this._results||{meta:{paused:!1}}}paused(){return this._paused}pause(){this._paused=!0,this._parser.abort(),this._input=this._input.substr(this._parser.getCharIndex())}resume(){this._paused=!1,this.streamer.parseChunk(this._input,!0)}aborted(){return this._aborted}abort(){this._aborted=!0,this._parser.abort(),this._results.meta.aborted=!0,wl(this._config.complete)&&this._config.complete(this._results),this._input=""}testEmptyLine(t){return this._config.skipEmptyLines==="greedy"?t.join("").trim()==="":t.length===1&&t[0].length===0}processResults(){if(this._results&&this._delimiterError&&(this.addError("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+Na.DefaultDelimiter+"'"),this._delimiterError=!1),this._config.skipEmptyLines)for(var t=0;t<this._results.data.length;t++)this.testEmptyLine(this._results.data[t])&&this._results.data.splice(t--,1);return this.needsHeaderRow()&&this.fillHeaderFields(),this.applyHeaderAndDynamicTypingAndTransformation()}needsHeaderRow(){return this._config.header&&this._fields.length===0}fillHeaderFields(){if(!this._results)return;const t=n=>{wl(this._config.transformHeader)&&(n=this._config.transformHeader(n)),this._fields.push(n)};if(Array.isArray(this._results.data[0])){for(var i=0;this.needsHeaderRow()&&i<this._results.data.length;i++)this._results.data[i].forEach(t);this._results.data.splice(0,1)}else this._results.data.forEach(t)}shouldApplyDynamicTyping(t){return this._config.dynamicTypingFunction&&this._config.dynamicTyping[t]===void 0&&(this._config.dynamicTyping[t]=this._config.dynamicTypingFunction(t)),(this._config.dynamicTyping[t]||this._config.dynamicTyping)===!0}parseDynamic(t,i){return this.shouldApplyDynamicTyping(t)?i==="true"||i==="TRUE"?!0:i==="false"||i==="FALSE"?!1:Bnt.test(i)?parseFloat(i):Tnt.test(i)?new Date(i):i===""?null:i:i}applyHeaderAndDynamicTypingAndTransformation(){if(!this._results||!this._results.data||!this._config.header&&!this._config.dynamicTyping&&!this._config.transform)return this._results;var t=1;return!this._results.data[0]||Array.isArray(this._results.data[0])?(this._results.data=this._results.data.map(this.processRow.bind(this)),t=this._results.data.length):this._results.data=this.processRow(this._results.data,0),this._config.header&&this._results.meta&&(this._results.meta.fields=this._fields),this._rowCounter+=t,this._results}processRow(t,i){var n=this._config.header?{}:[],r;for(r=0;r<t.length;r++){var s=r,o=t[r];this._config.header&&(s=r>=this._fields.length?"__parsed_extra":this._fields[r]),this._config.transform&&(o=this._config.transform(o,s)),o=this.parseDynamic(s,o),s==="__parsed_extra"?(n[s]=n[s]||[],n[s].push(o)):n[s]=o}return this._config.header&&(r>this._fields.length?this.addError("FieldMismatch","TooManyFields","Too many fields: expected "+this._fields.length+" fields but parsed "+r,this._rowCounter+i):r<this._fields.length&&this.addError("FieldMismatch","TooFewFields","Too few fields: expected "+this._fields.length+" fields but parsed "+r,this._rowCounter+i)),n}guessDelimiter(t,i,n,r,s){var o,l,h;s=s||[",","	","|",";",Na.RECORD_SEP,Na.UNIT_SEP];for(var A=0;A<s.length;A++){var v=s[A],C=0,S=0,L=0;h=void 0;for(var N=new V2({comments:r,delimiter:v,newline:i,preview:10}).parse(t),G=0;G<N.data.length;G++){if(n&&this.testEmptyLine(N.data[G])){L++;continue}var W=N.data[G].length;if(S+=W,typeof h>"u"){h=0;continue}else W>1&&(C+=Math.abs(W-h),h=W)}N.data.length>0&&(S/=N.data.length-L),(typeof l>"u"||C>l)&&S>1.99&&(l=C,o=v)}return this._config.delimiter=o,{successful:!!o,bestDelimiter:o}}addError(t,i,n,r){this._results.errors.push({type:t,code:i,message:n,row:r})}}function Snt(e,t){e=e.substr(0,1024*1024);var i=new RegExp(_g(t)+"([^]*?)"+_g(t),"gm");e=e.replace(i,"");var n=e.split("\r"),r=e.split(`
`),s=r.length>1&&r[0].length<n[0].length;if(n.length===1||s)return`
`;for(var o=0,l=0;l<n.length;l++)n[l][0]===`
`&&o++;return o>=n.length/2?`\r
`:"\r"}function _g(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function V2(e){e=e||{};var t=e.delimiter,i=e.newline,n=e.comments,r=e.step,s=e.preview,o=e.fastMode,l;e.quoteChar===void 0?l='"':l=e.quoteChar;var h=l;if(e.escapeChar!==void 0&&(h=e.escapeChar),(typeof t!="string"||Na.BAD_DELIMITERS.indexOf(t)>-1)&&(t=","),n===t)throw new Error("Comment character same as delimiter");n===!0?n="#":(typeof n!="string"||Na.BAD_DELIMITERS.indexOf(n)>-1)&&(n=!1),i!==`
`&&i!=="\r"&&i!==`\r
`&&(i=`
`);var A=0,v=!1;this.parse=function(C,S,L){if(typeof C!="string")throw new Error("Input must be a string");var N=C.length,G=t.length,W=i.length,j=n.length,q=wl(r);A=0;var Z=[],K=[],ft=[],rt=0;if(!C)return ae();if(o||o!==!1&&C.indexOf(l)===-1){for(var Lt=C.split(i),Vt=0;Vt<Lt.length;Vt++){const Pe=Lt[Vt];if(A+=Pe.length,Vt!==Lt.length-1)A+=i.length;else if(L)return ae();if(!(n&&Pe.substr(0,j)===n)){if(q){if(Z=[],Dt(Pe.split(t)),he(),v)return ae()}else Dt(Pe.split(t));if(s&&Vt>=s)return Z=Z.slice(0,s),ae(!0)}}return ae()}for(var At=C.indexOf(t,A),at=C.indexOf(i,A),kt=new RegExp(_g(h)+_g(l),"g"),X;;){if(C[A]===l){for(X=A,A++;;){if(X=C.indexOf(l,X+1),X===-1)return L||K.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:Z.length,index:A}),te();if(X===N-1){var ht=C.substring(A,X).replace(kt,l);return te(ht)}if(l===h&&C[X+1]===h){X++;continue}if(!(l!==h&&X!==0&&C[X-1]===h)){var Mt=at===-1?At:Math.min(At,at),pe=Gt(Mt);if(C[X+1+pe]===t){if(ft.push(C.substring(A,X).replace(kt,l)),A=X+1+pe+G,At=C.indexOf(t,A),at=C.indexOf(i,A),q&&(he(),v))return ae();if(s&&Z.length>=s)return ae(!0);break}var Ct=Gt(at);if(C.substr(X+1+Ct,W)===i){if(ft.push(C.substring(A,X).replace(kt,l)),re(X+1+Ct+W),At=C.indexOf(t,A),q&&(he(),v))return ae();if(s&&Z.length>=s)return ae(!0);break}K.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:Z.length,index:A}),X++}}if(q&&(he(),v))return ae();if(s&&Z.length>=s)return ae(!0);continue}if(n&&ft.length===0&&C.substr(A,j)===n){if(at===-1)return ae();A=at+W,at=C.indexOf(i,A),At=C.indexOf(t,A);continue}if(At!==-1&&(At<at||at===-1)){ft.push(C.substring(A,At)),A=At+G,At=C.indexOf(t,A);continue}if(at!==-1){if(ft.push(C.substring(A,at)),re(at+W),q&&(he(),v))return ae();if(s&&Z.length>=s)return ae(!0);continue}break}return te();function Dt(Pe){Z.push(Pe),rt=A}function Gt(Pe){var Se=0;if(Pe!==-1){var se=C.substring(X+1,Pe);se&&se.trim()===""&&(Se=se.length)}return Se}function te(Pe){return L||(typeof Pe>"u"&&(Pe=C.substr(A)),ft.push(Pe),A=N,Dt(ft),q&&he()),ae()}function re(Pe){A=Pe,Dt(ft),ft=[],at=C.indexOf(i,A)}function ae(Pe,Se){var se=Se||!1;return{data:se?Z[0]:Z,errors:K,meta:{delimiter:t,linebreak:i,aborted:v,truncated:!!Pe,cursor:rt+(S||0)}}}function he(){r(ae(void 0,!0)),Z=[],K=[]}},this.abort=function(){v=!0},this.getCharIndex=function(){return A}}function i6(e){if(typeof e!="object"||e===null)return e;var t=Array.isArray(e)?[]:{};for(var i in e)t[i]=i6(e[i]);return t}function wl(e){return typeof e=="function"}const Na={parse:wnt,unparse:Cnt,RECORD_SEP:"",UNIT_SEP:"",BYTE_ORDER_MARK:$R,BAD_DELIMITERS:["\r",`
`,'"',$R],WORKERS_SUPPORTED:!1,NODE_STREAM_INPUT:1,LocalChunkSize:1024*1024*10,RemoteChunkSize:1024*1024*5,DefaultDelimiter:",",Parser:V2,ParserHandle:e6,ChunkStreamer:t6},{ChunkStreamer:Int}=Na;class Mnt extends Int{constructor(t={}){super(t),z(this,"textDecoder",new TextDecoder(this._config.encoding))}async stream(t){this._input=t;try{for await(const i of t)this.parseChunk(this.getStringChunk(i));this._finished=!0,this.parseChunk("")}catch(i){this._sendError(i)}}_nextChunk(){}getStringChunk(t){return typeof t=="string"?t:this.textDecoder.decode(t,{stream:!0})}}const Pnt="4.3.2",j2="object-row-table",H2={dataType:null,batchType:null,id:"csv",module:"csv",name:"CSV",version:Pnt,extensions:["csv","tsv","dsv"],mimeTypes:["text/csv","text/tab-separated-values","text/dsv"],category:"table",parse:async(e,t)=>n6(new TextDecoder().decode(e),t),parseText:(e,t)=>n6(e,t),parseInBatches:Rnt,options:{csv:{shape:j2,optimizeMemoryUsage:!1,header:"auto",columnPrefix:"column",quoteChar:'"',escapeChar:'"',dynamicTyping:!0,comments:!1,skipEmptyLines:!0,delimitersToGuess:[",","	","|",";"]}}};async function n6(e,t){const i={...H2.options.csv,...t==null?void 0:t.csv},n=Dnt(e),r=i.header==="auto"?r6(n):!!i.header,s={...i,header:r,download:!1,transformHeader:r?o6():void 0,error:v=>{throw new Error(v)}},o=Na.parse(e,s),l=o.data,h=o.meta.fields||s6(i.columnPrefix,n.length),A=i.shape||j2;switch(A){case"object-row-table":return{shape:"object-row-table",data:l.map(v=>Array.isArray(v)?KR(v,h):v)};case"array-row-table":return{shape:"array-row-table",data:l.map(v=>Array.isArray(v)?v:QR(v,h))};default:throw new Error(A)}}function Rnt(e,t){t={...t},t.batchSize==="auto"&&(t.batchSize=4e3);const i={...H2.options.csv,...t==null?void 0:t.csv},n=new xnt;let r=!0,s=null,o=null,l=null;const h={...i,header:!1,download:!1,chunkSize:1024*1024*5,skipEmptyLines:!1,step(A){let v=A.data;if(i.skipEmptyLines&&v.flat().join("").trim()==="")return;const C=A.meta.cursor;if(r&&!s&&(i.header==="auto"?r6(v):i.header)){s=v.map(o6());return}r&&(r=!1,s||(s=s6(i.columnPrefix,v.length)),l=Ont(v,s)),i.optimizeMemoryUsage&&(v=JSON.parse(JSON.stringify(v)));const S=i.shape||j2;o=o||new bnt(l,{shape:S,...t});try{o.addRow(v);const L=o&&o.getFullBatch({bytesUsed:C});L&&n.enqueue(L)}catch(L){n.enqueue(L)}},complete(A){try{const v=A.meta.cursor,C=o&&o.getFinalBatch({bytesUsed:v});C&&n.enqueue(C)}catch(v){n.enqueue(v)}n.close()}};return Na.parse(e,h,Mnt),n}function r6(e){return e&&e.every(t=>typeof t=="string")}function Dnt(e){return Na.parse(e,{dynamicTyping:!0,preview:1}).data[0]}function o6(){const e=new Set;return t=>{let i=t,n=1;for(;e.has(i);)i=`${t}.${n}`,n++;return e.add(i),i}}function s6(e,t=0){const i=[];for(let n=0;n<t;n++)i.push(`${e}${n+1}`);return i}function Ont(e,t){const i=t?{}:[];for(let n=0;n<e.length;n++){const r=t&&t[n]||n;switch(typeof e[n]){case"number":case"boolean":i[r]={name:String(r),index:n,type:Float32Array};break;case"string":default:i[r]={name:String(r),index:n,type:Array}}}return i}const Lnt="4.3.2";async function a6(e,t,i,n){return n._parse(e,t,i,n)}function hf(e,t){if(!e)throw new Error("loader assertion failed.")}const l6=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),c6=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);c6&&parseFloat(c6[1]);const W2=globalThis,gy=globalThis.process||{};function Fnt(e){var t,i;if(typeof window<"u"&&((t=window.process)==null?void 0:t.type)==="renderer"||typeof process<"u"&&(i=process.versions)!=null&&i.electron)return!0;const n=typeof navigator<"u"&&navigator.userAgent;return!!(n&&n.indexOf("Electron")>=0)}function J2(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||Fnt()}const u6="4.0.7";function knt(e){try{const t=window[e],i="__storage_test__";return t.setItem(i,i),t.removeItem(i),t}catch{return null}}class Nnt{constructor(t,i,n="sessionStorage"){this.storage=knt(n),this.id=t,this.config=i,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const i=JSON.stringify(this.config);this.storage.setItem(this.id,i)}}_loadConfiguration(){let t={};if(this.storage){const i=this.storage.getItem(this.id);t=i?JSON.parse(i):{}}return Object.assign(this.config,t),this}}function Unt(e){let t;return e<10?t=`${e.toFixed(2)}ms`:e<100?t=`${e.toFixed(1)}ms`:e<1e3?t=`${e.toFixed(0)}ms`:t=`${(e/1e3).toFixed(2)}s`,t}function Gnt(e,t=8){const i=Math.max(t-e.length,0);return`${" ".repeat(i)}${e}`}var my;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(my||(my={}));const znt=10;function h6(e){return typeof e!="string"?e:(e=e.toUpperCase(),my[e]||my.WHITE)}function Vnt(e,t,i){return!J2&&typeof e=="string"&&(t&&(e=`\x1B[${h6(t)}m${e}\x1B[39m`),i&&(e=`\x1B[${h6(i)+znt}m${e}\x1B[49m`)),e}function jnt(e,t=["constructor"]){const i=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(i),r=e;for(const s of n){const o=r[s];typeof o=="function"&&(t.find(l=>s===l)||(r[s]=o.bind(e)))}}function X2(e,t){if(!e)throw new Error("Assertion failed")}function lp(){var e,t,i;let n;if(J2()&&W2.performance)n=(t=(e=W2==null?void 0:W2.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in gy){const r=(i=gy==null?void 0:gy.hrtime)==null?void 0:i.call(gy);n=r[0]*1e3+r[1]/1e6}else n=Date.now();return n}const cp={debug:J2()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Hnt={enabled:!0,level:0};function up(){}const f6={},d6={once:!0};class yy{constructor({id:t}={id:""}){this.VERSION=u6,this._startTs=lp(),this._deltaTs=lp(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new Nnt(`__probe-${this.id}__`,Hnt),this.timeStamp(`${this.id} started`),jnt(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((lp()-this._startTs).toPrecision(10))}getDelta(){return Number((lp()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,i){this._storage.setConfiguration({[t]:i})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,i){if(!t)throw new Error(i||"Assertion failed")}warn(t){return this._getLogFunction(0,t,cp.warn,arguments,d6)}error(t){return this._getLogFunction(0,t,cp.error,arguments)}deprecated(t,i){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${i}\` instead`)}removed(t,i){return this.error(`\`${t}\` has been removed. Use \`${i}\` instead`)}probe(t,i){return this._getLogFunction(t,i,cp.log,arguments,{time:!0,once:!0})}log(t,i){return this._getLogFunction(t,i,cp.debug,arguments)}info(t,i){return this._getLogFunction(t,i,console.info,arguments)}once(t,i){return this._getLogFunction(t,i,cp.debug||cp.info,arguments,d6)}table(t,i,n){return i?this._getLogFunction(t,i,console.table||up,n&&[n],{tag:Jnt(i)}):up}time(t,i){return this._getLogFunction(t,i,console.time?console.time:console.info)}timeEnd(t,i){return this._getLogFunction(t,i,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,i){return this._getLogFunction(t,i,console.timeStamp||up)}group(t,i,n={collapsed:!1}){const r=A6({logLevel:t,message:i,opts:n}),{collapsed:s}=n;return r.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(t,i,n={}){return this.group(t,i,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||up)}withGroup(t,i,n){this.group(t,i)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=p6(t)}_getLogFunction(t,i,n,r,s){if(this._shouldLog(t)){s=A6({logLevel:t,message:i,args:r,opts:s}),n=n||s.method,X2(n),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=lp();const o=s.tag||s.message;if(s.once&&o)if(!f6[o])f6[o]=lp();else return up;return i=Wnt(this.id,s.message,s),n.bind(console,i,...s.args)}return up}}yy.VERSION=u6;function p6(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return X2(Number.isFinite(t)&&t>=0),t}function A6(e){const{logLevel:t,message:i}=e;e.logLevel=p6(t);const n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==i;);switch(typeof t){case"string":case"function":i!==void 0&&n.unshift(i),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const r=typeof e.message;return X2(r==="string"||r==="object"),Object.assign(e,{args:n},e.opts)}function Wnt(e,t,i){if(typeof t=="string"){const n=i.time?Gnt(Unt(i.total)):"";t=i.time?`${e}: ${n}  ${t}`:`${e}: ${t}`,t=Vnt(t,i.color,i.background)}return t}function Jnt(e){for(const t in e)for(const i in e[t])return i||"untitled";return"empty"}globalThis.probe={};const g6=new yy({id:"@probe.gl/log"});function Xnt(e){var t;globalThis.loaders||(globalThis.loaders={}),(t=globalThis.loaders).modules||(t.modules={}),Object.assign(globalThis.loaders.modules,e)}function Knt(e){var t,i;return((i=(t=globalThis.loaders)==null?void 0:t.modules)==null?void 0:i[e])||null}function Qnt(){var e;return(e=globalThis._loadersgl_)!=null&&e.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const Znt=Qnt();function Ynt(e,t){if(!e)throw new Error("loaders.gl assertion failed.")}const vg=typeof process!="object"||String(process)!=="[object process]"||process.browser,K2=typeof importScripts=="function",m6=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);m6&&parseFloat(m6[1]);const Q2={};async function ff(e,t=null,i={},n=null){return t&&(e=qnt(e,t,i,n)),Q2[e]=Q2[e]||$nt(e),await Q2[e]}function qnt(e,t,i={},n=null){if(!i.useLocalLibraries&&e.startsWith("http"))return e;n=n||e;const r=i.modules||{};return r[n]?r[n]:vg?i.CDN?(Ynt(i.CDN.startsWith("http")),`${i.CDN}/${t}@${Znt}/dist/libs/${n}`):K2?`../src/libs/${n}`:`modules/${t}/src/libs/${n}`:`modules/${t}/dist/libs/${n}`}async function $nt(e){if(e.endsWith("wasm"))return await ert(e);if(!vg)try{const{requireFromFile:i}=globalThis.loaders||{};return await(i==null?void 0:i(e))}catch(i){return console.error(i),null}if(K2)return importScripts(e);const t=await irt(e);return trt(t,e)}function trt(e,t){if(!vg){const{requireFromString:n}=globalThis.loaders||{};return n==null?void 0:n(e,t)}if(K2)return eval.call(globalThis,e),null;const i=document.createElement("script");i.id=t;try{i.appendChild(document.createTextNode(e))}catch{i.text=e}return document.body.appendChild(i),null}async function ert(e){const{readFileAsArrayBuffer:t}=globalThis.loaders||{};return vg||!t||e.startsWith("http")?await(await fetch(e)).arrayBuffer():await t(e)}async function irt(e){const{readFileAsText:t}=globalThis.loaders||{};return vg||!t||e.startsWith("http")?await(await fetch(e)).text():await t(e)}function nrt(e,t=5){return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?y6(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?y6(e,0,t):""}function y6(e,t,i){if(e.byteLength<=t+i)return"";const n=new DataView(e);let r="";for(let s=0;s<i;s++)r+=String.fromCharCode(n.getUint8(t+s));return r}function rrt(e){try{return JSON.parse(e)}catch{throw new Error(`Failed to parse JSON from data starting with "${nrt(e)}"`)}}function _6(e,t,i){const n=i!==void 0?new Uint8Array(e).subarray(t,t+i):new Uint8Array(e).subarray(t);return new Uint8Array(n).buffer}function bg(e,t){return hf(e>=0),hf(t>0),e+(t-1)&-4}function ort(e,t,i){let n;if(e instanceof ArrayBuffer)n=new Uint8Array(e);else{const r=e.byteOffset,s=e.byteLength;n=new Uint8Array(e.buffer||e.arrayBuffer,r,s)}return t.set(n,i),i+bg(n.byteLength,4)}function v6(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}class b6{constructor(t,i){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=i,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=v6(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(v6()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class x6{constructor(t){this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t,i="count"){return this._getOrCreate({name:t,type:i})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const i of Object.values(this.stats))t(i)}getTable(){const t={};return this.forEach(i=>{t[i.name]={time:i.time||0,count:i.count||0,average:i.getAverageTime()||0,hz:i.getHz()||0}}),t}_initializeStats(t=[]){t.forEach(i=>this._getOrCreate(i))}_getOrCreate(t){const{name:i,type:n}=t;let r=this.stats[i];return r||(t instanceof b6?r=t:r=new b6(i,n),this.stats[i]=r),r}}var w6;const srt=(w6=globalThis.loaders)==null?void 0:w6.parseImageNode,Z2=typeof Image<"u",Y2=typeof ImageBitmap<"u",art=!!srt,q2=l6?!0:art;function lrt(e){switch(e){case"auto":return Y2||Z2||q2;case"imagebitmap":return Y2;case"image":return Z2;case"data":return q2;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}function crt(){if(Y2)return"imagebitmap";if(Z2)return"image";if(q2)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function urt(e){const t=hrt(e);if(!t)throw new Error("Not an image");return t}function C6(e){switch(urt(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),i=t.getContext("2d");if(!i)throw new Error("getImageData");return t.width=e.width,t.height=e.height,i.drawImage(e,0,0),i.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function hrt(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&e instanceof Image?"image":e&&typeof e=="object"&&e.data&&e.width&&e.height?"data":null}const frt=/^data:image\/svg\+xml/,drt=/\.svg((\?|#).*)?$/;function $2(e){return e&&(frt.test(e)||drt.test(e))}function prt(e,t){if($2(t)){let i=new TextDecoder().decode(e);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(n){throw new Error(n.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return E6(e,t)}function E6(e,t){if($2(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function B6(e,t,i){const n=prt(e,i),r=self.URL||self.webkitURL,s=typeof n!="string"&&r.createObjectURL(n);try{return await Art(s||n,t)}finally{s&&r.revokeObjectURL(s)}}async function Art(e,t){const i=new Image;return i.src=e,t.image&&t.image.decode&&i.decode?(await i.decode(),i):await new Promise((n,r)=>{try{i.onload=()=>n(i),i.onerror=s=>{const o=s instanceof Error?s.message:"error";r(new Error(o))}}catch(s){r(s)}})}const grt={};let T6=!0;async function mrt(e,t,i){let n;$2(i)?n=await B6(e,t,i):n=E6(e,i);const r=t&&t.imagebitmap;return await yrt(n,r)}async function yrt(e,t=null){if((_rt(t)||!T6)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(i){console.warn(i),T6=!1}return await createImageBitmap(e)}function _rt(e){for(const t in e||grt)return!1;return!0}function vrt(e){return!Crt(e,"ftyp",4)||(e[8]&96)===0?null:brt(e)}function brt(e){switch(xrt(e,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function xrt(e,t,i){return String.fromCharCode(...e.slice(t,i))}function wrt(e){return[...e].map(t=>t.charCodeAt(0))}function Crt(e,t,i=0){const n=wrt(t);for(let r=0;r<n.length;++r)if(n[r]!==e[r+i])return!1;return!0}const fc=!1,xg=!0;function tx(e){const t=wg(e);return Brt(t)||Irt(t)||Trt(t)||Srt(t)||Ert(t)}function Ert(e){const t=new Uint8Array(e instanceof DataView?e.buffer:e),i=vrt(t);return i?{mimeType:i.mimeType,width:0,height:0}:null}function Brt(e){const t=wg(e);return t.byteLength>=24&&t.getUint32(0,fc)===2303741511?{mimeType:"image/png",width:t.getUint32(16,fc),height:t.getUint32(20,fc)}:null}function Trt(e){const t=wg(e);return t.byteLength>=10&&t.getUint32(0,fc)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,xg),height:t.getUint16(8,xg)}:null}function Srt(e){const t=wg(e);return t.byteLength>=14&&t.getUint16(0,fc)===16973&&t.getUint32(2,xg)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,xg),height:t.getUint32(22,xg)}:null}function Irt(e){const t=wg(e);if(!(t.byteLength>=3&&t.getUint16(0,fc)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:n}=Mrt();let r=2;for(;r+9<t.byteLength;){const s=t.getUint16(r,fc);if(n.has(s))return{mimeType:"image/jpeg",height:t.getUint16(r+5,fc),width:t.getUint16(r+7,fc)};if(!i.has(s))return null;r+=2,r+=t.getUint16(r,fc)}return null}function Mrt(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function wg(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}async function Prt(e,t){var i;const{mimeType:n}=tx(e)||{},r=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return hf(r),await r(e,n)}async function Rrt(e,t,i){t=t||{};const n=(t.image||{}).type||"auto",{url:r}=i||{},s=Drt(n);let o;switch(s){case"imagebitmap":o=await mrt(e,t,r);break;case"image":o=await B6(e,t,r);break;case"data":o=await Prt(e);break;default:hf(!1)}return n==="data"&&(o=C6(o)),o}function Drt(e){switch(e){case"auto":case"data":return crt();default:return lrt(e),e}}const Ort=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],Lrt=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Frt={image:{type:"auto",decode:!0}},krt={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:Lnt,mimeTypes:Lrt,extensions:Ort,parse:Rrt,tests:[e=>!!tx(new DataView(e))],options:Frt},ex={};function Nrt(e){if(ex[e]===void 0){const t=l6?Grt(e):Urt(e);ex[e]=t}return ex[e]}function Urt(e){var t,i;const n=["image/png","image/jpeg","image/gif"],r=((t=globalThis.loaders)==null?void 0:t.imageFormatsNode)||n;return!!((i=globalThis.loaders)!=null&&i.parseImageNode)&&r.includes(e)}function Grt(e){switch(e){case"image/avif":case"image/webp":return zrt(e);default:return!0}}function zrt(e){try{return document.createElement("canvas").toDataURL(e).indexOf(`data:${e}`)===0}catch{return!1}}function Ua(e,t){if(!e)throw new Error(t||"assert failed: gltf")}const S6={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},I6={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},M6=["SCALAR","VEC2","VEC3","VEC4"],Vrt=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],jrt=new Map(Vrt),Hrt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Wrt={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Jrt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function P6(e){return M6[e-1]||M6[0]}function _y(e){const t=jrt.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function R6(e,t){const i=Jrt[e.componentType],n=Hrt[e.type],r=Wrt[e.componentType],s=e.count*n,o=e.count*n*r;Ua(o>=0&&o<=t.byteLength);const l=I6[e.componentType],h=S6[e.type];return{ArrayType:i,length:s,byteLength:o,componentByteSize:l,numberOfComponentsInElement:h}}function Xrt(e,t,i){const n=e.bufferViews[i];Ua(n);const r=n.buffer,s=t[r];Ua(s);const o=(n.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,o,n.byteLength)}function Krt(e,t,i){var n,r;const s=typeof i=="number"?(n=e.accessors)==null?void 0:n[i]:i;if(!s)throw new Error(`No gltf accessor ${JSON.stringify(i)}`);const o=(r=e.bufferViews)==null?void 0:r[s.bufferView||0];if(!o)throw new Error(`No gltf buffer view for accessor ${o}`);const{arrayBuffer:l,byteOffset:h}=t[o.buffer],A=(h||0)+(s.byteOffset||0)+(o.byteOffset||0),{ArrayType:v,length:C,componentByteSize:S,numberOfComponentsInElement:L}=R6(s,o),N=S*L,G=o.byteStride||N;if(typeof o.byteStride>"u"||o.byteStride===N)return new v(l,A,C);const W=new v(C);for(let j=0;j<s.count;j++){const q=new v(l,A+j*G,L);W.set(q,j*L)}return W}function Qrt(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}let zo=class{constructor(e){z(this,"gltf"),z(this,"sourceBuffers"),z(this,"byteLength"),this.gltf={json:(e==null?void 0:e.json)||Qrt(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find(n=>n===e),i=this.getRequiredExtensions().find(n=>n===e);return typeof t=="string"||typeof i=="string"}getExtension(e){const t=this.getUsedExtensions().find(n=>n===e),i=this.json.extensions||{};return t?i[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(t=>t===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const i=this.json[e]&&this.json[e][t];if(!i)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return i}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,i=this.gltf.buffers[t];Ua(i);const n=(e.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,n,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return Krt(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,n=t.byteOffset||0;return new Uint8Array(i,n,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,i){return e.extensions=e.extensions||{},e.extensions[t]=i,this.registerUsedExtension(t),this}setObjectExtension(e,t,i){const n=e.extensions||{};n[t]=i}removeObjectExtension(e,t){const i=(e==null?void 0:e.extensions)||{};if(i[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(t)||n.push(t)}delete i[t]}addExtension(e,t={}){return Ua(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return Ua(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var t;if((t=this.json.extensions)!=null&&t[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(e)||i.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:i}=e;this.json.nodes=this.json.nodes||[];const n={mesh:t};return i&&(n.matrix=i),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:i,material:n,mode:r=4}=e,s={primitives:[{attributes:this._addAttributes(t),mode:r}]};if(i){const o=this._addIndices(i);s.primitives[0].indices=o}return Number.isFinite(n)&&(s.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addPointCloud(e){const t={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(t),this.json.meshes.length-1}addImage(e,t){const i=tx(e),n=t||(i==null?void 0:i.mimeType),r={bufferView:this.addBufferView(e),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(r),this.json.images.length-1}addBufferView(e,t=0,i=this.byteLength){const n=e.byteLength;Ua(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const r={buffer:t,byteOffset:i,byteLength:n};return this.byteLength+=bg(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(e,t){const i={bufferView:e,type:P6(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const i=this.addBufferView(e);let n={min:t.min,max:t.max};(!n.min||!n.max)&&(n=this._getAccessorMinMax(e,t.size));const r={size:t.size,componentType:_y(e),count:Math.round(e.length/t.size),min:n.min,max:n.max};return this.addAccessor(i,Object.assign(r,t))}addTexture(e){const{imageIndex:t}=e,i={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,t;const i=this.byteLength,n=new ArrayBuffer(i),r=new Uint8Array(n);let s=0;for(const o of this.sourceBuffers||[])s=ort(o,r,s);(t=(e=this.json)==null?void 0:e.buffers)!=null&&t[0]?this.json.buffers[0].byteLength=i:this.json.buffers=[{byteLength:i}],this.gltf.binary=n,this.sourceBuffers=[n],this.gltf.buffers=[{arrayBuffer:n,byteOffset:0,byteLength:n.byteLength}]}_removeStringFromArray(e,t){let i=!0;for(;i;){const n=e.indexOf(t);n>-1?e.splice(n,1):i=!1}}_addAttributes(e={}){const t={};for(const i in e){const n=e[i],r=this._getGltfAttributeName(i),s=this.addBinaryBuffer(n.value,n);t[r]=s}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const i={min:null,max:null};if(e.length<t)return i;i.min=[],i.max=[];const n=e.subarray(0,t);for(const r of n)i.min.push(r),i.max.push(r);for(let r=t;r<e.length;r+=t)for(let s=0;s<t;s++)i.min[0+s]=Math.min(i.min[0+s],e[r+s]),i.max[0+s]=Math.max(i.max[0+s],e[r+s]);return i}};function D6(e){return(e%1+1)%1}const O6={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},Zrt={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},L6={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function ix(e,t){return L6[t]*O6[e]}function vy(e,t,i,n){if(i!=="UINT8"&&i!=="UINT16"&&i!=="UINT32"&&i!=="UINT64")return null;const r=e.getTypedArrayForBufferView(t),s=by(r,"SCALAR",i,n+1);return s instanceof BigInt64Array||s instanceof BigUint64Array?null:s}function by(e,t,i,n=1){const r=O6[t],s=Zrt[i],o=L6[i],l=n*r,h=l*o;let A=e.buffer,v=e.byteOffset;return v%o!==0&&(A=new Uint8Array(A).slice(v,v+h).buffer,v=0),new s(A,v,l)}function nx(e,t,i){var n,r,s,o,l;const h=`TEXCOORD_${t.texCoord||0}`,A=i.attributes[h],v=e.getTypedArrayForAccessor(A),C=e.gltf.json,S=t.index,L=(r=(n=C.textures)==null?void 0:n[S])==null?void 0:r.source;if(typeof L<"u"){const N=(o=(s=C.images)==null?void 0:s[L])==null?void 0:o.mimeType,G=(l=e.gltf.images)==null?void 0:l[L];if(G&&typeof G.width<"u"){const W=[];for(let j=0;j<v.length;j+=2){const q=Yrt(G,N,v,j,t.channels);W.push(q)}return W}}return[]}function F6(e,t,i,n,r){if(!(i!=null&&i.length))return;const s=[];for(const v of i){let C=n.findIndex(S=>S===v);C===-1&&(C=n.push(v)-1),s.push(C)}const o=new Uint32Array(s),l=e.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,h=e.addBufferView(o,l,0),A=e.addAccessor(h,{size:1,componentType:_y(o),count:o.length});r.attributes[t]=A}function Yrt(e,t,i,n,r=[0]){const s={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=i[n],l=i[n+1];let h=1;t&&(t.indexOf("image/jpeg")!==-1||t.indexOf("image/png")!==-1)&&(h=4);const A=qrt(o,l,e,h);let v=0;for(const C of r){const S=typeof C=="number"?Object.values(s)[C]:s[C],L=A+S.offset,N=C6(e);if(N.data.length<=L)throw new Error(`${N.data.length} <= ${L}`);const G=N.data[L];v|=G<<S.shift}return v}function qrt(e,t,i,n=1){const r=i.width,s=D6(e)*(r-1),o=Math.round(s),l=i.height,h=D6(t)*(l-1),A=Math.round(h),v=i.components?i.components:n;return(A*r+o)*v}function k6(e,t,i,n,r){const s=[];for(let o=0;o<t;o++){const l=i[o],h=i[o+1]-i[o];if(h+l>n)break;const A=l/r,v=h/r;s.push(e.slice(A,A+v))}return s}function N6(e,t,i){const n=[];for(let r=0;r<t;r++){const s=r*i;n.push(e.slice(s,s+i))}return n}function U6(e,t,i,n){if(i)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const r=[],s=new TextDecoder("utf8");let o=0;for(let l=0;l<e;l++){const h=n[l+1]-n[l];if(h+o<=t.length){const A=t.subarray(o,h+o),v=s.decode(A);r.push(v),o+=h}}return r}return[]}const hp="EXT_mesh_features",$rt=hp;async function tot(e,t){const i=new zo(e);iot(i,t)}function eot(e,t){const i=new zo(e);return rot(i),i.createBinaryChunk(),i.gltf}function iot(e,t){const i=e.gltf.json;if(i.meshes)for(const n of i.meshes)for(const r of n.primitives)not(e,r,t)}function not(e,t,i){var n,r,s;if(!((n=i==null?void 0:i.gltf)!=null&&n.loadBuffers))return;const o=(r=t.extensions)==null?void 0:r[hp],l=o==null?void 0:o.featureIds;if(l)for(const h of l){let A;if(typeof h.attribute<"u"){const v=`_FEATURE_ID_${h.attribute}`,C=t.attributes[v];A=e.getTypedArrayForAccessor(C)}else typeof h.texture<"u"&&(s=i==null?void 0:i.gltf)!=null&&s.loadImages?A=nx(e,h.texture,t):A=[];h.data=A}}function rot(e,t){const i=e.gltf.json.meshes;if(i)for(const n of i)for(const r of n.primitives)sot(e,r)}function oot(e,t,i,n){t.extensions||(t.extensions={});let r=t.extensions[hp];r||(r={featureIds:[]},t.extensions[hp]=r);const{featureIds:s}=r,o={featureCount:i.length,propertyTable:n,data:i};s.push(o),e.addObjectExtension(t,hp,r)}function sot(e,t){var i;const n=(i=t.extensions)==null?void 0:i[hp];if(!n)return;const r=n.featureIds;r.forEach((s,o)=>{if(s.data){const{accessorKey:l,index:h}=aot(t.attributes),A=new Uint32Array(s.data);r[o]={featureCount:A.length,propertyTable:s.propertyTable,attribute:h},e.gltf.buffers.push({arrayBuffer:A.buffer,byteOffset:A.byteOffset,byteLength:A.byteLength});const v=e.addBufferView(A),C=e.addAccessor(v,{size:1,componentType:_y(A),count:A.length});t.attributes[l]=C}})}function aot(e){const t="_FEATURE_ID_",i=Object.keys(e).filter(r=>r.indexOf(t)===0);let n=-1;for(const r of i){const s=Number(r.substring(t.length));s>n&&(n=s)}return n++,{accessorKey:`${t}${n}`,index:n}}const lot=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:oot,decode:tot,encode:eot,name:$rt},Symbol.toStringTag,{value:"Module"})),fp="EXT_structural_metadata",cot=fp;async function uot(e,t){const i=new zo(e);fot(i,t)}function hot(e,t){const i=new zo(e);return Sot(i),i.createBinaryChunk(),i.gltf}function fot(e,t){var i,n;if(!((i=t.gltf)!=null&&i.loadBuffers))return;const r=e.getExtension(fp);r&&((n=t.gltf)!=null&&n.loadImages&&dot(e,r),pot(e,r))}function dot(e,t){const i=t.propertyTextures,n=e.gltf.json;if(i&&n.meshes)for(const r of n.meshes)for(const s of r.primitives)got(e,i,s,t)}function pot(e,t){const i=t.schema;if(!i)return;const n=i.classes,r=t.propertyTables;if(n&&r)for(const s in n){const o=Aot(r,s);o&&yot(e,i,o)}}function Aot(e,t){for(const i of e)if(i.class===t)return i;return null}function got(e,t,i,n){var r;if(!t)return;const s=(r=i.extensions)==null?void 0:r[fp],o=s==null?void 0:s.propertyTextures;if(o)for(const l of o){const h=t[l];mot(e,h,i,n)}}function mot(e,t,i,n){var r;if(!t.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const s=t.class;for(const o in t.properties){const l=`${s}_${o}`,h=(r=t.properties)==null?void 0:r[o];if(!h)continue;h.data||(h.data=[]);const A=h.data,v=nx(e,h,i);v!==null&&(F6(e,l,v,A,i),h.data=A,n.dataAttributeNames.push(l))}}function yot(e,t,i){var n,r;const s=(n=t.classes)==null?void 0:n[i.class];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);const o=i.count;for(const l in s.properties){const h=s.properties[l],A=(r=i.properties)==null?void 0:r[l];if(A){const v=_ot(e,t,h,o,A);A.data=v}}}function _ot(e,t,i,n,r){let s=[];const o=r.values,l=e.getTypedArrayForBufferView(o),h=vot(e,i,r,n),A=bot(e,r,n);switch(i.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{s=xot(i,n,l,h);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${i.type}`);case"STRING":{s=U6(n,l,h,A);break}case"ENUM":{s=wot(t,i,n,l,h);break}default:throw new Error(`Unknown classProperty type ${i.type}`)}return s}function vot(e,t,i,n){return t.array&&typeof t.count>"u"&&typeof i.arrayOffsets<"u"?vy(e,i.arrayOffsets,i.arrayOffsetType||"UINT32",n):null}function bot(e,t,i){return typeof t.stringOffsets<"u"?vy(e,t.stringOffsets,t.stringOffsetType||"UINT32",i):null}function xot(e,t,i,n){const r=e.array,s=e.count,o=ix(e.type,e.componentType),l=i.byteLength/o;let h;return e.componentType?h=by(i,e.type,e.componentType,l):h=i,r?n?k6(h,t,n,i.length,o):s?N6(h,t,s):[]:h}function wot(e,t,i,n,r){var s;const o=t.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const l=(s=e.enums)==null?void 0:s[o];if(!l)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const h=l.valueType||"UINT16",A=ix(t.type,h),v=n.byteLength/A;let C=by(n,t.type,h,v);if(C||(C=n),t.array){if(r)return Cot({valuesData:C,numberOfElements:i,arrayOffsets:r,valuesDataBytesLength:n.length,elementSize:A,enumEntry:l});const S=t.count;return S?Eot(C,i,S,l):[]}return rx(C,0,i,l)}function Cot(e){const{valuesData:t,numberOfElements:i,arrayOffsets:n,valuesDataBytesLength:r,elementSize:s,enumEntry:o}=e,l=[];for(let h=0;h<i;h++){const A=n[h],v=n[h+1]-n[h];if(v+A>r)break;const C=A/s,S=v/s,L=rx(t,C,S,o);l.push(L)}return l}function Eot(e,t,i,n){const r=[];for(let s=0;s<t;s++){const o=i*s,l=rx(e,o,i,n);r.push(l)}return r}function rx(e,t,i,n){const r=[];for(let s=0;s<i;s++)if(e instanceof BigInt64Array||e instanceof BigUint64Array)r.push("");else{const o=e[t+s],l=Bot(n,o);l?r.push(l.name):r.push("")}return r}function Bot(e,t){for(const i of e.values)if(i.value===t)return i;return null}const Tot="schemaClassId";function Sot(e,t){var i,n;const r=e.getExtension(fp);if(r&&r.propertyTables)for(const s of r.propertyTables){const o=s.class,l=(n=(i=r.schema)==null?void 0:i.classes)==null?void 0:n[o];s.properties&&l&&Iot(s,l,e)}}function Iot(e,t,i){for(const n in e.properties){const r=e.properties[n].data;if(r){const s=t.properties[n];if(s){const o=Dot(r,s,i);e.properties[n]=o}}}}function Mot(e,t,i=Tot){let n=e.getExtension(fp);n||(n=e.addExtension(fp)),n.schema=Pot(t,i,n.schema);const r=Rot(t,i,n.schema);return n.propertyTables||(n.propertyTables=[]),n.propertyTables.push(r)-1}function Pot(e,t,i){const n=i??{id:"schema_id"},r={properties:{}};for(const s of e){const o={type:s.elementType,componentType:s.componentType};r.properties[s.name]=o}return n.classes={},n.classes[t]=r,n}function Rot(e,t,i){var n;const r={class:t,count:0};let s=0;const o=(n=i.classes)==null?void 0:n[t];for(const l of e){if(s===0&&(s=l.values.length),s!==l.values.length&&l.values.length)throw new Error("Illegal values in attributes");o!=null&&o.properties[l.name]&&(r.properties||(r.properties={}),r.properties[l.name]={values:0,data:l.values})}return r.count=s,r}function Dot(e,t,i){const n={values:0};if(t.type==="STRING"){const{stringData:r,stringOffsets:s}=Fot(e);n.stringOffsets=ox(s,i),n.values=ox(r,i)}else if(t.type==="SCALAR"&&t.componentType){const r=Lot(e,t.componentType);n.values=ox(r,i)}return n}const Oot={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function Lot(e,t){const i=[];for(const r of e)i.push(Number(r));const n=Oot[t];if(!n)throw new Error("Illegal component type");return new n(i)}function Fot(e){const t=new TextEncoder,i=[];let n=0;for(const h of e){const A=t.encode(h);n+=A.length,i.push(A)}const r=new Uint8Array(n),s=[];let o=0;for(const h of i)r.set(h,o),s.push(o),o+=h.length;s.push(o);const l=new Uint32Array(s);return{stringData:r,stringOffsets:l}}function ox(e,t){return t.gltf.buffers.push({arrayBuffer:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength}),t.addBufferView(e)}const kot=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:Mot,decode:uot,encode:hot,name:cot},Symbol.toStringTag,{value:"Module"})),G6="EXT_feature_metadata",Not=G6;async function Uot(e,t){const i=new zo(e);Got(i,t)}function Got(e,t){var i,n;if(!((i=t.gltf)!=null&&i.loadBuffers))return;const r=e.getExtension(G6);r&&((n=t.gltf)!=null&&n.loadImages&&zot(e,r),Vot(e,r))}function zot(e,t){const i=t.schema;if(!i)return;const n=i.classes,{featureTextures:r}=t;if(n&&r)for(const s in n){const o=n[s],l=Hot(r,s);l&&Jot(e,l,o)}}function Vot(e,t){const i=t.schema;if(!i)return;const n=i.classes,r=t.featureTables;if(n&&r)for(const s in n){const o=jot(r,s);o&&Wot(e,i,o)}}function jot(e,t){for(const i in e){const n=e[i];if(n.class===t)return n}return null}function Hot(e,t){for(const i in e){const n=e[i];if(n.class===t)return n}return null}function Wot(e,t,i){var n,r;if(!i.class)return;const s=(n=t.classes)==null?void 0:n[i.class];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);const o=i.count;for(const l in s.properties){const h=s.properties[l],A=(r=i.properties)==null?void 0:r[l];if(A){const v=Xot(e,t,h,o,A);A.data=v}}}function Jot(e,t,i){var n;const r=t.class;for(const s in i.properties){const o=(n=t==null?void 0:t.properties)==null?void 0:n[s];if(o){const l=qot(e,o,r);o.data=l}}}function Xot(e,t,i,n,r){let s=[];const o=r.bufferView,l=e.getTypedArrayForBufferView(o),h=Kot(e,i,r,n),A=Qot(e,i,r,n);return i.type==="STRING"||i.componentType==="STRING"?s=U6(n,l,h,A):Zot(i)&&(s=Yot(i,n,l,h)),s}function Kot(e,t,i,n){return t.type==="ARRAY"&&typeof t.componentCount>"u"&&typeof i.arrayOffsetBufferView<"u"?vy(e,i.arrayOffsetBufferView,i.offsetType||"UINT32",n):null}function Qot(e,t,i,n){return typeof i.stringOffsetBufferView<"u"?vy(e,i.stringOffsetBufferView,i.offsetType||"UINT32",n):null}function Zot(e){const t=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return t.includes(e.type)||typeof e.componentType<"u"&&t.includes(e.componentType)}function Yot(e,t,i,n){const r=e.type==="ARRAY",s=e.componentCount,o="SCALAR",l=e.componentType||e.type,h=ix(o,l),A=i.byteLength/h,v=by(i,o,l,A);return r?n?k6(v,t,n,i.length,h):s?N6(v,t,s):[]:v}function qot(e,t,i){const n=e.gltf.json;if(!n.meshes)return[];const r=[];for(const s of n.meshes)for(const o of s.primitives)$ot(e,i,t,r,o);return r}function $ot(e,t,i,n,r){const s={channels:i.channels,...i.texture},o=nx(e,s,r);o&&F6(e,t,o,n,r)}const tst=Object.freeze(Object.defineProperty({__proto__:null,decode:Uot,name:Not},Symbol.toStringTag,{value:"Module"})),est="4.3.2",ist="4.3.2",xy={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let sx;async function z6(e){return Xnt(e.modules),Knt("basis")||(sx||(sx=nst(e)),await sx)}async function nst(e){let t=null,i=null;return[t,i]=await Promise.all([await ff(xy.TRANSCODER,"textures",e),await ff(xy.TRANSCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await rst(t,i)}function rst(e,t){const i={};return t&&(i.wasmBinary=t),new Promise(n=>{e(i).then(r=>{const{BasisFile:s,initializeBasis:o}=r;o(),n({BasisFile:s})})})}let ax;async function V6(e){const t=e.modules||{};return t.basisEncoder?t.basisEncoder:(ax=ax||ost(e),await ax)}async function ost(e){let t=null,i=null;return[t,i]=await Promise.all([await ff(xy.ENCODER,"textures",e),await ff(xy.ENCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await sst(t,i)}function sst(e,t){const i={};return t&&(i.wasmBinary=t),new Promise(n=>{e(i).then(r=>{const{BasisFile:s,KTX2File:o,initializeBasis:l,BasisEncoder:h}=r;l(),n({BasisFile:s,KTX2File:o,BasisEncoder:h})})})}const dp={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},ast=["","WEBKIT_","MOZ_"],j6={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let wy=null;function lst(e){if(!wy){e=e||cst()||void 0,wy=new Set;for(const t of ast)for(const i in j6)if(e&&e.getExtension(`${t}${i}`)){const n=j6[i];wy.add(n)}}return wy}function cst(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const ga=[171,75,84,88,32,50,48,187,13,10,26,10];function ust(e){const t=new Uint8Array(e);return!(t.byteLength<ga.length||t[0]!==ga[0]||t[1]!==ga[1]||t[2]!==ga[2]||t[3]!==ga[3]||t[4]!==ga[4]||t[5]!==ga[5]||t[6]!==ga[6]||t[7]!==ga[7]||t[8]!==ga[8]||t[9]!==ga[9]||t[10]!==ga[10]||t[11]!==ga[11])}const hst={etc1:{basisFormat:0,compressed:!0,format:dp.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:dp.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:dp.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:dp.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:dp.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:dp.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function fst(e,t){if(t.basis.containerFormat==="auto"){if(ust(e)){const n=await V6(t);return H6(n.KTX2File,e,t)}const{BasisFile:i}=await z6(t);return lx(i,e,t)}switch(t.basis.module){case"encoder":const i=await V6(t);switch(t.basis.containerFormat){case"ktx2":return H6(i.KTX2File,e,t);case"basis":default:return lx(i.BasisFile,e,t)}case"transcoder":default:const{BasisFile:n}=await z6(t);return lx(n,e,t)}}function lx(e,t,i){const n=new e(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const r=n.getNumImages(),s=[];for(let o=0;o<r;o++){const l=n.getNumLevels(o),h=[];for(let A=0;A<l;A++)h.push(dst(n,o,A,i));s.push(h)}return s}finally{n.close(),n.delete()}}function dst(e,t,i,n){const r=e.getImageWidth(t,i),s=e.getImageHeight(t,i),o=e.getHasAlpha(),{compressed:l,format:h,basisFormat:A}=W6(n,o),v=e.getImageTranscodedSizeInBytes(t,i,A),C=new Uint8Array(v);if(!e.transcodeImage(C,t,i,A,0,0))throw new Error("failed to start Basis transcoding");return{width:r,height:s,data:C,compressed:l,format:h,hasAlpha:o}}function H6(e,t,i){const n=new e(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const r=n.getLevels(),s=[];for(let o=0;o<r;o++)s.push(pst(n,o,i));return[s]}finally{n.close(),n.delete()}}function pst(e,t,i){const{alphaFlag:n,height:r,width:s}=e.getImageLevelInfo(t,0,0),{compressed:o,format:l,basisFormat:h}=W6(i,n),A=e.getImageTranscodedSizeInBytes(t,0,0,h),v=new Uint8Array(A);if(!e.transcodeImage(v,t,0,0,h,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:r,data:v,compressed:o,levelSize:A,hasAlpha:n,format:l}}function W6(e,t){let i=e&&e.basis&&e.basis.format;return i==="auto"&&(i=J6()),typeof i=="object"&&(i=t?i.alpha:i.noAlpha),i=i.toLowerCase(),hst[i]}function J6(){const e=lst();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}const Ast={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:ist,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},gst={...Ast,parse:fst},pp=!0,X6=1735152710,cx=12,Cy=8,mst=1313821514,yst=5130562,_st=0,vst=0,bst=1;function xst(e,t=0){return`${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}function wst(e,t=0,i={}){const n=new DataView(e),{magic:r=X6}=i,s=n.getUint32(t,!1);return s===r||s===X6}function Cst(e,t,i=0,n={}){const r=new DataView(t),s=xst(r,i+0),o=r.getUint32(i+4,pp),l=r.getUint32(i+8,pp);switch(Object.assign(e,{header:{byteOffset:i,byteLength:l,hasBinChunk:!1},type:s,version:o,json:{},binChunks:[]}),i+=cx,e.version){case 1:return Est(e,r,i);case 2:return Bst(e,r,i,n={});default:throw new Error(`Invalid GLB version ${e.version}. Only supports version 1 and 2.`)}}function Est(e,t,i){hf(e.header.byteLength>cx+Cy);const n=t.getUint32(i+0,pp),r=t.getUint32(i+4,pp);return i+=Cy,hf(r===_st),ux(e,t,i,n),i+=n,i+=hx(e,t,i,e.header.byteLength),i}function Bst(e,t,i,n){return hf(e.header.byteLength>cx+Cy),Tst(e,t,i,n),i+e.header.byteLength}function Tst(e,t,i,n){for(;i+8<=e.header.byteLength;){const r=t.getUint32(i+0,pp),s=t.getUint32(i+4,pp);switch(i+=Cy,s){case mst:ux(e,t,i,r);break;case yst:hx(e,t,i,r);break;case vst:n.strict||ux(e,t,i,r);break;case bst:n.strict||hx(e,t,i,r);break}i+=bg(r,4)}return i}function ux(e,t,i,n){const r=new Uint8Array(t.buffer,i,n),s=new TextDecoder("utf8").decode(r);return e.json=JSON.parse(s),bg(n,4)}function hx(e,t,i,n){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:i,byteLength:n,arrayBuffer:t.buffer}),bg(n,4)}function K6(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const i=t.baseUri||t.uri;if(!i)throw new Error(`'baseUri' must be provided to resolve relative url ${e}`);return i.substr(0,i.lastIndexOf("/")+1)+e}const Sst="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Ist="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Mst=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Pst=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Rst={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Dst={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function Ost(e,t,i,n,r,s="NONE"){const o=await Lst();Nst(o,o.exports[Dst[r]],e,t,i,n,o.exports[Rst[s||"NONE"]])}let fx;async function Lst(){return fx||(fx=Fst()),fx}async function Fst(){let e=Sst;WebAssembly.validate(Mst)&&(e=Ist,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(kst(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function kst(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;++n){const r=e.charCodeAt(n);t[n]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let i=0;for(let n=0;n<e.length;++n)t[i++]=t[n]<60?Pst[t[n]]:(t[n]-60)*64+t[++n];return t.buffer.slice(0,i)}function Nst(e,t,i,n,r,s,o){const l=e.exports.sbrk,h=n+3&-4,A=l(h*r),v=l(s.length),C=new Uint8Array(e.exports.memory.buffer);C.set(s,v);const S=t(A,n,r,v,s.length);if(S===0&&o&&o(A,h,r),i.set(C.subarray(A,A+n*r)),l(A-l(0)),S!==0)throw new Error(`Malformed buffer data: ${S}`)}const Ey="EXT_meshopt_compression",Ust=Ey;async function Gst(e,t){var i,n;const r=new zo(e);if(!((i=t==null?void 0:t.gltf)!=null&&i.decompressMeshes)||!((n=t.gltf)!=null&&n.loadBuffers))return;const s=[];for(const o of e.json.bufferViews||[])s.push(zst(r,o));await Promise.all(s),r.removeExtension(Ey)}async function zst(e,t){const i=e.getObjectExtension(t,Ey);if(i){const{byteOffset:n=0,byteLength:r=0,byteStride:s,count:o,mode:l,filter:h="NONE",buffer:A}=i,v=e.gltf.buffers[A],C=new Uint8Array(v.arrayBuffer,v.byteOffset+n,r),S=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await Ost(S,o,s,C,l,h),e.removeObjectExtension(t,Ey)}}const Vst=Object.freeze(Object.defineProperty({__proto__:null,decode:Gst,name:Ust},Symbol.toStringTag,{value:"Module"})),Ap="EXT_texture_webp",jst=Ap;function Hst(e,t){const i=new zo(e);if(!Nrt("image/webp")){if(i.getRequiredExtensions().includes(Ap))throw new Error(`gltf: Required extension ${Ap} not supported by browser`);return}const{json:n}=i;for(const r of n.textures||[]){const s=i.getObjectExtension(r,Ap);s&&(r.source=s.source),i.removeObjectExtension(r,Ap)}i.removeExtension(Ap)}const Wst=Object.freeze(Object.defineProperty({__proto__:null,name:jst,preprocess:Hst},Symbol.toStringTag,{value:"Module"})),By="KHR_texture_basisu",Jst=By;function Xst(e,t){const i=new zo(e),{json:n}=i;for(const r of n.textures||[]){const s=i.getObjectExtension(r,By);s&&(r.source=s.source,i.removeObjectExtension(r,By))}i.removeExtension(By)}const Kst=Object.freeze(Object.defineProperty({__proto__:null,name:Jst,preprocess:Xst},Symbol.toStringTag,{value:"Module"})),Qst="4.3.2",Zst={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:Qst,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function Yst(e){switch(e.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function qst(e){let t=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;const l=e.POSITION?e.POSITION.value:[],h=l&&l.length;for(let A=0;A<h;A+=3){const v=l[A],C=l[A+1],S=l[A+2];t=v<t?v:t,i=C<i?C:i,n=S<n?S:n,r=v>r?v:r,s=C>s?C:s,o=S>o?S:o}return[[t,i,n],[r,s,o]]}function $st(e,t,i){const n=Yst(t.value),r=i||tat(t);return{name:e,type:{type:"fixed-size-list",listSize:t.size,children:[{name:"value",type:n}]},nullable:!1,metadata:r}}function tat(e){const t={};return"byteOffset"in e&&(t.byteOffset=e.byteOffset.toString(10)),"byteStride"in e&&(t.byteStride=e.byteStride.toString(10)),"normalized"in e&&(t.normalized=e.normalized.toString()),t}function eat(e,t,i){const n=Z6(t.metadata),r=[],s=iat(t.attributes);for(const o in e){const l=e[o],h=Q6(o,l,s[o]);r.push(h)}if(i){const o=Q6("indices",i);r.push(o)}return{fields:r,metadata:n}}function iat(e){const t={};for(const i in e){const n=e[i];t[n.name||"undefined"]=n}return t}function Q6(e,t,i){const n=i?Z6(i.metadata):void 0;return $st(e,t,n)}function Z6(e){Object.entries(e);const t={};for(const i in e)t[`${i}.string`]=JSON.stringify(e[i]);return t}const Y6={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},nat={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},rat=4;let oat=class{constructor(e){z(this,"draco"),z(this,"decoder"),z(this,"metadataQuerier"),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,t={}){const i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const n=this.decoder.GetEncodedGeometryType(i),r=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let s;switch(n){case this.draco.TRIANGULAR_MESH:s=this.decoder.DecodeBufferToMesh(i,r);break;case this.draco.POINT_CLOUD:s=this.decoder.DecodeBufferToPointCloud(i,r);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!s.ok()||!r.ptr){const v=`DRACO decompression failed: ${s.error_msg()}`;throw new Error(v)}const o=this._getDracoLoaderData(r,n,t),l=this._getMeshData(r,o,t),h=qst(l.attributes),A=eat(l.attributes,o,l.indices);return{loader:"draco",loaderData:o,header:{vertexCount:r.num_points(),boundingBox:h},...l,schema:A}}finally{this.draco.destroy(i),r&&this.draco.destroy(r)}}_getDracoLoaderData(e,t,i){const n=this._getTopLevelMetadata(e),r=this._getDracoAttributes(e,i);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:n,attributes:r}}_getDracoAttributes(e,t){const i={};for(let n=0;n<e.num_attributes();n++){const r=this.decoder.GetAttribute(e,n),s=this._getAttributeMetadata(e,n);i[r.unique_id()]={unique_id:r.unique_id(),attribute_type:r.attribute_type(),data_type:r.data_type(),num_components:r.num_components(),byte_offset:r.byte_offset(),byte_stride:r.byte_stride(),normalized:r.normalized(),attribute_index:n,metadata:s};const o=this._getQuantizationTransform(r,t);o&&(i[r.unique_id()].quantization_transform=o);const l=this._getOctahedronTransform(r,t);l&&(i[r.unique_id()].octahedron_transform=l)}return i}_getMeshData(e,t,i){const n=this._getMeshAttributes(t,e,i);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(i.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(e,t,i){const n={};for(const r of Object.values(e.attributes)){const s=this._deduceAttributeName(r,i);r.name=s;const o=this._getAttributeValues(t,r);if(o){const{value:l,size:h}=o;n[s]={value:l,size:h,byteOffset:r.byte_offset,byteStride:r.byte_stride,normalized:r.normalized}}}return n}_getTriangleListIndices(e){const t=e.num_faces()*3,i=t*rat,n=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,n),new Uint32Array(this.draco.HEAPF32.buffer,n,t).slice()}finally{this.draco._free(n)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),lat(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const i=nat[t.data_type];if(!i)return console.warn(`DRACO: Unsupported attribute type ${t.data_type}`),null;const n=t.num_components,r=e.num_points()*n,s=r*i.BYTES_PER_ELEMENT,o=sat(this.draco,i);let l;const h=this.draco._malloc(s);try{const A=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,A,o,s,h),l=new i(this.draco.HEAPF32.buffer,h,r).slice()}finally{this.draco._free(h)}return{value:l,size:n}}_deduceAttributeName(e,t){const i=e.unique_id;for(const[s,o]of Object.entries(t.extraAttributes||{}))if(o===i)return s;const n=e.attribute_type;for(const s in Y6)if(this.draco[s]===n)return Y6[s];const r=t.attributeNameEntry||"name";return e.metadata[r]?e.metadata[r].string:`CUSTOM_ATTRIBUTE_${i}`}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const i=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(i)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},i=this.metadataQuerier.NumEntries(e);for(let n=0;n<i;n++){const r=this.metadataQuerier.GetEntryName(e,n);t[r]=this._getDracoMetadataField(e,r)}return t}_getDracoMetadataField(e,t){const i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,i);const n=aat(i);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:n}}finally{this.draco.destroy(i)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:i=[]}=e,n=[...t,...i];for(const r of n)this.decoder.SkipAttributeTransform(this.draco[r])}_getQuantizationTransform(e,t){const{quantizedAttributes:i=[]}=t,n=e.attribute_type();if(i.map(r=>this.decoder[r]).includes(n)){const r=new this.draco.AttributeQuantizationTransform;try{if(r.InitFromAttribute(e))return{quantization_bits:r.quantization_bits(),range:r.range(),min_values:new Float32Array([1,2,3]).map(s=>r.min_value(s))}}finally{this.draco.destroy(r)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:i=[]}=t,n=e.attribute_type();if(i.map(r=>this.decoder[r]).includes(n)){const r=new this.draco.AttributeQuantizationTransform;try{if(r.InitFromAttribute(e))return{quantization_bits:r.quantization_bits()}}finally{this.draco.destroy(r)}}return null}};function sat(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}function aat(e){const t=e.size(),i=new Int32Array(t);for(let n=0;n<t;n++)i[n]=e.GetValue(n);return i}function lat(e){const t=e.size(),i=new Int32Array(t);for(let n=0;n<t;n++)i[n]=e.GetValue(n);return i}const cat="1.5.6",uat="1.4.1",dx=`https://www.gstatic.com/draco/versioned/decoders/${cat}`,js={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},px={[js.DECODER]:`${dx}/${js.DECODER}`,[js.DECODER_WASM]:`${dx}/${js.DECODER_WASM}`,[js.FALLBACK_DECODER]:`${dx}/${js.FALLBACK_DECODER}`,[js.ENCODER]:`https://raw.githubusercontent.com/google/draco/${uat}/javascript/${js.ENCODER}`};let Cg;async function hat(e){const t=e.modules||{};return t.draco3d?Cg||(Cg=t.draco3d.createDecoderModule({}).then(i=>({draco:i}))):Cg||(Cg=fat(e)),await Cg}async function fat(e){let t,i;switch(e.draco&&e.draco.decoderType){case"js":t=await ff(px[js.FALLBACK_DECODER],"draco",e,js.FALLBACK_DECODER);break;case"wasm":default:[t,i]=await Promise.all([await ff(px[js.DECODER],"draco",e,js.DECODER),await ff(px[js.DECODER_WASM],"draco",e,js.DECODER_WASM)])}return t=t||globalThis.DracoDecoderModule,await dat(t,i)}function dat(e,t){const i={};return t&&(i.wasmBinary=t),new Promise(n=>{e({...i,onModuleLoaded:r=>n({draco:r})})})}const pat={...Zst,parse:Aat};async function Aat(e,t){const{draco:i}=await hat(t),n=new oat(i);try{return n.parseSync(e,t==null?void 0:t.draco)}finally{n.destroy()}}function gat(e){const t={};for(const i in e){const n=e[i];if(i!=="indices"){const r=q6(n);t[i]=r}}return t}function q6(e){const{buffer:t,size:i,count:n}=mat(e);return{value:t,size:i,byteOffset:0,count:n,type:P6(i),componentType:_y(t)}}function mat(e){let t=e,i=1,n=0;return e&&e.value&&(t=e.value,i=e.size||1),t&&(ArrayBuffer.isView(t)||(t=yat(t,Float32Array)),n=t.length/i),{buffer:t,size:i,count:n}}function yat(e,t,i=!1){return e?Array.isArray(e)?new t(e):i&&!(e instanceof t)?new t(e):e:null}const ah="KHR_draco_mesh_compression",_at=ah;function vat(e,t,i){const n=new zo(e);for(const r of $6(n))n.getObjectExtension(r,ah)}async function bat(e,t,i){var n;if(!((n=t==null?void 0:t.gltf)!=null&&n.decompressMeshes))return;const r=new zo(e),s=[];for(const o of $6(r))r.getObjectExtension(o,ah)&&s.push(wat(r,o,t,i));await Promise.all(s),r.removeExtension(ah)}function xat(e,t={}){const i=new zo(e);for(const n of i.json.meshes||[])Cat(n),i.addRequiredExtension(ah)}async function wat(e,t,i,n){const r=e.getObjectExtension(t,ah);if(!r)return;const s=e.getTypedArrayForBufferView(r.bufferView),o=_6(s.buffer,s.byteOffset),l={...i};delete l["3d-tiles"];const h=await a6(o,pat,l,n),A=gat(h.attributes);for(const[v,C]of Object.entries(A))if(v in t.attributes){const S=t.attributes[v],L=e.getAccessor(S);L!=null&&L.min&&L!=null&&L.max&&(C.min=L.min,C.max=L.max)}t.attributes=A,h.indices&&(t.indices=q6(h.indices)),e.removeObjectExtension(t,ah),Eat(t)}function Cat(e,t,i=4,n,r){var s;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=n.DracoWriter.encodeSync({attributes:e}),l=(s=r==null?void 0:r.parseSync)==null?void 0:s.call(r,{attributes:e}),h=n._addFauxAttributes(l.attributes),A=n.addBufferView(o);return{primitives:[{attributes:h,mode:i,extensions:{[ah]:{bufferView:A,attributes:h}}}]}}function Eat(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*$6(e){for(const t of e.json.meshes||[])for(const i of t.primitives)yield i}const Bat=Object.freeze(Object.defineProperty({__proto__:null,decode:bat,encode:xat,name:_at,preprocess:vat},Symbol.toStringTag,{value:"Module"})),Ty="KHR_texture_transform",Tat=Ty,Sy=new de,Sat=new mr,Iat=new mr;async function Mat(e,t){var i;if(!new zo(e).hasExtension(Ty)||!((i=t.gltf)!=null&&i.loadBuffers))return;const n=e.json.materials||[];for(let r=0;r<n.length;r++)Pat(r,e)}function Pat(e,t){var i,n,r,s;const o=(i=t.json.materials)==null?void 0:i[e],l=[(n=o==null?void 0:o.pbrMetallicRoughness)==null?void 0:n.baseColorTexture,o==null?void 0:o.emissiveTexture,o==null?void 0:o.normalTexture,o==null?void 0:o.occlusionTexture,(r=o==null?void 0:o.pbrMetallicRoughness)==null?void 0:r.metallicRoughnessTexture],h=[];for(const A of l)A&&(s=A==null?void 0:A.extensions)!=null&&s[Ty]&&Rat(t,e,A,h)}function Rat(e,t,i,n){const r=Dat(i,n);if(!r)return;const s=e.json.meshes||[];for(const o of s)for(const l of o.primitives){const h=l.material;Number.isFinite(h)&&t===h&&Oat(e,l,r)}}function Dat(e,t){var i;const n=(i=e.extensions)==null?void 0:i[Ty],{texCoord:r=0}=e,{texCoord:s=r}=n;if(t.findIndex(([o,l])=>o===r&&l===s)===-1){const o=kat(n);return r!==s&&(e.texCoord=s),t.push([r,s]),{originalTexCoord:r,texCoord:s,matrix:o}}return null}function Oat(e,t,i){var n,r;const{originalTexCoord:s,texCoord:o,matrix:l}=i,h=t.attributes[`TEXCOORD_${s}`];if(Number.isFinite(h)){const A=(n=e.json.accessors)==null?void 0:n[h];if(A&&A.bufferView){const v=(r=e.json.bufferViews)==null?void 0:r[A.bufferView];if(v){const{arrayBuffer:C,byteOffset:S}=e.buffers[v.buffer],L=(S||0)+(A.byteOffset||0)+(v.byteOffset||0),{ArrayType:N,length:G}=R6(A,v),W=I6[A.componentType],j=S6[A.type],q=v.byteStride||W*j,Z=new Float32Array(G);for(let K=0;K<A.count;K++){const ft=new N(C,L+K*q,2);Sy.set(ft[0],ft[1],1),Sy.transformByMatrix3(l),Z.set([Sy[0],Sy[1]],K*j)}s===o?Lat(A,v,e.buffers,Z):Fat(o,A,t,e,Z)}}}}function Lat(e,t,i,n){e.componentType=5126,i.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),t.buffer=i.length-1,t.byteLength=n.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function Fat(e,t,i,n,r){n.buffers.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength});const s=n.json.bufferViews;if(!s)return;s.push({buffer:n.buffers.length-1,byteLength:r.buffer.byteLength,byteOffset:0});const o=n.json.accessors;o&&(o.push({bufferView:(s==null?void 0:s.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),i.attributes[`TEXCOORD_${e}`]=o.length-1)}function kat(e){const{offset:t=[0,0],rotation:i=0,scale:n=[1,1]}=e,r=new mr().set(1,0,0,0,1,0,t[0],t[1],1),s=Sat.set(Math.cos(i),Math.sin(i),0,-Math.sin(i),Math.cos(i),0,0,0,1),o=Iat.set(n[0],0,0,0,n[1],0,0,0,1);return r.multiplyRight(s).multiplyRight(o)}const Nat=Object.freeze(Object.defineProperty({__proto__:null,decode:Mat,name:Tat},Symbol.toStringTag,{value:"Module"})),df="KHR_lights_punctual",Uat=df;async function Gat(e){const t=new zo(e),{json:i}=t,n=t.getExtension(df);n&&(t.json.lights=n.lights,t.removeExtension(df));for(const r of i.nodes||[]){const s=t.getObjectExtension(r,df);s&&(r.light=s.light),t.removeObjectExtension(r,df)}}async function zat(e){const t=new zo(e),{json:i}=t;if(i.lights){const n=t.addExtension(df);Ua(!n.lights),n.lights=i.lights,delete i.lights}if(t.json.lights){for(const n of t.json.lights){const r=n.node;t.addObjectExtension(r,df,n)}delete t.json.lights}}const Vat=Object.freeze(Object.defineProperty({__proto__:null,decode:Gat,encode:zat,name:Uat},Symbol.toStringTag,{value:"Module"})),Eg="KHR_materials_unlit",jat=Eg;async function Hat(e){const t=new zo(e),{json:i}=t;for(const n of i.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),t.removeObjectExtension(n,Eg);t.removeExtension(Eg)}function Wat(e){const t=new zo(e),{json:i}=t;if(t.materials)for(const n of i.materials||[])n.unlit&&(delete n.unlit,t.addObjectExtension(n,Eg,{}),t.addExtension(Eg))}const Jat=Object.freeze(Object.defineProperty({__proto__:null,decode:Hat,encode:Wat,name:jat},Symbol.toStringTag,{value:"Module"})),Bg="KHR_techniques_webgl",Xat=Bg;async function Kat(e){const t=new zo(e),{json:i}=t,n=t.getExtension(Bg);if(n){const r=Zat(n,t);for(const s of i.materials||[]){const o=t.getObjectExtension(s,Bg);o&&(s.technique=Object.assign({},o,r[o.technique]),s.technique.values=Yat(s.technique,t)),t.removeObjectExtension(s,Bg)}t.removeExtension(Bg)}}async function Qat(e,t){}function Zat(e,t){const{programs:i=[],shaders:n=[],techniques:r=[]}=e,s=new TextDecoder;return n.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=s.decode(t.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),i.forEach(o=>{o.fragmentShader=n[o.fragmentShader],o.vertexShader=n[o.vertexShader]}),r.forEach(o=>{o.program=i[o.program]}),r}function Yat(e,t){const i=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach(n=>{e.uniforms[n].value&&!(n in i)&&(i[n]=e.uniforms[n].value)}),Object.keys(i).forEach(n=>{typeof i[n]=="object"&&i[n].index!==void 0&&(i[n].texture=t.getTexture(i[n].index))}),i}const qat=Object.freeze(Object.defineProperty({__proto__:null,decode:Kat,encode:Qat,name:Xat},Symbol.toStringTag,{value:"Module"})),tD=[kot,lot,Vst,Wst,Kst,Bat,Vat,Jat,qat,Nat,tst];function $at(e,t={},i){var n;const r=tD.filter(s=>eD(s.name,t));for(const s of r)(n=s.preprocess)==null||n.call(s,e,t,i)}async function tlt(e,t={},i){var n;const r=tD.filter(s=>eD(s.name,t));for(const s of r)await((n=s.decode)==null?void 0:n.call(s,e,t,i))}function eD(e,t){var i;const n=((i=t==null?void 0:t.gltf)==null?void 0:i.excludeExtensions)||{};return!(e in n&&!n[e])}const Ax="KHR_binary_glTF";function elt(e){const t=new zo(e),{json:i}=t;for(const n of i.images||[]){const r=t.getObjectExtension(n,Ax);r&&Object.assign(n,r),t.removeObjectExtension(n,Ax)}i.buffers&&i.buffers[0]&&delete i.buffers[0].uri,t.removeExtension(Ax)}const iD={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},ilt={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};let nlt=class{constructor(){z(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),z(this,"json")}normalize(e,t){this.json=e.json;const i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${i.asset.version}`);return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),elt(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in iD)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const i=e[t];if(!(!i||Array.isArray(i))){e[t]=[];for(const n in i){const r=i[n];r.id=r.id||n;const s=e[t].length;e[t].push(r),this.idToIndexMap[t][n]=s}}}_convertObjectIdsToArrayIndices(e){for(const t in iD)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:i,indices:n,material:r}=t;for(const s in i)i[s]=this._convertIdToIndex(i[s],"accessor");n&&(t.indices=this._convertIdToIndex(n,"accessor")),r&&(t.material=this._convertIdToIndex(r,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const i of e[t])for(const n in i){const r=i[n],s=this._convertIdToIndex(r,n);i[n]=s}}_convertIdToIndex(e,t){const i=ilt[t];if(i in this.idToIndexMap){const n=this.idToIndexMap[i][e];if(!Number.isFinite(n))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return n}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){var t,i,n;for(const r of e.materials){r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const s=((t=r.values)==null?void 0:t.tex)||((i=r.values)==null?void 0:i.texture2d_0)||((n=r.values)==null?void 0:n.diffuseTex),o=e.textures.findIndex(l=>l.id===s);o!==-1&&(r.pbrMetallicRoughness.baseColorTexture={index:o})}}};function rlt(e,t={}){return new nlt().normalize(e,t)}async function olt(e,t,i=0,n,r){var s,o,l;return slt(e,t,i,n),rlt(e,{normalize:(s=n==null?void 0:n.gltf)==null?void 0:s.normalize}),$at(e,n,r),(o=n==null?void 0:n.gltf)!=null&&o.loadBuffers&&e.json.buffers&&await alt(e,n,r),(l=n==null?void 0:n.gltf)!=null&&l.loadImages&&await llt(e,n,r),await tlt(e,n,r),e}function slt(e,t,i,n){if(n.uri&&(e.baseUri=n.uri),t instanceof ArrayBuffer&&!wst(t,i,n)&&(t=new TextDecoder().decode(t)),typeof t=="string")e.json=rrt(t);else if(t instanceof ArrayBuffer){const o={};i=Cst(o,t,i,n.glb),Ua(o.type==="glTF",`Invalid GLB magic string ${o.type}`),e._glb=o,e.json=o.json}else Ua(!1,"GLTF: must be ArrayBuffer or string");const r=e.json.buffers||[];if(e.buffers=new Array(r.length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:o}=e._glb;e.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const s=e.json.images||[];e.images=new Array(s.length).fill({})}async function alt(e,t,i){var n,r;const s=e.json.buffers||[];for(let o=0;o<s.length;++o){const l=s[o];if(l.uri){const{fetch:h}=i;Ua(h);const A=K6(l.uri,t),v=await((n=i==null?void 0:i.fetch)==null?void 0:n.call(i,A)),C=await((r=v==null?void 0:v.arrayBuffer)==null?void 0:r.call(v));e.buffers[o]={arrayBuffer:C,byteOffset:0,byteLength:C.byteLength},delete l.uri}else e.buffers[o]===null&&(e.buffers[o]={arrayBuffer:new ArrayBuffer(l.byteLength),byteOffset:0,byteLength:l.byteLength})}}async function llt(e,t,i){const n=clt(e),r=e.json.images||[],s=[];for(const o of n)s.push(ult(e,r[o],o,t,i));return await Promise.all(s)}function clt(e){const t=new Set,i=e.json.textures||[];for(const n of i)n.source!==void 0&&t.add(n.source);return Array.from(t).sort()}async function ult(e,t,i,n,r){let s;if(t.uri&&!t.hasOwnProperty("bufferView")){const l=K6(t.uri,n),{fetch:h}=r;s=await(await h(l)).arrayBuffer(),t.bufferView={data:s}}if(Number.isFinite(t.bufferView)){const l=Xrt(e.json,e.buffers,t.bufferView);s=_6(l.buffer,l.byteOffset,l.byteLength)}Ua(s,"glTF image has no data");let o=await a6(s,[krt,gst],{...n,mimeType:t.mimeType,basis:n.basis||{format:J6()}},r);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),e.images=e.images||[],e.images[i]=o}const gx={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:est,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:hlt,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function hlt(e,t={},i){t={...gx.options,...t},t.gltf={...gx.options.gltf,...t.gltf};const{byteOffset:n=0}=t;return await olt({},e,n,t,i)}function nD(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const rD=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),oD=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);oD&&parseFloat(oD[1]);const mx="4.3.2",flt=mx[0]>="0"&&mx[0]<="9"?`v${mx}`:"";function dlt(){const e=new yy({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=e,globalThis.loaders.version=flt,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=e,e}const plt=dlt();function Alt(e,t){return sD(e||{},t)}function sD(e,t,i=0){if(i>3)return t;const n={...e};for(const[r,s]of Object.entries(t))s&&typeof s=="object"&&!Array.isArray(s)?n[r]=sD(n[r]||{},t[r],i+1):n[r]=t[r];return n}const glt="latest";function mlt(){var e;return(e=globalThis._loadersgl_)!=null&&e.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const ylt=mlt();function lh(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const pf=typeof process!="object"||String(process)!=="[object process]"||process.browser,_lt=typeof window<"u"&&typeof window.orientation<"u",aD=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);aD&&parseFloat(aD[1]);class vlt{constructor(t,i){z(this,"name"),z(this,"workerThread"),z(this,"isRunning",!0),z(this,"result"),z(this,"_resolve",()=>{}),z(this,"_reject",()=>{}),this.name=t,this.workerThread=i,this.result=new Promise((n,r)=>{this._resolve=n,this._reject=r})}postMessage(t,i){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:i})}done(t){lh(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){lh(this.isRunning),this.isRunning=!1,this._reject(t)}}class yx{terminate(){}}const _x=new Map;function blt(e){lh(e.source&&!e.url||!e.source&&e.url);let t=_x.get(e.source||e.url);return t||(e.url&&(t=xlt(e.url),_x.set(e.url,t)),e.source&&(t=lD(e.source),_x.set(e.source,t))),lh(t),t}function xlt(e){if(!e.startsWith("http"))return e;const t=wlt(e);return lD(t)}function lD(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function wlt(e){return`try {
  importScripts('${e}');
} catch (error) {
  console.error(error);
  throw error;
}`}function cD(e,t=!0,i){const n=i||new Set;if(e){if(uD(e))n.add(e);else if(uD(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)&&t&&typeof e=="object")for(const r in e)cD(e[r],t,n)}return i===void 0?Array.from(n):[]}function uD(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}const vx=()=>{};class bx{constructor(t){z(this,"name"),z(this,"source"),z(this,"url"),z(this,"terminated",!1),z(this,"worker"),z(this,"onMessage"),z(this,"onError"),z(this,"_loadableURL","");const{name:i,source:n,url:r}=t;lh(n||r),this.name=i,this.source=n,this.url=r,this.onMessage=vx,this.onError=s=>console.log(s),this.worker=pf?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&pf||typeof yx<"u"&&!pf}destroy(){this.onMessage=vx,this.onError=vx,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,i){i=i||cD(t),this.worker.postMessage(t,i)}_getErrorFromErrorEvent(t){let i="Failed to load ";return i+=`worker ${this.name} from ${this.url}. `,t.message&&(i+=`${t.message} in `),t.lineno&&(i+=`:${t.lineno}:${t.colno}`),new Error(i)}_createBrowserWorker(){this._loadableURL=blt({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=i=>{i.data?this.onMessage(i.data):this.onError(new Error("No data received"))},t.onerror=i=>{this.onError(this._getErrorFromErrorEvent(i)),this.terminated=!0},t.onmessageerror=i=>console.error(i),t}_createNodeWorker(){let t;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new yx(i,{eval:!1})}else if(this.source)t=new yx(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",i=>{this.onMessage(i)}),t.on("error",i=>{this.onError(i)}),t.on("exit",i=>{}),t}}class Clt{constructor(t){z(this,"name","unnamed"),z(this,"source"),z(this,"url"),z(this,"maxConcurrency",1),z(this,"maxMobileConcurrency",1),z(this,"onDebug",()=>{}),z(this,"reuseWorkers",!0),z(this,"props",{}),z(this,"jobQueue",[]),z(this,"idleQueue",[]),z(this,"count",0),z(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}static isSupported(){return bx.isSupported()}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t,i=(r,s,o)=>r.done(o),n=(r,s)=>r.error(s)){const r=new Promise(s=>(this.jobQueue.push({name:t,onMessage:i,onError:n,onStart:s}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const i=this.jobQueue.shift();if(i){this.onDebug({message:"Starting job",name:i.name,workerThread:t,backlog:this.jobQueue.length});const n=new vlt(i.name,t);t.onMessage=r=>i.onMessage(n,r.type,r.payload),t.onError=r=>i.onError(n,r),i.onStart(n);try{await n.result}catch(r){console.error(`Worker exception: ${r}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!pf||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new bx({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return _lt?this.maxMobileConcurrency:this.maxConcurrency}}const Elt={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},hD=class rA{constructor(t){z(this,"props"),z(this,"workerPools",new Map),this.props={...Elt},this.setProps(t),this.workerPools=new Map}static isSupported(){return bx.isSupported()}static getWorkerFarm(t={}){return rA._workerFarm=rA._workerFarm||new rA({}),rA._workerFarm.setProps(t),rA._workerFarm}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const i of this.workerPools.values())i.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:i,source:n,url:r}=t;let s=this.workerPools.get(i);return s||(s=new Clt({name:i,source:n,url:r}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(i,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};z(hD,"_workerFarm");let fD=hD;function Blt(e,t={}){const i=t[e.id]||{},n=pf?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let r=i.workerUrl;if(!r&&e.id==="compression"&&(r=t.workerUrl),t._workerType==="test"&&(pf?r=`modules/${e.module}/dist/${n}`:r=`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!r){let s=e.version;s==="latest"&&(s=glt);const o=s?`@${s}`:"";r=`https://unpkg.com/@loaders.gl/${e.module}${o}/dist/${n}`}return lh(r),r}function Tlt(e,t=ylt){lh(e,"no worker provided");const i=e.version;return!(!t||!i)}function Slt(e,t){return!fD.isSupported()||!pf&&!(t!=null&&t._nodeWorkers)?!1:e.worker&&(t==null?void 0:t.worker)}async function Ilt(e,t,i,n,r){const s=e.id,o=Blt(e,i),l=fD.getWorkerFarm(i).getWorkerPool({name:s,url:o});i=JSON.parse(JSON.stringify(i)),n=JSON.parse(JSON.stringify(n||{}));const h=await l.startJob("process-on-worker",Mlt.bind(null,r));return h.postMessage("process",{input:t,options:i,context:n}),await(await h.result).result}async function Mlt(e,t,i,n){switch(i){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":const{id:r,input:s,options:o}=n;try{const l=await e(s,o);t.postMessage("done",{id:r,result:l})}catch(l){const h=l instanceof Error?l.message:"unknown error";t.postMessage("error",{id:r,error:h})}break;default:console.warn(`parse-with-worker unknown message ${i}`)}}function Plt(e,t,i){if(i=i||e.byteLength,e.byteLength<i||t.byteLength<i)return!1;const n=new Uint8Array(e),r=new Uint8Array(t);for(let s=0;s<n.length;++s)if(n[s]!==r[s])return!1;return!0}function Rlt(...e){return Dlt(e)}function Dlt(e){const t=e.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),i=t.reduce((s,o)=>s+o.byteLength,0),n=new Uint8Array(i);let r=0;for(const s of t)n.set(s,r),r+=s.byteLength;return n.buffer}async function Olt(e){const t=[];for await(const i of e)t.push(i);return Rlt(...t)}let Llt="";const dD={};function Flt(e){for(const t in dD)if(e.startsWith(t)){const i=dD[t];e=e.replace(t,i)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e=`${Llt}${e}`),e}function klt(e){return e&&typeof e=="object"&&e.isBuffer}function pD(e){if(klt(e)||e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){const t=e;return new TextEncoder().encode(t).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function AD(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function Nlt(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}const Ult=e=>typeof e=="boolean",Tg=e=>typeof e=="function",Sg=e=>e!==null&&typeof e=="object",gD=e=>Sg(e)&&e.constructor==={}.constructor,Glt=e=>!!e&&typeof e[Symbol.iterator]=="function",zlt=e=>e&&typeof e[Symbol.asyncIterator]=="function",Af=e=>typeof Response<"u"&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,gf=e=>typeof Blob<"u"&&e instanceof Blob,Vlt=e=>e&&typeof e=="object"&&e.isBuffer,jlt=e=>typeof ReadableStream<"u"&&e instanceof ReadableStream||Sg(e)&&Tg(e.tee)&&Tg(e.cancel)&&Tg(e.getReader),Hlt=e=>Sg(e)&&Tg(e.read)&&Tg(e.pipe)&&Ult(e.readable),mD=e=>jlt(e)||Hlt(e);class Wlt extends Error{constructor(t,i){super(t),z(this,"reason"),z(this,"url"),z(this,"response"),this.reason=i.reason,this.url=i.url,this.response=i.response}}const Jlt=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Xlt=/^([-\w.]+\/[-\w.+]+)/;function yD(e,t){return e.toLowerCase()===t.toLowerCase()}function Klt(e){const t=Xlt.exec(e);return t?t[1]:e}function _D(e){const t=Jlt.exec(e);return t?t[1]:""}const vD=/\?.*/;function Qlt(e){const t=e.match(vD);return t&&t[0]}function xx(e){return e.replace(vD,"")}function Zlt(e){if(e.length<50)return e;const t=e.slice(e.length-15);return`${e.substr(0,32)}...${t}`}function Iy(e){return Af(e)?e.url:gf(e)?e.name||"":typeof e=="string"?e:""}function wx(e){if(Af(e)){const t=e,i=t.headers.get("content-type")||"",n=xx(t.url);return Klt(i)||_D(n)}return gf(e)?e.type||"":typeof e=="string"?_D(e):""}function Ylt(e){return Af(e)?e.headers["content-length"]||-1:gf(e)?e.size:typeof e=="string"?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}async function bD(e){if(Af(e))return e;const t={},i=Ylt(e);i>=0&&(t["content-length"]=String(i));const n=Iy(e),r=wx(e);r&&(t["content-type"]=r);const s=await tct(e);s&&(t["x-first-bytes"]=s),typeof e=="string"&&(e=new TextEncoder().encode(e));const o=new Response(e,{headers:t});return Object.defineProperty(o,"url",{value:n}),o}async function qlt(e){if(!e.ok)throw await $lt(e)}async function $lt(e){const t=Zlt(e.url);let i=`Failed to fetch resource (${e.status}) ${e.statusText}: ${t}`;i=i.length>100?`${i.slice(0,100)}...`:i;const n={reason:e.statusText,url:e.url,response:e};try{const r=e.headers.get("Content-Type");n.reason=!e.bodyUsed&&r!=null&&r.includes("application/json")?await e.json():await e.text()}catch{}return new Wlt(i,n)}async function tct(e){if(typeof e=="string")return`data:,${e.slice(0,5)}`;if(e instanceof Blob){const t=e.slice(0,5);return await new Promise(i=>{const n=new FileReader;n.onload=r=>{var s;return i((s=r==null?void 0:r.target)==null?void 0:s.result)},n.readAsDataURL(t)})}if(e instanceof ArrayBuffer){const t=e.slice(0,5);return`data:base64,${ect(t)}`}return null}function ect(e){let t="";const i=new Uint8Array(e);for(let n=0;n<i.byteLength;n++)t+=String.fromCharCode(i[n]);return btoa(t)}function ict(e){return!nct(e)&&!rct(e)}function nct(e){return e.startsWith("http:")||e.startsWith("https:")}function rct(e){return e.startsWith("data:")}async function xD(e,t){var i,n;if(typeof e=="string"){const r=Flt(e);return ict(r)&&(i=globalThis.loaders)!=null&&i.fetchNode?(n=globalThis.loaders)==null?void 0:n.fetchNode(r,t):await fetch(r,t)}return await bD(e)}const wD=new yy({id:"loaders.gl"});class oct{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class sct{constructor(){z(this,"console"),this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}}const CD={fetch:null,mimeType:void 0,nothrow:!1,log:new sct,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:rD,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},act={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function ED(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function BD(){const e=ED();return e.globalOptions=e.globalOptions||{...CD},e.globalOptions}function lct(e,t,i,n){return i=i||[],i=Array.isArray(i)?i:[i],cct(e,i),hct(t,e,n)}function cct(e,t){TD(e,null,CD,act,t);for(const i of t){const n=e&&e[i.id]||{},r=i.options&&i.options[i.id]||{},s=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};TD(n,i.id,r,s,t)}}function TD(e,t,i,n,r){const s=t||"Top level",o=t?`${t}.`:"";for(const l in e){const h=!t&&Sg(e[l]),A=l==="baseUri"&&!t,v=l==="workerUrl"&&t;if(!(l in i)&&!A&&!v){if(l in n)wD.warn(`${s} loader option '${o}${l}' no longer supported, use '${n[l]}'`)();else if(!h){const C=uct(l,r);wD.warn(`${s} loader option '${o}${l}' not recognized. ${C}`)()}}}}function uct(e,t){const i=e.toLowerCase();let n="";for(const r of t)for(const s in r.options){if(e===s)return`Did you mean '${r.id}.${s}'?`;const o=s.toLowerCase();(i.startsWith(o)||o.startsWith(i))&&(n=n||`Did you mean '${r.id}.${s}'?`)}return n}function hct(e,t,i){const n={...e.options||{}};return fct(n,i),n.log===null&&(n.log=new oct),SD(n,BD()),SD(n,t),n}function SD(e,t){for(const i in t)if(i in t){const n=t[i];gD(n)&&gD(e[i])?e[i]={...e[i],...t[i]}:e[i]=t[i]}}function fct(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}function Cx(e){return e?(Array.isArray(e)&&(e=e[0]),Array.isArray(e==null?void 0:e.extensions)):!1}function Ex(e){nD(e,"null loader"),nD(Cx(e),"invalid loader");let t;return Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),(e!=null&&e.parseTextSync||e!=null&&e.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const ID=()=>{const e=ED();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function Ig(e){const t=ID();e=Array.isArray(e)?e:[e];for(const i of e){const n=Ex(i);t.find(r=>n===r)||t.unshift(n)}}function dct(){return ID()}const pct=/\.([^.]+)$/;async function Act(e,t=[],i,n){if(!PD(e))return null;let r=MD(e,t,{...i,nothrow:!0},n);if(r)return r;if(gf(e)&&(e=await e.slice(0,10).arrayBuffer(),r=MD(e,t,i,n)),!r&&!(i!=null&&i.nothrow))throw new Error(RD(e));return r}function MD(e,t=[],i,n){if(!PD(e))return null;if(t&&!Array.isArray(t))return Ex(t);let r=[];t&&(r=r.concat(t)),i!=null&&i.ignoreRegisteredLoaders||r.push(...dct()),mct(r);const s=gct(e,r,i,n);if(!s&&!(i!=null&&i.nothrow))throw new Error(RD(e));return s}function gct(e,t,i,n){const r=Iy(e),s=wx(e),o=xx(r)||(n==null?void 0:n.url);let l=null,h="";return i!=null&&i.mimeType&&(l=Bx(t,i==null?void 0:i.mimeType),h=`match forced by supplied MIME type ${i==null?void 0:i.mimeType}`),l=l||yct(t,o),h=h||(l?`matched url ${o}`:""),l=l||Bx(t,s),h=h||(l?`matched MIME type ${s}`:""),l=l||vct(t,e),h=h||(l?`matched initial data ${OD(e)}`:""),i!=null&&i.fallbackMimeType&&(l=l||Bx(t,i==null?void 0:i.fallbackMimeType),h=h||(l?`matched fallback MIME type ${s}`:"")),h&&plt.log(1,`selectLoader selected ${l==null?void 0:l.name}: ${h}.`),l}function PD(e){return!(e instanceof Response&&e.status===204)}function RD(e){const t=Iy(e),i=wx(e);let n="No valid loader found (";n+=t?`${AD(t)}, `:"no url provided, ",n+=`MIME type: ${i?`"${i}"`:"not provided"}, `;const r=e?OD(e):"";return n+=r?` first bytes: "${r}"`:"first bytes: not available",n+=")",n}function mct(e){for(const t of e)Ex(t)}function yct(e,t){const i=t&&pct.exec(t),n=i&&i[1];return n?_ct(e,n):null}function _ct(e,t){t=t.toLowerCase();for(const i of e)for(const n of i.extensions)if(n.toLowerCase()===t)return i;return null}function Bx(e,t){var i;for(const n of e)if((i=n.mimeTypes)!=null&&i.some(r=>yD(t,r))||yD(t,`application/x.${n.id}`))return n;return null}function vct(e,t){if(!t)return null;for(const i of e)if(typeof t=="string"){if(bct(t,i))return i}else if(ArrayBuffer.isView(t)){if(DD(t.buffer,t.byteOffset,i))return i}else if(t instanceof ArrayBuffer&&DD(t,0,i))return i;return null}function bct(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>e.startsWith(i))}function DD(e,t,i){return(Array.isArray(i.tests)?i.tests:[i.tests]).some(n=>xct(e,t,i,n))}function xct(e,t,i,n){if(n instanceof ArrayBuffer)return Plt(n,e,n.byteLength);switch(typeof n){case"function":return n(e);case"string":const r=Tx(e,t,n.length);return n===r;default:return!1}}function OD(e,t=5){return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?Tx(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?Tx(e,0,t):""}function Tx(e,t,i){if(e.byteLength<t+i)return"";const n=new DataView(e);let r="";for(let s=0;s<i;s++)r+=String.fromCharCode(n.getUint8(t+s));return r}const wct=256*1024;function*Cct(e,t){const i=(t==null?void 0:t.chunkSize)||wct;let n=0;const r=new TextEncoder;for(;n<e.length;){const s=Math.min(e.length-n,i),o=e.slice(n,n+s);n+=s,yield r.encode(o)}}const Ect=256*1024;function*Bct(e,t={}){const{chunkSize:i=Ect}=t;let n=0;for(;n<e.byteLength;){const r=Math.min(e.byteLength-n,i),s=new ArrayBuffer(r),o=new Uint8Array(e,n,r);new Uint8Array(s).set(o),n+=r,yield s}}const Tct=1024*1024;async function*Sct(e,t){const i=(t==null?void 0:t.chunkSize)||Tct;let n=0;for(;n<e.size;){const r=n+i,s=await e.slice(n,r).arrayBuffer();n=r,yield s}}function LD(e,t){return rD?Ict(e,t):Mct(e)}async function*Ict(e,t){const i=e.getReader();let n;try{for(;;){const r=n||i.read();t!=null&&t._streamReadAhead&&(n=i.read());const{done:s,value:o}=await r;if(s)return;yield pD(o)}}catch{i.releaseLock()}}async function*Mct(e,t){for await(const i of e)yield pD(i)}function Pct(e,t){if(typeof e=="string")return Cct(e,t);if(e instanceof ArrayBuffer)return Bct(e,t);if(gf(e))return Sct(e,t);if(mD(e))return LD(e,t);if(Af(e))return LD(e.body,t);throw new Error("makeIterator")}const FD="Cannot convert supplied data type";function Rct(e,t,i){if(t.text&&typeof e=="string")return e;if(Vlt(e)&&(e=e.buffer),e instanceof ArrayBuffer){const n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer;const r=e.byteLength||e.length;return(e.byteOffset!==0||r!==n.byteLength)&&(n=n.slice(e.byteOffset,e.byteOffset+r)),n}throw new Error(FD)}async function Dct(e,t,i){const n=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if(typeof e=="string"||n)return Rct(e,t);if(gf(e)&&(e=await bD(e)),Af(e)){const r=e;return await qlt(r),t.binary?await r.arrayBuffer():await r.text()}if(mD(e)&&(e=Pct(e,i)),Glt(e)||zlt(e))return Olt(e);throw new Error(FD)}function kD(e,t){const i=BD(),n=e||i;return typeof n.fetch=="function"?n.fetch:Sg(n.fetch)?r=>xD(r,n.fetch):t!=null&&t.fetch?t==null?void 0:t.fetch:xD}function Oct(e,t,i){if(i)return i;const n={fetch:kD(t,e),...e};if(n.url){const r=xx(n.url);n.baseUrl=r,n.queryString=Qlt(n.url),n.filename=AD(r),n.baseUrl=Nlt(r)}return Array.isArray(n.loaders)||(n.loaders=null),n}function Lct(e,t){if(e&&!Array.isArray(e))return e;let i;if(e&&(i=Array.isArray(e)?e:[e]),t&&t.loaders){const n=Array.isArray(t.loaders)?t.loaders:[t.loaders];i=i?[...i,...n]:n}return i&&i.length?i:void 0}async function My(e,t,i,n){t&&!Array.isArray(t)&&!Cx(t)&&(n=void 0,i=t,t=void 0),e=await e,i=i||{};const r=Iy(e),s=Lct(t,n),o=await Act(e,s,i);return o?(i=lct(i,o,s,r),n=Oct({url:r,_parse:My,loaders:s},i,n||null),await Fct(o,e,i,n)):null}async function Fct(e,t,i,n){if(Tlt(e),i=Alt(e.options,i),Af(t)){const s=t,{ok:o,redirected:l,status:h,statusText:A,type:v,url:C}=s,S=Object.fromEntries(s.headers.entries());n.response={headers:S,ok:o,redirected:l,status:h,statusText:A,type:v,url:C}}t=await Dct(t,e,i);const r=e;if(r.parseTextSync&&typeof t=="string")return r.parseTextSync(t,i,n);if(Slt(e,i))return await Ilt(e,t,i,n,My);if(r.parseText&&typeof t=="string")return await r.parseText(t,i,n);if(r.parse)return await r.parse(t,i,n);throw lh(!r.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}async function gp(e,t,i,n){let r,s;!Array.isArray(t)&&!Cx(t)?(r=[],s=t):(r=t,s=i);const o=kD(s);let l=e;return typeof e=="string"&&(l=await o(e)),gf(e)&&(l=await o(e)),Array.isArray(r)?await My(l,r,s):await My(l,r,s)}const kct=({error:e,deltaType:t})=>e instanceof Nct?ir.jsx(Kv,{name:"No Mapbox token provided",message:ir.jsxs(ir.Fragment,{children:[ir.jsxs("p",{children:["To use ",ir.jsxs(Qv,{children:["st.",t]})," or"," ",ir.jsx(Qv,{children:"st.map"})," you need to set up a Mapbox access token."]}),ir.jsxs("p",{children:["To get a token, create an account at"," ",ir.jsx("a",{href:"https://mapbox.com",children:"https://mapbox.com"}),". It's free for moderate usage levels!"]}),ir.jsxs("p",{children:["Once you have a token, just set it using the Streamlit config option ",ir.jsx(Qv,{children:"mapbox.token"})," and don't forget to restart your Streamlit server at this point if it's still running, then reload this tab."]}),ir.jsxs("p",{children:["See"," ",ir.jsx("a",{href:"https://docs.streamlit.io/develop/api-reference/configuration/config.toml",children:"our documentation"})," ","for more info on how to set config options."]})]})}):e instanceof ND?ir.jsx(Kv,{name:"Error fetching Streamlit Mapbox token",message:ir.jsxs(ir.Fragment,{children:[ir.jsx("p",{children:"This app requires an internet connection."}),ir.jsx("p",{children:"Please check your connection and try again."}),ir.jsxs("p",{children:["If you think this is a bug, please file bug report"," ",ir.jsx("a",{href:"https://github.com/streamlit/streamlit/issues/new/choose",children:"here"}),"."]})]})}):ir.jsx(Kv,{name:"Error fetching Streamlit Mapbox token",message:e.message});class Nct extends Error{}class ND extends Error{}const UD="https://data.streamlit.io/tokens.json",GD="mapbox",Uct=e=>t=>{const i=class extends Ie.PureComponent{constructor(s){super(s),this.initMapboxToken=async()=>{try{const o=await yG.get(UD),{[GD]:l}=o.data;if(!l)throw new Error(`Missing token ${GD}`);this.setState({mapboxToken:l,isFetching:!1})}catch(o){const l=rG(o);throw this.setState({mapboxTokenError:l,isFetching:!1}),new ND(`${l.message} (${UD})`)}},this.render=()=>{const{mapboxToken:o,mapboxTokenError:l,isFetching:h}=this.state;return l?ir.jsx(kct,{error:l,deltaType:e}):h?ir.jsx(oG,{element:EB.create({style:EB.SkeletonStyle.ELEMENT})}):ir.jsx(t,{...this.props,mapboxToken:o})},this.state={isFetching:!0,mapboxToken:void 0,mapboxTokenError:void 0}}componentDidMount(){const s=this.props.element.mapboxToken||this.context.libConfig.mapboxToken;s?this.setState({mapboxToken:s,isFetching:!1}):this.initMapboxToken()}};return i.displayName=`withMapboxToken(${t.displayName||t.name})`,i.contextType=sG,aG(i,t)},zD=BB("div",{target:"e1az0zs51"})(({height:e})=>({position:"relative",height:e,width:"100%"}),""),Gct=BB("div",{target:"e1az0zs50"})(({theme:e})=>({position:"absolute",right:"2.625rem",top:e.spacing.md,zIndex:e.zIndices.priority,".mapboxgl-ctrl.mapboxgl-ctrl-group":{overflow:"hidden",background:e.colors.bgColor},"button:not(:disabled)":{background:e.colors.bgColor,width:e.iconSizes.twoXL,height:e.iconSizes.twoXL,"& + button":{borderTopColor:e.colors.borderColor},".mapboxgl-ctrl-icon":{backgroundSize:e.iconSizes.twoXL,"&:hover":{backgroundColor:e.colors.darkenedBgMix25}},"& span":{filter:TB(e)?"":"invert(100%)"}}}),""),zct=({container:e,element:t,heightFallback:i="auto",isFullScreen:n,shouldUseContainerWidth:r,widthFallback:s="auto"})=>{const o=Ie.useMemo(()=>r||n?"100%":t.width||e.width||s,[e.width,t.width,n,r,s]),l=Ie.useMemo(()=>n&&e.height?e.height:t.height||e.height||i,[n,t.height,e.height,i]);return{width:o,height:l}},VD=`uniform arcUniforms {
  bool greatCircle;
  bool useShortestPath;
  float numSegments;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int widthUnits;
} arc;
`,Vct={name:"arc",vs:VD,fs:VD,uniformTypes:{greatCircle:"f32",useShortestPath:"f32",numSegments:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",widthUnits:"i32"}},jct=`#version 300 es
#define SHADER_NAME arc-layer-vertex-shader
in vec4 instanceSourceColors;
in vec4 instanceTargetColors;
in vec3 instanceSourcePositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions;
in vec3 instanceTargetPositions64Low;
in vec3 instancePickingColors;
in float instanceWidths;
in float instanceHeights;
in float instanceTilts;
out vec4 vColor;
out vec2 uv;
out float isValid;
float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
float deltaZ = targetZ - sourceZ;
float dh = distance * instanceHeights;
if (dh == 0.0) {
return sourceZ + deltaZ * ratio;
}
float unitZ = deltaZ / dh;
float p2 = unitZ * unitZ + 1.0;
float dir = step(deltaZ, 0.0);
float z0 = mix(sourceZ, targetZ, dir);
float r = mix(ratio, 1.0 - ratio, dir);
return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
float getSegmentRatio(float index) {
return smoothstep(0.0, 1.0, index / (arc.numSegments - 1.0));
}
vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
float distance = length(source.xy - target.xy);
float z = paraboloid(distance, source.z, target.z, segmentRatio);
float tiltAngle = radians(instanceTilts);
vec2 tiltDirection = normalize(target.xy - source.xy);
vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);
return vec3(
mix(source.xy, target.xy, segmentRatio) + tilt,
z * cos(tiltAngle)
);
}
float getAngularDist (vec2 source, vec2 target) {
vec2 sourceRadians = radians(source);
vec2 targetRadians = radians(target);
vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
vec2 shd_sq = sin_half_delta * sin_half_delta;
float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
return 2.0 * asin(sqrt(a));
}
vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
vec2 lngLat;
if(abs(angularDist - PI) < 0.001) {
lngLat = (1.0 - t) * source.xy + t * target.xy;
} else {
float a = sin((1.0 - t) * angularDist);
float b = sin(t * angularDist);
vec3 p = source3D.yxz * a + target3D.yxz * b;
lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
}
float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);
return vec3(lngLat, z);
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
float segmentIndex = float(gl_VertexID / 2);
float segmentSide = mod(float(gl_VertexID), 2.) == 0. ? -1. : 1.;
float segmentRatio = getSegmentRatio(segmentIndex);
float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
float nextSegmentRatio = getSegmentRatio(min(arc.numSegments - 1.0, segmentIndex + 1.0));
float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
isValid = 1.0;
uv = vec2(segmentRatio, segmentSide);
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
vec4 curr;
vec4 next;
vec3 source;
vec3 target;
if ((arc.greatCircle || project.projectionMode == PROJECTION_MODE_GLOBE) && project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);
vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);
if (abs(currPos.x - prevPos.x) > 180.0) {
indexDir = -1.0;
isValid = 0.0;
} else if (abs(currPos.x - nextPos.x) > 180.0) {
indexDir = 1.0;
isValid = 0.0;
}
nextPos = indexDir < 0.0 ? prevPos : nextPos;
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
if (isValid == 0.0) {
nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
currPos = mix(currPos, nextPos, t);
segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
}
vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
} else {
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
if (arc.useShortestPath) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng > 180.) target_world.x -= 360.;
if (deltaLng < -180.) source_world.x -= 360.;
}
source = project_position(source_world, instanceSourcePositions64Low);
target = project_position(target_world, instanceTargetPositions64Low);
float antiMeridianX = 0.0;
if (arc.useShortestPath) {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
antiMeridianX = -(project.coordinateOrigin.x + 180.) / 360. * TILE_SIZE;
}
float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);
if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
isValid = 0.0;
indexDir = sign(segmentRatio - thresholdRatio);
segmentRatio = thresholdRatio;
}
}
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
vec3 currPos = interpolateFlat(source, target, segmentRatio);
vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);
if (arc.useShortestPath) {
if (nextPos.x < antiMeridianX) {
currPos.x += TILE_SIZE;
nextPos.x += TILE_SIZE;
}
}
curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
geometry.position = vec4(currPos, 1.0);
}
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * arc.widthScale, arc.widthUnits),
arc.widthMinPixels, arc.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset((next.xy - curr.xy) * indexDir, segmentSide, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(curr, geometry);
gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
vColor = vec4(color.rgb, color.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Hct=`#version 300 es
#define SHADER_NAME arc-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
in float isValid;
out vec4 fragColor;
void main(void) {
if (isValid == 0.0) {
discard;
}
fragColor = vColor;
geometry.uv = uv;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Py=[0,0,0,255],Wct={getSourcePosition:{type:"accessor",value:e=>e.sourcePosition},getTargetPosition:{type:"accessor",value:e=>e.targetPosition},getSourceColor:{type:"accessor",value:Py},getTargetColor:{type:"accessor",value:Py},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class Mg extends Io{getBounds(){var t;return(t=this.getAttributeManager())==null?void 0:t.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:jct,fs:Hct,modules:[Uo,pa,Vct]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:Py},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:Py},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(t){var i;super.updateState(t),t.changeFlags.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{widthUnits:i,widthScale:n,widthMinPixels:r,widthMaxPixels:s,greatCircle:o,wrapLongitude:l,numSegments:h}=this.props,A={numSegments:h,widthUnits:Ds[i],widthScale:n,widthMinPixels:r,widthMaxPixels:s,greatCircle:o,useShortestPath:l},v=this.state.model;v.shaderInputs.setProps({arc:A}),v.setVertexCount(h*2),v.draw(this.context.renderPass)}_getModel(){return new Hr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-strip",isInstanced:!0})}}Mg.layerName="ArcLayer",Mg.defaultProps=Wct;const Jct=new Uint32Array([0,2,1,0,3,2]),Xct=new Float32Array([0,1,0,0,1,0,1,1]);function Kct(e,t){if(!t)return Qct(e);const i=Math.max(Math.abs(e[0][0]-e[3][0]),Math.abs(e[1][0]-e[2][0])),n=Math.max(Math.abs(e[1][1]-e[0][1]),Math.abs(e[2][1]-e[3][1])),r=Math.ceil(i/t)+1,s=Math.ceil(n/t)+1,o=(r-1)*(s-1)*6,l=new Uint32Array(o),h=new Float32Array(r*s*2),A=new Float64Array(r*s*3);let v=0,C=0;for(let S=0;S<r;S++){const L=S/(r-1);for(let N=0;N<s;N++){const G=N/(s-1),W=Zct(e,L,G);A[v*3+0]=W[0],A[v*3+1]=W[1],A[v*3+2]=W[2]||0,h[v*2+0]=L,h[v*2+1]=1-G,S>0&&N>0&&(l[C++]=v-s,l[C++]=v-s-1,l[C++]=v-1,l[C++]=v-s,l[C++]=v-1,l[C++]=v),v++}}return{vertexCount:o,positions:A,indices:l,texCoords:h}}function Qct(e){const t=new Float64Array(12);for(let i=0;i<e.length;i++)t[i*3+0]=e[i][0],t[i*3+1]=e[i][1],t[i*3+2]=e[i][2]||0;return{vertexCount:6,positions:t,indices:Jct,texCoords:Xct}}function Zct(e,t,i){return pl(pl(e[0],e[1],i),pl(e[3],e[2],i),t)}const jD=`uniform bitmapUniforms {
  vec4 bounds;
  float coordinateConversion;
  float desaturate;
  vec3 tintColor;
  vec4 transparentColor;
} bitmap;
`,Yct={name:"bitmap",vs:jD,fs:jD,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}},qct=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (bitmap.coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project.commonOrigin.xy;
  } else if (bitmap.coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,$ct=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,tut=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), bitmap.desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * bitmap.tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (bitmap.transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),
    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])
  );
}

${$ct}

void main(void) {
  vec2 uv = vTexCoord;
  if (bitmap.coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (bitmap.coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,eut={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:qi.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class Ry extends Io{getShaders(){return super.getShaders({vs:qct,fs:tut,modules:[Uo,pa,Yct]})}initializeState(){const t=this.getAttributeManager();t.remove(["instancePickingColors"]);const i=!0;t.add({indices:{size:1,isIndexed:!0,update:n=>n.value=this.state.mesh.indices,noAlloc:i},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:n=>n.value=this.state.mesh.positions,noAlloc:i},texCoords:{size:2,update:n=>n.value=this.state.mesh.texCoords,noAlloc:i}})}updateState({props:t,oldProps:i,changeFlags:n}){var r;const s=this.getAttributeManager();if(n.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),s.invalidateAll()),t.bounds!==i.bounds){const o=this.state.mesh,l=this._createMesh();this.state.model.setVertexCount(l.vertexCount);for(const h in l)o&&o[h]!==l[h]&&s.invalidate(h);this.setState({mesh:l,...this._getCoordinateUniforms()})}else t._imageCoordinateSystem!==i._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(t){const{image:i}=this.props,n=t.info;if(!n.color||!i)return n.bitmap=null,n;const{width:r,height:s}=i;n.index=0;const o=iut(n.color);return n.bitmap={size:{width:r,height:s},uv:o,pixel:[Math.floor(o[0]*r),Math.floor(o[1]*s)]},n}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(t){super._updateAutoHighlight({...t,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:t}=this.props;let i=t;return HD(t)&&(i=[[t[0],t[1]],[t[0],t[3]],[t[2],t[3]],[t[2],t[1]]]),Kct(i,this.context.viewport.resolution)}_getModel(){return new Hr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(t){const{shaderModuleProps:i}=t,{model:n,coordinateConversion:r,bounds:s,disablePicking:o}=this.state,{image:l,desaturate:h,transparentColor:A,tintColor:v}=this.props;if(!(i.picking.isActive&&o)&&l&&n){const C={bitmapTexture:l,bounds:s,coordinateConversion:r,desaturate:h,tintColor:v.slice(0,3).map(S=>S/255),transparentColor:A.map(S=>S/255)};n.shaderInputs.setProps({bitmap:C}),n.draw(this.context.renderPass)}}_getCoordinateUniforms(){const{LNGLAT:t,CARTESIAN:i,DEFAULT:n}=qi;let{_imageCoordinateSystem:r}=this.props;if(r!==n){const{bounds:s}=this.props;if(!HD(s))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const o=this.context.viewport.resolution?t:i;if(r=r===t?t:i,r===t&&o===i)return{coordinateConversion:-1,bounds:s};if(r===i&&o===t){const l=Yc([s[0],s[1]]),h=Yc([s[2],s[3]]);return{coordinateConversion:1,bounds:[l[0],l[1],h[0],h[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}Ry.layerName="BitmapLayer",Ry.defaultProps=eut;function iut(e){const[t,i,n]=e,r=(n&240)/256,s=(n&15)/16;return[(t+s)/256,(i+r)/256]}function HD(e){return Number.isFinite(e[0])}const WD=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,nut={name:"icon",vs:WD,fs:WD,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},rut=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,out=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,sut=1024,aut=4,JD=()=>{},XD={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},lut={x:0,y:0,width:0,height:0};function cut(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function uut(e,t,i,n){const r=Math.min(i/t.width,n/t.height),s=Math.floor(t.width*r),o=Math.floor(t.height*r);return r===1?{image:t,width:s,height:o}:(e.canvas.height=o,e.canvas.width=s,e.clearRect(0,0,s,o),e.drawImage(t,0,0,t.width,t.height,0,0,s,o),{image:e.canvas,width:s,height:o})}function Pg(e){return e&&(e.id||e.url)}function hut(e,t,i,n){const{width:r,height:s,device:o}=e,l=o.createTexture({format:"rgba8unorm",width:t,height:i,sampler:n,mipmaps:!0}),h=o.createCommandEncoder();return h.copyTextureToTexture({sourceTexture:e,destinationTexture:l,width:r,height:s}),h.finish(),e.destroy(),l}function KD(e,t,i){for(let n=0;n<t.length;n++){const{icon:r,xOffset:s}=t[n],o=Pg(r);e[o]={...r,x:s,y:i}}}function fut({icons:e,buffer:t,mapping:i={},xOffset:n=0,yOffset:r=0,rowHeight:s=0,canvasWidth:o}){let l=[];for(let h=0;h<e.length;h++){const A=e[h],v=Pg(A);if(!i[v]){const{height:C,width:S}=A;n+S+t>o&&(KD(i,l,r),n=0,r=s+r+t,s=0,l=[]),l.push({icon:A,xOffset:n}),n=n+S+t,s=Math.max(s,C)}}return l.length>0&&KD(i,l,r),{mapping:i,rowHeight:s,xOffset:n,yOffset:r,canvasWidth:o,canvasHeight:cut(s+r+t)}}function dut(e,t,i){if(!e||!t)return null;i=i||{};const n={},{iterable:r,objectInfo:s}=lc(e);for(const o of r){s.index++;const l=t(o,s),h=Pg(l);if(!l)throw new Error("Icon is missing.");if(!l.url)throw new Error("Icon url is missing.");!n[h]&&(!i[h]||l.url!==i[h].url)&&(n[h]={...l,source:o,sourceIndex:s.index})}return n}class put{constructor(t,{onUpdate:i=JD,onError:n=JD}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=aut,this._canvasWidth=sut,this._canvasHeight=0,this._canvas=null,this.device=t,this.onUpdate=i,this.onError=n}finalize(){var t;(t=this._texture)==null||t.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(t){const i=this._autoPacking?Pg(t):t;return this._mapping[i]||lut}setProps({loadOptions:t,autoPacking:i,iconAtlas:n,iconMapping:r,textureParameters:s}){var o;t&&(this._loadOptions=t),i!==void 0&&(this._autoPacking=i),r&&(this._mapping=r),n&&((o=this._texture)==null||o.delete(),this._texture=null,this._externalTexture=n),s&&(this._samplerParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(t,i){if(!this._autoPacking||typeof document>"u")return;const n=Object.values(dut(t,i,this._mapping)||{});if(n.length>0){const{mapping:r,xOffset:s,yOffset:o,rowHeight:l,canvasHeight:h}=fut({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=l,this._mapping=r,this._xOffset=s,this._yOffset=o,this._canvasHeight=h,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||XD,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=hut(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||XD)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n)}}_loadIcons(t){const i=this._canvas.getContext("2d",{willReadFrequently:!0});for(const n of t)this._pendingCount++,gp(n.url,this._loadOptions).then(r=>{var s;const o=Pg(n),l=this._mapping[o],{x:h,y:A,width:v,height:C}=l,{image:S,width:L,height:N}=uut(i,r,v,C);(s=this._texture)==null||s.copyExternalImage({image:S,x:h+(v-L)/2,y:A+(C-N)/2,width:L,height:N}),l.width=L,l.height=N,this._texture.generateMipmap(),this.onUpdate()}).catch(r=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:r})}).finally(()=>{this._pendingCount--})}}const QD=[0,0,0,255],Aut={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:e=>e.position},getIcon:{type:"accessor",value:e=>e.icon},getColor:{type:"accessor",value:QD},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class mp extends Io{getShaders(){return super.getShaders({vs:rut,fs:out,modules:[Uo,pa,nut]})}initializeState(){this.state={iconManager:new put(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:QD},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(t){var i;super.updateState(t);const{props:n,oldProps:r,changeFlags:s}=t,o=this.getAttributeManager(),{iconAtlas:l,iconMapping:h,data:A,getIcon:v,textureParameters:C}=n,{iconManager:S}=this.state;if(typeof l=="string")return;const L=l||this.internalState.isAsyncPropLoading("iconAtlas");S.setProps({loadOptions:n.loadOptions,autoPacking:!L,iconAtlas:l,iconMapping:L?h:null,textureParameters:C}),L?r.iconMapping!==n.iconMapping&&o.invalidate("getIcon"):(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getIcon))&&S.packIcons(A,v),s.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),o.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(t){super.finalizeState(t),this.state.iconManager.finalize()}draw({uniforms:t}){const{sizeScale:i,sizeMinPixels:n,sizeMaxPixels:r,sizeUnits:s,billboard:o,alphaCutoff:l}=this.props,{iconManager:h}=this.state,A=h.getTexture();if(A){const v=this.state.model,C={iconsTexture:A,iconsTextureDim:[A.width,A.height],sizeUnits:Ds[s],sizeScale:i,sizeMinPixels:n,sizeMaxPixels:r,billboard:o,alphaCutoff:l};v.shaderInputs.setProps({icon:C}),v.draw(this.context.renderPass)}}_getModel(){const t=[-1,-1,1,-1,-1,1,1,1];return new Hr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new es({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(t){var i;const n=(i=this.getCurrentLayer())==null?void 0:i.props.onIconError;n?n(t):Yi.error(t.error.message)()}getInstanceOffset(t){const{width:i,height:n,anchorX:r=i/2,anchorY:s=n/2}=this.state.iconManager.getIconMapping(t);return[i/2-r,n/2-s]}getInstanceColorMode(t){return this.state.iconManager.getIconMapping(t).mask?1:0}getInstanceIconFrame(t){const{x:i,y:n,width:r,height:s}=this.state.iconManager.getIconMapping(t);return[i,n,r,s]}}mp.defaultProps=Aut,mp.layerName="IconLayer";const gut=`struct LineUniforms {
  widthScale: f32,
  widthMinPixels: f32,
  widthMaxPixels: f32,
  useShortestPath: f32,
  widthUnits: i32,
};

@group(0) @binding(1)
var<uniform> line: LineUniforms;
`,ZD=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,mut={name:"line",source:gut,vs:ZD,fs:ZD,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}},yut=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)
struct LayerUniforms {
  opacity: f32,
};
var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// ---------- Helper Structures & Functions ----------

// Placeholder filter functions.
fn deckgl_filter_size(offset: vec3<f32>, geometry: Geometry) -> vec3<f32> {
  return offset;
}
fn deckgl_filter_gl_position(p: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return p;
}
fn deckgl_filter_color(color: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return color;
}

// Compute an extrusion offset given a line direction (in clipspace),
// an offset direction (-1 or 1), and a width in pixels.
// Assumes a uniform "project" with a viewportSize field is available.
fn getExtrusionOffset(line_clipspace: vec2<f32>, offset_direction: f32, width: f32) -> vec2<f32> {
  // project.viewportSize should be provided as a uniform (not shown here)
  let dir_screenspace = normalize(line_clipspace * project.viewportSize);
  // Rotate by 90\xB0: (x,y) becomes (-y,x)
  let rotated = vec2<f32>(-dir_screenspace.y, dir_screenspace.x);
  return rotated * offset_direction * width / 2.0;
}

// Splits the line between two points at a given x coordinate.
// Interpolates the y and z components.
fn splitLine(a: vec3<f32>, b: vec3<f32>, x: f32) -> vec3<f32> {
  let t: f32 = (x - a.x) / (b.x - a.x);
  return vec3<f32>(x, a.yz + t * (b.yz - a.yz));
}

// ---------- Uniforms & Global Structures ----------

// Uniforms for line, layer, and project are assumed to be defined elsewhere.
// For example:
//
// @group(0) @binding(0)
// var<uniform> line: LineUniform;
//
// struct LayerUniform {
//   opacity: f32,
// };
// @group(0) @binding(1)
// var<uniform> layer: LayerUniform;
//
// struct ProjectUniform {
//   viewportSize: vec2<f32>,
// };
// @group(0) @binding(2)
// var<uniform> project: ProjectUniform;



// ---------- Vertex Output Structure ----------

struct Varyings {
  @builtin(position) gl_Position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>,
};

// ---------- Vertex Shader Entry Point ----------

@vertex
fn vertexMain(
  @location(0) positions: vec3<f32>,
  @location(1) instanceSourcePositions: vec3<f32>,
  @location(2) instanceTargetPositions: vec3<f32>,
  @location(3) instanceSourcePositions64Low: vec3<f32>,
  @location(4) instanceTargetPositions64Low: vec3<f32>,
  @location(5) instanceColors: vec4<f32>,
  @location(6) instancePickingColors: vec3<f32>,
  @location(7) instanceWidths: f32
) -> Varyings {
  var geometry: Geometry;
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  var source_world: vec3<f32> = instanceSourcePositions;
  var target_world: vec3<f32> = instanceTargetPositions;
  var source_world_64low: vec3<f32> = instanceSourcePositions64Low;
  var target_world_64low: vec3<f32> = instanceTargetPositions64Low;

  // Apply shortest-path adjustments if needed.
  if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
    source_world.x = (source_world.x + 180.0 % 360.0) - 180.0;
    target_world.x = (target_world.x + 180.0 % 360.0) - 180.0;
    let deltaLng: f32 = target_world.x - source_world.x;

    if (deltaLng * line.useShortestPath > 180.0) {
      source_world.x = source_world.x + 360.0 * line.useShortestPath;
      source_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      source_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (deltaLng * line.useShortestPath < -180.0) {
      target_world.x = target_world.x + 360.0 * line.useShortestPath;
      target_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      target_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (line.useShortestPath < 0.0) {
      var abortOut: Varyings;
      abortOut.gl_Position = vec4<f32>(0.0);
      abortOut.vColor = vec4<f32>(0.0);
      abortOut.uv = vec2<f32>(0.0);
      return abortOut;
    }
  }

  // Project Pos and target positions to clip space.
  let sourceResult = project_position_to_clipspace_and_commonspace(source_world, source_world_64low, vec3<f32>(0.0));
  let targetResult = project_position_to_clipspace_and_commonspace(target_world, target_world_64low, vec3<f32>(0.0));
  let sourcePos: vec4<f32> = sourceResult.clipPosition;
  let targetPos: vec4<f32> = targetResult.clipPosition;
  let source_commonspace: vec4<f32> = sourceResult.commonPosition;
  let target_commonspace: vec4<f32> = targetResult.commonPosition;

  // Interpolate along the line segment.
  let segmentIndex: f32 = positions.x;
  let p: vec4<f32> = sourcePos + segmentIndex * (targetPos - sourcePos);
  geometry.position = source_commonspace + segmentIndex * (target_commonspace - source_commonspace);
  let uv: vec2<f32> = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Determine width in pixels.
  let widthPixels: f32 = clamp(
    project_unit_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
    line.widthMinPixels, line.widthMaxPixels
  );

  // Compute extrusion offset.
  let extrusion: vec2<f32> = getExtrusionOffset(targetPos.xy - sourcePos.xy, positions.y, widthPixels);
  let offset: vec3<f32> = vec3<f32>(extrusion, 0.0);

  // Apply deck.gl filter functions.
  let filteredOffset = deckgl_filter_size(offset, geometry);
  let filteredP = deckgl_filter_gl_position(p, geometry);

  let clipOffset: vec2<f32> = project_pixel_size_to_clipspace(filteredOffset.xy);
  let finalPosition: vec4<f32> = filteredP + vec4<f32>(clipOffset, 0.0, 0.0);

  // Compute color.
  var vColor: vec4<f32> = vec4<f32>(instanceColors.rgb, instanceColors.a * layer.opacity);
  // vColor = deckgl_filter_color(vColor, geometry);

  var output: Varyings;
  output.gl_Position = finalPosition;
  output.vColor = vColor;
  output.uv = uv;
  return output;
}

@fragment
fn fragmentMain(
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>
) -> @location(0) vec4<f32> {
  // Create and initialize geometry with the provided uv.
  var geometry: Geometry;
  geometry.uv = uv;

  // Start with the input color.
  var fragColor: vec4<f32> = vColor;

  // Apply the deck.gl filter to the color.
  fragColor = deckgl_filter_color(fragColor, geometry);

  return fragColor;
}
`,_ut=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,vut=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,but=[0,0,0,255],xut={getSourcePosition:{type:"accessor",value:e=>e.sourcePosition},getTargetPosition:{type:"accessor",value:e=>e.targetPosition},getColor:{type:"accessor",value:but},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class Dy extends Io{getBounds(){var t;return(t=this.getAttributeManager())==null?void 0:t.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:_ut,fs:vut,source:yut,modules:[Uo,pa,mut]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(t){var i;super.updateState(t),t.changeFlags.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{widthUnits:i,widthScale:n,widthMinPixels:r,widthMaxPixels:s,wrapLongitude:o}=this.props,l=this.state.model,h={widthUnits:Ds[i],widthScale:n,widthMinPixels:r,widthMaxPixels:s,useShortestPath:o?1:0};l.shaderInputs.setProps({line:h}),l.draw(this.context.renderPass),o&&(l.shaderInputs.setProps({line:{...h,useShortestPath:-1}}),l.draw(this.context.renderPass))}_getModel(){const t=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Hr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new es({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0})}}Dy.layerName="LineLayer",Dy.defaultProps=xut;const YD=`uniform pointCloudUniforms {
  float radiusPixels;
  highp int sizeUnits;
} pointCloud;
`,wut={name:"pointCloud",vs:YD,fs:YD,uniformTypes:{radiusPixels:"f32",sizeUnits:"i32"}},Cut=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Eut=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition.xy;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,qD=[0,0,0,255],$D=[0,0,1],But={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:e=>e.position},getNormal:{type:"accessor",value:$D},getColor:{type:"accessor",value:qD},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function Tut(e){const{header:t,attributes:i}=e;if(!(!t||!i)&&(e.length=t.vertexCount,i.POSITION&&(i.instancePositions=i.POSITION),i.NORMAL&&(i.instanceNormals=i.NORMAL),i.COLOR_0)){const{size:n,value:r}=i.COLOR_0;i.instanceColors={size:n,type:"unorm8",value:r}}}class Rg extends Io{getShaders(){return super.getShaders({vs:Cut,fs:Eut,modules:[Uo,M0,pa,wut]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:$D},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:qD}})}updateState(t){var i;const{changeFlags:n,props:r}=t;super.updateState(t),n.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),n.dataChanged&&Tut(r.data)}draw({uniforms:t}){const{pointSize:i,sizeUnits:n}=this.props,r=this.state.model,s={sizeUnits:Ds[n],radiusPixels:i};r.shaderInputs.setProps({pointCloud:s}),r.draw(this.context.renderPass)}_getModel(){const t=[];for(let i=0;i<3;i++){const n=i/3*Math.PI*2;t.push(Math.cos(n)*2,Math.sin(n)*2,0)}return new Hr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new es({topology:"triangle-list",attributes:{positions:new Float32Array(t)}}),isInstanced:!0})}}Rg.layerName="PointCloudLayer",Rg.defaultProps=But;const tO=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,Sut={name:"scatterplot",vs:tO,fs:tO,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},Iut=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Mut=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Put=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,eO=[0,0,0,255],Rut={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:eO},getLineColor:{type:"accessor",value:eO},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Dg extends Io{getShaders(){return super.getShaders({vs:Iut,fs:Mut,source:Put,modules:[Uo,pa,Sut]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){var i;super.updateState(t),t.changeFlags.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{radiusUnits:i,radiusScale:n,radiusMinPixels:r,radiusMaxPixels:s,stroked:o,filled:l,billboard:h,antialiasing:A,lineWidthUnits:v,lineWidthScale:C,lineWidthMinPixels:S,lineWidthMaxPixels:L}=this.props,N={stroked:o,filled:l,billboard:h,antialiasing:A,radiusUnits:Ds[i],radiusScale:n,radiusMinPixels:r,radiusMaxPixels:s,lineWidthUnits:Ds[v],lineWidthScale:C,lineWidthMinPixels:S,lineWidthMaxPixels:L},G=this.state.model;G.shaderInputs.setProps({scatterplot:N}),G.draw(this.context.renderPass)}_getModel(){const t=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Hr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new es({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0})}}Dg.defaultProps=Rut,Dg.layerName="ScatterplotLayer";const Sx={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function Ix(e,t,i={}){return Dut(e,i)!==t?(Lut(e,i),!0):!1}function Dut(e,t={}){return Math.sign(Out(e,t))}const iO={x:0,y:1,z:2};function Out(e,t={}){const{start:i=0,end:n=e.length,plane:r="xy"}=t,s=t.size||2;let o=0;const l=iO[r[0]],h=iO[r[1]];for(let A=i,v=n-s;A<n;A+=s)o+=(e[A+l]-e[v+l])*(e[A+h]+e[v+h]),v=A;return o/2}function Lut(e,t){const{start:i=0,end:n=e.length,size:r=2}=t,s=(n-i)/r,o=Math.floor(s/2);for(let l=0;l<o;++l){const h=i+l*r,A=i+(s-1-l)*r;for(let v=0;v<r;++v){const C=e[h+v];e[h+v]=e[A+v],e[A+v]=C}}}function Cl(e,t){const i=t.length,n=e.length;if(n>0){let r=!0;for(let s=0;s<i;s++)if(e[n-i+s]!==t[s]){r=!1;break}if(r)return!1}for(let r=0;r<i;r++)e[n+r]=t[r];return!0}function Mx(e,t){const i=t.length;for(let n=0;n<i;n++)e[n]=t[n]}function Og(e,t,i,n,r=[]){const s=n+t*i;for(let o=0;o<i;o++)r[o]=e[s+o];return r}function Px(e,t,i,n,r=[]){let s,o;if(i&8)s=(n[3]-e[1])/(t[1]-e[1]),o=3;else if(i&4)s=(n[1]-e[1])/(t[1]-e[1]),o=1;else if(i&2)s=(n[2]-e[0])/(t[0]-e[0]),o=2;else if(i&1)s=(n[0]-e[0])/(t[0]-e[0]),o=0;else return null;for(let l=0;l<e.length;l++)r[l]=(o&1)===l?n[o]:s*(t[l]-e[l])+e[l];return r}function Oy(e,t){let i=0;return e[0]<t[0]?i|=1:e[0]>t[2]&&(i|=2),e[1]<t[1]?i|=4:e[1]>t[3]&&(i|=8),i}function nO(e,t){const{size:i=2,broken:n=!1,gridResolution:r=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:l=e.length}=t||{},h=(l-o)/i;let A=[];const v=[A],C=Og(e,0,i,o);let S,L;const N=aO(C,r,s,[]),G=[];Cl(A,C);for(let W=1;W<h;W++){for(S=Og(e,W,i,o,S),L=Oy(S,N);L;){Px(C,S,L,N,G);const j=Oy(G,N);j&&(Px(C,G,j,N,G),L=j),Cl(A,G),Mx(C,G),kut(N,r,L),n&&A.length>i&&(A=[],v.push(A),Cl(A,C)),L=Oy(S,N)}Cl(A,S),Mx(C,S)}return n?v:v[0]}const rO=0,Fut=1;function oO(e,t=null,i){if(!e.length)return[];const{size:n=2,gridResolution:r=10,gridOffset:s=[0,0],edgeTypes:o=!1}=i||{},l=[],h=[{pos:e,types:o?new Array(e.length/n).fill(Fut):null,holes:t||[]}],A=[[],[]];let v=[];for(;h.length;){const{pos:C,types:S,holes:L}=h.shift();Nut(C,n,L[0]||C.length,A),v=aO(A[0],r,s,v);const N=Oy(A[1],v);if(N){let G=sO(C,S,n,0,L[0]||C.length,v,N);const W={pos:G[0].pos,types:G[0].types,holes:[]},j={pos:G[1].pos,types:G[1].types,holes:[]};h.push(W,j);for(let q=0;q<L.length;q++)G=sO(C,S,n,L[q],L[q+1]||C.length,v,N),G[0]&&(W.holes.push(W.pos.length),W.pos=Ly(W.pos,G[0].pos),o&&(W.types=Ly(W.types,G[0].types))),G[1]&&(j.holes.push(j.pos.length),j.pos=Ly(j.pos,G[1].pos),o&&(j.types=Ly(j.types,G[1].types)))}else{const G={positions:C};o&&(G.edgeTypes=S),L.length&&(G.holeIndices=L),l.push(G)}}return l}function sO(e,t,i,n,r,s,o){const l=(r-n)/i,h=[],A=[],v=[],C=[],S=[];let L,N,G;const W=Og(e,l-1,i,n);let j=Math.sign(o&8?W[1]-s[3]:W[0]-s[2]),q=t&&t[l-1],Z=0,K=0;for(let ft=0;ft<l;ft++)L=Og(e,ft,i,n,L),N=Math.sign(o&8?L[1]-s[3]:L[0]-s[2]),G=t&&t[n/i+ft],N&&j&&j!==N&&(Px(W,L,o,s,S),Cl(h,S)&&v.push(q),Cl(A,S)&&C.push(q)),N<=0?(Cl(h,L)&&v.push(G),Z-=N):v.length&&(v[v.length-1]=rO),N>=0?(Cl(A,L)&&C.push(G),K+=N):C.length&&(C[C.length-1]=rO),Mx(W,L),j=N,q=G;return[Z?{pos:h,types:t&&v}:null,K?{pos:A,types:t&&C}:null]}function aO(e,t,i,n){const r=Math.floor((e[0]-i[0])/t)*t+i[0],s=Math.floor((e[1]-i[1])/t)*t+i[1];return n[0]=r,n[1]=s,n[2]=r+t,n[3]=s+t,n}function kut(e,t,i){i&8?(e[1]+=t,e[3]+=t):i&4?(e[1]-=t,e[3]-=t):i&2?(e[0]+=t,e[2]+=t):i&1&&(e[0]-=t,e[2]-=t)}function Nut(e,t,i,n){let r=1/0,s=-1/0,o=1/0,l=-1/0;for(let h=0;h<i;h+=t){const A=e[h],v=e[h+1];r=A<r?A:r,s=A>s?A:s,o=v<o?v:o,l=v>l?v:l}return n[0][0]=r,n[0][1]=o,n[1][0]=s,n[1][1]=l,n}function Ly(e,t){for(let i=0;i<t.length;i++)e.push(t[i]);return e}const Uut=85.051129;function Gut(e,t){const{size:i=2,startIndex:n=0,endIndex:r=e.length,normalize:s=!0}=t||{},o=e.slice(n,r);lO(o,i,0,r-n);const l=nO(o,{size:i,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const h of l)cO(h,i);return l}function zut(e,t=null,i){const{size:n=2,normalize:r=!0,edgeTypes:s=!1}=i||{};t=t||[];const o=[],l=[];let h=0,A=0;for(let C=0;C<=t.length;C++){const S=t[C]||e.length,L=A,N=Vut(e,n,h,S);for(let G=N;G<S;G++)o[A++]=e[G];for(let G=h;G<N;G++)o[A++]=e[G];lO(o,n,L,A),jut(o,n,L,A,i==null?void 0:i.maxLatitude),h=S,l[C]=A}l.pop();const v=oO(o,l,{size:n,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(r)for(const C of v)cO(C.positions,n);return v}function Vut(e,t,i,n){let r=-1,s=-1;for(let o=i+1;o<n;o+=t){const l=Math.abs(e[o]);l>r&&(r=l,s=o-1)}return s}function jut(e,t,i,n,r=Uut){const s=e[i],o=e[n-t];if(Math.abs(s-o)>180){const l=Og(e,0,t,i);l[0]+=Math.round((o-s)/360)*360,Cl(e,l),l[1]=Math.sign(l[1])*r,Cl(e,l),l[0]=s,Cl(e,l)}}function lO(e,t,i,n){let r=e[0],s;for(let o=i;o<n;o+=t){s=e[o];const l=s-r;(l>180||l<-180)&&(s-=Math.round(l/360)*360),e[o]=r=s}}function cO(e,t){let i;const n=e.length/t;for(let s=0;s<n&&(i=e[s*t],(i+180)%360===0);s++);const r=-Math.round(i/360)*360;if(r!==0)for(let s=0;s<n;s++)e[s*t]+=r}class Hut extends es{constructor(t){const{indices:i,attributes:n}=Wut(t);super({...t,indices:i,attributes:n})}}function Wut(e){const{radius:t,height:i=1,nradial:n=10}=e;let{vertices:r}=e;r&&(Yi.assert(r.length>=n),r=r.flatMap(L=>[L[0],L[1]]),Ix(r,Sx.COUNTER_CLOCKWISE));const s=i>0,o=n+1,l=s?o*3+1:n,h=Math.PI*2/n,A=new Uint16Array(s?n*3*2:0),v=new Float32Array(l*3),C=new Float32Array(l*3);let S=0;if(s){for(let L=0;L<o;L++){const N=L*h,G=L%n,W=Math.sin(N),j=Math.cos(N);for(let q=0;q<2;q++)v[S+0]=r?r[G*2]:j*t,v[S+1]=r?r[G*2+1]:W*t,v[S+2]=(1/2-q)*i,C[S+0]=r?r[G*2]:j,C[S+1]=r?r[G*2+1]:W,S+=3}v[S+0]=v[S-3],v[S+1]=v[S-2],v[S+2]=v[S-1],S+=3}for(let L=s?0:1;L<o;L++){const N=Math.floor(L/2)*Math.sign(.5-L%2),G=N*h,W=(N+n)%n,j=Math.sin(G),q=Math.cos(G);v[S+0]=r?r[W*2]:q*t,v[S+1]=r?r[W*2+1]:j*t,v[S+2]=i/2,C[S+2]=1,S+=3}if(s){let L=0;for(let N=0;N<n;N++)A[L++]=N*2+0,A[L++]=N*2+2,A[L++]=N*2+0,A[L++]=N*2+1,A[L++]=N*2+1,A[L++]=N*2+3}return{indices:A,attributes:{POSITION:{size:3,value:v},NORMAL:{size:3,value:C}}}}const uO=`uniform columnUniforms {
  float radius;
  float angle;
  vec2 offset;
  bool extruded;
  bool stroked;
  bool isStroke;
  float coverage;
  float elevationScale;
  float edgeDistance;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int radiusUnits;
  highp int widthUnits;
} column;
`,Jut={name:"column",vs:uO,fs:uO,uniformTypes:{radius:"f32",angle:"f32",offset:"vec2<f32>",extruded:"f32",stroked:"f32",isStroke:"f32",coverage:"f32",elevationScale:"f32",edgeDistance:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",radiusUnits:"i32",widthUnits:"i32"}},Xut=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec3 cameraPosition;
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(column.angle), sin(column.angle), -sin(column.angle), cos(column.angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * column.widthScale, column.widthUnits),
column.widthMinPixels, column.widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(column.edgeDistance * column.coverage * column.radius);
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = column.radius * column.coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + column.offset) * dotRadius;
if (column.radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
cameraPosition = project.cameraPosition;
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Kut=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec3 cameraPosition;
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (column.extruded && !column.isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, cameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Fy=[0,0,0,255],Qut={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:e=>e.position},getFillColor:{type:"accessor",value:Fy},getLineColor:{type:"accessor",value:Fy},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class dc extends Io{getShaders(){const t={},{flatShading:i}=this.props;return i&&(t.FLAT_SHADING=1),super.getShaders({vs:Xut,fs:Kut,defines:t,modules:[Uo,i?fb:M0,pa,Jut]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:Fy},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:Fy},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(t){var i;super.updateState(t);const{props:n,oldProps:r,changeFlags:s}=t,o=s.extensionsChanged||n.flatShading!==r.flatShading;o&&((i=this.state.models)==null||i.forEach(h=>h.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());const l=this.getNumInstances();this.state.fillModel.setInstanceCount(l),this.state.wireframeModel.setInstanceCount(l),(o||n.diskResolution!==r.diskResolution||n.vertices!==r.vertices||(n.extruded||n.stroked)!==(r.extruded||r.stroked))&&this._updateGeometry(n)}getGeometry(t,i,n){const r=new Hut({radius:1,height:n?2:0,vertices:i,nradial:t});let s=0;if(i)for(let o=0;o<t;o++){const l=i[o],h=Math.sqrt(l[0]*l[0]+l[1]*l[1]);s+=h/t}else s=1;return this.setState({edgeDistance:Math.cos(Math.PI/t)*s}),r}_getModels(){const t=this.getShaders(),i=this.getAttributeManager().getBufferLayouts(),n=new Hr(this.context.device,{...t,id:`${this.props.id}-fill`,bufferLayout:i,isInstanced:!0}),r=new Hr(this.context.device,{...t,id:`${this.props.id}-wireframe`,bufferLayout:i,isInstanced:!0});return{fillModel:n,wireframeModel:r,models:[r,n]}}_updateGeometry({diskResolution:t,vertices:i,extruded:n,stroked:r}){const s=this.getGeometry(t,i,n||r);this.setState({fillVertexCount:s.attributes.POSITION.value.length/3});const o=this.state.fillModel,l=this.state.wireframeModel;o.setGeometry(s),o.setTopology("triangle-strip"),o.setIndexBuffer(null),l.setGeometry(s),l.setTopology("line-list")}draw({uniforms:t}){const{lineWidthUnits:i,lineWidthScale:n,lineWidthMinPixels:r,lineWidthMaxPixels:s,radiusUnits:o,elevationScale:l,extruded:h,filled:A,stroked:v,wireframe:C,offset:S,coverage:L,radius:N,angle:G}=this.props,W=this.state.fillModel,j=this.state.wireframeModel,{fillVertexCount:q,edgeDistance:Z}=this.state,K={radius:N,angle:G/180*Math.PI,offset:S,extruded:h,stroked:v,coverage:L,elevationScale:l,edgeDistance:Z,radiusUnits:Ds[o],widthUnits:Ds[i],widthScale:n,widthMinPixels:r,widthMaxPixels:s};h&&C&&(j.shaderInputs.setProps({column:{...K,isStroke:!0}}),j.draw(this.context.renderPass)),A&&(W.setVertexCount(q),W.shaderInputs.setProps({column:{...K,isStroke:!1}}),W.draw(this.context.renderPass)),!h&&v&&(W.setVertexCount(q*2/3),W.shaderInputs.setProps({column:{...K,isStroke:!0}}),W.draw(this.context.renderPass))}}dc.layerName="ColumnLayer",dc.defaultProps=Qut;const Zut={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}};let Rx=class extends dc{_updateGeometry(){const e=new oP;this.state.fillModel.setGeometry(e)}draw({uniforms:e}){const{elevationScale:t,extruded:i,offset:n,coverage:r,cellSize:s,angle:o,radiusUnits:l}=this.props,h=this.state.fillModel,A={radius:s/2,radiusUnits:Ds[l],angle:o,offset:n,extruded:i,stroked:!1,coverage:r,elevationScale:t,edgeDistance:1,isStroke:!1,widthUnits:0,widthScale:0,widthMinPixels:0,widthMaxPixels:0};h.shaderInputs.setProps({column:A}),h.draw(this.context.renderPass)}};Rx.layerName="GridCellLayer",Rx.defaultProps=Zut;function Yut(e,t,i,n){let r;if(Array.isArray(e[0])){const s=e.length*t;r=new Array(s);for(let o=0;o<e.length;o++)for(let l=0;l<t;l++)r[o*t+l]=e[o][l]||0}else r=e;return i?nO(r,{size:t,gridResolution:i}):n?Gut(r,{size:t}):r}const qut=1,$ut=2,Dx=4;class tht extends _4{constructor(t){super({...t,attributes:{positions:{size:3,padding:18,initialize:!0,type:t.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(t){return this.attributes[t]}getGeometryFromBuffer(t){return this.normalize?super.getGeometryFromBuffer(t):null}normalizeGeometry(t){return this.normalize?Yut(t,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):t}getGeometrySize(t){if(hO(t)){let n=0;for(const r of t)n+=this.getGeometrySize(r);return n}const i=this.getPathLength(t);return i<2?0:this.isClosed(t)?i<3?0:i+2:i}updateGeometryAttributes(t,i){if(i.geometrySize!==0)if(t&&hO(t))for(const n of t){const r=this.getGeometrySize(n);i.geometrySize=r,this.updateGeometryAttributes(n,i),i.vertexStart+=r}else this._updateSegmentTypes(t,i),this._updatePositions(t,i)}_updateSegmentTypes(t,i){const n=this.attributes.segmentTypes,r=t?this.isClosed(t):!1,{vertexStart:s,geometrySize:o}=i;n.fill(0,s,s+o),r?(n[s]=Dx,n[s+o-2]=Dx):(n[s]+=qut,n[s+o-2]+=$ut),n[s+o-1]=Dx}_updatePositions(t,i){const{positions:n}=this.attributes;if(!n||!t)return;const{vertexStart:r,geometrySize:s}=i,o=new Array(3);for(let l=r,h=0;h<s;l++,h++)this.getPointOnPath(t,h,o),n[l*3]=o[0],n[l*3+1]=o[1],n[l*3+2]=o[2]}getPathLength(t){return t.length/this.positionSize}getPointOnPath(t,i,n=[]){const{positionSize:r}=this;i*r>=t.length&&(i+=1-t.length/r);const s=i*r;return n[0]=t[s],n[1]=t[s+1],n[2]=r===3&&t[s+2]||0,n}isClosed(t){if(!this.normalize)return!!this.opts.loop;const{positionSize:i}=this,n=t.length-i;return t[0]===t[n]&&t[1]===t[n+1]&&(i===2||t[2]===t[n+2])}}function hO(e){return Array.isArray(e[0])}const fO=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,eht={name:"path",vs:fO,fs:fO,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},iht=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,nht=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,dO=[0,0,0,255],rht={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:e=>e.path},getColor:{type:"accessor",value:dO},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Ox={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class ch extends Io{getShaders(){return super.getShaders({vs:iht,fs:nht,modules:[Uo,pa,eht]})}get wrapLongitude(){return!1}getBounds(){var t;return(t=this.getAttributeManager())==null?void 0:t.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:Ox,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Ox,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:Ox,defaultValue:dO},instancePickingColors:{size:4,type:"uint8",accessor:(t,{index:i,target:n})=>this.encodePickingColor(t&&t.__source?t.__source.index:i,n)}}),this.setState({pathTesselator:new tht({fp64:this.use64bitPositions()})})}updateState(t){var i;super.updateState(t);const{props:n,changeFlags:r}=t,s=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:o}=this.state,l=n.data.attributes||{};o.updateGeometry({data:n.data,geometryBuffer:l.getPath,buffers:l,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),r.dataChanged||s.invalidateAll()}r.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),s.invalidateAll())}getPickingInfo(t){const i=super.getPickingInfo(t),{index:n}=i,r=this.props.data;return r[0]&&r[0].__source&&(i.object=r.find(s=>s.__source.index===n)),i}disablePickingIndex(t){const i=this.props.data;if(i[0]&&i[0].__source)for(let n=0;n<i.length;n++)i[n].__source.index===t&&this._disablePickingIndex(n);else super.disablePickingIndex(t)}draw({uniforms:t}){const{jointRounded:i,capRounded:n,billboard:r,miterLimit:s,widthUnits:o,widthScale:l,widthMinPixels:h,widthMaxPixels:A}=this.props,v=this.state.model,C={jointType:Number(i),capType:Number(n),billboard:r,widthUnits:Ds[o],widthScale:l,miterLimit:s,widthMinPixels:h,widthMaxPixels:A};v.shaderInputs.setProps({path:C}),v.draw(this.context.renderPass)}_getModel(){const t=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Hr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new es({topology:"triangle-list",attributes:{indices:new Uint16Array(t),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(t){const{pathTesselator:i}=this.state;t.startIndices=i.vertexStarts,t.value=i.get("positions")}calculateSegmentTypes(t){const{pathTesselator:i}=this.state;t.startIndices=i.vertexStarts,t.value=i.get("segmentTypes")}}ch.defaultProps=rht,ch.layerName="PathLayer";var ky={exports:{}},pO;function oht(){if(pO)return ky.exports;pO=1,ky.exports=e,ky.exports.default=e;function e(Ct,Dt,Gt){Gt=Gt||2;var te=Dt&&Dt.length,re=te?Dt[0]*Gt:Ct.length,ae=t(Ct,0,re,Gt,!0),he=[];if(!ae||ae.next===ae.prev)return he;var Pe,Se,se,fi,Ze,Ye,ze;if(te&&(ae=h(Ct,Dt,ae,Gt)),Ct.length>80*Gt){Pe=se=Ct[0],Se=fi=Ct[1];for(var pi=Gt;pi<re;pi+=Gt)Ze=Ct[pi],Ye=Ct[pi+1],Ze<Pe&&(Pe=Ze),Ye<Se&&(Se=Ye),Ze>se&&(se=Ze),Ye>fi&&(fi=Ye);ze=Math.max(se-Pe,fi-Se),ze=ze!==0?32767/ze:0}return n(ae,he,Gt,Pe,Se,ze,0),he}function t(Ct,Dt,Gt,te,re){var ae,he;if(re===pe(Ct,Dt,Gt,te)>0)for(ae=Dt;ae<Gt;ae+=te)he=X(ae,Ct[ae],Ct[ae+1],he);else for(ae=Gt-te;ae>=Dt;ae-=te)he=X(ae,Ct[ae],Ct[ae+1],he);return he&&K(he,he.next)&&(ht(he),he=he.next),he}function i(Ct,Dt){if(!Ct)return Ct;Dt||(Dt=Ct);var Gt=Ct,te;do if(te=!1,!Gt.steiner&&(K(Gt,Gt.next)||Z(Gt.prev,Gt,Gt.next)===0)){if(ht(Gt),Gt=Dt=Gt.prev,Gt===Gt.next)break;te=!0}else Gt=Gt.next;while(te||Gt!==Dt);return Dt}function n(Ct,Dt,Gt,te,re,ae,he){if(Ct){!he&&ae&&L(Ct,te,re,ae);for(var Pe=Ct,Se,se;Ct.prev!==Ct.next;){if(Se=Ct.prev,se=Ct.next,ae?s(Ct,te,re,ae):r(Ct)){Dt.push(Se.i/Gt|0),Dt.push(Ct.i/Gt|0),Dt.push(se.i/Gt|0),ht(Ct),Ct=se.next,Pe=se.next;continue}if(Ct=se,Ct===Pe){he?he===1?(Ct=o(i(Ct),Dt,Gt),n(Ct,Dt,Gt,te,re,ae,2)):he===2&&l(Ct,Dt,Gt,te,re,ae):n(i(Ct),Dt,Gt,te,re,ae,1);break}}}}function r(Ct){var Dt=Ct.prev,Gt=Ct,te=Ct.next;if(Z(Dt,Gt,te)>=0)return!1;for(var re=Dt.x,ae=Gt.x,he=te.x,Pe=Dt.y,Se=Gt.y,se=te.y,fi=re<ae?re<he?re:he:ae<he?ae:he,Ze=Pe<Se?Pe<se?Pe:se:Se<se?Se:se,Ye=re>ae?re>he?re:he:ae>he?ae:he,ze=Pe>Se?Pe>se?Pe:se:Se>se?Se:se,pi=te.next;pi!==Dt;){if(pi.x>=fi&&pi.x<=Ye&&pi.y>=Ze&&pi.y<=ze&&j(re,Pe,ae,Se,he,se,pi.x,pi.y)&&Z(pi.prev,pi,pi.next)>=0)return!1;pi=pi.next}return!0}function s(Ct,Dt,Gt,te){var re=Ct.prev,ae=Ct,he=Ct.next;if(Z(re,ae,he)>=0)return!1;for(var Pe=re.x,Se=ae.x,se=he.x,fi=re.y,Ze=ae.y,Ye=he.y,ze=Pe<Se?Pe<se?Pe:se:Se<se?Se:se,pi=fi<Ze?fi<Ye?fi:Ye:Ze<Ye?Ze:Ye,sn=Pe>Se?Pe>se?Pe:se:Se>se?Se:se,Ii=fi>Ze?fi>Ye?fi:Ye:Ze>Ye?Ze:Ye,_i=G(ze,pi,Dt,Gt,te),Fn=G(sn,Ii,Dt,Gt,te),Ai=Ct.prevZ,vi=Ct.nextZ;Ai&&Ai.z>=_i&&vi&&vi.z<=Fn;){if(Ai.x>=ze&&Ai.x<=sn&&Ai.y>=pi&&Ai.y<=Ii&&Ai!==re&&Ai!==he&&j(Pe,fi,Se,Ze,se,Ye,Ai.x,Ai.y)&&Z(Ai.prev,Ai,Ai.next)>=0||(Ai=Ai.prevZ,vi.x>=ze&&vi.x<=sn&&vi.y>=pi&&vi.y<=Ii&&vi!==re&&vi!==he&&j(Pe,fi,Se,Ze,se,Ye,vi.x,vi.y)&&Z(vi.prev,vi,vi.next)>=0))return!1;vi=vi.nextZ}for(;Ai&&Ai.z>=_i;){if(Ai.x>=ze&&Ai.x<=sn&&Ai.y>=pi&&Ai.y<=Ii&&Ai!==re&&Ai!==he&&j(Pe,fi,Se,Ze,se,Ye,Ai.x,Ai.y)&&Z(Ai.prev,Ai,Ai.next)>=0)return!1;Ai=Ai.prevZ}for(;vi&&vi.z<=Fn;){if(vi.x>=ze&&vi.x<=sn&&vi.y>=pi&&vi.y<=Ii&&vi!==re&&vi!==he&&j(Pe,fi,Se,Ze,se,Ye,vi.x,vi.y)&&Z(vi.prev,vi,vi.next)>=0)return!1;vi=vi.nextZ}return!0}function o(Ct,Dt,Gt){var te=Ct;do{var re=te.prev,ae=te.next.next;!K(re,ae)&&ft(re,te,te.next,ae)&&At(re,ae)&&At(ae,re)&&(Dt.push(re.i/Gt|0),Dt.push(te.i/Gt|0),Dt.push(ae.i/Gt|0),ht(te),ht(te.next),te=Ct=ae),te=te.next}while(te!==Ct);return i(te)}function l(Ct,Dt,Gt,te,re,ae){var he=Ct;do{for(var Pe=he.next.next;Pe!==he.prev;){if(he.i!==Pe.i&&q(he,Pe)){var Se=kt(he,Pe);he=i(he,he.next),Se=i(Se,Se.next),n(he,Dt,Gt,te,re,ae,0),n(Se,Dt,Gt,te,re,ae,0);return}Pe=Pe.next}he=he.next}while(he!==Ct)}function h(Ct,Dt,Gt,te){var re=[],ae,he,Pe,Se,se;for(ae=0,he=Dt.length;ae<he;ae++)Pe=Dt[ae]*te,Se=ae<he-1?Dt[ae+1]*te:Ct.length,se=t(Ct,Pe,Se,te,!1),se===se.next&&(se.steiner=!0),re.push(W(se));for(re.sort(A),ae=0;ae<re.length;ae++)Gt=v(re[ae],Gt);return Gt}function A(Ct,Dt){return Ct.x-Dt.x}function v(Ct,Dt){var Gt=C(Ct,Dt);if(!Gt)return Dt;var te=kt(Gt,Ct);return i(te,te.next),i(Gt,Gt.next)}function C(Ct,Dt){var Gt=Dt,te=Ct.x,re=Ct.y,ae=-1/0,he;do{if(re<=Gt.y&&re>=Gt.next.y&&Gt.next.y!==Gt.y){var Pe=Gt.x+(re-Gt.y)*(Gt.next.x-Gt.x)/(Gt.next.y-Gt.y);if(Pe<=te&&Pe>ae&&(ae=Pe,he=Gt.x<Gt.next.x?Gt:Gt.next,Pe===te))return he}Gt=Gt.next}while(Gt!==Dt);if(!he)return null;var Se=he,se=he.x,fi=he.y,Ze=1/0,Ye;Gt=he;do te>=Gt.x&&Gt.x>=se&&te!==Gt.x&&j(re<fi?te:ae,re,se,fi,re<fi?ae:te,re,Gt.x,Gt.y)&&(Ye=Math.abs(re-Gt.y)/(te-Gt.x),At(Gt,Ct)&&(Ye<Ze||Ye===Ze&&(Gt.x>he.x||Gt.x===he.x&&S(he,Gt)))&&(he=Gt,Ze=Ye)),Gt=Gt.next;while(Gt!==Se);return he}function S(Ct,Dt){return Z(Ct.prev,Ct,Dt.prev)<0&&Z(Dt.next,Ct,Ct.next)<0}function L(Ct,Dt,Gt,te){var re=Ct;do re.z===0&&(re.z=G(re.x,re.y,Dt,Gt,te)),re.prevZ=re.prev,re.nextZ=re.next,re=re.next;while(re!==Ct);re.prevZ.nextZ=null,re.prevZ=null,N(re)}function N(Ct){var Dt,Gt,te,re,ae,he,Pe,Se,se=1;do{for(Gt=Ct,Ct=null,ae=null,he=0;Gt;){for(he++,te=Gt,Pe=0,Dt=0;Dt<se&&(Pe++,te=te.nextZ,!!te);Dt++);for(Se=se;Pe>0||Se>0&&te;)Pe!==0&&(Se===0||!te||Gt.z<=te.z)?(re=Gt,Gt=Gt.nextZ,Pe--):(re=te,te=te.nextZ,Se--),ae?ae.nextZ=re:Ct=re,re.prevZ=ae,ae=re;Gt=te}ae.nextZ=null,se*=2}while(he>1);return Ct}function G(Ct,Dt,Gt,te,re){return Ct=(Ct-Gt)*re|0,Dt=(Dt-te)*re|0,Ct=(Ct|Ct<<8)&16711935,Ct=(Ct|Ct<<4)&252645135,Ct=(Ct|Ct<<2)&858993459,Ct=(Ct|Ct<<1)&1431655765,Dt=(Dt|Dt<<8)&16711935,Dt=(Dt|Dt<<4)&252645135,Dt=(Dt|Dt<<2)&858993459,Dt=(Dt|Dt<<1)&1431655765,Ct|Dt<<1}function W(Ct){var Dt=Ct,Gt=Ct;do(Dt.x<Gt.x||Dt.x===Gt.x&&Dt.y<Gt.y)&&(Gt=Dt),Dt=Dt.next;while(Dt!==Ct);return Gt}function j(Ct,Dt,Gt,te,re,ae,he,Pe){return(re-he)*(Dt-Pe)>=(Ct-he)*(ae-Pe)&&(Ct-he)*(te-Pe)>=(Gt-he)*(Dt-Pe)&&(Gt-he)*(ae-Pe)>=(re-he)*(te-Pe)}function q(Ct,Dt){return Ct.next.i!==Dt.i&&Ct.prev.i!==Dt.i&&!Vt(Ct,Dt)&&(At(Ct,Dt)&&At(Dt,Ct)&&at(Ct,Dt)&&(Z(Ct.prev,Ct,Dt.prev)||Z(Ct,Dt.prev,Dt))||K(Ct,Dt)&&Z(Ct.prev,Ct,Ct.next)>0&&Z(Dt.prev,Dt,Dt.next)>0)}function Z(Ct,Dt,Gt){return(Dt.y-Ct.y)*(Gt.x-Dt.x)-(Dt.x-Ct.x)*(Gt.y-Dt.y)}function K(Ct,Dt){return Ct.x===Dt.x&&Ct.y===Dt.y}function ft(Ct,Dt,Gt,te){var re=Lt(Z(Ct,Dt,Gt)),ae=Lt(Z(Ct,Dt,te)),he=Lt(Z(Gt,te,Ct)),Pe=Lt(Z(Gt,te,Dt));return!!(re!==ae&&he!==Pe||re===0&&rt(Ct,Gt,Dt)||ae===0&&rt(Ct,te,Dt)||he===0&&rt(Gt,Ct,te)||Pe===0&&rt(Gt,Dt,te))}function rt(Ct,Dt,Gt){return Dt.x<=Math.max(Ct.x,Gt.x)&&Dt.x>=Math.min(Ct.x,Gt.x)&&Dt.y<=Math.max(Ct.y,Gt.y)&&Dt.y>=Math.min(Ct.y,Gt.y)}function Lt(Ct){return Ct>0?1:Ct<0?-1:0}function Vt(Ct,Dt){var Gt=Ct;do{if(Gt.i!==Ct.i&&Gt.next.i!==Ct.i&&Gt.i!==Dt.i&&Gt.next.i!==Dt.i&&ft(Gt,Gt.next,Ct,Dt))return!0;Gt=Gt.next}while(Gt!==Ct);return!1}function At(Ct,Dt){return Z(Ct.prev,Ct,Ct.next)<0?Z(Ct,Dt,Ct.next)>=0&&Z(Ct,Ct.prev,Dt)>=0:Z(Ct,Dt,Ct.prev)<0||Z(Ct,Ct.next,Dt)<0}function at(Ct,Dt){var Gt=Ct,te=!1,re=(Ct.x+Dt.x)/2,ae=(Ct.y+Dt.y)/2;do Gt.y>ae!=Gt.next.y>ae&&Gt.next.y!==Gt.y&&re<(Gt.next.x-Gt.x)*(ae-Gt.y)/(Gt.next.y-Gt.y)+Gt.x&&(te=!te),Gt=Gt.next;while(Gt!==Ct);return te}function kt(Ct,Dt){var Gt=new Mt(Ct.i,Ct.x,Ct.y),te=new Mt(Dt.i,Dt.x,Dt.y),re=Ct.next,ae=Dt.prev;return Ct.next=Dt,Dt.prev=Ct,Gt.next=re,re.prev=Gt,te.next=Gt,Gt.prev=te,ae.next=te,te.prev=ae,te}function X(Ct,Dt,Gt,te){var re=new Mt(Ct,Dt,Gt);return te?(re.next=te.next,re.prev=te,te.next.prev=re,te.next=re):(re.prev=re,re.next=re),re}function ht(Ct){Ct.next.prev=Ct.prev,Ct.prev.next=Ct.next,Ct.prevZ&&(Ct.prevZ.nextZ=Ct.nextZ),Ct.nextZ&&(Ct.nextZ.prevZ=Ct.prevZ)}function Mt(Ct,Dt,Gt){this.i=Ct,this.x=Dt,this.y=Gt,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}e.deviation=function(Ct,Dt,Gt,te){var re=Dt&&Dt.length,ae=re?Dt[0]*Gt:Ct.length,he=Math.abs(pe(Ct,0,ae,Gt));if(re)for(var Pe=0,Se=Dt.length;Pe<Se;Pe++){var se=Dt[Pe]*Gt,fi=Pe<Se-1?Dt[Pe+1]*Gt:Ct.length;he-=Math.abs(pe(Ct,se,fi,Gt))}var Ze=0;for(Pe=0;Pe<te.length;Pe+=3){var Ye=te[Pe]*Gt,ze=te[Pe+1]*Gt,pi=te[Pe+2]*Gt;Ze+=Math.abs((Ct[Ye]-Ct[pi])*(Ct[ze+1]-Ct[Ye+1])-(Ct[Ye]-Ct[ze])*(Ct[pi+1]-Ct[Ye+1]))}return he===0&&Ze===0?0:Math.abs((Ze-he)/he)};function pe(Ct,Dt,Gt,te){for(var re=0,ae=Dt,he=Gt-te;ae<Gt;ae+=te)re+=(Ct[he]-Ct[ae])*(Ct[ae+1]+Ct[he+1]),he=ae;return re}return e.flatten=function(Ct){for(var Dt=Ct[0][0].length,Gt={vertices:[],holes:[],dimensions:Dt},te=0,re=0;re<Ct.length;re++){for(var ae=0;ae<Ct[re].length;ae++)for(var he=0;he<Dt;he++)Gt.vertices.push(Ct[re][ae][he]);re>0&&(te+=Ct[re-1].length,Gt.holes.push(te))}return Gt},ky.exports}var sht=oht();const AO=Jh(sht),Ny=Sx.CLOCKWISE,gO=Sx.COUNTER_CLOCKWISE,uh={};function aht(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}function Lg(e){return"positions"in e?e.positions:e}function Uy(e){return"holeIndices"in e?e.holeIndices:null}function lht(e){return Array.isArray(e[0])}function cht(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}function uht(e){const t=e[0],i=e[e.length-1];return t[0]===i[0]&&t[1]===i[1]&&t[2]===i[2]}function hht(e,t,i,n){for(let r=0;r<t;r++)if(e[i+r]!==e[n-t+r])return!1;return!0}function mO(e,t,i,n,r){let s=t;const o=i.length;for(let l=0;l<o;l++)for(let h=0;h<n;h++)e[s++]=i[l][h]||0;if(!uht(i))for(let l=0;l<n;l++)e[s++]=i[0][l]||0;return uh.start=t,uh.end=s,uh.size=n,Ix(e,r,uh),s}function yO(e,t,i,n,r=0,s,o){s=s||i.length;const l=s-r;if(l<=0)return t;let h=t;for(let A=0;A<l;A++)e[h++]=i[r+A];if(!hht(i,n,r,s))for(let A=0;A<n;A++)e[h++]=i[r+A];return uh.start=t,uh.end=h,uh.size=n,Ix(e,o,uh),h}function _O(e,t){aht(e);const i=[],n=[];if("positions"in e){const{positions:r,holeIndices:s}=e;if(s){let o=0;for(let l=0;l<=s.length;l++)o=yO(i,o,r,t,s[l-1],s[l],l===0?Ny:gO),n.push(o);return n.pop(),{positions:i,holeIndices:n}}e=r}if(!lht(e))return yO(i,0,e,t,0,i.length,Ny),i;if(!cht(e)){let r=0;for(const[s,o]of e.entries())r=mO(i,r,o,t,s===0?Ny:gO),n.push(r);return n.pop(),{positions:i,holeIndices:n}}return mO(i,0,e,t,Ny),i}function Lx(e,t,i){const n=e.length/3;let r=0;for(let s=0;s<n;s++){const o=(s+1)%n;r+=e[s*3+t]*e[o*3+i],r-=e[o*3+t]*e[s*3+i]}return Math.abs(r/2)}function vO(e,t,i,n){const r=e.length/3;for(let s=0;s<r;s++){const o=s*3,l=e[o+0],h=e[o+1],A=e[o+2];e[o+t]=l,e[o+i]=h,e[o+n]=A}}function fht(e,t,i,n){let r=Uy(e);r&&(r=r.map(l=>l/t));let s=Lg(e);const o=n&&t===3;if(i){const l=s.length;s=s.slice();const h=[];for(let A=0;A<l;A+=t){h[0]=s[A],h[1]=s[A+1],o&&(h[2]=s[A+2]);const v=i(h);s[A]=v[0],s[A+1]=v[1],o&&(s[A+2]=v[2])}}if(o){const l=Lx(s,0,1),h=Lx(s,0,2),A=Lx(s,1,2);if(!l&&!h&&!A)return[];l>h&&l>A||(h>A?(i||(s=s.slice()),vO(s,0,2,1)):(i||(s=s.slice()),vO(s,2,0,1)))}return AO(s,r,t)}class dht extends _4{constructor(t){const{fp64:i,IndexType:n=Uint32Array}=t;super({...t,attributes:{positions:{size:3,type:i?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:n,size:1}}})}get(t){const{attributes:i}=this;return t==="indices"?i.indices&&i.indices.subarray(0,this.vertexCount):i[t]}updateGeometry(t){super.updateGeometry(t);const i=this.buffers.indices;if(i)this.vertexCount=(i.value||i).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(t){if(this.normalize){const i=_O(t,this.positionSize);return this.opts.resolution?oO(Lg(i),Uy(i),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?zut(Lg(i),Uy(i),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):i}return t}getGeometrySize(t){if(bO(t)){let i=0;for(const n of t)i+=this.getGeometrySize(n);return i}return Lg(t).length/this.positionSize}getGeometryFromBuffer(t){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(t):null}updateGeometryAttributes(t,i){if(t&&bO(t))for(const n of t){const r=this.getGeometrySize(n);i.geometrySize=r,this.updateGeometryAttributes(n,i),i.vertexStart+=r,i.indexStart=this.indexStarts[i.geometryIndex+1]}else{const n=t;this._updateIndices(n,i),this._updatePositions(n,i),this._updateVertexValid(n,i)}}_updateIndices(t,{geometryIndex:i,vertexStart:n,indexStart:r}){const{attributes:s,indexStarts:o,typedArrayManager:l}=this;let h=s.indices;if(!h||!t)return;let A=r;const v=fht(t,this.positionSize,this.opts.preproject,this.opts.full3d);h=l.allocate(h,r+v.length,{copy:!0});for(let C=0;C<v.length;C++)h[A++]=v[C]+n;o[i+1]=r+v.length,s.indices=h}_updatePositions(t,{vertexStart:i,geometrySize:n}){const{attributes:{positions:r},positionSize:s}=this;if(!r||!t)return;const o=Lg(t);for(let l=i,h=0;h<n;l++,h++){const A=o[h*s],v=o[h*s+1],C=s>2?o[h*s+2]:0;r[l*3]=A,r[l*3+1]=v,r[l*3+2]=C}}_updateVertexValid(t,{vertexStart:i,geometrySize:n}){const{positionSize:r}=this,s=this.attributes.vertexValid,o=t&&Uy(t);if(t&&t.edgeTypes?s.set(t.edgeTypes,i):s.fill(1,i,i+n),o)for(let l=0;l<o.length;l++)s[i+o[l]/r-1]=0;s[i+n-1]=0}}function bO(e){return Array.isArray(e)&&e.length>0&&!Number.isFinite(e[0])}const xO=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,pht={name:"solidPolygon",vs:xO,fs:xO,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},wO=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Aht=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${wO}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,ght=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${wO}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,mht=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Gy=[0,0,0,255],yht={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:e=>e.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Gy},getLineColor:{type:"accessor",value:Gy},material:!0},zy={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class hh extends Io{getShaders(t){return super.getShaders({vs:t==="top"?Aht:ght,fs:mht,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Uo,M0,pa,pht]})}get wrapLongitude(){return!1}getBounds(){var t;return(t=this.getAttributeManager())==null?void 0:t.getBounds(["vertexPositions"])}initializeState(){const{viewport:t}=this.context;let{coordinateSystem:i}=this.props;const{_full3d:n}=this.props;t.isGeospatial&&i===qi.DEFAULT&&(i=qi.LNGLAT);let r;i===qi.LNGLAT&&(n?r=t.projectPosition.bind(t):r=t.projectFlat.bind(t)),this.setState({numInstances:0,polygonTesselator:new dht({preproject:r,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const s=this.getAttributeManager(),o=!0;s.remove(["instancePickingColors"]),s.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:zy,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,stepMode:"dynamic",transition:zy,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:zy,accessor:"getFillColor",defaultValue:Gy},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:zy,accessor:"getLineColor",defaultValue:Gy},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(l,{index:h,target:A})=>this.encodePickingColor(l&&l.__source?l.__source.index:h,A)}})}getPickingInfo(t){const i=super.getPickingInfo(t),{index:n}=i,r=this.props.data;return r[0]&&r[0].__source&&(i.object=r.find(s=>s.__source.index===n)),i}disablePickingIndex(t){const i=this.props.data;if(i[0]&&i[0].__source)for(let n=0;n<i.length;n++)i[n].__source.index===t&&this._disablePickingIndex(n);else super.disablePickingIndex(t)}draw({uniforms:t}){const{extruded:i,filled:n,wireframe:r,elevationScale:s}=this.props,{topModel:o,sideModel:l,wireframeModel:h,polygonTesselator:A}=this.state,v={extruded:!!i,elevationScale:s,isWireframe:!1};h&&r&&(h.setInstanceCount(A.instanceCount-1),h.shaderInputs.setProps({solidPolygon:{...v,isWireframe:!0}}),h.draw(this.context.renderPass)),l&&n&&(l.setInstanceCount(A.instanceCount-1),l.shaderInputs.setProps({solidPolygon:v}),l.draw(this.context.renderPass)),o&&n&&(o.setVertexCount(A.vertexCount),o.shaderInputs.setProps({solidPolygon:v}),o.draw(this.context.renderPass))}updateState(t){var i;super.updateState(t),this.updateGeometry(t);const{props:n,oldProps:r,changeFlags:s}=t,o=this.getAttributeManager();(s.extensionsChanged||n.filled!==r.filled||n.extruded!==r.extruded)&&((i=this.state.models)==null||i.forEach(l=>l.destroy()),this.setState(this._getModels()),o.invalidateAll())}updateGeometry({props:t,oldProps:i,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:r}=this.state,s=t.data.attributes||{};r.updateGeometry({data:t.data,normalize:t._normalize,geometryBuffer:s.getPolygon,buffers:s,getGeometry:t.getPolygon,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged,full3d:t._full3d}),this.setState({numInstances:r.instanceCount,startIndices:r.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:t,filled:i,extruded:n}=this.props;let r,s,o;if(i){const l=this.getShaders("top");l.defines.NON_INSTANCED_MODEL=1;const h=this.getAttributeManager().getBufferLayouts({isInstanced:!1});r=new Hr(this.context.device,{...l,id:`${t}-top`,topology:"triangle-list",bufferLayout:h,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(n){const l=this.getAttributeManager().getBufferLayouts({isInstanced:!0});s=new Hr(this.context.device,{...this.getShaders("side"),id:`${t}-side`,bufferLayout:l,geometry:new es({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),o=new Hr(this.context.device,{...this.getShaders("side"),id:`${t}-wireframe`,bufferLayout:l,geometry:new es({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[s,o,r].filter(Boolean),topModel:r,sideModel:s,wireframeModel:o}}calculateIndices(t){const{polygonTesselator:i}=this.state;t.startIndices=i.indexStarts,t.value=i.get("indices")}calculatePositions(t){const{polygonTesselator:i}=this.state;t.startIndices=i.vertexStarts,t.value=i.get("positions")}calculateVertexValid(t){t.value=this.state.polygonTesselator.get("vertexValid")}}hh.defaultProps=yht,hh.layerName="SolidPolygonLayer";function CO({data:e,getIndex:t,dataRange:i,replace:n}){const{startRow:r=0,endRow:s=1/0}=i,o=e.length;let l=o,h=o;for(let C=0;C<o;C++){const S=t(e[C]);if(l>C&&S>=r&&(l=C),S>=s){h=C;break}}let A=l;const v=h-l!==n.length?e.slice(h):void 0;for(let C=0;C<n.length;C++)e[A++]=n[C];if(v){for(let C=0;C<v.length;C++)e[A++]=v[C];e.length=A}return{startRow:l,endRow:l+n.length}}const EO=[0,0,0,255],_ht=[0,0,0,255],vht={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:e=>e.polygon},getFillColor:{type:"accessor",value:_ht},getLineColor:{type:"accessor",value:EO},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class fh extends Mo{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&Yi.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:t}){const i=t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getPolygon);if(i&&Array.isArray(t.dataChanged)){const n=this.state.paths.slice(),r=t.dataChanged.map(s=>CO({data:n,getIndex:o=>o.__source.index,dataRange:s,replace:this._getPaths(s)}));this.setState({paths:n,pathsDiff:r})}else i&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(t={}){const{data:i,getPolygon:n,positionFormat:r,_normalize:s}=this.props,o=[],l=r==="XY"?2:3,{startRow:h,endRow:A}=t,{iterable:v,objectInfo:C}=lc(i,h,A);for(const S of v){C.index++;let L=n(S,C);s&&(L=_O(L,l));const{holeIndices:N}=L,G=L.positions||L;if(N)for(let W=0;W<=N.length;W++){const j=G.slice(N[W-1]||0,N[W]||G.length);o.push(this.getSubLayerRow({path:j},S,C.index))}else o.push(this.getSubLayerRow({path:G},S,C.index))}return o}renderLayers(){const{data:t,_dataDiff:i,stroked:n,filled:r,extruded:s,wireframe:o,_normalize:l,_windingOrder:h,elevationScale:A,transitions:v,positionFormat:C}=this.props,{lineWidthUnits:S,lineWidthScale:L,lineWidthMinPixels:N,lineWidthMaxPixels:G,lineJointRounded:W,lineMiterLimit:j,lineDashJustified:q}=this.props,{getFillColor:Z,getLineColor:K,getLineWidth:ft,getLineDashArray:rt,getElevation:Lt,getPolygon:Vt,updateTriggers:At,material:at}=this.props,{paths:kt,pathsDiff:X}=this.state,ht=this.getSubLayerClass("fill",hh),Mt=this.getSubLayerClass("stroke",ch),pe=this.shouldRenderSubLayer("fill",kt)&&new ht({_dataDiff:i,extruded:s,elevationScale:A,filled:r,wireframe:o,_normalize:l,_windingOrder:h,getElevation:Lt,getFillColor:Z,getLineColor:s&&o?K:EO,material:at,transitions:v},this.getSubLayerProps({id:"fill",updateTriggers:At&&{getPolygon:At.getPolygon,getElevation:At.getElevation,getFillColor:At.getFillColor,lineColors:s&&o,getLineColor:At.getLineColor}}),{data:t,positionFormat:C,getPolygon:Vt}),Ct=!s&&n&&this.shouldRenderSubLayer("stroke",kt)&&new Mt({_dataDiff:X&&(()=>X),widthUnits:S,widthScale:L,widthMinPixels:N,widthMaxPixels:G,jointRounded:W,miterLimit:j,dashJustified:q,_pathType:"loop",transitions:v&&{getWidth:v.getLineWidth,getColor:v.getLineColor,getPath:v.getPolygon},getColor:this.getSubLayerAccessor(K),getWidth:this.getSubLayerAccessor(ft),getDashArray:this.getSubLayerAccessor(rt)},this.getSubLayerProps({id:"stroke",updateTriggers:At&&{getWidth:At.getLineWidth,getColor:At.getLineColor,getDashArray:At.getLineDashArray}}),{data:kt,positionFormat:C,getPath:Dt=>Dt.path});return[!s&&pe,Ct,s&&pe]}}fh.layerName="PolygonLayer",fh.defaultProps=vht;function bht(e,t){if(!e)return null;const i="startIndices"in e?e.startIndices[t]:t,n=e.featureIds.value[i];return i!==-1?xht(e,n,i):null}function xht(e,t,i){const n={properties:{...e.properties[t]}};for(const r in e.numericProps)n.properties[r]=e.numericProps[r].value[i];return n}function wht(e,t){const i={points:null,lines:null,polygons:null};for(const n in i){const r=e[n].globalFeatureIds.value;i[n]=new Uint8ClampedArray(r.length*4);const s=[];for(let o=0;o<r.length;o++)t(r[o],s),i[n][o*4+0]=s[0],i[n][o*4+1]=s[1],i[n][o*4+2]=s[2],i[n][o*4+3]=255}return i}const BO=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,Cht={name:"sdf",vs:BO,fs:BO,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},Eht=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Fx=192/256,TO=[],Bht={getIconOffsets:{type:"accessor",value:e=>e.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class Vy extends mp{getShaders(){const t=super.getShaders();return{...t,modules:[...t.modules,Cht],fs:Eht}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(t,{index:i,target:n})=>this.encodePickingColor(i,n)}})}updateState(t){super.updateState(t);const{props:i,oldProps:n}=t;let{outlineColor:r}=i;r!==n.outlineColor&&(r=r.map(s=>s/255),r[3]=Number.isFinite(r[3])?r[3]:1,this.setState({outlineColor:r})),!i.sdf&&i.outlineWidth&&Yi.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(t){const{sdf:i,smoothing:n,outlineWidth:r}=this.props,{outlineColor:s}=this.state,o=r?Math.max(n,Fx*(1-r)):-1,l=this.state.model,h={buffer:Fx,outlineBuffer:o,gamma:n,enabled:!!i,outlineColor:s};if(l.shaderInputs.setProps({sdf:h}),super.draw(t),i&&r){const{iconManager:A}=this.state;A.getTexture()&&(l.shaderInputs.setProps({sdf:{...h,outlineBuffer:Fx}}),l.draw(this.context.renderPass))}}getInstanceOffset(t){return t?Array.from(t).flatMap(i=>super.getInstanceOffset(i)):TO}getInstanceColorMode(t){return 1}getInstanceIconFrame(t){return t?Array.from(t).flatMap(i=>super.getInstanceIconFrame(i)):TO}}Vy.defaultProps=Bht,Vy.layerName="MultiIconLayer";const jy=1e20;class Tht{constructor({fontSize:t=24,buffer:i=3,radius:n=8,cutoff:r=.25,fontFamily:s="sans-serif",fontWeight:o="normal",fontStyle:l="normal"}={}){this.buffer=i,this.cutoff=r,this.radius=n;const h=this.size=t+i*4,A=this._createCanvas(h),v=this.ctx=A.getContext("2d",{willReadFrequently:!0});v.font=`${l} ${o} ${t}px ${s}`,v.textBaseline="alphabetic",v.textAlign="left",v.fillStyle="black",this.gridOuter=new Float64Array(h*h),this.gridInner=new Float64Array(h*h),this.f=new Float64Array(h),this.z=new Float64Array(h+1),this.v=new Uint16Array(h)}_createCanvas(t){const i=document.createElement("canvas");return i.width=i.height=t,i}draw(t){const{width:i,actualBoundingBoxAscent:n,actualBoundingBoxDescent:r,actualBoundingBoxLeft:s,actualBoundingBoxRight:o}=this.ctx.measureText(t),l=Math.ceil(n),h=0,A=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-s))),v=Math.min(this.size-this.buffer,l+Math.ceil(r)),C=A+2*this.buffer,S=v+2*this.buffer,L=Math.max(C*S,0),N=new Uint8ClampedArray(L),G={data:N,width:C,height:S,glyphWidth:A,glyphHeight:v,glyphTop:l,glyphLeft:h,glyphAdvance:i};if(A===0||v===0)return G;const{ctx:W,buffer:j,gridInner:q,gridOuter:Z}=this;W.clearRect(j,j,A,v),W.fillText(t,j,j+l);const K=W.getImageData(j,j,A,v);Z.fill(jy,0,L),q.fill(0,0,L);for(let ft=0;ft<v;ft++)for(let rt=0;rt<A;rt++){const Lt=K.data[4*(ft*A+rt)+3]/255;if(Lt===0)continue;const Vt=(ft+j)*C+rt+j;if(Lt===1)Z[Vt]=0,q[Vt]=jy;else{const At=.5-Lt;Z[Vt]=At>0?At*At:0,q[Vt]=At<0?At*At:0}}SO(Z,0,0,C,S,C,this.f,this.v,this.z),SO(q,j,j,A,v,C,this.f,this.v,this.z);for(let ft=0;ft<L;ft++){const rt=Math.sqrt(Z[ft])-Math.sqrt(q[ft]);N[ft]=Math.round(255-255*(rt/this.radius+this.cutoff))}return G}}function SO(e,t,i,n,r,s,o,l,h){for(let A=t;A<t+n;A++)IO(e,i*s+A,s,r,o,l,h);for(let A=i;A<i+r;A++)IO(e,A*s+t,1,n,o,l,h)}function IO(e,t,i,n,r,s,o){s[0]=0,o[0]=-1e20,o[1]=jy,r[0]=e[t];for(let l=1,h=0,A=0;l<n;l++){r[l]=e[t+l*i];const v=l*l;do{const C=s[h];A=(r[l]-r[C]+v-C*C)/(l-C)/2}while(A<=o[h]&&--h>-1);h++,s[h]=l,o[h]=A,o[h+1]=jy}for(let l=0,h=0;l<n;l++){for(;o[h+1]<l;)h++;const A=s[h],v=l-A;e[t+l*i]=r[A]+v*v}}const Sht=32,Iht=[];function Mht(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function Pht({characterSet:e,getFontWidth:t,fontHeight:i,buffer:n,maxCanvasWidth:r,mapping:s={},xOffset:o=0,yOffset:l=0}){let h=0,A=o;const v=i+n*2;for(const C of e)if(!s[C]){const S=t(C);A+S+n*2>r&&(A=0,h++),s[C]={x:A+n,y:l+h*v+n,width:S,height:v,layoutWidth:S,layoutHeight:i},A+=S+n*2}return{mapping:s,xOffset:A,yOffset:l+h*v,canvasHeight:Mht(l+(h+1)*v)}}function MO(e,t,i,n){var r;let s=0;for(let o=t;o<i;o++){const l=e[o];s+=((r=n[l])==null?void 0:r.layoutWidth)||0}return s}function PO(e,t,i,n,r,s){let o=t,l=0;for(let h=t;h<i;h++){const A=MO(e,h,h+1,r);l+A>n&&(o<h&&s.push(h),o=h,l=0),l+=A}return l}function Rht(e,t,i,n,r,s){let o=t,l=t,h=t,A=0;for(let v=t;v<i;v++)if((e[v]===" "||e[v+1]===" "||v+1===i)&&(h=v+1),h>l){let C=MO(e,l,h,r);A+C>n&&(o<l&&(s.push(l),o=l,A=0),C>n&&(C=PO(e,l,h,n,r,s),o=s[s.length-1])),l=h,A+=C}return A}function Dht(e,t,i,n,r=0,s){s===void 0&&(s=e.length);const o=[];return t==="break-all"?PO(e,r,s,i,n,o):Rht(e,r,s,i,n,o),o}function Oht(e,t,i,n,r,s){let o=0,l=0;for(let h=t;h<i;h++){const A=e[h],v=n[A];v?(l||(l=v.layoutHeight),r[h]=o+v.layoutWidth/2,o+=v.layoutWidth):(Yi.warn(`Missing character: ${A} (${A.codePointAt(0)})`)(),r[h]=o,o+=Sht)}s[0]=o,s[1]=l}function Lht(e,t,i,n,r){var s;const o=Array.from(e),l=o.length,h=new Array(l),A=new Array(l),v=new Array(l),C=(i==="break-word"||i==="break-all")&&isFinite(n)&&n>0,S=[0,0],L=[0,0];let N=0,G=0,W=0;for(let j=0;j<=l;j++){const q=o[j];if((q===`
`||j===l)&&(W=j),W>G){const Z=C?Dht(o,i,n,r,G,W):Iht;for(let K=0;K<=Z.length;K++){const ft=K===0?G:Z[K-1],rt=K<Z.length?Z[K]:W;Oht(o,ft,rt,r,h,L);for(let Lt=ft;Lt<rt;Lt++){const Vt=o[Lt],At=((s=r[Vt])==null?void 0:s.layoutOffsetY)||0;A[Lt]=N+L[1]/2+At,v[Lt]=L[0]}N=N+L[1]*t,S[0]=Math.max(S[0],L[0])}G=W}q===`
`&&(h[G]=0,A[G]=0,v[G]=0,G++)}return S[1]=N,{x:h,y:A,rowWidth:v,size:S}}function Fht({value:e,length:t,stride:i,offset:n,startIndices:r,characterSet:s}){const o=e.BYTES_PER_ELEMENT,l=i?i/o:1,h=n?n/o:0,A=r[t]||Math.ceil((e.length-h)/l),v=s&&new Set,C=new Array(t);let S=e;if(l>1||h>0){const L=e.constructor;S=new L(A);for(let N=0;N<A;N++)S[N]=e[N*l+h]}for(let L=0;L<t;L++){const N=r[L],G=r[L+1]||A,W=S.subarray(N,G);C[L]=String.fromCodePoint.apply(null,W),v&&W.forEach(v.add,v)}if(v)for(const L of v)s.add(String.fromCodePoint(L));return{texts:C,characterCount:A}}class RO{constructor(t=5){this._cache={},this._order=[],this.limit=t}get(t){const i=this._cache[t];return i&&(this._deleteOrder(t),this._appendOrder(t)),i}set(t,i){this._cache[t]?(this.delete(t),this._cache[t]=i,this._appendOrder(t)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[t]=i,this._appendOrder(t))}delete(t){this._cache[t]&&(delete this._cache[t],this._deleteOrder(t))}_deleteOrder(t){const i=this._order.indexOf(t);i>=0&&this._order.splice(i,1)}_appendOrder(t){this._order.push(t)}}function kht(){const e=[];for(let t=32;t<128;t++)e.push(String.fromCharCode(t));return e}const yp={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:kht(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},DO=1024,OO=.9,LO=1.2,FO=3;let Hy=new RO(FO);function Nht(e,t){let i;typeof t=="string"?i=new Set(Array.from(t)):i=new Set(t);const n=Hy.get(e);if(!n)return i;for(const r in n.mapping)i.has(r)&&i.delete(r);return i}function Uht(e,t){for(let i=0;i<e.length;i++)t.data[4*i+3]=e[i]}function kO(e,t,i,n){e.font=`${n} ${i}px ${t}`,e.fillStyle="#000",e.textBaseline="alphabetic",e.textAlign="left"}function Ght(e){Yi.assert(Number.isFinite(e)&&e>=FO,"Invalid cache limit"),Hy=new RO(e)}class zht{constructor(){this.props={...yp}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:t,buffer:i}=this.props;return(t*LO+i*2)/t}setProps(t={}){Object.assign(this.props,t),this._key=this._getKey();const i=Nht(this._key,this.props.characterSet),n=Hy.get(this._key);if(n&&i.size===0){this._atlas!==n&&(this._atlas=n);return}const r=this._generateFontAtlas(i,n);this._atlas=r,Hy.set(this._key,r)}_generateFontAtlas(t,i){const{fontFamily:n,fontWeight:r,fontSize:s,buffer:o,sdf:l,radius:h,cutoff:A}=this.props;let v=i&&i.data;v||(v=document.createElement("canvas"),v.width=DO);const C=v.getContext("2d",{willReadFrequently:!0});kO(C,n,s,r);const{mapping:S,canvasHeight:L,xOffset:N,yOffset:G}=Pht({getFontWidth:W=>C.measureText(W).width,fontHeight:s*LO,buffer:o,characterSet:t,maxCanvasWidth:DO,...i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset}});if(v.height!==L){const W=C.getImageData(0,0,v.width,v.height);v.height=L,C.putImageData(W,0,0)}if(kO(C,n,s,r),l){const W=new Tht({fontSize:s,buffer:o,radius:h,cutoff:A,fontFamily:n,fontWeight:`${r}`});for(const j of t){const{data:q,width:Z,height:K,glyphTop:ft}=W.draw(j);S[j].width=Z,S[j].layoutOffsetY=s*OO-ft;const rt=C.createImageData(Z,K);Uht(q,rt),C.putImageData(rt,S[j].x,S[j].y)}}else for(const W of t)C.fillText(W,S[W].x,S[W].y+o+s*OO);return{xOffset:N,yOffset:G,mapping:S,data:v,width:v.width,height:v.height}}_getKey(){const{fontFamily:t,fontWeight:i,fontSize:n,buffer:r,sdf:s,radius:o,cutoff:l}=this.props;return s?`${t} ${i} ${n} ${r} ${o} ${l}`:`${t} ${i} ${n} ${r}`}}const NO=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,Vht={name:"textBackground",vs:NO,fs:NO,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},jht=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Hht=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (textBackground.stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Wht={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:e=>e.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Fg extends Io{getShaders(){return super.getShaders({vs:jht,fs:Hht,modules:[Uo,pa,Vht]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){var i;super.updateState(t);const{changeFlags:n}=t;n.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{billboard:i,sizeScale:n,sizeUnits:r,sizeMinPixels:s,sizeMaxPixels:o,getLineWidth:l}=this.props;let{padding:h}=this.props;h.length<4&&(h=[h[0],h[1],h[0],h[1]]);const A=this.state.model,v={billboard:i,stroked:!!l,padding:h,sizeUnits:Ds[r],sizeScale:n,sizeMinPixels:s,sizeMaxPixels:o};A.shaderInputs.setProps({textBackground:v}),A.draw(this.context.renderPass)}_getModel(){const t=[0,0,1,0,0,1,1,1];return new Hr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new es({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}}Fg.defaultProps=Wht,Fg.layerName="TextBackgroundLayer";const UO={start:1,middle:0,end:-1},GO={top:1,center:0,bottom:-1},kx=[0,0,0,255],Jht=1,Xht={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:kx},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:yp.characterSet},fontFamily:yp.fontFamily,fontWeight:yp.fontWeight,lineHeight:Jht,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:kx},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:e=>e.text},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:kx},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class mf extends Mo{constructor(){super(...arguments),this.getBoundingRect=(t,i)=>{let{size:[n,r]}=this.transformParagraph(t,i);const{fontSize:s}=this.state.fontAtlasManager.props;n/=s,r/=s;const{getTextAnchor:o,getAlignmentBaseline:l}=this.props,h=UO[typeof o=="function"?o(t,i):o],A=GO[typeof l=="function"?l(t,i):l];return[(h-1)*n/2,(A-1)*r/2,n,r]},this.getIconOffsets=(t,i)=>{const{getTextAnchor:n,getAlignmentBaseline:r}=this.props,{x:s,y:o,rowWidth:l,size:[h,A]}=this.transformParagraph(t,i),v=UO[typeof n=="function"?n(t,i):n],C=GO[typeof r=="function"?r(t,i):r],S=s.length,L=new Array(S*2);let N=0;for(let G=0;G<S;G++){const W=(1-v)*(h-l[G])/2;L[N++]=(v-1)*h/2+W+s[G],L[N++]=(C-1)*A/2+o[G]}return L}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new zht},this.props.maxWidth>0&&Yi.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(t){const{props:i,oldProps:n,changeFlags:r}=t;(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||i.lineHeight!==n.lineHeight||i.wordBreak!==n.wordBreak||i.maxWidth!==n.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:t}){return t.object=t.index>=0?this.props.data[t.index]:null,t}_updateFontAtlas(){const{fontSettings:t,fontFamily:i,fontWeight:n}=this.props,{fontAtlasManager:r,characterSet:s}=this.state,o={...t,characterSet:s,fontFamily:i,fontWeight:n};if(!r.mapping)return r.setProps(o),!0;for(const l in o)if(o[l]!==r.props[l])return r.setProps(o),!0;return!1}_updateText(){var t;const{data:i,characterSet:n}=this.props,r=(t=i.attributes)==null?void 0:t.getText;let{getText:s}=this.props,o=i.startIndices,l;const h=n==="auto"&&new Set;if(r&&o){const{texts:A,characterCount:v}=Fht({...ArrayBuffer.isView(r)?{value:r}:r,length:i.length,startIndices:o,characterSet:h});l=v,s=(C,{index:S})=>A[S]}else{const{iterable:A,objectInfo:v}=lc(i);o=[0],l=0;for(const C of A){v.index++;const S=Array.from(s(C,v)||"");h&&S.forEach(h.add,h),l+=S.length,o.push(l)}}this.setState({getText:s,startIndices:o,numInstances:l,characterSet:h||n})}transformParagraph(t,i){const{fontAtlasManager:n}=this.state,r=n.mapping,s=this.state.getText,{wordBreak:o,lineHeight:l,maxWidth:h}=this.props,A=s(t,i)||"";return Lht(A,l,o,h*n.props.fontSize,r)}renderLayers(){const{startIndices:t,numInstances:i,getText:n,fontAtlasManager:{scale:r,atlas:s,mapping:o},styleVersion:l}=this.state,{data:h,_dataDiff:A,getPosition:v,getColor:C,getSize:S,getAngle:L,getPixelOffset:N,getBackgroundColor:G,getBorderColor:W,getBorderWidth:j,backgroundPadding:q,background:Z,billboard:K,fontSettings:ft,outlineWidth:rt,outlineColor:Lt,sizeScale:Vt,sizeUnits:At,sizeMinPixels:at,sizeMaxPixels:kt,transitions:X,updateTriggers:ht}=this.props,Mt=this.getSubLayerClass("characters",Vy),pe=this.getSubLayerClass("background",Fg);return[Z&&new pe({getFillColor:G,getLineColor:W,getLineWidth:j,padding:q,getPosition:v,getSize:S,getAngle:L,getPixelOffset:N,billboard:K,sizeScale:Vt,sizeUnits:At,sizeMinPixels:at,sizeMaxPixels:kt,transitions:X&&{getPosition:X.getPosition,getAngle:X.getAngle,getSize:X.getSize,getFillColor:X.getBackgroundColor,getLineColor:X.getBorderColor,getLineWidth:X.getBorderWidth,getPixelOffset:X.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:ht.getPosition,getAngle:ht.getAngle,getSize:ht.getSize,getFillColor:ht.getBackgroundColor,getLineColor:ht.getBorderColor,getLineWidth:ht.getBorderWidth,getPixelOffset:ht.getPixelOffset,getBoundingRect:{getText:ht.getText,getTextAnchor:ht.getTextAnchor,getAlignmentBaseline:ht.getAlignmentBaseline,styleVersion:l}}}),{data:h.attributes&&h.attributes.background?{length:h.length,attributes:h.attributes.background}:h,_dataDiff:A,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Mt({sdf:ft.sdf,smoothing:Number.isFinite(ft.smoothing)?ft.smoothing:yp.smoothing,outlineWidth:rt/(ft.radius||yp.radius),outlineColor:Lt,iconAtlas:s,iconMapping:o,getPosition:v,getColor:C,getSize:S,getAngle:L,getPixelOffset:N,billboard:K,sizeScale:Vt*r,sizeUnits:At,sizeMinPixels:at*r,sizeMaxPixels:kt*r,transitions:X&&{getPosition:X.getPosition,getAngle:X.getAngle,getColor:X.getColor,getSize:X.getSize,getPixelOffset:X.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:ht.getText,getPosition:ht.getPosition,getAngle:ht.getAngle,getColor:ht.getColor,getSize:ht.getSize,getPixelOffset:ht.getPixelOffset,getIconOffsets:{getTextAnchor:ht.getTextAnchor,getAlignmentBaseline:ht.getAlignmentBaseline,styleVersion:l}}}),{data:h,_dataDiff:A,startIndices:t,numInstances:i,getIconOffsets:this.getIconOffsets,getIcon:n})]}static set fontAtlasCacheLimit(t){Ght(t)}}mf.defaultProps=Xht,mf.layerName="TextLayer";const Wy={circle:{type:Dg,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:mp,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:mf,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Jy={type:ch,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Nx={type:hh,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function kg({type:e,props:t}){const i={};for(const n in t)i[n]=e.defaultProps[t[n]];return i}function Ux(e,t){const{transitions:i,updateTriggers:n}=e.props,r={updateTriggers:{},transitions:i&&{getPosition:i.geometry}};for(const s in t){const o=t[s];let l=e.props[s];s.startsWith("get")&&(l=e.getSubLayerAccessor(l),r.updateTriggers[o]=n[s],i&&(r.transitions[o]=i[s])),r[o]=l}return r}function Kht(e){if(Array.isArray(e))return e;switch(Yi.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return Yi.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}function zO(e,t,i={}){const n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:r=0,endRow:s=e.length}=i;for(let o=r;o<s;o++){const l=e[o],{geometry:h}=l;if(h)if(h.type==="GeometryCollection"){Yi.assert(Array.isArray(h.geometries),"GeoJSON does not have geometries array");const{geometries:A}=h;for(let v=0;v<A.length;v++){const C=A[v];VO(C,n,t,l,o)}}else VO(h,n,t,l,o)}return n}function VO(e,t,i,n,r){const{type:s,coordinates:o}=e,{pointFeatures:l,lineFeatures:h,polygonFeatures:A,polygonOutlineFeatures:v}=t;if(!Zht(s,o)){Yi.warn(`${s} coordinates are malformed`)();return}switch(s){case"Point":l.push(i({geometry:e},n,r));break;case"MultiPoint":o.forEach(C=>{l.push(i({geometry:{type:"Point",coordinates:C}},n,r))});break;case"LineString":h.push(i({geometry:e},n,r));break;case"MultiLineString":o.forEach(C=>{h.push(i({geometry:{type:"LineString",coordinates:C}},n,r))});break;case"Polygon":A.push(i({geometry:e},n,r)),o.forEach(C=>{v.push(i({geometry:{type:"LineString",coordinates:C}},n,r))});break;case"MultiPolygon":o.forEach(C=>{A.push(i({geometry:{type:"Polygon",coordinates:C}},n,r)),C.forEach(S=>{v.push(i({geometry:{type:"LineString",coordinates:S}},n,r))})});break}}const Qht={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function Zht(e,t){let i=Qht[e];for(Yi.assert(i,`Unknown GeoJSON type ${e}`);t&&--i>0;)t=t[0];return t&&Number.isFinite(t[0])}function jO(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function Xy(e){return e.geometry.coordinates}function Yht(e,t){const i=jO(),{pointFeatures:n,lineFeatures:r,polygonFeatures:s,polygonOutlineFeatures:o}=e;return i.points.data=n,i.points._dataDiff=t.pointFeatures&&(()=>t.pointFeatures),i.points.getPosition=Xy,i.lines.data=r,i.lines._dataDiff=t.lineFeatures&&(()=>t.lineFeatures),i.lines.getPath=Xy,i.polygons.data=s,i.polygons._dataDiff=t.polygonFeatures&&(()=>t.polygonFeatures),i.polygons.getPolygon=Xy,i.polygonsOutline.data=o,i.polygonsOutline._dataDiff=t.polygonOutlineFeatures&&(()=>t.polygonOutlineFeatures),i.polygonsOutline.getPath=Xy,i}function qht(e,t){const i=jO(),{points:n,lines:r,polygons:s}=e,o=wht(e,t);return i.points.data={length:n.positions.value.length/n.positions.size,attributes:{...n.attributes,getPosition:n.positions,instancePickingColors:{size:4,value:o.points}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},i.lines.data={length:r.pathIndices.value.length-1,startIndices:r.pathIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:4,value:o.lines}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},i.lines._pathType="open",i.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:4,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},i.polygons._normalize=!1,s.triangles&&(i.polygons.data.attributes.indices=s.triangles.value),i.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},i.polygonsOutline._pathType="open",i}const $ht=["points","linestrings","polygons"],tft={...kg(Wy.circle),...kg(Wy.icon),...kg(Wy.text),...kg(Jy),...kg(Nx),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:e=>e.properties.icon},getText:{type:"accessor",value:e=>e.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class nu extends Mo{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:t,changeFlags:i}){if(!i.dataChanged)return;const{data:n}=this.props,r=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:r}),r?this._updateStateBinary({props:t,changeFlags:i}):this._updateStateJSON({props:t,changeFlags:i})}_updateStateBinary({props:t,changeFlags:i}){const n=qht(t.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:t,changeFlags:i}){const n=Kht(t.data),r=this.getSubLayerRow.bind(this);let s={};const o={};if(Array.isArray(i.dataChanged)){const h=this.state.features;for(const A in h)s[A]=h[A].slice(),o[A]=[];for(const A of i.dataChanged){const v=zO(n,r,A);for(const C in h)o[C].push(CO({data:s[C],getIndex:S=>S.__source.index,dataRange:A,replace:v[C]}))}}else s=zO(n,r);const l=Yht(s,o);this.setState({features:s,featuresDiff:o,layerProps:l})}getPickingInfo(t){const i=super.getPickingInfo(t),{index:n,sourceLayer:r}=i;return i.featureType=$ht.find(s=>r.id.startsWith(`${this.id}-${s}-`)),n>=0&&r.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(i.index=this.props.data.points.globalFeatureIds.value[n]),i}_updateAutoHighlight(t){const i=`${this.id}-points-`,n=t.featureType==="points";for(const r of this.getSubLayers())r.id.startsWith(i)===n&&r.updateAutoHighlight(t)}_renderPolygonLayer(){var t;const{extruded:i,wireframe:n}=this.props,{layerProps:r}=this.state,s="polygons-fill",o=this.shouldRenderSubLayer(s,(t=r.polygons)==null?void 0:t.data)&&this.getSubLayerClass(s,Nx.type);if(o){const l=Ux(this,Nx.props),h=i&&n;return h||delete l.getLineColor,l.updateTriggers.lineColors=h,new o(l,this.getSubLayerProps({id:s,updateTriggers:l.updateTriggers}),r.polygons)}return null}_renderLineLayers(){var t,i;const{extruded:n,stroked:r}=this.props,{layerProps:s}=this.state,o="polygons-stroke",l="linestrings",h=!n&&r&&this.shouldRenderSubLayer(o,(t=s.polygonsOutline)==null?void 0:t.data)&&this.getSubLayerClass(o,Jy.type),A=this.shouldRenderSubLayer(l,(i=s.lines)==null?void 0:i.data)&&this.getSubLayerClass(l,Jy.type);if(h||A){const v=Ux(this,Jy.props);return[h&&new h(v,this.getSubLayerProps({id:o,updateTriggers:v.updateTriggers}),s.polygonsOutline),A&&new A(v,this.getSubLayerProps({id:l,updateTriggers:v.updateTriggers}),s.lines)]}return null}_renderPointLayers(){var t;const{pointType:i}=this.props,{layerProps:n,binary:r}=this.state;let{highlightedObjectIndex:s}=this.props;!r&&Number.isFinite(s)&&(s=n.points.data.findIndex(h=>h.__source.index===s));const o=new Set(i.split("+")),l=[];for(const h of o){const A=`points-${h}`,v=Wy[h],C=v&&this.shouldRenderSubLayer(A,(t=n.points)==null?void 0:t.data)&&this.getSubLayerClass(A,v.type);if(C){const S=Ux(this,v.props);let L=n.points;if(h==="text"&&r){const{instancePickingColors:N,...G}=L.data.attributes;L={...L,data:{...L.data,attributes:G}}}l.push(new C(S,this.getSubLayerProps({id:A,updateTriggers:S.updateTriggers,highlightedObjectIndex:s}),L))}}return l}renderLayers(){const{extruded:t}=this.props,i=this._renderPolygonLayer(),n=this._renderLineLayers(),r=this._renderPointLayers();return[!t&&i,n,r,t&&i]}getSubLayerAccessor(t){const{binary:i}=this.state;return!i||typeof t!="function"?super.getSubLayerAccessor(t):(n,r)=>{const{data:s,index:o}=r,l=bht(s,o);return t(l,r)}}}nu.layerName="GeoJsonLayer",nu.defaultProps=tft;const eft=Object.freeze(Object.defineProperty({__proto__:null,ArcLayer:Mg,BitmapLayer:Ry,ColumnLayer:dc,GeoJsonLayer:nu,GridCellLayer:Rx,IconLayer:mp,LineLayer:Dy,PathLayer:ch,PointCloudLayer:Rg,PolygonLayer:fh,ScatterplotLayer:Dg,SolidPolygonLayer:hh,TextLayer:mf,_MultiIconLayer:Vy,_TextBackgroundLayer:Fg},Symbol.toStringTag,{value:"Module"}));function ift(e){return typeof e=="string"?e.charAt(0).toLowerCase()+e.slice(1):e}function Gx(e){if(Array.isArray(e))return e.map(t=>Gx(t));if(e&&typeof e=="object"){const t={};for(const[i,n]of Object.entries(e))t[ift(i)]=Gx(n);return t}return e}var zx={},HO={},WO;function Vx(){return WO||(WO=1,function(e){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",i=t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",n="["+t+"]["+i+"]*",r=new RegExp("^"+n+"$"),s=function(l,h){const A=[];let v=h.exec(l);for(;v;){const C=[];C.startIndex=h.lastIndex-v[0].length;const S=v.length;for(let L=0;L<S;L++)C.push(v[L]);A.push(C),v=h.exec(l)}return A},o=function(l){const h=r.exec(l);return!(h===null||typeof h>"u")};e.isExist=function(l){return typeof l<"u"},e.isEmptyObject=function(l){return Object.keys(l).length===0},e.merge=function(l,h,A){if(h){const v=Object.keys(h),C=v.length;for(let S=0;S<C;S++)A==="strict"?l[v[S]]=[h[v[S]]]:l[v[S]]=h[v[S]]}},e.getValue=function(l){return e.isExist(l)?l:""},e.isName=o,e.getAllMatches=s,e.nameRegexp=n}(HO)),HO}var JO;function XO(){if(JO)return zx;JO=1;const e=Vx(),t={allowBooleanAttributes:!1,unpairedTags:[]};zx.validate=function(j,q){q=Object.assign({},t,q);const Z=[];let K=!1,ft=!1;j[0]==="\uFEFF"&&(j=j.substr(1));for(let rt=0;rt<j.length;rt++)if(j[rt]==="<"&&j[rt+1]==="?"){if(rt+=2,rt=n(j,rt),rt.err)return rt}else if(j[rt]==="<"){let Lt=rt;if(rt++,j[rt]==="!"){rt=r(j,rt);continue}else{let Vt=!1;j[rt]==="/"&&(Vt=!0,rt++);let At="";for(;rt<j.length&&j[rt]!==">"&&j[rt]!==" "&&j[rt]!=="	"&&j[rt]!==`
`&&j[rt]!=="\r";rt++)At+=j[rt];if(At=At.trim(),At[At.length-1]==="/"&&(At=At.substring(0,At.length-1),rt--),!N(At)){let X;return At.trim().length===0?X="Invalid space after '<'.":X="Tag '"+At+"' is an invalid name.",S("InvalidTag",X,G(j,rt))}const at=l(j,rt);if(at===!1)return S("InvalidAttr","Attributes for '"+At+"' have open quote.",G(j,rt));let kt=at.value;if(rt=at.index,kt[kt.length-1]==="/"){const X=rt-kt.length;kt=kt.substring(0,kt.length-1);const ht=A(kt,q);if(ht===!0)K=!0;else return S(ht.err.code,ht.err.msg,G(j,X+ht.err.line))}else if(Vt)if(at.tagClosed){if(kt.trim().length>0)return S("InvalidTag","Closing tag '"+At+"' can't have attributes or invalid starting.",G(j,Lt));if(Z.length===0)return S("InvalidTag","Closing tag '"+At+"' has not been opened.",G(j,Lt));{const X=Z.pop();if(At!==X.tagName){let ht=G(j,X.tagStartPos);return S("InvalidTag","Expected closing tag '"+X.tagName+"' (opened in line "+ht.line+", col "+ht.col+") instead of closing tag '"+At+"'.",G(j,Lt))}Z.length==0&&(ft=!0)}}else return S("InvalidTag","Closing tag '"+At+"' doesn't have proper closing.",G(j,rt));else{const X=A(kt,q);if(X!==!0)return S(X.err.code,X.err.msg,G(j,rt-kt.length+X.err.line));if(ft===!0)return S("InvalidXml","Multiple possible root nodes found.",G(j,rt));q.unpairedTags.indexOf(At)!==-1||Z.push({tagName:At,tagStartPos:Lt}),K=!0}for(rt++;rt<j.length;rt++)if(j[rt]==="<")if(j[rt+1]==="!"){rt++,rt=r(j,rt);continue}else if(j[rt+1]==="?"){if(rt=n(j,++rt),rt.err)return rt}else break;else if(j[rt]==="&"){const X=C(j,rt);if(X==-1)return S("InvalidChar","char '&' is not expected.",G(j,rt));rt=X}else if(ft===!0&&!i(j[rt]))return S("InvalidXml","Extra text at the end",G(j,rt));j[rt]==="<"&&rt--}}else{if(i(j[rt]))continue;return S("InvalidChar","char '"+j[rt]+"' is not expected.",G(j,rt))}if(K){if(Z.length==1)return S("InvalidTag","Unclosed tag '"+Z[0].tagName+"'.",G(j,Z[0].tagStartPos));if(Z.length>0)return S("InvalidXml","Invalid '"+JSON.stringify(Z.map(rt=>rt.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return S("InvalidXml","Start tag expected.",1);return!0};function i(j){return j===" "||j==="	"||j===`
`||j==="\r"}function n(j,q){const Z=q;for(;q<j.length;q++)if(j[q]=="?"||j[q]==" "){const K=j.substr(Z,q-Z);if(q>5&&K==="xml")return S("InvalidXml","XML declaration allowed only at the start of the document.",G(j,q));if(j[q]=="?"&&j[q+1]==">"){q++;break}else continue}return q}function r(j,q){if(j.length>q+5&&j[q+1]==="-"&&j[q+2]==="-"){for(q+=3;q<j.length;q++)if(j[q]==="-"&&j[q+1]==="-"&&j[q+2]===">"){q+=2;break}}else if(j.length>q+8&&j[q+1]==="D"&&j[q+2]==="O"&&j[q+3]==="C"&&j[q+4]==="T"&&j[q+5]==="Y"&&j[q+6]==="P"&&j[q+7]==="E"){let Z=1;for(q+=8;q<j.length;q++)if(j[q]==="<")Z++;else if(j[q]===">"&&(Z--,Z===0))break}else if(j.length>q+9&&j[q+1]==="["&&j[q+2]==="C"&&j[q+3]==="D"&&j[q+4]==="A"&&j[q+5]==="T"&&j[q+6]==="A"&&j[q+7]==="["){for(q+=8;q<j.length;q++)if(j[q]==="]"&&j[q+1]==="]"&&j[q+2]===">"){q+=2;break}}return q}const s='"',o="'";function l(j,q){let Z="",K="",ft=!1;for(;q<j.length;q++){if(j[q]===s||j[q]===o)K===""?K=j[q]:K!==j[q]||(K="");else if(j[q]===">"&&K===""){ft=!0;break}Z+=j[q]}return K!==""?!1:{value:Z,index:q,tagClosed:ft}}const h=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function A(j,q){const Z=e.getAllMatches(j,h),K={};for(let ft=0;ft<Z.length;ft++){if(Z[ft][1].length===0)return S("InvalidAttr","Attribute '"+Z[ft][2]+"' has no space in starting.",W(Z[ft]));if(Z[ft][3]!==void 0&&Z[ft][4]===void 0)return S("InvalidAttr","Attribute '"+Z[ft][2]+"' is without value.",W(Z[ft]));if(Z[ft][3]===void 0&&!q.allowBooleanAttributes)return S("InvalidAttr","boolean attribute '"+Z[ft][2]+"' is not allowed.",W(Z[ft]));const rt=Z[ft][2];if(!L(rt))return S("InvalidAttr","Attribute '"+rt+"' is an invalid name.",W(Z[ft]));if(!K.hasOwnProperty(rt))K[rt]=1;else return S("InvalidAttr","Attribute '"+rt+"' is repeated.",W(Z[ft]))}return!0}function v(j,q){let Z=/\d/;for(j[q]==="x"&&(q++,Z=/[\da-fA-F]/);q<j.length;q++){if(j[q]===";")return q;if(!j[q].match(Z))break}return-1}function C(j,q){if(q++,j[q]===";")return-1;if(j[q]==="#")return q++,v(j,q);let Z=0;for(;q<j.length;q++,Z++)if(!(j[q].match(/\w/)&&Z<20)){if(j[q]===";")break;return-1}return q}function S(j,q,Z){return{err:{code:j,msg:q,line:Z.line||Z,col:Z.col}}}function L(j){return e.isName(j)}function N(j){return e.isName(j)}function G(j,q){const Z=j.substring(0,q).split(/\r?\n/);return{line:Z.length,col:Z[Z.length-1].length+1}}function W(j){return j.startIndex+j[1].length}return zx}var Ky={},KO;function nft(){if(KO)return Ky;KO=1;const e={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(i,n){return n},attributeValueProcessor:function(i,n){return n},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(i,n,r){return i}},t=function(i){return Object.assign({},e,i)};return Ky.buildOptions=t,Ky.defaultOptions=e,Ky}var jx,QO;function rft(){if(QO)return jx;QO=1;class e{constructor(i){this.tagname=i,this.child=[],this[":@"]={}}add(i,n){i==="__proto__"&&(i="#__proto__"),this.child.push({[i]:n})}addChild(i){i.tagname==="__proto__"&&(i.tagname="#__proto__"),i[":@"]&&Object.keys(i[":@"]).length>0?this.child.push({[i.tagname]:i.child,":@":i[":@"]}):this.child.push({[i.tagname]:i.child})}}return jx=e,jx}var Hx,ZO;function oft(){if(ZO)return Hx;ZO=1;const e=Vx();function t(A,v){const C={};if(A[v+3]==="O"&&A[v+4]==="C"&&A[v+5]==="T"&&A[v+6]==="Y"&&A[v+7]==="P"&&A[v+8]==="E"){v=v+9;let S=1,L=!1,N=!1,G="";for(;v<A.length;v++)if(A[v]==="<"&&!N){if(L&&r(A,v))v+=7,[entityName,val,v]=i(A,v+1),val.indexOf("&")===-1&&(C[h(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(L&&s(A,v))v+=8;else if(L&&o(A,v))v+=8;else if(L&&l(A,v))v+=9;else if(n)N=!0;else throw new Error("Invalid DOCTYPE");S++,G=""}else if(A[v]===">"){if(N?A[v-1]==="-"&&A[v-2]==="-"&&(N=!1,S--):S--,S===0)break}else A[v]==="["?L=!0:G+=A[v];if(S!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:C,i:v}}function i(A,v){let C="";for(;v<A.length&&A[v]!=="'"&&A[v]!=='"';v++)C+=A[v];if(C=C.trim(),C.indexOf(" ")!==-1)throw new Error("External entites are not supported");const S=A[v++];let L="";for(;v<A.length&&A[v]!==S;v++)L+=A[v];return[C,L,v]}function n(A,v){return A[v+1]==="!"&&A[v+2]==="-"&&A[v+3]==="-"}function r(A,v){return A[v+1]==="!"&&A[v+2]==="E"&&A[v+3]==="N"&&A[v+4]==="T"&&A[v+5]==="I"&&A[v+6]==="T"&&A[v+7]==="Y"}function s(A,v){return A[v+1]==="!"&&A[v+2]==="E"&&A[v+3]==="L"&&A[v+4]==="E"&&A[v+5]==="M"&&A[v+6]==="E"&&A[v+7]==="N"&&A[v+8]==="T"}function o(A,v){return A[v+1]==="!"&&A[v+2]==="A"&&A[v+3]==="T"&&A[v+4]==="T"&&A[v+5]==="L"&&A[v+6]==="I"&&A[v+7]==="S"&&A[v+8]==="T"}function l(A,v){return A[v+1]==="!"&&A[v+2]==="N"&&A[v+3]==="O"&&A[v+4]==="T"&&A[v+5]==="A"&&A[v+6]==="T"&&A[v+7]==="I"&&A[v+8]==="O"&&A[v+9]==="N"}function h(A){if(e.isName(A))return A;throw new Error(`Invalid entity name ${A}`)}return Hx=t,Hx}var Wx,YO;function sft(){if(YO)return Wx;YO=1;const e=/^[-+]?0x[a-fA-F0-9]+$/,t=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const i={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function n(s,o={}){if(o=Object.assign({},i,o),!s||typeof s!="string")return s;let l=s.trim();if(o.skipLike!==void 0&&o.skipLike.test(l))return s;if(o.hex&&e.test(l))return Number.parseInt(l,16);{const h=t.exec(l);if(h){const A=h[1],v=h[2];let C=r(h[3]);const S=h[4]||h[6];if(!o.leadingZeros&&v.length>0&&A&&l[2]!=="."||!o.leadingZeros&&v.length>0&&!A&&l[1]!==".")return s;{const L=Number(l),N=""+L;return N.search(/[eE]/)!==-1||S?o.eNotation?L:s:l.indexOf(".")!==-1?N==="0"&&C===""||N===C||A&&N==="-"+C?L:s:v?C===N||A+C===N?L:s:l===N||l===A+N?L:s}}else return s}}function r(s){return s&&s.indexOf(".")!==-1&&(s=s.replace(/0+$/,""),s==="."?s="0":s[0]==="."?s="0"+s:s[s.length-1]==="."&&(s=s.substr(0,s.length-1))),s}return Wx=n,Wx}var Jx,qO;function aft(){if(qO)return Jx;qO=1;const e=Vx(),t=rft(),i=oft(),n=sft();class r{constructor(ft){this.options=ft,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"\xA2"},pound:{regex:/&(pound|#163);/g,val:"\xA3"},yen:{regex:/&(yen|#165);/g,val:"\xA5"},euro:{regex:/&(euro|#8364);/g,val:"\u20AC"},copyright:{regex:/&(copy|#169);/g,val:"\xA9"},reg:{regex:/&(reg|#174);/g,val:"\xAE"},inr:{regex:/&(inr|#8377);/g,val:"\u20B9"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(rt,Lt)=>String.fromCharCode(Number.parseInt(Lt,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(rt,Lt)=>String.fromCharCode(Number.parseInt(Lt,16))}},this.addExternalEntities=s,this.parseXml=v,this.parseTextData=o,this.resolveNameSpace=l,this.buildAttributesMap=A,this.isItStopNode=N,this.replaceEntitiesValue=S,this.readStopNodeData=q,this.saveTextToParentTag=L,this.addChild=C}}function s(K){const ft=Object.keys(K);for(let rt=0;rt<ft.length;rt++){const Lt=ft[rt];this.lastEntities[Lt]={regex:new RegExp("&"+Lt+";","g"),val:K[Lt]}}}function o(K,ft,rt,Lt,Vt,At,at){if(K!==void 0&&(this.options.trimValues&&!Lt&&(K=K.trim()),K.length>0)){at||(K=this.replaceEntitiesValue(K));const kt=this.options.tagValueProcessor(ft,K,rt,Vt,At);return kt==null?K:typeof kt!=typeof K||kt!==K?kt:this.options.trimValues?Z(K,this.options.parseTagValue,this.options.numberParseOptions):K.trim()===K?Z(K,this.options.parseTagValue,this.options.numberParseOptions):K}}function l(K){if(this.options.removeNSPrefix){const ft=K.split(":"),rt=K.charAt(0)==="/"?"/":"";if(ft[0]==="xmlns")return"";ft.length===2&&(K=rt+ft[1])}return K}const h=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function A(K,ft,rt){if(!this.options.ignoreAttributes&&typeof K=="string"){const Lt=e.getAllMatches(K,h),Vt=Lt.length,At={};for(let at=0;at<Vt;at++){const kt=this.resolveNameSpace(Lt[at][1]);let X=Lt[at][4],ht=this.options.attributeNamePrefix+kt;if(kt.length)if(this.options.transformAttributeName&&(ht=this.options.transformAttributeName(ht)),ht==="__proto__"&&(ht="#__proto__"),X!==void 0){this.options.trimValues&&(X=X.trim()),X=this.replaceEntitiesValue(X);const Mt=this.options.attributeValueProcessor(kt,X,ft);Mt==null?At[ht]=X:typeof Mt!=typeof X||Mt!==X?At[ht]=Mt:At[ht]=Z(X,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(At[ht]=!0)}if(!Object.keys(At).length)return;if(this.options.attributesGroupName){const at={};return at[this.options.attributesGroupName]=At,at}return At}}const v=function(K){K=K.replace(/\r\n?/g,`
`);const ft=new t("!xml");let rt=ft,Lt="",Vt="";for(let At=0;At<K.length;At++)if(K[At]==="<")if(K[At+1]==="/"){const at=W(K,">",At,"Closing Tag is not closed.");let kt=K.substring(At+2,at).trim();if(this.options.removeNSPrefix){const Mt=kt.indexOf(":");Mt!==-1&&(kt=kt.substr(Mt+1))}this.options.transformTagName&&(kt=this.options.transformTagName(kt)),rt&&(Lt=this.saveTextToParentTag(Lt,rt,Vt));const X=Vt.substring(Vt.lastIndexOf(".")+1);if(kt&&this.options.unpairedTags.indexOf(kt)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${kt}>`);let ht=0;X&&this.options.unpairedTags.indexOf(X)!==-1?(ht=Vt.lastIndexOf(".",Vt.lastIndexOf(".")-1),this.tagsNodeStack.pop()):ht=Vt.lastIndexOf("."),Vt=Vt.substring(0,ht),rt=this.tagsNodeStack.pop(),Lt="",At=at}else if(K[At+1]==="?"){let at=j(K,At,!1,"?>");if(!at)throw new Error("Pi Tag is not closed.");if(Lt=this.saveTextToParentTag(Lt,rt,Vt),!(this.options.ignoreDeclaration&&at.tagName==="?xml"||this.options.ignorePiTags)){const kt=new t(at.tagName);kt.add(this.options.textNodeName,""),at.tagName!==at.tagExp&&at.attrExpPresent&&(kt[":@"]=this.buildAttributesMap(at.tagExp,Vt,at.tagName)),this.addChild(rt,kt,Vt)}At=at.closeIndex+1}else if(K.substr(At+1,3)==="!--"){const at=W(K,"-->",At+4,"Comment is not closed.");if(this.options.commentPropName){const kt=K.substring(At+4,at-2);Lt=this.saveTextToParentTag(Lt,rt,Vt),rt.add(this.options.commentPropName,[{[this.options.textNodeName]:kt}])}At=at}else if(K.substr(At+1,2)==="!D"){const at=i(K,At);this.docTypeEntities=at.entities,At=at.i}else if(K.substr(At+1,2)==="!["){const at=W(K,"]]>",At,"CDATA is not closed.")-2,kt=K.substring(At+9,at);Lt=this.saveTextToParentTag(Lt,rt,Vt);let X=this.parseTextData(kt,rt.tagname,Vt,!0,!1,!0,!0);X==null&&(X=""),this.options.cdataPropName?rt.add(this.options.cdataPropName,[{[this.options.textNodeName]:kt}]):rt.add(this.options.textNodeName,X),At=at+2}else{let at=j(K,At,this.options.removeNSPrefix),kt=at.tagName;const X=at.rawTagName;let ht=at.tagExp,Mt=at.attrExpPresent,pe=at.closeIndex;this.options.transformTagName&&(kt=this.options.transformTagName(kt)),rt&&Lt&&rt.tagname!=="!xml"&&(Lt=this.saveTextToParentTag(Lt,rt,Vt,!1));const Ct=rt;if(Ct&&this.options.unpairedTags.indexOf(Ct.tagname)!==-1&&(rt=this.tagsNodeStack.pop(),Vt=Vt.substring(0,Vt.lastIndexOf("."))),kt!==ft.tagname&&(Vt+=Vt?"."+kt:kt),this.isItStopNode(this.options.stopNodes,Vt,kt)){let Dt="";if(ht.length>0&&ht.lastIndexOf("/")===ht.length-1)kt[kt.length-1]==="/"?(kt=kt.substr(0,kt.length-1),Vt=Vt.substr(0,Vt.length-1),ht=kt):ht=ht.substr(0,ht.length-1),At=at.closeIndex;else if(this.options.unpairedTags.indexOf(kt)!==-1)At=at.closeIndex;else{const te=this.readStopNodeData(K,X,pe+1);if(!te)throw new Error(`Unexpected end of ${X}`);At=te.i,Dt=te.tagContent}const Gt=new t(kt);kt!==ht&&Mt&&(Gt[":@"]=this.buildAttributesMap(ht,Vt,kt)),Dt&&(Dt=this.parseTextData(Dt,kt,Vt,!0,Mt,!0,!0)),Vt=Vt.substr(0,Vt.lastIndexOf(".")),Gt.add(this.options.textNodeName,Dt),this.addChild(rt,Gt,Vt)}else{if(ht.length>0&&ht.lastIndexOf("/")===ht.length-1){kt[kt.length-1]==="/"?(kt=kt.substr(0,kt.length-1),Vt=Vt.substr(0,Vt.length-1),ht=kt):ht=ht.substr(0,ht.length-1),this.options.transformTagName&&(kt=this.options.transformTagName(kt));const Dt=new t(kt);kt!==ht&&Mt&&(Dt[":@"]=this.buildAttributesMap(ht,Vt,kt)),this.addChild(rt,Dt,Vt),Vt=Vt.substr(0,Vt.lastIndexOf("."))}else{const Dt=new t(kt);this.tagsNodeStack.push(rt),kt!==ht&&Mt&&(Dt[":@"]=this.buildAttributesMap(ht,Vt,kt)),this.addChild(rt,Dt,Vt),rt=Dt}Lt="",At=pe}}else Lt+=K[At];return ft.child};function C(K,ft,rt){const Lt=this.options.updateTag(ft.tagname,rt,ft[":@"]);Lt===!1||(typeof Lt=="string"&&(ft.tagname=Lt),K.addChild(ft))}const S=function(K){if(this.options.processEntities){for(let ft in this.docTypeEntities){const rt=this.docTypeEntities[ft];K=K.replace(rt.regx,rt.val)}for(let ft in this.lastEntities){const rt=this.lastEntities[ft];K=K.replace(rt.regex,rt.val)}if(this.options.htmlEntities)for(let ft in this.htmlEntities){const rt=this.htmlEntities[ft];K=K.replace(rt.regex,rt.val)}K=K.replace(this.ampEntity.regex,this.ampEntity.val)}return K};function L(K,ft,rt,Lt){return K&&(Lt===void 0&&(Lt=Object.keys(ft.child).length===0),K=this.parseTextData(K,ft.tagname,rt,!1,ft[":@"]?Object.keys(ft[":@"]).length!==0:!1,Lt),K!==void 0&&K!==""&&ft.add(this.options.textNodeName,K),K=""),K}function N(K,ft,rt){const Lt="*."+rt;for(const Vt in K){const At=K[Vt];if(Lt===At||ft===At)return!0}return!1}function G(K,ft,rt=">"){let Lt,Vt="";for(let At=ft;At<K.length;At++){let at=K[At];if(Lt)at===Lt&&(Lt="");else if(at==='"'||at==="'")Lt=at;else if(at===rt[0])if(rt[1]){if(K[At+1]===rt[1])return{data:Vt,index:At}}else return{data:Vt,index:At};else at==="	"&&(at=" ");Vt+=at}}function W(K,ft,rt,Lt){const Vt=K.indexOf(ft,rt);if(Vt===-1)throw new Error(Lt);return Vt+ft.length-1}function j(K,ft,rt,Lt=">"){const Vt=G(K,ft+1,Lt);if(!Vt)return;let At=Vt.data;const at=Vt.index,kt=At.search(/\s/);let X=At,ht=!0;kt!==-1&&(X=At.substring(0,kt),At=At.substring(kt+1).trimStart());const Mt=X;if(rt){const pe=X.indexOf(":");pe!==-1&&(X=X.substr(pe+1),ht=X!==Vt.data.substr(pe+1))}return{tagName:X,tagExp:At,closeIndex:at,attrExpPresent:ht,rawTagName:Mt}}function q(K,ft,rt){const Lt=rt;let Vt=1;for(;rt<K.length;rt++)if(K[rt]==="<")if(K[rt+1]==="/"){const At=W(K,">",rt,`${ft} is not closed`);if(K.substring(rt+2,At).trim()===ft&&(Vt--,Vt===0))return{tagContent:K.substring(Lt,rt),i:At};rt=At}else if(K[rt+1]==="?")rt=W(K,"?>",rt+1,"StopNode is not closed.");else if(K.substr(rt+1,3)==="!--")rt=W(K,"-->",rt+3,"StopNode is not closed.");else if(K.substr(rt+1,2)==="![")rt=W(K,"]]>",rt,"StopNode is not closed.")-2;else{const At=j(K,rt,">");At&&((At&&At.tagName)===ft&&At.tagExp[At.tagExp.length-1]!=="/"&&Vt++,rt=At.closeIndex)}}function Z(K,ft,rt){if(ft&&typeof K=="string"){const Lt=K.trim();return Lt==="true"?!0:Lt==="false"?!1:n(K,rt)}else return e.isExist(K)?K:""}return Jx=r,Jx}var Xx={},$O;function lft(){if($O)return Xx;$O=1;function e(s,o){return t(s,o)}function t(s,o,l){let h;const A={};for(let v=0;v<s.length;v++){const C=s[v],S=i(C);let L="";if(l===void 0?L=S:L=l+"."+S,S===o.textNodeName)h===void 0?h=C[S]:h+=""+C[S];else{if(S===void 0)continue;if(C[S]){let N=t(C[S],o,L);const G=r(N,o);C[":@"]?n(N,C[":@"],L,o):Object.keys(N).length===1&&N[o.textNodeName]!==void 0&&!o.alwaysCreateTextNode?N=N[o.textNodeName]:Object.keys(N).length===0&&(o.alwaysCreateTextNode?N[o.textNodeName]="":N=""),A[S]!==void 0&&A.hasOwnProperty(S)?(Array.isArray(A[S])||(A[S]=[A[S]]),A[S].push(N)):o.isArray(S,L,G)?A[S]=[N]:A[S]=N}}}return typeof h=="string"?h.length>0&&(A[o.textNodeName]=h):h!==void 0&&(A[o.textNodeName]=h),A}function i(s){const o=Object.keys(s);for(let l=0;l<o.length;l++){const h=o[l];if(h!==":@")return h}}function n(s,o,l,h){if(o){const A=Object.keys(o),v=A.length;for(let C=0;C<v;C++){const S=A[C];h.isArray(S,l+"."+S,!0,!0)?s[S]=[o[S]]:s[S]=o[S]}}}function r(s,o){const{textNodeName:l}=o,h=Object.keys(s).length;return!!(h===0||h===1&&(s[l]||typeof s[l]=="boolean"||s[l]===0))}return Xx.prettify=e,Xx}var Kx,tL;function cft(){if(tL)return Kx;tL=1;const{buildOptions:e}=nft(),t=aft(),{prettify:i}=lft(),n=XO();class r{constructor(o){this.externalEntities={},this.options=e(o)}parse(o,l){if(typeof o!="string")if(o.toString)o=o.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(l){l===!0&&(l={});const v=n.validate(o,l);if(v!==!0)throw Error(`${v.err.msg}:${v.err.line}:${v.err.col}`)}const h=new t(this.options);h.addExternalEntities(this.externalEntities);const A=h.parseXml(o);return this.options.preserveOrder||A===void 0?A:i(A,this.options)}addEntity(o,l){if(l.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(o.indexOf("&")!==-1||o.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(l==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[o]=l}}return Kx=r,Kx}var Qx,eL;function uft(){if(eL)return Qx;eL=1;const e=`
`;function t(l,h){let A="";return h.format&&h.indentBy.length>0&&(A=e),i(l,h,"",A)}function i(l,h,A,v){let C="",S=!1;for(let L=0;L<l.length;L++){const N=l[L],G=n(N);if(G===void 0)continue;let W="";if(A.length===0?W=G:W=`${A}.${G}`,G===h.textNodeName){let ft=N[G];s(W,h)||(ft=h.tagValueProcessor(G,ft),ft=o(ft,h)),S&&(C+=v),C+=ft,S=!1;continue}else if(G===h.cdataPropName){S&&(C+=v),C+=`<![CDATA[${N[G][0][h.textNodeName]}]]>`,S=!1;continue}else if(G===h.commentPropName){C+=v+`<!--${N[G][0][h.textNodeName]}-->`,S=!0;continue}else if(G[0]==="?"){const ft=r(N[":@"],h),rt=G==="?xml"?"":v;let Lt=N[G][0][h.textNodeName];Lt=Lt.length!==0?" "+Lt:"",C+=rt+`<${G}${Lt}${ft}?>`,S=!0;continue}let j=v;j!==""&&(j+=h.indentBy);const q=r(N[":@"],h),Z=v+`<${G}${q}`,K=i(N[G],h,W,j);h.unpairedTags.indexOf(G)!==-1?h.suppressUnpairedNode?C+=Z+">":C+=Z+"/>":(!K||K.length===0)&&h.suppressEmptyNode?C+=Z+"/>":K&&K.endsWith(">")?C+=Z+`>${K}${v}</${G}>`:(C+=Z+">",K&&v!==""&&(K.includes("/>")||K.includes("</"))?C+=v+h.indentBy+K+v:C+=K,C+=`</${G}>`),S=!0}return C}function n(l){const h=Object.keys(l);for(let A=0;A<h.length;A++){const v=h[A];if(l.hasOwnProperty(v)&&v!==":@")return v}}function r(l,h){let A="";if(l&&!h.ignoreAttributes)for(let v in l){if(!l.hasOwnProperty(v))continue;let C=h.attributeValueProcessor(v,l[v]);C=o(C,h),C===!0&&h.suppressBooleanAttributes?A+=` ${v.substr(h.attributeNamePrefix.length)}`:A+=` ${v.substr(h.attributeNamePrefix.length)}="${C}"`}return A}function s(l,h){l=l.substr(0,l.length-h.textNodeName.length-1);let A=l.substr(l.lastIndexOf(".")+1);for(let v in h.stopNodes)if(h.stopNodes[v]===l||h.stopNodes[v]==="*."+A)return!0;return!1}function o(l,h){if(l&&l.length>0&&h.processEntities)for(let A=0;A<h.entities.length;A++){const v=h.entities[A];l=l.replace(v.regex,v.val)}return l}return Qx=t,Qx}var Zx,iL;function hft(){if(iL)return Zx;iL=1;const e=uft(),t={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(o,l){return l},attributeValueProcessor:function(o,l){return l},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function i(o){this.options=Object.assign({},t,o),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=s),this.processTextOrObjNode=n,this.options.format?(this.indentate=r,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}i.prototype.build=function(o){return this.options.preserveOrder?e(o,this.options):(Array.isArray(o)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(o={[this.options.arrayNodeName]:o}),this.j2x(o,0).val)},i.prototype.j2x=function(o,l){let h="",A="";for(let v in o)if(Object.prototype.hasOwnProperty.call(o,v))if(typeof o[v]>"u")this.isAttribute(v)&&(A+="");else if(o[v]===null)this.isAttribute(v)?A+="":v[0]==="?"?A+=this.indentate(l)+"<"+v+"?"+this.tagEndChar:A+=this.indentate(l)+"<"+v+"/"+this.tagEndChar;else if(o[v]instanceof Date)A+=this.buildTextValNode(o[v],v,"",l);else if(typeof o[v]!="object"){const C=this.isAttribute(v);if(C)h+=this.buildAttrPairStr(C,""+o[v]);else if(v===this.options.textNodeName){let S=this.options.tagValueProcessor(v,""+o[v]);A+=this.replaceEntitiesValue(S)}else A+=this.buildTextValNode(o[v],v,"",l)}else if(Array.isArray(o[v])){const C=o[v].length;let S="",L="";for(let N=0;N<C;N++){const G=o[v][N];if(!(typeof G>"u"))if(G===null)v[0]==="?"?A+=this.indentate(l)+"<"+v+"?"+this.tagEndChar:A+=this.indentate(l)+"<"+v+"/"+this.tagEndChar;else if(typeof G=="object")if(this.options.oneListGroup){const W=this.j2x(G,l+1);S+=W.val,this.options.attributesGroupName&&G.hasOwnProperty(this.options.attributesGroupName)&&(L+=W.attrStr)}else S+=this.processTextOrObjNode(G,v,l);else if(this.options.oneListGroup){let W=this.options.tagValueProcessor(v,G);W=this.replaceEntitiesValue(W),S+=W}else S+=this.buildTextValNode(G,v,"",l)}this.options.oneListGroup&&(S=this.buildObjectNode(S,v,L,l)),A+=S}else if(this.options.attributesGroupName&&v===this.options.attributesGroupName){const C=Object.keys(o[v]),S=C.length;for(let L=0;L<S;L++)h+=this.buildAttrPairStr(C[L],""+o[v][C[L]])}else A+=this.processTextOrObjNode(o[v],v,l);return{attrStr:h,val:A}},i.prototype.buildAttrPairStr=function(o,l){return l=this.options.attributeValueProcessor(o,""+l),l=this.replaceEntitiesValue(l),this.options.suppressBooleanAttributes&&l==="true"?" "+o:" "+o+'="'+l+'"'};function n(o,l,h){const A=this.j2x(o,h+1);return o[this.options.textNodeName]!==void 0&&Object.keys(o).length===1?this.buildTextValNode(o[this.options.textNodeName],l,A.attrStr,h):this.buildObjectNode(A.val,l,A.attrStr,h)}i.prototype.buildObjectNode=function(o,l,h,A){if(o==="")return l[0]==="?"?this.indentate(A)+"<"+l+h+"?"+this.tagEndChar:this.indentate(A)+"<"+l+h+this.closeTag(l)+this.tagEndChar;{let v="</"+l+this.tagEndChar,C="";return l[0]==="?"&&(C="?",v=""),(h||h==="")&&o.indexOf("<")===-1?this.indentate(A)+"<"+l+h+C+">"+o+v:this.options.commentPropName!==!1&&l===this.options.commentPropName&&C.length===0?this.indentate(A)+`<!--${o}-->`+this.newLine:this.indentate(A)+"<"+l+h+C+this.tagEndChar+o+this.indentate(A)+v}},i.prototype.closeTag=function(o){let l="";return this.options.unpairedTags.indexOf(o)!==-1?this.options.suppressUnpairedNode||(l="/"):this.options.suppressEmptyNode?l="/":l=`></${o}`,l},i.prototype.buildTextValNode=function(o,l,h,A){if(this.options.cdataPropName!==!1&&l===this.options.cdataPropName)return this.indentate(A)+`<![CDATA[${o}]]>`+this.newLine;if(this.options.commentPropName!==!1&&l===this.options.commentPropName)return this.indentate(A)+`<!--${o}-->`+this.newLine;if(l[0]==="?")return this.indentate(A)+"<"+l+h+"?"+this.tagEndChar;{let v=this.options.tagValueProcessor(l,o);return v=this.replaceEntitiesValue(v),v===""?this.indentate(A)+"<"+l+h+this.closeTag(l)+this.tagEndChar:this.indentate(A)+"<"+l+h+">"+v+"</"+l+this.tagEndChar}},i.prototype.replaceEntitiesValue=function(o){if(o&&o.length>0&&this.options.processEntities)for(let l=0;l<this.options.entities.length;l++){const h=this.options.entities[l];o=o.replace(h.regex,h.val)}return o};function r(o){return this.options.indentBy.repeat(o)}function s(o){return o.startsWith(this.options.attributeNamePrefix)&&o!==this.options.textNodeName?o.substr(this.attrPrefixLen):!1}return Zx=i,Zx}var Yx,nL;function fft(){if(nL)return Yx;nL=1;const e=XO(),t=cft(),i=hft();return Yx={XMLParser:t,XMLValidator:e,XMLBuilder:i},Yx}var dft=fft();function rL(e,t){if(t!=null&&t._parser&&t._parser!=="fast-xml-parser")throw new Error(t==null?void 0:t._parser);const i={allowBooleanAttributes:!0,ignoreDeclaration:!0,removeNSPrefix:t==null?void 0:t.removeNSPrefix,textNodeName:t==null?void 0:t.textNodeName,isArray:(r,s,o,l)=>{var h;return!!((h=t==null?void 0:t.arrayPaths)!=null&&h.some(A=>s===A))},...t==null?void 0:t._fastXML},n=pft(e,i);return t!=null&&t.uncapitalizeKeys?Gx(n):n}function pft(e,t){return new dft.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"",...t}).parse(e)}const Aft="4.3.1",pc={dataType:null,batchType:null,name:"XML",id:"xml",module:"xml",version:Aft,worker:!1,extensions:["xml"],mimeTypes:["application/xml","text/xml"],testText:gft,options:{xml:{_parser:"fast-xml-parser",uncapitalizeKeys:!1,removeNSPrefix:!1,textNodeName:"value",arrayPaths:[]}},parse:async(e,t)=>rL(new TextDecoder().decode(e),{...pc.options.xml,...t==null?void 0:t.xml}),parseTextSync:(e,t)=>rL(e,{...pc.options.xml,...t==null?void 0:t.xml})};function gft(e){return e.startsWith("<?xml")}async function yf(e,t,i,n){return n._parse(e,t,i,n)}function yr(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const oL=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),sL=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);sL&&parseFloat(sL[1]);function mft(e,t){return aL(e||{},t)}function aL(e,t,i=0){if(i>3)return t;const n={...e};for(const[r,s]of Object.entries(t))s&&typeof s=="object"&&!Array.isArray(s)?n[r]=aL(n[r]||{},t[r],i+1):n[r]=t[r];return n}function yft(e){var t;globalThis.loaders||(globalThis.loaders={}),(t=globalThis.loaders).modules||(t.modules={}),Object.assign(globalThis.loaders.modules,e)}function _ft(e){var t,i;return((i=(t=globalThis.loaders)==null?void 0:t.modules)==null?void 0:i[e])||null}function vft(){var e;return(e=globalThis._loadersgl_)!=null&&e.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.1"),globalThis._loadersgl_.version}const bft=vft();function xft(e,t){if(!e)throw new Error("loaders.gl assertion failed.")}const Ng=typeof process!="object"||String(process)!=="[object process]"||process.browser,qx=typeof importScripts=="function",lL=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);lL&&parseFloat(lL[1]);const $x={};async function _f(e,t=null,i={},n=null){return t&&(e=wft(e,t,i,n)),$x[e]=$x[e]||Cft(e),await $x[e]}function wft(e,t,i={},n=null){if(!i.useLocalLibraries&&e.startsWith("http"))return e;n=n||e;const r=i.modules||{};return r[n]?r[n]:Ng?i.CDN?(xft(i.CDN.startsWith("http")),`${i.CDN}/${t}@${bft}/dist/libs/${n}`):qx?`../src/libs/${n}`:`modules/${t}/src/libs/${n}`:`modules/${t}/dist/libs/${n}`}async function Cft(e){if(e.endsWith("wasm"))return await Bft(e);if(!Ng)try{const{requireFromFile:i}=globalThis.loaders||{};return await(i==null?void 0:i(e))}catch(i){return console.error(i),null}if(qx)return importScripts(e);const t=await Tft(e);return Eft(t,e)}function Eft(e,t){if(!Ng){const{requireFromString:n}=globalThis.loaders||{};return n==null?void 0:n(e,t)}if(qx)return eval.call(globalThis,e),null;const i=document.createElement("script");i.id=t;try{i.appendChild(document.createTextNode(e))}catch{i.text=e}return document.body.appendChild(i),null}async function Bft(e){const{readFileAsArrayBuffer:t}=globalThis.loaders||{};return Ng||!t||e.startsWith("http")?await(await fetch(e)).arrayBuffer():await t(e)}async function Tft(e){const{readFileAsText:t}=globalThis.loaders||{};return Ng||!t||e.startsWith("http")?await(await fetch(e)).text():await t(e)}function Sft(e,t=5){return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?cL(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?cL(e,0,t):""}function cL(e,t,i){if(e.byteLength<=t+i)return"";const n=new DataView(e);let r="";for(let s=0;s<i;s++)r+=String.fromCharCode(n.getUint8(t+s));return r}function uL(e){try{return JSON.parse(e)}catch{throw new Error(`Failed to parse JSON from data starting with "${Sft(e)}"`)}}function Ug(e,t,i){const n=i!==void 0?new Uint8Array(e).subarray(t,t+i):new Uint8Array(e).subarray(t);return new Uint8Array(n).buffer}function ru(e,t){return yr(e>=0),yr(t>0),e+(t-1)&-4}function hL(e,t,i){let n;if(e instanceof ArrayBuffer)n=new Uint8Array(e);else{const r=e.byteOffset,s=e.byteLength;n=new Uint8Array(e.buffer||e.arrayBuffer,r,s)}return t.set(n,i),i+ru(n.byteLength,4)}const Ift="Queued Requests",Mft="Active Requests",Pft="Cancelled Requests",Rft="Queued Requests Ever",Dft="Active Requests Ever",Oft={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class fL{constructor(t={}){z(this,"props"),z(this,"stats"),z(this,"activeRequestCount",0),z(this,"requestQueue",[]),z(this,"requestMap",new Map),z(this,"updateTimer",null),this.props={...Oft,...t},this.stats=new x6({id:this.props.id}),this.stats.get(Ift),this.stats.get(Mft),this.stats.get(Pft),this.stats.get(Rft),this.stats.get(Dft)}scheduleRequest(t,i=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const n={handle:t,priority:0,getPriority:i},r=new Promise(s=>(n.resolve=s,n));return this.requestQueue.push(n),this.requestMap.set(t,r),this._issueNewRequests(),r}_issueRequest(t){const{handle:i,resolve:n}=t;let r=!1;const s=()=>{r||(r=!0,this.requestMap.delete(i),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let i=0;i<t;++i){const n=this.requestQueue.shift();n&&this._issueRequest(n)}}}_updateAllRequests(){const t=this.requestQueue;for(let i=0;i<t.length;++i){const n=t[i];this._updateRequest(n)||(t.splice(i,1),this.requestMap.delete(n.handle),i--)}t.sort((i,n)=>i.priority-n.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}function Lft(){var e;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const t=(e=window.location)==null?void 0:e.pathname;return(t==null?void 0:t.slice(0,t.lastIndexOf("/")+1))||""}function dL(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}function Fft(...e){const t=[];for(let s=0;s<e.length;s++)t[s]=e[s];let i="",n=!1,r;for(let s=t.length-1;s>=-1&&!n;s--){let o;s>=0?o=t[s]:(r===void 0&&(r=Lft()),o=r),o.length!==0&&(i=`${o}/${i}`,n=o.charCodeAt(0)===Gg)}return i=kft(i,!n),n?`/${i}`:i.length>0?i:"."}const Gg=47,tw=46;function kft(e,t){let i="",n=-1,r=0,s,o=!1;for(let l=0;l<=e.length;++l){if(l<e.length)s=e.charCodeAt(l);else{if(s===Gg)break;s=Gg}if(s===Gg){if(!(n===l-1||r===1))if(n!==l-1&&r===2){if(i.length<2||!o||i.charCodeAt(i.length-1)!==tw||i.charCodeAt(i.length-2)!==tw){if(i.length>2){const h=i.length-1;let A=h;for(;A>=0&&i.charCodeAt(A)!==Gg;--A);if(A!==h){i=A===-1?"":i.slice(0,A),n=l,r=0,o=!1;continue}}else if(i.length===2||i.length===1){i="",n=l,r=0,o=!1;continue}}t&&(i.length>0?i+="/..":i="..",o=!0)}else{const h=e.slice(n+1,l);i.length>0?i+=`/${h}`:i=h,o=!1}n=l,r=0}else s===tw&&r!==-1?++r:r=-1}return i}class Nft{constructor(t){z(this,"fetch"),z(this,"loadOptions"),z(this,"_needsRefresh",!0),z(this,"props"),this.props={...t},this.loadOptions={...t.loadOptions},this.fetch=Uft(this.loadOptions)}setProps(t){this.props=Object.assign(this.props,t),this.setNeedsRefresh()}setNeedsRefresh(){this._needsRefresh=!0}getNeedsRefresh(t=!0){const i=this._needsRefresh;return t&&(this._needsRefresh=!1),i}}function Uft(e){const t=e==null?void 0:e.fetch;if(t&&typeof t=="function")return(n,r)=>t(n,r);const i=e==null?void 0:e.fetch;return i&&typeof i!="function"?n=>fetch(n,i):n=>fetch(n)}class zg extends Nft{}z(zg,"type","template"),z(zg,"testURL",e=>!1);function Gft(e,t){var i,n,r;const s=(i=pc.parseTextSync)==null?void 0:i.call(pc,e,t),o=((n=s==null?void 0:s.ServiceExceptionReport)==null?void 0:n.ServiceException)||((r=s==null?void 0:s["ogc:ServiceExceptionReport"])==null?void 0:r["ogc:ServiceException"]);return typeof o=="string"?o:o.value||o.code||"Unknown error"}const zft="4.3.1",_p={dataType:null,batchType:null,id:"wms-error",name:"WMS Error",module:"wms",version:zft,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.se_xml","application/xml","text/xml"],testText:Vft,options:{wms:{throwOnError:!1}},parse:async(e,t)=>ew(new TextDecoder().decode(e),t),parseSync:(e,t)=>ew(new TextDecoder().decode(e),t),parseTextSync:(e,t)=>ew(e,t)};function Vft(e){return e.startsWith("<?xml")}function ew(e,t){const i={..._p.options.wms,...t==null?void 0:t.wms},n=Gft(e,i),r=i.minimalErrors?n:`WMS Service error: ${n}`;if(i.throwOnError)throw new Error(r);return r}function vp(e){return Array.isArray(e)?e:e?[e]:[]}function Qy(e){const t=vp(e);return t.length>0&&t.every(i=>typeof i=="string")?t:[]}function Zy(e,t=void 0){switch(typeof e){case"number":return e;case"string":return parseFloat(e);default:return}}function iw(e,t=void 0){switch(typeof e){case"number":return e;case"string":return parseInt(e,10);default:return}}function bp(e){switch(e){case"true":return!0;case"false":return!1;case"1":return!0;case"0":return!1;default:return!1}}function pL(e,t){var i;const n=(i=pc.parseTextSync)==null?void 0:i.call(pc,e,t),r=n.WMT_MS_Capabilities||n.WMS_Capabilities||n,s=jft(r);if(t!=null&&t.inheritedLayerProps)for(const o of s.layers)gL(o,null);return t!=null&&t.includeRawJSON&&(s.json=r),t!=null&&t.includeXMLText&&(s.xml=e),s}function jft(e){var t,i,n,r,s,o,l,h,A,v,C,S,L,N,G,W;const j={version:String(e.version||""),name:String(((t=e.Service)==null?void 0:t.Name)||"unnamed"),title:(i=e.Service)!=null&&i.Title?String((n=e.Service)==null?void 0:n.Title):void 0,abstract:(r=e.Service)!=null&&r.Abstract?String((s=e.Service)==null?void 0:s.Abstract):void 0,keywords:Qy((l=(o=e.Service)==null?void 0:o.KeywordList)==null?void 0:l.Keyword),fees:(h=e.Service)!=null&&h.Fees?JSON.stringify((A=e.Service)==null?void 0:A.Fees):void 0,accessConstraints:(v=e.Service)!=null&&v.AccessConstraints?JSON.stringify((C=e.Service)==null?void 0:C.AccessConstraints):void 0,layerLimit:iw((S=e.Service)==null?void 0:S.LayerLimit),maxWidth:iw((L=e.Service)==null?void 0:L.maxWidth),maxHeight:iw((N=e.Service)==null?void 0:N.maxHeight),layers:[],requests:Hft((G=e.Capability)==null?void 0:G.Request),exceptions:Wft(e.Exception)},q=vp((W=e.Capability)==null?void 0:W.Layer);for(const Z of q)j.layers.push(AL(Z));for(const[Z,K]of Object.entries(j))K===void 0&&delete j[Z];return j}function Hft(e){const t={};for(const[i,n]of Object.entries(e||{})){const r=Qy(n==null?void 0:n.Format);t[i]={mimeTypes:r}}return t}function Wft(e){if(vp(e==null?void 0:e.Format).length>0)return{mimeTypes:Qy(e)}}function AL(e){var t;const i={title:String((e==null?void 0:e.Title)||""),name:(e==null?void 0:e.Name)&&String(e==null?void 0:e.Name),abstract:(e==null?void 0:e.Name)&&String(e==null?void 0:e.Abstract),keywords:Qy((t=e.KeywordList)==null?void 0:t.Keyword)},n=(e==null?void 0:e.CRS)||(e==null?void 0:e.SRS);n&&Array.isArray(n)&&n.every(A=>typeof A=="string")&&(i.crs=n);let r=(e==null?void 0:e.EX_GeographicBoundingBox)&&Jft(e==null?void 0:e.EX_GeographicBoundingBox);r&&(i.geographicBoundingBox=r),r=(e==null?void 0:e.LatLonBoundingBox)&&Xft(e==null?void 0:e.LatLonBoundingBox),r&&(i.geographicBoundingBox=r);const s=(e==null?void 0:e.BoundingBox)&&Kft(e==null?void 0:e.BoundingBox);s&&s.length>0&&(i.boundingBoxes=s);const o=vp(e==null?void 0:e.Dimension).map(A=>Zft(A));o.length&&(i.dimensions=o),e!=null&&e.opaque&&(i.opaque=bp(e==null?void 0:e.opaque)),e!=null&&e.cascaded&&(i.cascaded=bp(e==null?void 0:e.cascaded)),e!=null&&e.queryable&&(i.queryable=bp(e==null?void 0:e.queryable));const l=vp(e==null?void 0:e.Layer),h=[];for(const A of l)h.push(AL(A));h.length>0&&(i.layers=h);for(const[A,v]of Object.entries(i))v===void 0&&delete i[A];return i}function Jft(e){const{westBoundLongitude:t,northBoundLatitude:i,eastBoundLongitude:n,southBoundLatitude:r}=e;return[[t,r],[n,i]]}function Xft(e){const{minx:t,miny:i,maxx:n,maxy:r}=e;return[[t,i],[n,r]]}function Kft(e){return vp(e).map(t=>Qft(t))}function Qft(e){const{CRS:t,SRS:i,minx:n,miny:r,maxx:s,maxy:o,resx:l,resy:h}=e,A={crs:t||i,boundingBox:[[Zy(n),Zy(r)],[Zy(s),Zy(o)]]};return l&&(A.xResolution=l),h&&(A.yResolution=h),A}function Zft(e){const{name:t,units:i,value:n}=e,r={name:t,units:i,extent:n};return e.unitSymbol&&(r.unitSymbol=e.unitSymbol),e.default&&(r.defaultValue=e.default),e.multipleValues&&(r.multipleValues=bp(e.multipleValues)),e.nearestValue&&(r.nearestValue=bp(e.nearestValue)),e.current&&(r.current=bp(e.current)),r}function gL(e,t){t!=null&&t.geographicBoundingBox&&!e.geographicBoundingBox&&(e.geographicBoundingBox=[...t.geographicBoundingBox]),t!=null&&t.crs&&!e.crs&&(e.crs=[...t.crs]),t!=null&&t.boundingBoxes&&!e.boundingBoxes&&(e.boundingBoxes=[...t.boundingBoxes]),t!=null&&t.dimensions&&!e.dimensions&&(e.dimensions=[...t.dimensions]);for(const i of e.layers||[])gL(i,e)}const Yft="4.3.1",nw={dataType:null,batchType:null,id:"wms-capabilities",name:"WMS Capabilities",module:"wms",version:Yft,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.wms_xml","application/xml","text/xml"],testText:qft,options:{wms:{}},parse:async(e,t)=>pL(new TextDecoder().decode(e),t==null?void 0:t.wms),parseTextSync:(e,t)=>pL(e,t==null?void 0:t.wms)};function qft(e){return e.startsWith("<?xml")}function mL(e,t){var i,n;const r=((n=((i=pc.parseTextSync)==null?void 0:i.call(pc,e,t)).FeatureInfoResponse)==null?void 0:n.FIELDS)||[];return{features:(Array.isArray(r)?r:[r]).map(s=>$ft(s))}}function $ft(e){return{attributes:e||{},type:"",bounds:{bottom:0,top:0,left:0,right:0}}}const tdt={...nw,dataType:null,id:"wms-feature-info",name:"WMS FeatureInfo",parse:async(e,t)=>mL(new TextDecoder().decode(e),t),parseTextSync:(e,t)=>mL(e,t)};function yL(e,t){var i;return(i=pc.parseTextSync)==null?void 0:i.call(pc,e,t)}const edt={...nw,dataType:null,id:"wms-layer-description",name:"WMS DescribeLayer",parse:async(e,t)=>yL(new TextDecoder().decode(e),t),parseTextSync:(e,t)=>yL(e,t)},idt="4.3.1";var _L;const ndt=(_L=globalThis.loaders)==null?void 0:_L.parseImageNode,rw=typeof Image<"u",ow=typeof ImageBitmap<"u",rdt=!!ndt,sw=oL?!0:rdt;function odt(e){switch(e){case"auto":return ow||rw||sw;case"imagebitmap":return ow;case"image":return rw;case"data":return sw;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}function sdt(){if(ow)return"imagebitmap";if(rw)return"image";if(sw)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function adt(e){const t=ldt(e);if(!t)throw new Error("Not an image");return t}function aw(e){switch(adt(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),i=t.getContext("2d");if(!i)throw new Error("getImageData");return t.width=e.width,t.height=e.height,i.drawImage(e,0,0),i.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function ldt(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&e instanceof Image?"image":e&&typeof e=="object"&&e.data&&e.width&&e.height?"data":null}const cdt=/^data:image\/svg\+xml/,udt=/\.svg((\?|#).*)?$/;function lw(e){return e&&(cdt.test(e)||udt.test(e))}function hdt(e,t){if(lw(t)){let i=new TextDecoder().decode(e);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(n){throw new Error(n.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return vL(e,t)}function vL(e,t){if(lw(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function bL(e,t,i){const n=hdt(e,i),r=self.URL||self.webkitURL,s=typeof n!="string"&&r.createObjectURL(n);try{return await fdt(s||n,t)}finally{s&&r.revokeObjectURL(s)}}async function fdt(e,t){const i=new Image;return i.src=e,t.image&&t.image.decode&&i.decode?(await i.decode(),i):await new Promise((n,r)=>{try{i.onload=()=>n(i),i.onerror=s=>{const o=s instanceof Error?s.message:"error";r(new Error(o))}}catch(s){r(s)}})}const ddt={};let xL=!0;async function pdt(e,t,i){let n;lw(i)?n=await bL(e,t,i):n=vL(e,i);const r=t&&t.imagebitmap;return await Adt(n,r)}async function Adt(e,t=null){if((gdt(t)||!xL)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(i){console.warn(i),xL=!1}return await createImageBitmap(e)}function gdt(e){for(const t in e||ddt)return!1;return!0}function mdt(e){return!bdt(e,"ftyp",4)||(e[8]&96)===0?null:ydt(e)}function ydt(e){switch(_dt(e,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function _dt(e,t,i){return String.fromCharCode(...e.slice(t,i))}function vdt(e){return[...e].map(t=>t.charCodeAt(0))}function bdt(e,t,i=0){const n=vdt(t);for(let r=0;r<n.length;++r)if(n[r]!==e[r+i])return!1;return!0}const Ac=!1,Vg=!0;function Yy(e){const t=jg(e);return wdt(t)||Bdt(t)||Cdt(t)||Edt(t)||xdt(t)}function xdt(e){const t=new Uint8Array(e instanceof DataView?e.buffer:e),i=mdt(t);return i?{mimeType:i.mimeType,width:0,height:0}:null}function wdt(e){const t=jg(e);return t.byteLength>=24&&t.getUint32(0,Ac)===2303741511?{mimeType:"image/png",width:t.getUint32(16,Ac),height:t.getUint32(20,Ac)}:null}function Cdt(e){const t=jg(e);return t.byteLength>=10&&t.getUint32(0,Ac)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,Vg),height:t.getUint16(8,Vg)}:null}function Edt(e){const t=jg(e);return t.byteLength>=14&&t.getUint16(0,Ac)===16973&&t.getUint32(2,Vg)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,Vg),height:t.getUint32(22,Vg)}:null}function Bdt(e){const t=jg(e);if(!(t.byteLength>=3&&t.getUint16(0,Ac)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:n}=Tdt();let r=2;for(;r+9<t.byteLength;){const s=t.getUint16(r,Ac);if(n.has(s))return{mimeType:"image/jpeg",height:t.getUint16(r+5,Ac),width:t.getUint16(r+7,Ac)};if(!i.has(s))return null;r+=2,r+=t.getUint16(r,Ac)}return null}function Tdt(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function jg(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}async function Sdt(e,t){var i;const{mimeType:n}=Yy(e)||{},r=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return yr(r),await r(e,n)}async function Idt(e,t,i){t=t||{};const n=(t.image||{}).type||"auto",{url:r}=i||{},s=Mdt(n);let o;switch(s){case"imagebitmap":o=await pdt(e,t,r);break;case"image":o=await bL(e,t,r);break;case"data":o=await Sdt(e);break;default:yr(!1)}return n==="data"&&(o=aw(o)),o}function Mdt(e){switch(e){case"auto":case"data":return sdt();default:return odt(e),e}}const Pdt=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],Rdt=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Ddt={image:{type:"auto",decode:!0}},qy={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:idt,mimeTypes:Rdt,extensions:Pdt,parse:Idt,tests:[e=>!!Yy(new DataView(e))],options:Ddt},cw={};function wL(e){if(cw[e]===void 0){const t=oL?Ldt(e):Odt(e);cw[e]=t}return cw[e]}function Odt(e){var t,i;const n=["image/png","image/jpeg","image/gif"],r=((t=globalThis.loaders)==null?void 0:t.imageFormatsNode)||n;return!!((i=globalThis.loaders)!=null&&i.parseImageNode)&&r.includes(e)}function Ldt(e){switch(e){case"image/avif":case"image/webp":return Fdt(e);default:return!0}}function Fdt(e){try{return document.createElement("canvas").toDataURL(e).indexOf(`data:${e}`)===0}catch{return!1}}const kdt={name:"Web Map Service (OGC WMS)",id:"wms",module:"wms",version:"0.0.0",extensions:[],mimeTypes:[],options:{wms:{}},type:"wms",fromUrl:!0,fromBlob:!1,testURL:e=>e.toLowerCase().includes("wms"),createDataSource:(e,t)=>new Ndt(e,t)};class Ndt extends zg{constructor(t,i){var n,r,s;super(i),z(this,"url"),z(this,"data"),z(this,"substituteCRS84"),z(this,"flipCRS"),z(this,"wmsParameters"),z(this,"vendorParameters"),z(this,"capabilities",null),this.url=t,this.data=t,this.substituteCRS84=((n=i.wms)==null?void 0:n.substituteCRS84)??i.substituteCRS84??!1,this.flipCRS=["EPSG:4326"],this.wmsParameters={layers:void 0,query_layers:void 0,styles:void 0,version:"1.3.0",crs:"EPSG:4326",format:"image/png",info_format:"text/plain",transparent:void 0,time:void 0,elevation:void 0,...i.wmsParameters,...(r=i.wms)==null?void 0:r.wmsParameters},this.vendorParameters=((s=i.wms)==null?void 0:s.vendorParameters)||i.vendorParameters||{}}async getMetadata(){const t=await this.getCapabilities();return this.normalizeMetadata(t)}async getImage(t){const{boundingBox:i,bbox:n,...r}=t,s={bbox:i?[...i[0],...i[1]]:n,...r};return await this.getMap(s)}normalizeMetadata(t){return t}async getCapabilities(t,i){const n=this.getCapabilitiesURL(t,i),r=await this.fetch(n),s=await r.arrayBuffer();this._checkResponse(r,s);const o=await nw.parse(s,this.loadOptions);return this.capabilities=o,o}async getMap(t,i){const n=this.getMapURL(t,i),r=await this.fetch(n),s=await r.arrayBuffer();this._checkResponse(r,s);try{return await qy.parse(s,this.loadOptions)}catch{throw this._parseError(s)}}async getFeatureInfo(t,i){const n=this.getFeatureInfoURL(t,i),r=await this.fetch(n),s=await r.arrayBuffer();return this._checkResponse(r,s),await tdt.parse(s,this.loadOptions)}async getFeatureInfoText(t,i){const n=this.getFeatureInfoURL(t,i),r=await this.fetch(n),s=await r.arrayBuffer();return this._checkResponse(r,s),new TextDecoder().decode(s)}async describeLayer(t,i){const n=this.describeLayerURL(t,i),r=await this.fetch(n),s=await r.arrayBuffer();return this._checkResponse(r,s),await edt.parse(s,this.loadOptions)}async getLegendGraphic(t,i){const n=this.getLegendGraphicURL(t,i),r=await this.fetch(n),s=await r.arrayBuffer();this._checkResponse(r,s);try{return await qy.parse(s,this.loadOptions)}catch{throw this._parseError(s)}}getCapabilitiesURL(t,i){const n={version:this.wmsParameters.version,...t};return this._getWMSUrl("GetCapabilities",n,i)}getMapURL(t,i){t=this._getWMS130Parameters(t);const n={version:this.wmsParameters.version,format:this.wmsParameters.format,transparent:this.wmsParameters.transparent,time:this.wmsParameters.time,elevation:this.wmsParameters.elevation,layers:this.wmsParameters.layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...t};return this._getWMSUrl("GetMap",n,i)}getFeatureInfoURL(t,i){t=this._getWMS130Parameters(t);const{boundingBox:n,bbox:r}=t;t.bbox=n?[...n[0],...n[1]]:r;const s={version:this.wmsParameters.version,info_format:this.wmsParameters.info_format,layers:this.wmsParameters.layers,query_layers:this.wmsParameters.query_layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...t};return this._getWMSUrl("GetFeatureInfo",s,i)}describeLayerURL(t,i){const n={version:this.wmsParameters.version,...t};return this._getWMSUrl("DescribeLayer",n,i)}getLegendGraphicURL(t,i){const n={version:this.wmsParameters.version,...t};return this._getWMSUrl("GetLegendGraphic",n,i)}_parseWMSUrl(t){const[i,n]=t.split("?"),r=n.split("&"),s={};for(const o of r){const[l,h]=o.split("=");s[l]=h}return{url:i,parameters:s}}_getWMSUrl(t,i,n){let r=this.url,s=!0;const o={service:"WMS",version:i.version,request:t,...i,...this.vendorParameters,...n},l=["transparent","time","elevation"];for(const[h,A]of Object.entries(o))(!l.includes(h)||A)&&(r+=s?"?":"&",s=!1,r+=this._getURLParameter(h,A,i));return encodeURI(r)}_getWMS130Parameters(t){const i={...t};return i.srs&&(i.crs=i.crs||i.srs,delete i.srs),i}_getURLParameter(t,i,n){switch(t){case"crs":n.version!=="1.3.0"?t="srs":this.substituteCRS84&&i==="EPSG:4326"&&(i="CRS:84");break;case"srs":n.version==="1.3.0"&&(t="crs");break;case"bbox":const r=this._flipBoundingBox(i,n);r&&(i=r);break;case"x":n.version==="1.3.0"&&(t="i");break;case"y":n.version==="1.3.0"&&(t="j");break}return t=t.toUpperCase(),Array.isArray(i)?`${t}=${i.join(",")}`:`${t}=${i?String(i):""}`}_flipBoundingBox(t,i){if(!Array.isArray(t)||t.length!==4)return null;const n=i.version==="1.3.0"&&this.flipCRS.includes(i.crs||"")&&!(this.substituteCRS84&&i.crs==="EPSG:4326"),r=t;return n?[r[1],r[0],r[3],r[2]]:r}async _fetchArrayBuffer(t){const i=await this.fetch(t),n=await i.arrayBuffer();return this._checkResponse(i,n),n}_checkResponse(t,i){var n;const r=t.headers["content-type"];if(!t.ok||_p.mimeTypes.includes(r)){const s=mft(this.loadOptions,{wms:{throwOnError:!0}}),o=(n=_p.parseSync)==null?void 0:n.call(_p,i,s);throw new Error(o)}}_parseError(t){var i;const n=(i=_p.parseSync)==null?void 0:i.call(_p,t,this.loadOptions);return new Error(n)}}const Udt={name:"ArcGISImageServer",id:"arcgis-image-server",module:"wms",version:"0.0.0",extensions:[],mimeTypes:[],options:{"arcgis-image-server":{}},type:"arcgis-image-server",fromUrl:!0,fromBlob:!1,testURL:e=>e.toLowerCase().includes("ImageServer"),createDataSource:(e,t)=>new Gdt(e,t)};class Gdt extends zg{constructor(t,i){super(i),z(this,"url"),z(this,"data"),this.url=t,this.data=t}async getMetadata(){return await this.metadata()}async getImage(t){throw new Error("not implemented")}async metadata(){throw new Error("not implemented")}exportImage(t){throw new Error("not implemented")}metadataURL(t){return`${this.url}?f=pjson`}exportImageURL(t){const i=`bbox=${t.bbox[0]},${t.bbox[1]},${t.bbox[2]},${t.bbox[3]}`,n=`size=${t.width},${t.height}`,r={...t,bbox:i,size:n};return delete r.width,delete r.height,this.getUrl("exportImage",r)}getUrl(t,i,n){let r=`${this.url}/${t}`,s=!0;for(const[o,l]of Object.entries(i))r+=s?"?":"&",s=!1,Array.isArray(l)?r+=`${o.toUpperCase()}=${l.join(",")}`:r+=`${o.toUpperCase()}=${l?String(l):""}`;return r}async checkResponse(t){if(!t.ok)throw new Error("error")}}const zdt=[kdt,Udt];function Vdt(e,t=zdt){const{type:i="auto"}=e,n=i==="auto"?Hdt(e.url,t):jdt(i,t);if(!n)throw new Error("Not a valid image source type");return n.createDataSource(e.url,e)}function jdt(e,t){for(const i of t)if(i.type===e)return i;return null}function Hdt(e,t){for(const i of t)if(i.testURL&&i.testURL(e))return i;return null}const CL=6378137*Math.PI;function EL(e){const t=Yc(e);return t[0]=(t[0]/256-1)*CL,t[1]=(t[1]/256-1)*CL,t}const Wdt={id:"imagery-layer",data:"",serviceType:"auto",srs:"auto",layers:{type:"array",compare:!0,value:[]},onMetadataLoad:{type:"function",value:()=>{}},onMetadataLoadError:{type:"function",value:console.error},onImageLoadStart:{type:"function",value:()=>{}},onImageLoad:{type:"function",value:()=>{}},onImageLoadError:{type:"function",compare:!1,value:(e,t)=>console.error(t,e)}};class uw extends Mo{get isLoaded(){var t;return((t=this.state)==null?void 0:t.loadCounter)===0&&super.isLoaded}shouldUpdateState(){return!0}initializeState(){this.state._nextRequestId=0,this.state.lastRequestId=-1,this.state.loadCounter=0}updateState({changeFlags:t,props:i,oldProps:n}){const{viewport:r}=this.context;t.dataChanged||i.serviceType!==n.serviceType?(this.state.imageSource=this._createImageSource(i),this._loadMetadata(),this.debounce(()=>this.loadImage(r,"image source changed"),0)):$r(i.layers,n.layers,1)?t.viewportChanged&&this.debounce(()=>this.loadImage(r,"viewport changed")):this.debounce(()=>this.loadImage(r,"layers changed"),0)}finalizeState(){}renderLayers(){const{bounds:t,image:i,lastRequestParameters:n}=this.state;return i&&new Ry({...this.getSubLayerProps({id:"bitmap"}),_imageCoordinateSystem:n.srs==="EPSG:4326"?qi.LNGLAT:qi.CARTESIAN,bounds:t,image:i})}async getFeatureInfoText(t,i){var n,r;const{lastRequestParameters:s}=this.state;return s?await((r=(n=this.state.imageSource).getFeatureInfoText)==null?void 0:r.call(n,{...s,query_layers:s.layers,x:t,y:i,info_format:"application/vnd.ogc.gml"})):""}_createImageSource(t){if(t.data instanceof zg)return t.data;if(typeof t.data=="string")return Vdt({url:t.data,loadOptions:t.loadOptions,type:t.serviceType});throw new Error("invalid image source in props.data")}async _loadMetadata(){var t,i;const{imageSource:n}=this.state;try{this.state.loadCounter++;const r=await n.getMetadata();this.state.imageSource===n&&((t=this.getCurrentLayer())==null||t.props.onMetadataLoad(r))}catch(r){(i=this.getCurrentLayer())==null||i.props.onMetadataLoadError(r)}finally{this.state.loadCounter--}}async loadImage(t,i){var n,r;const{layers:s,serviceType:o}=this.props;if(o==="wms"&&s.length===0)return;const l=t.getBounds(),{width:h,height:A}=t,v=this.getRequestId();let{srs:C}=this.props;C==="auto"&&(C=t.resolution?"EPSG:4326":"EPSG:3857");const S={width:h,height:A,boundingBox:[[l[0],l[1]],[l[2],l[3]]],layers:s,crs:C};if(C==="EPSG:3857"){const L=EL([l[0],l[1]]),N=EL([l[2],l[3]]);S.boundingBox=[L,N]}try{this.state.loadCounter++,this.props.onImageLoadStart(v);const L=await this.state.imageSource.getImage(S);this.state.lastRequestId<v&&((n=this.getCurrentLayer())==null||n.props.onImageLoad(v),this.setState({image:L,bounds:l,lastRequestParameters:S,lastRequestId:v}))}catch(L){this.raiseError(L,"Load image"),(r=this.getCurrentLayer())==null||r.props.onImageLoadError(v,L)}finally{this.state.loadCounter--}}getRequestId(){return this.state._nextRequestId++}debounce(t,i=500){clearTimeout(this.state._timeoutId),this.state._timeoutId=setTimeout(()=>t(),i)}}uw.layerName="WMSLayer",uw.defaultProps=Wdt;const Jdt={getHeight:{type:"accessor",value:0},greatCircle:!0};class hw extends Mg{}hw.layerName="GreatCircleLayer",hw.defaultProps=Jdt;const Xdt={...fh.defaultProps};class dh extends Mo{indexToBounds(){return null}renderLayers(){const{elevationScale:t,extruded:i,wireframe:n,filled:r,stroked:s,lineWidthUnits:o,lineWidthScale:l,lineWidthMinPixels:h,lineWidthMaxPixels:A,lineJointRounded:v,lineMiterLimit:C,lineDashJustified:S,getElevation:L,getFillColor:N,getLineColor:G,getLineWidth:W}=this.props,{updateTriggers:j,material:q,transitions:Z}=this.props,K=this.getSubLayerClass("cell",fh),{updateTriggers:ft,...rt}=this.indexToBounds()||{};return new K({filled:r,wireframe:n,extruded:i,elevationScale:t,stroked:s,lineWidthUnits:o,lineWidthScale:l,lineWidthMinPixels:h,lineWidthMaxPixels:A,lineJointRounded:v,lineMiterLimit:C,lineDashJustified:S,material:q,transitions:Z,getElevation:L,getFillColor:N,getLineColor:G,getLineWidth:W},this.getSubLayerProps({id:"cell",updateTriggers:j&&{...ft,getElevation:j.getElevation,getFillColor:j.getFillColor,getLineColor:j.getLineColor,getLineWidth:j.getLineWidth}}),rt)}}dh.layerName="GeoCellLayer",dh.defaultProps=Xdt;function Kdt(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var fw={exports:{}},Qdt=fw.exports,BL;function Zdt(){return BL||(BL=1,function(e){/**
 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/long.js for details
 */(function(t,i){typeof Kdt=="function"&&e&&e.exports?e.exports=i():(t.dcodeIO=t.dcodeIO||{}).Long=i()})(Qdt,function(){function t(at,kt,X){this.low=at|0,this.high=kt|0,this.unsigned=!!X}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function i(at){return(at&&at.__isLong__)===!0}t.isLong=i;var n={},r={};function s(at,kt){var X,ht,Mt;return kt?(at>>>=0,(Mt=0<=at&&at<256)&&(ht=r[at],ht)?ht:(X=l(at,(at|0)<0?-1:0,!0),Mt&&(r[at]=X),X)):(at|=0,(Mt=-128<=at&&at<128)&&(ht=n[at],ht)?ht:(X=l(at,at<0?-1:0,!1),Mt&&(n[at]=X),X))}t.fromInt=s;function o(at,kt){if(isNaN(at)||!isFinite(at))return kt?q:j;if(kt){if(at<0)return q;if(at>=N)return Lt}else{if(at<=-9223372036854776e3)return Vt;if(at+1>=G)return rt}return at<0?o(-at,kt).neg():l(at%L|0,at/L|0,kt)}t.fromNumber=o;function l(at,kt,X){return new t(at,kt,X)}t.fromBits=l;var h=Math.pow;function A(at,kt,X){if(at.length===0)throw Error("empty string");if(at==="NaN"||at==="Infinity"||at==="+Infinity"||at==="-Infinity")return j;if(typeof kt=="number"?(X=kt,kt=!1):kt=!!kt,X=X||10,X<2||36<X)throw RangeError("radix");var ht;if((ht=at.indexOf("-"))>0)throw Error("interior hyphen");if(ht===0)return A(at.substring(1),kt,X).neg();for(var Mt=o(h(X,8)),pe=j,Ct=0;Ct<at.length;Ct+=8){var Dt=Math.min(8,at.length-Ct),Gt=parseInt(at.substring(Ct,Ct+Dt),X);if(Dt<8){var te=o(h(X,Dt));pe=pe.mul(te).add(o(Gt))}else pe=pe.mul(Mt),pe=pe.add(o(Gt))}return pe.unsigned=kt,pe}t.fromString=A;function v(at){return at instanceof t?at:typeof at=="number"?o(at):typeof at=="string"?A(at):l(at.low,at.high,at.unsigned)}t.fromValue=v;var C=65536,S=1<<24,L=C*C,N=L*L,G=N/2,W=s(S),j=s(0);t.ZERO=j;var q=s(0,!0);t.UZERO=q;var Z=s(1);t.ONE=Z;var K=s(1,!0);t.UONE=K;var ft=s(-1);t.NEG_ONE=ft;var rt=l(-1,2147483647,!1);t.MAX_VALUE=rt;var Lt=l(-1,-1,!0);t.MAX_UNSIGNED_VALUE=Lt;var Vt=l(0,-2147483648,!1);t.MIN_VALUE=Vt;var At=t.prototype;return At.toInt=function(){return this.unsigned?this.low>>>0:this.low},At.toNumber=function(){return this.unsigned?(this.high>>>0)*L+(this.low>>>0):this.high*L+(this.low>>>0)},At.toString=function(at){if(at=at||10,at<2||36<at)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Vt)){var kt=o(at),X=this.div(kt),ht=X.mul(kt).sub(this);return X.toString(at)+ht.toInt().toString(at)}else return"-"+this.neg().toString(at);for(var Mt=o(h(at,6),this.unsigned),pe=this,Ct="";;){var Dt=pe.div(Mt),Gt=pe.sub(Dt.mul(Mt)).toInt()>>>0,te=Gt.toString(at);if(pe=Dt,pe.isZero())return te+Ct;for(;te.length<6;)te="0"+te;Ct=""+te+Ct}},At.getHighBits=function(){return this.high},At.getHighBitsUnsigned=function(){return this.high>>>0},At.getLowBits=function(){return this.low},At.getLowBitsUnsigned=function(){return this.low>>>0},At.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Vt)?64:this.neg().getNumBitsAbs();for(var at=this.high!=0?this.high:this.low,kt=31;kt>0&&(at&1<<kt)==0;kt--);return this.high!=0?kt+33:kt+1},At.isZero=function(){return this.high===0&&this.low===0},At.isNegative=function(){return!this.unsigned&&this.high<0},At.isPositive=function(){return this.unsigned||this.high>=0},At.isOdd=function(){return(this.low&1)===1},At.isEven=function(){return(this.low&1)===0},At.equals=function(at){return i(at)||(at=v(at)),this.unsigned!==at.unsigned&&this.high>>>31===1&&at.high>>>31===1?!1:this.high===at.high&&this.low===at.low},At.eq=At.equals,At.notEquals=function(at){return!this.eq(at)},At.neq=At.notEquals,At.lessThan=function(at){return this.comp(at)<0},At.lt=At.lessThan,At.lessThanOrEqual=function(at){return this.comp(at)<=0},At.lte=At.lessThanOrEqual,At.greaterThan=function(at){return this.comp(at)>0},At.gt=At.greaterThan,At.greaterThanOrEqual=function(at){return this.comp(at)>=0},At.gte=At.greaterThanOrEqual,At.compare=function(at){if(i(at)||(at=v(at)),this.eq(at))return 0;var kt=this.isNegative(),X=at.isNegative();return kt&&!X?-1:!kt&&X?1:this.unsigned?at.high>>>0>this.high>>>0||at.high===this.high&&at.low>>>0>this.low>>>0?-1:1:this.sub(at).isNegative()?-1:1},At.comp=At.compare,At.negate=function(){return!this.unsigned&&this.eq(Vt)?Vt:this.not().add(Z)},At.neg=At.negate,At.add=function(at){i(at)||(at=v(at));var kt=this.high>>>16,X=this.high&65535,ht=this.low>>>16,Mt=this.low&65535,pe=at.high>>>16,Ct=at.high&65535,Dt=at.low>>>16,Gt=at.low&65535,te=0,re=0,ae=0,he=0;return he+=Mt+Gt,ae+=he>>>16,he&=65535,ae+=ht+Dt,re+=ae>>>16,ae&=65535,re+=X+Ct,te+=re>>>16,re&=65535,te+=kt+pe,te&=65535,l(ae<<16|he,te<<16|re,this.unsigned)},At.subtract=function(at){return i(at)||(at=v(at)),this.add(at.neg())},At.sub=At.subtract,At.multiply=function(at){if(this.isZero()||(i(at)||(at=v(at)),at.isZero()))return j;if(this.eq(Vt))return at.isOdd()?Vt:j;if(at.eq(Vt))return this.isOdd()?Vt:j;if(this.isNegative())return at.isNegative()?this.neg().mul(at.neg()):this.neg().mul(at).neg();if(at.isNegative())return this.mul(at.neg()).neg();if(this.lt(W)&&at.lt(W))return o(this.toNumber()*at.toNumber(),this.unsigned);var kt=this.high>>>16,X=this.high&65535,ht=this.low>>>16,Mt=this.low&65535,pe=at.high>>>16,Ct=at.high&65535,Dt=at.low>>>16,Gt=at.low&65535,te=0,re=0,ae=0,he=0;return he+=Mt*Gt,ae+=he>>>16,he&=65535,ae+=ht*Gt,re+=ae>>>16,ae&=65535,ae+=Mt*Dt,re+=ae>>>16,ae&=65535,re+=X*Gt,te+=re>>>16,re&=65535,re+=ht*Dt,te+=re>>>16,re&=65535,re+=Mt*Ct,te+=re>>>16,re&=65535,te+=kt*Gt+X*Dt+ht*Ct+Mt*pe,te&=65535,l(ae<<16|he,te<<16|re,this.unsigned)},At.mul=At.multiply,At.divide=function(at){if(i(at)||(at=v(at)),at.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?q:j;var kt,X,ht;if(this.unsigned){if(at.unsigned||(at=at.toUnsigned()),at.gt(this))return q;if(at.gt(this.shru(1)))return K;ht=q}else{if(this.eq(Vt)){if(at.eq(Z)||at.eq(ft))return Vt;if(at.eq(Vt))return Z;var Mt=this.shr(1);return kt=Mt.div(at).shl(1),kt.eq(j)?at.isNegative()?Z:ft:(X=this.sub(at.mul(kt)),ht=kt.add(X.div(at)),ht)}else if(at.eq(Vt))return this.unsigned?q:j;if(this.isNegative())return at.isNegative()?this.neg().div(at.neg()):this.neg().div(at).neg();if(at.isNegative())return this.div(at.neg()).neg();ht=j}for(X=this;X.gte(at);){kt=Math.max(1,Math.floor(X.toNumber()/at.toNumber()));for(var pe=Math.ceil(Math.log(kt)/Math.LN2),Ct=pe<=48?1:h(2,pe-48),Dt=o(kt),Gt=Dt.mul(at);Gt.isNegative()||Gt.gt(X);)kt-=Ct,Dt=o(kt,this.unsigned),Gt=Dt.mul(at);Dt.isZero()&&(Dt=Z),ht=ht.add(Dt),X=X.sub(Gt)}return ht},At.div=At.divide,At.modulo=function(at){return i(at)||(at=v(at)),this.sub(this.div(at).mul(at))},At.mod=At.modulo,At.not=function(){return l(~this.low,~this.high,this.unsigned)},At.and=function(at){return i(at)||(at=v(at)),l(this.low&at.low,this.high&at.high,this.unsigned)},At.or=function(at){return i(at)||(at=v(at)),l(this.low|at.low,this.high|at.high,this.unsigned)},At.xor=function(at){return i(at)||(at=v(at)),l(this.low^at.low,this.high^at.high,this.unsigned)},At.shiftLeft=function(at){return i(at)&&(at=at.toInt()),(at&=63)===0?this:at<32?l(this.low<<at,this.high<<at|this.low>>>32-at,this.unsigned):l(0,this.low<<at-32,this.unsigned)},At.shl=At.shiftLeft,At.shiftRight=function(at){return i(at)&&(at=at.toInt()),(at&=63)===0?this:at<32?l(this.low>>>at|this.high<<32-at,this.high>>at,this.unsigned):l(this.high>>at-32,this.high>=0?0:-1,this.unsigned)},At.shr=At.shiftRight,At.shiftRightUnsigned=function(at){if(i(at)&&(at=at.toInt()),at&=63,at===0)return this;var kt=this.high;if(at<32){var X=this.low;return l(X>>>at|kt<<32-at,kt>>>at,this.unsigned)}else return at===32?l(kt,0,this.unsigned):l(kt>>>at-32,0,this.unsigned)},At.shru=At.shiftRightUnsigned,At.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},At.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},At.toBytes=function(at){return at?this.toBytesLE():this.toBytesBE()},At.toBytesLE=function(){var at=this.high,kt=this.low;return[kt&255,kt>>>8&255,kt>>>16&255,kt>>>24&255,at&255,at>>>8&255,at>>>16&255,at>>>24&255]},At.toBytesBE=function(){var at=this.high,kt=this.low;return[at>>>24&255,at>>>16&255,at>>>8&255,at&255,kt>>>24&255,kt>>>16&255,kt>>>8&255,kt&255]},t})}(fw)),fw.exports}var Ydt=Zdt();const $y=Jh(Ydt),qdt=3,$dt=30,tpt=2*$dt+1,TL=180/Math.PI;function ept(e,t,i){const n=1<<t;return[(e[0]+i[0])/n,(e[1]+i[1])/n]}function SL(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function ipt(e){return[SL(e[0]),SL(e[1])]}function npt(e,[t,i]){switch(e){case 0:return[1,t,i];case 1:return[-t,1,i];case 2:return[-t,-i,1];case 3:return[-1,-i,-t];case 4:return[i,-1,-t];case 5:return[i,t,-1];default:throw new Error("Invalid face")}}function rpt([e,t,i]){const n=Math.atan2(i,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*TL,n*TL]}function opt(e){let t=$y.fromString(e,!0,10).toString(2);for(;t.length<qdt+tpt;)t="0"+t;const i=t.lastIndexOf("1"),n=t.substring(0,3),r=t.substring(3,i),s=r.length/2,o=$y.fromString(n,!0,2).toString(10);let l=$y.fromString(r,!0,2).toString(4);for(;l.length<s;)l="0"+l;return`${o}/${l}`}function spt(e,t,i,n){if(n===0){i===1&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);const r=t[0];t[0]=t[1],t[1]=r}}function apt(e){const t=e.split("/"),i=parseInt(t[0],10),n=t[1],r=n.length,s=[0,0];let o;for(let l=r-1;l>=0;l--){o=r-l;const h=n[l];let A=0,v=0;h==="1"?v=1:h==="2"?(A=1,v=1):h==="3"&&(A=1);const C=Math.pow(2,o-1);spt(C,s,A,v),s[0]+=C*A,s[1]+=C*v}if(i%2===1){const l=s[0];s[0]=s[1],s[1]=l}return{face:i,ij:s,level:o}}function lpt(e){const t=e.padEnd(16,"0");return $y.fromString(t,16)}const cpt=100;function upt({face:e,ij:t,level:i}){const n=[[0,0],[0,1],[1,1],[1,0],[0,0]],r=Math.max(1,Math.ceil(cpt*Math.pow(2,-i))),s=new Float64Array(4*r*2+2);let o=0,l=0;for(let h=0;h<4;h++){const A=n[h].slice(0),v=n[h+1],C=(v[0]-A[0])/r,S=(v[1]-A[1])/r;for(let L=0;L<r;L++){A[0]+=C,A[1]+=S;const N=ept(t,i,A),G=ipt(N),W=npt(e,G),j=rpt(W);Math.abs(j[1])>89.999&&(j[0]=l);const q=j[0]-l;j[0]+=q>180?-360:q<-180?360:0,s[o++]=j[0],s[o++]=j[1],l=j[0]}}return s[o++]=s[0],s[o++]=s[1],s}function hpt(e){if(typeof e=="string"){if(e.indexOf("/")>0)return e;e=lpt(e)}return opt(e.toString())}function fpt(e){const t=hpt(e),i=apt(t);return upt(i)}const dpt={getS2Token:{type:"accessor",value:e=>e.token}};class t_ extends dh{indexToBounds(){const{data:t,getS2Token:i}=this.props;return{data:t,_normalize:!1,positionFormat:"XY",getPolygon:(n,r)=>fpt(i(n,r))}}}t_.layerName="S2Layer",t_.defaultProps=dpt;const dw=512;function ppt(e,t){let i=0,n=0,r=1<<e.length;const s=r/dw;for(let o=0;o<e.length;o++){r>>=1;const l=parseInt(e[o]);l%2&&(i|=r),l>1&&(n|=r)}return[[i/s,dw-n/s],[(i+t)/s,dw-(n+t)/s]]}function Apt(e,t=1){const[i,n]=ppt(e,t),[r,s]=sc(i),[o,l]=sc(n);return[o,s,o,l,r,l,r,s,o,s]}const gpt={getQuadkey:{type:"accessor",value:e=>e.quadkey}};class e_ extends dh{indexToBounds(){const{data:t,extruded:i,getQuadkey:n}=this.props,r=i?.99:1;return{data:t,_normalize:!1,positionFormat:"XY",getPolygon:(s,o)=>Apt(n(s,o),r),updateTriggers:{getPolygon:r}}}}e_.layerName="QuadkeyLayer",e_.defaultProps=gpt;class IL{constructor(t){this.index=t,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(t){this._bbox||(this._bbox=t,"west"in t?this.boundingBox=[[t.west,t.south],[t.east,t.north]]:this.boundingBox=[[t.left,t.top],[t.right,t.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const t=this.content?this.content.byteLength:0;return Number.isFinite(t)||console.error("byteLength not defined in tile data"),t}async _loadData({getData:t,requestScheduler:i,onLoad:n,onError:r}){const{index:s,id:o,bbox:l,userData:h,zoom:A}=this,v=this._loaderId;this._abortController=new AbortController;const{signal:C}=this._abortController,S=await i.scheduleRequest(this,G=>G.isSelected?1:-1);if(!S){this._isCancelled=!0;return}if(this._isCancelled){S.done();return}let L=null,N;try{L=await t({index:s,id:o,bbox:l,userData:h,zoom:A,signal:C})}catch(G){N=G||!0}finally{S.done()}if(v===this._loaderId){if(this._loader=void 0,this.content=L,this._isCancelled&&!L){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,N?r(N,this):n(this)}}loadData(t){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(t),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var t;this.isLoaded||(this._isCancelled=!0,(t=this._abortController)==null||t.abort())}}const _s={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},ML=new de,mpt=new de;class KE{constructor(t=[0,0,0],i=[0,0,0],n){n=n||ML.copy(t).add(i).scale(.5),this.center=new de(n),this.halfDiagonal=new de(i).subtract(this.center),this.minimum=new de(t),this.maximum=new de(i)}clone(){return new KE(this.minimum,this.maximum,this.center)}equals(t){return this===t||!!t&&this.minimum.equals(t.minimum)&&this.maximum.equals(t.maximum)}transform(t){return this.center.transformAsPoint(t),this.halfDiagonal.transform(t),this.minimum.transform(t),this.maximum.transform(t),this}intersectPlane(t){const{halfDiagonal:i}=this,n=mpt.from(t.normal),r=i.x*Math.abs(n.x)+i.y*Math.abs(n.y)+i.z*Math.abs(n.z),s=this.center.dot(n)+t.distance;return s-r>0?_s.INSIDE:s+r<0?_s.OUTSIDE:_s.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const i=ML.from(t).subtract(this.center),{halfDiagonal:n}=this;let r=0,s;return s=Math.abs(i.x)-n.x,s>0&&(r+=s*s),s=Math.abs(i.y)-n.y,s>0&&(r+=s*s),s=Math.abs(i.z)-n.z,s>0&&(r+=s*s),r}}const Hg=new de,PL=new de;class cm{constructor(t=[0,0,0],i=0){this.radius=-0,this.center=new de,this.fromCenterRadius(t,i)}fromCenterRadius(t,i){return this.center.from(t),this.radius=i,this}fromCornerPoints(t,i){return i=Hg.from(i),this.center=new de().from(t).add(i).scale(.5),this.radius=this.center.distance(i),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new cm(this.center,this.radius)}union(t){const i=this.center,n=this.radius,r=t.center,s=t.radius,o=Hg.copy(r).subtract(i),l=o.magnitude();if(n>=l+s)return this.clone();if(s>=l+n)return t.clone();const h=(n+l+s)*.5;return PL.copy(o).scale((-n+h)/l).add(i),this.center.copy(PL),this.radius=h,this}expand(t){const i=Hg.from(t).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(t){this.center.transform(t);const i=gW(Hg,t);return this.radius=Math.max(i[0],Math.max(i[1],i[2]))*this.radius,this}distanceSquaredTo(t){const i=this.distanceTo(t);return i*i}distanceTo(t){const i=Hg.from(t).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(t){const i=this.center,n=this.radius,r=t.normal.dot(i)+t.distance;return r<-n?_s.OUTSIDE:r<n?_s.INTERSECTING:_s.INSIDE}}const ypt=new de,_pt=new de,i_=new de,n_=new de,r_=new de,vpt=new de,bpt=new de,ou={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class um{constructor(t=[0,0,0],i=[0,0,0,0,0,0,0,0,0]){this.center=new de().from(t),this.halfAxes=new mr(i)}get halfSize(){const t=this.halfAxes.getColumn(0),i=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new de(t).len(),new de(i).len(),new de(n).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),i=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),r=new de(t).normalize(),s=new de(i).normalize(),o=new de(n).normalize();return new YA().fromMatrix3(new mr([...r,...s,...o]))}fromCenterHalfSizeQuaternion(t,i,n){const r=new YA(n),s=new mr().fromQuaternion(r);return s[0]=s[0]*i[0],s[1]=s[1]*i[0],s[2]=s[2]*i[0],s[3]=s[3]*i[1],s[4]=s[4]*i[1],s[5]=s[5]*i[1],s[6]=s[6]*i[2],s[7]=s[7]*i[2],s[8]=s[8]*i[2],this.center=new de().from(t),this.halfAxes=s,this}clone(){return new um(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new cm){const i=this.halfAxes,n=i.getColumn(0,i_),r=i.getColumn(1,n_),s=i.getColumn(2,r_),o=ypt.copy(n).add(r).add(s);return t.center.copy(this.center),t.radius=o.magnitude(),t}intersectPlane(t){const i=this.center,n=t.normal,r=this.halfAxes,s=n.x,o=n.y,l=n.z,h=Math.abs(s*r[ou.COLUMN0ROW0]+o*r[ou.COLUMN0ROW1]+l*r[ou.COLUMN0ROW2])+Math.abs(s*r[ou.COLUMN1ROW0]+o*r[ou.COLUMN1ROW1]+l*r[ou.COLUMN1ROW2])+Math.abs(s*r[ou.COLUMN2ROW0]+o*r[ou.COLUMN2ROW1]+l*r[ou.COLUMN2ROW2]),A=n.dot(i)+t.distance;return A<=-h?_s.OUTSIDE:A>=h?_s.INSIDE:_s.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const i=_pt.from(t).subtract(this.center),n=this.halfAxes,r=n.getColumn(0,i_),s=n.getColumn(1,n_),o=n.getColumn(2,r_),l=r.magnitude(),h=s.magnitude(),A=o.magnitude();r.normalize(),s.normalize(),o.normalize();let v=0,C;return C=Math.abs(i.dot(r))-l,C>0&&(v+=C*C),C=Math.abs(i.dot(s))-h,C>0&&(v+=C*C),C=Math.abs(i.dot(o))-A,C>0&&(v+=C*C),v}computePlaneDistances(t,i,n=[-0,-0]){let r=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const o=this.center,l=this.halfAxes,h=l.getColumn(0,i_),A=l.getColumn(1,n_),v=l.getColumn(2,r_),C=vpt.copy(h).add(A).add(v).add(o),S=bpt.copy(C).subtract(t);let L=i.dot(S);return r=Math.min(L,r),s=Math.max(L,s),C.copy(o).add(h).add(A).subtract(v),S.copy(C).subtract(t),L=i.dot(S),r=Math.min(L,r),s=Math.max(L,s),C.copy(o).add(h).subtract(A).add(v),S.copy(C).subtract(t),L=i.dot(S),r=Math.min(L,r),s=Math.max(L,s),C.copy(o).add(h).subtract(A).subtract(v),S.copy(C).subtract(t),L=i.dot(S),r=Math.min(L,r),s=Math.max(L,s),o.copy(C).subtract(h).add(A).add(v),S.copy(C).subtract(t),L=i.dot(S),r=Math.min(L,r),s=Math.max(L,s),o.copy(C).subtract(h).add(A).subtract(v),S.copy(C).subtract(t),L=i.dot(S),r=Math.min(L,r),s=Math.max(L,s),o.copy(C).subtract(h).subtract(A).add(v),S.copy(C).subtract(t),L=i.dot(S),r=Math.min(L,r),s=Math.max(L,s),o.copy(C).subtract(h).subtract(A).subtract(v),S.copy(C).subtract(t),L=i.dot(S),r=Math.min(L,r),s=Math.max(L,s),n[0]=r,n[1]=s,n}transform(t){this.center.transformAsPoint(t);const i=this.halfAxes.getColumn(0,i_);i.transformAsPoint(t);const n=this.halfAxes.getColumn(1,n_);n.transformAsPoint(t);const r=this.halfAxes.getColumn(2,r_);return r.transformAsPoint(t),this.halfAxes=new mr([...i,...n,...r]),this}getTransform(){throw new Error("not implemented")}}const RL=new de,DL=new de;class Rl{constructor(t=[0,0,1],i=0){this.normal=new de,this.distance=-0,this.fromNormalDistance(t,i)}fromNormalDistance(t,i){return Al(Number.isFinite(i)),this.normal.from(t).normalize(),this.distance=i,this}fromPointNormal(t,i){t=RL.from(t),this.normal.from(i).normalize();const n=-this.normal.dot(t);return this.distance=n,this}fromCoefficients(t,i,n,r){return this.normal.set(t,i,n),Al(fa(this.normal.len(),1)),this.distance=r,this}clone(){return new Rl(this.normal,this.distance)}equals(t){return fa(this.distance,t.distance)&&fa(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const i=DL.copy(this.normal).transformAsVector(t).normalize(),n=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(n,i)}projectPointOntoPlane(t,i=[0,0,0]){const n=RL.from(t),r=this.getPointDistance(n),s=DL.copy(this.normal).scale(r);return n.subtract(s).to(i)}}const OL=[new de([1,0,0]),new de([0,1,0]),new de([0,0,1])],LL=new de,xpt=new de;class ba{constructor(t=[]){this.planes=t}fromBoundingSphere(t){this.planes.length=2*OL.length;const i=t.center,n=t.radius;let r=0;for(const s of OL){let o=this.planes[r],l=this.planes[r+1];o||(o=this.planes[r]=new Rl),l||(l=this.planes[r+1]=new Rl);const h=LL.copy(s).scale(-n).add(i);o.fromPointNormal(h,s);const A=LL.copy(s).scale(n).add(i),v=xpt.copy(s).negate();l.fromPointNormal(A,v),r+=2}return this}computeVisibility(t){let i=_s.INSIDE;for(const n of this.planes)switch(t.intersectPlane(n)){case _s.OUTSIDE:return _s.OUTSIDE;case _s.INTERSECTING:i=_s.INTERSECTING;break}return i}computeVisibilityWithPlaneMask(t,i){if(Al(Number.isFinite(i),"parentPlaneMask is required."),i===ba.MASK_OUTSIDE||i===ba.MASK_INSIDE)return i;let n=ba.MASK_INSIDE;const r=this.planes;for(let s=0;s<this.planes.length;++s){const o=s<31?1<<s:0;if(s<31&&(i&o)===0)continue;const l=r[s],h=t.intersectPlane(l);if(h===_s.OUTSIDE)return ba.MASK_OUTSIDE;h===_s.INTERSECTING&&(n|=o)}return n}}ba.MASK_OUTSIDE=4294967295,ba.MASK_INSIDE=0,ba.MASK_INDETERMINATE=2147483647,new de,new de,new de,new de,new de,new de,new de,new de,new de,new de,new de,new de,new de,new de,new de,new de,new de;const gc=new mr,wpt=new mr,Cpt=new mr,o_=new mr,FL=new mr;function Ept(e,t={}){const i=eJ,n=10;let r=0,s=0;const o=wpt,l=Cpt;o.identity(),l.copy(e);const h=i*Bpt(l);for(;s<n&&Tpt(l)>h;)Spt(l,o_),FL.copy(o_).transpose(),l.multiplyRight(o_),l.multiplyLeft(FL),o.multiplyRight(o_),++r>2&&(++s,r=0);return t.unitary=o.toTarget(t.unitary),t.diagonal=l.toTarget(t.diagonal),t}function Bpt(e){let t=0;for(let i=0;i<9;++i){const n=e[i];t+=n*n}return Math.sqrt(t)}const pw=[1,0,0],Aw=[2,2,1];function Tpt(e){let t=0;for(let i=0;i<3;++i){const n=e[gc.getElementIndex(Aw[i],pw[i])];t+=2*n*n}return Math.sqrt(t)}function Spt(e,t){const i=HI;let n=0,r=1;for(let A=0;A<3;++A){const v=Math.abs(e[gc.getElementIndex(Aw[A],pw[A])]);v>n&&(r=A,n=v)}const s=pw[r],o=Aw[r];let l=1,h=0;if(Math.abs(e[gc.getElementIndex(o,s)])>i){const A=e[gc.getElementIndex(o,o)],v=e[gc.getElementIndex(s,s)],C=e[gc.getElementIndex(o,s)],S=(A-v)/2/C;let L;S<0?L=-1/(-S+Math.sqrt(1+S*S)):L=1/(S+Math.sqrt(1+S*S)),l=1/Math.sqrt(1+L*L),h=L*l}return mr.IDENTITY.to(t),t[gc.getElementIndex(s,s)]=t[gc.getElementIndex(o,o)]=l,t[gc.getElementIndex(o,s)]=h,t[gc.getElementIndex(s,o)]=-h,t}const ph=new de,Ipt=new de,Mpt=new de,Ppt=new de,Rpt=new de,Dpt=new mr,Opt={diagonal:new mr,unitary:new mr};function kL(e,t=new um){if(!e||e.length===0)return t.halfAxes=new mr([0,0,0,0,0,0,0,0,0]),t.center=new de,t;const i=e.length,n=new de(0,0,0);for(const At of e)n.add(At);const r=1/i;n.multiplyByScalar(r);let s=0,o=0,l=0,h=0,A=0,v=0;for(const At of e){const at=ph.copy(At).subtract(n);s+=at.x*at.x,o+=at.x*at.y,l+=at.x*at.z,h+=at.y*at.y,A+=at.y*at.z,v+=at.z*at.z}s*=r,o*=r,l*=r,h*=r,A*=r,v*=r;const C=Dpt;C[0]=s,C[1]=o,C[2]=l,C[3]=o,C[4]=h,C[5]=A,C[6]=l,C[7]=A,C[8]=v;const{unitary:S}=Ept(C,Opt),L=t.halfAxes.copy(S);let N=L.getColumn(0,Mpt),G=L.getColumn(1,Ppt),W=L.getColumn(2,Rpt),j=-Number.MAX_VALUE,q=-Number.MAX_VALUE,Z=-Number.MAX_VALUE,K=Number.MAX_VALUE,ft=Number.MAX_VALUE,rt=Number.MAX_VALUE;for(const At of e)ph.copy(At),j=Math.max(ph.dot(N),j),q=Math.max(ph.dot(G),q),Z=Math.max(ph.dot(W),Z),K=Math.min(ph.dot(N),K),ft=Math.min(ph.dot(G),ft),rt=Math.min(ph.dot(W),rt);N=N.multiplyByScalar(.5*(K+j)),G=G.multiplyByScalar(.5*(ft+q)),W=W.multiplyByScalar(.5*(rt+Z)),t.center.copy(N).add(G).add(W);const Lt=Ipt.set(j-K,q-ft,Z-rt).multiplyByScalar(.5),Vt=new mr([Lt[0],0,0,0,Lt[1],0,0,0,Lt[2]]);return t.halfAxes.multiplyRight(Vt),t}const xp=512,Lpt=3,NL=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],UL=NL.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),Fpt=UL.concat([[.25,.5],[.75,.5]]);class sA{constructor(t,i,n){this.x=t,this.y=i,this.z=n}get children(){if(!this._children){const t=this.x*2,i=this.y*2,n=this.z+1;this._children=[new sA(t,i,n),new sA(t,i+1,n),new sA(t+1,i,n),new sA(t+1,i+1,n)]}return this._children}update(t){const{viewport:i,cullingVolume:n,elevationBounds:r,minZ:s,maxZ:o,bounds:l,offset:h,project:A}=t,v=this.getBoundingVolume(r,h,A);if(l&&!this.insideBounds(l)||n.computeVisibility(v)<0)return!1;if(!this.childVisible){let{z:C}=this;if(C<o&&C>=s){const S=v.distanceTo(i.cameraPosition)*i.scale/i.height;C+=Math.floor(Math.log2(S))}if(C>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const C of this.children)C.update(t);return!0}getSelected(t=[]){if(this.selected&&t.push(this),this._children)for(const i of this._children)i.getSelected(t);return t}insideBounds([t,i,n,r]){const s=Math.pow(2,this.z),o=xp/s;return this.x*o<n&&this.y*o<r&&(this.x+1)*o>t&&(this.y+1)*o>i}getBoundingVolume(t,i,n){if(n){const h=this.z<1?Fpt:this.z<2?UL:NL,A=[];for(const v of h){const C=yw(this.x+v[0],this.y+v[1],this.z);C[2]=t[0],A.push(n(C)),t[0]!==t[1]&&(C[2]=t[1],A.push(n(C)))}return kL(A)}const r=Math.pow(2,this.z),s=xp/r,o=this.x*s+i*xp,l=xp-(this.y+1)*s;return new KE([o,l,t[0]],[o+s,l+s,t[1]])}}function kpt(e,t,i,n){const r=e instanceof M$&&e.resolution?e.projectPosition:null,s=Object.values(e.getFrustumPlanes()).map(({normal:L,distance:N})=>new Rl(L.clone().negate(),N)),o=new ba(s),l=e.distanceScales.unitsPerMeter[2],h=i&&i[0]*l||0,A=i&&i[1]*l||0,v=e instanceof ng&&e.pitch<=60?t:0;if(n){const[L,N,G,W]=n,j=Yc([L,W]),q=Yc([G,N]);n=[j[0],xp-j[1],q[0],xp-q[1]]}const C=new sA(0,0,0),S={viewport:e,project:r,cullingVolume:o,elevationBounds:[h,A],minZ:v,maxZ:t,bounds:n,offset:0};if(C.update(S),e instanceof ng&&e.subViewports&&e.subViewports.length>1){for(S.offset=-1;C.update(S)&&!(--S.offset<-3););for(S.offset=1;C.update(S)&&!(++S.offset>Lpt););}return C.getSelected()}const su=512,Npt=[-1/0,-1/0,1/0,1/0],s_={type:"object",value:null,validate:(e,t)=>t.optional&&e===null||typeof e=="string"||Array.isArray(e)&&e.every(i=>typeof i=="string"),equal:(e,t)=>{if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t))return!1;const i=e.length;if(i!==t.length)return!1;for(let n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0}};function zL(e,t){const i=[t.transformAsPoint([e[0],e[1]]),t.transformAsPoint([e[2],e[1]]),t.transformAsPoint([e[0],e[3]]),t.transformAsPoint([e[2],e[3]])];return[Math.min(...i.map(n=>n[0])),Math.min(...i.map(n=>n[1])),Math.max(...i.map(n=>n[0])),Math.max(...i.map(n=>n[1]))]}function Upt(e){return Math.abs(e.split("").reduce((t,i)=>(t<<5)-t+i.charCodeAt(0)|0,0))}function vf(e,t){if(!e||!e.length)return null;const{index:i,id:n}=t;if(Array.isArray(e)){const s=Upt(n)%e.length;e=e[s]}let r=e;for(const s of Object.keys(i)){const o=new RegExp(`{${s}}`,"g");r=r.replace(o,String(i[s]))}return Number.isInteger(i.y)&&Number.isInteger(i.z)&&(r=r.replace(/\{-y\}/g,String(Math.pow(2,i.z)-i.y-1))),r}function Gpt(e,t,i){let n;return n=e.getBounds(),e.isGeospatial?[Math.max(n[0],i[0]),Math.max(n[1],i[1]),Math.min(n[2],i[2]),Math.min(n[3],i[3])]:[Math.max(Math.min(n[0],i[2]),i[0]),Math.max(Math.min(n[1],i[3]),i[1]),Math.min(Math.max(n[2],i[0]),i[2]),Math.min(Math.max(n[3],i[1]),i[3])]}function zpt({viewport:e,z:t,cullRect:i}){return(e.subViewports||[e]).map(n=>gw(n,t||0,i))}function gw(e,t,i){if(!Array.isArray(t)){const s=i.x-e.x,o=i.y-e.y,{width:l,height:h}=i,A={targetZ:t},v=e.unproject([s,o],A),C=e.unproject([s+l,o],A),S=e.unproject([s,o+h],A),L=e.unproject([s+l,o+h],A);return[Math.min(v[0],C[0],S[0],L[0]),Math.min(v[1],C[1],S[1],L[1]),Math.max(v[0],C[0],S[0],L[0]),Math.max(v[1],C[1],S[1],L[1])]}const n=gw(e,t[0],i),r=gw(e,t[1],i);return[Math.min(n[0],r[0]),Math.min(n[1],r[1]),Math.max(n[2],r[2]),Math.max(n[3],r[3])]}function Vpt(e,t,i){return i?zL(e,i).map(n=>n*t/su):e.map(n=>n*t/su)}function mw(e,t){return Math.pow(2,e)*su/t}function yw(e,t,i){const n=mw(i,su),r=e/n*360-180,s=Math.PI-2*Math.PI*t/n,o=180/Math.PI*Math.atan(.5*(Math.exp(s)-Math.exp(-s)));return[r,o]}function VL(e,t,i,n){const r=mw(i,n);return[e/r*su,t/r*su]}function jpt(e,t,i,n,r=su){if(e.isGeospatial){const[A,v]=yw(t,i,n),[C,S]=yw(t+1,i+1,n);return{west:A,north:v,east:C,south:S}}const[s,o]=VL(t,i,n,r),[l,h]=VL(t+1,i+1,n,r);return{left:s,top:o,right:l,bottom:h}}function Hpt(e,t,i,n,r){const s=Gpt(e,null,n),o=mw(t,i),[l,h,A,v]=Vpt(s,o,r),C=[];for(let S=Math.floor(l);S<A;S++)for(let L=Math.floor(h);L<v;L++)C.push({x:S,y:L,z:t});return C}function Wpt({viewport:e,maxZoom:t,minZoom:i,zRange:n,extent:r,tileSize:s=su,modelMatrix:o,modelMatrixInverse:l,zoomOffset:h=0}){let A=e.isGeospatial?Math.round(e.zoom+Math.log2(su/s))+h:Math.ceil(e.zoom)+h;if(typeof i=="number"&&Number.isFinite(i)&&A<i){if(!r)return[];A=i}typeof t=="number"&&Number.isFinite(t)&&A>t&&(A=t);let v=r;return o&&l&&r&&!e.isGeospatial&&(v=zL(r,o)),e.isGeospatial?kpt(e,A,n,r):Hpt(e,A,s,v||Npt,l)}function Jpt(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function Xpt(e){return Number.isFinite(e.west)&&Number.isFinite(e.north)&&Number.isFinite(e.east)&&Number.isFinite(e.south)}function Kpt(e){let t={},i;return n=>{for(const r in n)if(!Qpt(n[r],t[r])){i=e(n),t=n;break}return i}}function Qpt(e,t){if(e===t)return!0;if(Array.isArray(e)){const i=e.length;if(!t||t.length!==i)return!1;for(let n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0}return!1}const jL=1,a_=2,Zpt="never",Ypt="no-overlap",_w="best-available",qpt=5,$pt={[_w]:eAt,[Ypt]:iAt,[Zpt]:()=>{}},tAt={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class l_{constructor(t){this._getCullBounds=Kpt(zpt),this.opts={...tAt,...t},this.setOptions(this.opts),this.onTileLoad=i=>{var n,r;(r=(n=this.opts).onTileLoad)==null||r.call(n,i),this.opts.maxCacheByteSize!==null&&(this._cacheByteSize+=i.byteLength,this._resizeCache())},this._requestScheduler=new fL({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new mn,this._modelMatrixInverse=new mn}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(t=>t.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(t=>t.needsReload)}setOptions(t){Object.assign(this.opts,t),Number.isFinite(t.maxZoom)&&(this._maxZoom=Math.floor(t.maxZoom)),Number.isFinite(t.minZoom)&&(this._minZoom=Math.ceil(t.minZoom))}finalize(){for(const t of this._cache.values())t.isLoading&&t.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const t of this._cache.keys()){const i=this._cache.get(t);!this._selectedTiles||!this._selectedTiles.includes(i)?this._cache.delete(t):i.setNeedsReload()}}update(t,{zRange:i,modelMatrix:n}={zRange:null,modelMatrix:null}){const r=n?new mn(n):new mn,s=!r.equals(this._modelMatrix);if(!this._viewport||!t.equals(this._viewport)||!fa(this._zRange,i)||s){s&&(this._modelMatrixInverse=r.clone().invert(),this._modelMatrix=r),this._viewport=t,this._zRange=i;const l=this.getTileIndices({viewport:t,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:i,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=l.map(h=>this._getTile(h,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(l=>this._getTile(l.index,!0)));const o=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}isTileVisible(t,i){if(!t.isVisible)return!1;if(i&&this._viewport){const n=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:i}),{bbox:r}=t;for(const[s,o,l,h]of n){let A;if("west"in r)A=r.west<l&&r.east>s&&r.south<h&&r.north>o;else{const v=Math.min(r.top,r.bottom),C=Math.max(r.top,r.bottom);A=r.left<l&&r.right>s&&v<h&&C>o}if(A)return!0}return!1}return!0}getTileIndices({viewport:t,maxZoom:i,minZoom:n,zRange:r,modelMatrix:s,modelMatrixInverse:o}){const{tileSize:l,extent:h,zoomOffset:A}=this.opts;return Wpt({viewport:t,maxZoom:i,minZoom:n,zRange:r,tileSize:l,extent:h,modelMatrix:s,modelMatrixInverse:o,zoomOffset:A})}getTileId(t){return`${t.x}-${t.y}-${t.z}`}getTileZoom(t){return t.z}getTileMetadata(t){const{tileSize:i}=this.opts;return{bbox:jpt(this._viewport,t.x,t.y,t.z,i)}}getParentIndex(t){const i=Math.floor(t.x/2),n=Math.floor(t.y/2),r=t.z-1;return{x:i,y:n,z:r}}updateTileStates(){const t=this.opts.refinementStrategy||_w,i=new Array(this._cache.size);let n=0;for(const r of this._cache.values())i[n++]=r.isVisible,r.isSelected=!1,r.isVisible=!1;for(const r of this._selectedTiles)r.isSelected=!0,r.isVisible=!0;(typeof t=="function"?t:$pt[t])(Array.from(this._cache.values())),n=0;for(const r of this._cache.values())if(i[n++]!==r.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:t=0}=this.opts,i=[];let n=0;for(const r of this._cache.values())r.isLoading&&(n++,!r.isSelected&&!r.isVisible&&i.push(r));for(;t>0&&n>t&&i.length>0;)i.shift().abort(),n--}_rebuildTree(){const{_cache:t}=this;for(const i of t.values())i.parent=null,i.children&&(i.children.length=0);for(const i of t.values()){const n=this._getNearestAncestor(i);i.parent=n,n!=null&&n.children&&n.children.push(i)}}_resizeCache(){var t,i;const{_cache:n,opts:r}=this,s=r.maxCacheSize??(r.maxCacheByteSize!==null?1/0:qpt*this.selectedTiles.length),o=r.maxCacheByteSize??1/0;if(n.size>s||this._cacheByteSize>o){for(const[l,h]of n)if(!h.isVisible&&!h.isSelected&&(this._cacheByteSize-=r.maxCacheByteSize!==null?h.byteLength:0,n.delete(l),(i=(t=this.opts).onTileUnload)==null||i.call(t,h)),n.size<=s&&this._cacheByteSize<=o)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((l,h)=>l.zoom-h.zoom),this._dirty=!1)}_getTile(t,i){const n=this.getTileId(t);let r=this._cache.get(n),s=!1;return!r&&i?(r=new IL(t),Object.assign(r,this.getTileMetadata(r.index)),Object.assign(r,{id:n,zoom:this.getTileZoom(r.index)}),s=!0,this._cache.set(n,r),this._dirty=!0):r&&r.needsReload&&(s=!0),r&&s&&r.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),r}_getNearestAncestor(t){const{_minZoom:i=0}=this;let n=t.index;for(;this.getTileZoom(n)>i;){n=this.getParentIndex(n);const r=this._getTile(n);if(r)return r}return null}}function eAt(e){for(const t of e)t.state=0;for(const t of e)t.isSelected&&!HL(t)&&vw(t);for(const t of e)t.isVisible=!!(t.state&a_)}function iAt(e){for(const i of e)i.state=0;for(const i of e)i.isSelected&&HL(i);const t=Array.from(e).sort((i,n)=>i.zoom-n.zoom);for(const i of t)if(i.isVisible=!!(i.state&a_),i.children&&(i.isVisible||i.state&jL))for(const n of i.children)n.state=jL;else i.isSelected&&vw(i)}function HL(e){let t=e;for(;t;){if(t.isLoaded||t.content)return t.state|=a_,!0;t=t.parent}return!1}function vw(e){for(const t of e.children)t.isLoaded||t.content?t.state|=a_:vw(t)}const nAt={TilesetClass:l_,data:{type:"data",value:[]},dataComparator:s_.equal,renderSubLayers:{type:"function",value:e=>new nu(e)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:e=>{}},onTileUnload:{type:"function",value:e=>{}},onTileError:{type:"function",value:e=>console.error(e)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:_w,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class au extends Mo{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var t,i;(i=(t=this.state)==null?void 0:t.tileset)==null||i.finalize()}get isLoaded(){var t,i,n;return!!((n=(i=(t=this.state)==null?void 0:t.tileset)==null?void 0:i.selectedTiles)!=null&&n.every(r=>r.isLoaded&&r.layers&&r.layers.every(s=>s.isLoaded)))}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({changeFlags:t}){let{tileset:i}=this.state;const n=t.propsOrDataChanged||t.updateTriggersChanged,r=t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getTileData);i?n&&(i.setOptions(this._getTilesetOptions()),r?i.reloadAll():i.tiles.forEach(s=>{s.layers=null})):(i=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:i})),this._updateTileset()}_getTilesetOptions(){const{tileSize:t,maxCacheSize:i,maxCacheByteSize:n,refinementStrategy:r,extent:s,maxZoom:o,minZoom:l,maxRequests:h,debounceTime:A,zoomOffset:v}=this.props;return{maxCacheSize:i,maxCacheByteSize:n,maxZoom:o,minZoom:l,tileSize:t,refinementStrategy:r,extent:s,maxRequests:h,debounceTime:A,zoomOffset:v,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const t=this.state.tileset,{zRange:i,modelMatrix:n}=this.props,r=t.update(this.context.viewport,{zRange:i,modelMatrix:n}),{isLoaded:s}=t,o=this.state.isLoaded!==s,l=this.state.frameNumber!==r;s&&(o||l)&&this._onViewportLoad(),l&&this.setState({frameNumber:r}),this.state.isLoaded=s}_onViewportLoad(){const{tileset:t}=this.state,{onViewportLoad:i}=this.props;i&&i(t.selectedTiles)}_onTileLoad(t){this.props.onTileLoad(t),t.layers=null,this.setNeedsUpdate()}_onTileError(t,i){this.props.onTileError(t),i.layers=null,this.setNeedsUpdate()}_onTileUnload(t){this.props.onTileUnload(t)}getTileData(t){const{data:i,getTileData:n,fetch:r}=this.props,{signal:s}=t;return t.url=typeof i=="string"||Array.isArray(i)?vf(i,t):null,n?n(t):r&&t.url?r(t.url,{propName:"data",layer:this,signal:s}):null}renderSubLayers(t){return this.props.renderSubLayers(t)}getSubLayerPropsByTile(t){return null}getPickingInfo(t){const i=t.sourceLayer,n=i.props.tile,r=t.info;return r.picked&&(r.tile=n),r.sourceTile=n,r.sourceTileSubLayer=i,r}_updateAutoHighlight(t){t.sourceTileSubLayer.updateAutoHighlight(t)}renderLayers(){return this.state.tileset.tiles.map(t=>{const i=this.getSubLayerPropsByTile(t);if(!(!t.isLoaded&&!t.content))if(t.layers)i&&t.layers[0]&&Object.keys(i).some(n=>t.layers[0].props[n]!==i[n])&&(t.layers=t.layers.map(n=>n.clone(i)));else{const n=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:t.id,updateTriggers:this.props.updateTriggers}),data:t.content,_offset:0,tile:t});t.layers=G0(n,Boolean).map(r=>r.clone({tile:t,...i}))}return t.layers})}filterSubLayer({layer:t,cullRect:i}){const{tile:n}=t.props;return this.state.tileset.isTileVisible(n,i)}}au.defaultProps=nAt,au.layerName="TileLayer";const WL=`uniform tripsUniforms {
  bool fadeTrail;
  float trailLength;
  float currentTime;
} trips;
`,rAt={name:"trips",vs:WL,fs:WL,uniformTypes:{fadeTrail:"f32",trailLength:"f32",currentTime:"f32"}},oAt={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:e=>e.timestamps}};class c_ extends ch{getShaders(){const t=super.getShaders();return t.inject={"vs:#decl":`in float instanceTimestamps;
in float instanceNextTimestamps;
out float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`in float vTime;
`,"fs:#main-start":`if(vTime > trips.currentTime || (trips.fadeTrail && (vTime < trips.currentTime - trips.trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(trips.fadeTrail) {
  color.a *= 1.0 - (trips.currentTime - vTime) / trips.trailLength;
}
`},t.modules=[...t.modules,rAt],t}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(t){const{fadeTrail:i,trailLength:n,currentTime:r}=this.props,s={fadeTrail:i,trailLength:n,currentTime:r};this.state.model.shaderInputs.setProps({trips:s}),super.draw(t)}}c_.layerName="TripsLayer",c_.defaultProps=oAt;var Fi=function(e){e=e||{};var t=typeof e<"u"?e:{},i={},n;for(n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);var r="";function s(pt){return t.locateFile?t.locateFile(pt,r):r+pt}var o;typeof document<"u"&&document.currentScript&&(r=document.currentScript.src),r.indexOf("blob:")!==0?r=r.substr(0,r.lastIndexOf("/")+1):r="",o=function(pt,bt,lt){var Et=new XMLHttpRequest;Et.open("GET",pt,!0),Et.responseType="arraybuffer",Et.onload=function(){if(Et.status==200||Et.status==0&&Et.response){bt(Et.response);return}var g=De(pt);if(g){bt(g.buffer);return}lt()},Et.onerror=lt,Et.send(null)};var l=t.print||console.log.bind(console),h=t.printErr||console.warn.bind(console);for(n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);i=null,t.arguments&&t.arguments;var A=0,v=function(pt){A=pt},C=function(){return A},S=8;function L(pt,bt,lt,Et){switch(lt=lt||"i8",lt.charAt(lt.length-1)==="*"&&(lt="i32"),lt){case"i1":X[pt>>0]=bt;break;case"i8":X[pt>>0]=bt;break;case"i16":Mt[pt>>1]=bt;break;case"i32":pe[pt>>2]=bt;break;case"i64":tr=[bt>>>0,(Tn=bt,+_i(Tn)>=1?Tn>0?(vi(+Ai(Tn/4294967296),4294967295)|0)>>>0:~~+Fn((Tn-+(~~Tn>>>0))/4294967296)>>>0:0)],pe[pt>>2]=tr[0],pe[pt+4>>2]=tr[1];break;case"float":Ct[pt>>2]=bt;break;case"double":Dt[pt>>3]=bt;break;default:Ft("invalid type for setValue: "+lt)}}function N(pt,bt,lt){switch(bt=bt||"i8",bt.charAt(bt.length-1)==="*"&&(bt="i32"),bt){case"i1":return X[pt>>0];case"i8":return X[pt>>0];case"i16":return Mt[pt>>1];case"i32":return pe[pt>>2];case"i64":return pe[pt>>2];case"float":return Ct[pt>>2];case"double":return Dt[pt>>3];default:Ft("invalid type for getValue: "+bt)}return null}var G=!1;function W(pt,bt){pt||Ft("Assertion failed: "+bt)}function j(pt){var bt=t["_"+pt];return W(bt,"Cannot call unknown function "+pt+", make sure it is exported"),bt}function q(pt,bt,lt,Et,g){var ut={string:function(Me){var He=0;if(Me!=null&&Me!==0){var ki=(Me.length<<2)+1;He=ve(ki),Vt(Me,He,ki)}return He},array:function(Me){var He=ve(Me.length);return At(Me,He),He}};function Ee(Me){return bt==="string"?rt(Me):bt==="boolean"?!!Me:Me}var Zt=j(pt),Be=[],Re=0;if(Et)for(var Fe=0;Fe<Et.length;Fe++){var fe=ut[lt[Fe]];fe?(Re===0&&(Re=wt()),Be[Fe]=fe(Et[Fe])):Be[Fe]=Et[Fe]}var ke=Zt.apply(null,Be);return ke=Ee(ke),Re!==0&&Te(Re),ke}function Z(pt,bt,lt,Et){lt=lt||[];var g=lt.every(function(Ee){return Ee==="number"}),ut=bt!=="string";return ut&&g&&!Et?j(pt):function(){return q(pt,bt,lt,arguments)}}var K=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function ft(pt,bt,lt){for(var Et=bt+lt,g=bt;pt[g]&&!(g>=Et);)++g;if(g-bt>16&&pt.subarray&&K)return K.decode(pt.subarray(bt,g));for(var ut="";bt<g;){var Ee=pt[bt++];if(!(Ee&128)){ut+=String.fromCharCode(Ee);continue}var Zt=pt[bt++]&63;if((Ee&224)==192){ut+=String.fromCharCode((Ee&31)<<6|Zt);continue}var Be=pt[bt++]&63;if((Ee&240)==224?Ee=(Ee&15)<<12|Zt<<6|Be:Ee=(Ee&7)<<18|Zt<<12|Be<<6|pt[bt++]&63,Ee<65536)ut+=String.fromCharCode(Ee);else{var Re=Ee-65536;ut+=String.fromCharCode(55296|Re>>10,56320|Re&1023)}}return ut}function rt(pt,bt){return pt?ft(ht,pt,bt):""}function Lt(pt,bt,lt,Et){if(!(Et>0))return 0;for(var g=lt,ut=lt+Et-1,Ee=0;Ee<pt.length;++Ee){var Zt=pt.charCodeAt(Ee);if(Zt>=55296&&Zt<=57343){var Be=pt.charCodeAt(++Ee);Zt=65536+((Zt&1023)<<10)|Be&1023}if(Zt<=127){if(lt>=ut)break;bt[lt++]=Zt}else if(Zt<=2047){if(lt+1>=ut)break;bt[lt++]=192|Zt>>6,bt[lt++]=128|Zt&63}else if(Zt<=65535){if(lt+2>=ut)break;bt[lt++]=224|Zt>>12,bt[lt++]=128|Zt>>6&63,bt[lt++]=128|Zt&63}else{if(lt+3>=ut)break;bt[lt++]=240|Zt>>18,bt[lt++]=128|Zt>>12&63,bt[lt++]=128|Zt>>6&63,bt[lt++]=128|Zt&63}}return bt[lt]=0,lt-g}function Vt(pt,bt,lt){return Lt(pt,ht,bt,lt)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function At(pt,bt){X.set(pt,bt)}function at(pt,bt){return pt%bt>0&&(pt+=bt-pt%bt),pt}var kt,X,ht,Mt,pe,Ct,Dt;function Gt(pt){kt=pt,t.HEAP8=X=new Int8Array(pt),t.HEAP16=Mt=new Int16Array(pt),t.HEAP32=pe=new Int32Array(pt),t.HEAPU8=ht=new Uint8Array(pt),t.HEAPU16=new Uint16Array(pt),t.HEAPU32=new Uint32Array(pt),t.HEAPF32=Ct=new Float32Array(pt),t.HEAPF64=Dt=new Float64Array(pt)}var te=5267040,re=24128,ae=t.TOTAL_MEMORY||33554432;t.buffer?kt=t.buffer:kt=new ArrayBuffer(ae),ae=kt.byteLength,Gt(kt),pe[re>>2]=te;function he(pt){for(;pt.length>0;){var bt=pt.shift();if(typeof bt=="function"){bt();continue}var lt=bt.func;typeof lt=="number"?bt.arg===void 0?t.dynCall_v(lt):t.dynCall_vi(lt,bt.arg):lt(bt.arg===void 0?null:bt.arg)}}var Pe=[],Se=[],se=[],fi=[];function Ze(){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)sn(t.preRun.shift());he(Pe)}function Ye(){he(Se)}function ze(){he(se)}function pi(){if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)Ii(t.postRun.shift());he(fi)}function sn(pt){Pe.unshift(pt)}function Ii(pt){fi.unshift(pt)}var _i=Math.abs,Fn=Math.ceil,Ai=Math.floor,vi=Math.min,cn=0,Ri=null;function ur(pt){cn++,t.monitorRunDependencies&&t.monitorRunDependencies(cn)}function $n(pt){if(cn--,t.monitorRunDependencies&&t.monitorRunDependencies(cn),cn==0&&Ri){var bt=Ri;Ri=null,bt()}}t.preloadedImages={},t.preloadedAudios={};var gn=null,rr="data:application/octet-stream;base64,";function Wn(pt){return String.prototype.startsWith?pt.startsWith(rr):pt.indexOf(rr)===0}var Tn,tr;gn="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAOgehWlKfUEEz1zLi+JsiQa2og3wcMfVAWCbHorc0yEDi+Yn/Y6mbQJ11/mfsnG9At6bnG4UQQkBvMCQWKqUUQJVmwwswmOc/3hVgVBL3uj//qqOEOdGOPw/WDN4gnGE/H3ANkCUgND+AA8btKgAHPwTXBqJVSdo+XfRQAqsKrj4fc+zLYbSPQklEmCZHv2FCUP+uDso1NEKYtPhwphUHQptxnyFXYdpB7CddZAMmrkGAt1AxSTqBQUibBVdTsFNBSuX3MV+AJkFocv82SLf5QAqmgj7AY81A23VDSEnLoEDGEJVSeDFzQDYrqvBk70VA8U157pcRGUBWfEF+ZKbsP7KBdLHZTpFAqKYk69AqekDbeGY41MdjQD8AZzHK501A1vcrrjubNkD5LnquvBYhQCbiRRD71QlAqt72EbOH8z8Eu+jL1YbdP4uaox/xUcY/abedg1XfsD+BsUdzJ4KZP5wE9YFySIM/rW1kAKMpbT+rZFthVRhWPy4PKlXIs0A/qMZLlwDnMEHByqEF0I0ZQQYSFD8lUQNBPpY+dFs07UAH8BZImBPWQN9RY0I0sMBA2T7kLfc6qUByFYvfhBKTQMq+0Mis1XxA0XQbeQXMZUBJJ5aEGXpQQP7/SY0a6ThAaMD92b/UIkAs8s8yqXoMQNIegOvCk/U/aOi7NZJP4D8AAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAD/////AAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA/////wAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAP////8AAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////BQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAEAAQAAAQEAAAAAAAEAAAABAAAAAQABAAAAAAAAAAAAAAAAAAAAAAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAGFsZ29zLmMAaDNOZWlnaGJvclJvdGF0aW9ucwBjb29yZGlqay5jAF91cEFwN0NoZWNrZWQAX3VwQXA3ckNoZWNrZWQAZGlyZWN0ZWRFZGdlLmMAZGlyZWN0ZWRFZGdlVG9Cb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0NlbGxCb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbY2VudGVySUpLLmZhY2VdW2ZhY2UyXSA9PSBLSQBfZmFjZUlqa1RvQ2VsbEJvdW5kYXJ5AGgzSW5kZXguYwBjb21wYWN0Q2VsbHMAbGF0TG5nVG9DZWxsAGNlbGxUb0NoaWxkUG9zAHZhbGlkYXRlQ2hpbGRQb3MAbGF0TG5nLmMAY2VsbEFyZWFSYWRzMgBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGNlbGxUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvQ2VsbAAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMABncmlkUGF0aENlbGxzADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var je=24144;function mi(pt,bt,lt,Et){Ft("Assertion failed: "+rt(pt)+", at: "+[bt?rt(bt):"unknown filename",lt,Et?rt(Et):"unknown function"])}function Mi(){return X.length}function nn(pt,bt,lt){ht.set(ht.subarray(bt,bt+lt),pt)}function _r(pt){return t.___errno_location&&(pe[t.___errno_location()>>2]=pt),pt}function St(pt){Ft("OOM")}function Ne(pt){try{var bt=new ArrayBuffer(pt);return bt.byteLength!=pt?void 0:(new Int8Array(bt).set(X),H(bt),Gt(bt),1)}catch{}}function Xe(pt){var bt=Mi(),lt=16777216,Et=2147483648-lt;if(pt>Et)return!1;for(var g=16777216,ut=Math.max(bt,g);ut<pt;)ut<=536870912?ut=at(2*ut,lt):ut=Math.min(at((3*ut+2147483648)/4,lt),Et);var Ee=Ne(ut);return!!Ee}var ci=typeof atob=="function"?atob:function(pt){var bt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",lt="",Et,g,ut,Ee,Zt,Be,Re,Fe=0;pt=pt.replace(/[^A-Za-z0-9\+\/\=]/g,"");do Ee=bt.indexOf(pt.charAt(Fe++)),Zt=bt.indexOf(pt.charAt(Fe++)),Be=bt.indexOf(pt.charAt(Fe++)),Re=bt.indexOf(pt.charAt(Fe++)),Et=Ee<<2|Zt>>4,g=(Zt&15)<<4|Be>>2,ut=(Be&3)<<6|Re,lt=lt+String.fromCharCode(Et),Be!==64&&(lt=lt+String.fromCharCode(g)),Re!==64&&(lt=lt+String.fromCharCode(ut));while(Fe<pt.length);return lt};function qt(pt){try{for(var bt=ci(pt),lt=new Uint8Array(bt.length),Et=0;Et<bt.length;++Et)lt[Et]=bt.charCodeAt(Et);return lt}catch{throw new Error("Converting base64 string to bytes failed.")}}function De(pt){if(Wn(pt))return qt(pt.slice(rr.length))}var mt={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},Ve={b:v,c:C,d:mi,e:_r,f:Mi,g:nn,h:Xe,i:St,o:je,p:re},Ce=function(pt,bt,lt){"almost asm";var Et=new pt.Int8Array(lt),g=new pt.Int32Array(lt);new pt.Uint8Array(lt),new pt.Float32Array(lt);var ut=new pt.Float64Array(lt),Ee=bt.o|0,Zt=bt.p|0,Be=pt.Math.floor,Re=pt.Math.abs,Fe=pt.Math.sqrt,fe=pt.Math.pow,ke=pt.Math.cos,Me=pt.Math.sin,He=pt.Math.tan,ki=pt.Math.acos,ei=pt.Math.asin,$i=pt.Math.atan,ln=pt.Math.atan2,Wi=pt.Math.ceil,Ji=pt.Math.imul,Gi=pt.Math.min,vr=pt.Math.max,Xi=pt.Math.clz32,yi=bt.b,Bt=bt.c,Qe=bt.d,tn=bt.e,Wr=bt.f,xa=bt.g,hr=bt.h,Jn=bt.i,Tt=24160;function Ks(_){return Et=new Int8Array(_),g=new Int32Array(_),ut=new Float64Array(_),lt=_,!0}function Xn(_){_=_|0;var y=0;return y=Tt,Tt=Tt+_|0,Tt=Tt+15&-16,y|0}function Qs(){return Tt|0}function Lr(_){_=_|0,Tt=_}function fr(_,y){_=_|0,Tt=_}function Mr(_,y){_=_|0,y=y|0;var b=0,w=0,T=0;return(_|0)<0?(y=2,y|0):(_|0)>13780509?(y=ia(15,y)|0,y|0):(b=((_|0)<0)<<31>>31,T=pr(_|0,b|0,3,0)|0,w=Bt()|0,b=pn(_|0,b|0,1,0)|0,b=pr(T|0,w|0,b|0,Bt()|0)|0,b=pn(b|0,Bt()|0,1,0)|0,_=Bt()|0,g[y>>2]=b,g[y+4>>2]=_,y=0,y|0)}function Dn(_,y,b,w){return _=_|0,y=y|0,b=b|0,w=w|0,vo(_,y,b,w,0)|0}function vo(_,y,b,w,T){_=_|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0,f=0;if(d=Tt,Tt=Tt+16|0,O=d,!(Jr(_,y,b,w,T)|0))return w=0,Tt=d,w|0;do if((b|0)>=0){if((b|0)>13780509){if(M=ia(15,O)|0,M|0)break;c=O,O=g[c>>2]|0,c=g[c+4>>2]|0}else M=((b|0)<0)<<31>>31,f=pr(b|0,M|0,3,0)|0,c=Bt()|0,M=pn(b|0,M|0,1,0)|0,M=pr(f|0,c|0,M|0,Bt()|0)|0,M=pn(M|0,Bt()|0,1,0)|0,c=Bt()|0,g[O>>2]=M,g[O+4>>2]=c,O=M;if(aa(w|0,0,O<<3|0)|0,T|0){aa(T|0,0,O<<2|0)|0,M=Ho(_,y,b,w,T,O,c,0)|0;break}M=fs(O,4)|0,M?(f=Ho(_,y,b,w,M,O,c,0)|0,Ni(M),M=f):M=13}else M=2;while(!1);return f=M,Tt=d,f|0}function Jr(_,y,b,w,T){_=_|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,U=0;if(U=Tt,Tt=Tt+16|0,R=U,F=U+8|0,P=R,g[P>>2]=_,g[P+4>>2]=y,(b|0)<0)return F=2,Tt=U,F|0;if(M=w,g[M>>2]=_,g[M+4>>2]=y,M=(T|0)!=0,M&&(g[T>>2]=0),On(_,y)|0)return F=9,Tt=U,F|0;g[F>>2]=0;t:do if((b|0)>=1)if(M)for(m=1,f=0,E=0,P=1,M=_;;){if(!(f|E)){if(M=In(M,y,4,F,R)|0,M|0)break t;if(y=R,M=g[y>>2]|0,y=g[y+4>>2]|0,On(M,y)|0){M=9;break t}}if(M=In(M,y,g[22384+(E<<2)>>2]|0,F,R)|0,M|0)break t;if(y=R,M=g[y>>2]|0,y=g[y+4>>2]|0,_=w+(m<<3)|0,g[_>>2]=M,g[_+4>>2]=y,g[T+(m<<2)>>2]=P,_=f+1|0,O=(_|0)==(P|0),c=E+1|0,d=(c|0)==6,On(M,y)|0){M=9;break t}if(P=P+(d&O&1)|0,(P|0)>(b|0)){M=0;break}else m=m+1|0,f=O?0:_,E=O?d?0:c:E}else for(m=1,f=0,E=0,P=1,M=_;;){if(!(f|E)){if(M=In(M,y,4,F,R)|0,M|0)break t;if(y=R,M=g[y>>2]|0,y=g[y+4>>2]|0,On(M,y)|0){M=9;break t}}if(M=In(M,y,g[22384+(E<<2)>>2]|0,F,R)|0,M|0)break t;if(y=R,M=g[y>>2]|0,y=g[y+4>>2]|0,_=w+(m<<3)|0,g[_>>2]=M,g[_+4>>2]=y,_=f+1|0,O=(_|0)==(P|0),c=E+1|0,d=(c|0)==6,On(M,y)|0){M=9;break t}if(P=P+(d&O&1)|0,(P|0)>(b|0)){M=0;break}else m=m+1|0,f=O?0:_,E=O?d?0:c:E}else M=0;while(!1);return F=M,Tt=U,F|0}function Ho(_,y,b,w,T,M,O,c){_=_|0,y=y|0,b=b|0,w=w|0,T=T|0,M=M|0,O=O|0,c=c|0;var d=0,f=0,m=0,E=0,P=0,R=0,F=0,U=0,J=0,et=0;if(U=Tt,Tt=Tt+16|0,R=U+8|0,F=U,d=Ss(_|0,y|0,M|0,O|0)|0,m=Bt()|0,E=w+(d<<3)|0,J=E,et=g[J>>2]|0,J=g[J+4>>2]|0,f=(et|0)==(_|0)&(J|0)==(y|0),!((et|0)==0&(J|0)==0|f))do d=pn(d|0,m|0,1,0)|0,d=oo(d|0,Bt()|0,M|0,O|0)|0,m=Bt()|0,E=w+(d<<3)|0,et=E,J=g[et>>2]|0,et=g[et+4>>2]|0,f=(J|0)==(_|0)&(et|0)==(y|0);while(!((J|0)==0&(et|0)==0|f));if(d=T+(d<<2)|0,f&&(g[d>>2]|0)<=(c|0)||(et=E,g[et>>2]=_,g[et+4>>2]=y,g[d>>2]=c,(c|0)>=(b|0)))return et=0,Tt=U,et|0;switch(f=c+1|0,g[R>>2]=0,d=In(_,y,2,R,F)|0,d|0){case 9:{P=9;break}case 0:{d=F,d=Ho(g[d>>2]|0,g[d+4>>2]|0,b,w,T,M,O,f)|0,d||(P=9);break}}t:do if((P|0)==9){switch(g[R>>2]=0,d=In(_,y,3,R,F)|0,d|0){case 9:break;case 0:{if(d=F,d=Ho(g[d>>2]|0,g[d+4>>2]|0,b,w,T,M,O,f)|0,d|0)break t;break}default:break t}switch(g[R>>2]=0,d=In(_,y,1,R,F)|0,d|0){case 9:break;case 0:{if(d=F,d=Ho(g[d>>2]|0,g[d+4>>2]|0,b,w,T,M,O,f)|0,d|0)break t;break}default:break t}switch(g[R>>2]=0,d=In(_,y,5,R,F)|0,d|0){case 9:break;case 0:{if(d=F,d=Ho(g[d>>2]|0,g[d+4>>2]|0,b,w,T,M,O,f)|0,d|0)break t;break}default:break t}switch(g[R>>2]=0,d=In(_,y,4,R,F)|0,d|0){case 9:break;case 0:{if(d=F,d=Ho(g[d>>2]|0,g[d+4>>2]|0,b,w,T,M,O,f)|0,d|0)break t;break}default:break t}switch(g[R>>2]=0,d=In(_,y,6,R,F)|0,d|0){case 9:break;case 0:{if(d=F,d=Ho(g[d>>2]|0,g[d+4>>2]|0,b,w,T,M,O,f)|0,d|0)break t;break}default:break t}return et=0,Tt=U,et|0}while(!1);return et=d,Tt=U,et|0}function In(_,y,b,w,T){_=_|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0;if(b>>>0>6)return T=1,T|0;if(E=(g[w>>2]|0)%6|0,g[w>>2]=E,(E|0)>0){M=0;do b=Es(b)|0,M=M+1|0;while((M|0)<(g[w>>2]|0))}if(E=Ke(_|0,y|0,45)|0,Bt()|0,m=E&127,m>>>0>121)return T=5,T|0;d=io(_,y)|0,M=Ke(_|0,y|0,52)|0,Bt()|0,M=M&15;t:do if(!M)f=8;else{for(;;){if(O=(15-M|0)*3|0,c=Ke(_|0,y|0,O|0)|0,Bt()|0,c=c&7,(c|0)==7){y=5;break}if(F=(Jo(M)|0)==0,M=M+-1|0,P=ii(7,0,O|0)|0,y=y&~(Bt()|0),R=ii(g[(F?432:16)+(c*28|0)+(b<<2)>>2]|0,0,O|0)|0,O=Bt()|0,b=g[(F?640:224)+(c*28|0)+(b<<2)>>2]|0,_=R|_&~P,y=O|y,!b){b=0;break t}if(!M){f=8;break t}}return y|0}while(!1);(f|0)==8&&(F=g[848+(m*28|0)+(b<<2)>>2]|0,R=ii(F|0,0,45)|0,_=R|_,y=Bt()|0|y&-1040385,b=g[4272+(m*28|0)+(b<<2)>>2]|0,(F&127|0)==127&&(F=ii(g[848+(m*28|0)+20>>2]|0,0,45)|0,y=Bt()|0|y&-1040385,b=g[4272+(m*28|0)+20>>2]|0,_=Bs(F|_,y)|0,y=Bt()|0,g[w>>2]=(g[w>>2]|0)+1)),c=Ke(_|0,y|0,45)|0,Bt()|0,c=c&127;t:do if(Si(c)|0){e:do if((io(_,y)|0)==1){if((m|0)!=(c|0))if(bh(c,g[7696+(m*28|0)>>2]|0)|0){_=el(_,y)|0,O=1,y=Bt()|0;break}else Qe(23313,22416,436,22424);switch(d|0){case 3:{_=Bs(_,y)|0,y=Bt()|0,g[w>>2]=(g[w>>2]|0)+1,O=0;break e}case 5:{_=el(_,y)|0,y=Bt()|0,g[w>>2]=(g[w>>2]|0)+5,O=0;break e}case 0:return F=9,F|0;default:return F=1,F|0}}else O=0;while(!1);if((b|0)>0){M=0;do _=Pa(_,y)|0,y=Bt()|0,M=M+1|0;while((M|0)!=(b|0))}if((m|0)!=(c|0)){if(!(kn(c)|0)){if((O|0)!=0|(io(_,y)|0)!=5)break;g[w>>2]=(g[w>>2]|0)+1;break}switch(E&127){case 8:case 118:break t}(io(_,y)|0)!=3&&(g[w>>2]=(g[w>>2]|0)+1)}}else if((b|0)>0){M=0;do _=Bs(_,y)|0,y=Bt()|0,M=M+1|0;while((M|0)!=(b|0))}while(!1);return g[w>>2]=((g[w>>2]|0)+b|0)%6|0,F=T,g[F>>2]=_,g[F+4>>2]=y,F=0,F|0}function wc(_,y,b,w){_=_|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0;for(c=Tt,Tt=Tt+16|0,M=c,O=c+8|0,T=(On(_,y)|0)==0,T=T?1:2;;){if(g[O>>2]=0,f=(In(_,y,T,O,M)|0)==0,d=M,f&((g[d>>2]|0)==(b|0)?(g[d+4>>2]|0)==(w|0):0)){_=4;break}if(T=T+1|0,T>>>0>=7){T=7,_=4;break}}return(_|0)==4?(Tt=c,T|0):0}function gt(_,y,b,w){_=_|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0;if(F=Tt,Tt=Tt+16|0,P=F,R=F+8|0,E=P,g[E>>2]=_,g[E+4>>2]=y,!b)return R=w,g[R>>2]=_,g[R+4>>2]=y,R=0,Tt=F,R|0;g[R>>2]=0;t:do if(On(_,y)|0)_=9;else{if(M=(b|0)>0,M){T=0,E=_;do{if(_=In(E,y,4,R,P)|0,_|0)break t;if(y=P,E=g[y>>2]|0,y=g[y+4>>2]|0,T=T+1|0,On(E,y)|0){_=9;break t}}while((T|0)<(b|0));if(m=w,g[m>>2]=E,g[m+4>>2]=y,m=b+-1|0,M){f=0,_=1;do{if(T=22384+(f<<2)|0,(f|0)==5)for(O=g[T>>2]|0,M=0,T=_;;){if(_=P,_=In(g[_>>2]|0,g[_+4>>2]|0,O,R,P)|0,_|0)break t;if((M|0)!=(m|0))if(d=P,c=g[d>>2]|0,d=g[d+4>>2]|0,_=w+(T<<3)|0,g[_>>2]=c,g[_+4>>2]=d,!(On(c,d)|0))_=T+1|0;else{_=9;break t}else _=T;if(M=M+1|0,(M|0)>=(b|0))break;T=_}else for(O=P,d=g[T>>2]|0,c=0,T=_,M=g[O>>2]|0,O=g[O+4>>2]|0;;){if(_=In(M,O,d,R,P)|0,_|0)break t;if(O=P,M=g[O>>2]|0,O=g[O+4>>2]|0,_=w+(T<<3)|0,g[_>>2]=M,g[_+4>>2]=O,_=T+1|0,On(M,O)|0){_=9;break t}if(c=c+1|0,(c|0)>=(b|0))break;T=_}f=f+1|0}while(f>>>0<6);_=P,O=E,T=g[_>>2]|0,M=y,_=g[_+4>>2]|0}else O=E,T=E,M=y,_=y}else O=w,g[O>>2]=_,g[O+4>>2]=y,O=_,T=_,M=y,_=y;_=(O|0)==(T|0)&(M|0)==(_|0)?0:9}while(!1);return R=_,Tt=F,R|0}function Pt(_,y,b,w){_=_|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0;if(c=Tt,Tt=Tt+48|0,T=c+16|0,M=c+8|0,O=c,b|0)return O=15,Tt=c,O|0;if(f=_,d=g[f+4>>2]|0,b=M,g[b>>2]=g[f>>2],g[b+4>>2]=d,bo(M,T),y=Zs(T,y,O)|0,!y){if(b=g[M>>2]|0,M=g[_+8>>2]|0,(M|0)>0){T=g[_+12>>2]|0,y=0;do b=(g[T+(y<<3)>>2]|0)+b|0,y=y+1|0;while((y|0)<(M|0))}y=O,T=g[y>>2]|0,y=g[y+4>>2]|0,M=((b|0)<0)<<31>>31,(y|0)<(M|0)|(y|0)==(M|0)&T>>>0<b>>>0?(y=O,g[y>>2]=b,g[y+4>>2]=M,y=M):b=T,d=pn(b|0,y|0,12,0)|0,f=Bt()|0,y=O,g[y>>2]=d,g[y+4>>2]=f,y=w,g[y>>2]=d,g[y+4>>2]=f,y=0}return f=y,Tt=c,f|0}function Jt(_,y,b,w,T,M,O){_=_|0,y=y|0,b=b|0,w=w|0,T=T|0,M=M|0,O=O|0;var c=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,U=0,J=0,et=0,$=0,it=0,st=0,xt=0,Rt=0,yt=0,It=0,Ht=0,Xt=0,ee=0,Qt=0,$t=0,Ae=0,Le=0,we=0,Ge=0,si=0,Ci=0;if(Le=Tt,Tt=Tt+64|0,ee=Le+48|0,Qt=Le+32|0,$t=Le+24|0,xt=Le+8|0,Rt=Le,d=g[_>>2]|0,(d|0)<=0)return Ae=0,Tt=Le,Ae|0;for(yt=_+4|0,It=ee+8|0,Ht=Qt+8|0,Xt=xt+8|0,c=0,it=0;;){f=g[yt>>2]|0,$=f+(it<<4)|0,g[ee>>2]=g[$>>2],g[ee+4>>2]=g[$+4>>2],g[ee+8>>2]=g[$+8>>2],g[ee+12>>2]=g[$+12>>2],(it|0)==(d+-1|0)?(g[Qt>>2]=g[f>>2],g[Qt+4>>2]=g[f+4>>2],g[Qt+8>>2]=g[f+8>>2],g[Qt+12>>2]=g[f+12>>2]):($=f+(it+1<<4)|0,g[Qt>>2]=g[$>>2],g[Qt+4>>2]=g[$+4>>2],g[Qt+8>>2]=g[$+8>>2],g[Qt+12>>2]=g[$+12>>2]),d=Ca(ee,Qt,w,$t)|0;t:do if(d)f=0,c=d;else if(f=$t,d=g[f>>2]|0,f=g[f+4>>2]|0,(f|0)>0|(f|0)==0&d>>>0>0){et=0,$=0;e:for(;;){if(Ci=+ut[ee>>3],J=Ki(d|0,f|0,et|0,$|0)|0,si=+(J>>>0)+4294967296*+(Bt()|0),we=+(d>>>0)+4294967296*+(f|0),Ge=+(et>>>0)+4294967296*+($|0),ut[xt>>3]=Ci*si/we+ +ut[Qt>>3]*Ge/we,ut[Xt>>3]=+ut[It>>3]*si/we+ +ut[Ht>>3]*Ge/we,d=il(xt,w,Rt)|0,d|0){c=d;break}J=Rt,U=g[J>>2]|0,J=g[J+4>>2]|0,P=Ss(U|0,J|0,y|0,b|0)|0,m=Bt()|0,d=O+(P<<3)|0,E=d,f=g[E>>2]|0,E=g[E+4>>2]|0;i:do if((f|0)==0&(E|0)==0)st=d,Ae=16;else for(R=0,F=0;;){if((R|0)>(b|0)|(R|0)==(b|0)&F>>>0>y>>>0){c=1;break e}if((f|0)==(U|0)&(E|0)==(J|0))break i;if(d=pn(P|0,m|0,1,0)|0,P=oo(d|0,Bt()|0,y|0,b|0)|0,m=Bt()|0,F=pn(F|0,R|0,1,0)|0,R=Bt()|0,d=O+(P<<3)|0,E=d,f=g[E>>2]|0,E=g[E+4>>2]|0,(f|0)==0&(E|0)==0){st=d,Ae=16;break}}while(!1);if((Ae|0)==16&&(Ae=0,!((U|0)==0&(J|0)==0))&&(F=st,g[F>>2]=U,g[F+4>>2]=J,F=M+(g[T>>2]<<3)|0,g[F>>2]=U,g[F+4>>2]=J,F=T,F=pn(g[F>>2]|0,g[F+4>>2]|0,1,0)|0,U=Bt()|0,J=T,g[J>>2]=F,g[J+4>>2]=U),et=pn(et|0,$|0,1,0)|0,$=Bt()|0,f=$t,d=g[f>>2]|0,f=g[f+4>>2]|0,!((f|0)>($|0)|(f|0)==($|0)&d>>>0>et>>>0)){f=1;break t}}f=0}else f=1;while(!1);if(it=it+1|0,!f){Ae=21;break}if(d=g[_>>2]|0,(it|0)>=(d|0)){c=0,Ae=21;break}}return(Ae|0)==21?(Tt=Le,c|0):0}function xe(_,y,b,w){_=_|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,U=0,J=0,et=0,$=0,it=0,st=0,xt=0,Rt=0,yt=0,It=0,Ht=0,Xt=0,ee=0,Qt=0,$t=0,Ae=0,Le=0,we=0,Ge=0,si=0;if(si=Tt,Tt=Tt+112|0,Ae=si+80|0,d=si+72|0,Le=si,we=si+56|0,b|0)return Ge=15,Tt=si,Ge|0;if(f=_+8|0,Ge=Qn((g[f>>2]<<5)+32|0)|0,!Ge)return Ge=13,Tt=si,Ge|0;if(Ih(_,Ge),Qt=_,$t=g[Qt+4>>2]|0,b=d,g[b>>2]=g[Qt>>2],g[b+4>>2]=$t,bo(d,Ae),b=Zs(Ae,y,Le)|0,b)Qt=0,$t=0;else{if(b=g[d>>2]|0,M=g[f>>2]|0,(M|0)>0){O=g[_+12>>2]|0,T=0;do b=(g[O+(T<<3)>>2]|0)+b|0,T=T+1|0;while((T|0)!=(M|0));T=b}else T=b;b=Le,M=g[b>>2]|0,b=g[b+4>>2]|0,O=((T|0)<0)<<31>>31,(b|0)<(O|0)|(b|0)==(O|0)&M>>>0<T>>>0?(b=Le,g[b>>2]=T,g[b+4>>2]=O,b=O):T=M,Qt=pn(T|0,b|0,12,0)|0,$t=Bt()|0,b=Le,g[b>>2]=Qt,g[b+4>>2]=$t,b=0}if(b|0)return Ni(Ge),Ge=b,Tt=si,Ge|0;if(T=fs(Qt,8)|0,!T)return Ni(Ge),Ge=13,Tt=si,Ge|0;if(c=fs(Qt,8)|0,!c)return Ni(Ge),Ni(T),Ge=13,Tt=si,Ge|0;Xt=Ae,g[Xt>>2]=0,g[Xt+4>>2]=0,Xt=_,ee=g[Xt+4>>2]|0,b=d,g[b>>2]=g[Xt>>2],g[b+4>>2]=ee,b=Jt(d,Qt,$t,y,Ae,T,c)|0;t:do if(b)Ni(T),Ni(c),Ni(Ge);else{e:do if((g[f>>2]|0)>0){for(O=_+12|0,M=0;b=Jt((g[O>>2]|0)+(M<<3)|0,Qt,$t,y,Ae,T,c)|0,M=M+1|0,!(b|0);)if((M|0)>=(g[f>>2]|0))break e;Ni(T),Ni(c),Ni(Ge);break t}while(!1);($t|0)>0|($t|0)==0&Qt>>>0>0&&aa(c|0,0,Qt<<3|0)|0,ee=Ae,Xt=g[ee+4>>2]|0;e:do if((Xt|0)>0|(Xt|0)==0&(g[ee>>2]|0)>>>0>0){yt=T,It=c,Ht=T,Xt=c,ee=T,b=T,st=T,xt=c,Rt=c,T=c;i:for(;;){for(J=0,et=0,$=0,it=0,M=0,O=0;;){c=Le,d=c+56|0;do g[c>>2]=0,c=c+4|0;while((c|0)<(d|0));if(y=yt+(J<<3)|0,f=g[y>>2]|0,y=g[y+4>>2]|0,Jr(f,y,1,Le,0)|0){c=Le,d=c+56|0;do g[c>>2]=0,c=c+4|0;while((c|0)<(d|0));c=fs(7,4)|0,c|0&&(Ho(f,y,1,Le,c,7,0,0)|0,Ni(c))}for(U=0;;){F=Le+(U<<3)|0,R=g[F>>2]|0,F=g[F+4>>2]|0;n:do if((R|0)==0&(F|0)==0)c=M,d=O;else{if(m=Ss(R|0,F|0,Qt|0,$t|0)|0,f=Bt()|0,c=w+(m<<3)|0,y=c,d=g[y>>2]|0,y=g[y+4>>2]|0,!((d|0)==0&(y|0)==0)){E=0,P=0;do{if((E|0)>($t|0)|(E|0)==($t|0)&P>>>0>Qt>>>0)break i;if((d|0)==(R|0)&(y|0)==(F|0)){c=M,d=O;break n}c=pn(m|0,f|0,1,0)|0,m=oo(c|0,Bt()|0,Qt|0,$t|0)|0,f=Bt()|0,P=pn(P|0,E|0,1,0)|0,E=Bt()|0,c=w+(m<<3)|0,y=c,d=g[y>>2]|0,y=g[y+4>>2]|0}while(!((d|0)==0&(y|0)==0))}(R|0)==0&(F|0)==0?(c=M,d=O):(kl(R,F,we)|0,$e(_,Ge,we)|0&&(P=pn(M|0,O|0,1,0)|0,O=Bt()|0,E=c,g[E>>2]=R,g[E+4>>2]=F,M=It+(M<<3)|0,g[M>>2]=R,g[M+4>>2]=F,M=P),c=M,d=O)}while(!1);if(U=U+1|0,U>>>0>=7)break;M=c,O=d}if(J=pn(J|0,et|0,1,0)|0,et=Bt()|0,$=pn($|0,it|0,1,0)|0,it=Bt()|0,O=Ae,M=g[O>>2]|0,O=g[O+4>>2]|0,(it|0)<(O|0)|(it|0)==(O|0)&$>>>0<M>>>0)M=c,O=d;else break}if((O|0)>0|(O|0)==0&M>>>0>0){M=0,O=0;do it=yt+(M<<3)|0,g[it>>2]=0,g[it+4>>2]=0,M=pn(M|0,O|0,1,0)|0,O=Bt()|0,it=Ae,$=g[it+4>>2]|0;while((O|0)<($|0)|((O|0)==($|0)?M>>>0<(g[it>>2]|0)>>>0:0))}if(it=Ae,g[it>>2]=c,g[it+4>>2]=d,(d|0)>0|(d|0)==0&c>>>0>0)U=T,J=Rt,et=ee,$=xt,it=It,T=st,Rt=b,xt=Ht,st=U,b=J,ee=Xt,Xt=et,Ht=$,It=yt,yt=it;else break e}Ni(Ht),Ni(Xt),Ni(Ge),b=1;break t}else b=c;while(!1);Ni(Ge),Ni(T),Ni(b),b=0}while(!1);return Ge=b,Tt=si,Ge|0}function We(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0;if(m=Tt,Tt=Tt+176|0,d=m,(y|0)<1)return Ra(b,0,0),f=0,Tt=m,f|0;for(c=_,c=Ke(g[c>>2]|0,g[c+4>>2]|0,52)|0,Bt()|0,Ra(b,(y|0)>6?y:6,c&15),c=0;w=_+(c<<3)|0,w=Nl(g[w>>2]|0,g[w+4>>2]|0,d)|0,!(w|0);){if(w=g[d>>2]|0,(w|0)>0){O=0;do M=d+8+(O<<4)|0,O=O+1|0,w=d+8+(((O|0)%(w|0)|0)<<4)|0,T=xi(b,w,M)|0,T?ro(b,T)|0:Fc(b,M,w)|0,w=g[d>>2]|0;while((O|0)<(w|0))}if(c=c+1|0,(c|0)>=(y|0)){w=0,f=13;break}}return(f|0)==13?(Tt=m,w|0):(oa(b),f=w,Tt=m,f|0)}function zi(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0;if(M=Tt,Tt=Tt+32|0,w=M,T=M+16|0,_=We(_,y,T)|0,_|0)return b=_,Tt=M,b|0;if(g[b>>2]=0,g[b+4>>2]=0,g[b+8>>2]=0,_=hs(T)|0,_|0)do{y=fA(b)|0;do dA(y,_)|0,O=_+16|0,g[w>>2]=g[O>>2],g[w+4>>2]=g[O+4>>2],g[w+8>>2]=g[O+8>>2],g[w+12>>2]=g[O+12>>2],ro(T,_)|0,_=ui(T,w)|0;while((_|0)!=0);_=hs(T)|0}while((_|0)!=0);return oa(T),_=Lc(b)|0,_?(Vl(b),O=_,Tt=M,O|0):(O=0,Tt=M,O|0)}function Si(_){return _=_|0,_>>>0>121?(_=0,_|0):(_=g[7696+(_*28|0)+16>>2]|0,_|0)}function kn(_){return _=_|0,(_|0)==4|(_|0)==117|0}function Po(_){return _=_|0,g[11120+((g[_>>2]|0)*216|0)+((g[_+4>>2]|0)*72|0)+((g[_+8>>2]|0)*24|0)+(g[_+12>>2]<<3)>>2]|0}function ho(_){return _=_|0,g[11120+((g[_>>2]|0)*216|0)+((g[_+4>>2]|0)*72|0)+((g[_+8>>2]|0)*24|0)+(g[_+12>>2]<<3)+4>>2]|0}function os(_,y){_=_|0,y=y|0,_=7696+(_*28|0)|0,g[y>>2]=g[_>>2],g[y+4>>2]=g[_+4>>2],g[y+8>>2]=g[_+8>>2],g[y+12>>2]=g[_+12>>2]}function Of(_,y){_=_|0,y=y|0;var b=0,w=0;if(y>>>0>20)return y=-1,y|0;do if((g[11120+(y*216|0)>>2]|0)!=(_|0))if((g[11120+(y*216|0)+8>>2]|0)!=(_|0))if((g[11120+(y*216|0)+16>>2]|0)!=(_|0))if((g[11120+(y*216|0)+24>>2]|0)!=(_|0))if((g[11120+(y*216|0)+32>>2]|0)!=(_|0))if((g[11120+(y*216|0)+40>>2]|0)!=(_|0))if((g[11120+(y*216|0)+48>>2]|0)!=(_|0))if((g[11120+(y*216|0)+56>>2]|0)!=(_|0))if((g[11120+(y*216|0)+64>>2]|0)!=(_|0))if((g[11120+(y*216|0)+72>>2]|0)!=(_|0))if((g[11120+(y*216|0)+80>>2]|0)!=(_|0))if((g[11120+(y*216|0)+88>>2]|0)!=(_|0))if((g[11120+(y*216|0)+96>>2]|0)!=(_|0))if((g[11120+(y*216|0)+104>>2]|0)!=(_|0))if((g[11120+(y*216|0)+112>>2]|0)!=(_|0))if((g[11120+(y*216|0)+120>>2]|0)!=(_|0))if((g[11120+(y*216|0)+128>>2]|0)!=(_|0))if((g[11120+(y*216|0)+136>>2]|0)==(_|0))_=2,b=1,w=2;else{if((g[11120+(y*216|0)+144>>2]|0)==(_|0)){_=0,b=2,w=0;break}if((g[11120+(y*216|0)+152>>2]|0)==(_|0)){_=0,b=2,w=1;break}if((g[11120+(y*216|0)+160>>2]|0)==(_|0)){_=0,b=2,w=2;break}if((g[11120+(y*216|0)+168>>2]|0)==(_|0)){_=1,b=2,w=0;break}if((g[11120+(y*216|0)+176>>2]|0)==(_|0)){_=1,b=2,w=1;break}if((g[11120+(y*216|0)+184>>2]|0)==(_|0)){_=1,b=2,w=2;break}if((g[11120+(y*216|0)+192>>2]|0)==(_|0)){_=2,b=2,w=0;break}if((g[11120+(y*216|0)+200>>2]|0)==(_|0)){_=2,b=2,w=1;break}if((g[11120+(y*216|0)+208>>2]|0)==(_|0)){_=2,b=2,w=2;break}else _=-1;return _|0}else _=2,b=1,w=1;else _=2,b=1,w=0;else _=1,b=1,w=2;else _=1,b=1,w=1;else _=1,b=1,w=0;else _=0,b=1,w=2;else _=0,b=1,w=1;else _=0,b=1,w=0;else _=2,b=0,w=2;else _=2,b=0,w=1;else _=2,b=0,w=0;else _=1,b=0,w=2;else _=1,b=0,w=1;else _=1,b=0,w=0;else _=0,b=0,w=2;else _=0,b=0,w=1;else _=0,b=0,w=0;while(!1);return y=g[11120+(y*216|0)+(b*72|0)+(_*24|0)+(w<<3)+4>>2]|0,y|0}function bh(_,y){return _=_|0,y=y|0,(g[7696+(_*28|0)+20>>2]|0)==(y|0)?(y=1,y|0):(y=(g[7696+(_*28|0)+24>>2]|0)==(y|0),y|0)}function wa(_,y){return _=_|0,y=y|0,g[848+(_*28|0)+(y<<2)>>2]|0}function Cc(_,y){return _=_|0,y=y|0,(g[848+(_*28|0)>>2]|0)==(y|0)?(y=0,y|0):(g[848+(_*28|0)+4>>2]|0)==(y|0)?(y=1,y|0):(g[848+(_*28|0)+8>>2]|0)==(y|0)?(y=2,y|0):(g[848+(_*28|0)+12>>2]|0)==(y|0)?(y=3,y|0):(g[848+(_*28|0)+16>>2]|0)==(y|0)?(y=4,y|0):(g[848+(_*28|0)+20>>2]|0)==(y|0)?(y=5,y|0):((g[848+(_*28|0)+24>>2]|0)==(y|0)?6:7)|0}function Ec(){return 122}function Lf(_){_=_|0;var y=0,b=0,w=0;y=0;do ii(y|0,0,45)|0,w=Bt()|0|134225919,b=_+(y<<3)|0,g[b>>2]=-1,g[b+4>>2]=w,y=y+1|0;while((y|0)!=122);return 0}function Bc(_){return _=_|0,+ut[_+16>>3]<+ut[_+24>>3]|0}function Wo(_,y){_=_|0,y=y|0;var b=0,w=0,T=0;return b=+ut[y>>3],!(b>=+ut[_+8>>3])||!(b<=+ut[_>>3])?(y=0,y|0):(w=+ut[_+16>>3],b=+ut[_+24>>3],T=+ut[y+8>>3],y=T>=b,_=T<=w&1,w<b?y&&(_=1):y||(_=0),y=(_|0)!=0,y|0)}function Zs(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,U=0,J=0;F=Tt,Tt=Tt+288|0,m=F+264|0,E=F+96|0,f=F,c=f,d=c+96|0;do g[c>>2]=0,c=c+4|0;while((c|0)<(d|0));return y=Mc(y,f)|0,y|0?(R=y,Tt=F,R|0):(d=f,f=g[d>>2]|0,d=g[d+4>>2]|0,kl(f,d,m)|0,Nl(f,d,E)|0,O=+sl(m,E+8|0),ut[m>>3]=+ut[_>>3],d=m+8|0,ut[d>>3]=+ut[_+16>>3],ut[E>>3]=+ut[_+8>>3],f=E+8|0,ut[f>>3]=+ut[_+24>>3],T=+sl(m,E),J=+ut[d>>3]-+ut[f>>3],M=+Re(+J),U=+ut[m>>3]-+ut[E>>3],w=+Re(+U),!(J==0|U==0)&&(J=+Wl(+M,+w),J=+Wi(+(T*T/+kc(+(J/+kc(+M,+w)),3)/(O*(O*2.59807621135)*.8))),ut[Ee>>3]=J,P=~~J>>>0,R=+Re(J)>=1?J>0?~~+Gi(+Be(J/4294967296),4294967295)>>>0:~~+Wi((J-+(~~J>>>0))/4294967296)>>>0:0,(g[Ee+4>>2]&2146435072|0)!=2146435072)?(E=(P|0)==0&(R|0)==0,y=b,g[y>>2]=E?1:P,g[y+4>>2]=E?0:R,y=0):y=1,R=y,Tt=F,R|0)}function Ca(_,y,b,w){_=_|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0,m=0;f=Tt,Tt=Tt+288|0,O=f+264|0,c=f+96|0,d=f,T=d,M=T+96|0;do g[T>>2]=0,T=T+4|0;while((T|0)<(M|0));return b=Mc(b,d)|0,b|0?(w=b,Tt=f,w|0):(b=d,T=g[b>>2]|0,b=g[b+4>>2]|0,kl(T,b,O)|0,Nl(T,b,c)|0,m=+sl(O,c+8|0),m=+Wi(+(+sl(_,y)/(m*2))),ut[Ee>>3]=m,b=~~m>>>0,T=+Re(m)>=1?m>0?~~+Gi(+Be(m/4294967296),4294967295)>>>0:~~+Wi((m-+(~~m>>>0))/4294967296)>>>0:0,(g[Ee+4>>2]&2146435072|0)==2146435072?(w=1,Tt=f,w|0):(d=(b|0)==0&(T|0)==0,g[w>>2]=d?1:b,g[w+4>>2]=d?0:T,w=0,Tt=f,w|0))}function Qa(_,y,b,w){_=_|0,y=y|0,b=b|0,w=w|0,g[_>>2]=y,g[_+4>>2]=b,g[_+8>>2]=w}function Ea(_,y){_=_|0,y=y|0;var b=0,w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0;E=y+8|0,g[E>>2]=0,d=+ut[_>>3],O=+Re(+d),f=+ut[_+8>>3],c=+Re(+f)/.8660254037844386,O=O+c*.5,b=~~O,_=~~c,O=O-+(b|0),c=c-+(_|0);do if(O<.5)if(O<.3333333333333333)if(g[y>>2]=b,c<(O+1)*.5){g[y+4>>2]=_;break}else{_=_+1|0,g[y+4>>2]=_;break}else if(P=1-O,_=(!(c<P)&1)+_|0,g[y+4>>2]=_,P<=c&c<O*2){b=b+1|0,g[y>>2]=b;break}else{g[y>>2]=b;break}else{if(!(O<.6666666666666666))if(b=b+1|0,g[y>>2]=b,c<O*.5){g[y+4>>2]=_;break}else{_=_+1|0,g[y+4>>2]=_;break}if(c<1-O){if(g[y+4>>2]=_,O*2+-1<c){g[y>>2]=b;break}}else _=_+1|0,g[y+4>>2]=_;b=b+1|0,g[y>>2]=b}while(!1);do if(d<0)if(_&1){m=(_+1|0)/2|0,m=Ki(b|0,((b|0)<0)<<31>>31|0,m|0,((m|0)<0)<<31>>31|0)|0,b=~~(+(b|0)-((+(m>>>0)+4294967296*+(Bt()|0))*2+1)),g[y>>2]=b;break}else{m=(_|0)/2|0,m=Ki(b|0,((b|0)<0)<<31>>31|0,m|0,((m|0)<0)<<31>>31|0)|0,b=~~(+(b|0)-(+(m>>>0)+4294967296*+(Bt()|0))*2),g[y>>2]=b;break}while(!1);m=y+4|0,f<0&&(b=b-((_<<1|1|0)/2|0)|0,g[y>>2]=b,_=0-_|0,g[m>>2]=_),w=_-b|0,(b|0)<0?(T=0-b|0,g[m>>2]=w,g[E>>2]=T,g[y>>2]=0,_=w,b=0):T=0,(_|0)<0&&(b=b-_|0,g[y>>2]=b,T=T-_|0,g[E>>2]=T,g[m>>2]=0,_=0),M=b-T|0,w=_-T|0,(T|0)<0&&(g[y>>2]=M,g[m>>2]=w,g[E>>2]=0,_=w,b=M,T=0),w=(_|0)<(b|0)?_:b,w=(T|0)<(w|0)?T:w,!((w|0)<=0)&&(g[y>>2]=b-w,g[m>>2]=_-w,g[E>>2]=T-w)}function br(_){_=_|0;var y=0,b=0,w=0,T=0,M=0,O=0;y=g[_>>2]|0,O=_+4|0,b=g[O>>2]|0,(y|0)<0&&(b=b-y|0,g[O>>2]=b,M=_+8|0,g[M>>2]=(g[M>>2]|0)-y,g[_>>2]=0,y=0),(b|0)<0?(y=y-b|0,g[_>>2]=y,M=_+8|0,T=(g[M>>2]|0)-b|0,g[M>>2]=T,g[O>>2]=0,b=0):(T=_+8|0,M=T,T=g[T>>2]|0),(T|0)<0&&(y=y-T|0,g[_>>2]=y,b=b-T|0,g[O>>2]=b,g[M>>2]=0,T=0),w=(b|0)<(y|0)?b:y,w=(T|0)<(w|0)?T:w,!((w|0)<=0)&&(g[_>>2]=y-w,g[O>>2]=b-w,g[M>>2]=T-w)}function Ls(_,y){_=_|0,y=y|0;var b=0,w=0;w=g[_+8>>2]|0,b=+((g[_+4>>2]|0)-w|0),ut[y>>3]=+((g[_>>2]|0)-w|0)-b*.5,ut[y+8>>3]=b*.8660254037844386}function jn(_,y,b){_=_|0,y=y|0,b=b|0,g[b>>2]=(g[y>>2]|0)+(g[_>>2]|0),g[b+4>>2]=(g[y+4>>2]|0)+(g[_+4>>2]|0),g[b+8>>2]=(g[y+8>>2]|0)+(g[_+8>>2]|0)}function dr(_,y,b){_=_|0,y=y|0,b=b|0,g[b>>2]=(g[_>>2]|0)-(g[y>>2]|0),g[b+4>>2]=(g[_+4>>2]|0)-(g[y+4>>2]|0),g[b+8>>2]=(g[_+8>>2]|0)-(g[y+8>>2]|0)}function Za(_,y){_=_|0,y=y|0;var b=0,w=0;b=Ji(g[_>>2]|0,y)|0,g[_>>2]=b,b=_+4|0,w=Ji(g[b>>2]|0,y)|0,g[b>>2]=w,_=_+8|0,y=Ji(g[_>>2]|0,y)|0,g[_>>2]=y}function Tc(_){_=_|0;var y=0,b=0,w=0,T=0,M=0,O=0,c=0;O=g[_>>2]|0,c=(O|0)<0,w=(g[_+4>>2]|0)-(c?O:0)|0,M=(w|0)<0,T=(M?0-w|0:0)+((g[_+8>>2]|0)-(c?O:0))|0,b=(T|0)<0,_=b?0:T,y=(M?0:w)-(b?T:0)|0,T=(c?0:O)-(M?w:0)-(b?T:0)|0,b=(y|0)<(T|0)?y:T,b=(_|0)<(b|0)?_:b,w=(b|0)>0,_=_-(w?b:0)|0,y=y-(w?b:0)|0;t:do switch(T-(w?b:0)|0){case 0:switch(y|0){case 0:return c=(_|0)==0?0:(_|0)==1?1:7,c|0;case 1:return c=(_|0)==0?2:(_|0)==1?3:7,c|0;default:break t}case 1:switch(y|0){case 0:return c=(_|0)==0?4:(_|0)==1?5:7,c|0;case 1:{if(!_)_=6;else break t;return _|0}default:break t}}while(!1);return c=7,c|0}function aA(_){_=_|0;var y=0,b=0,w=0,T=0,M=0,O=0,c=0;O=_+8|0,T=g[O>>2]|0,M=(g[_>>2]|0)-T|0,c=_+4|0,T=(g[c>>2]|0)-T|0;do if(M>>>0>715827881|T>>>0>715827881){if(b=(M|0)>0,b){if((2147483647-M|0)<(M|0)||(2147483647-(M<<1)|0)<(M|0))return c=1,c|0}else if((-2147483648-M|0)>(M|0)||(-2147483648-(M<<1)|0)>(M|0))return c=1,c|0;if(y=M*3|0,(T|0)>0){if((2147483647-T|0)<(T|0))return c=1,c|0}else if((-2147483648-T|0)>(T|0))return c=1,c|0;if(w=T<<1,(M|0)>-1){if((y|-2147483648|0)>=(T|0))return c=1,c|0}else if((y^-2147483648|0)<(T|0))return c=1,c|0;if(b){if((2147483647-M|0)<(w|0))y=1;else{b=w;break}return y|0}else{if((-2147483648-M|0)>(w|0))y=1;else{b=w;break}return y|0}}else b=T<<1,y=M*3|0;while(!1);w=Kr(+(y-T|0)/7)|0,g[_>>2]=w,T=Kr(+(b+M|0)/7)|0,g[c>>2]=T,g[O>>2]=0,b=(T|0)<(w|0),y=b?w:T,b=b?T:w;do if((b|0)<0){if((y|0)>0){if((y|-2147483648|0)<(b|0)&((b|0)!=-2147483648&(2147483647-y|0)>=(b|0)))break;Qe(23313,22444,355,22455)}if((b|0)==-2147483648|(-2147483648-y|0)>(b|0)&&Qe(23313,22444,355,22455),(y|0)>-1){if((y|-2147483648|0)<(b|0))break;Qe(23313,22444,355,22455)}else{if((y^-2147483648|0)>=(b|0))break;Qe(23313,22444,355,22455)}}while(!1);return y=T-w|0,(w|0)<0?(b=0-w|0,g[c>>2]=y,g[O>>2]=b,g[_>>2]=0,w=0):(y=T,b=0),(y|0)<0&&(w=w-y|0,g[_>>2]=w,b=b-y|0,g[O>>2]=b,g[c>>2]=0,y=0),M=w-b|0,T=y-b|0,(b|0)<0?(g[_>>2]=M,g[c>>2]=T,g[O>>2]=0,y=T,T=M,b=0):T=w,w=(y|0)<(T|0)?y:T,w=(b|0)<(w|0)?b:w,(w|0)<=0?(c=0,c|0):(g[_>>2]=T-w,g[c>>2]=y-w,g[O>>2]=b-w,c=0,c|0)}function lA(_){_=_|0;var y=0,b=0,w=0,T=0,M=0,O=0,c=0;O=_+8|0,T=g[O>>2]|0,M=(g[_>>2]|0)-T|0,c=_+4|0,T=(g[c>>2]|0)-T|0;do if(M>>>0>715827881|T>>>0>715827881){if(b=(M|0)>0,b){if((2147483647-M|0)<(M|0))return c=1,c|0}else if((-2147483648-M|0)>(M|0))return c=1,c|0;if(y=M<<1,(T|0)>0){if((2147483647-T|0)<(T|0)||(2147483647-(T<<1)|0)<(T|0))return c=1,c|0}else if((-2147483648-T|0)>(T|0)||(-2147483648-(T<<1)|0)>(T|0))return c=1,c|0;if(w=T*3|0,b){if((2147483647-y|0)<(T|0))return c=1,c|0}else if((-2147483648-y|0)>(T|0))return c=1,c|0;if((T|0)>-1){if((w|-2147483648|0)<(M|0)){b=w;break}else y=1;return y|0}else{if((w^-2147483648|0)<(M|0))y=1;else{b=w;break}return y|0}}else b=T*3|0,y=M<<1;while(!1);w=Kr(+(y+T|0)/7)|0,g[_>>2]=w,T=Kr(+(b-M|0)/7)|0,g[c>>2]=T,g[O>>2]=0,b=(T|0)<(w|0),y=b?w:T,b=b?T:w;do if((b|0)<0){if((y|0)>0){if((y|-2147483648|0)<(b|0)&((b|0)!=-2147483648&(2147483647-y|0)>=(b|0)))break;Qe(23313,22444,404,22469)}if((b|0)==-2147483648|(-2147483648-y|0)>(b|0)&&Qe(23313,22444,404,22469),(y|0)>-1){if((y|-2147483648|0)<(b|0))break;Qe(23313,22444,404,22469)}else{if((y^-2147483648|0)>=(b|0))break;Qe(23313,22444,404,22469)}}while(!1);return y=T-w|0,(w|0)<0?(b=0-w|0,g[c>>2]=y,g[O>>2]=b,g[_>>2]=0,w=0):(y=T,b=0),(y|0)<0&&(w=w-y|0,g[_>>2]=w,b=b-y|0,g[O>>2]=b,g[c>>2]=0,y=0),M=w-b|0,T=y-b|0,(b|0)<0?(g[_>>2]=M,g[c>>2]=T,g[O>>2]=0,y=T,T=M,b=0):T=w,w=(y|0)<(T|0)?y:T,w=(b|0)<(w|0)?b:w,(w|0)<=0?(c=0,c|0):(g[_>>2]=T-w,g[c>>2]=y-w,g[O>>2]=b-w,c=0,c|0)}function xh(_){_=_|0;var y=0,b=0,w=0,T=0,M=0,O=0,c=0;O=_+8|0,b=g[O>>2]|0,y=(g[_>>2]|0)-b|0,c=_+4|0,b=(g[c>>2]|0)-b|0,w=Kr(+((y*3|0)-b|0)/7)|0,g[_>>2]=w,y=Kr(+((b<<1)+y|0)/7)|0,g[c>>2]=y,g[O>>2]=0,b=y-w|0,(w|0)<0?(M=0-w|0,g[c>>2]=b,g[O>>2]=M,g[_>>2]=0,y=b,w=0,b=M):b=0,(y|0)<0&&(w=w-y|0,g[_>>2]=w,b=b-y|0,g[O>>2]=b,g[c>>2]=0,y=0),M=w-b|0,T=y-b|0,(b|0)<0?(g[_>>2]=M,g[c>>2]=T,g[O>>2]=0,y=T,T=M,b=0):T=w,w=(y|0)<(T|0)?y:T,w=(b|0)<(w|0)?b:w,!((w|0)<=0)&&(g[_>>2]=T-w,g[c>>2]=y-w,g[O>>2]=b-w)}function fu(_){_=_|0;var y=0,b=0,w=0,T=0,M=0,O=0,c=0;O=_+8|0,b=g[O>>2]|0,y=(g[_>>2]|0)-b|0,c=_+4|0,b=(g[c>>2]|0)-b|0,w=Kr(+((y<<1)+b|0)/7)|0,g[_>>2]=w,y=Kr(+((b*3|0)-y|0)/7)|0,g[c>>2]=y,g[O>>2]=0,b=y-w|0,(w|0)<0?(M=0-w|0,g[c>>2]=b,g[O>>2]=M,g[_>>2]=0,y=b,w=0,b=M):b=0,(y|0)<0&&(w=w-y|0,g[_>>2]=w,b=b-y|0,g[O>>2]=b,g[c>>2]=0,y=0),M=w-b|0,T=y-b|0,(b|0)<0?(g[_>>2]=M,g[c>>2]=T,g[O>>2]=0,y=T,T=M,b=0):T=w,w=(y|0)<(T|0)?y:T,w=(b|0)<(w|0)?b:w,!((w|0)<=0)&&(g[_>>2]=T-w,g[c>>2]=y-w,g[O>>2]=b-w)}function Dl(_){_=_|0;var y=0,b=0,w=0,T=0,M=0,O=0,c=0;y=g[_>>2]|0,O=_+4|0,b=g[O>>2]|0,c=_+8|0,w=g[c>>2]|0,T=b+(y*3|0)|0,g[_>>2]=T,b=w+(b*3|0)|0,g[O>>2]=b,y=(w*3|0)+y|0,g[c>>2]=y,w=b-T|0,(T|0)<0?(y=y-T|0,g[O>>2]=w,g[c>>2]=y,g[_>>2]=0,b=w,w=0):w=T,(b|0)<0&&(w=w-b|0,g[_>>2]=w,y=y-b|0,g[c>>2]=y,g[O>>2]=0,b=0),M=w-y|0,T=b-y|0,(y|0)<0?(g[_>>2]=M,g[O>>2]=T,g[c>>2]=0,w=M,y=0):T=b,b=(T|0)<(w|0)?T:w,b=(y|0)<(b|0)?y:b,!((b|0)<=0)&&(g[_>>2]=w-b,g[O>>2]=T-b,g[c>>2]=y-b)}function Ys(_){_=_|0;var y=0,b=0,w=0,T=0,M=0,O=0,c=0;T=g[_>>2]|0,O=_+4|0,y=g[O>>2]|0,c=_+8|0,b=g[c>>2]|0,w=(y*3|0)+T|0,T=b+(T*3|0)|0,g[_>>2]=T,g[O>>2]=w,y=(b*3|0)+y|0,g[c>>2]=y,b=w-T|0,(T|0)<0?(y=y-T|0,g[O>>2]=b,g[c>>2]=y,g[_>>2]=0,T=0):b=w,(b|0)<0&&(T=T-b|0,g[_>>2]=T,y=y-b|0,g[c>>2]=y,g[O>>2]=0,b=0),M=T-y|0,w=b-y|0,(y|0)<0?(g[_>>2]=M,g[O>>2]=w,g[c>>2]=0,T=M,y=0):w=b,b=(w|0)<(T|0)?w:T,b=(y|0)<(b|0)?y:b,!((b|0)<=0)&&(g[_>>2]=T-b,g[O>>2]=w-b,g[c>>2]=y-b)}function wh(_,y){_=_|0,y=y|0;var b=0,w=0,T=0,M=0,O=0,c=0;(y+-1|0)>>>0>=6||(T=(g[15440+(y*12|0)>>2]|0)+(g[_>>2]|0)|0,g[_>>2]=T,c=_+4|0,w=(g[15440+(y*12|0)+4>>2]|0)+(g[c>>2]|0)|0,g[c>>2]=w,O=_+8|0,y=(g[15440+(y*12|0)+8>>2]|0)+(g[O>>2]|0)|0,g[O>>2]=y,b=w-T|0,(T|0)<0?(y=y-T|0,g[c>>2]=b,g[O>>2]=y,g[_>>2]=0,w=0):(b=w,w=T),(b|0)<0&&(w=w-b|0,g[_>>2]=w,y=y-b|0,g[O>>2]=y,g[c>>2]=0,b=0),M=w-y|0,T=b-y|0,(y|0)<0?(g[_>>2]=M,g[c>>2]=T,g[O>>2]=0,w=M,y=0):T=b,b=(T|0)<(w|0)?T:w,b=(y|0)<(b|0)?y:b,!((b|0)<=0)&&(g[_>>2]=w-b,g[c>>2]=T-b,g[O>>2]=y-b))}function Ch(_){_=_|0;var y=0,b=0,w=0,T=0,M=0,O=0,c=0;T=g[_>>2]|0,O=_+4|0,y=g[O>>2]|0,c=_+8|0,b=g[c>>2]|0,w=y+T|0,T=b+T|0,g[_>>2]=T,g[O>>2]=w,y=b+y|0,g[c>>2]=y,b=w-T|0,(T|0)<0?(y=y-T|0,g[O>>2]=b,g[c>>2]=y,g[_>>2]=0,w=0):(b=w,w=T),(b|0)<0&&(w=w-b|0,g[_>>2]=w,y=y-b|0,g[c>>2]=y,g[O>>2]=0,b=0),M=w-y|0,T=b-y|0,(y|0)<0?(g[_>>2]=M,g[O>>2]=T,g[c>>2]=0,w=M,y=0):T=b,b=(T|0)<(w|0)?T:w,b=(y|0)<(b|0)?y:b,!((b|0)<=0)&&(g[_>>2]=w-b,g[O>>2]=T-b,g[c>>2]=y-b)}function du(_){_=_|0;var y=0,b=0,w=0,T=0,M=0,O=0,c=0;y=g[_>>2]|0,O=_+4|0,w=g[O>>2]|0,c=_+8|0,b=g[c>>2]|0,T=w+y|0,g[_>>2]=T,w=b+w|0,g[O>>2]=w,y=b+y|0,g[c>>2]=y,b=w-T|0,(T|0)<0?(y=y-T|0,g[O>>2]=b,g[c>>2]=y,g[_>>2]=0,w=0):(b=w,w=T),(b|0)<0&&(w=w-b|0,g[_>>2]=w,y=y-b|0,g[c>>2]=y,g[O>>2]=0,b=0),M=w-y|0,T=b-y|0,(y|0)<0?(g[_>>2]=M,g[O>>2]=T,g[c>>2]=0,w=M,y=0):T=b,b=(T|0)<(w|0)?T:w,b=(y|0)<(b|0)?y:b,!((b|0)<=0)&&(g[_>>2]=w-b,g[O>>2]=T-b,g[c>>2]=y-b)}function Es(_){switch(_=_|0,_|0){case 1:{_=5;break}case 5:{_=4;break}case 4:{_=6;break}case 6:{_=2;break}case 2:{_=3;break}case 3:{_=1;break}}return _|0}function ss(_){switch(_=_|0,_|0){case 1:{_=3;break}case 3:{_=2;break}case 2:{_=6;break}case 6:{_=4;break}case 4:{_=5;break}case 5:{_=1;break}}return _|0}function Eh(_){_=_|0;var y=0,b=0,w=0,T=0,M=0,O=0,c=0;y=g[_>>2]|0,O=_+4|0,b=g[O>>2]|0,c=_+8|0,w=g[c>>2]|0,T=b+(y<<1)|0,g[_>>2]=T,b=w+(b<<1)|0,g[O>>2]=b,y=(w<<1)+y|0,g[c>>2]=y,w=b-T|0,(T|0)<0?(y=y-T|0,g[O>>2]=w,g[c>>2]=y,g[_>>2]=0,b=w,w=0):w=T,(b|0)<0&&(w=w-b|0,g[_>>2]=w,y=y-b|0,g[c>>2]=y,g[O>>2]=0,b=0),M=w-y|0,T=b-y|0,(y|0)<0?(g[_>>2]=M,g[O>>2]=T,g[c>>2]=0,w=M,y=0):T=b,b=(T|0)<(w|0)?T:w,b=(y|0)<(b|0)?y:b,!((b|0)<=0)&&(g[_>>2]=w-b,g[O>>2]=T-b,g[c>>2]=y-b)}function Ur(_){_=_|0;var y=0,b=0,w=0,T=0,M=0,O=0,c=0;T=g[_>>2]|0,O=_+4|0,y=g[O>>2]|0,c=_+8|0,b=g[c>>2]|0,w=(y<<1)+T|0,T=b+(T<<1)|0,g[_>>2]=T,g[O>>2]=w,y=(b<<1)+y|0,g[c>>2]=y,b=w-T|0,(T|0)<0?(y=y-T|0,g[O>>2]=b,g[c>>2]=y,g[_>>2]=0,T=0):b=w,(b|0)<0&&(T=T-b|0,g[_>>2]=T,y=y-b|0,g[c>>2]=y,g[O>>2]=0,b=0),M=T-y|0,w=b-y|0,(y|0)<0?(g[_>>2]=M,g[O>>2]=w,g[c>>2]=0,T=M,y=0):w=b,b=(w|0)<(T|0)?w:T,b=(y|0)<(b|0)?y:b,!((b|0)<=0)&&(g[_>>2]=T-b,g[O>>2]=w-b,g[c>>2]=y-b)}function Sc(_,y){_=_|0,y=y|0;var b=0,w=0,T=0,M=0,O=0,c=0;return O=(g[_>>2]|0)-(g[y>>2]|0)|0,c=(O|0)<0,w=(g[_+4>>2]|0)-(g[y+4>>2]|0)-(c?O:0)|0,M=(w|0)<0,T=(c?0-O|0:0)+(g[_+8>>2]|0)-(g[y+8>>2]|0)+(M?0-w|0:0)|0,_=(T|0)<0,y=_?0:T,b=(M?0:w)-(_?T:0)|0,T=(c?0:O)-(M?w:0)-(_?T:0)|0,_=(b|0)<(T|0)?b:T,_=(y|0)<(_|0)?y:_,w=(_|0)>0,y=y-(w?_:0)|0,b=b-(w?_:0)|0,_=T-(w?_:0)|0,_=(_|0)>-1?_:0-_|0,b=(b|0)>-1?b:0-b|0,y=(y|0)>-1?y:0-y|0,y=(b|0)>(y|0)?b:y,((_|0)>(y|0)?_:y)|0}function Ba(_,y){_=_|0,y=y|0;var b=0;b=g[_+8>>2]|0,g[y>>2]=(g[_>>2]|0)-b,g[y+4>>2]=(g[_+4>>2]|0)-b}function Ta(_,y){_=_|0,y=y|0;var b=0,w=0,T=0,M=0,O=0,c=0;w=g[_>>2]|0,g[y>>2]=w,T=g[_+4>>2]|0,O=y+4|0,g[O>>2]=T,c=y+8|0,g[c>>2]=0,b=(T|0)<(w|0),_=b?w:T,b=b?T:w;do if((b|0)<0){if((_|0)>0){if((_|-2147483648|0)<(b|0)&((b|0)!=-2147483648&(2147483647-_|0)>=(b|0)))break;return _=1,_|0}if((b|0)==-2147483648|(-2147483648-_|0)>(b|0))return y=1,y|0;if((_|0)>-1){if((_|-2147483648|0)<(b|0))break;return _=1,_|0}else{if((_^-2147483648|0)<(b|0))_=1;else break;return _|0}}while(!1);return _=T-w|0,(w|0)<0?(b=0-w|0,g[O>>2]=_,g[c>>2]=b,g[y>>2]=0,w=0):(_=T,b=0),(_|0)<0&&(w=w-_|0,g[y>>2]=w,b=b-_|0,g[c>>2]=b,g[O>>2]=0,_=0),M=w-b|0,T=_-b|0,(b|0)<0?(g[y>>2]=M,g[O>>2]=T,g[c>>2]=0,_=T,T=M,b=0):T=w,w=(_|0)<(T|0)?_:T,w=(b|0)<(w|0)?b:w,(w|0)<=0?(y=0,y|0):(g[y>>2]=T-w,g[O>>2]=_-w,g[c>>2]=b-w,y=0,y|0)}function Sa(_){_=_|0;var y=0,b=0,w=0,T=0;y=_+8|0,T=g[y>>2]|0,b=T-(g[_>>2]|0)|0,g[_>>2]=b,w=_+4|0,_=(g[w>>2]|0)-T|0,g[w>>2]=_,g[y>>2]=0-(_+b)}function Ya(_){_=_|0;var y=0,b=0,w=0,T=0,M=0,O=0,c=0;b=g[_>>2]|0,y=0-b|0,g[_>>2]=y,O=_+8|0,g[O>>2]=0,c=_+4|0,w=g[c>>2]|0,T=w+b|0,(b|0)>0?(g[c>>2]=T,g[O>>2]=b,g[_>>2]=0,y=0,w=T):b=0,(w|0)<0?(M=y-w|0,g[_>>2]=M,b=b-w|0,g[O>>2]=b,g[c>>2]=0,T=M-b|0,y=0-b|0,(b|0)<0?(g[_>>2]=T,g[c>>2]=y,g[O>>2]=0,w=y,b=0):(w=0,T=M)):T=y,y=(w|0)<(T|0)?w:T,y=(b|0)<(y|0)?b:y,!((y|0)<=0)&&(g[_>>2]=T-y,g[c>>2]=w-y,g[O>>2]=b-y)}function Ia(_,y,b,w,T){_=_|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0,f=0,m=0,E=0;if(E=Tt,Tt=Tt+64|0,m=E,c=E+56|0,!(!0&(y&2013265920|0)==134217728&(!0&(w&2013265920|0)==134217728)))return T=5,Tt=E,T|0;if((_|0)==(b|0)&(y|0)==(w|0))return g[T>>2]=0,T=0,Tt=E,T|0;if(O=Ke(_|0,y|0,52)|0,Bt()|0,O=O&15,f=Ke(b|0,w|0,52)|0,Bt()|0,(O|0)!=(f&15|0))return T=12,Tt=E,T|0;if(M=O+-1|0,O>>>0>1){ea(_,y,M,m)|0,ea(b,w,M,c)|0,f=m,d=g[f>>2]|0,f=g[f+4>>2]|0;t:do if((d|0)==(g[c>>2]|0)&&(f|0)==(g[c+4>>2]|0)){O=(O^15)*3|0,M=Ke(_|0,y|0,O|0)|0,Bt()|0,M=M&7,O=Ke(b|0,w|0,O|0)|0,Bt()|0,O=O&7;do if((M|0)==0|(O|0)==0)g[T>>2]=1,M=0;else if((M|0)==7)M=5;else{if((M|0)==1|(O|0)==1&&On(d,f)|0){M=5;break}if((g[15536+(M<<2)>>2]|0)!=(O|0)&&(g[15568+(M<<2)>>2]|0)!=(O|0))break t;g[T>>2]=1,M=0}while(!1);return T=M,Tt=E,T|0}while(!1)}M=m,O=M+56|0;do g[M>>2]=0,M=M+4|0;while((M|0)<(O|0));return Dn(_,y,1,m)|0,y=m,!((g[y>>2]|0)==(b|0)&&(g[y+4>>2]|0)==(w|0))&&(y=m+8|0,!((g[y>>2]|0)==(b|0)&&(g[y+4>>2]|0)==(w|0)))&&(y=m+16|0,!((g[y>>2]|0)==(b|0)&&(g[y+4>>2]|0)==(w|0)))&&(y=m+24|0,!((g[y>>2]|0)==(b|0)&&(g[y+4>>2]|0)==(w|0)))&&(y=m+32|0,!((g[y>>2]|0)==(b|0)&&(g[y+4>>2]|0)==(w|0)))&&(y=m+40|0,!((g[y>>2]|0)==(b|0)&&(g[y+4>>2]|0)==(w|0)))?(M=m+48|0,M=((g[M>>2]|0)==(b|0)?(g[M+4>>2]|0)==(w|0):0)&1):M=1,g[T>>2]=M,T=0,Tt=E,T|0}function qa(_,y,b,w,T){return _=_|0,y=y|0,b=b|0,w=w|0,T=T|0,b=wc(_,y,b,w)|0,(b|0)==7?(T=11,T|0):(w=ii(b|0,0,56)|0,y=y&-2130706433|(Bt()|0)|268435456,g[T>>2]=_|w,g[T+4>>2]=y,T=0,T|0)}function $a(_,y,b){return _=_|0,y=y|0,b=b|0,!0&(y&2013265920|0)==268435456?(g[b>>2]=_,g[b+4>>2]=y&-2130706433|134217728,b=0,b|0):(b=6,b|0)}function Ma(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0;return T=Tt,Tt=Tt+16|0,w=T,g[w>>2]=0,!0&(y&2013265920|0)==268435456?(M=Ke(_|0,y|0,56)|0,Bt()|0,w=In(_,y&-2130706433|134217728,M&7,w,b)|0,Tt=T,w|0):(w=6,Tt=T,w|0)}function Ff(_,y){_=_|0,y=y|0;var b=0;switch(b=Ke(_|0,y|0,56)|0,Bt()|0,b&7){case 0:case 7:return b=0,b|0}return b=y&-2130706433|134217728,!(!0&(y&2013265920|0)==268435456)||!0&(y&117440512|0)==16777216&(On(_,b)|0)!=0?(b=0,b|0):(b=ta(_,b)|0,b|0)}function kf(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0;return T=Tt,Tt=Tt+16|0,w=T,!0&(y&2013265920|0)==268435456?(M=y&-2130706433|134217728,O=b,g[O>>2]=_,g[O+4>>2]=M,g[w>>2]=0,y=Ke(_|0,y|0,56)|0,Bt()|0,w=In(_,M,y&7,w,b+8|0)|0,Tt=T,w|0):(w=6,Tt=T,w|0)}function Mn(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0;return T=(On(_,y)|0)==0,y=y&-2130706433,w=b,g[w>>2]=T?_:0,g[w+4>>2]=T?y|285212672:0,w=b+8|0,g[w>>2]=_,g[w+4>>2]=y|301989888,w=b+16|0,g[w>>2]=_,g[w+4>>2]=y|318767104,w=b+24|0,g[w>>2]=_,g[w+4>>2]=y|335544320,w=b+32|0,g[w>>2]=_,g[w+4>>2]=y|352321536,b=b+40|0,g[b>>2]=_,g[b+4>>2]=y|369098752,0}function pu(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0;return O=Tt,Tt=Tt+16|0,T=O,M=y&-2130706433|134217728,!0&(y&2013265920|0)==268435456?(w=Ke(_|0,y|0,56)|0,Bt()|0,w=Ts(_,M,w&7)|0,(w|0)==-1?(g[b>>2]=0,M=6,Tt=O,M|0):(nl(_,M,T)|0&&Qe(23313,22484,282,22499),y=Ke(_|0,y|0,52)|0,Bt()|0,y=y&15,On(_,M)|0?qs(T,y,w,2,b):gu(T,y,w,2,b),M=0,Tt=O,M|0)):(M=6,Tt=O,M|0)}function Au(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0;w=Tt,Tt=Tt+16|0,T=w,Nf(_,y,b,T),Ea(T,b+4|0),Tt=w}function Nf(_,y,b,w){_=_|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,c=0,d=0;if(c=Tt,Tt=Tt+16|0,d=c,Uf(_,b,d),M=+ki(+(1-+ut[d>>3]*.5)),M<1e-16){g[w>>2]=0,g[w+4>>2]=0,g[w+8>>2]=0,g[w+12>>2]=0,Tt=c;return}if(d=g[b>>2]|0,T=+ut[15920+(d*24|0)>>3],T=+Gl(T-+Gl(+Sh(15600+(d<<4)|0,_))),Jo(y)|0?O=+Gl(T+-.3334731722518321):O=T,T=+He(+M)/.381966011250105,(y|0)>0){_=0;do T=T*2.6457513110645907,_=_+1|0;while((_|0)!=(y|0))}M=+ke(+O)*T,ut[w>>3]=M,O=+Me(+O)*T,ut[w+8>>3]=O,Tt=c}function Uf(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0;if(M=Tt,Tt=Tt+32|0,T=M,Dh(_,T),g[y>>2]=0,ut[b>>3]=5,w=+Br(16400,T),w<+ut[b>>3]&&(g[y>>2]=0,ut[b>>3]=w),w=+Br(16424,T),w<+ut[b>>3]&&(g[y>>2]=1,ut[b>>3]=w),w=+Br(16448,T),w<+ut[b>>3]&&(g[y>>2]=2,ut[b>>3]=w),w=+Br(16472,T),w<+ut[b>>3]&&(g[y>>2]=3,ut[b>>3]=w),w=+Br(16496,T),w<+ut[b>>3]&&(g[y>>2]=4,ut[b>>3]=w),w=+Br(16520,T),w<+ut[b>>3]&&(g[y>>2]=5,ut[b>>3]=w),w=+Br(16544,T),w<+ut[b>>3]&&(g[y>>2]=6,ut[b>>3]=w),w=+Br(16568,T),w<+ut[b>>3]&&(g[y>>2]=7,ut[b>>3]=w),w=+Br(16592,T),w<+ut[b>>3]&&(g[y>>2]=8,ut[b>>3]=w),w=+Br(16616,T),w<+ut[b>>3]&&(g[y>>2]=9,ut[b>>3]=w),w=+Br(16640,T),w<+ut[b>>3]&&(g[y>>2]=10,ut[b>>3]=w),w=+Br(16664,T),w<+ut[b>>3]&&(g[y>>2]=11,ut[b>>3]=w),w=+Br(16688,T),w<+ut[b>>3]&&(g[y>>2]=12,ut[b>>3]=w),w=+Br(16712,T),w<+ut[b>>3]&&(g[y>>2]=13,ut[b>>3]=w),w=+Br(16736,T),w<+ut[b>>3]&&(g[y>>2]=14,ut[b>>3]=w),w=+Br(16760,T),w<+ut[b>>3]&&(g[y>>2]=15,ut[b>>3]=w),w=+Br(16784,T),w<+ut[b>>3]&&(g[y>>2]=16,ut[b>>3]=w),w=+Br(16808,T),w<+ut[b>>3]&&(g[y>>2]=17,ut[b>>3]=w),w=+Br(16832,T),w<+ut[b>>3]&&(g[y>>2]=18,ut[b>>3]=w),w=+Br(16856,T),!(w<+ut[b>>3])){Tt=M;return}g[y>>2]=19,ut[b>>3]=w,Tt=M}function Ol(_,y,b,w,T){_=_|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0;if(M=+ra(_),M<1e-16){y=15600+(y<<4)|0,g[T>>2]=g[y>>2],g[T+4>>2]=g[y+4>>2],g[T+8>>2]=g[y+8>>2],g[T+12>>2]=g[y+12>>2];return}if(O=+ln(+ +ut[_+8>>3],+ +ut[_>>3]),(b|0)>0){_=0;do M=M/2.6457513110645907,_=_+1|0;while((_|0)!=(b|0))}w?(M=M/3,b=(Jo(b)|0)==0,M=+$i(+((b?M:M/2.6457513110645907)*.381966011250105))):(M=+$i(+(M*.381966011250105)),Jo(b)|0&&(O=+Gl(O+.3334731722518321))),Rc(15600+(y<<4)|0,+Gl(+ut[15920+(y*24|0)>>3]-O),M,T)}function Gf(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0;w=Tt,Tt=Tt+16|0,T=w,Ls(_+4|0,T),Ol(T,g[_>>2]|0,y,0,b),Tt=w}function qs(_,y,b,w,T){_=_|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,U=0,J=0,et=0,$=0,it=0,st=0,xt=0,Rt=0,yt=0,It=0,Ht=0,Xt=0,ee=0,Qt=0,$t=0,Ae=0,Le=0,we=0;if(Ae=Tt,Tt=Tt+272|0,M=Ae+256|0,$=Ae+240|0,ee=Ae,Qt=Ae+224|0,$t=Ae+208|0,it=Ae+176|0,st=Ae+160|0,xt=Ae+192|0,Rt=Ae+144|0,yt=Ae+128|0,It=Ae+112|0,Ht=Ae+96|0,Xt=Ae+80|0,g[M>>2]=y,g[$>>2]=g[_>>2],g[$+4>>2]=g[_+4>>2],g[$+8>>2]=g[_+8>>2],g[$+12>>2]=g[_+12>>2],$s($,M,ee),g[T>>2]=0,$=w+b+((w|0)==5&1)|0,($|0)<=(b|0)){Tt=Ae;return}d=g[M>>2]|0,f=Qt+4|0,m=it+4|0,E=b+5|0,P=16880+(d<<2)|0,R=16960+(d<<2)|0,F=yt+8|0,U=It+8|0,J=Ht+8|0,et=$t+4|0,c=b;t:for(;;){O=ee+(((c|0)%5|0)<<4)|0,g[$t>>2]=g[O>>2],g[$t+4>>2]=g[O+4>>2],g[$t+8>>2]=g[O+8>>2],g[$t+12>>2]=g[O+12>>2];do;while((as($t,d,0,1)|0)==2);if((c|0)>(b|0)&(Jo(y)|0)!=0){if(g[it>>2]=g[$t>>2],g[it+4>>2]=g[$t+4>>2],g[it+8>>2]=g[$t+8>>2],g[it+12>>2]=g[$t+12>>2],Ls(f,st),w=g[it>>2]|0,M=g[17040+(w*80|0)+(g[Qt>>2]<<2)>>2]|0,g[it>>2]=g[18640+(w*80|0)+(M*20|0)>>2],O=g[18640+(w*80|0)+(M*20|0)+16>>2]|0,(O|0)>0){_=0;do Ch(m),_=_+1|0;while((_|0)<(O|0))}switch(O=18640+(w*80|0)+(M*20|0)+4|0,g[xt>>2]=g[O>>2],g[xt+4>>2]=g[O+4>>2],g[xt+8>>2]=g[O+8>>2],Za(xt,(g[P>>2]|0)*3|0),jn(m,xt,m),br(m),Ls(m,Rt),Le=+(g[R>>2]|0),ut[yt>>3]=Le*3,ut[F>>3]=0,we=Le*-1.5,ut[It>>3]=we,ut[U>>3]=Le*2.598076211353316,ut[Ht>>3]=we,ut[J>>3]=Le*-2.598076211353316,g[17040+((g[it>>2]|0)*80|0)+(g[$t>>2]<<2)>>2]|0){case 1:{_=It,w=yt;break}case 3:{_=Ht,w=It;break}case 2:{_=yt,w=Ht;break}default:{_=12;break t}}Rh(st,Rt,w,_,Xt),Ol(Xt,g[it>>2]|0,d,1,T+8+(g[T>>2]<<4)|0),g[T>>2]=(g[T>>2]|0)+1}if((c|0)<(E|0)&&(Ls(et,it),Ol(it,g[$t>>2]|0,d,1,T+8+(g[T>>2]<<4)|0),g[T>>2]=(g[T>>2]|0)+1),g[Qt>>2]=g[$t>>2],g[Qt+4>>2]=g[$t+4>>2],g[Qt+8>>2]=g[$t+8>>2],g[Qt+12>>2]=g[$t+12>>2],c=c+1|0,(c|0)>=($|0)){_=3;break}}if((_|0)==3){Tt=Ae;return}else(_|0)==12&&Qe(22522,22569,571,22579)}function $s(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,c=0,d=0;d=Tt,Tt=Tt+128|0,w=d+64|0,T=d,M=w,O=20240,c=M+60|0;do g[M>>2]=g[O>>2],M=M+4|0,O=O+4|0;while((M|0)<(c|0));M=T,O=20304,c=M+60|0;do g[M>>2]=g[O>>2],M=M+4|0,O=O+4|0;while((M|0)<(c|0));c=(Jo(g[y>>2]|0)|0)==0,w=c?w:T,T=_+4|0,Eh(T),Ur(T),Jo(g[y>>2]|0)|0&&(Ys(T),g[y>>2]=(g[y>>2]|0)+1),g[b>>2]=g[_>>2],y=b+4|0,jn(T,w,y),br(y),g[b+16>>2]=g[_>>2],y=b+20|0,jn(T,w+12|0,y),br(y),g[b+32>>2]=g[_>>2],y=b+36|0,jn(T,w+24|0,y),br(y),g[b+48>>2]=g[_>>2],y=b+52|0,jn(T,w+36|0,y),br(y),g[b+64>>2]=g[_>>2],b=b+68|0,jn(T,w+48|0,b),br(b),Tt=d}function as(_,y,b,w){_=_|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0;if(F=Tt,Tt=Tt+32|0,P=F+12|0,c=F,R=_+4|0,E=g[16960+(y<<2)>>2]|0,m=(w|0)!=0,E=m?E*3|0:E,T=g[R>>2]|0,f=_+8|0,O=g[f>>2]|0,m){if(M=_+12|0,w=g[M>>2]|0,T=O+T+w|0,(T|0)==(E|0))return R=1,Tt=F,R|0;d=M}else d=_+12|0,w=g[d>>2]|0,T=O+T+w|0;if((T|0)<=(E|0))return R=0,Tt=F,R|0;do if((w|0)>0){if(w=g[_>>2]|0,(O|0)>0){M=18640+(w*80|0)+60|0,w=_;break}w=18640+(w*80|0)+40|0,b?(Qa(P,E,0,0),dr(R,P,c),du(c),jn(c,P,R),M=w,w=_):(M=w,w=_)}else M=18640+((g[_>>2]|0)*80|0)+20|0,w=_;while(!1);if(g[w>>2]=g[M>>2],T=M+16|0,(g[T>>2]|0)>0){w=0;do Ch(R),w=w+1|0;while((w|0)<(g[T>>2]|0))}return _=M+4|0,g[P>>2]=g[_>>2],g[P+4>>2]=g[_+4>>2],g[P+8>>2]=g[_+8>>2],y=g[16880+(y<<2)>>2]|0,Za(P,m?y*3|0:y),jn(R,P,R),br(R),m?w=((g[f>>2]|0)+(g[R>>2]|0)+(g[d>>2]|0)|0)==(E|0)?1:2:w=2,R=w,Tt=F,R|0}function zf(_,y){_=_|0,y=y|0;var b=0;do b=as(_,y,0,1)|0;while((b|0)==2);return b|0}function gu(_,y,b,w,T){_=_|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,U=0,J=0,et=0,$=0,it=0,st=0,xt=0,Rt=0,yt=0,It=0,Ht=0,Xt=0,ee=0;if(Ht=Tt,Tt=Tt+240|0,M=Ht+224|0,xt=Ht+208|0,Rt=Ht,yt=Ht+192|0,It=Ht+176|0,J=Ht+160|0,et=Ht+144|0,$=Ht+128|0,it=Ht+112|0,st=Ht+96|0,g[M>>2]=y,g[xt>>2]=g[_>>2],g[xt+4>>2]=g[_+4>>2],g[xt+8>>2]=g[_+8>>2],g[xt+12>>2]=g[_+12>>2],mu(xt,M,Rt),g[T>>2]=0,U=w+b+((w|0)==6&1)|0,(U|0)<=(b|0)){Tt=Ht;return}d=g[M>>2]|0,f=b+6|0,m=16960+(d<<2)|0,E=et+8|0,P=$+8|0,R=it+8|0,F=yt+4|0,O=0,c=b,w=-1;t:for(;;){if(M=(c|0)%6|0,_=Rt+(M<<4)|0,g[yt>>2]=g[_>>2],g[yt+4>>2]=g[_+4>>2],g[yt+8>>2]=g[_+8>>2],g[yt+12>>2]=g[_+12>>2],_=O,O=as(yt,d,0,1)|0,(c|0)>(b|0)&(Jo(y)|0)!=0&&(_|0)!=1&&(g[yt>>2]|0)!=(w|0)){switch(Ls(Rt+(((M+5|0)%6|0)<<4)+4|0,It),Ls(Rt+(M<<4)+4|0,J),Xt=+(g[m>>2]|0),ut[et>>3]=Xt*3,ut[E>>3]=0,ee=Xt*-1.5,ut[$>>3]=ee,ut[P>>3]=Xt*2.598076211353316,ut[it>>3]=ee,ut[R>>3]=Xt*-2.598076211353316,M=g[xt>>2]|0,g[17040+(M*80|0)+(((w|0)==(M|0)?g[yt>>2]|0:w)<<2)>>2]|0){case 1:{_=$,w=et;break}case 3:{_=it,w=$;break}case 2:{_=et,w=it;break}default:{_=8;break t}}Rh(It,J,w,_,st),!(Hl(It,st)|0)&&!(Hl(J,st)|0)&&(Ol(st,g[xt>>2]|0,d,1,T+8+(g[T>>2]<<4)|0),g[T>>2]=(g[T>>2]|0)+1)}if((c|0)<(f|0)&&(Ls(F,It),Ol(It,g[yt>>2]|0,d,1,T+8+(g[T>>2]<<4)|0),g[T>>2]=(g[T>>2]|0)+1),c=c+1|0,(c|0)>=(U|0)){_=3;break}else w=g[yt>>2]|0}if((_|0)==3){Tt=Ht;return}else(_|0)==8&&Qe(22606,22569,736,22651)}function mu(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,c=0,d=0;d=Tt,Tt=Tt+160|0,w=d+80|0,T=d,M=w,O=20368,c=M+72|0;do g[M>>2]=g[O>>2],M=M+4|0,O=O+4|0;while((M|0)<(c|0));M=T,O=20448,c=M+72|0;do g[M>>2]=g[O>>2],M=M+4|0,O=O+4|0;while((M|0)<(c|0));c=(Jo(g[y>>2]|0)|0)==0,w=c?w:T,T=_+4|0,Eh(T),Ur(T),Jo(g[y>>2]|0)|0&&(Ys(T),g[y>>2]=(g[y>>2]|0)+1),g[b>>2]=g[_>>2],y=b+4|0,jn(T,w,y),br(y),g[b+16>>2]=g[_>>2],y=b+20|0,jn(T,w+12|0,y),br(y),g[b+32>>2]=g[_>>2],y=b+36|0,jn(T,w+24|0,y),br(y),g[b+48>>2]=g[_>>2],y=b+52|0,jn(T,w+36|0,y),br(y),g[b+64>>2]=g[_>>2],y=b+68|0,jn(T,w+48|0,y),br(y),g[b+80>>2]=g[_>>2],b=b+84|0,jn(T,w+60|0,b),br(b),Tt=d}function tl(_,y){return _=_|0,y=y|0,y=Ke(_|0,y|0,52)|0,Bt()|0,y&15|0}function Bh(_,y){return _=_|0,y=y|0,y=Ke(_|0,y|0,45)|0,Bt()|0,y&127|0}function ta(_,y){_=_|0,y=y|0;var b=0,w=0,T=0,M=0,O=0,c=0;if(!(!0&(y&-16777216|0)==134217728)||(O=Ke(_|0,y|0,45)|0,Bt()|0,O=O&127,O>>>0>121))return y=0,y|0;b=Ke(_|0,y|0,52)|0,Bt()|0,b=b&15;do if(b|0){for(T=1,w=0;;){if(M=Ke(_|0,y|0,(15-T|0)*3|0)|0,Bt()|0,M=M&7,(M|0)!=0&(w^1))if((M|0)==1&(Si(O)|0)!=0){c=0,w=13;break}else w=1;if((M|0)==7){c=0,w=13;break}if(T>>>0<b>>>0)T=T+1|0;else{w=9;break}}if((w|0)==9){if((b|0)==15)c=1;else break;return c|0}else if((w|0)==13)return c|0}while(!1);for(;;){if(c=Ke(_|0,y|0,(14-b|0)*3|0)|0,Bt()|0,!((c&7|0)==7&!0)){c=0,w=13;break}if(b>>>0<14)b=b+1|0;else{c=1,w=13;break}}return(w|0)==13?c|0:0}function ea(_,y,b,w){_=_|0,y=y|0,b=b|0,w=w|0;var T=0,M=0;if(M=Ke(_|0,y|0,52)|0,Bt()|0,M=M&15,b>>>0>15)return w=4,w|0;if((M|0)<(b|0))return w=12,w|0;if((M|0)==(b|0))return g[w>>2]=_,g[w+4>>2]=y,w=0,w|0;if(T=ii(b|0,0,52)|0,T=T|_,_=Bt()|0|y&-15728641,(M|0)>(b|0))do y=ii(7,0,(14-b|0)*3|0)|0,b=b+1|0,T=y|T,_=Bt()|0|_;while((b|0)<(M|0));return g[w>>2]=T,g[w+4>>2]=_,w=0,w|0}function Ic(_,y,b,w){_=_|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0;if(M=Ke(_|0,y|0,52)|0,Bt()|0,M=M&15,!((b|0)<16&(M|0)<=(b|0)))return w=4,w|0;T=b-M|0,b=Ke(_|0,y|0,45)|0,Bt()|0;t:do if(!(Si(b&127)|0))b=Qo(7,0,T,((T|0)<0)<<31>>31)|0,T=Bt()|0;else{e:do if(M|0){for(b=1;O=ii(7,0,(15-b|0)*3|0)|0,!!((O&_|0)==0&((Bt()|0)&y|0)==0);)if(b>>>0<M>>>0)b=b+1|0;else break e;b=Qo(7,0,T,((T|0)<0)<<31>>31)|0,T=Bt()|0;break t}while(!1);b=Qo(7,0,T,((T|0)<0)<<31>>31)|0,b=pr(b|0,Bt()|0,5,0)|0,b=pn(b|0,Bt()|0,-5,-1)|0,b=Zo(b|0,Bt()|0,6,0)|0,b=pn(b|0,Bt()|0,1,0)|0,T=Bt()|0}while(!1);return O=w,g[O>>2]=b,g[O+4>>2]=T,O=0,O|0}function On(_,y){_=_|0,y=y|0;var b=0,w=0,T=0;if(T=Ke(_|0,y|0,45)|0,Bt()|0,!(Si(T&127)|0))return T=0,T|0;T=Ke(_|0,y|0,52)|0,Bt()|0,T=T&15;t:do if(!T)b=0;else for(w=1;;){if(b=Ke(_|0,y|0,(15-w|0)*3|0)|0,Bt()|0,b=b&7,b|0)break t;if(w>>>0<T>>>0)w=w+1|0;else{b=0;break}}while(!1);return T=(b|0)==0&1,T|0}function Nn(_,y,b,w){_=_|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,c=0;if(O=Tt,Tt=Tt+16|0,M=O,Pc(M,_,y,b),y=M,_=g[y>>2]|0,y=g[y+4>>2]|0,(_|0)==0&(y|0)==0)return Tt=O,0;T=0,b=0;do c=w+(T<<3)|0,g[c>>2]=_,g[c+4>>2]=y,T=pn(T|0,b|0,1,0)|0,b=Bt()|0,xu(M),c=M,_=g[c>>2]|0,y=g[c+4>>2]|0;while(!((_|0)==0&(y|0)==0));return Tt=O,0}function yu(_,y,b,w){return _=_|0,y=y|0,b=b|0,w=w|0,(w|0)<(b|0)?(b=y,w=_,yi(b|0),w|0):(b=ii(-1,-1,((w-b|0)*3|0)+3|0)|0,w=ii(~b|0,~(Bt()|0)|0,(15-w|0)*3|0)|0,b=~(Bt()|0)&y,w=~w&_,yi(b|0),w|0)}function cA(_,y,b,w){_=_|0,y=y|0,b=b|0,w=w|0;var T=0;return T=Ke(_|0,y|0,52)|0,Bt()|0,T=T&15,(b|0)<16&(T|0)<=(b|0)?((T|0)<(b|0)&&(T=ii(-1,-1,((b+-1-T|0)*3|0)+3|0)|0,T=ii(~T|0,~(Bt()|0)|0,(15-b|0)*3|0)|0,y=~(Bt()|0)&y,_=~T&_),T=ii(b|0,0,52)|0,b=y&-15728641|(Bt()|0),g[w>>2]=_|T,g[w+4>>2]=b,w=0,w|0):(w=4,w|0)}function Ll(_,y,b,w){_=_|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,U=0,J=0,et=0,$=0,it=0,st=0,xt=0,Rt=0,yt=0,It=0;if((b|0)==0&(w|0)==0)return yt=0,yt|0;if(T=_,M=g[T>>2]|0,T=g[T+4>>2]|0,!0&(T&15728640|0)==0){if(!((w|0)>0|(w|0)==0&b>>>0>0)||(yt=y,g[yt>>2]=M,g[yt+4>>2]=T,(b|0)==1&(w|0)==0))return yt=0,yt|0;T=1;do xt=_+(T<<3)|0,Rt=g[xt+4>>2]|0,yt=y+(T<<3)|0,g[yt>>2]=g[xt>>2],g[yt+4>>2]=Rt,T=T+1|0;while(0<(w|0)|(w|0)==0&T>>>0<b>>>0);return T=0,T|0}if(st=b<<3,Rt=Qn(st)|0,!Rt)return yt=13,yt|0;if(Ns(Rt|0,_|0,st|0)|0,xt=fs(b,8)|0,!xt)return Ni(Rt),yt=13,yt|0;t:do if(b|0){e:for(;;){T=Rt,et=g[T>>2]|0,T=g[T+4>>2]|0,$=Ke(et|0,T|0,52)|0,Bt()|0,$=$&15,it=$+-1|0,J=(b|0)>0;i:do if(($|0)!=0&J){if(R=((b|0)<0)<<31>>31,F=ii(it|0,0,52)|0,U=Bt()|0,it>>>0>15){if(!((et|0)==0&(T|0)==0)){yt=17;break e}for(M=0;;){if(M=M+1|0,(M|0)>=(b|0))break i;if(w=Rt+(M<<3)|0,U=g[w>>2]|0,w=g[w+4>>2]|0,!((U|0)==0&(w|0)==0)){T=w,yt=17;break e}}}for(M=0,_=et,w=T;;){if(!((_|0)==0&(w|0)==0)){if(!(!0&(w&117440512|0)==0)){yt=22;break e}if(c=Ke(_|0,w|0,52)|0,Bt()|0,c=c&15,(c|0)<(it|0)){T=12,yt=28;break e}if((c|0)!=(it|0)&&(_=_|F,w=w&-15728641|U,c>>>0>=$>>>0)){O=it;do P=ii(7,0,(14-O|0)*3|0)|0,O=O+1|0,_=P|_,w=Bt()|0|w;while(O>>>0<c>>>0)}if(O=Ss(_|0,w|0,b|0,R|0)|0,Bt()|0,f=xt+(O<<3)|0,c=f,d=g[c>>2]|0,c=g[c+4>>2]|0,(d|0)==0&(c|0)==0)O=f;else for(P=0;;){if((P|0)>(b|0)){yt=32;break e}if((d|0)==(_|0)&(c&-117440513|0)==(w|0)){m=Ke(d|0,c|0,56)|0,Bt()|0,m=m&7,E=m+1|0,It=Ke(d|0,c|0,45)|0,Bt()|0;n:do if(!(Si(It&127)|0))c=7;else{if(d=Ke(d|0,c|0,52)|0,Bt()|0,d=d&15,!d){c=6;break}for(c=1;;){if(It=ii(7,0,(15-c|0)*3|0)|0,!((It&_|0)==0&((Bt()|0)&w|0)==0)){c=7;break n}if(c>>>0<d>>>0)c=c+1|0;else{c=6;break}}}while(!1);if((m+2|0)>>>0>c>>>0){yt=42;break e}It=ii(E|0,0,56)|0,w=Bt()|0|w&-117440513,E=f,g[E>>2]=0,g[E+4>>2]=0,_=It|_}else O=(O+1|0)%(b|0)|0;if(f=xt+(O<<3)|0,c=f,d=g[c>>2]|0,c=g[c+4>>2]|0,(d|0)==0&(c|0)==0){O=f;break}else P=P+1|0}It=O,g[It>>2]=_,g[It+4>>2]=w}if(M=M+1|0,(M|0)>=(b|0))break i;w=Rt+(M<<3)|0,_=g[w>>2]|0,w=g[w+4>>2]|0}}while(!1);if((b+5|0)>>>0<11){yt=85;break}if(U=fs((b|0)/6|0,8)|0,!U){yt=49;break}i:do if(J){P=0,E=0;do{if(c=xt+(P<<3)|0,w=c,M=g[w>>2]|0,w=g[w+4>>2]|0,!((M|0)==0&(w|0)==0)){d=Ke(M|0,w|0,56)|0,Bt()|0,d=d&7,_=d+1|0,f=w&-117440513,It=Ke(M|0,w|0,45)|0,Bt()|0;n:do if(Si(It&127)|0){if(m=Ke(M|0,w|0,52)|0,Bt()|0,m=m&15,m|0)for(O=1;;){if(It=ii(7,0,(15-O|0)*3|0)|0,!((M&It|0)==0&(f&(Bt()|0)|0)==0))break n;if(O>>>0<m>>>0)O=O+1|0;else break}w=ii(_|0,0,56)|0,M=w|M,w=Bt()|0|f,_=c,g[_>>2]=M,g[_+4>>2]=w,_=d+2|0}while(!1);(_|0)==7&&(It=U+(E<<3)|0,g[It>>2]=M,g[It+4>>2]=w&-117440513,E=E+1|0)}P=P+1|0}while((P|0)!=(b|0));if(J){if(P=((b|0)<0)<<31>>31,R=ii(it|0,0,52)|0,F=Bt()|0,it>>>0>15){if(!((et|0)==0&(T|0)==0)){T=4,yt=84;break e}for(T=0;;){if(T=T+1|0,(T|0)>=(b|0)){M=0,T=E;break i}if(It=Rt+(T<<3)|0,!((g[It>>2]|0)==0&(g[It+4>>2]|0)==0)){T=4,yt=84;break e}}}for(m=0,M=0,f=et;;){do if(!((f|0)==0&(T|0)==0)){if(c=Ke(f|0,T|0,52)|0,Bt()|0,c=c&15,(c|0)<(it|0)){T=12,yt=84;break e}do if((c|0)==(it|0))w=f,c=T;else{if(w=f|R,_=T&-15728641|F,c>>>0<$>>>0){c=_;break}O=it;do It=ii(7,0,(14-O|0)*3|0)|0,O=O+1|0,w=It|w,_=Bt()|0|_;while(O>>>0<c>>>0);c=_}while(!1);for(O=Ss(w|0,c|0,b|0,P|0)|0,Bt()|0,_=0;;){if((_|0)>(b|0)){yt=77;break e}if(It=xt+(O<<3)|0,d=g[It+4>>2]|0,(d&-117440513|0)==(c|0)&&(g[It>>2]|0)==(w|0)){yt=79;break}if(O=(O+1|0)%(b|0)|0,It=xt+(O<<3)|0,(g[It>>2]|0)==(w|0)&&(g[It+4>>2]|0)==(c|0))break;_=_+1|0}if((yt|0)==79&&(yt=0,!0&(d&117440512|0)==100663296))break;It=y+(M<<3)|0,g[It>>2]=f,g[It+4>>2]=T,M=M+1|0}while(!1);if(T=m+1|0,(T|0)>=(b|0)){T=E;break i}It=Rt+(T<<3)|0,m=T,f=g[It>>2]|0,T=g[It+4>>2]|0}}else M=0,T=E}else M=0,T=0;while(!1);if(aa(xt|0,0,st|0)|0,Ns(Rt|0,U|0,T<<3|0)|0,Ni(U),T)y=y+(M<<3)|0,b=T;else break t}if((yt|0)==17)!0&(T&117440512|0)==0?(T=4,yt=28):yt=22;else if((yt|0)==32)Qe(23313,22674,362,22684);else{if((yt|0)==42)return Ni(Rt),Ni(xt),It=10,It|0;if((yt|0)==49)return Ni(Rt),Ni(xt),It=13,It|0;if((yt|0)==77)Qe(23313,22674,462,22684);else{if((yt|0)==84)return Ni(U),Ni(Rt),Ni(xt),It=T,It|0;if((yt|0)==85){Ns(y|0,Rt|0,b<<3|0)|0;break}}}if((yt|0)==22)return Ni(Rt),Ni(xt),It=5,It|0;if((yt|0)==28)return Ni(Rt),Ni(xt),It=T,It|0}while(!1);return Ni(Rt),Ni(xt),It=0,It|0}function Vf(_,y,b,w,T,M,O){_=_|0,y=y|0,b=b|0,w=w|0,T=T|0,M=M|0,O=O|0;var c=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,U=0;if(U=Tt,Tt=Tt+16|0,F=U,!((b|0)>0|(b|0)==0&y>>>0>0))return F=0,Tt=U,F|0;if((O|0)>=16)return F=12,Tt=U,F|0;P=0,R=0,E=0,c=0;t:for(;;){if(f=_+(P<<3)|0,d=g[f>>2]|0,f=g[f+4>>2]|0,m=Ke(d|0,f|0,52)|0,Bt()|0,(m&15|0)>(O|0)){c=12,d=11;break}if(Pc(F,d,f,O),m=F,f=g[m>>2]|0,m=g[m+4>>2]|0,(f|0)==0&(m|0)==0)d=E;else{d=E;do{if(!((c|0)<(M|0)|(c|0)==(M|0)&d>>>0<T>>>0)){d=10;break t}E=w+(d<<3)|0,g[E>>2]=f,g[E+4>>2]=m,d=pn(d|0,c|0,1,0)|0,c=Bt()|0,xu(F),E=F,f=g[E>>2]|0,m=g[E+4>>2]|0}while(!((f|0)==0&(m|0)==0))}if(P=pn(P|0,R|0,1,0)|0,R=Bt()|0,(R|0)<(b|0)|(R|0)==(b|0)&P>>>0<y>>>0)E=d;else{c=0,d=11;break}}return(d|0)==10?(F=14,Tt=U,F|0):(d|0)==11?(Tt=U,c|0):0}function uA(_,y,b,w,T){_=_|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0;P=Tt,Tt=Tt+16|0,E=P;t:do if((b|0)>0|(b|0)==0&y>>>0>0){for(f=0,O=0,M=0,m=0;;){if(d=_+(f<<3)|0,c=g[d>>2]|0,d=g[d+4>>2]|0,!((c|0)==0&(d|0)==0)&&(d=(Ic(c,d,w,E)|0)==0,c=E,O=pn(g[c>>2]|0,g[c+4>>2]|0,O|0,M|0)|0,M=Bt()|0,!d)){M=12;break}if(f=pn(f|0,m|0,1,0)|0,m=Bt()|0,!((m|0)<(b|0)|(m|0)==(b|0)&f>>>0<y>>>0))break t}return Tt=P,M|0}else O=0,M=0;while(!1);return g[T>>2]=O,g[T+4>>2]=M,T=0,Tt=P,T|0}function jf(_,y){return _=_|0,y=y|0,y=Ke(_|0,y|0,52)|0,Bt()|0,y&1|0}function io(_,y){_=_|0,y=y|0;var b=0,w=0,T=0;if(T=Ke(_|0,y|0,52)|0,Bt()|0,T=T&15,!T)return T=0,T|0;for(w=1;;){if(b=Ke(_|0,y|0,(15-w|0)*3|0)|0,Bt()|0,b=b&7,b|0){w=5;break}if(w>>>0<T>>>0)w=w+1|0;else{b=0,w=5;break}}return(w|0)==5?b|0:0}function Pa(_,y){_=_|0,y=y|0;var b=0,w=0,T=0,M=0,O=0,c=0,d=0;if(d=Ke(_|0,y|0,52)|0,Bt()|0,d=d&15,!d)return c=y,d=_,yi(c|0),d|0;for(c=1,b=0;;){M=(15-c|0)*3|0,w=ii(7,0,M|0)|0,T=Bt()|0,O=Ke(_|0,y|0,M|0)|0,Bt()|0,M=ii(Es(O&7)|0,0,M|0)|0,O=Bt()|0,_=M|_&~w,y=O|y&~T;t:do if(!b)if((M&w|0)==0&(O&T|0)==0)b=0;else if(w=Ke(_|0,y|0,52)|0,Bt()|0,w=w&15,!w)b=1;else{b=1;e:for(;;){switch(O=Ke(_|0,y|0,(15-b|0)*3|0)|0,Bt()|0,O&7){case 1:break e;case 0:break;default:{b=1;break t}}if(b>>>0<w>>>0)b=b+1|0;else{b=1;break t}}for(b=1;;)if(O=(15-b|0)*3|0,T=Ke(_|0,y|0,O|0)|0,Bt()|0,M=ii(7,0,O|0)|0,y=y&~(Bt()|0),O=ii(Es(T&7)|0,0,O|0)|0,_=_&~M|O,y=y|(Bt()|0),b>>>0<w>>>0)b=b+1|0;else{b=1;break}}while(!1);if(c>>>0<d>>>0)c=c+1|0;else break}return yi(y|0),_|0}function Bs(_,y){_=_|0,y=y|0;var b=0,w=0,T=0,M=0,O=0;if(w=Ke(_|0,y|0,52)|0,Bt()|0,w=w&15,!w)return b=y,w=_,yi(b|0),w|0;for(b=1;M=(15-b|0)*3|0,O=Ke(_|0,y|0,M|0)|0,Bt()|0,T=ii(7,0,M|0)|0,y=y&~(Bt()|0),M=ii(Es(O&7)|0,0,M|0)|0,_=M|_&~T,y=Bt()|0|y,b>>>0<w>>>0;)b=b+1|0;return yi(y|0),_|0}function _u(_,y){_=_|0,y=y|0;var b=0,w=0,T=0,M=0,O=0,c=0,d=0;if(d=Ke(_|0,y|0,52)|0,Bt()|0,d=d&15,!d)return c=y,d=_,yi(c|0),d|0;for(c=1,b=0;;){M=(15-c|0)*3|0,w=ii(7,0,M|0)|0,T=Bt()|0,O=Ke(_|0,y|0,M|0)|0,Bt()|0,M=ii(ss(O&7)|0,0,M|0)|0,O=Bt()|0,_=M|_&~w,y=O|y&~T;t:do if(!b)if((M&w|0)==0&(O&T|0)==0)b=0;else if(w=Ke(_|0,y|0,52)|0,Bt()|0,w=w&15,!w)b=1;else{b=1;e:for(;;){switch(O=Ke(_|0,y|0,(15-b|0)*3|0)|0,Bt()|0,O&7){case 1:break e;case 0:break;default:{b=1;break t}}if(b>>>0<w>>>0)b=b+1|0;else{b=1;break t}}for(b=1;;)if(T=(15-b|0)*3|0,M=ii(7,0,T|0)|0,O=y&~(Bt()|0),y=Ke(_|0,y|0,T|0)|0,Bt()|0,y=ii(ss(y&7)|0,0,T|0)|0,_=_&~M|y,y=O|(Bt()|0),b>>>0<w>>>0)b=b+1|0;else{b=1;break}}while(!1);if(c>>>0<d>>>0)c=c+1|0;else break}return yi(y|0),_|0}function el(_,y){_=_|0,y=y|0;var b=0,w=0,T=0,M=0,O=0;if(w=Ke(_|0,y|0,52)|0,Bt()|0,w=w&15,!w)return b=y,w=_,yi(b|0),w|0;for(b=1;O=(15-b|0)*3|0,M=ii(7,0,O|0)|0,T=y&~(Bt()|0),y=Ke(_|0,y|0,O|0)|0,Bt()|0,y=ii(ss(y&7)|0,0,O|0)|0,_=y|_&~M,y=Bt()|0|T,b>>>0<w>>>0;)b=b+1|0;return yi(y|0),_|0}function Fl(_,y){_=_|0,y=y|0;var b=0,w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0;if(d=Tt,Tt=Tt+64|0,c=d+40|0,w=d+24|0,T=d+12|0,M=d,ii(y|0,0,52)|0,b=Bt()|0|134225919,!y)return(g[_+4>>2]|0)>2||(g[_+8>>2]|0)>2||(g[_+12>>2]|0)>2?(O=0,c=0,yi(O|0),Tt=d,c|0):(ii(Po(_)|0,0,45)|0,O=Bt()|0|b,c=-1,yi(O|0),Tt=d,c|0);if(g[c>>2]=g[_>>2],g[c+4>>2]=g[_+4>>2],g[c+8>>2]=g[_+8>>2],g[c+12>>2]=g[_+12>>2],O=c+4|0,(y|0)>0)for(_=-1;g[w>>2]=g[O>>2],g[w+4>>2]=g[O+4>>2],g[w+8>>2]=g[O+8>>2],y&1?(xh(O),g[T>>2]=g[O>>2],g[T+4>>2]=g[O+4>>2],g[T+8>>2]=g[O+8>>2],Dl(T)):(fu(O),g[T>>2]=g[O>>2],g[T+4>>2]=g[O+4>>2],g[T+8>>2]=g[O+8>>2],Ys(T)),dr(w,T,M),br(M),m=(15-y|0)*3|0,f=ii(7,0,m|0)|0,b=b&~(Bt()|0),m=ii(Tc(M)|0,0,m|0)|0,_=m|_&~f,b=Bt()|0|b,(y|0)>1;)y=y+-1|0;else _=-1;t:do if((g[O>>2]|0)<=2&&(g[c+8>>2]|0)<=2&&(g[c+12>>2]|0)<=2){if(w=Po(c)|0,y=ii(w|0,0,45)|0,y=y|_,_=Bt()|0|b&-1040385,M=ho(c)|0,!(Si(w)|0)){if((M|0)<=0)break;for(T=0;;){if(w=Ke(y|0,_|0,52)|0,Bt()|0,w=w&15,w)for(b=1;m=(15-b|0)*3|0,c=Ke(y|0,_|0,m|0)|0,Bt()|0,f=ii(7,0,m|0)|0,_=_&~(Bt()|0),m=ii(Es(c&7)|0,0,m|0)|0,y=y&~f|m,_=_|(Bt()|0),b>>>0<w>>>0;)b=b+1|0;if(T=T+1|0,(T|0)==(M|0))break t}}T=Ke(y|0,_|0,52)|0,Bt()|0,T=T&15;e:do if(T){b=1;i:for(;;){switch(m=Ke(y|0,_|0,(15-b|0)*3|0)|0,Bt()|0,m&7){case 1:break i;case 0:break;default:break e}if(b>>>0<T>>>0)b=b+1|0;else break e}if(bh(w,g[c>>2]|0)|0)for(b=1;c=(15-b|0)*3|0,f=ii(7,0,c|0)|0,m=_&~(Bt()|0),_=Ke(y|0,_|0,c|0)|0,Bt()|0,_=ii(ss(_&7)|0,0,c|0)|0,y=y&~f|_,_=m|(Bt()|0),b>>>0<T>>>0;)b=b+1|0;else for(b=1;m=(15-b|0)*3|0,c=Ke(y|0,_|0,m|0)|0,Bt()|0,f=ii(7,0,m|0)|0,_=_&~(Bt()|0),m=ii(Es(c&7)|0,0,m|0)|0,y=y&~f|m,_=_|(Bt()|0),b>>>0<T>>>0;)b=b+1|0}while(!1);if((M|0)>0){b=0;do y=Pa(y,_)|0,_=Bt()|0,b=b+1|0;while((b|0)!=(M|0))}}else y=0,_=0;while(!1);return f=_,m=y,yi(f|0),Tt=d,m|0}function Jo(_){return _=_|0,(_|0)%2|0|0}function il(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0;return T=Tt,Tt=Tt+16|0,w=T,y>>>0>15?(w=4,Tt=T,w|0):(g[_+4>>2]&2146435072|0)==2146435072||(g[_+8+4>>2]&2146435072|0)==2146435072?(w=3,Tt=T,w|0):(Au(_,y,w),y=Fl(w,y)|0,w=Bt()|0,g[b>>2]=y,g[b+4>>2]=w,(y|0)==0&(w|0)==0&&Qe(23313,22674,786,22697),w=0,Tt=T,w|0)}function Xo(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0;if(T=b+4|0,M=Ke(_|0,y|0,52)|0,Bt()|0,M=M&15,O=Ke(_|0,y|0,45)|0,Bt()|0,w=(M|0)==0,Si(O&127)|0){if(w)return O=1,O|0;w=1}else{if(w)return O=0,O|0;(g[T>>2]|0)==0&&(g[b+8>>2]|0)==0?w=(g[b+12>>2]|0)!=0&1:w=1}for(b=1;b&1?Dl(T):Ys(T),O=Ke(_|0,y|0,(15-b|0)*3|0)|0,Bt()|0,wh(T,O&7),b>>>0<M>>>0;)b=b+1|0;return w|0}function nl(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0;if(m=Tt,Tt=Tt+16|0,d=m,f=Ke(_|0,y|0,45)|0,Bt()|0,f=f&127,f>>>0>121)return g[b>>2]=0,g[b+4>>2]=0,g[b+8>>2]=0,g[b+12>>2]=0,f=5,Tt=m,f|0;t:do if((Si(f)|0)!=0&&(M=Ke(_|0,y|0,52)|0,Bt()|0,M=M&15,(M|0)!=0)){w=1;e:for(;;){switch(c=Ke(_|0,y|0,(15-w|0)*3|0)|0,Bt()|0,c&7){case 5:break e;case 0:break;default:{w=y;break t}}if(w>>>0<M>>>0)w=w+1|0;else{w=y;break t}}for(T=1,w=y;y=(15-T|0)*3|0,O=ii(7,0,y|0)|0,c=w&~(Bt()|0),w=Ke(_|0,w|0,y|0)|0,Bt()|0,w=ii(ss(w&7)|0,0,y|0)|0,_=_&~O|w,w=c|(Bt()|0),T>>>0<M>>>0;)T=T+1|0}else w=y;while(!1);if(c=7696+(f*28|0)|0,g[b>>2]=g[c>>2],g[b+4>>2]=g[c+4>>2],g[b+8>>2]=g[c+8>>2],g[b+12>>2]=g[c+12>>2],!(Xo(_,w,b)|0))return f=0,Tt=m,f|0;if(O=b+4|0,g[d>>2]=g[O>>2],g[d+4>>2]=g[O+4>>2],g[d+8>>2]=g[O+8>>2],M=Ke(_|0,w|0,52)|0,Bt()|0,c=M&15,M&1?(Ys(O),M=c+1|0):M=c,!(Si(f)|0))w=0;else{t:do if(!c)w=0;else for(y=1;;){if(T=Ke(_|0,w|0,(15-y|0)*3|0)|0,Bt()|0,T=T&7,T|0){w=T;break t}if(y>>>0<c>>>0)y=y+1|0;else{w=0;break}}while(!1);w=(w|0)==4&1}if(!(as(b,M,w,0)|0))(M|0)!=(c|0)&&(g[O>>2]=g[d>>2],g[O+4>>2]=g[d+4>>2],g[O+8>>2]=g[d+8>>2]);else{if(Si(f)|0)do;while((as(b,M,0,0)|0)!=0);(M|0)!=(c|0)&&fu(O)}return f=0,Tt=m,f|0}function kl(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0;return M=Tt,Tt=Tt+16|0,w=M,T=nl(_,y,w)|0,T|0?(Tt=M,T|0):(T=Ke(_|0,y|0,52)|0,Bt()|0,Gf(w,T&15,b),T=0,Tt=M,T|0)}function Nl(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,c=0;if(O=Tt,Tt=Tt+16|0,M=O,w=nl(_,y,M)|0,w|0)return M=w,Tt=O,M|0;w=Ke(_|0,y|0,45)|0,Bt()|0,w=(Si(w&127)|0)==0,T=Ke(_|0,y|0,52)|0,Bt()|0,T=T&15;t:do if(!w){if(T|0)for(w=1;;){if(c=ii(7,0,(15-w|0)*3|0)|0,!((c&_|0)==0&((Bt()|0)&y|0)==0))break t;if(w>>>0<T>>>0)w=w+1|0;else break}return qs(M,T,0,5,b),c=0,Tt=O,c|0}while(!1);return gu(M,T,0,6,b),c=0,Tt=O,c|0}function rl(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0;if(T=Ke(_|0,y|0,45)|0,Bt()|0,!(Si(T&127)|0))return T=2,g[b>>2]=T,0;if(T=Ke(_|0,y|0,52)|0,Bt()|0,T=T&15,!T)return T=5,g[b>>2]=T,0;for(w=1;;){if(M=ii(7,0,(15-w|0)*3|0)|0,!((M&_|0)==0&((Bt()|0)&y|0)==0)){w=2,_=6;break}if(w>>>0<T>>>0)w=w+1|0;else{w=5,_=6;break}}return(_|0)==6&&(g[b>>2]=w),0}function Ul(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0;E=Tt,Tt=Tt+128|0,f=E+112|0,M=E+96|0,m=E,T=Ke(_|0,y|0,52)|0,Bt()|0,c=T&15,g[f>>2]=c,O=Ke(_|0,y|0,45)|0,Bt()|0,O=O&127;t:do if(Si(O)|0){if(c|0)for(w=1;;){if(d=ii(7,0,(15-w|0)*3|0)|0,!((d&_|0)==0&((Bt()|0)&y|0)==0)){T=0;break t}if(w>>>0<c>>>0)w=w+1|0;else break}if(T&1)T=1;else return d=ii(c+1|0,0,52)|0,m=Bt()|0|y&-15728641,f=ii(7,0,(14-c|0)*3|0)|0,m=Ul((d|_)&~f,m&~(Bt()|0),b)|0,Tt=E,m|0}else T=0;while(!1);if(w=nl(_,y,M)|0,!w){T?($s(M,f,m),d=5):(mu(M,f,m),d=6);t:do if(Si(O)|0)if(!c)_=5;else for(w=1;;){if(O=ii(7,0,(15-w|0)*3|0)|0,!((O&_|0)==0&((Bt()|0)&y|0)==0)){_=2;break t}if(w>>>0<c>>>0)w=w+1|0;else{_=5;break}}else _=2;while(!1);aa(b|0,-1,_<<2|0)|0;t:do if(T)for(M=0;;){if(O=m+(M<<4)|0,zf(O,g[f>>2]|0)|0,O=g[O>>2]|0,c=g[b>>2]|0,(c|0)==-1|(c|0)==(O|0))w=b;else{T=0;do{if(T=T+1|0,T>>>0>=_>>>0){w=1;break t}w=b+(T<<2)|0,c=g[w>>2]|0}while(!((c|0)==-1|(c|0)==(O|0)))}if(g[w>>2]=O,M=M+1|0,M>>>0>=d>>>0){w=0;break}}else for(M=0;;){if(O=m+(M<<4)|0,as(O,g[f>>2]|0,0,1)|0,O=g[O>>2]|0,c=g[b>>2]|0,(c|0)==-1|(c|0)==(O|0))w=b;else{T=0;do{if(T=T+1|0,T>>>0>=_>>>0){w=1;break t}w=b+(T<<2)|0,c=g[w>>2]|0}while(!((c|0)==-1|(c|0)==(O|0)))}if(g[w>>2]=O,M=M+1|0,M>>>0>=d>>>0){w=0;break}}while(!1)}return m=w,Tt=E,m|0}function vu(){return 12}function Mc(_,y){_=_|0,y=y|0;var b=0,w=0,T=0,M=0,O=0,c=0,d=0;if(_>>>0>15)return c=4,c|0;if(ii(_|0,0,52)|0,c=Bt()|0|134225919,!_){b=0,w=0;do Si(w)|0&&(ii(w|0,0,45)|0,O=c|(Bt()|0),_=y+(b<<3)|0,g[_>>2]=-1,g[_+4>>2]=O,b=b+1|0),w=w+1|0;while((w|0)!=122);return b=0,b|0}b=0,O=0;do{if(Si(O)|0){for(ii(O|0,0,45)|0,w=1,T=-1,M=c|(Bt()|0);d=ii(7,0,(15-w|0)*3|0)|0,T=T&~d,M=M&~(Bt()|0),(w|0)!=(_|0);)w=w+1|0;d=y+(b<<3)|0,g[d>>2]=T,g[d+4>>2]=M,b=b+1|0}O=O+1|0}while((O|0)!=122);return b=0,b|0}function bu(_,y,b,w){_=_|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,U=0,J=0,et=0,$=0;if($=Tt,Tt=Tt+16|0,J=$,et=Ke(_|0,y|0,52)|0,Bt()|0,et=et&15,b>>>0>15)return et=4,Tt=$,et|0;if((et|0)<(b|0))return et=12,Tt=$,et|0;if((et|0)!=(b|0))if(M=ii(b|0,0,52)|0,M=M|_,c=Bt()|0|y&-15728641,(et|0)>(b|0)){d=b;do U=ii(7,0,(14-d|0)*3|0)|0,d=d+1|0,M=U|M,c=Bt()|0|c;while((d|0)<(et|0));U=M}else U=M;else U=_,c=y;F=Ke(U|0,c|0,45)|0,Bt()|0;t:do if(Si(F&127)|0){if(d=Ke(U|0,c|0,52)|0,Bt()|0,d=d&15,d|0)for(M=1;;){if(F=ii(7,0,(15-M|0)*3|0)|0,!((F&U|0)==0&((Bt()|0)&c|0)==0)){f=33;break t}if(M>>>0<d>>>0)M=M+1|0;else break}if(F=w,g[F>>2]=0,g[F+4>>2]=0,(et|0)>(b|0)){for(F=y&-15728641,R=et;;){if(P=R,R=R+-1|0,R>>>0>15|(et|0)<(R|0)){f=19;break}if((et|0)!=(R|0))if(M=ii(R|0,0,52)|0,M=M|_,d=Bt()|0|F,(et|0)<(P|0))E=M;else{f=R;do E=ii(7,0,(14-f|0)*3|0)|0,f=f+1|0,M=E|M,d=Bt()|0|d;while((f|0)<(et|0));E=M}else E=_,d=y;if(m=Ke(E|0,d|0,45)|0,Bt()|0,!(Si(m&127)|0))M=0;else{m=Ke(E|0,d|0,52)|0,Bt()|0,m=m&15;e:do if(!m)M=0;else for(f=1;;){if(M=Ke(E|0,d|0,(15-f|0)*3|0)|0,Bt()|0,M=M&7,M|0)break e;if(f>>>0<m>>>0)f=f+1|0;else{M=0;break}}while(!1);M=(M|0)==0&1}if(d=Ke(_|0,y|0,(15-P|0)*3|0)|0,Bt()|0,d=d&7,(d|0)==7){T=5,f=42;break}if(M=(M|0)!=0,(d|0)==1&M){T=5,f=42;break}if(E=d+(((d|0)!=0&M)<<31>>31)|0,E|0&&(f=et-P|0,f=Qo(7,0,f,((f|0)<0)<<31>>31)|0,m=Bt()|0,M?(M=pr(f|0,m|0,5,0)|0,M=pn(M|0,Bt()|0,-5,-1)|0,M=Zo(M|0,Bt()|0,6,0)|0,M=pn(M|0,Bt()|0,1,0)|0,d=Bt()|0):(M=f,d=m),P=E+-1|0,P=pr(f|0,m|0,P|0,((P|0)<0)<<31>>31|0)|0,P=pn(M|0,d|0,P|0,Bt()|0)|0,E=Bt()|0,m=w,m=pn(P|0,E|0,g[m>>2]|0,g[m+4>>2]|0)|0,E=Bt()|0,P=w,g[P>>2]=m,g[P+4>>2]=E),(R|0)<=(b|0)){f=37;break}}if((f|0)==19)Qe(23313,22674,1099,22710);else if((f|0)==37){O=w,T=g[O+4>>2]|0,O=g[O>>2]|0;break}else if((f|0)==42)return Tt=$,T|0}else T=0,O=0}else f=33;while(!1);t:do if((f|0)==33)if(F=w,g[F>>2]=0,g[F+4>>2]=0,(et|0)>(b|0)){for(M=et;;){if(T=Ke(_|0,y|0,(15-M|0)*3|0)|0,Bt()|0,T=T&7,(T|0)==7){T=5;break}if(O=et-M|0,O=Qo(7,0,O,((O|0)<0)<<31>>31)|0,T=pr(O|0,Bt()|0,T|0,0)|0,O=Bt()|0,F=w,O=pn(g[F>>2]|0,g[F+4>>2]|0,T|0,O|0)|0,T=Bt()|0,F=w,g[F>>2]=O,g[F+4>>2]=T,M=M+-1|0,(M|0)<=(b|0))break t}return Tt=$,T|0}else T=0,O=0;while(!1);return Ic(U,c,et,J)|0&&Qe(23313,22674,1063,22725),et=J,J=g[et+4>>2]|0,((T|0)>-1|(T|0)==-1&O>>>0>4294967295)&((J|0)>(T|0)|((J|0)==(T|0)?(g[et>>2]|0)>>>0>O>>>0:0))?(et=0,Tt=$,et|0):(Qe(23313,22674,1139,22710),0)}function hA(_,y,b,w,T,M){_=_|0,y=y|0,b=b|0,w=w|0,T=T|0,M=M|0;var O=0,c=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,U=0;if(E=Tt,Tt=Tt+16|0,O=E,T>>>0>15)return M=4,Tt=E,M|0;if(c=Ke(b|0,w|0,52)|0,Bt()|0,c=c&15,(c|0)>(T|0))return M=12,Tt=E,M|0;if(Ic(b,w,T,O)|0&&Qe(23313,22674,1063,22725),m=O,f=g[m+4>>2]|0,!(((y|0)>-1|(y|0)==-1&_>>>0>4294967295)&((f|0)>(y|0)|((f|0)==(y|0)?(g[m>>2]|0)>>>0>_>>>0:0))))return M=2,Tt=E,M|0;m=T-c|0,T=ii(T|0,0,52)|0,d=Bt()|0|w&-15728641,f=M,g[f>>2]=T|b,g[f+4>>2]=d,f=Ke(b|0,w|0,45)|0,Bt()|0;t:do if(Si(f&127)|0){if(c|0)for(O=1;;){if(f=ii(7,0,(15-O|0)*3|0)|0,!((f&b|0)==0&((Bt()|0)&w|0)==0))break t;if(O>>>0<c>>>0)O=O+1|0;else break}if((m|0)<1)return M=0,Tt=E,M|0;for(f=c^15,w=-1,d=1,O=1;;){c=m-d|0,c=Qo(7,0,c,((c|0)<0)<<31>>31)|0,b=Bt()|0;do if(O)if(O=pr(c|0,b|0,5,0)|0,O=pn(O|0,Bt()|0,-5,-1)|0,O=Zo(O|0,Bt()|0,6,0)|0,T=Bt()|0,(y|0)>(T|0)|(y|0)==(T|0)&_>>>0>O>>>0){y=pn(_|0,y|0,-1,-1)|0,y=Ki(y|0,Bt()|0,O|0,T|0)|0,O=Bt()|0,P=M,F=g[P>>2]|0,P=g[P+4>>2]|0,U=(f+w|0)*3|0,R=ii(7,0,U|0)|0,P=P&~(Bt()|0),w=Zo(y|0,O|0,c|0,b|0)|0,_=Bt()|0,T=pn(w|0,_|0,2,0)|0,U=ii(T|0,Bt()|0,U|0)|0,P=Bt()|0|P,T=M,g[T>>2]=U|F&~R,g[T+4>>2]=P,_=pr(w|0,_|0,c|0,b|0)|0,_=Ki(y|0,O|0,_|0,Bt()|0)|0,O=0,y=Bt()|0;break}else{U=M,R=g[U>>2]|0,U=g[U+4>>2]|0,F=ii(7,0,(f+w|0)*3|0)|0,U=U&~(Bt()|0),O=M,g[O>>2]=R&~F,g[O+4>>2]=U,O=1;break}else R=M,T=g[R>>2]|0,R=g[R+4>>2]|0,w=(f+w|0)*3|0,P=ii(7,0,w|0)|0,R=R&~(Bt()|0),U=Zo(_|0,y|0,c|0,b|0)|0,O=Bt()|0,w=ii(U|0,O|0,w|0)|0,R=Bt()|0|R,F=M,g[F>>2]=w|T&~P,g[F+4>>2]=R,O=pr(U|0,O|0,c|0,b|0)|0,_=Ki(_|0,y|0,O|0,Bt()|0)|0,O=0,y=Bt()|0;while(!1);if((m|0)>(d|0))w=~d,d=d+1|0;else{y=0;break}}return Tt=E,y|0}while(!1);if((m|0)<1)return U=0,Tt=E,U|0;for(T=c^15,O=1;;)if(F=m-O|0,F=Qo(7,0,F,((F|0)<0)<<31>>31)|0,U=Bt()|0,d=M,b=g[d>>2]|0,d=g[d+4>>2]|0,c=(T-O|0)*3|0,w=ii(7,0,c|0)|0,d=d&~(Bt()|0),P=Zo(_|0,y|0,F|0,U|0)|0,R=Bt()|0,c=ii(P|0,R|0,c|0)|0,d=Bt()|0|d,f=M,g[f>>2]=c|b&~w,g[f+4>>2]=d,U=pr(P|0,R|0,F|0,U|0)|0,_=Ki(_|0,y|0,U|0,Bt()|0)|0,y=Bt()|0,(m|0)<=(O|0)){y=0;break}else O=O+1|0;return Tt=E,y|0}function Pc(_,y,b,w){_=_|0,y=y|0,b=b|0,w=w|0;var T=0,M=0;T=Ke(y|0,b|0,52)|0,Bt()|0,T=T&15,(y|0)==0&(b|0)==0|((w|0)>15|(T|0)>(w|0))?(w=-1,T=-1,y=0,b=0):(M=yu(y,b,T+1|0,w)|0,b=(Bt()|0)&-15728641,y=ii(w|0,0,52)|0,y=M|y,b=b|(Bt()|0),M=(On(y,b)|0)==0,w=M?-1:w),M=_,g[M>>2]=y,g[M+4>>2]=b,g[_+8>>2]=T,g[_+12>>2]=w}function xu(_){_=_|0;var y=0,b=0,w=0,T=0,M=0,O=0,c=0,d=0,f=0;if(b=_,y=g[b>>2]|0,b=g[b+4>>2]|0,!((y|0)==0&(b|0)==0)&&(w=Ke(y|0,b|0,52)|0,Bt()|0,w=w&15,c=ii(1,0,(w^15)*3|0)|0,y=pn(c|0,Bt()|0,y|0,b|0)|0,b=Bt()|0,c=_,g[c>>2]=y,g[c+4>>2]=b,c=_+8|0,O=g[c>>2]|0,!((w|0)<(O|0)))){for(d=_+12|0,M=w;;){if((M|0)==(O|0)){w=5;break}if(f=(M|0)==(g[d>>2]|0),T=(15-M|0)*3|0,w=Ke(y|0,b|0,T|0)|0,Bt()|0,w=w&7,f&((w|0)==1&!0)){w=7;break}if(!((w|0)==7&!0)){w=10;break}if(f=ii(1,0,T|0)|0,y=pn(y|0,b|0,f|0,Bt()|0)|0,b=Bt()|0,f=_,g[f>>2]=y,g[f+4>>2]=b,(M|0)>(O|0))M=M+-1|0;else{w=10;break}}if((w|0)==5){f=_,g[f>>2]=0,g[f+4>>2]=0,g[c>>2]=-1,g[d>>2]=-1;return}else if((w|0)==7){O=ii(1,0,T|0)|0,O=pn(y|0,b|0,O|0,Bt()|0)|0,c=Bt()|0,f=_,g[f>>2]=O,g[f+4>>2]=c,g[d>>2]=M+-1;return}else if((w|0)==10)return}}function Gl(_){_=+_;var y=0;return y=_<0?_+6.283185307179586:_,+(_>=6.283185307179586?y+-6.283185307179586:y)}function ol(_,y){return _=_|0,y=y|0,+Re(+(+ut[_>>3]-+ut[y>>3]))<17453292519943298e-27?(y=+Re(+(+ut[_+8>>3]-+ut[y+8>>3]))<17453292519943298e-27,y|0):(y=0,y|0)}function wu(_,y){_=_|0,y=y|0;var b=0,w=0,T=0,M=0;return T=+ut[y>>3],w=+ut[_>>3],M=+Me(+((T-w)*.5)),b=+Me(+((+ut[y+8>>3]-+ut[_+8>>3])*.5)),b=M*M+b*(+ke(+T)*+ke(+w)*b),+(+ln(+ +Fe(+b),+ +Fe(+(1-b)))*2)}function sl(_,y){_=_|0,y=y|0;var b=0,w=0,T=0,M=0;return T=+ut[y>>3],w=+ut[_>>3],M=+Me(+((T-w)*.5)),b=+Me(+((+ut[y+8>>3]-+ut[_+8>>3])*.5)),b=M*M+b*(+ke(+T)*+ke(+w)*b),+(+ln(+ +Fe(+b),+ +Fe(+(1-b)))*2*6371.007180918475)}function Th(_,y){_=_|0,y=y|0;var b=0,w=0,T=0,M=0;return T=+ut[y>>3],w=+ut[_>>3],M=+Me(+((T-w)*.5)),b=+Me(+((+ut[y+8>>3]-+ut[_+8>>3])*.5)),b=M*M+b*(+ke(+T)*+ke(+w)*b),+(+ln(+ +Fe(+b),+ +Fe(+(1-b)))*2*6371.007180918475*1e3)}function Sh(_,y){_=_|0,y=y|0;var b=0,w=0,T=0,M=0,O=0;return M=+ut[y>>3],w=+ke(+M),T=+ut[y+8>>3]-+ut[_+8>>3],O=w*+Me(+T),b=+ut[_>>3],+ +ln(+O,+(+Me(+M)*+ke(+b)-+ke(+T)*(w*+Me(+b))))}function Rc(_,y,b,w){_=_|0,y=+y,b=+b,w=w|0;var T=0,M=0,O=0,c=0;if(b<1e-16){g[w>>2]=g[_>>2],g[w+4>>2]=g[_+4>>2],g[w+8>>2]=g[_+8>>2],g[w+12>>2]=g[_+12>>2];return}M=y<0?y+6.283185307179586:y,M=y>=6.283185307179586?M+-6.283185307179586:M;do if(M<1e-16)y=+ut[_>>3]+b,ut[w>>3]=y,T=w;else{if(T=+Re(+(M+-3.141592653589793))<1e-16,y=+ut[_>>3],T){y=y-b,ut[w>>3]=y,T=w;break}if(O=+ke(+b),b=+Me(+b),y=O*+Me(+y)+ +ke(+M)*(b*+ke(+y)),y=y>1?1:y,y=+ei(+(y<-1?-1:y)),ut[w>>3]=y,+Re(+(y+-1.5707963267948966))<1e-16){ut[w>>3]=1.5707963267948966,ut[w+8>>3]=0;return}if(+Re(+(y+1.5707963267948966))<1e-16){ut[w>>3]=-1.5707963267948966,ut[w+8>>3]=0;return}if(c=+ke(+y),M=b*+Me(+M)/c,b=+ut[_>>3],y=(O-+Me(+y)*+Me(+b))/+ke(+b)/c,O=M>1?1:M,y=y>1?1:y,y=+ut[_+8>>3]+ +ln(+(O<-1?-1:O),+(y<-1?-1:y)),y>3.141592653589793)do y=y+-6.283185307179586;while(y>3.141592653589793);if(y<-3.141592653589793)do y=y+6.283185307179586;while(y<-3.141592653589793);ut[w+8>>3]=y;return}while(!1);if(+Re(+(y+-1.5707963267948966))<1e-16){ut[T>>3]=1.5707963267948966,ut[w+8>>3]=0;return}if(+Re(+(y+1.5707963267948966))<1e-16){ut[T>>3]=-1.5707963267948966,ut[w+8>>3]=0;return}if(y=+ut[_+8>>3],y>3.141592653589793)do y=y+-6.283185307179586;while(y>3.141592653589793);if(y<-3.141592653589793)do y=y+6.283185307179586;while(y<-3.141592653589793);ut[w+8>>3]=y}function Hf(_,y){return _=_|0,y=y|0,_>>>0>15?(y=4,y|0):(ut[y>>3]=+ut[20528+(_<<3)>>3],y=0,y|0)}function al(_,y){return _=_|0,y=y|0,_>>>0>15?(y=4,y|0):(ut[y>>3]=+ut[20656+(_<<3)>>3],y=0,y|0)}function Kn(_,y){return _=_|0,y=y|0,_>>>0>15?(y=4,y|0):(ut[y>>3]=+ut[20784+(_<<3)>>3],y=0,y|0)}function Cu(_,y){return _=_|0,y=y|0,_>>>0>15?(y=4,y|0):(ut[y>>3]=+ut[20912+(_<<3)>>3],y=0,y|0)}function ia(_,y){_=_|0,y=y|0;var b=0;return _>>>0>15?(y=4,y|0):(b=Qo(7,0,_,((_|0)<0)<<31>>31)|0,b=pr(b|0,Bt()|0,120,0)|0,_=Bt()|0,g[y>>2]=b|2,g[y+4>>2]=_,y=0,y|0)}function na(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0;return P=+ut[y>>3],m=+ut[_>>3],d=+Me(+((P-m)*.5)),M=+ut[y+8>>3],f=+ut[_+8>>3],O=+Me(+((M-f)*.5)),c=+ke(+m),E=+ke(+P),O=d*d+O*(E*c*O),O=+ln(+ +Fe(+O),+ +Fe(+(1-O)))*2,d=+ut[b>>3],P=+Me(+((d-P)*.5)),w=+ut[b+8>>3],M=+Me(+((w-M)*.5)),T=+ke(+d),M=P*P+M*(E*T*M),M=+ln(+ +Fe(+M),+ +Fe(+(1-M)))*2,d=+Me(+((m-d)*.5)),w=+Me(+((f-w)*.5)),w=d*d+w*(c*T*w),w=+ln(+ +Fe(+w),+ +Fe(+(1-w)))*2,T=(O+M+w)*.5,+(+$i(+ +Fe(+(+He(+(T*.5))*+He(+((T-O)*.5))*+He(+((T-M)*.5))*+He(+((T-w)*.5)))))*4)}function un(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,c=0;if(c=Tt,Tt=Tt+192|0,M=c+168|0,O=c,T=kl(_,y,M)|0,T|0)return b=T,Tt=c,b|0;if(Nl(_,y,O)|0&&Qe(23313,22742,386,22751),y=g[O>>2]|0,(y|0)>0){if(w=+na(O+8|0,O+8+(((y|0)!=1&1)<<4)|0,M)+0,(y|0)!=1){_=1;do T=_,_=_+1|0,w=w+ +na(O+8+(T<<4)|0,O+8+(((_|0)%(y|0)|0)<<4)|0,M);while((_|0)<(y|0))}}else w=0;return ut[b>>3]=w,b=0,Tt=c,b|0}function Un(_,y,b){return _=_|0,y=y|0,b=b|0,_=un(_,y,b)|0,_|0||(ut[b>>3]=+ut[b>>3]*6371.007180918475*6371.007180918475),_|0}function Ko(_,y,b){return _=_|0,y=y|0,b=b|0,_=un(_,y,b)|0,_|0||(ut[b>>3]=+ut[b>>3]*6371.007180918475*6371.007180918475*1e3*1e3),_|0}function Dc(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0;if(c=Tt,Tt=Tt+176|0,O=c,_=pu(_,y,O)|0,_|0)return O=_,Tt=c,O|0;if(ut[b>>3]=0,_=g[O>>2]|0,(_|0)<=1)return O=0,Tt=c,O|0;y=_+-1|0,_=0,w=+ut[O+8>>3],T=+ut[O+16>>3],M=0;do _=_+1|0,f=w,w=+ut[O+8+(_<<4)>>3],m=+Me(+((w-f)*.5)),d=T,T=+ut[O+8+(_<<4)+8>>3],d=+Me(+((T-d)*.5)),d=m*m+d*(+ke(+w)*+ke(+f)*d),M=M+ +ln(+ +Fe(+d),+ +Fe(+(1-d)))*2;while((_|0)<(y|0));return ut[b>>3]=M,O=0,Tt=c,O|0}function zl(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0;if(c=Tt,Tt=Tt+176|0,O=c,_=pu(_,y,O)|0,_|0)return O=_,M=+ut[b>>3],M=M*6371.007180918475,ut[b>>3]=M,Tt=c,O|0;if(ut[b>>3]=0,_=g[O>>2]|0,(_|0)<=1)return O=0,M=0,M=M*6371.007180918475,ut[b>>3]=M,Tt=c,O|0;y=_+-1|0,_=0,w=+ut[O+8>>3],T=+ut[O+16>>3],M=0;do _=_+1|0,f=w,w=+ut[O+8+(_<<4)>>3],m=+Me(+((w-f)*.5)),d=T,T=+ut[O+8+(_<<4)+8>>3],d=+Me(+((T-d)*.5)),d=m*m+d*(+ke(+f)*+ke(+w)*d),M=M+ +ln(+ +Fe(+d),+ +Fe(+(1-d)))*2;while((_|0)!=(y|0));return ut[b>>3]=M,O=0,m=M,m=m*6371.007180918475,ut[b>>3]=m,Tt=c,O|0}function Oc(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0;if(c=Tt,Tt=Tt+176|0,O=c,_=pu(_,y,O)|0,_|0)return O=_,M=+ut[b>>3],M=M*6371.007180918475,M=M*1e3,ut[b>>3]=M,Tt=c,O|0;if(ut[b>>3]=0,_=g[O>>2]|0,(_|0)<=1)return O=0,M=0,M=M*6371.007180918475,M=M*1e3,ut[b>>3]=M,Tt=c,O|0;y=_+-1|0,_=0,w=+ut[O+8>>3],T=+ut[O+16>>3],M=0;do _=_+1|0,f=w,w=+ut[O+8+(_<<4)>>3],m=+Me(+((w-f)*.5)),d=T,T=+ut[O+8+(_<<4)+8>>3],d=+Me(+((T-d)*.5)),d=m*m+d*(+ke(+f)*+ke(+w)*d),M=M+ +ln(+ +Fe(+d),+ +Fe(+(1-d)))*2;while((_|0)!=(y|0));return ut[b>>3]=M,O=0,m=M,m=m*6371.007180918475,m=m*1e3,ut[b>>3]=m,Tt=c,O|0}function fA(_){_=_|0;var y=0,b=0,w=0;return y=fs(1,12)|0,y||Qe(22832,22787,49,22845),b=_+4|0,w=g[b>>2]|0,w|0?(w=w+8|0,g[w>>2]=y,g[b>>2]=y,y|0):(g[_>>2]|0&&Qe(22862,22787,61,22885),w=_,g[w>>2]=y,g[b>>2]=y,y|0)}function dA(_,y){_=_|0,y=y|0;var b=0,w=0;return w=Qn(24)|0,w||Qe(22899,22787,78,22913),g[w>>2]=g[y>>2],g[w+4>>2]=g[y+4>>2],g[w+8>>2]=g[y+8>>2],g[w+12>>2]=g[y+12>>2],g[w+16>>2]=0,y=_+4|0,b=g[y>>2]|0,b|0?(g[b+16>>2]=w,g[y>>2]=w,w|0):(g[_>>2]|0&&Qe(22928,22787,82,22913),g[_>>2]=w,g[y>>2]=w,w|0)}function Vl(_){_=_|0;var y=0,b=0,w=0,T=0;if(_)for(w=1;;){if(y=g[_>>2]|0,y|0)do{if(b=g[y>>2]|0,b|0)do T=b,b=g[b+16>>2]|0,Ni(T);while((b|0)!=0);T=y,y=g[y+8>>2]|0,Ni(T)}while((y|0)!=0);if(y=_,_=g[_+8>>2]|0,w||Ni(y),_)w=0;else break}}function Lc(_){_=_|0;var y=0,b=0,w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,U=0,J=0,et=0,$=0,it=0,st=0,xt=0,Rt=0,yt=0,It=0,Ht=0,Xt=0,ee=0,Qt=0,$t=0,Ae=0,Le=0,we=0;if(T=_+8|0,g[T>>2]|0)return we=1,we|0;if(w=g[_>>2]|0,!w)return we=0,we|0;y=w,b=0;do b=b+1|0,y=g[y+8>>2]|0;while((y|0)!=0);if(b>>>0<2)return we=0,we|0;Ae=Qn(b<<2)|0,Ae||Qe(22948,22787,317,22967),$t=Qn(b<<5)|0,$t||Qe(22989,22787,321,22967),g[_>>2]=0,Rt=_+4|0,g[Rt>>2]=0,g[T>>2]=0,b=0,Qt=0,xt=0,E=0;t:for(;;){if(m=g[w>>2]|0,m){M=0,O=m;do{if(d=+ut[O+8>>3],y=O,O=g[O+16>>2]|0,f=(O|0)==0,T=f?m:O,c=+ut[T+8>>3],+Re(+(d-c))>3.141592653589793){we=14;break}M=M+(c-d)*(+ut[y>>3]+ +ut[T>>3])}while(!f);if((we|0)==14){we=0,M=0,y=m;do st=+ut[y+8>>3],ee=y+16|0,Xt=g[ee>>2]|0,Xt=(Xt|0)==0?m:Xt,it=+ut[Xt+8>>3],M=M+(+ut[y>>3]+ +ut[Xt>>3])*((it<0?it+6.283185307179586:it)-(st<0?st+6.283185307179586:st)),y=g[((y|0)==0?w:ee)>>2]|0;while((y|0)!=0)}M>0?(g[Ae+(Qt<<2)>>2]=w,Qt=Qt+1|0,T=xt,y=E):we=19}else we=19;if((we|0)==19){we=0;do if(b){if(y=b+8|0,g[y>>2]|0){we=21;break t}if(b=fs(1,12)|0,!b){we=23;break t}g[y>>2]=b,T=b+4|0,O=b,y=E}else if(E){T=Rt,O=E+8|0,y=w,b=_;break}else if(g[_>>2]|0){we=27;break t}else{T=Rt,O=_,y=w,b=_;break}while(!1);if(g[O>>2]=w,g[T>>2]=w,O=$t+(xt<<5)|0,f=g[w>>2]|0,f){for(m=$t+(xt<<5)+8|0,ut[m>>3]=17976931348623157e292,E=$t+(xt<<5)+24|0,ut[E>>3]=17976931348623157e292,ut[O>>3]=-17976931348623157e292,P=$t+(xt<<5)+16|0,ut[P>>3]=-17976931348623157e292,et=17976931348623157e292,$=-17976931348623157e292,T=0,R=f,d=17976931348623157e292,U=17976931348623157e292,J=-17976931348623157e292,c=-17976931348623157e292;M=+ut[R>>3],st=+ut[R+8>>3],R=g[R+16>>2]|0,F=(R|0)==0,it=+ut[(F?f:R)+8>>3],M<d&&(ut[m>>3]=M,d=M),st<U&&(ut[E>>3]=st,U=st),M>J?ut[O>>3]=M:M=J,st>c&&(ut[P>>3]=st,c=st),et=st>0&st<et?st:et,$=st<0&st>$?st:$,T=T|+Re(+(st-it))>3.141592653589793,!F;)J=M;T&&(ut[P>>3]=$,ut[E>>3]=et)}else g[O>>2]=0,g[O+4>>2]=0,g[O+8>>2]=0,g[O+12>>2]=0,g[O+16>>2]=0,g[O+20>>2]=0,g[O+24>>2]=0,g[O+28>>2]=0;T=xt+1|0}if(ee=w+8|0,w=g[ee>>2]|0,g[ee>>2]=0,w)xt=T,E=y;else{we=45;break}}if((we|0)==21)Qe(22765,22787,35,22799);else if((we|0)==23)Qe(22819,22787,37,22799);else if((we|0)==27)Qe(22862,22787,61,22885);else if((we|0)==45){t:do if((Qt|0)>0){for(ee=(T|0)==0,Ht=T<<2,Xt=(_|0)==0,It=0,y=0;;){if(yt=g[Ae+(It<<2)>>2]|0,ee)we=73;else{if(xt=Qn(Ht)|0,!xt){we=50;break}if(Rt=Qn(Ht)|0,!Rt){we=52;break}e:do if(Xt)b=0;else{for(T=0,b=0,O=_;w=$t+(T<<5)|0,Fs(g[O>>2]|0,w,g[yt>>2]|0)|0?(g[xt+(b<<2)>>2]=O,g[Rt+(b<<2)>>2]=w,F=b+1|0):F=b,O=g[O+8>>2]|0,O;)T=T+1|0,b=F;if((F|0)>0)if(w=g[xt>>2]|0,(F|0)==1)b=w;else for(P=0,R=-1,b=w,E=w;;){for(f=g[E>>2]|0,w=0,O=0;T=g[g[xt+(O<<2)>>2]>>2]|0,(T|0)==(f|0)?m=w:m=w+((Fs(T,g[Rt+(O<<2)>>2]|0,g[f>>2]|0)|0)&1)|0,O=O+1|0,(O|0)!=(F|0);)w=m;if(T=(m|0)>(R|0),b=T?E:b,w=P+1|0,(w|0)==(F|0))break e;P=w,R=T?m:R,E=g[xt+(w<<2)>>2]|0}else b=0}while(!1);if(Ni(xt),Ni(Rt),b){if(T=b+4|0,w=g[T>>2]|0,w)b=w+8|0;else if(g[b>>2]|0){we=70;break}g[b>>2]=yt,g[T>>2]=yt}else we=73}if((we|0)==73){if(we=0,y=g[yt>>2]|0,y|0)do Rt=y,y=g[y+16>>2]|0,Ni(Rt);while((y|0)!=0);Ni(yt),y=1}if(It=It+1|0,(It|0)>=(Qt|0)){Le=y;break t}}(we|0)==50?Qe(23004,22787,249,23023):(we|0)==52?Qe(23042,22787,252,23023):(we|0)==70&&Qe(22862,22787,61,22885)}else Le=0;while(!1);return Ni(Ae),Ni($t),we=Le,we|0}return 0}function Fs(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0;if(!(Wo(y,b)|0)||(y=Bc(y)|0,w=+ut[b>>3],T=+ut[b+8>>3],T=y&T<0?T+6.283185307179586:T,_=g[_>>2]|0,!_))return _=0,_|0;if(y){y=0,f=T,b=_;t:for(;;){for(;O=+ut[b>>3],T=+ut[b+8>>3],b=b+16|0,m=g[b>>2]|0,m=(m|0)==0?_:m,M=+ut[m>>3],c=+ut[m+8>>3],O>M?(d=O,O=c):(d=M,M=O,O=T,T=c),w=w==M|w==d?w+2220446049250313e-31:w,!!(w<M|w>d);)if(b=g[b>>2]|0,!b){b=22;break t}if(c=O<0?O+6.283185307179586:O,O=T<0?T+6.283185307179586:T,f=c==f|O==f?f+-2220446049250313e-31:f,d=c+(O-c)*((w-M)/(d-M)),(d<0?d+6.283185307179586:d)>f&&(y=y^1),b=g[b>>2]|0,!b){b=22;break}}if((b|0)==22)return y|0}else{y=0,f=T,b=_;t:for(;;){for(;O=+ut[b>>3],T=+ut[b+8>>3],b=b+16|0,m=g[b>>2]|0,m=(m|0)==0?_:m,M=+ut[m>>3],c=+ut[m+8>>3],O>M?(d=O,O=c):(d=M,M=O,O=T,T=c),w=w==M|w==d?w+2220446049250313e-31:w,!!(w<M|w>d);)if(b=g[b>>2]|0,!b){b=22;break t}if(f=O==f|T==f?f+-2220446049250313e-31:f,O+(T-O)*((w-M)/(d-M))>f&&(y=y^1),b=g[b>>2]|0,!b){b=22;break}}if((b|0)==22)return y|0}return 0}function Gn(_,y,b,w,T){_=_|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,U=0,J=0,et=0,$=0;if($=Tt,Tt=Tt+32|0,et=$+16|0,J=$,M=Ke(_|0,y|0,52)|0,Bt()|0,M=M&15,R=Ke(b|0,w|0,52)|0,Bt()|0,(M|0)!=(R&15|0))return et=12,Tt=$,et|0;if(f=Ke(_|0,y|0,45)|0,Bt()|0,f=f&127,m=Ke(b|0,w|0,45)|0,Bt()|0,m=m&127,f>>>0>121|m>>>0>121)return et=5,Tt=$,et|0;if(R=(f|0)!=(m|0),R){if(c=Cc(f,m)|0,(c|0)==7)return et=1,Tt=$,et|0;d=Cc(m,f)|0,(d|0)==7?Qe(23066,23090,161,23100):(F=c,O=d)}else F=0,O=0;E=Si(f)|0,P=Si(m)|0,g[et>>2]=0,g[et+4>>2]=0,g[et+8>>2]=0,g[et+12>>2]=0;do if(F){if(m=g[4272+(f*28|0)+(F<<2)>>2]|0,c=(m|0)>0,P)if(c){f=0,d=b,c=w;do d=_u(d,c)|0,c=Bt()|0,O=ss(O)|0,(O|0)==1&&(O=ss(1)|0),f=f+1|0;while((f|0)!=(m|0));m=O,f=d,d=c}else m=O,f=b,d=w;else if(c){f=0,d=b,c=w;do d=el(d,c)|0,c=Bt()|0,O=ss(O)|0,f=f+1|0;while((f|0)!=(m|0));m=O,f=d,d=c}else m=O,f=b,d=w;if(Xo(f,d,et)|0,R||Qe(23115,23090,191,23100),c=(E|0)!=0,O=(P|0)!=0,c&O&&Qe(23142,23090,192,23100),c){if(O=io(_,y)|0,(O|0)==7){M=5;break}if(Et[21872+(O*7|0)+F>>0]|0){M=1;break}d=g[21040+(O*28|0)+(F<<2)>>2]|0,f=d}else if(O){if(O=io(f,d)|0,(O|0)==7){M=5;break}if(Et[21872+(O*7|0)+m>>0]|0){M=1;break}f=0,d=g[21040+(m*28|0)+(O<<2)>>2]|0}else f=0,d=0;if((f|d|0)<0)M=5;else{if((d|0)>0){c=et+4|0,O=0;do du(c),O=O+1|0;while((O|0)!=(d|0))}if(g[J>>2]=0,g[J+4>>2]=0,g[J+8>>2]=0,wh(J,F),M|0)for(;Jo(M)|0?Dl(J):Ys(J),(M|0)>1;)M=M+-1|0;if((f|0)>0){M=0;do du(J),M=M+1|0;while((M|0)!=(f|0))}U=et+4|0,jn(U,J,U),br(U),U=51}}else if(Xo(b,w,et)|0,(E|0)!=0&(P|0)!=0)if((m|0)!=(f|0)&&Qe(23173,23090,261,23100),O=io(_,y)|0,M=io(b,w)|0,(O|0)==7|(M|0)==7)M=5;else if(Et[21872+(O*7|0)+M>>0]|0)M=1;else if(O=g[21040+(O*28|0)+(M<<2)>>2]|0,(O|0)>0){c=et+4|0,M=0;do du(c),M=M+1|0;while((M|0)!=(O|0));U=51}else U=51;else U=51;while(!1);return(U|0)==51&&(M=et+4|0,g[T>>2]=g[M>>2],g[T+4>>2]=g[M+4>>2],g[T+8>>2]=g[M+8>>2],M=0),et=M,Tt=$,et|0}function jl(_,y,b,w){_=_|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,U=0,J=0,et=0,$=0,it=0;if(U=Tt,Tt=Tt+48|0,f=U+36|0,O=U+24|0,c=U+12|0,d=U,T=Ke(_|0,y|0,52)|0,Bt()|0,T=T&15,P=Ke(_|0,y|0,45)|0,Bt()|0,P=P&127,P>>>0>121)return w=5,Tt=U,w|0;if(m=Si(P)|0,ii(T|0,0,52)|0,J=Bt()|0|134225919,M=w,g[M>>2]=-1,g[M+4>>2]=J,!T)return T=Tc(b)|0,(T|0)==7||(T=wa(P,T)|0,(T|0)==127)?(J=1,Tt=U,J|0):(R=ii(T|0,0,45)|0,F=Bt()|0,P=w,F=g[P+4>>2]&-1040385|F,J=w,g[J>>2]=g[P>>2]|R,g[J+4>>2]=F,J=0,Tt=U,J|0);for(g[f>>2]=g[b>>2],g[f+4>>2]=g[b+4>>2],g[f+8>>2]=g[b+8>>2],b=T;;){if(M=b,b=b+-1|0,g[O>>2]=g[f>>2],g[O+4>>2]=g[f+4>>2],g[O+8>>2]=g[f+8>>2],Jo(M)|0){if(T=aA(f)|0,T|0){b=13;break}g[c>>2]=g[f>>2],g[c+4>>2]=g[f+4>>2],g[c+8>>2]=g[f+8>>2],Dl(c)}else{if(T=lA(f)|0,T|0){b=13;break}g[c>>2]=g[f>>2],g[c+4>>2]=g[f+4>>2],g[c+8>>2]=g[f+8>>2],Ys(c)}if(dr(O,c,d),br(d),T=w,$=g[T>>2]|0,T=g[T+4>>2]|0,it=(15-M|0)*3|0,et=ii(7,0,it|0)|0,T=T&~(Bt()|0),it=ii(Tc(d)|0,0,it|0)|0,T=Bt()|0|T,J=w,g[J>>2]=it|$&~et,g[J+4>>2]=T,(M|0)<=1){b=14;break}}t:do if((b|0)!=13&&(b|0)==14)if((g[f>>2]|0)<=1&&(g[f+4>>2]|0)<=1&&(g[f+8>>2]|0)<=1){b=Tc(f)|0,T=wa(P,b)|0,(T|0)==127?d=0:d=Si(T)|0;e:do if(b){if(m){if(T=io(_,y)|0,(T|0)==7){T=5;break t}if(M=g[21248+(T*28|0)+(b<<2)>>2]|0,(M|0)>0){T=b,b=0;do T=Es(T)|0,b=b+1|0;while((b|0)!=(M|0))}else T=b;if((T|0)==1){T=9;break t}b=wa(P,T)|0,(b|0)==127&&Qe(23200,23090,411,23230),Si(b)|0?Qe(23245,23090,412,23230):(F=b,R=M,E=T)}else F=T,R=0,E=b;if(c=g[4272+(P*28|0)+(E<<2)>>2]|0,(c|0)<=-1&&Qe(23276,23090,419,23230),!d){if((R|0)<0){T=5;break t}if(R|0){M=w,T=0,b=g[M>>2]|0,M=g[M+4>>2]|0;do b=Bs(b,M)|0,M=Bt()|0,it=w,g[it>>2]=b,g[it+4>>2]=M,T=T+1|0;while((T|0)<(R|0))}if((c|0)<=0){T=F,b=58;break}for(M=w,T=0,b=g[M>>2]|0,M=g[M+4>>2]|0;;)if(b=Bs(b,M)|0,M=Bt()|0,it=w,g[it>>2]=b,g[it+4>>2]=M,T=T+1|0,(T|0)==(c|0)){T=F,b=58;break e}}if(O=Cc(F,P)|0,(O|0)==7&&Qe(23066,23090,428,23230),T=w,b=g[T>>2]|0,T=g[T+4>>2]|0,(c|0)>0){M=0;do b=Bs(b,T)|0,T=Bt()|0,it=w,g[it>>2]=b,g[it+4>>2]=T,M=M+1|0;while((M|0)!=(c|0))}if(T=io(b,T)|0,(T|0)==7&&Qe(23313,23090,440,23230),b=kn(F)|0,b=g[(b?21664:21456)+(O*28|0)+(T<<2)>>2]|0,(b|0)<0&&Qe(23313,23090,454,23230),!b)T=F,b=58;else{O=w,T=0,M=g[O>>2]|0,O=g[O+4>>2]|0;do M=Pa(M,O)|0,O=Bt()|0,it=w,g[it>>2]=M,g[it+4>>2]=O,T=T+1|0;while((T|0)<(b|0));T=F,b=58}}else if((m|0)!=0&(d|0)!=0){if(b=io(_,y)|0,M=w,M=io(g[M>>2]|0,g[M+4>>2]|0)|0,(b|0)==7|(M|0)==7){T=5;break t}if(M=g[21248+(b*28|0)+(M<<2)>>2]|0,(M|0)<0){T=5;break t}if(!M)b=59;else{c=w,b=0,O=g[c>>2]|0,c=g[c+4>>2]|0;do O=Bs(O,c)|0,c=Bt()|0,it=w,g[it>>2]=O,g[it+4>>2]=c,b=b+1|0;while((b|0)<(M|0));b=58}}else b=58;while(!1);if((b|0)==58&&d&&(b=59),(b|0)==59&&(it=w,(io(g[it>>2]|0,g[it+4>>2]|0)|0)==1)){T=9;break}it=w,et=g[it>>2]|0,it=g[it+4>>2]&-1040385,$=ii(T|0,0,45)|0,it=it|(Bt()|0),T=w,g[T>>2]=et|$,g[T+4>>2]=it,T=0}else T=1;while(!1);return it=T,Tt=U,it|0}function Wf(_,y,b,w,T,M){_=_|0,y=y|0,b=b|0,w=w|0,T=T|0,M=M|0;var O=0,c=0;return c=Tt,Tt=Tt+16|0,O=c,T?_=15:(_=Gn(_,y,b,w,O)|0,_||(Ba(O,M),_=0)),Tt=c,_|0}function Er(_,y,b,w,T){_=_|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0;return O=Tt,Tt=Tt+16|0,M=O,w?b=15:(b=Ta(b,M)|0,b||(b=jl(_,y,M,T)|0)),Tt=O,b|0}function ai(_,y,b,w,T){_=_|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0;return d=Tt,Tt=Tt+32|0,O=d+12|0,c=d,M=Gn(_,y,_,y,O)|0,M|0?(c=M,Tt=d,c|0):(_=Gn(_,y,b,w,c)|0,_|0?(c=_,Tt=d,c|0):(O=Sc(O,c)|0,c=T,g[c>>2]=O,g[c+4>>2]=((O|0)<0)<<31>>31,c=0,Tt=d,c|0))}function Ro(_,y,b,w,T){_=_|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0;return d=Tt,Tt=Tt+32|0,O=d+12|0,c=d,M=Gn(_,y,_,y,O)|0,!M&&(M=Gn(_,y,b,w,c)|0,!M)?(w=Sc(O,c)|0,w=pn(w|0,((w|0)<0)<<31>>31|0,1,0)|0,O=Bt()|0,c=T,g[c>>2]=w,g[c+4>>2]=O,c=0,Tt=d,c|0):(c=M,Tt=d,c|0)}function Eu(_,y,b,w,T){_=_|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,U=0,J=0,et=0,$=0,it=0,st=0,xt=0,Rt=0,yt=0,It=0;if(yt=Tt,Tt=Tt+48|0,O=yt+24|0,c=yt+12|0,Rt=yt,M=Gn(_,y,_,y,O)|0,!M&&(M=Gn(_,y,b,w,c)|0,!M)){st=Sc(O,c)|0,xt=((st|0)<0)<<31>>31,g[O>>2]=0,g[O+4>>2]=0,g[O+8>>2]=0,g[c>>2]=0,g[c+4>>2]=0,g[c+8>>2]=0,Gn(_,y,_,y,O)|0&&Qe(23313,23090,691,23299),Gn(_,y,b,w,c)|0&&Qe(23313,23090,696,23299),Sa(O),Sa(c),st?(E=g[O>>2]|0,F=+(st|0),et=O+4|0,P=g[et>>2]|0,$=O+8|0,R=g[$>>2]|0,it=O,w=E,M=P,b=R,U=+((g[c>>2]|0)-E|0)/F,J=+((g[c+4>>2]|0)-P|0)/F,F=+((g[c+8>>2]|0)-R|0)/F):(M=O+4|0,b=O+8|0,et=M,$=b,it=O,w=g[O>>2]|0,M=g[M>>2]|0,b=g[b>>2]|0,U=0,J=0,F=0),g[Rt>>2]=w,R=Rt+4|0,g[R>>2]=M,P=Rt+8|0,g[P>>2]=b;t:do if((st|0)<0)M=0;else for(m=0,E=0,M=w;;){f=+(E>>>0)+4294967296*+(m|0),It=U*f+ +(M|0),d=J*f+ +(g[et>>2]|0),f=F*f+ +(g[$>>2]|0),b=~~+sa(+It),O=~~+sa(+d),M=~~+sa(+f),It=+Re(+(+(b|0)-It)),d=+Re(+(+(O|0)-d)),f=+Re(+(+(M|0)-f));do if(It>d&It>f)b=0-(O+M)|0,w=O;else if(c=0-b|0,d>f){w=c-M|0;break}else{w=O,M=c-O|0;break}while(!1);if(g[Rt>>2]=b,g[R>>2]=w,g[P>>2]=M,Ya(Rt),M=jl(_,y,Rt,T+(E<<3)|0)|0,M|0)break t;if(!((m|0)<(xt|0)|(m|0)==(xt|0)&E>>>0<st>>>0)){M=0;break t}M=pn(E|0,m|0,1,0)|0,c=Bt()|0,m=c,E=M,M=g[it>>2]|0}while(!1);return Rt=M,Tt=yt,Rt|0}return Rt=M,Tt=yt,Rt|0}function Qo(_,y,b,w){_=_|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0;if((b|0)==0&(w|0)==0)return T=0,M=1,yi(T|0),M|0;M=_,T=y,_=1,y=0;do O=(b&1|0)==0&!0,_=pr((O?1:M)|0,(O?0:T)|0,_|0,y|0)|0,y=Bt()|0,b=Is(b|0,w|0,1)|0,w=Bt()|0,M=pr(M|0,T|0,M|0,T|0)|0,T=Bt()|0;while(!((b|0)==0&(w|0)==0));return yi(y|0),_|0}function ls(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0;if(!(Wo(y,b)|0)||(y=Bc(y)|0,w=+ut[b>>3],T=+ut[b+8>>3],T=y&T<0?T+6.283185307179586:T,P=g[_>>2]|0,(P|0)<=0))return P=0,P|0;if(E=g[_+4>>2]|0,y){y=0,m=T,b=-1,_=0;t:for(;;){for(f=_;O=+ut[E+(f<<4)>>3],T=+ut[E+(f<<4)+8>>3],_=(b+2|0)%(P|0)|0,M=+ut[E+(_<<4)>>3],c=+ut[E+(_<<4)+8>>3],O>M?(d=O,O=c):(d=M,M=O,O=T,T=c),w=w==M|w==d?w+2220446049250313e-31:w,!!(w<M|w>d);)if(b=f+1|0,(b|0)>=(P|0)){b=22;break t}else _=f,f=b,b=_;if(c=O<0?O+6.283185307179586:O,O=T<0?T+6.283185307179586:T,m=c==m|O==m?m+-2220446049250313e-31:m,d=c+(O-c)*((w-M)/(d-M)),(d<0?d+6.283185307179586:d)>m&&(y=y^1),_=f+1|0,(_|0)>=(P|0)){b=22;break}else b=f}if((b|0)==22)return y|0}else{y=0,m=T,b=-1,_=0;t:for(;;){for(f=_;O=+ut[E+(f<<4)>>3],T=+ut[E+(f<<4)+8>>3],_=(b+2|0)%(P|0)|0,M=+ut[E+(_<<4)>>3],c=+ut[E+(_<<4)+8>>3],O>M?(d=O,O=c):(d=M,M=O,O=T,T=c),w=w==M|w==d?w+2220446049250313e-31:w,!!(w<M|w>d);)if(b=f+1|0,(b|0)>=(P|0)){b=22;break t}else _=f,f=b,b=_;if(m=O==m|T==m?m+-2220446049250313e-31:m,O+(T-O)*((w-M)/(d-M))>m&&(y=y^1),_=f+1|0,(_|0)>=(P|0)){b=22;break}else b=f}if((b|0)==22)return y|0}return 0}function bo(_,y){_=_|0,y=y|0;var b=0,w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,U=0,J=0,et=0,$=0;if(F=g[_>>2]|0,!F){g[y>>2]=0,g[y+4>>2]=0,g[y+8>>2]=0,g[y+12>>2]=0,g[y+16>>2]=0,g[y+20>>2]=0,g[y+24>>2]=0,g[y+28>>2]=0;return}if(U=y+8|0,ut[U>>3]=17976931348623157e292,J=y+24|0,ut[J>>3]=17976931348623157e292,ut[y>>3]=-17976931348623157e292,et=y+16|0,ut[et>>3]=-17976931348623157e292,!((F|0)<=0)){for(P=g[_+4>>2]|0,f=17976931348623157e292,m=-17976931348623157e292,E=0,_=-1,M=17976931348623157e292,O=17976931348623157e292,d=-17976931348623157e292,w=-17976931348623157e292,R=0;b=+ut[P+(R<<4)>>3],c=+ut[P+(R<<4)+8>>3],_=_+2|0,T=+ut[P+(((_|0)==(F|0)?0:_)<<4)+8>>3],b<M&&(ut[U>>3]=b,M=b),c<O&&(ut[J>>3]=c,O=c),b>d?ut[y>>3]=b:b=d,c>w&&(ut[et>>3]=c,w=c),f=c>0&c<f?c:f,m=c<0&c>m?c:m,E=E|+Re(+(c-T))>3.141592653589793,_=R+1|0,(_|0)!=(F|0);)$=R,d=b,R=_,_=$;E&&(ut[et>>3]=m,ut[J>>3]=f)}}function Ih(_,y){_=_|0,y=y|0;var b=0,w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,U=0,J=0,et=0,$=0,it=0,st=0,xt=0,Rt=0,yt=0;if(F=g[_>>2]|0,F){if(U=y+8|0,ut[U>>3]=17976931348623157e292,J=y+24|0,ut[J>>3]=17976931348623157e292,ut[y>>3]=-17976931348623157e292,et=y+16|0,ut[et>>3]=-17976931348623157e292,(F|0)>0){for(T=g[_+4>>2]|0,P=17976931348623157e292,R=-17976931348623157e292,w=0,b=-1,d=17976931348623157e292,f=17976931348623157e292,E=-17976931348623157e292,O=-17976931348623157e292,$=0;M=+ut[T+($<<4)>>3],m=+ut[T+($<<4)+8>>3],Rt=b+2|0,c=+ut[T+(((Rt|0)==(F|0)?0:Rt)<<4)+8>>3],M<d&&(ut[U>>3]=M,d=M),m<f&&(ut[J>>3]=m,f=m),M>E?ut[y>>3]=M:M=E,m>O&&(ut[et>>3]=m,O=m),P=m>0&m<P?m:P,R=m<0&m>R?m:R,w=w|+Re(+(m-c))>3.141592653589793,b=$+1|0,(b|0)!=(F|0);)Rt=$,E=M,$=b,b=Rt;w&&(ut[et>>3]=R,ut[J>>3]=P)}}else g[y>>2]=0,g[y+4>>2]=0,g[y+8>>2]=0,g[y+12>>2]=0,g[y+16>>2]=0,g[y+20>>2]=0,g[y+24>>2]=0,g[y+28>>2]=0;if(Rt=_+8|0,b=g[Rt>>2]|0,!((b|0)<=0)){xt=_+12|0,st=0;do if(T=g[xt>>2]|0,w=st,st=st+1|0,J=y+(st<<5)|0,et=g[T+(w<<3)>>2]|0,et){if($=y+(st<<5)+8|0,ut[$>>3]=17976931348623157e292,_=y+(st<<5)+24|0,ut[_>>3]=17976931348623157e292,ut[J>>3]=-17976931348623157e292,it=y+(st<<5)+16|0,ut[it>>3]=-17976931348623157e292,(et|0)>0){for(F=g[T+(w<<3)+4>>2]|0,P=17976931348623157e292,R=-17976931348623157e292,T=0,w=-1,U=0,d=17976931348623157e292,f=17976931348623157e292,m=-17976931348623157e292,O=-17976931348623157e292;M=+ut[F+(U<<4)>>3],E=+ut[F+(U<<4)+8>>3],w=w+2|0,c=+ut[F+(((w|0)==(et|0)?0:w)<<4)+8>>3],M<d&&(ut[$>>3]=M,d=M),E<f&&(ut[_>>3]=E,f=E),M>m?ut[J>>3]=M:M=m,E>O&&(ut[it>>3]=E,O=E),P=E>0&E<P?E:P,R=E<0&E>R?E:R,T=T|+Re(+(E-c))>3.141592653589793,w=U+1|0,(w|0)!=(et|0);)yt=U,U=w,m=M,w=yt;T&&(ut[it>>3]=R,ut[_>>3]=P)}}else g[J>>2]=0,g[J+4>>2]=0,g[J+8>>2]=0,g[J+12>>2]=0,g[J+16>>2]=0,g[J+20>>2]=0,g[J+24>>2]=0,g[J+28>>2]=0,b=g[Rt>>2]|0;while((st|0)<(b|0))}}function $e(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0;if(!(ls(_,y,b)|0))return T=0,T|0;if(T=_+8|0,(g[T>>2]|0)<=0)return T=1,T|0;for(w=_+12|0,_=0;;){if(M=_,_=_+1|0,ls((g[w>>2]|0)+(M<<3)|0,y+(_<<5)|0,b)|0){_=0,w=6;break}if((_|0)>=(g[T>>2]|0)){_=1,w=6;break}}return(w|0)==6?_|0:0}function Mh(){return 8}function Bu(){return 16}function Ph(){return 168}function cs(){return 8}function Do(){return 16}function Tu(){return 12}function Su(){return 8}function Oo(_){return _=_|0,+(+((g[_>>2]|0)>>>0)+4294967296*+(g[_+4>>2]|0))}function ra(_){_=_|0;var y=0,b=0;return b=+ut[_>>3],y=+ut[_+8>>3],+ +Fe(+(b*b+y*y))}function Rh(_,y,b,w,T){_=_|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0;f=+ut[_>>3],d=+ut[y>>3]-f,c=+ut[_+8>>3],O=+ut[y+8>>3]-c,E=+ut[b>>3],M=+ut[w>>3]-E,P=+ut[b+8>>3],m=+ut[w+8>>3]-P,M=(M*(c-P)-(f-E)*m)/(d*m-O*M),ut[T>>3]=f+d*M,ut[T+8>>3]=c+O*M}function Hl(_,y){return _=_|0,y=y|0,+Re(+(+ut[_>>3]-+ut[y>>3]))<11920928955078125e-23?(y=+Re(+(+ut[_+8>>3]-+ut[y+8>>3]))<11920928955078125e-23,y|0):(y=0,y|0)}function Br(_,y){_=_|0,y=y|0;var b=0,w=0,T=0;return T=+ut[_>>3]-+ut[y>>3],w=+ut[_+8>>3]-+ut[y+8>>3],b=+ut[_+16>>3]-+ut[y+16>>3],+(T*T+w*w+b*b)}function Dh(_,y){_=_|0,y=y|0;var b=0,w=0,T=0;b=+ut[_>>3],w=+ke(+b),b=+Me(+b),ut[y+16>>3]=b,b=+ut[_+8>>3],T=w*+ke(+b),ut[y>>3]=T,b=w*+Me(+b),ut[y+8>>3]=b}function Ts(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0;if(M=Tt,Tt=Tt+16|0,T=M,w=On(_,y)|0,(b+-1|0)>>>0>5||(w=(w|0)!=0,(b|0)==1&w))return T=-1,Tt=M,T|0;do if(no(_,y,T)|0)w=-1;else if(w){w=((g[21936+(b<<2)>>2]|0)+5-(g[T>>2]|0)|0)%5|0;break}else{w=((g[21968+(b<<2)>>2]|0)+6-(g[T>>2]|0)|0)%6|0;break}while(!1);return T=w,Tt=M,T|0}function no(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,c=0,d=0,f=0;if(f=Tt,Tt=Tt+32|0,O=f+16|0,c=f,w=nl(_,y,O)|0,w|0)return b=w,Tt=f,b|0;M=Bh(_,y)|0,d=io(_,y)|0,os(M,c),w=Of(M,g[O>>2]|0)|0;t:do if(Si(M)|0){do switch(M|0){case 4:{_=0;break}case 14:{_=1;break}case 24:{_=2;break}case 38:{_=3;break}case 49:{_=4;break}case 58:{_=5;break}case 63:{_=6;break}case 72:{_=7;break}case 83:{_=8;break}case 97:{_=9;break}case 107:{_=10;break}case 117:{_=11;break}default:{w=1;break t}}while(!1);if(T=g[22e3+(_*24|0)+8>>2]|0,y=g[22e3+(_*24|0)+16>>2]|0,_=g[O>>2]|0,(_|0)!=(g[c>>2]|0)&&(c=kn(M)|0,_=g[O>>2]|0,c|(_|0)==(y|0)&&(w=(w+1|0)%6|0)),(d|0)==3&(_|0)==(y|0)){w=(w+5|0)%6|0,T=22;break}(d|0)==5&(_|0)==(T|0)&&(w=(w+1|0)%6|0),T=22}else T=22;while(!1);return(T|0)==22&&(g[b>>2]=w,w=0),b=w,Tt=f,b|0}function Vi(_,y,b,w){_=_|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,U=0,J=0,et=0,$=0,it=0;if(it=Tt,Tt=Tt+32|0,$=it+24|0,J=it+20|0,F=it+8|0,R=it+16|0,P=it,d=(On(_,y)|0)==0,d=d?6:5,m=Ke(_|0,y|0,52)|0,Bt()|0,m=m&15,d>>>0<=b>>>0)return w=2,Tt=it,w|0;E=(m|0)==0,!E&&(U=ii(7,0,(m^15)*3|0)|0,(U&_|0)==0&((Bt()|0)&y|0)==0)?T=b:M=4;t:do if((M|0)==4){if(T=(On(_,y)|0)!=0,((T?4:5)|0)<(b|0)||no(_,y,$)|0||(M=(g[$>>2]|0)+b|0,T?T=22288+(((M|0)%5|0)<<2)|0:T=22320+(((M|0)%6|0)<<2)|0,U=g[T>>2]|0,(U|0)==7))return w=1,Tt=it,w|0;g[J>>2]=0,T=In(_,y,U,J,F)|0;do if(!T){if(c=F,f=g[c>>2]|0,c=g[c+4>>2]|0,O=c>>>0<y>>>0|(c|0)==(y|0)&f>>>0<_>>>0,M=O?f:_,O=O?c:y,!E&&(E=ii(7,0,(m^15)*3|0)|0,(f&E|0)==0&(c&(Bt()|0)|0)==0))T=b;else{if(c=(b+-1+d|0)%(d|0)|0,T=On(_,y)|0,(c|0)<0&&Qe(23313,23315,245,23324),d=(T|0)!=0,((d?4:5)|0)<(c|0)&&Qe(23313,23315,245,23324),no(_,y,$)|0&&Qe(23313,23315,245,23324),T=(g[$>>2]|0)+c|0,d?T=22288+(((T|0)%5|0)<<2)|0:T=22320+(((T|0)%6|0)<<2)|0,c=g[T>>2]|0,(c|0)==7&&Qe(23313,23315,245,23324),g[R>>2]=0,T=In(_,y,c,R,P)|0,T|0)break;f=P,d=g[f>>2]|0,f=g[f+4>>2]|0;do if(f>>>0<O>>>0|(f|0)==(O|0)&d>>>0<M>>>0){if(On(d,f)|0?M=wc(d,f,_,y)|0:M=g[22384+((((g[R>>2]|0)+(g[22352+(c<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,T=On(d,f)|0,(M+-1|0)>>>0>5){T=-1,M=d,O=f;break}if(T=(T|0)!=0,(M|0)==1&T){T=-1,M=d,O=f;break}do if(no(d,f,$)|0)T=-1;else if(T){T=((g[21936+(M<<2)>>2]|0)+5-(g[$>>2]|0)|0)%5|0;break}else{T=((g[21968+(M<<2)>>2]|0)+6-(g[$>>2]|0)|0)%6|0;break}while(!1);M=d,O=f}else T=b;while(!1);c=F,f=g[c>>2]|0,c=g[c+4>>2]|0}if((M|0)==(f|0)&(O|0)==(c|0)){if(d=(On(f,c)|0)!=0,d?_=wc(f,c,_,y)|0:_=g[22384+((((g[J>>2]|0)+(g[22352+(U<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,T=On(f,c)|0,(_+-1|0)>>>0<=5&&(et=(T|0)!=0,!((_|0)==1&et)))do if(no(f,c,$)|0)T=-1;else if(et){T=((g[21936+(_<<2)>>2]|0)+5-(g[$>>2]|0)|0)%5|0;break}else{T=((g[21968+(_<<2)>>2]|0)+6-(g[$>>2]|0)|0)%6|0;break}while(!1);else T=-1;T=T+1|0,T=(T|0)==6|d&(T|0)==5?0:T}y=O,_=M;break t}while(!1);return w=T,Tt=it,w|0}while(!1);return et=ii(T|0,0,56)|0,$=Bt()|0|y&-2130706433|536870912,g[w>>2]=et|_,g[w+4>>2]=$,w=0,Tt=it,w|0}function ks(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0;return M=(On(_,y)|0)==0,w=Vi(_,y,0,b)|0,T=(w|0)==0,M?!T||(w=Vi(_,y,1,b+8|0)|0,w|0)||(w=Vi(_,y,2,b+16|0)|0,w|0)||(w=Vi(_,y,3,b+24|0)|0,w|0)||(w=Vi(_,y,4,b+32|0)|0,w)?(M=w,M|0):Vi(_,y,5,b+40|0)|0:!T||(w=Vi(_,y,1,b+8|0)|0,w|0)||(w=Vi(_,y,2,b+16|0)|0,w|0)||(w=Vi(_,y,3,b+24|0)|0,w|0)||(w=Vi(_,y,4,b+32|0)|0,w|0)?(M=w,M|0):(M=b+40|0,g[M>>2]=0,g[M+4>>2]=0,M=0,M|0)}function us(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,c=0,d=0;return d=Tt,Tt=Tt+192|0,T=d,M=d+168|0,O=Ke(_|0,y|0,56)|0,Bt()|0,O=O&7,c=y&-2130706433|134217728,w=nl(_,c,M)|0,w|0?(c=w,Tt=d,c|0):(y=Ke(_|0,y|0,52)|0,Bt()|0,y=y&15,On(_,c)|0?qs(M,y,O,1,T):gu(M,y,O,1,T),c=T+8|0,g[b>>2]=g[c>>2],g[b+4>>2]=g[c+4>>2],g[b+8>>2]=g[c+8>>2],g[b+12>>2]=g[c+12>>2],c=0,Tt=d,c|0)}function Xr(_,y){_=_|0,y=y|0;var b=0,w=0,T=0,M=0;return T=Tt,Tt=Tt+16|0,b=T,!(!0&(y&2013265920|0)==536870912)||(w=y&-2130706433|134217728,!(ta(_,w)|0))?(w=0,Tt=T,w|0):(M=Ke(_|0,y|0,56)|0,Bt()|0,M=(Vi(_,w,M&7,b)|0)==0,w=b,w=M&((g[w>>2]|0)==(_|0)?(g[w+4>>2]|0)==(y|0):0)&1,Tt=T,w|0)}function Ra(_,y,b){_=_|0,y=y|0,b=b|0;var w=0;(y|0)>0?(w=fs(y,4)|0,g[_>>2]=w,w||Qe(23337,23360,40,23374)):g[_>>2]=0,g[_+4>>2]=y,g[_+8>>2]=0,g[_+12>>2]=b}function oa(_){_=_|0;var y=0,b=0,w=0,T=0,M=0,O=0,c=0;T=_+4|0,M=_+12|0,O=_+8|0;t:for(;;){for(b=g[T>>2]|0,y=0;;){if((y|0)>=(b|0))break t;if(w=g[_>>2]|0,c=g[w+(y<<2)>>2]|0,!c)y=y+1|0;else break}y=w+(~~(+Re(+(+fe(10,+ +(15-(g[M>>2]|0)|0))*(+ut[c>>3]+ +ut[c+8>>3])))%+(b|0))>>>0<<2)|0,b=g[y>>2]|0;e:do if(b|0){if(w=c+32|0,(b|0)==(c|0))g[y>>2]=g[w>>2];else{if(b=b+32|0,y=g[b>>2]|0,!y)break;for(;(y|0)!=(c|0);)if(b=y+32|0,y=g[b>>2]|0,!y)break e;g[b>>2]=g[w>>2]}Ni(c),g[O>>2]=(g[O>>2]|0)+-1}while(!1)}Ni(g[_>>2]|0)}function hs(_){_=_|0;var y=0,b=0,w=0;for(w=g[_+4>>2]|0,b=0;;){if((b|0)>=(w|0)){y=0,b=4;break}if(y=g[(g[_>>2]|0)+(b<<2)>>2]|0,!y)b=b+1|0;else{b=4;break}}return(b|0)==4?y|0:0}function ro(_,y){_=_|0,y=y|0;var b=0,w=0,T=0,M=0;if(b=~~(+Re(+(+fe(10,+ +(15-(g[_+12>>2]|0)|0))*(+ut[y>>3]+ +ut[y+8>>3])))%+(g[_+4>>2]|0))>>>0,b=(g[_>>2]|0)+(b<<2)|0,w=g[b>>2]|0,!w)return M=1,M|0;M=y+32|0;do if((w|0)!=(y|0)){if(b=g[w+32>>2]|0,!b)return M=1,M|0;for(T=b;;){if((T|0)==(y|0)){T=8;break}if(b=g[T+32>>2]|0,b)w=T,T=b;else{b=1,T=10;break}}if((T|0)==8){g[w+32>>2]=g[M>>2];break}else if((T|0)==10)return b|0}else g[b>>2]=g[M>>2];while(!1);return Ni(y),M=_+8|0,g[M>>2]=(g[M>>2]|0)+-1,M=0,M|0}function Fc(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0;M=Qn(40)|0,M||Qe(23390,23360,98,23403),g[M>>2]=g[y>>2],g[M+4>>2]=g[y+4>>2],g[M+8>>2]=g[y+8>>2],g[M+12>>2]=g[y+12>>2],T=M+16|0,g[T>>2]=g[b>>2],g[T+4>>2]=g[b+4>>2],g[T+8>>2]=g[b+8>>2],g[T+12>>2]=g[b+12>>2],g[M+32>>2]=0,T=~~(+Re(+(+fe(10,+ +(15-(g[_+12>>2]|0)|0))*(+ut[y>>3]+ +ut[y+8>>3])))%+(g[_+4>>2]|0))>>>0,T=(g[_>>2]|0)+(T<<2)|0,w=g[T>>2]|0;do if(!w)g[T>>2]=M;else{for(;!(ol(w,y)|0&&ol(w+16|0,b)|0);)if(T=g[w+32>>2]|0,w=(T|0)==0?w:T,!(g[w+32>>2]|0)){O=10;break}if((O|0)==10){g[w+32>>2]=M;break}return Ni(M),O=w,O|0}while(!1);return O=_+8|0,g[O>>2]=(g[O>>2]|0)+1,O=M,O|0}function xi(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0;if(T=~~(+Re(+(+fe(10,+ +(15-(g[_+12>>2]|0)|0))*(+ut[y>>3]+ +ut[y+8>>3])))%+(g[_+4>>2]|0))>>>0,T=g[(g[_>>2]|0)+(T<<2)>>2]|0,!T)return b=0,b|0;if(!b){for(_=T;;){if(ol(_,y)|0){w=10;break}if(_=g[_+32>>2]|0,!_){_=0,w=10;break}}if((w|0)==10)return _|0}for(_=T;;){if(ol(_,y)|0&&ol(_+16|0,b)|0){w=10;break}if(_=g[_+32>>2]|0,!_){_=0,w=10;break}}return(w|0)==10?_|0:0}function ui(_,y){_=_|0,y=y|0;var b=0;if(b=~~(+Re(+(+fe(10,+ +(15-(g[_+12>>2]|0)|0))*(+ut[y>>3]+ +ut[y+8>>3])))%+(g[_+4>>2]|0))>>>0,_=g[(g[_>>2]|0)+(b<<2)>>2]|0,!_)return b=0,b|0;for(;;){if(ol(_,y)|0){y=5;break}if(_=g[_+32>>2]|0,!_){_=0,y=5;break}}return(y|0)==5?_|0:0}function Iu(){return 23424}function fo(_){return _=+_,+ +la(+_)}function Kr(_){return _=+_,~~+fo(_)|0}function Qn(_){_=_|0;var y=0,b=0,w=0,T=0,M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,U=0,J=0,et=0,$=0,it=0,st=0,xt=0;xt=Tt,Tt=Tt+16|0,P=xt;do if(_>>>0<245){if(f=_>>>0<11?16:_+11&-8,_=f>>>3,E=g[5857]|0,b=E>>>_,b&3|0)return y=(b&1^1)+_|0,_=23468+(y<<1<<2)|0,b=_+8|0,w=g[b>>2]|0,T=w+8|0,M=g[T>>2]|0,(M|0)==(_|0)?g[5857]=E&~(1<<y):(g[M+12>>2]=_,g[b>>2]=M),st=y<<3,g[w+4>>2]=st|3,st=w+st+4|0,g[st>>2]=g[st>>2]|1,st=T,Tt=xt,st|0;if(m=g[5859]|0,f>>>0>m>>>0){if(b|0)return y=2<<_,y=b<<_&(y|0-y),y=(y&0-y)+-1|0,c=y>>>12&16,y=y>>>c,b=y>>>5&8,y=y>>>b,M=y>>>2&4,y=y>>>M,_=y>>>1&2,y=y>>>_,w=y>>>1&1,w=(b|c|M|_|w)+(y>>>w)|0,y=23468+(w<<1<<2)|0,_=y+8|0,M=g[_>>2]|0,c=M+8|0,b=g[c>>2]|0,(b|0)==(y|0)?(_=E&~(1<<w),g[5857]=_):(g[b+12>>2]=y,g[_>>2]=b,_=E),st=w<<3,O=st-f|0,g[M+4>>2]=f|3,T=M+f|0,g[T+4>>2]=O|1,g[M+st>>2]=O,m|0&&(w=g[5862]|0,y=m>>>3,b=23468+(y<<1<<2)|0,y=1<<y,_&y?(_=b+8|0,y=g[_>>2]|0):(g[5857]=_|y,y=b,_=b+8|0),g[_>>2]=w,g[y+12>>2]=w,g[w+8>>2]=y,g[w+12>>2]=b),g[5859]=O,g[5862]=T,st=c,Tt=xt,st|0;if(M=g[5858]|0,M){for(b=(M&0-M)+-1|0,T=b>>>12&16,b=b>>>T,w=b>>>5&8,b=b>>>w,O=b>>>2&4,b=b>>>O,c=b>>>1&2,b=b>>>c,d=b>>>1&1,d=g[23732+((w|T|O|c|d)+(b>>>d)<<2)>>2]|0,b=d,c=d,d=(g[d+4>>2]&-8)-f|0;_=g[b+16>>2]|0,!(!_&&(_=g[b+20>>2]|0,!_));)O=(g[_+4>>2]&-8)-f|0,T=O>>>0<d>>>0,b=_,c=T?_:c,d=T?O:d;if(O=c+f|0,O>>>0>c>>>0){T=g[c+24>>2]|0,y=g[c+12>>2]|0;do if((y|0)==(c|0)){if(_=c+20|0,y=g[_>>2]|0,!y&&(_=c+16|0,y=g[_>>2]|0,!y)){b=0;break}for(;;)if(w=y+20|0,b=g[w>>2]|0,b)y=b,_=w;else if(w=y+16|0,b=g[w>>2]|0,b)y=b,_=w;else break;g[_>>2]=0,b=y}else b=g[c+8>>2]|0,g[b+12>>2]=y,g[y+8>>2]=b,b=y;while(!1);do if(T|0){if(y=g[c+28>>2]|0,_=23732+(y<<2)|0,(c|0)==(g[_>>2]|0)){if(g[_>>2]=b,!b){g[5858]=M&~(1<<y);break}}else if(st=T+16|0,g[((g[st>>2]|0)==(c|0)?st:T+20|0)>>2]=b,!b)break;g[b+24>>2]=T,y=g[c+16>>2]|0,y|0&&(g[b+16>>2]=y,g[y+24>>2]=b),y=g[c+20>>2]|0,y|0&&(g[b+20>>2]=y,g[y+24>>2]=b)}while(!1);return d>>>0<16?(st=d+f|0,g[c+4>>2]=st|3,st=c+st+4|0,g[st>>2]=g[st>>2]|1):(g[c+4>>2]=f|3,g[O+4>>2]=d|1,g[O+d>>2]=d,m|0&&(w=g[5862]|0,y=m>>>3,b=23468+(y<<1<<2)|0,y=1<<y,y&E?(_=b+8|0,y=g[_>>2]|0):(g[5857]=y|E,y=b,_=b+8|0),g[_>>2]=w,g[y+12>>2]=w,g[w+8>>2]=y,g[w+12>>2]=b),g[5859]=d,g[5862]=O),st=c+8|0,Tt=xt,st|0}else E=f}else E=f}else E=f}else if(_>>>0<=4294967231)if(_=_+11|0,f=_&-8,w=g[5858]|0,w){T=0-f|0,_=_>>>8,_?f>>>0>16777215?d=31:(E=(_+1048320|0)>>>16&8,U=_<<E,c=(U+520192|0)>>>16&4,U=U<<c,d=(U+245760|0)>>>16&2,d=14-(c|E|d)+(U<<d>>>15)|0,d=f>>>(d+7|0)&1|d<<1):d=0,b=g[23732+(d<<2)>>2]|0;t:do if(!b)b=0,_=0,U=61;else for(_=0,c=f<<((d|0)==31?0:25-(d>>>1)|0),M=0;;){if(O=(g[b+4>>2]&-8)-f|0,O>>>0<T>>>0)if(O)_=b,T=O;else{_=b,T=0,U=65;break t}if(U=g[b+20>>2]|0,b=g[b+16+(c>>>31<<2)>>2]|0,M=(U|0)==0|(U|0)==(b|0)?M:U,b)c=c<<1;else{b=M,U=61;break}}while(!1);if((U|0)==61){if((b|0)==0&(_|0)==0){if(_=2<<d,_=(_|0-_)&w,!_){E=f;break}E=(_&0-_)+-1|0,O=E>>>12&16,E=E>>>O,M=E>>>5&8,E=E>>>M,c=E>>>2&4,E=E>>>c,d=E>>>1&2,E=E>>>d,b=E>>>1&1,_=0,b=g[23732+((M|O|c|d|b)+(E>>>b)<<2)>>2]|0}b?U=65:(c=_,O=T)}if((U|0)==65)for(M=b;;)if(E=(g[M+4>>2]&-8)-f|0,b=E>>>0<T>>>0,T=b?E:T,_=b?M:_,b=g[M+16>>2]|0,b||(b=g[M+20>>2]|0),b)M=b;else{c=_,O=T;break}if((c|0)!=0&&O>>>0<((g[5859]|0)-f|0)>>>0&&(m=c+f|0,m>>>0>c>>>0)){M=g[c+24>>2]|0,y=g[c+12>>2]|0;do if((y|0)==(c|0)){if(_=c+20|0,y=g[_>>2]|0,!y&&(_=c+16|0,y=g[_>>2]|0,!y)){y=0;break}for(;;)if(T=y+20|0,b=g[T>>2]|0,b)y=b,_=T;else if(T=y+16|0,b=g[T>>2]|0,b)y=b,_=T;else break;g[_>>2]=0}else st=g[c+8>>2]|0,g[st+12>>2]=y,g[y+8>>2]=st;while(!1);do if(M){if(_=g[c+28>>2]|0,b=23732+(_<<2)|0,(c|0)==(g[b>>2]|0)){if(g[b>>2]=y,!y){w=w&~(1<<_),g[5858]=w;break}}else if(st=M+16|0,g[((g[st>>2]|0)==(c|0)?st:M+20|0)>>2]=y,!y)break;g[y+24>>2]=M,_=g[c+16>>2]|0,_|0&&(g[y+16>>2]=_,g[_+24>>2]=y),_=g[c+20>>2]|0,_&&(g[y+20>>2]=_,g[_+24>>2]=y)}while(!1);t:do if(O>>>0<16)st=O+f|0,g[c+4>>2]=st|3,st=c+st+4|0,g[st>>2]=g[st>>2]|1;else{if(g[c+4>>2]=f|3,g[m+4>>2]=O|1,g[m+O>>2]=O,y=O>>>3,O>>>0<256){b=23468+(y<<1<<2)|0,_=g[5857]|0,y=1<<y,_&y?(_=b+8|0,y=g[_>>2]|0):(g[5857]=_|y,y=b,_=b+8|0),g[_>>2]=m,g[y+12>>2]=m,g[m+8>>2]=y,g[m+12>>2]=b;break}if(y=O>>>8,y?O>>>0>16777215?b=31:(it=(y+1048320|0)>>>16&8,st=y<<it,$=(st+520192|0)>>>16&4,st=st<<$,b=(st+245760|0)>>>16&2,b=14-($|it|b)+(st<<b>>>15)|0,b=O>>>(b+7|0)&1|b<<1):b=0,y=23732+(b<<2)|0,g[m+28>>2]=b,_=m+16|0,g[_+4>>2]=0,g[_>>2]=0,_=1<<b,!(w&_)){g[5858]=w|_,g[y>>2]=m,g[m+24>>2]=y,g[m+12>>2]=m,g[m+8>>2]=m;break}y=g[y>>2]|0;e:do if((g[y+4>>2]&-8|0)!=(O|0)){for(w=O<<((b|0)==31?0:25-(b>>>1)|0);b=y+16+(w>>>31<<2)|0,_=g[b>>2]|0,!!_;)if((g[_+4>>2]&-8|0)==(O|0)){y=_;break e}else w=w<<1,y=_;g[b>>2]=m,g[m+24>>2]=y,g[m+12>>2]=m,g[m+8>>2]=m;break t}while(!1);it=y+8|0,st=g[it>>2]|0,g[st+12>>2]=m,g[it>>2]=m,g[m+8>>2]=st,g[m+12>>2]=y,g[m+24>>2]=0}while(!1);return st=c+8|0,Tt=xt,st|0}else E=f}else E=f;else E=-1;while(!1);if(b=g[5859]|0,b>>>0>=E>>>0)return y=b-E|0,_=g[5862]|0,y>>>0>15?(st=_+E|0,g[5862]=st,g[5859]=y,g[st+4>>2]=y|1,g[_+b>>2]=y,g[_+4>>2]=E|3):(g[5859]=0,g[5862]=0,g[_+4>>2]=b|3,st=_+b+4|0,g[st>>2]=g[st>>2]|1),st=_+8|0,Tt=xt,st|0;if(O=g[5860]|0,O>>>0>E>>>0)return $=O-E|0,g[5860]=$,st=g[5863]|0,it=st+E|0,g[5863]=it,g[it+4>>2]=$|1,g[st+4>>2]=E|3,st=st+8|0,Tt=xt,st|0;if(g[5975]|0?_=g[5977]|0:(g[5977]=4096,g[5976]=4096,g[5978]=-1,g[5979]=-1,g[5980]=0,g[5968]=0,g[5975]=P&-16^1431655768,_=4096),c=E+48|0,d=E+47|0,M=_+d|0,T=0-_|0,f=M&T,f>>>0<=E>>>0||(_=g[5967]|0,_|0&&(m=g[5965]|0,P=m+f|0,P>>>0<=m>>>0|P>>>0>_>>>0)))return st=0,Tt=xt,st|0;t:do if(g[5968]&4)y=0,U=143;else{b=g[5863]|0;e:do if(b){for(w=23876;P=g[w>>2]|0,!(P>>>0<=b>>>0&&(P+(g[w+4>>2]|0)|0)>>>0>b>>>0);)if(_=g[w+8>>2]|0,_)w=_;else{U=128;break e}if(y=M-O&T,y>>>0<2147483647)if(_=xo(y|0)|0,(_|0)==((g[w>>2]|0)+(g[w+4>>2]|0)|0)){if((_|0)!=-1){O=y,M=_,U=145;break t}}else w=_,U=136;else y=0}else U=128;while(!1);do if((U|0)==128)if(b=xo(0)|0,(b|0)!=-1&&(y=b,R=g[5976]|0,F=R+-1|0,y=((F&y|0)==0?0:(F+y&0-R)-y|0)+f|0,R=g[5965]|0,F=y+R|0,y>>>0>E>>>0&y>>>0<2147483647)){if(P=g[5967]|0,P|0&&F>>>0<=R>>>0|F>>>0>P>>>0){y=0;break}if(_=xo(y|0)|0,(_|0)==(b|0)){O=y,M=b,U=145;break t}else w=_,U=136}else y=0;while(!1);do if((U|0)==136){if(b=0-y|0,!(c>>>0>y>>>0&(y>>>0<2147483647&(w|0)!=-1)))if((w|0)==-1){y=0;break}else{O=y,M=w,U=145;break t}if(_=g[5977]|0,_=d-y+_&0-_,_>>>0>=2147483647){O=y,M=w,U=145;break t}if((xo(_|0)|0)==-1){xo(b|0)|0,y=0;break}else{O=_+y|0,M=w,U=145;break t}}while(!1);g[5968]=g[5968]|4,U=143}while(!1);if((U|0)==143&&f>>>0<2147483647&&($=xo(f|0)|0,F=xo(0)|0,J=F-$|0,et=J>>>0>(E+40|0)>>>0,!(($|0)==-1|et^1|$>>>0<F>>>0&(($|0)!=-1&(F|0)!=-1)^1))&&(O=et?J:y,M=$,U=145),(U|0)==145){y=(g[5965]|0)+O|0,g[5965]=y,y>>>0>(g[5966]|0)>>>0&&(g[5966]=y),d=g[5863]|0;t:do if(d){for(y=23876;;){if(_=g[y>>2]|0,b=g[y+4>>2]|0,(M|0)==(_+b|0)){U=154;break}if(w=g[y+8>>2]|0,w)y=w;else break}if((U|0)==154&&(it=y+4|0,(g[y+12>>2]&8|0)==0)&&M>>>0>d>>>0&_>>>0<=d>>>0){g[it>>2]=b+O,st=(g[5860]|0)+O|0,$=d+8|0,$=($&7|0)==0?0:0-$&7,it=d+$|0,$=st-$|0,g[5863]=it,g[5860]=$,g[it+4>>2]=$|1,g[d+st+4>>2]=40,g[5864]=g[5979];break}for(M>>>0<(g[5861]|0)>>>0&&(g[5861]=M),b=M+O|0,y=23876;;){if((g[y>>2]|0)==(b|0)){U=162;break}if(_=g[y+8>>2]|0,_)y=_;else break}if((U|0)==162&&(g[y+12>>2]&8|0)==0){g[y>>2]=M,m=y+4|0,g[m>>2]=(g[m>>2]|0)+O,m=M+8|0,m=M+((m&7|0)==0?0:0-m&7)|0,y=b+8|0,y=b+((y&7|0)==0?0:0-y&7)|0,f=m+E|0,c=y-m-E|0,g[m+4>>2]=E|3;e:do if((d|0)==(y|0))st=(g[5860]|0)+c|0,g[5860]=st,g[5863]=f,g[f+4>>2]=st|1;else{if((g[5862]|0)==(y|0)){st=(g[5859]|0)+c|0,g[5859]=st,g[5862]=f,g[f+4>>2]=st|1,g[f+st>>2]=st;break}if(_=g[y+4>>2]|0,(_&3|0)==1){O=_&-8,w=_>>>3;i:do if(_>>>0<256)if(_=g[y+8>>2]|0,b=g[y+12>>2]|0,(b|0)==(_|0)){g[5857]=g[5857]&~(1<<w);break}else{g[_+12>>2]=b,g[b+8>>2]=_;break}else{M=g[y+24>>2]|0,_=g[y+12>>2]|0;do if((_|0)==(y|0)){if(b=y+16|0,w=b+4|0,_=g[w>>2]|0,_)b=w;else if(_=g[b>>2]|0,!_){_=0;break}for(;;)if(T=_+20|0,w=g[T>>2]|0,w)_=w,b=T;else if(T=_+16|0,w=g[T>>2]|0,w)_=w,b=T;else break;g[b>>2]=0}else st=g[y+8>>2]|0,g[st+12>>2]=_,g[_+8>>2]=st;while(!1);if(!M)break;b=g[y+28>>2]|0,w=23732+(b<<2)|0;do if((g[w>>2]|0)!=(y|0)){if(st=M+16|0,g[((g[st>>2]|0)==(y|0)?st:M+20|0)>>2]=_,!_)break i}else{if(g[w>>2]=_,_|0)break;g[5858]=g[5858]&~(1<<b);break i}while(!1);if(g[_+24>>2]=M,b=y+16|0,w=g[b>>2]|0,w|0&&(g[_+16>>2]=w,g[w+24>>2]=_),b=g[b+4>>2]|0,!b)break;g[_+20>>2]=b,g[b+24>>2]=_}while(!1);y=y+O|0,T=O+c|0}else T=c;if(y=y+4|0,g[y>>2]=g[y>>2]&-2,g[f+4>>2]=T|1,g[f+T>>2]=T,y=T>>>3,T>>>0<256){b=23468+(y<<1<<2)|0,_=g[5857]|0,y=1<<y,_&y?(_=b+8|0,y=g[_>>2]|0):(g[5857]=_|y,y=b,_=b+8|0),g[_>>2]=f,g[y+12>>2]=f,g[f+8>>2]=y,g[f+12>>2]=b;break}y=T>>>8;do if(!y)w=0;else{if(T>>>0>16777215){w=31;break}it=(y+1048320|0)>>>16&8,st=y<<it,$=(st+520192|0)>>>16&4,st=st<<$,w=(st+245760|0)>>>16&2,w=14-($|it|w)+(st<<w>>>15)|0,w=T>>>(w+7|0)&1|w<<1}while(!1);if(y=23732+(w<<2)|0,g[f+28>>2]=w,_=f+16|0,g[_+4>>2]=0,g[_>>2]=0,_=g[5858]|0,b=1<<w,!(_&b)){g[5858]=_|b,g[y>>2]=f,g[f+24>>2]=y,g[f+12>>2]=f,g[f+8>>2]=f;break}y=g[y>>2]|0;i:do if((g[y+4>>2]&-8|0)!=(T|0)){for(w=T<<((w|0)==31?0:25-(w>>>1)|0);b=y+16+(w>>>31<<2)|0,_=g[b>>2]|0,!!_;)if((g[_+4>>2]&-8|0)==(T|0)){y=_;break i}else w=w<<1,y=_;g[b>>2]=f,g[f+24>>2]=y,g[f+12>>2]=f,g[f+8>>2]=f;break e}while(!1);it=y+8|0,st=g[it>>2]|0,g[st+12>>2]=f,g[it>>2]=f,g[f+8>>2]=st,g[f+12>>2]=y,g[f+24>>2]=0}while(!1);return st=m+8|0,Tt=xt,st|0}for(y=23876;_=g[y>>2]|0,!(_>>>0<=d>>>0&&(st=_+(g[y+4>>2]|0)|0,st>>>0>d>>>0));)y=g[y+8>>2]|0;T=st+-47|0,_=T+8|0,_=T+((_&7|0)==0?0:0-_&7)|0,T=d+16|0,_=_>>>0<T>>>0?d:_,y=_+8|0,b=O+-40|0,$=M+8|0,$=($&7|0)==0?0:0-$&7,it=M+$|0,$=b-$|0,g[5863]=it,g[5860]=$,g[it+4>>2]=$|1,g[M+b+4>>2]=40,g[5864]=g[5979],b=_+4|0,g[b>>2]=27,g[y>>2]=g[5969],g[y+4>>2]=g[5970],g[y+8>>2]=g[5971],g[y+12>>2]=g[5972],g[5969]=M,g[5970]=O,g[5972]=0,g[5971]=y,y=_+24|0;do it=y,y=y+4|0,g[y>>2]=7;while((it+8|0)>>>0<st>>>0);if((_|0)!=(d|0)){if(M=_-d|0,g[b>>2]=g[b>>2]&-2,g[d+4>>2]=M|1,g[_>>2]=M,y=M>>>3,M>>>0<256){b=23468+(y<<1<<2)|0,_=g[5857]|0,y=1<<y,_&y?(_=b+8|0,y=g[_>>2]|0):(g[5857]=_|y,y=b,_=b+8|0),g[_>>2]=d,g[y+12>>2]=d,g[d+8>>2]=y,g[d+12>>2]=b;break}if(y=M>>>8,y?M>>>0>16777215?w=31:(it=(y+1048320|0)>>>16&8,st=y<<it,$=(st+520192|0)>>>16&4,st=st<<$,w=(st+245760|0)>>>16&2,w=14-($|it|w)+(st<<w>>>15)|0,w=M>>>(w+7|0)&1|w<<1):w=0,b=23732+(w<<2)|0,g[d+28>>2]=w,g[d+20>>2]=0,g[T>>2]=0,y=g[5858]|0,_=1<<w,!(y&_)){g[5858]=y|_,g[b>>2]=d,g[d+24>>2]=b,g[d+12>>2]=d,g[d+8>>2]=d;break}y=g[b>>2]|0;e:do if((g[y+4>>2]&-8|0)!=(M|0)){for(w=M<<((w|0)==31?0:25-(w>>>1)|0);b=y+16+(w>>>31<<2)|0,_=g[b>>2]|0,!!_;)if((g[_+4>>2]&-8|0)==(M|0)){y=_;break e}else w=w<<1,y=_;g[b>>2]=d,g[d+24>>2]=y,g[d+12>>2]=d,g[d+8>>2]=d;break t}while(!1);it=y+8|0,st=g[it>>2]|0,g[st+12>>2]=d,g[it>>2]=d,g[d+8>>2]=st,g[d+12>>2]=y,g[d+24>>2]=0}}else st=g[5861]|0,(st|0)==0|M>>>0<st>>>0&&(g[5861]=M),g[5969]=M,g[5970]=O,g[5972]=0,g[5866]=g[5975],g[5865]=-1,g[5870]=23468,g[5869]=23468,g[5872]=23476,g[5871]=23476,g[5874]=23484,g[5873]=23484,g[5876]=23492,g[5875]=23492,g[5878]=23500,g[5877]=23500,g[5880]=23508,g[5879]=23508,g[5882]=23516,g[5881]=23516,g[5884]=23524,g[5883]=23524,g[5886]=23532,g[5885]=23532,g[5888]=23540,g[5887]=23540,g[5890]=23548,g[5889]=23548,g[5892]=23556,g[5891]=23556,g[5894]=23564,g[5893]=23564,g[5896]=23572,g[5895]=23572,g[5898]=23580,g[5897]=23580,g[5900]=23588,g[5899]=23588,g[5902]=23596,g[5901]=23596,g[5904]=23604,g[5903]=23604,g[5906]=23612,g[5905]=23612,g[5908]=23620,g[5907]=23620,g[5910]=23628,g[5909]=23628,g[5912]=23636,g[5911]=23636,g[5914]=23644,g[5913]=23644,g[5916]=23652,g[5915]=23652,g[5918]=23660,g[5917]=23660,g[5920]=23668,g[5919]=23668,g[5922]=23676,g[5921]=23676,g[5924]=23684,g[5923]=23684,g[5926]=23692,g[5925]=23692,g[5928]=23700,g[5927]=23700,g[5930]=23708,g[5929]=23708,g[5932]=23716,g[5931]=23716,st=O+-40|0,$=M+8|0,$=($&7|0)==0?0:0-$&7,it=M+$|0,$=st-$|0,g[5863]=it,g[5860]=$,g[it+4>>2]=$|1,g[M+st+4>>2]=40,g[5864]=g[5979];while(!1);if(y=g[5860]|0,y>>>0>E>>>0)return $=y-E|0,g[5860]=$,st=g[5863]|0,it=st+E|0,g[5863]=it,g[it+4>>2]=$|1,g[st+4>>2]=E|3,st=st+8|0,Tt=xt,st|0}return st=Iu()|0,g[st>>2]=12,st=0,Tt=xt,st|0}function Ni(_){_=_|0;var y=0,b=0,w=0,T=0,M=0,O=0,c=0,d=0;if(_){b=_+-8|0,T=g[5861]|0,_=g[_+-4>>2]|0,y=_&-8,d=b+y|0;do if(_&1)c=b,O=b;else{if(w=g[b>>2]|0,!(_&3)||(O=b+(0-w)|0,M=w+y|0,O>>>0<T>>>0))return;if((g[5862]|0)==(O|0)){if(_=d+4|0,y=g[_>>2]|0,(y&3|0)!=3){c=O,y=M;break}g[5859]=M,g[_>>2]=y&-2,g[O+4>>2]=M|1,g[O+M>>2]=M;return}if(b=w>>>3,w>>>0<256)if(_=g[O+8>>2]|0,y=g[O+12>>2]|0,(y|0)==(_|0)){g[5857]=g[5857]&~(1<<b),c=O,y=M;break}else{g[_+12>>2]=y,g[y+8>>2]=_,c=O,y=M;break}T=g[O+24>>2]|0,_=g[O+12>>2]|0;do if((_|0)==(O|0)){if(y=O+16|0,b=y+4|0,_=g[b>>2]|0,_)y=b;else if(_=g[y>>2]|0,!_){_=0;break}for(;;)if(w=_+20|0,b=g[w>>2]|0,b)_=b,y=w;else if(w=_+16|0,b=g[w>>2]|0,b)_=b,y=w;else break;g[y>>2]=0}else c=g[O+8>>2]|0,g[c+12>>2]=_,g[_+8>>2]=c;while(!1);if(T){if(y=g[O+28>>2]|0,b=23732+(y<<2)|0,(g[b>>2]|0)==(O|0)){if(g[b>>2]=_,!_){g[5858]=g[5858]&~(1<<y),c=O,y=M;break}}else if(c=T+16|0,g[((g[c>>2]|0)==(O|0)?c:T+20|0)>>2]=_,!_){c=O,y=M;break}g[_+24>>2]=T,y=O+16|0,b=g[y>>2]|0,b|0&&(g[_+16>>2]=b,g[b+24>>2]=_),y=g[y+4>>2]|0,y?(g[_+20>>2]=y,g[y+24>>2]=_,c=O,y=M):(c=O,y=M)}else c=O,y=M}while(!1);if(!(O>>>0>=d>>>0)&&(_=d+4|0,w=g[_>>2]|0,!!(w&1))){if(w&2)g[_>>2]=w&-2,g[c+4>>2]=y|1,g[O+y>>2]=y,T=y;else{if((g[5863]|0)==(d|0)){if(d=(g[5860]|0)+y|0,g[5860]=d,g[5863]=c,g[c+4>>2]=d|1,(c|0)!=(g[5862]|0))return;g[5862]=0,g[5859]=0;return}if((g[5862]|0)==(d|0)){d=(g[5859]|0)+y|0,g[5859]=d,g[5862]=O,g[c+4>>2]=d|1,g[O+d>>2]=d;return}T=(w&-8)+y|0,b=w>>>3;do if(w>>>0<256)if(y=g[d+8>>2]|0,_=g[d+12>>2]|0,(_|0)==(y|0)){g[5857]=g[5857]&~(1<<b);break}else{g[y+12>>2]=_,g[_+8>>2]=y;break}else{M=g[d+24>>2]|0,_=g[d+12>>2]|0;do if((_|0)==(d|0)){if(y=d+16|0,b=y+4|0,_=g[b>>2]|0,_)y=b;else if(_=g[y>>2]|0,!_){b=0;break}for(;;)if(w=_+20|0,b=g[w>>2]|0,b)_=b,y=w;else if(w=_+16|0,b=g[w>>2]|0,b)_=b,y=w;else break;g[y>>2]=0,b=_}else b=g[d+8>>2]|0,g[b+12>>2]=_,g[_+8>>2]=b,b=_;while(!1);if(M|0){if(_=g[d+28>>2]|0,y=23732+(_<<2)|0,(g[y>>2]|0)==(d|0)){if(g[y>>2]=b,!b){g[5858]=g[5858]&~(1<<_);break}}else if(w=M+16|0,g[((g[w>>2]|0)==(d|0)?w:M+20|0)>>2]=b,!b)break;g[b+24>>2]=M,_=d+16|0,y=g[_>>2]|0,y|0&&(g[b+16>>2]=y,g[y+24>>2]=b),_=g[_+4>>2]|0,_|0&&(g[b+20>>2]=_,g[_+24>>2]=b)}}while(!1);if(g[c+4>>2]=T|1,g[O+T>>2]=T,(c|0)==(g[5862]|0)){g[5859]=T;return}}if(_=T>>>3,T>>>0<256){b=23468+(_<<1<<2)|0,y=g[5857]|0,_=1<<_,y&_?(y=b+8|0,_=g[y>>2]|0):(g[5857]=y|_,_=b,y=b+8|0),g[y>>2]=c,g[_+12>>2]=c,g[c+8>>2]=_,g[c+12>>2]=b;return}_=T>>>8,_?T>>>0>16777215?w=31:(O=(_+1048320|0)>>>16&8,d=_<<O,M=(d+520192|0)>>>16&4,d=d<<M,w=(d+245760|0)>>>16&2,w=14-(M|O|w)+(d<<w>>>15)|0,w=T>>>(w+7|0)&1|w<<1):w=0,_=23732+(w<<2)|0,g[c+28>>2]=w,g[c+20>>2]=0,g[c+16>>2]=0,y=g[5858]|0,b=1<<w;t:do if(!(y&b))g[5858]=y|b,g[_>>2]=c,g[c+24>>2]=_,g[c+12>>2]=c,g[c+8>>2]=c;else{_=g[_>>2]|0;e:do if((g[_+4>>2]&-8|0)!=(T|0)){for(w=T<<((w|0)==31?0:25-(w>>>1)|0);b=_+16+(w>>>31<<2)|0,y=g[b>>2]|0,!!y;)if((g[y+4>>2]&-8|0)==(T|0)){_=y;break e}else w=w<<1,_=y;g[b>>2]=c,g[c+24>>2]=_,g[c+12>>2]=c,g[c+8>>2]=c;break t}while(!1);O=_+8|0,d=g[O>>2]|0,g[d+12>>2]=c,g[O>>2]=c,g[c+8>>2]=d,g[c+12>>2]=_,g[c+24>>2]=0}while(!1);if(d=(g[5865]|0)+-1|0,g[5865]=d,!(d|0)){for(_=23884;_=g[_>>2]|0,_;)_=_+8|0;g[5865]=-1}}}}function fs(_,y){_=_|0,y=y|0;var b=0;return _?(b=Ji(y,_)|0,(y|_)>>>0>65535&&(b=((b>>>0)/(_>>>0)|0|0)==(y|0)?b:-1)):b=0,_=Qn(b)|0,!_||!(g[_+-4>>2]&3)||aa(_|0,0,b|0)|0,_|0}function pn(_,y,b,w){return _=_|0,y=y|0,b=b|0,w=w|0,b=_+b>>>0,yi(y+w+(b>>>0<_>>>0|0)>>>0|0),b|0|0}function Ki(_,y,b,w){return _=_|0,y=y|0,b=b|0,w=w|0,w=y-w-(b>>>0>_>>>0|0)>>>0,yi(w|0),_-b>>>0|0|0}function Fr(_){return _=_|0,(_?31-(Xi(_^_-1)|0)|0:32)|0}function Mu(_,y,b,w,T){_=_|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,c=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0;if(m=_,d=y,f=d,O=b,P=w,c=P,!f)return M=(T|0)!=0,c?M?(g[T>>2]=_|0,g[T+4>>2]=y&0,P=0,T=0,yi(P|0),T|0):(P=0,T=0,yi(P|0),T|0):(M&&(g[T>>2]=(m>>>0)%(O>>>0),g[T+4>>2]=0),P=0,T=(m>>>0)/(O>>>0)>>>0,yi(P|0),T|0);M=(c|0)==0;do if(O){if(!M){if(M=(Xi(c|0)|0)-(Xi(f|0)|0)|0,M>>>0<=31){E=M+1|0,c=31-M|0,y=M-31>>31,O=E,_=m>>>(E>>>0)&y|f<<c,y=f>>>(E>>>0)&y,M=0,c=m<<c;break}return T?(g[T>>2]=_|0,g[T+4>>2]=d|y&0,P=0,T=0,yi(P|0),T|0):(P=0,T=0,yi(P|0),T|0)}if(M=O-1|0,M&O|0){c=(Xi(O|0)|0)+33-(Xi(f|0)|0)|0,F=64-c|0,E=32-c|0,d=E>>31,R=c-32|0,y=R>>31,O=c,_=E-1>>31&f>>>(R>>>0)|(f<<E|m>>>(c>>>0))&y,y=y&f>>>(c>>>0),M=m<<F&d,c=(f<<F|m>>>(R>>>0))&d|m<<E&c-33>>31;break}return T|0&&(g[T>>2]=M&m,g[T+4>>2]=0),(O|0)==1?(R=d|y&0,F=_|0|0,yi(R|0),F|0):(F=Fr(O|0)|0,R=f>>>(F>>>0)|0,F=f<<32-F|m>>>(F>>>0)|0,yi(R|0),F|0)}else{if(M)return T|0&&(g[T>>2]=(f>>>0)%(O>>>0),g[T+4>>2]=0),R=0,F=(f>>>0)/(O>>>0)>>>0,yi(R|0),F|0;if(!m)return T|0&&(g[T>>2]=0,g[T+4>>2]=(f>>>0)%(c>>>0)),R=0,F=(f>>>0)/(c>>>0)>>>0,yi(R|0),F|0;if(M=c-1|0,!(M&c))return T|0&&(g[T>>2]=_|0,g[T+4>>2]=M&f|y&0),R=0,F=f>>>((Fr(c|0)|0)>>>0),yi(R|0),F|0;if(M=(Xi(c|0)|0)-(Xi(f|0)|0)|0,M>>>0<=30){y=M+1|0,c=31-M|0,O=y,_=f<<c|m>>>(y>>>0),y=f>>>(y>>>0),M=0,c=m<<c;break}return T?(g[T>>2]=_|0,g[T+4>>2]=d|y&0,R=0,F=0,yi(R|0),F|0):(R=0,F=0,yi(R|0),F|0)}while(!1);if(!O)f=c,d=0,c=0;else{E=b|0|0,m=P|w&0,f=pn(E|0,m|0,-1,-1)|0,b=Bt()|0,d=c,c=0;do w=d,d=M>>>31|d<<1,M=c|M<<1,w=_<<1|w>>>31|0,P=_>>>31|y<<1|0,Ki(f|0,b|0,w|0,P|0)|0,F=Bt()|0,R=F>>31|((F|0)<0?-1:0)<<1,c=R&1,_=Ki(w|0,P|0,R&E|0,(((F|0)<0?-1:0)>>31|((F|0)<0?-1:0)<<1)&m|0)|0,y=Bt()|0,O=O-1|0;while((O|0)!=0);f=d,d=0}return O=0,T|0&&(g[T>>2]=_,g[T+4>>2]=y),R=(M|0)>>>31|(f|O)<<1|(O<<1|M>>>31)&0|d,F=(M<<1|0)&-2|c,yi(R|0),F|0}function Zo(_,y,b,w){_=_|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0;return f=y>>31|((y|0)<0?-1:0)<<1,d=((y|0)<0?-1:0)>>31|((y|0)<0?-1:0)<<1,M=w>>31|((w|0)<0?-1:0)<<1,T=((w|0)<0?-1:0)>>31|((w|0)<0?-1:0)<<1,c=Ki(f^_|0,d^y|0,f|0,d|0)|0,O=Bt()|0,_=M^f,y=T^d,Ki((Mu(c,O,Ki(M^b|0,T^w|0,M|0,T|0)|0,Bt()|0,0)|0)^_|0,(Bt()|0)^y|0,_|0,y|0)|0}function Oh(_,y){_=_|0,y=y|0;var b=0,w=0,T=0,M=0;return M=_&65535,T=y&65535,b=Ji(T,M)|0,w=_>>>16,_=(b>>>16)+(Ji(T,w)|0)|0,T=y>>>16,y=Ji(T,M)|0,yi((_>>>16)+(Ji(T,w)|0)+(((_&65535)+y|0)>>>16)|0),_+y<<16|b&65535|0|0}function pr(_,y,b,w){_=_|0,y=y|0,b=b|0,w=w|0;var T=0,M=0;return T=_,M=b,b=Oh(T,M)|0,_=Bt()|0,yi((Ji(y,M)|0)+(Ji(w,T)|0)+_|_&0|0),b|0|0|0}function oo(_,y,b,w){_=_|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,c=0,d=0,f=0;return T=Tt,Tt=Tt+16|0,c=T|0,O=y>>31|((y|0)<0?-1:0)<<1,M=((y|0)<0?-1:0)>>31|((y|0)<0?-1:0)<<1,f=w>>31|((w|0)<0?-1:0)<<1,d=((w|0)<0?-1:0)>>31|((w|0)<0?-1:0)<<1,_=Ki(O^_|0,M^y|0,O|0,M|0)|0,y=Bt()|0,Mu(_,y,Ki(f^b|0,d^w|0,f|0,d|0)|0,Bt()|0,c)|0,w=Ki(g[c>>2]^O|0,g[c+4>>2]^M|0,O|0,M|0)|0,b=Bt()|0,Tt=T,yi(b|0),w|0}function Ss(_,y,b,w){_=_|0,y=y|0,b=b|0,w=w|0;var T=0,M=0;return M=Tt,Tt=Tt+16|0,T=M|0,Mu(_,y,b,w,T)|0,Tt=M,yi(g[T+4>>2]|0),g[T>>2]|0|0}function Is(_,y,b){return _=_|0,y=y|0,b=b|0,(b|0)<32?(yi(y>>b|0),_>>>b|(y&(1<<b)-1)<<32-b):(yi(((y|0)<0?-1:0)|0),y>>b-32|0)}function Ke(_,y,b){return _=_|0,y=y|0,b=b|0,(b|0)<32?(yi(y>>>b|0),_>>>b|(y&(1<<b)-1)<<32-b):(yi(0),y>>>b-32|0)}function ii(_,y,b){return _=_|0,y=y|0,b=b|0,(b|0)<32?(yi(y<<b|(_&(1<<b)-1<<32-b)>>>32-b|0),_<<b):(yi(_<<b-32|0),0)}function Wl(_,y){return _=+_,y=+y,_!=_?+y:y!=y?+_:+vr(+_,+y)}function kc(_,y){return _=+_,y=+y,_!=_?+y:y!=y?+_:+Gi(+_,+y)}function sa(_){return _=+_,_>=0?+Be(_+.5):+Wi(_-.5)}function Ns(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0;if((b|0)>=8192)return xa(_|0,y|0,b|0)|0,_|0;if(M=_|0,T=_+b|0,(_&3)==(y&3)){for(;_&3;){if(!b)return M|0;Et[_>>0]=Et[y>>0]|0,_=_+1|0,y=y+1|0,b=b-1|0}for(b=T&-4|0,w=b-64|0;(_|0)<=(w|0);)g[_>>2]=g[y>>2],g[_+4>>2]=g[y+4>>2],g[_+8>>2]=g[y+8>>2],g[_+12>>2]=g[y+12>>2],g[_+16>>2]=g[y+16>>2],g[_+20>>2]=g[y+20>>2],g[_+24>>2]=g[y+24>>2],g[_+28>>2]=g[y+28>>2],g[_+32>>2]=g[y+32>>2],g[_+36>>2]=g[y+36>>2],g[_+40>>2]=g[y+40>>2],g[_+44>>2]=g[y+44>>2],g[_+48>>2]=g[y+48>>2],g[_+52>>2]=g[y+52>>2],g[_+56>>2]=g[y+56>>2],g[_+60>>2]=g[y+60>>2],_=_+64|0,y=y+64|0;for(;(_|0)<(b|0);)g[_>>2]=g[y>>2],_=_+4|0,y=y+4|0}else for(b=T-4|0;(_|0)<(b|0);)Et[_>>0]=Et[y>>0]|0,Et[_+1>>0]=Et[y+1>>0]|0,Et[_+2>>0]=Et[y+2>>0]|0,Et[_+3>>0]=Et[y+3>>0]|0,_=_+4|0,y=y+4|0;for(;(_|0)<(T|0);)Et[_>>0]=Et[y>>0]|0,_=_+1|0,y=y+1|0;return M|0}function aa(_,y,b){_=_|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0;if(M=_+b|0,y=y&255,(b|0)>=67){for(;_&3;)Et[_>>0]=y,_=_+1|0;for(w=M&-4|0,O=y|y<<8|y<<16|y<<24,T=w-64|0;(_|0)<=(T|0);)g[_>>2]=O,g[_+4>>2]=O,g[_+8>>2]=O,g[_+12>>2]=O,g[_+16>>2]=O,g[_+20>>2]=O,g[_+24>>2]=O,g[_+28>>2]=O,g[_+32>>2]=O,g[_+36>>2]=O,g[_+40>>2]=O,g[_+44>>2]=O,g[_+48>>2]=O,g[_+52>>2]=O,g[_+56>>2]=O,g[_+60>>2]=O,_=_+64|0;for(;(_|0)<(w|0);)g[_>>2]=O,_=_+4|0}for(;(_|0)<(M|0);)Et[_>>0]=y,_=_+1|0;return M-b|0}function la(_){return _=+_,_>=0?+Be(_+.5):+Wi(_-.5)}function xo(_){_=_|0;var y=0,b=0,w=0;return w=Wr()|0,b=g[Zt>>2]|0,y=b+_|0,(_|0)>0&(y|0)<(b|0)|(y|0)<0?(Jn(y|0)|0,tn(12),-1):(y|0)>(w|0)&&!(hr(y|0)|0)?(tn(12),-1):(g[Zt>>2]=y,b|0)}return{___divdi3:Zo,___muldi3:pr,___remdi3:oo,___uremdi3:Ss,_areNeighborCells:Ia,_bitshift64Ashr:Is,_bitshift64Lshr:Ke,_bitshift64Shl:ii,_calloc:fs,_cellAreaKm2:Un,_cellAreaM2:Ko,_cellAreaRads2:un,_cellToBoundary:Nl,_cellToCenterChild:cA,_cellToChildPos:bu,_cellToChildren:Nn,_cellToChildrenSize:Ic,_cellToLatLng:kl,_cellToLocalIj:Wf,_cellToParent:ea,_cellToVertex:Vi,_cellToVertexes:ks,_cellsToDirectedEdge:qa,_cellsToLinkedMultiPolygon:zi,_childPosToCell:hA,_compactCells:Ll,_destroyLinkedMultiPolygon:Vl,_directedEdgeToBoundary:pu,_directedEdgeToCells:kf,_edgeLengthKm:zl,_edgeLengthM:Oc,_edgeLengthRads:Dc,_emscripten_replace_memory:Ks,_free:Ni,_getBaseCellNumber:Bh,_getDirectedEdgeDestination:Ma,_getDirectedEdgeOrigin:$a,_getHexagonAreaAvgKm2:Hf,_getHexagonAreaAvgM2:al,_getHexagonEdgeLengthAvgKm:Kn,_getHexagonEdgeLengthAvgM:Cu,_getIcosahedronFaces:Ul,_getNumCells:ia,_getPentagons:Mc,_getRes0Cells:Lf,_getResolution:tl,_greatCircleDistanceKm:sl,_greatCircleDistanceM:Th,_greatCircleDistanceRads:wu,_gridDisk:Dn,_gridDiskDistances:vo,_gridDistance:ai,_gridPathCells:Eu,_gridPathCellsSize:Ro,_gridRingUnsafe:gt,_i64Add:pn,_i64Subtract:Ki,_isPentagon:On,_isResClassIII:jf,_isValidCell:ta,_isValidDirectedEdge:Ff,_isValidVertex:Xr,_latLngToCell:il,_llvm_maxnum_f64:Wl,_llvm_minnum_f64:kc,_llvm_round_f64:sa,_localIjToCell:Er,_malloc:Qn,_maxFaceCount:rl,_maxGridDiskSize:Mr,_maxPolygonToCellsSize:Pt,_memcpy:Ns,_memset:aa,_originToDirectedEdges:Mn,_pentagonCount:vu,_polygonToCells:xe,_readInt64AsDoubleFromPointer:Oo,_res0CellCount:Ec,_round:la,_sbrk:xo,_sizeOfCellBoundary:Ph,_sizeOfCoordIJ:Su,_sizeOfGeoLoop:cs,_sizeOfGeoPolygon:Do,_sizeOfH3Index:Mh,_sizeOfLatLng:Bu,_sizeOfLinkedGeoPolygon:Tu,_uncompactCells:Vf,_uncompactCellsSize:uA,_vertexToLatLng:us,establishStackSpace:fr,stackAlloc:Xn,stackRestore:Lr,stackSave:Qs}}(mt,Ve,kt);t.___divdi3=Ce.___divdi3,t.___muldi3=Ce.___muldi3,t.___remdi3=Ce.___remdi3,t.___uremdi3=Ce.___uremdi3,t._areNeighborCells=Ce._areNeighborCells,t._bitshift64Ashr=Ce._bitshift64Ashr,t._bitshift64Lshr=Ce._bitshift64Lshr,t._bitshift64Shl=Ce._bitshift64Shl,t._calloc=Ce._calloc,t._cellAreaKm2=Ce._cellAreaKm2,t._cellAreaM2=Ce._cellAreaM2,t._cellAreaRads2=Ce._cellAreaRads2,t._cellToBoundary=Ce._cellToBoundary,t._cellToCenterChild=Ce._cellToCenterChild,t._cellToChildPos=Ce._cellToChildPos,t._cellToChildren=Ce._cellToChildren,t._cellToChildrenSize=Ce._cellToChildrenSize,t._cellToLatLng=Ce._cellToLatLng,t._cellToLocalIj=Ce._cellToLocalIj,t._cellToParent=Ce._cellToParent,t._cellToVertex=Ce._cellToVertex,t._cellToVertexes=Ce._cellToVertexes,t._cellsToDirectedEdge=Ce._cellsToDirectedEdge,t._cellsToLinkedMultiPolygon=Ce._cellsToLinkedMultiPolygon,t._childPosToCell=Ce._childPosToCell,t._compactCells=Ce._compactCells,t._destroyLinkedMultiPolygon=Ce._destroyLinkedMultiPolygon,t._directedEdgeToBoundary=Ce._directedEdgeToBoundary,t._directedEdgeToCells=Ce._directedEdgeToCells,t._edgeLengthKm=Ce._edgeLengthKm,t._edgeLengthM=Ce._edgeLengthM,t._edgeLengthRads=Ce._edgeLengthRads;var H=t._emscripten_replace_memory=Ce._emscripten_replace_memory;t._free=Ce._free,t._getBaseCellNumber=Ce._getBaseCellNumber,t._getDirectedEdgeDestination=Ce._getDirectedEdgeDestination,t._getDirectedEdgeOrigin=Ce._getDirectedEdgeOrigin,t._getHexagonAreaAvgKm2=Ce._getHexagonAreaAvgKm2,t._getHexagonAreaAvgM2=Ce._getHexagonAreaAvgM2,t._getHexagonEdgeLengthAvgKm=Ce._getHexagonEdgeLengthAvgKm,t._getHexagonEdgeLengthAvgM=Ce._getHexagonEdgeLengthAvgM,t._getIcosahedronFaces=Ce._getIcosahedronFaces,t._getNumCells=Ce._getNumCells,t._getPentagons=Ce._getPentagons,t._getRes0Cells=Ce._getRes0Cells,t._getResolution=Ce._getResolution,t._greatCircleDistanceKm=Ce._greatCircleDistanceKm,t._greatCircleDistanceM=Ce._greatCircleDistanceM,t._greatCircleDistanceRads=Ce._greatCircleDistanceRads,t._gridDisk=Ce._gridDisk,t._gridDiskDistances=Ce._gridDiskDistances,t._gridDistance=Ce._gridDistance,t._gridPathCells=Ce._gridPathCells,t._gridPathCellsSize=Ce._gridPathCellsSize,t._gridRingUnsafe=Ce._gridRingUnsafe,t._i64Add=Ce._i64Add,t._i64Subtract=Ce._i64Subtract,t._isPentagon=Ce._isPentagon,t._isResClassIII=Ce._isResClassIII,t._isValidCell=Ce._isValidCell,t._isValidDirectedEdge=Ce._isValidDirectedEdge,t._isValidVertex=Ce._isValidVertex,t._latLngToCell=Ce._latLngToCell,t._llvm_maxnum_f64=Ce._llvm_maxnum_f64,t._llvm_minnum_f64=Ce._llvm_minnum_f64,t._llvm_round_f64=Ce._llvm_round_f64,t._localIjToCell=Ce._localIjToCell,t._malloc=Ce._malloc,t._maxFaceCount=Ce._maxFaceCount,t._maxGridDiskSize=Ce._maxGridDiskSize,t._maxPolygonToCellsSize=Ce._maxPolygonToCellsSize,t._memcpy=Ce._memcpy,t._memset=Ce._memset,t._originToDirectedEdges=Ce._originToDirectedEdges,t._pentagonCount=Ce._pentagonCount,t._polygonToCells=Ce._polygonToCells,t._readInt64AsDoubleFromPointer=Ce._readInt64AsDoubleFromPointer,t._res0CellCount=Ce._res0CellCount,t._round=Ce._round,t._sbrk=Ce._sbrk,t._sizeOfCellBoundary=Ce._sizeOfCellBoundary,t._sizeOfCoordIJ=Ce._sizeOfCoordIJ,t._sizeOfGeoLoop=Ce._sizeOfGeoLoop,t._sizeOfGeoPolygon=Ce._sizeOfGeoPolygon,t._sizeOfH3Index=Ce._sizeOfH3Index,t._sizeOfLatLng=Ce._sizeOfLatLng,t._sizeOfLinkedGeoPolygon=Ce._sizeOfLinkedGeoPolygon,t._uncompactCells=Ce._uncompactCells,t._uncompactCellsSize=Ce._uncompactCellsSize,t._vertexToLatLng=Ce._vertexToLatLng,t.establishStackSpace=Ce.establishStackSpace;var ve=t.stackAlloc=Ce.stackAlloc,Te=t.stackRestore=Ce.stackRestore,wt=t.stackSave=Ce.stackSave;if(t.asm=Ce,t.cwrap=Z,t.setValue=L,t.getValue=N,gn){Wn(gn)||(gn=s(gn));{ur();var Kt=function(pt){pt.byteLength&&(pt=new Uint8Array(pt)),ht.set(pt,S),t.memoryInitializerRequest&&delete t.memoryInitializerRequest.response,$n()},ce=function(){o(gn,Kt,function(){throw"could not load memory initializer "+gn})},Y=De(gn);if(Y)Kt(Y.buffer);else if(t.memoryInitializerRequest){var nt=function(){var pt=t.memoryInitializerRequest,bt=pt.response;if(pt.status!==200&&pt.status!==0){var lt=De(t.memoryInitializerRequestURL);if(lt)bt=lt.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+pt.status+", retrying "+gn),ce();return}}Kt(bt)};t.memoryInitializerRequest.response?setTimeout(nt,0):t.memoryInitializerRequest.addEventListener("load",nt)}else ce()}}var ct;Ri=function pt(){ct||vt(),ct||(Ri=pt)};function vt(pt){if(cn>0||(Ze(),cn>0))return;function bt(){ct||(ct=!0,!G&&(Ye(),ze(),t.onRuntimeInitialized&&t.onRuntimeInitialized(),pi()))}t.setStatus?(t.setStatus("Running..."),setTimeout(function(){setTimeout(function(){t.setStatus("")},1),bt()},1)):bt()}t.run=vt;function Ft(pt){throw t.onAbort&&t.onAbort(pt),pt+="",l(pt),h(pt),G=!0,"abort("+pt+"). Build with -s ASSERTIONS=1 for more info."}if(t.abort=Ft,t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.pop()();return vt(),e}(typeof Fi=="object"?Fi:{}),_n="number",an=_n,Wg=_n,fn=_n,dn=_n,vs=_n,Pi=_n,sAt=[["sizeOfH3Index",_n],["sizeOfLatLng",_n],["sizeOfCellBoundary",_n],["sizeOfGeoLoop",_n],["sizeOfGeoPolygon",_n],["sizeOfLinkedGeoPolygon",_n],["sizeOfCoordIJ",_n],["readInt64AsDoubleFromPointer",_n],["isValidCell",Wg,[fn,dn]],["latLngToCell",an,[_n,_n,vs,Pi]],["cellToLatLng",an,[fn,dn,Pi]],["cellToBoundary",an,[fn,dn,Pi]],["maxGridDiskSize",an,[_n,Pi]],["gridDisk",an,[fn,dn,_n,Pi]],["gridDiskDistances",an,[fn,dn,_n,Pi,Pi]],["gridRingUnsafe",an,[fn,dn,_n,Pi]],["maxPolygonToCellsSize",an,[Pi,vs,_n,Pi]],["polygonToCells",an,[Pi,vs,_n,Pi]],["cellsToLinkedMultiPolygon",an,[Pi,_n,Pi]],["destroyLinkedMultiPolygon",null,[Pi]],["compactCells",an,[Pi,Pi,_n,_n]],["uncompactCells",an,[Pi,_n,_n,Pi,_n,vs]],["uncompactCellsSize",an,[Pi,_n,_n,vs,Pi]],["isPentagon",Wg,[fn,dn]],["isResClassIII",Wg,[fn,dn]],["getBaseCellNumber",_n,[fn,dn]],["getResolution",_n,[fn,dn]],["maxFaceCount",an,[fn,dn,Pi]],["getIcosahedronFaces",an,[fn,dn,Pi]],["cellToParent",an,[fn,dn,vs,Pi]],["cellToChildren",an,[fn,dn,vs,Pi]],["cellToCenterChild",an,[fn,dn,vs,Pi]],["cellToChildrenSize",an,[fn,dn,vs,Pi]],["cellToChildPos",an,[fn,dn,vs,Pi]],["childPosToCell",an,[_n,_n,fn,dn,vs,Pi]],["areNeighborCells",an,[fn,dn,fn,dn,Pi]],["cellsToDirectedEdge",an,[fn,dn,fn,dn,Pi]],["getDirectedEdgeOrigin",an,[fn,dn,Pi]],["getDirectedEdgeDestination",an,[fn,dn,Pi]],["isValidDirectedEdge",Wg,[fn,dn]],["directedEdgeToCells",an,[fn,dn,Pi]],["originToDirectedEdges",an,[fn,dn,Pi]],["directedEdgeToBoundary",an,[fn,dn,Pi]],["gridDistance",an,[fn,dn,fn,dn,Pi]],["gridPathCells",an,[fn,dn,fn,dn,Pi]],["gridPathCellsSize",an,[fn,dn,fn,dn,Pi]],["cellToLocalIj",an,[fn,dn,fn,dn,_n,Pi]],["localIjToCell",an,[fn,dn,Pi,_n,Pi]],["getHexagonAreaAvgM2",an,[vs,Pi]],["getHexagonAreaAvgKm2",an,[vs,Pi]],["getHexagonEdgeLengthAvgM",an,[vs,Pi]],["getHexagonEdgeLengthAvgKm",an,[vs,Pi]],["greatCircleDistanceM",_n,[Pi,Pi]],["greatCircleDistanceKm",_n,[Pi,Pi]],["greatCircleDistanceRads",_n,[Pi,Pi]],["cellAreaM2",an,[fn,dn,Pi]],["cellAreaKm2",an,[fn,dn,Pi]],["cellAreaRads2",an,[fn,dn,Pi]],["edgeLengthM",an,[fn,dn,Pi]],["edgeLengthKm",an,[fn,dn,Pi]],["edgeLengthRads",an,[fn,dn,Pi]],["getNumCells",an,[vs,Pi]],["getRes0Cells",an,[Pi]],["res0CellCount",_n],["getPentagons",an,[_n,Pi]],["pentagonCount",_n],["cellToVertex",an,[fn,dn,_n,Pi]],["cellToVertexes",an,[fn,dn,Pi]],["vertexToLatLng",an,[fn,dn,Pi]],["isValidVertex",Wg,[fn,dn]]],aAt=0,lAt=1,cAt=2,uAt=3,JL=4,hAt=5,fAt=6,dAt=7,pAt=8,AAt=9,gAt=10,mAt=11,yAt=12,_At=13,vAt=14,bAt=15,ns={};ns[aAt]="Success",ns[lAt]="The operation failed but a more specific error is not available",ns[cAt]="Argument was outside of acceptable range",ns[uAt]="Latitude or longitude arguments were outside of acceptable range",ns[JL]="Resolution argument was outside of acceptable range",ns[hAt]="Cell argument was not valid",ns[fAt]="Directed edge argument was not valid",ns[dAt]="Undirected edge argument was not valid",ns[pAt]="Vertex argument was not valid",ns[AAt]="Pentagon distortion was encountered",ns[gAt]="Duplicate input",ns[mAt]="Cell arguments were not neighbors",ns[yAt]="Cell arguments had incompatible resolutions",ns[_At]="Memory allocation failed",ns[vAt]="Bounds of provided memory were insufficient",ns[bAt]="Mode or flags argument was not valid";var bw=1e3,XL=1001,KL=1002,u_={};u_[bw]="Unknown unit",u_[XL]="Array length out of bounds",u_[KL]="Got unexpected null value for H3 index";var xAt="Unknown error";function QL(e,t,i){var n=i&&"value"in i,r=new Error((e[t]||xAt)+" (code: "+t+(n?", value: "+i.value:"")+")");return r.code=t,r}function ZL(e,t){var i=arguments.length===2?{value:t}:{};return QL(ns,e,i)}function h_(e,t){var i=arguments.length===2?{value:t}:{};return QL(u_,e,i)}function bs(e){if(e!==0)throw ZL(e)}var lr={};sAt.forEach(function(e){lr[e[0]]=Fi.cwrap.apply(Fi,e)});var wp=16,Cp=4,YL=4,mc=8,xw=8,Ah=lr.sizeOfH3Index(),ww=lr.sizeOfLatLng(),wAt=lr.sizeOfCellBoundary(),CAt=lr.sizeOfGeoPolygon(),Jg=lr.sizeOfGeoLoop(),EAt=lr.sizeOfLinkedGeoPolygon();lr.sizeOfCoordIJ();var Ep={m:"m",m2:"m2",km:"km",km2:"km2",rads:"rads",rads2:"rads2"};function qL(e){if(typeof e!="number"||e<0||e>15||Math.floor(e)!==e)throw ZL(JL,e);return e}function $L(e){if(!e)throw h_(KL);return e}var BAt=Math.pow(2,32)-1;function tF(e){if(e>BAt)throw h_(XL,e);return e}var TAt=/[^0-9a-fA-F]/;function El(e){if(Array.isArray(e)&&e.length===2&&Number.isInteger(e[0])&&Number.isInteger(e[1]))return e;if(typeof e!="string"||TAt.test(e))return[0,0];var t=parseInt(e.substring(0,e.length-8),wp),i=parseInt(e.substring(e.length-8),wp);return[i,t]}function eF(e){if(e>=0)return e.toString(wp);e=e&2147483647;var t=iF(8,e.toString(wp)),i=(parseInt(t[0],wp)+8).toString(wp);return t=i+t.substring(1),t}function SAt(e,t){return eF(t)+iF(8,eF(e))}function iF(e,t){for(var i=e-t.length,n="",r=0;r<i;r++)n+="0";return n=n+t,n}function nF(e,t,i){for(var n=e.length,r=Fi._calloc(n,ww),s=i?1:0,o=i?0:1,l=0;l<n*2;l+=2)Fi.HEAPF64.set([e[l/2][s],e[l/2][o]].map(lF),r/mc+l);return Fi.HEAPU32.set([n,r],t/Cp),t}function IAt(e,t){var i=e.length-1,n=Fi._calloc(CAt),r=0,s=r+Jg,o=s+Cp;nF(e[0],n+r,t);var l;if(i>0){l=Fi._calloc(i,Jg);for(var h=0;h<i;h++)nF(e[h+1],l+Jg*h,t)}return Fi.setValue(n+s,i,"i32"),Fi.setValue(n+o,l,"i32"),n}function MAt(e){var t=0,i=t+Jg,n=i+Cp,r=Cp;Fi._free(Fi.getValue(e+t+r,"i8*"));var s=Fi.getValue(e+i,"i32");if(s>0){for(var o=Fi.getValue(e+n,"i32"),l=0;l<s;l++)Fi._free(Fi.getValue(o+Jg*l+r,"i8*"));Fi._free(o)}Fi._free(e)}function Cw(e,t){t===void 0&&(t=0);var i=Fi.getValue(e+Ah*t,"i32"),n=Fi.getValue(e+Ah*t+Cp,"i32");return n?SAt(i,n):null}function rF(e,t){return t===void 0&&(t=0),Fi.getValue(e+mc*t,"double")}function Ew(e){return lr.readInt64AsDoubleFromPointer(e)}function PAt(e,t,i){Fi.HEAPU32.set(El(e),t/Cp+2*i)}function Bw(e,t){for(var i=[],n=0;n<t;n++){var r=Cw(e,n);r!==null&&i.push(r)}return i}function RAt(e,t){for(var i=t.length,n=0;n<i;n++)PAt(t[n],e,n)}function f_(e){return HAt(Fi.getValue(e,"double"))}function oF(e){return[f_(e),f_(e+mc)]}function sF(e){return[f_(e+mc),f_(e)]}function DAt(e,t,i){for(var n=Fi.getValue(e,"i32"),r=e+mc,s=[],o=t?sF:oF,l=0;l<n*2;l+=2)s.push(o(r+mc*l));return i&&s.push(s[0]),s}function OAt(e,t){for(var i=[],n=sF,r,s,o,l;e;){for(i.push(r=[]),s=Fi.getValue(e,"i8*");s;){for(r.push(o=[]),l=Fi.getValue(s,"i8*");l;)o.push(n(l)),l=Fi.getValue(l+mc*2,"i8*");o.push(o[0]),s=Fi.getValue(s+YL*2,"i8*")}e=Fi.getValue(e+YL*2,"i8*")}return i}function LAt(e){var t=El(e),i=t[0],n=t[1];return!!lr.isPentagon(i,n)}function Tw(e){var t=El(e),i=t[0],n=t[1];return lr.isValidCell(i,n)?lr.getResolution(i,n):-1}function Sw(e,t,i){var n=Fi._malloc(ww);Fi.HEAPF64.set([e,t].map(lF),n/mc);var r=Fi._malloc(Ah);try{return bs(lr.latLngToCell(n,i,r)),$L(Cw(r))}finally{Fi._free(r),Fi._free(n)}}function Iw(e){var t=Fi._malloc(ww),i=El(e),n=i[0],r=i[1];try{return bs(lr.cellToLatLng(n,r,t)),oF(t)}finally{Fi._free(t)}}function aF(e,t){var i=Fi._malloc(wAt),n=El(e),r=n[0],s=n[1];try{return bs(lr.cellToBoundary(r,s,i)),DAt(i,t,t)}finally{Fi._free(i)}}function FAt(e,t){var i=El(e),n=i[0],r=i[1],s=Fi._malloc(Ah);try{return bs(lr.cellToParent(n,r,t,s)),$L(Cw(s))}finally{Fi._free(s)}}function kAt(e,t){var i=El(e),n=i[0],r=i[1],s=Fi._malloc(xw);try{bs(lr.maxGridDiskSize(t,s));var o=tF(Ew(s)),l=Fi._calloc(o,Ah);try{return bs(lr.gridDisk(n,r,t,l)),Bw(l,o)}finally{Fi._free(l)}}finally{Fi._free(s)}}function NAt(e,t,i){if(qL(t),i=!!i,e.length===0||e[0].length===0)return[];var n=typeof e[0][0]=="number"?[e]:e,r=IAt(n,i),s=Fi._malloc(xw);try{bs(lr.maxPolygonToCellsSize(r,t,0,s));var o=tF(Ew(s)),l=Fi._calloc(o,Ah);try{return bs(lr.polygonToCells(r,t,0,l)),Bw(l,o)}finally{Fi._free(l)}}finally{Fi._free(s),MAt(r)}}function UAt(e,t){if(!e||!e.length)return[];var i=e.length,n=Fi._calloc(i,Ah);RAt(n,e);var r=Fi._calloc(EAt);try{return bs(lr.cellsToLinkedMultiPolygon(n,i,r)),OAt(r,t)}finally{lr.destroyLinkedMultiPolygon(r),Fi._free(r),Fi._free(n)}}function GAt(e){var t=El(e),i=t[0],n=t[1],r=6,s=Fi._calloc(r,Ah);try{return bs(lr.originToDirectedEdges(i,n,s)),Bw(s,r)}finally{Fi._free(s)}}function zAt(e,t){var i=El(e),n=i[0],r=i[1],s=El(t),o=s[0],l=s[1],h=Fi._malloc(xw);try{return bs(lr.gridDistance(n,r,o,l,h)),Ew(h)}finally{Fi._free(h)}}function VAt(e,t){var i=El(e),n=i[0],r=i[1],s=Fi._malloc(mc);try{switch(t){case Ep.m:bs(lr.edgeLengthM(n,r,s));break;case Ep.km:bs(lr.edgeLengthKm(n,r,s));break;case Ep.rads:bs(lr.edgeLengthRads(n,r,s));break;default:throw h_(bw,t)}return rF(s)}finally{Fi._free(s)}}function jAt(e,t){qL(e);var i=Fi._malloc(mc);try{switch(t){case Ep.m:bs(lr.getHexagonEdgeLengthAvgM(e,i));break;case Ep.km:bs(lr.getHexagonEdgeLengthAvgKm(e,i));break;default:throw h_(bw,t)}return rF(i)}finally{Fi._free(i)}}function lF(e){return e*Math.PI/180}function HAt(e){return e*180/Math.PI}function Mw(e,t){t=t===void 0?e[0][0]:t;for(const i of e){const n=i[0]-t;n>180?i[0]-=360:n<-180&&(i[0]+=360)}}function WAt(e,t,i){const[n,r]=Iw(e),s=t.length;Mw(t,r);const o=t[0]===t[s-1]?s-1:s;for(let l=0;l<o;l++)t[l][0]=pl(r,t[l][0],i),t[l][1]=pl(n,t[l][1],i)}function JAt(e,t,i){const n=e(t,i),[r,s]=Iw(n);return[s,r]}function cF(e,t=1){const i=aF(e,!0);return t!==1?WAt(e,i,t):Mw(i),i}function XAt(e){const t=new Float64Array(e.length*2);let i=0;for(const n of e)t[i++]=n[0],t[i++]=n[1];return t}const KAt=10;function QAt(e,t){let i;return e==null?i=t:typeof e=="object"?i={...e,coverage:t}:i={getHexagon:e,coverage:t},i}const ZAt={...fh.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:e=>e.hexagon},extruded:!0};class _c extends Mo{initializeState(){_c._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:t}){return this._shouldUseHighPrecision()?t.propsOrDataChanged:t.somethingChanged}updateState({props:t,changeFlags:i}){if(t.highPrecision!==!0&&(i.dataChanged||i.updateTriggersChanged&&i.updateTriggersChanged.getHexagon)){const n=this._calculateH3DataProps();this.setState(n)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let t=-1,i=!1,n=!1;const{iterable:r,objectInfo:s}=lc(this.props.data);for(const o of r){s.index++;const l=this.props.getHexagon(o,s),h=Tw(l);if(t<0){if(t=h,!this.props.highPrecision)break}else if(t!==h){n=!0;break}if(LAt(l)){i=!0;break}}return{resolution:t,edgeLengthKM:t>=0?jAt(t,"km"):0,hasMultipleRes:n,hasPentagon:i}}_shouldUseHighPrecision(){if(this.props.highPrecision==="auto"){const{resolution:t,hasPentagon:i,hasMultipleRes:n}=this.state,{viewport:r}=this.context;return!!(r!=null&&r.resolution)||n||i||t>=0&&t<=5}return this.props.highPrecision}_updateVertices(t){if(this._shouldUseHighPrecision())return;const{resolution:i,edgeLengthKM:n,centerHex:r}=this.state;if(i<0)return;const s=this.props.centerHexagon||Sw(t.latitude,t.longitude,i);if(r===s)return;if(r)try{if(zAt(r,s)*n<KAt)return}catch{}const{unitsPerMeter:o}=t.distanceScales;let l=cF(s);const[h,A]=Iw(s),[v,C]=t.projectFlat([A,h]);l=l.map(S=>{const L=t.projectFlat(S);return[(L[0]-v)/o[0],(L[1]-C)/o[1]]}),this.setState({centerHex:s,vertices:l})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){const{elevationScale:t,material:i,coverage:n,extruded:r,wireframe:s,stroked:o,filled:l,lineWidthUnits:h,lineWidthScale:A,lineWidthMinPixels:v,lineWidthMaxPixels:C,getFillColor:S,getElevation:L,getLineColor:N,getLineWidth:G,transitions:W,updateTriggers:j}=this.props;return{elevationScale:t,extruded:r,coverage:n,wireframe:s,stroked:o,filled:l,lineWidthUnits:h,lineWidthScale:A,lineWidthMinPixels:v,lineWidthMaxPixels:C,material:i,getElevation:L,getFillColor:S,getLineColor:N,getLineWidth:G,transitions:W,updateTriggers:{getFillColor:j.getFillColor,getElevation:j.getElevation,getLineColor:j.getLineColor,getLineWidth:j.getLineWidth}}}_renderPolygonLayer(){const{data:t,getHexagon:i,updateTriggers:n,coverage:r}=this.props,s=this.getSubLayerClass("hexagon-cell-hifi",fh),o=this._getForwardProps();return o.updateTriggers.getPolygon=QAt(n.getHexagon,r),new s(o,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:o.updateTriggers}),{data:t,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(l,h)=>{const A=i(l,h);return XAt(cF(A,r))}})}_renderColumnLayer(){const{data:t,getHexagon:i,updateTriggers:n}=this.props,r=this.getSubLayerClass("hexagon-cell",dc),s=this._getForwardProps();return s.updateTriggers.getPosition=n.getHexagon,new r(s,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:s.updateTriggers}),{data:t,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:JAt.bind(null,i)})}}_c.defaultProps=ZAt,_c.layerName="H3HexagonLayer",_c._checkH3Lib=()=>{};const YAt={getHexagons:{type:"accessor",value:e=>e.hexagons}};class d_ extends dh{initializeState(){_c._checkH3Lib()}updateState({props:t,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&i.updateTriggersChanged.getHexagons){const{data:n,getHexagons:r}=t,s=[],{iterable:o,objectInfo:l}=lc(n);for(const h of o){l.index++;const A=r(h,l),v=UAt(A,!0);for(const C of v){for(const S of C)Mw(S);s.push(this.getSubLayerRow({polygon:C},h,l.index))}}this.setState({polygons:s})}}indexToBounds(){const{getElevation:t,getFillColor:i,getLineColor:n,getLineWidth:r}=this.props;return{data:this.state.polygons,getPolygon:s=>s.polygon,getElevation:this.getSubLayerAccessor(t),getFillColor:this.getSubLayerAccessor(i),getLineColor:this.getSubLayerAccessor(n),getLineWidth:this.getSubLayerAccessor(r)}}}d_.layerName="H3ClusterLayer",d_.defaultProps=YAt;const Pw=Math.PI/180,p_=new Float32Array(16),uF=new Float32Array(12);function hF(e,t,i){const n=t[0]*Pw,r=t[1]*Pw,s=t[2]*Pw,o=Math.sin(s),l=Math.sin(n),h=Math.sin(r),A=Math.cos(s),v=Math.cos(n),C=Math.cos(r),S=i[0],L=i[1],N=i[2];e[0]=S*C*v,e[1]=S*h*v,e[2]=S*-l,e[3]=L*(-h*A+C*l*o),e[4]=L*(C*A+h*l*o),e[5]=L*v*o,e[6]=N*(h*o+C*l*A),e[7]=N*(-C*o+h*l*A),e[8]=N*v*A}function fF(e){return e[0]=e[0],e[1]=e[1],e[2]=e[2],e[3]=e[4],e[4]=e[5],e[5]=e[6],e[6]=e[8],e[7]=e[9],e[8]=e[10],e[9]=e[12],e[10]=e[13],e[11]=e[14],e.subarray(0,12)}const dF={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(e,{startRow:t,endRow:i}){const{data:n,getOrientation:r,getScale:s,getTranslation:o,getTransformMatrix:l}=this.props,h=Array.isArray(l),A=h&&l.length===16,v=Array.isArray(s),C=Array.isArray(r),S=Array.isArray(o),L=A||!h&&!!l(n[0]);L?e.constant=A:e.constant=C&&v&&S;const N=e.value;if(e.constant){let G;L?(p_.set(l),G=fF(p_)):(G=uF,hF(G,r,s),G.set(o,9)),e.value=new Float32Array(G)}else{let G=t*e.size;const{iterable:W,objectInfo:j}=lc(n,t,i);for(const q of W){j.index++;let Z;if(L)p_.set(A?l:l(q,j)),Z=fF(p_);else{Z=uF;const K=C?r:r(q,j),ft=v?s:s(q,j);hF(Z,K,ft),Z.set(S?o:o(q,j),9)}N[G++]=Z[0],N[G++]=Z[1],N[G++]=Z[2],N[G++]=Z[3],N[G++]=Z[4],N[G++]=Z[5],N[G++]=Z[6],N[G++]=Z[7],N[G++]=Z[8],N[G++]=Z[9],N[G++]=Z[10],N[G++]=Z[11]}}}};function pF(e,t){return t===qi.CARTESIAN||t===qi.METER_OFFSETS||t===qi.DEFAULT&&!e.isGeospatial}const AF=`uniform simpleMeshUniforms {
  float sizeScale;
  bool composeModelMatrix;
  bool hasTexture;
  bool flatShading;
} simpleMesh;
`,qAt={name:"simpleMesh",vs:AF,fs:AF,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}},$At=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;
if (simpleMesh.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,tgt=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
}
`;function egt(e){switch(e.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function gF(e){let t=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;const l=e.POSITION?e.POSITION.value:[],h=l&&l.length;for(let A=0;A<h;A+=3){const v=l[A],C=l[A+1],S=l[A+2];t=v<t?v:t,i=C<i?C:i,n=S<n?S:n,r=v>r?v:r,s=C>s?C:s,o=S>o?S:o}return[[t,i,n],[r,s,o]]}function igt(e,t,i){const n=egt(t.value),r=i||ngt(t);return{name:e,type:{type:"fixed-size-list",listSize:t.size,children:[{name:"value",type:n}]},nullable:!1,metadata:r}}function ngt(e){const t={};return"byteOffset"in e&&(t.byteOffset=e.byteOffset.toString(10)),"byteStride"in e&&(t.byteStride=e.byteStride.toString(10)),"normalized"in e&&(t.normalized=e.normalized.toString()),t}function Rw(e){const t=e.positions||e.POSITION;Yi.assert(t,'no "postions" or "POSITION" attribute in mesh');const i=t.value.length/t.size;let n=e.COLOR_0||e.colors;n||(n={size:3,value:new Float32Array(i*3).fill(1)});let r=e.NORMAL||e.normals;r||(r={size:3,value:new Float32Array(i*3).fill(0)});let s=e.TEXCOORD_0||e.texCoords;return s||(s={size:2,value:new Float32Array(i*2).fill(0)}),{positions:t,colors:n,normals:r,texCoords:s}}function mF(e){return e instanceof es?(e.attributes=Rw(e.attributes),e):e.attributes?new es({...e,topology:"triangle-list",attributes:Rw(e.attributes)}):new es({topology:"triangle-list",attributes:Rw(e)})}const rgt=[0,0,0,255],ogt={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:rgt},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class bf extends Io{getShaders(){return super.getShaders({vs:$At,fs:tgt,modules:[Uo,fb,pa,qAt]})}getBounds(){var t;if(this.props._instanced)return super.getBounds();let i=this.state.positionBounds;if(i)return i;const{mesh:n}=this.props;if(!n)return null;if(i=(t=n.header)==null?void 0:t.boundingBox,!i){const{attributes:r}=mF(n);r.POSITION=r.POSITION||r.positions,i=gF(r)}return this.state.positionBounds=i,i}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:dF}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(t){var i;super.updateState(t);const{props:n,oldProps:r,changeFlags:s}=t;if(n.mesh!==r.mesh||s.extensionsChanged){if(this.state.positionBounds=null,(i=this.state.model)==null||i.destroy(),n.mesh){this.state.model=this.getModel(n.mesh);const o=n.mesh.attributes||n.mesh;this.setState({hasNormals:!!(o.NORMAL||o.normals)})}this.getAttributeManager().invalidateAll()}n.texture!==r.texture&&n.texture instanceof uo&&this.setTexture(n.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(t){super.finalizeState(t),this.state.emptyTexture.delete()}draw({uniforms:t}){const{model:i}=this.state;if(!i)return;const{viewport:n,renderPass:r}=this.context,{sizeScale:s,coordinateSystem:o,_instanced:l}=this.props,h={sizeScale:s,composeModelMatrix:!l||pF(n,o),flatShading:!this.state.hasNormals};i.shaderInputs.setProps({simpleMesh:h}),i.draw(r)}get isLoaded(){var t;return!!((t=this.state)!=null&&t.model&&super.isLoaded)}getModel(t){const i=new Hr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:mF(t),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:r}=this.state,s={sampler:n||r,hasTexture:!!n};return i.shaderInputs.setProps({simpleMesh:s}),i}setTexture(t){const{emptyTexture:i,model:n}=this.state;if(n){const r={sampler:t||i,hasTexture:!!t};n.shaderInputs.setProps({simpleMesh:r})}}}bf.defaultProps=ogt,bf.layerName="SimpleMeshLayer";var Bl;(function(e){e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.ONE=1]="ONE",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.LINEAR=9729]="LINEAR",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(Bl||(Bl={}));function yF(e,t,i,n){const r={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{camera:[0,0,0],metallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};r.defines.USE_TEX_LOD=1;const{imageBasedLightingEnvironment:s}=n;return s&&(r.bindings.pbr_diffuseEnvSampler=s.diffuseEnvSampler.texture,r.bindings.pbr_specularEnvSampler=s.specularEnvSampler.texture,r.bindings.pbr_BrdfLUT=s.brdfLutTexture.texture,r.uniforms.scaleIBLAmbient=[1,1]),n!=null&&n.pbrDebug&&(r.defines.PBR_DEBUG=1,r.uniforms.scaleDiffBaseMR=[0,0,0,0],r.uniforms.scaleFGDSpec=[0,0,0,0]),i.NORMAL&&(r.defines.HAS_NORMALS=1),i.TANGENT&&n!=null&&n.useTangents&&(r.defines.HAS_TANGENTS=1),i.TEXCOORD_0&&(r.defines.HAS_UV=1),n!=null&&n.imageBasedLightingEnvironment&&(r.defines.USE_IBL=1),n!=null&&n.lights&&(r.defines.USE_LIGHTS=1),t&&sgt(e,t,r),r}function sgt(e,t,i){if(i.uniforms.unlit=!!t.unlit,t.pbrMetallicRoughness&&agt(e,t.pbrMetallicRoughness,i),t.normalTexture){Xg(e,t.normalTexture,"pbr_normalSampler","HAS_NORMALMAP",i);const{scale:n=1}=t.normalTexture;i.uniforms.normalScale=n}if(t.occlusionTexture){Xg(e,t.occlusionTexture,"pbr_occlusionSampler","HAS_OCCLUSIONMAP",i);const{strength:n=1}=t.occlusionTexture;i.uniforms.occlusionStrength=n}switch(t.emissiveTexture&&(Xg(e,t.emissiveTexture,"pbr_emissiveSampler","HAS_EMISSIVEMAP",i),i.uniforms.emissiveFactor=t.emissiveFactor||[0,0,0]),t.alphaMode){case"MASK":const{alphaCutoff:n=.5}=t;i.defines.ALPHA_CUTOFF=1,i.uniforms.alphaCutoff=n;break;case"BLEND":ti.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),i.parameters.blendColorOperation="add",i.parameters.blendColorSrcFactor="src-alpha",i.parameters.blendColorDstFactor="one-minus-src-alpha",i.parameters.blendAlphaOperation="add",i.parameters.blendAlphaSrcFactor="one",i.parameters.blendAlphaDstFactor="one-minus-src-alpha",i.glParameters.blend=!0,i.glParameters.blendEquation=Bl.FUNC_ADD,i.glParameters.blendFunc=[Bl.SRC_ALPHA,Bl.ONE_MINUS_SRC_ALPHA,Bl.ONE,Bl.ONE_MINUS_SRC_ALPHA];break}}function agt(e,t,i){t.baseColorTexture&&Xg(e,t.baseColorTexture,"pbr_baseColorSampler","HAS_BASECOLORMAP",i),i.uniforms.baseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&Xg(e,t.metallicRoughnessTexture,"pbr_metallicRoughnessSampler","HAS_METALROUGHNESSMAP",i);const{metallicFactor:n=1,roughnessFactor:r=1}=t;i.uniforms.metallicRoughnessValues=[n,r]}function Xg(e,t,i,n=null,r){var s,o;const l=((o=(s=t==null?void 0:t.texture)==null?void 0:s.sampler)==null?void 0:o.parameters)||{},h=t.texture.source.image;let A,v={};h.compressed?(A=h,v={[Bl.TEXTURE_MIN_FILTER]:h.data.length>1?Bl.LINEAR_MIPMAP_NEAREST:Bl.LINEAR}):A={data:h};const C=e.createTexture({id:t.uniformName||t.id,parameters:{...l,...v},pixelStore:{[Bl.UNPACK_FLIP_Y_WEBGL]:!1},...A});r.bindings[i]=C,n&&(r.defines[n]=1),r.generatedTextures.push(C)}const lgt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},cgt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class ugt{constructor(t){z(this,"name"),z(this,"startTime",0),z(this,"playing",!0),z(this,"speed",1),z(this,"channels",[]),Object.assign(this,t)}animate(t){if(!this.playing)return;const i=(t/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:n,target:r,path:s})=>{mgt(i,n,r,s),dgt(r,r._node)})}}class hgt{constructor(t){z(this,"animations"),this.animations=t.animations.map((i,n)=>{const r=i.name||`Animation-${n}`,s=i.samplers.map(({input:l,interpolation:h="LINEAR",output:A})=>({input:_F(t.accessors[l]),interpolation:h,output:_F(t.accessors[A])})),o=i.channels.map(({sampler:l,target:h})=>({sampler:s[l],target:t.nodes[h.node],path:h.path}));return new ugt({name:r,channels:o})})}animate(t){this.setTime(t)}setTime(t){this.animations.forEach(i=>i.animate(t))}getAnimations(){return this.animations}}function _F(e){if(!e._animation){const t=cgt[e.componentType],i=lgt[e.type],n=i*e.count,{buffer:r,byteOffset:s}=e.bufferView.data,o=new t(r,s+(e.byteOffset||0),n);if(i===1)e._animation=Array.from(o);else{const l=[];for(let h=0;h<o.length;h+=i)l.push(Array.from(o.slice(h,h+i)));e._animation=l}}return e._animation}const fgt=new mn;function dgt(e,t){if(t.matrix.identity(),e.translation&&t.matrix.translate(e.translation),e.rotation){const i=fgt.fromQuaternion(e.rotation);t.matrix.multiplyRight(i)}e.scale&&t.matrix.scale(e.scale)}const Dw=new YA;function pgt(e,t,i,n,r){if(t==="rotation"){Dw.slerp({start:i,target:n,ratio:r});for(let s=0;s<Dw.length;s++)e[t][s]=Dw[s]}else for(let s=0;s<i.length;s++)e[t][s]=r*n[s]+(1-r)*i[s]}function Agt(e,t,{p0:i,outTangent0:n,inTangent1:r,p1:s,tDiff:o,ratio:l}){for(let h=0;h<e[t].length;h++){const A=n[h]*o,v=r[h]*o;e[t][h]=(2*Math.pow(l,3)-3*Math.pow(l,2)+1)*i[h]+(Math.pow(l,3)-2*Math.pow(l,2)+l)*A+(-2*Math.pow(l,3)+3*Math.pow(l,2))*s[h]+(Math.pow(l,3)-Math.pow(l,2))*v}}function ggt(e,t,i){for(let n=0;n<i.length;n++)e[t][n]=i[n]}function mgt(e,{input:t,interpolation:i,output:n},r,s){const o=t[t.length-1],l=e%o,h=t.findIndex(S=>S>=l),A=Math.max(0,h-1);if(!Array.isArray(r[s]))switch(s){case"translation":r[s]=[0,0,0];break;case"rotation":r[s]=[0,0,0,1];break;case"scale":r[s]=[1,1,1];break;default:ti.warn(`Bad animation path ${s}`)()}const v=t[A],C=t[h];switch(i){case"STEP":ggt(r,s,n[A]);break;case"LINEAR":if(C>v){const S=(l-v)/(C-v);pgt(r,s,n[A],n[h],S)}break;case"CUBICSPLINE":if(C>v){const S=(l-v)/(C-v),L=C-v,N=n[3*A+1],G=n[3*A+2],W=n[3*h+0],j=n[3*h+1];Agt(r,s,{p0:N,outTangent0:G,inTangent1:W,p1:j,tDiff:L,ratio:S})}break;default:ti.warn(`Interpolation ${i} not supported`)();break}}const ygt=`
layout(0) positions: vec4; // in vec4 POSITION;

  #ifdef HAS_NORMALS
    in vec4 normals; // in vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

@vertex
  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }

@fragment
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`,_gt=`#version 300 es

  // in vec4 POSITION;
  in vec4 positions;

  #ifdef HAS_NORMALS
    // in vec4 NORMAL;
    in vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = pbrProjection.modelViewProjectionMatrix * positions;
  }
`,vgt=`#version 300 es
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function bgt(e,t){const{id:i,geometry:n,material:r,vertexCount:s,materialOptions:o,modelOptions:l}=t,h=yF(e,r,n.attributes,o);ti.info(4,"createGLTFModel defines: ",h.defines)();const A=[],v={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},C={id:i,source:ygt,vs:_gt,fs:vgt,geometry:n,topology:n.topology,vertexCount:s,modules:[db],...l,defines:{...h.defines,...l.defines},parameters:{...v,...h.parameters,...l.parameters}},S=new Hr(e,C),{camera:L,...N}={...h.uniforms,...l.uniforms,...h.bindings,...l.bindings};return S.shaderInputs.setProps({pbrMaterial:N,pbrProjection:{camera:L}}),new Lb({managedResources:A,model:S})}var xf;(function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(xf||(xf={}));function xgt(e){switch(e){case xf.POINTS:return"point-list";case xf.LINES:return"line-list";case xf.LINE_STRIP:return"line-strip";case xf.TRIANGLES:return"triangle-list";case xf.TRIANGLE_STRIP:return"triangle-strip";default:throw new Error(String(e))}}const wgt={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class Cgt{constructor(t,i={}){z(this,"device"),z(this,"options"),z(this,"gltf"),this.device=t,this.options={...wgt,...i}}instantiate(t){return this.gltf=Ow(t),(this.gltf.scenes||[]).map(i=>this.createScene(i))}createAnimator(){return Array.isArray(this.gltf.animations)?new hgt(this.gltf):null}createScene(t){const i=(t.nodes||[]).map(n=>this.createNode(n));return new oA({id:t.name||t.id,children:i})}createNode(t){if(!t._node){const n=(t.children||[]).map(s=>this.createNode(s));t.mesh&&n.push(this.createMesh(t.mesh));const r=new oA({id:t.name||t.id,children:n});if(t.matrix)r.setMatrix(t.matrix);else{if(r.matrix.identity(),t.translation&&r.matrix.translate(t.translation),t.rotation){const s=new mn().fromQuaternion(t.rotation);r.matrix.multiplyRight(s)}t.scale&&r.matrix.scale(t.scale)}t._node=r}const i=this.gltf.nodes.find(n=>n.id===t.id);return i._node=t._node,t._node}createMesh(t){if(!t._mesh){const i=(t.primitives||[]).map((r,s)=>this.createPrimitive(r,s,t)),n=new oA({id:t.name||t.id,children:i});t._mesh=n}return t._mesh}createPrimitive(t,i,n){const r=t.name||`${n.name||n.id}-primitive-${i}`,s=xgt(t.mode||4),o=t.indices?t.indices.count:this.getVertexCount(t.attributes),l=bgt(this.device,{id:r,geometry:this.createGeometry(r,t,s),material:t.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:o});return l.bounds=[t.attributes.POSITION.min,t.attributes.POSITION.max],l}getVertexCount(t){throw new Error("getVertexCount not implemented")}createGeometry(t,i,n){const r={};for(const[s,o]of Object.entries(i.attributes)){const{components:l,size:h,value:A}=o;r[s]={size:h??l,value:A}}return new es({id:t,topology:n,indices:i.indices.value,attributes:r})}createBuffer(t,i){t.bufferView||(t.bufferView={});const{bufferView:n}=t;return n.lumaBuffers||(n.lumaBuffers={}),n.lumaBuffers[i]||(n.lumaBuffers[i]=this.device.createBuffer({id:`from-${n.id}`,data:n.data||t.value})),n.lumaBuffers[i]}createSampler(t){return t}needsPOT(){return!1}}function Ow(e){if(ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof ImageBitmap)return e;if(Array.isArray(e))return e.map(Ow);if(e&&typeof e=="object"){const t={};for(const i in e)t[i]=Ow(e[i]);return t}return e}function Egt(e,t,i){const n=new Cgt(e,i),r=n.instantiate(t),s=n.createAnimator();return{scenes:r,animator:s}}function ma(e,t){if(!e)throw new Error(t||"assert failed: gltf")}const vF={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},bF={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},xF=["SCALAR","VEC2","VEC3","VEC4"],Bgt=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Tgt=new Map(Bgt),Sgt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Igt={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Mgt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function wF(e){return xF[e-1]||xF[0]}function A_(e){const t=Tgt.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function Lw(e,t){const i=Mgt[e.componentType],n=Sgt[e.type],r=Igt[e.componentType],s=e.count*n,o=e.count*n*r;ma(o>=0&&o<=t.byteLength);const l=bF[e.componentType],h=vF[e.type];return{ArrayType:i,length:s,byteLength:o,componentByteSize:l,numberOfComponentsInElement:h}}function Pgt(e,t,i){const n=e.bufferViews[i];ma(n);const r=n.buffer,s=t[r];ma(s);const o=(n.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,o,n.byteLength)}function Rgt(e,t,i){var n,r;const s=typeof i=="number"?(n=e.accessors)==null?void 0:n[i]:i;if(!s)throw new Error(`No gltf accessor ${JSON.stringify(i)}`);const o=(r=e.bufferViews)==null?void 0:r[s.bufferView||0];if(!o)throw new Error(`No gltf buffer view for accessor ${o}`);const{arrayBuffer:l,byteOffset:h}=t[o.buffer],A=(h||0)+(s.byteOffset||0)+(o.byteOffset||0),{ArrayType:v,length:C,componentByteSize:S,numberOfComponentsInElement:L}=Lw(s,o),N=S*L,G=o.byteStride||N;if(typeof o.byteStride>"u"||o.byteStride===N)return new v(l,A,C);const W=new v(C);for(let j=0;j<s.count;j++){const q=new v(l,A+j*G,L);W.set(q,j*L)}return W}function Dgt(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}let Vo=class{constructor(e){z(this,"gltf"),z(this,"sourceBuffers"),z(this,"byteLength"),this.gltf={json:(e==null?void 0:e.json)||Dgt(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find(n=>n===e),i=this.getRequiredExtensions().find(n=>n===e);return typeof t=="string"||typeof i=="string"}getExtension(e){const t=this.getUsedExtensions().find(n=>n===e),i=this.json.extensions||{};return t?i[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(t=>t===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const i=this.json[e]&&this.json[e][t];if(!i)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return i}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,i=this.gltf.buffers[t];ma(i);const n=(e.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,n,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return Rgt(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,n=t.byteOffset||0;return new Uint8Array(i,n,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,i){return e.extensions=e.extensions||{},e.extensions[t]=i,this.registerUsedExtension(t),this}setObjectExtension(e,t,i){const n=e.extensions||{};n[t]=i}removeObjectExtension(e,t){const i=(e==null?void 0:e.extensions)||{};if(i[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(t)||n.push(t)}delete i[t]}addExtension(e,t={}){return ma(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return ma(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var t;if((t=this.json.extensions)!=null&&t[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(e)||i.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:i}=e;this.json.nodes=this.json.nodes||[];const n={mesh:t};return i&&(n.matrix=i),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:i,material:n,mode:r=4}=e,s={primitives:[{attributes:this._addAttributes(t),mode:r}]};if(i){const o=this._addIndices(i);s.primitives[0].indices=o}return Number.isFinite(n)&&(s.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addPointCloud(e){const t={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(t),this.json.meshes.length-1}addImage(e,t){const i=Yy(e),n=t||(i==null?void 0:i.mimeType),r={bufferView:this.addBufferView(e),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(r),this.json.images.length-1}addBufferView(e,t=0,i=this.byteLength){const n=e.byteLength;ma(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const r={buffer:t,byteOffset:i,byteLength:n};return this.byteLength+=ru(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(e,t){const i={bufferView:e,type:wF(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const i=this.addBufferView(e);let n={min:t.min,max:t.max};(!n.min||!n.max)&&(n=this._getAccessorMinMax(e,t.size));const r={size:t.size,componentType:A_(e),count:Math.round(e.length/t.size),min:n.min,max:n.max};return this.addAccessor(i,Object.assign(r,t))}addTexture(e){const{imageIndex:t}=e,i={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,t;const i=this.byteLength,n=new ArrayBuffer(i),r=new Uint8Array(n);let s=0;for(const o of this.sourceBuffers||[])s=hL(o,r,s);(t=(e=this.json)==null?void 0:e.buffers)!=null&&t[0]?this.json.buffers[0].byteLength=i:this.json.buffers=[{byteLength:i}],this.gltf.binary=n,this.sourceBuffers=[n],this.gltf.buffers=[{arrayBuffer:n,byteOffset:0,byteLength:n.byteLength}]}_removeStringFromArray(e,t){let i=!0;for(;i;){const n=e.indexOf(t);n>-1?e.splice(n,1):i=!1}}_addAttributes(e={}){const t={};for(const i in e){const n=e[i],r=this._getGltfAttributeName(i),s=this.addBinaryBuffer(n.value,n);t[r]=s}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const i={min:null,max:null};if(e.length<t)return i;i.min=[],i.max=[];const n=e.subarray(0,t);for(const r of n)i.min.push(r),i.max.push(r);for(let r=t;r<e.length;r+=t)for(let s=0;s<t;s++)i.min[0+s]=Math.min(i.min[0+s],e[r+s]),i.max[0+s]=Math.max(i.max[0+s],e[r+s]);return i}};function CF(e){return(e%1+1)%1}const EF={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},Ogt={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},BF={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Fw(e,t){return BF[t]*EF[e]}function g_(e,t,i,n){if(i!=="UINT8"&&i!=="UINT16"&&i!=="UINT32"&&i!=="UINT64")return null;const r=e.getTypedArrayForBufferView(t),s=m_(r,"SCALAR",i,n+1);return s instanceof BigInt64Array||s instanceof BigUint64Array?null:s}function m_(e,t,i,n=1){const r=EF[t],s=Ogt[i],o=BF[i],l=n*r,h=l*o;let A=e.buffer,v=e.byteOffset;return v%o!==0&&(A=new Uint8Array(A).slice(v,v+h).buffer,v=0),new s(A,v,l)}function kw(e,t,i){var n,r,s,o,l;const h=`TEXCOORD_${t.texCoord||0}`,A=i.attributes[h],v=e.getTypedArrayForAccessor(A),C=e.gltf.json,S=t.index,L=(r=(n=C.textures)==null?void 0:n[S])==null?void 0:r.source;if(typeof L<"u"){const N=(o=(s=C.images)==null?void 0:s[L])==null?void 0:o.mimeType,G=(l=e.gltf.images)==null?void 0:l[L];if(G&&typeof G.width<"u"){const W=[];for(let j=0;j<v.length;j+=2){const q=Lgt(G,N,v,j,t.channels);W.push(q)}return W}}return[]}function TF(e,t,i,n,r){if(!(i!=null&&i.length))return;const s=[];for(const v of i){let C=n.findIndex(S=>S===v);C===-1&&(C=n.push(v)-1),s.push(C)}const o=new Uint32Array(s),l=e.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,h=e.addBufferView(o,l,0),A=e.addAccessor(h,{size:1,componentType:A_(o),count:o.length});r.attributes[t]=A}function Lgt(e,t,i,n,r=[0]){const s={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=i[n],l=i[n+1];let h=1;t&&(t.indexOf("image/jpeg")!==-1||t.indexOf("image/png")!==-1)&&(h=4);const A=Fgt(o,l,e,h);let v=0;for(const C of r){const S=typeof C=="number"?Object.values(s)[C]:s[C],L=A+S.offset,N=aw(e);if(N.data.length<=L)throw new Error(`${N.data.length} <= ${L}`);const G=N.data[L];v|=G<<S.shift}return v}function Fgt(e,t,i,n=1){const r=i.width,s=CF(e)*(r-1),o=Math.round(s),l=i.height,h=CF(t)*(l-1),A=Math.round(h),v=i.components?i.components:n;return(A*r+o)*v}function SF(e,t,i,n,r){const s=[];for(let o=0;o<t;o++){const l=i[o],h=i[o+1]-i[o];if(h+l>n)break;const A=l/r,v=h/r;s.push(e.slice(A,A+v))}return s}function IF(e,t,i){const n=[];for(let r=0;r<t;r++){const s=r*i;n.push(e.slice(s,s+i))}return n}function MF(e,t,i,n){if(i)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const r=[],s=new TextDecoder("utf8");let o=0;for(let l=0;l<e;l++){const h=n[l+1]-n[l];if(h+o<=t.length){const A=t.subarray(o,h+o),v=s.decode(A);r.push(v),o+=h}}return r}return[]}const Bp="EXT_mesh_features",kgt=Bp;async function Ngt(e,t){const i=new Vo(e);Ggt(i,t)}function Ugt(e,t){const i=new Vo(e);return Vgt(i),i.createBinaryChunk(),i.gltf}function Ggt(e,t){const i=e.gltf.json;if(i.meshes)for(const n of i.meshes)for(const r of n.primitives)zgt(e,r,t)}function zgt(e,t,i){var n,r,s;if(!((n=i==null?void 0:i.gltf)!=null&&n.loadBuffers))return;const o=(r=t.extensions)==null?void 0:r[Bp],l=o==null?void 0:o.featureIds;if(l)for(const h of l){let A;if(typeof h.attribute<"u"){const v=`_FEATURE_ID_${h.attribute}`,C=t.attributes[v];A=e.getTypedArrayForAccessor(C)}else typeof h.texture<"u"&&(s=i==null?void 0:i.gltf)!=null&&s.loadImages?A=kw(e,h.texture,t):A=[];h.data=A}}function Vgt(e,t){const i=e.gltf.json.meshes;if(i)for(const n of i)for(const r of n.primitives)Hgt(e,r)}function jgt(e,t,i,n){t.extensions||(t.extensions={});let r=t.extensions[Bp];r||(r={featureIds:[]},t.extensions[Bp]=r);const{featureIds:s}=r,o={featureCount:i.length,propertyTable:n,data:i};s.push(o),e.addObjectExtension(t,Bp,r)}function Hgt(e,t){var i;const n=(i=t.extensions)==null?void 0:i[Bp];if(!n)return;const r=n.featureIds;r.forEach((s,o)=>{if(s.data){const{accessorKey:l,index:h}=Wgt(t.attributes),A=new Uint32Array(s.data);r[o]={featureCount:A.length,propertyTable:s.propertyTable,attribute:h},e.gltf.buffers.push({arrayBuffer:A.buffer,byteOffset:A.byteOffset,byteLength:A.byteLength});const v=e.addBufferView(A),C=e.addAccessor(v,{size:1,componentType:A_(A),count:A.length});t.attributes[l]=C}})}function Wgt(e){const t="_FEATURE_ID_",i=Object.keys(e).filter(r=>r.indexOf(t)===0);let n=-1;for(const r of i){const s=Number(r.substring(t.length));s>n&&(n=s)}return n++,{accessorKey:`${t}${n}`,index:n}}const Jgt=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:jgt,decode:Ngt,encode:Ugt,name:kgt},Symbol.toStringTag,{value:"Module"})),Tp="EXT_structural_metadata",Xgt=Tp;async function Kgt(e,t){const i=new Vo(e);Zgt(i,t)}function Qgt(e,t){const i=new Vo(e);return fmt(i),i.createBinaryChunk(),i.gltf}function Zgt(e,t){var i,n;if(!((i=t.gltf)!=null&&i.loadBuffers))return;const r=e.getExtension(Tp);r&&((n=t.gltf)!=null&&n.loadImages&&Ygt(e,r),qgt(e,r))}function Ygt(e,t){const i=t.propertyTextures,n=e.gltf.json;if(i&&n.meshes)for(const r of n.meshes)for(const s of r.primitives)tmt(e,i,s,t)}function qgt(e,t){const i=t.schema;if(!i)return;const n=i.classes,r=t.propertyTables;if(n&&r)for(const s in n){const o=$gt(r,s);o&&imt(e,i,o)}}function $gt(e,t){for(const i of e)if(i.class===t)return i;return null}function tmt(e,t,i,n){var r;if(!t)return;const s=(r=i.extensions)==null?void 0:r[Tp],o=s==null?void 0:s.propertyTextures;if(o)for(const l of o){const h=t[l];emt(e,h,i,n)}}function emt(e,t,i,n){var r;if(!t.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const s=t.class;for(const o in t.properties){const l=`${s}_${o}`,h=(r=t.properties)==null?void 0:r[o];if(!h)continue;h.data||(h.data=[]);const A=h.data,v=kw(e,h,i);v!==null&&(TF(e,l,v,A,i),h.data=A,n.dataAttributeNames.push(l))}}function imt(e,t,i){var n,r;const s=(n=t.classes)==null?void 0:n[i.class];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);const o=i.count;for(const l in s.properties){const h=s.properties[l],A=(r=i.properties)==null?void 0:r[l];if(A){const v=nmt(e,t,h,o,A);A.data=v}}}function nmt(e,t,i,n,r){let s=[];const o=r.values,l=e.getTypedArrayForBufferView(o),h=rmt(e,i,r,n),A=omt(e,r,n);switch(i.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{s=smt(i,n,l,h);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${i.type}`);case"STRING":{s=MF(n,l,h,A);break}case"ENUM":{s=amt(t,i,n,l,h);break}default:throw new Error(`Unknown classProperty type ${i.type}`)}return s}function rmt(e,t,i,n){return t.array&&typeof t.count>"u"&&typeof i.arrayOffsets<"u"?g_(e,i.arrayOffsets,i.arrayOffsetType||"UINT32",n):null}function omt(e,t,i){return typeof t.stringOffsets<"u"?g_(e,t.stringOffsets,t.stringOffsetType||"UINT32",i):null}function smt(e,t,i,n){const r=e.array,s=e.count,o=Fw(e.type,e.componentType),l=i.byteLength/o;let h;return e.componentType?h=m_(i,e.type,e.componentType,l):h=i,r?n?SF(h,t,n,i.length,o):s?IF(h,t,s):[]:h}function amt(e,t,i,n,r){var s;const o=t.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const l=(s=e.enums)==null?void 0:s[o];if(!l)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const h=l.valueType||"UINT16",A=Fw(t.type,h),v=n.byteLength/A;let C=m_(n,t.type,h,v);if(C||(C=n),t.array){if(r)return lmt({valuesData:C,numberOfElements:i,arrayOffsets:r,valuesDataBytesLength:n.length,elementSize:A,enumEntry:l});const S=t.count;return S?cmt(C,i,S,l):[]}return Nw(C,0,i,l)}function lmt(e){const{valuesData:t,numberOfElements:i,arrayOffsets:n,valuesDataBytesLength:r,elementSize:s,enumEntry:o}=e,l=[];for(let h=0;h<i;h++){const A=n[h],v=n[h+1]-n[h];if(v+A>r)break;const C=A/s,S=v/s,L=Nw(t,C,S,o);l.push(L)}return l}function cmt(e,t,i,n){const r=[];for(let s=0;s<t;s++){const o=i*s,l=Nw(e,o,i,n);r.push(l)}return r}function Nw(e,t,i,n){const r=[];for(let s=0;s<i;s++)if(e instanceof BigInt64Array||e instanceof BigUint64Array)r.push("");else{const o=e[t+s],l=umt(n,o);l?r.push(l.name):r.push("")}return r}function umt(e,t){for(const i of e.values)if(i.value===t)return i;return null}const hmt="schemaClassId";function fmt(e,t){var i,n;const r=e.getExtension(Tp);if(r&&r.propertyTables)for(const s of r.propertyTables){const o=s.class,l=(n=(i=r.schema)==null?void 0:i.classes)==null?void 0:n[o];s.properties&&l&&dmt(s,l,e)}}function dmt(e,t,i){for(const n in e.properties){const r=e.properties[n].data;if(r){const s=t.properties[n];if(s){const o=mmt(r,s,i);e.properties[n]=o}}}}function pmt(e,t,i=hmt){let n=e.getExtension(Tp);n||(n=e.addExtension(Tp)),n.schema=Amt(t,i,n.schema);const r=gmt(t,i,n.schema);return n.propertyTables||(n.propertyTables=[]),n.propertyTables.push(r)-1}function Amt(e,t,i){const n=i??{id:"schema_id"},r={properties:{}};for(const s of e){const o={type:s.elementType,componentType:s.componentType};r.properties[s.name]=o}return n.classes={},n.classes[t]=r,n}function gmt(e,t,i){var n;const r={class:t,count:0};let s=0;const o=(n=i.classes)==null?void 0:n[t];for(const l of e){if(s===0&&(s=l.values.length),s!==l.values.length&&l.values.length)throw new Error("Illegal values in attributes");o!=null&&o.properties[l.name]&&(r.properties||(r.properties={}),r.properties[l.name]={values:0,data:l.values})}return r.count=s,r}function mmt(e,t,i){const n={values:0};if(t.type==="STRING"){const{stringData:r,stringOffsets:s}=vmt(e);n.stringOffsets=Uw(s,i),n.values=Uw(r,i)}else if(t.type==="SCALAR"&&t.componentType){const r=_mt(e,t.componentType);n.values=Uw(r,i)}return n}const ymt={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function _mt(e,t){const i=[];for(const r of e)i.push(Number(r));const n=ymt[t];if(!n)throw new Error("Illegal component type");return new n(i)}function vmt(e){const t=new TextEncoder,i=[];let n=0;for(const h of e){const A=t.encode(h);n+=A.length,i.push(A)}const r=new Uint8Array(n),s=[];let o=0;for(const h of i)r.set(h,o),s.push(o),o+=h.length;s.push(o);const l=new Uint32Array(s);return{stringData:r,stringOffsets:l}}function Uw(e,t){return t.gltf.buffers.push({arrayBuffer:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength}),t.addBufferView(e)}const bmt=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:pmt,decode:Kgt,encode:Qgt,name:Xgt},Symbol.toStringTag,{value:"Module"})),PF="EXT_feature_metadata",xmt=PF;async function wmt(e,t){const i=new Vo(e);Cmt(i,t)}function Cmt(e,t){var i,n;if(!((i=t.gltf)!=null&&i.loadBuffers))return;const r=e.getExtension(PF);r&&((n=t.gltf)!=null&&n.loadImages&&Emt(e,r),Bmt(e,r))}function Emt(e,t){const i=t.schema;if(!i)return;const n=i.classes,{featureTextures:r}=t;if(n&&r)for(const s in n){const o=n[s],l=Smt(r,s);l&&Mmt(e,l,o)}}function Bmt(e,t){const i=t.schema;if(!i)return;const n=i.classes,r=t.featureTables;if(n&&r)for(const s in n){const o=Tmt(r,s);o&&Imt(e,i,o)}}function Tmt(e,t){for(const i in e){const n=e[i];if(n.class===t)return n}return null}function Smt(e,t){for(const i in e){const n=e[i];if(n.class===t)return n}return null}function Imt(e,t,i){var n,r;if(!i.class)return;const s=(n=t.classes)==null?void 0:n[i.class];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);const o=i.count;for(const l in s.properties){const h=s.properties[l],A=(r=i.properties)==null?void 0:r[l];if(A){const v=Pmt(e,t,h,o,A);A.data=v}}}function Mmt(e,t,i){var n;const r=t.class;for(const s in i.properties){const o=(n=t==null?void 0:t.properties)==null?void 0:n[s];if(o){const l=Fmt(e,o,r);o.data=l}}}function Pmt(e,t,i,n,r){let s=[];const o=r.bufferView,l=e.getTypedArrayForBufferView(o),h=Rmt(e,i,r,n),A=Dmt(e,i,r,n);return i.type==="STRING"||i.componentType==="STRING"?s=MF(n,l,h,A):Omt(i)&&(s=Lmt(i,n,l,h)),s}function Rmt(e,t,i,n){return t.type==="ARRAY"&&typeof t.componentCount>"u"&&typeof i.arrayOffsetBufferView<"u"?g_(e,i.arrayOffsetBufferView,i.offsetType||"UINT32",n):null}function Dmt(e,t,i,n){return typeof i.stringOffsetBufferView<"u"?g_(e,i.stringOffsetBufferView,i.offsetType||"UINT32",n):null}function Omt(e){const t=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return t.includes(e.type)||typeof e.componentType<"u"&&t.includes(e.componentType)}function Lmt(e,t,i,n){const r=e.type==="ARRAY",s=e.componentCount,o="SCALAR",l=e.componentType||e.type,h=Fw(o,l),A=i.byteLength/h,v=m_(i,o,l,A);return r?n?SF(v,t,n,i.length,h):s?IF(v,t,s):[]:v}function Fmt(e,t,i){const n=e.gltf.json;if(!n.meshes)return[];const r=[];for(const s of n.meshes)for(const o of s.primitives)kmt(e,i,t,r,o);return r}function kmt(e,t,i,n,r){const s={channels:i.channels,...i.texture},o=kw(e,s,r);o&&TF(e,t,o,n,r)}const Nmt=Object.freeze(Object.defineProperty({__proto__:null,decode:wmt,name:xmt},Symbol.toStringTag,{value:"Module"})),Umt="4.3.1",Gmt="4.3.1",y_={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let Gw;async function RF(e){return yft(e.modules),_ft("basis")||(Gw||(Gw=zmt(e)),await Gw)}async function zmt(e){let t=null,i=null;return[t,i]=await Promise.all([await _f(y_.TRANSCODER,"textures",e),await _f(y_.TRANSCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await Vmt(t,i)}function Vmt(e,t){const i={};return t&&(i.wasmBinary=t),new Promise(n=>{e(i).then(r=>{const{BasisFile:s,initializeBasis:o}=r;o(),n({BasisFile:s})})})}let zw;async function DF(e){const t=e.modules||{};return t.basisEncoder?t.basisEncoder:(zw=zw||jmt(e),await zw)}async function jmt(e){let t=null,i=null;return[t,i]=await Promise.all([await _f(y_.ENCODER,"textures",e),await _f(y_.ENCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await Hmt(t,i)}function Hmt(e,t){const i={};return t&&(i.wasmBinary=t),new Promise(n=>{e(i).then(r=>{const{BasisFile:s,KTX2File:o,initializeBasis:l,BasisEncoder:h}=r;l(),n({BasisFile:s,KTX2File:o,BasisEncoder:h})})})}const Sp={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},Wmt=["","WEBKIT_","MOZ_"],OF={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let __=null;function Jmt(e){if(!__){e=e||Xmt()||void 0,__=new Set;for(const t of Wmt)for(const i in OF)if(e&&e.getExtension(`${t}${i}`)){const n=OF[i];__.add(n)}}return __}function Xmt(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const ya=[171,75,84,88,32,50,48,187,13,10,26,10];function Kmt(e){const t=new Uint8Array(e);return!(t.byteLength<ya.length||t[0]!==ya[0]||t[1]!==ya[1]||t[2]!==ya[2]||t[3]!==ya[3]||t[4]!==ya[4]||t[5]!==ya[5]||t[6]!==ya[6]||t[7]!==ya[7]||t[8]!==ya[8]||t[9]!==ya[9]||t[10]!==ya[10]||t[11]!==ya[11])}const Qmt={etc1:{basisFormat:0,compressed:!0,format:Sp.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Sp.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Sp.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Sp.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Sp.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Sp.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function Zmt(e,t){if(t.basis.containerFormat==="auto"){if(Kmt(e)){const n=await DF(t);return LF(n.KTX2File,e,t)}const{BasisFile:i}=await RF(t);return Vw(i,e,t)}switch(t.basis.module){case"encoder":const i=await DF(t);switch(t.basis.containerFormat){case"ktx2":return LF(i.KTX2File,e,t);case"basis":default:return Vw(i.BasisFile,e,t)}case"transcoder":default:const{BasisFile:n}=await RF(t);return Vw(n,e,t)}}function Vw(e,t,i){const n=new e(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const r=n.getNumImages(),s=[];for(let o=0;o<r;o++){const l=n.getNumLevels(o),h=[];for(let A=0;A<l;A++)h.push(Ymt(n,o,A,i));s.push(h)}return s}finally{n.close(),n.delete()}}function Ymt(e,t,i,n){const r=e.getImageWidth(t,i),s=e.getImageHeight(t,i),o=e.getHasAlpha(),{compressed:l,format:h,basisFormat:A}=FF(n,o),v=e.getImageTranscodedSizeInBytes(t,i,A),C=new Uint8Array(v);if(!e.transcodeImage(C,t,i,A,0,0))throw new Error("failed to start Basis transcoding");return{width:r,height:s,data:C,compressed:l,format:h,hasAlpha:o}}function LF(e,t,i){const n=new e(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const r=n.getLevels(),s=[];for(let o=0;o<r;o++)s.push(qmt(n,o,i));return[s]}finally{n.close(),n.delete()}}function qmt(e,t,i){const{alphaFlag:n,height:r,width:s}=e.getImageLevelInfo(t,0,0),{compressed:o,format:l,basisFormat:h}=FF(i,n),A=e.getImageTranscodedSizeInBytes(t,0,0,h),v=new Uint8Array(A);if(!e.transcodeImage(v,t,0,0,h,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:r,data:v,compressed:o,levelSize:A,hasAlpha:n,format:l}}function FF(e,t){let i=e&&e.basis&&e.basis.format;return i==="auto"&&(i=jw()),typeof i=="object"&&(i=t?i.alpha:i.noAlpha),i=i.toLowerCase(),Qmt[i]}function jw(){const e=Jmt();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}const $mt={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:Gmt,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},kF={...$mt,parse:Zmt},Ip=!0,NF=1735152710,Hw=12,v_=8,t0t=1313821514,e0t=5130562,i0t=0,n0t=0,r0t=1;function o0t(e,t=0){return`${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}function s0t(e,t=0,i={}){const n=new DataView(e),{magic:r=NF}=i,s=n.getUint32(t,!1);return s===r||s===NF}function a0t(e,t,i=0,n={}){const r=new DataView(t),s=o0t(r,i+0),o=r.getUint32(i+4,Ip),l=r.getUint32(i+8,Ip);switch(Object.assign(e,{header:{byteOffset:i,byteLength:l,hasBinChunk:!1},type:s,version:o,json:{},binChunks:[]}),i+=Hw,e.version){case 1:return l0t(e,r,i);case 2:return c0t(e,r,i,n={});default:throw new Error(`Invalid GLB version ${e.version}. Only supports version 1 and 2.`)}}function l0t(e,t,i){yr(e.header.byteLength>Hw+v_);const n=t.getUint32(i+0,Ip),r=t.getUint32(i+4,Ip);return i+=v_,yr(r===i0t),Ww(e,t,i,n),i+=n,i+=Jw(e,t,i,e.header.byteLength),i}function c0t(e,t,i,n){return yr(e.header.byteLength>Hw+v_),u0t(e,t,i,n),i+e.header.byteLength}function u0t(e,t,i,n){for(;i+8<=e.header.byteLength;){const r=t.getUint32(i+0,Ip),s=t.getUint32(i+4,Ip);switch(i+=v_,s){case t0t:Ww(e,t,i,r);break;case e0t:Jw(e,t,i,r);break;case n0t:n.strict||Ww(e,t,i,r);break;case r0t:n.strict||Jw(e,t,i,r);break}i+=ru(r,4)}return i}function Ww(e,t,i,n){const r=new Uint8Array(t.buffer,i,n),s=new TextDecoder("utf8").decode(r);return e.json=JSON.parse(s),ru(n,4)}function Jw(e,t,i,n){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:i,byteLength:n,arrayBuffer:t.buffer}),ru(n,4)}function UF(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const i=t.baseUri||t.uri;if(!i)throw new Error(`'baseUri' must be provided to resolve relative url ${e}`);return i.substr(0,i.lastIndexOf("/")+1)+e}const h0t="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",f0t="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",d0t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),p0t=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),A0t={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},g0t={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function m0t(e,t,i,n,r,s="NONE"){const o=await y0t();b0t(o,o.exports[g0t[r]],e,t,i,n,o.exports[A0t[s||"NONE"]])}let Xw;async function y0t(){return Xw||(Xw=_0t()),Xw}async function _0t(){let e=h0t;WebAssembly.validate(d0t)&&(e=f0t,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(v0t(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function v0t(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;++n){const r=e.charCodeAt(n);t[n]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let i=0;for(let n=0;n<e.length;++n)t[i++]=t[n]<60?p0t[t[n]]:(t[n]-60)*64+t[++n];return t.buffer.slice(0,i)}function b0t(e,t,i,n,r,s,o){const l=e.exports.sbrk,h=n+3&-4,A=l(h*r),v=l(s.length),C=new Uint8Array(e.exports.memory.buffer);C.set(s,v);const S=t(A,n,r,v,s.length);if(S===0&&o&&o(A,h,r),i.set(C.subarray(A,A+n*r)),l(A-l(0)),S!==0)throw new Error(`Malformed buffer data: ${S}`)}const b_="EXT_meshopt_compression",x0t=b_;async function w0t(e,t){var i,n;const r=new Vo(e);if(!((i=t==null?void 0:t.gltf)!=null&&i.decompressMeshes)||!((n=t.gltf)!=null&&n.loadBuffers))return;const s=[];for(const o of e.json.bufferViews||[])s.push(C0t(r,o));await Promise.all(s),r.removeExtension(b_)}async function C0t(e,t){const i=e.getObjectExtension(t,b_);if(i){const{byteOffset:n=0,byteLength:r=0,byteStride:s,count:o,mode:l,filter:h="NONE",buffer:A}=i,v=e.gltf.buffers[A],C=new Uint8Array(v.arrayBuffer,v.byteOffset+n,r),S=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await m0t(S,o,s,C,l,h),e.removeObjectExtension(t,b_)}}const E0t=Object.freeze(Object.defineProperty({__proto__:null,decode:w0t,name:x0t},Symbol.toStringTag,{value:"Module"})),Mp="EXT_texture_webp",B0t=Mp;function T0t(e,t){const i=new Vo(e);if(!wL("image/webp")){if(i.getRequiredExtensions().includes(Mp))throw new Error(`gltf: Required extension ${Mp} not supported by browser`);return}const{json:n}=i;for(const r of n.textures||[]){const s=i.getObjectExtension(r,Mp);s&&(r.source=s.source),i.removeObjectExtension(r,Mp)}i.removeExtension(Mp)}const S0t=Object.freeze(Object.defineProperty({__proto__:null,name:B0t,preprocess:T0t},Symbol.toStringTag,{value:"Module"})),x_="KHR_texture_basisu",I0t=x_;function M0t(e,t){const i=new Vo(e),{json:n}=i;for(const r of n.textures||[]){const s=i.getObjectExtension(r,x_);s&&(r.source=s.source,i.removeObjectExtension(r,x_))}i.removeExtension(x_)}const P0t=Object.freeze(Object.defineProperty({__proto__:null,name:I0t,preprocess:M0t},Symbol.toStringTag,{value:"Module"})),R0t="4.3.1",D0t={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:R0t,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function O0t(e,t,i){const n=zF(t.metadata),r=[],s=L0t(t.attributes);for(const o in e){const l=e[o],h=GF(o,l,s[o]);r.push(h)}if(i){const o=GF("indices",i);r.push(o)}return{fields:r,metadata:n}}function L0t(e){const t={};for(const i in e){const n=e[i];t[n.name||"undefined"]=n}return t}function GF(e,t,i){const n=i?zF(i.metadata):void 0;return igt(e,t,n)}function zF(e){Object.entries(e);const t={};for(const i in e)t[`${i}.string`]=JSON.stringify(e[i]);return t}const VF={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},F0t={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},k0t=4;class N0t{constructor(t){z(this,"draco"),z(this,"decoder"),z(this,"metadataQuerier"),this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t,i={}){const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(i);const r=this.decoder.GetEncodedGeometryType(n),s=r===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(r){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(n,s);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(n,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!s.ptr){const C=`DRACO decompression failed: ${o.error_msg()}`;throw new Error(C)}const l=this._getDracoLoaderData(s,r,i),h=this._getMeshData(s,l,i),A=gF(h.attributes),v=O0t(h.attributes,l,h.indices);return{loader:"draco",loaderData:l,header:{vertexCount:s.num_points(),boundingBox:A},...h,schema:v}}finally{this.draco.destroy(n),s&&this.draco.destroy(s)}}_getDracoLoaderData(t,i,n){const r=this._getTopLevelMetadata(t),s=this._getDracoAttributes(t,n);return{geometry_type:i,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:r,attributes:s}}_getDracoAttributes(t,i){const n={};for(let r=0;r<t.num_attributes();r++){const s=this.decoder.GetAttribute(t,r),o=this._getAttributeMetadata(t,r);n[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:r,metadata:o};const l=this._getQuantizationTransform(s,i);l&&(n[s.unique_id()].quantization_transform=l);const h=this._getOctahedronTransform(s,i);h&&(n[s.unique_id()].octahedron_transform=h)}return n}_getMeshData(t,i,n){const r=this._getMeshAttributes(i,t,n);if(!r.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:r,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:r,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:r}}_getMeshAttributes(t,i,n){const r={};for(const s of Object.values(t.attributes)){const o=this._deduceAttributeName(s,n);s.name=o;const l=this._getAttributeValues(i,s);if(l){const{value:h,size:A}=l;r[o]={value:h,size:A,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}}return r}_getTriangleListIndices(t){const i=t.num_faces()*3,n=i*k0t,r=this.draco._malloc(n);try{return this.decoder.GetTrianglesUInt32Array(t,n,r),new Uint32Array(this.draco.HEAPF32.buffer,r,i).slice()}finally{this.draco._free(r)}}_getTriangleStripIndices(t){const i=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,i),z0t(i)}finally{this.draco.destroy(i)}}_getAttributeValues(t,i){const n=F0t[i.data_type];if(!n)return console.warn(`DRACO: Unsupported attribute type ${i.data_type}`),null;const r=i.num_components,s=t.num_points()*r,o=s*n.BYTES_PER_ELEMENT,l=U0t(this.draco,n);let h;const A=this.draco._malloc(o);try{const v=this.decoder.GetAttribute(t,i.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,v,l,o,A),h=new n(this.draco.HEAPF32.buffer,A,s).slice()}finally{this.draco._free(A)}return{value:h,size:r}}_deduceAttributeName(t,i){const n=t.unique_id;for(const[o,l]of Object.entries(i.extraAttributes||{}))if(l===n)return o;const r=t.attribute_type;for(const o in VF)if(this.draco[o]===r)return VF[o];const s=i.attributeNameEntry||"name";return t.metadata[s]?t.metadata[s].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(t){const i=this.decoder.GetMetadata(t);return this._getDracoMetadata(i)}_getAttributeMetadata(t,i){const n=this.decoder.GetAttributeMetadata(t,i);return this._getDracoMetadata(n)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const i={},n=this.metadataQuerier.NumEntries(t);for(let r=0;r<n;r++){const s=this.metadataQuerier.GetEntryName(t,r);i[s]=this._getDracoMetadataField(t,s)}return i}_getDracoMetadataField(t,i){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,i,n);const r=G0t(n);return{int:this.metadataQuerier.GetIntEntry(t,i),string:this.metadataQuerier.GetStringEntry(t,i),double:this.metadataQuerier.GetDoubleEntry(t,i),intArray:r}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(t){const{quantizedAttributes:i=[],octahedronAttributes:n=[]}=t,r=[...i,...n];for(const s of r)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(t,i){const{quantizedAttributes:n=[]}=i,r=t.attribute_type();if(n.map(s=>this.decoder[s]).includes(r)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(t))return{quantization_bits:s.quantization_bits(),range:s.range(),min_values:new Float32Array([1,2,3]).map(o=>s.min_value(o))}}finally{this.draco.destroy(s)}}return null}_getOctahedronTransform(t,i){const{octahedronAttributes:n=[]}=i,r=t.attribute_type();if(n.map(s=>this.decoder[s]).includes(r)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(t))return{quantization_bits:s.quantization_bits()}}finally{this.draco.destroy(s)}}return null}}function U0t(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}function G0t(e){const t=e.size(),i=new Int32Array(t);for(let n=0;n<t;n++)i[n]=e.GetValue(n);return i}function z0t(e){const t=e.size(),i=new Int32Array(t);for(let n=0;n<t;n++)i[n]=e.GetValue(n);return i}const V0t="1.5.6",j0t="1.4.1",Kw=`https://www.gstatic.com/draco/versioned/decoders/${V0t}`,Hs={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},Qw={[Hs.DECODER]:`${Kw}/${Hs.DECODER}`,[Hs.DECODER_WASM]:`${Kw}/${Hs.DECODER_WASM}`,[Hs.FALLBACK_DECODER]:`${Kw}/${Hs.FALLBACK_DECODER}`,[Hs.ENCODER]:`https://raw.githubusercontent.com/google/draco/${j0t}/javascript/${Hs.ENCODER}`};let Kg;async function H0t(e){const t=e.modules||{};return t.draco3d?Kg||(Kg=t.draco3d.createDecoderModule({}).then(i=>({draco:i}))):Kg||(Kg=W0t(e)),await Kg}async function W0t(e){let t,i;switch(e.draco&&e.draco.decoderType){case"js":t=await _f(Qw[Hs.FALLBACK_DECODER],"draco",e,Hs.FALLBACK_DECODER);break;case"wasm":default:[t,i]=await Promise.all([await _f(Qw[Hs.DECODER],"draco",e,Hs.DECODER),await _f(Qw[Hs.DECODER_WASM],"draco",e,Hs.DECODER_WASM)])}return t=t||globalThis.DracoDecoderModule,await J0t(t,i)}function J0t(e,t){const i={};return t&&(i.wasmBinary=t),new Promise(n=>{e({...i,onModuleLoaded:r=>n({draco:r})})})}const Zw={...D0t,parse:X0t};async function X0t(e,t){const{draco:i}=await H0t(t),n=new N0t(i);try{return n.parseSync(e,t==null?void 0:t.draco)}finally{n.destroy()}}function K0t(e){const t={};for(const i in e){const n=e[i];if(i!=="indices"){const r=jF(n);t[i]=r}}return t}function jF(e){const{buffer:t,size:i,count:n}=Q0t(e);return{value:t,size:i,byteOffset:0,count:n,type:wF(i),componentType:A_(t)}}function Q0t(e){let t=e,i=1,n=0;return e&&e.value&&(t=e.value,i=e.size||1),t&&(ArrayBuffer.isView(t)||(t=Z0t(t,Float32Array)),n=t.length/i),{buffer:t,size:i,count:n}}function Z0t(e,t,i=!1){return e?Array.isArray(e)?new t(e):i&&!(e instanceof t)?new t(e):e:null}const gh="KHR_draco_mesh_compression",Y0t=gh;function q0t(e,t,i){const n=new Vo(e);for(const r of HF(n))n.getObjectExtension(r,gh)}async function $0t(e,t,i){var n;if(!((n=t==null?void 0:t.gltf)!=null&&n.decompressMeshes))return;const r=new Vo(e),s=[];for(const o of HF(r))r.getObjectExtension(o,gh)&&s.push(eyt(r,o,t,i));await Promise.all(s),r.removeExtension(gh)}function tyt(e,t={}){const i=new Vo(e);for(const n of i.json.meshes||[])iyt(n),i.addRequiredExtension(gh)}async function eyt(e,t,i,n){const r=e.getObjectExtension(t,gh);if(!r)return;const s=e.getTypedArrayForBufferView(r.bufferView),o=Ug(s.buffer,s.byteOffset),l={...i};delete l["3d-tiles"];const h=await yf(o,Zw,l,n),A=K0t(h.attributes);for(const[v,C]of Object.entries(A))if(v in t.attributes){const S=t.attributes[v],L=e.getAccessor(S);L!=null&&L.min&&L!=null&&L.max&&(C.min=L.min,C.max=L.max)}t.attributes=A,h.indices&&(t.indices=jF(h.indices)),e.removeObjectExtension(t,gh),nyt(t)}function iyt(e,t,i=4,n,r){var s;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=n.DracoWriter.encodeSync({attributes:e}),l=(s=r==null?void 0:r.parseSync)==null?void 0:s.call(r,{attributes:e}),h=n._addFauxAttributes(l.attributes),A=n.addBufferView(o);return{primitives:[{attributes:h,mode:i,extensions:{[gh]:{bufferView:A,attributes:h}}}]}}function nyt(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*HF(e){for(const t of e.json.meshes||[])for(const i of t.primitives)yield i}const ryt=Object.freeze(Object.defineProperty({__proto__:null,decode:$0t,encode:tyt,name:Y0t,preprocess:q0t},Symbol.toStringTag,{value:"Module"})),w_="KHR_texture_transform",oyt=w_,C_=new de,syt=new mr,ayt=new mr;async function lyt(e,t){var i;if(!new Vo(e).hasExtension(w_)||!((i=t.gltf)!=null&&i.loadBuffers))return;const n=e.json.materials||[];for(let r=0;r<n.length;r++)cyt(r,e)}function cyt(e,t){var i,n,r,s;const o=(i=t.json.materials)==null?void 0:i[e],l=[(n=o==null?void 0:o.pbrMetallicRoughness)==null?void 0:n.baseColorTexture,o==null?void 0:o.emissiveTexture,o==null?void 0:o.normalTexture,o==null?void 0:o.occlusionTexture,(r=o==null?void 0:o.pbrMetallicRoughness)==null?void 0:r.metallicRoughnessTexture],h=[];for(const A of l)A&&(s=A==null?void 0:A.extensions)!=null&&s[w_]&&uyt(t,e,A,h)}function uyt(e,t,i,n){const r=hyt(i,n);if(!r)return;const s=e.json.meshes||[];for(const o of s)for(const l of o.primitives){const h=l.material;Number.isFinite(h)&&t===h&&fyt(e,l,r)}}function hyt(e,t){var i;const n=(i=e.extensions)==null?void 0:i[w_],{texCoord:r=0}=e,{texCoord:s=r}=n;if(t.findIndex(([o,l])=>o===r&&l===s)===-1){const o=Ayt(n);return r!==s&&(e.texCoord=s),t.push([r,s]),{originalTexCoord:r,texCoord:s,matrix:o}}return null}function fyt(e,t,i){var n,r;const{originalTexCoord:s,texCoord:o,matrix:l}=i,h=t.attributes[`TEXCOORD_${s}`];if(Number.isFinite(h)){const A=(n=e.json.accessors)==null?void 0:n[h];if(A&&A.bufferView){const v=(r=e.json.bufferViews)==null?void 0:r[A.bufferView];if(v){const{arrayBuffer:C,byteOffset:S}=e.buffers[v.buffer],L=(S||0)+(A.byteOffset||0)+(v.byteOffset||0),{ArrayType:N,length:G}=Lw(A,v),W=bF[A.componentType],j=vF[A.type],q=v.byteStride||W*j,Z=new Float32Array(G);for(let K=0;K<A.count;K++){const ft=new N(C,L+K*q,2);C_.set(ft[0],ft[1],1),C_.transformByMatrix3(l),Z.set([C_[0],C_[1]],K*j)}s===o?dyt(A,v,e.buffers,Z):pyt(o,A,t,e,Z)}}}}function dyt(e,t,i,n){e.componentType=5126,i.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),t.buffer=i.length-1,t.byteLength=n.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function pyt(e,t,i,n,r){n.buffers.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength});const s=n.json.bufferViews;if(!s)return;s.push({buffer:n.buffers.length-1,byteLength:r.buffer.byteLength,byteOffset:0});const o=n.json.accessors;o&&(o.push({bufferView:(s==null?void 0:s.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),i.attributes[`TEXCOORD_${e}`]=o.length-1)}function Ayt(e){const{offset:t=[0,0],rotation:i=0,scale:n=[1,1]}=e,r=new mr().set(1,0,0,0,1,0,t[0],t[1],1),s=syt.set(Math.cos(i),Math.sin(i),0,-Math.sin(i),Math.cos(i),0,0,0,1),o=ayt.set(n[0],0,0,0,n[1],0,0,0,1);return r.multiplyRight(s).multiplyRight(o)}const gyt=Object.freeze(Object.defineProperty({__proto__:null,decode:lyt,name:oyt},Symbol.toStringTag,{value:"Module"})),wf="KHR_lights_punctual",myt=wf;async function yyt(e){const t=new Vo(e),{json:i}=t,n=t.getExtension(wf);n&&(t.json.lights=n.lights,t.removeExtension(wf));for(const r of i.nodes||[]){const s=t.getObjectExtension(r,wf);s&&(r.light=s.light),t.removeObjectExtension(r,wf)}}async function _yt(e){const t=new Vo(e),{json:i}=t;if(i.lights){const n=t.addExtension(wf);ma(!n.lights),n.lights=i.lights,delete i.lights}if(t.json.lights){for(const n of t.json.lights){const r=n.node;t.addObjectExtension(r,wf,n)}delete t.json.lights}}const vyt=Object.freeze(Object.defineProperty({__proto__:null,decode:yyt,encode:_yt,name:myt},Symbol.toStringTag,{value:"Module"})),Qg="KHR_materials_unlit",byt=Qg;async function xyt(e){const t=new Vo(e),{json:i}=t;for(const n of i.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),t.removeObjectExtension(n,Qg);t.removeExtension(Qg)}function wyt(e){const t=new Vo(e),{json:i}=t;if(t.materials)for(const n of i.materials||[])n.unlit&&(delete n.unlit,t.addObjectExtension(n,Qg,{}),t.addExtension(Qg))}const Cyt=Object.freeze(Object.defineProperty({__proto__:null,decode:xyt,encode:wyt,name:byt},Symbol.toStringTag,{value:"Module"})),Zg="KHR_techniques_webgl",Eyt=Zg;async function Byt(e){const t=new Vo(e),{json:i}=t,n=t.getExtension(Zg);if(n){const r=Syt(n,t);for(const s of i.materials||[]){const o=t.getObjectExtension(s,Zg);o&&(s.technique=Object.assign({},o,r[o.technique]),s.technique.values=Iyt(s.technique,t)),t.removeObjectExtension(s,Zg)}t.removeExtension(Zg)}}async function Tyt(e,t){}function Syt(e,t){const{programs:i=[],shaders:n=[],techniques:r=[]}=e,s=new TextDecoder;return n.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=s.decode(t.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),i.forEach(o=>{o.fragmentShader=n[o.fragmentShader],o.vertexShader=n[o.vertexShader]}),r.forEach(o=>{o.program=i[o.program]}),r}function Iyt(e,t){const i=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach(n=>{e.uniforms[n].value&&!(n in i)&&(i[n]=e.uniforms[n].value)}),Object.keys(i).forEach(n=>{typeof i[n]=="object"&&i[n].index!==void 0&&(i[n].texture=t.getTexture(i[n].index))}),i}const Myt=Object.freeze(Object.defineProperty({__proto__:null,decode:Byt,encode:Tyt,name:Eyt},Symbol.toStringTag,{value:"Module"})),WF=[bmt,Jgt,E0t,S0t,P0t,ryt,vyt,Cyt,Myt,gyt,Nmt];function Pyt(e,t={},i){var n;const r=WF.filter(s=>JF(s.name,t));for(const s of r)(n=s.preprocess)==null||n.call(s,e,t,i)}async function Ryt(e,t={},i){var n;const r=WF.filter(s=>JF(s.name,t));for(const s of r)await((n=s.decode)==null?void 0:n.call(s,e,t,i))}function JF(e,t){var i;const n=((i=t==null?void 0:t.gltf)==null?void 0:i.excludeExtensions)||{};return!(e in n&&!n[e])}const Yw="KHR_binary_glTF";function Dyt(e){const t=new Vo(e),{json:i}=t;for(const n of i.images||[]){const r=t.getObjectExtension(n,Yw);r&&Object.assign(n,r),t.removeObjectExtension(n,Yw)}i.buffers&&i.buffers[0]&&delete i.buffers[0].uri,t.removeExtension(Yw)}const XF={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Oyt={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};let Lyt=class{constructor(){z(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),z(this,"json")}normalize(e,t){this.json=e.json;const i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${i.asset.version}`);return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),Dyt(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in XF)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const i=e[t];if(!(!i||Array.isArray(i))){e[t]=[];for(const n in i){const r=i[n];r.id=r.id||n;const s=e[t].length;e[t].push(r),this.idToIndexMap[t][n]=s}}}_convertObjectIdsToArrayIndices(e){for(const t in XF)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:i,indices:n,material:r}=t;for(const s in i)i[s]=this._convertIdToIndex(i[s],"accessor");n&&(t.indices=this._convertIdToIndex(n,"accessor")),r&&(t.material=this._convertIdToIndex(r,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const i of e[t])for(const n in i){const r=i[n],s=this._convertIdToIndex(r,n);i[n]=s}}_convertIdToIndex(e,t){const i=Oyt[t];if(i in this.idToIndexMap){const n=this.idToIndexMap[i][e];if(!Number.isFinite(n))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return n}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){var t,i,n;for(const r of e.materials){r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const s=((t=r.values)==null?void 0:t.tex)||((i=r.values)==null?void 0:i.texture2d_0)||((n=r.values)==null?void 0:n.diffuseTex),o=e.textures.findIndex(l=>l.id===s);o!==-1&&(r.pbrMetallicRoughness.baseColorTexture={index:o})}}};function Fyt(e,t={}){return new Lyt().normalize(e,t)}async function kyt(e,t,i=0,n,r){var s,o,l;return Nyt(e,t,i,n),Fyt(e,{normalize:(s=n==null?void 0:n.gltf)==null?void 0:s.normalize}),Pyt(e,n,r),(o=n==null?void 0:n.gltf)!=null&&o.loadBuffers&&e.json.buffers&&await Uyt(e,n,r),(l=n==null?void 0:n.gltf)!=null&&l.loadImages&&await Gyt(e,n,r),await Ryt(e,n,r),e}function Nyt(e,t,i,n){if(n.uri&&(e.baseUri=n.uri),t instanceof ArrayBuffer&&!s0t(t,i,n)&&(t=new TextDecoder().decode(t)),typeof t=="string")e.json=uL(t);else if(t instanceof ArrayBuffer){const o={};i=a0t(o,t,i,n.glb),ma(o.type==="glTF",`Invalid GLB magic string ${o.type}`),e._glb=o,e.json=o.json}else ma(!1,"GLTF: must be ArrayBuffer or string");const r=e.json.buffers||[];if(e.buffers=new Array(r.length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:o}=e._glb;e.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const s=e.json.images||[];e.images=new Array(s.length).fill({})}async function Uyt(e,t,i){var n,r;const s=e.json.buffers||[];for(let o=0;o<s.length;++o){const l=s[o];if(l.uri){const{fetch:h}=i;ma(h);const A=UF(l.uri,t),v=await((n=i==null?void 0:i.fetch)==null?void 0:n.call(i,A)),C=await((r=v==null?void 0:v.arrayBuffer)==null?void 0:r.call(v));e.buffers[o]={arrayBuffer:C,byteOffset:0,byteLength:C.byteLength},delete l.uri}else e.buffers[o]===null&&(e.buffers[o]={arrayBuffer:new ArrayBuffer(l.byteLength),byteOffset:0,byteLength:l.byteLength})}}async function Gyt(e,t,i){const n=zyt(e),r=e.json.images||[],s=[];for(const o of n)s.push(Vyt(e,r[o],o,t,i));return await Promise.all(s)}function zyt(e){const t=new Set,i=e.json.textures||[];for(const n of i)n.source!==void 0&&t.add(n.source);return Array.from(t).sort()}async function Vyt(e,t,i,n,r){let s;if(t.uri&&!t.hasOwnProperty("bufferView")){const l=UF(t.uri,n),{fetch:h}=r;s=await(await h(l)).arrayBuffer(),t.bufferView={data:s}}if(Number.isFinite(t.bufferView)){const l=Pgt(e.json,e.buffers,t.bufferView);s=Ug(l.buffer,l.byteOffset,l.byteLength)}ma(s,"glTF image has no data");let o=await yf(s,[qy,kF],{...n,mimeType:t.mimeType,basis:n.basis||{format:jw()}},r);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),e.images=e.images||[],e.images[i]=o}const qw={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:Umt,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:jyt,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function jyt(e,t={},i){t={...qw.options,...t},t.gltf={...qw.options.gltf,...t.gltf};const{byteOffset:n=0}=t;return await kyt({},e,n,t,i)}const Hyt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Wyt={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Ga={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},Jyt={magFilter:Ga.TEXTURE_MAG_FILTER,minFilter:Ga.TEXTURE_MIN_FILTER,wrapS:Ga.TEXTURE_WRAP_S,wrapT:Ga.TEXTURE_WRAP_T},Xyt={[Ga.TEXTURE_MAG_FILTER]:Ga.LINEAR,[Ga.TEXTURE_MIN_FILTER]:Ga.NEAREST_MIPMAP_LINEAR,[Ga.TEXTURE_WRAP_S]:Ga.REPEAT,[Ga.TEXTURE_WRAP_T]:Ga.REPEAT};function Kyt(){return{id:"default-sampler",parameters:Xyt}}function Qyt(e){return Wyt[e]}function Zyt(e){return Hyt[e]}let Yyt=class{constructor(){z(this,"baseUri",""),z(this,"jsonUnprocessed"),z(this,"json"),z(this,"buffers",[]),z(this,"images",[])}postProcess(e,t={}){const{json:i,buffers:n=[],images:r=[]}=e,{baseUri:s=""}=e;return ma(i),this.baseUri=s,this.buffers=n,this.images=r,this.jsonUnprocessed=i,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e,t={}){const i={...e};return this.json=i,e.bufferViews&&(i.bufferViews=e.bufferViews.map((n,r)=>this._resolveBufferView(n,r))),e.images&&(i.images=e.images.map((n,r)=>this._resolveImage(n,r))),e.samplers&&(i.samplers=e.samplers.map((n,r)=>this._resolveSampler(n,r))),e.textures&&(i.textures=e.textures.map((n,r)=>this._resolveTexture(n,r))),e.accessors&&(i.accessors=e.accessors.map((n,r)=>this._resolveAccessor(n,r))),e.materials&&(i.materials=e.materials.map((n,r)=>this._resolveMaterial(n,r))),e.meshes&&(i.meshes=e.meshes.map((n,r)=>this._resolveMesh(n,r))),e.nodes&&(i.nodes=e.nodes.map((n,r)=>this._resolveNode(n,r)),i.nodes=i.nodes.map((n,r)=>this._resolveNodeChildren(n))),e.skins&&(i.skins=e.skins.map((n,r)=>this._resolveSkin(n,r))),e.scenes&&(i.scenes=e.scenes.map((n,r)=>this._resolveScene(n,r))),typeof this.json.scene=="number"&&i.scenes&&(i.scene=i.scenes[this.json.scene]),i}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if(typeof t=="object")return t;const i=e&&e[t];return i||console.warn(`glTF file error: Could not find ${e}[${t}]`),i}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map(i=>this.getNode(i))}}_resolveNode(e,t){const i={...e,id:(e==null?void 0:e.id)||`node-${t}`};return e.mesh!==void 0&&(i.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(i.camera=this.getCamera(e.camera)),e.skin!==void 0&&(i.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(i.mesh=e.meshes.reduce((n,r)=>{const s=this.getMesh(r);return n.id=s.id,n.primitives=n.primitives.concat(s.primitives),n},{primitives:[]})),i}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(t=>this.getNode(t))),e}_resolveSkin(e,t){const i=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:i}}_resolveMesh(e,t){const i={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(i.primitives=e.primitives.map(n=>{const r={...n,attributes:{},indices:void 0,material:void 0},s=n.attributes;for(const o in s)r.attributes[o]=this.getAccessor(s[o]);return n.indices!==void 0&&(r.indices=this.getAccessor(n.indices)),n.material!==void 0&&(r.material=this.getMaterial(n.material)),r})),i}_resolveMaterial(e,t){const i={...e,id:e.id||`material-${t}`};if(i.normalTexture&&(i.normalTexture={...i.normalTexture},i.normalTexture.texture=this.getTexture(i.normalTexture.index)),i.occlusionTexture&&(i.occlusionTexture={...i.occlusionTexture},i.occlusionTexture.texture=this.getTexture(i.occlusionTexture.index)),i.emissiveTexture&&(i.emissiveTexture={...i.emissiveTexture},i.emissiveTexture.texture=this.getTexture(i.emissiveTexture.index)),i.emissiveFactor||(i.emissiveFactor=i.emissiveTexture?[1,1,1]:[0,0,0]),i.pbrMetallicRoughness){i.pbrMetallicRoughness={...i.pbrMetallicRoughness};const n=i.pbrMetallicRoughness;n.baseColorTexture&&(n.baseColorTexture={...n.baseColorTexture},n.baseColorTexture.texture=this.getTexture(n.baseColorTexture.index)),n.metallicRoughnessTexture&&(n.metallicRoughnessTexture={...n.metallicRoughnessTexture},n.metallicRoughnessTexture.texture=this.getTexture(n.metallicRoughnessTexture.index))}return i}_resolveAccessor(e,t){const i=Qyt(e.componentType),n=Zyt(e.type),r=i*n,s={...e,id:e.id||`accessor-${t}`,bytesPerComponent:i,components:n,bytesPerElement:r,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(s.bufferView=this.getBufferView(e.bufferView)),s.bufferView){const o=s.bufferView.buffer,{ArrayType:l,byteLength:h}=Lw(s,s.bufferView),A=(s.bufferView.byteOffset||0)+(s.byteOffset||0)+o.byteOffset;let v=o.arrayBuffer.slice(A,A+h);s.bufferView.byteStride&&(v=this._getValueFromInterleavedBuffer(o,A,s.bufferView.byteStride,s.bytesPerElement,s.count)),s.value=new l(v)}return s}_getValueFromInterleavedBuffer(e,t,i,n,r){const s=new Uint8Array(r*n);for(let o=0;o<r;o++){const l=t+o*i;s.set(new Uint8Array(e.arrayBuffer.slice(l,l+n)),o*n)}return s.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):Kyt(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,t){const i={id:e.id||`sampler-${t}`,...e,parameters:{}};for(const n in i){const r=this._enumSamplerParameter(n);r!==void 0&&(i.parameters[r]=i[n])}return i}_enumSamplerParameter(e){return Jyt[e]}_resolveImage(e,t){const i={...e,id:e.id||`image-${t}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},n=this.images[t];return n&&(i.image=n),i}_resolveBufferView(e,t){const i=e.buffer,n=this.buffers[i].arrayBuffer;let r=this.buffers[i].byteOffset||0;return e.byteOffset&&(r+=e.byteOffset),{id:`bufferView-${t}`,...e,buffer:this.buffers[i],data:new Uint8Array(n,r,e.byteLength)}}_resolveCamera(e,t){const i={...e,id:e.id||`camera-${t}`};return i.perspective,i.orthographic,i}};function qyt(e,t){return new Yyt().postProcess(e,t)}async function $yt(e){const t=[];return e.scenes.forEach(i=>{i.traverse(n=>{Object.values(n.model.uniforms).forEach(r=>{r.loaded===!1&&t.push(r)})})}),await t_t(()=>t.some(i=>!i.loaded))}async function t_t(e){for(;e();)await new Promise(t=>requestAnimationFrame(t))}const KF=`uniform scenegraphUniforms {
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  mat4 sceneModelMatrix;
  bool composeModelMatrix;
} scenegraph;
`,e_t={name:"scenegraph",vs:KF,fs:KF,uniformTypes:{sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",sceneModelMatrix:"mat4x4<f32>",composeModelMatrix:"f32"}},i_t=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef LIGHTING_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(LIGHTING_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(scenegraph.sizeScale);
float clampedSize = clamp(originalSize, scenegraph.sizeMinPixels, scenegraph.sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(positions, 1.0)).xyz) * scenegraph.sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(scenegraph.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef LIGHTING_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,n_t=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
in vec4 vColor;
out vec4 fragColor;
#ifndef LIGHTING_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D pbr_baseColorSampler;
#endif
#endif
void main(void) {
#ifdef LIGHTING_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(pbr_baseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= layer.opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,QF=[255,255,255,255],r_t={scenegraph:{type:"object",value:null,async:!0},getScene:e=>e&&e.scenes?typeof e.scene=="object"?e.scene:e.scenes[e.scene||0]:e,getAnimator:e=>e&&e.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:QF},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[qw]};class Yg extends Io{getShaders(){const t={};let i;this.props._lighting==="pbr"?(i=db,t.LIGHTING_PBR=1):i={name:"pbrMaterial"};const n=[Uo,pa,e_t,i];return super.getShaders({defines:t,vs:i_t,fs:n_t,modules:n})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:QF,transition:!0},instanceModelMatrix:dF})}updateState(t){super.updateState(t);const{props:i,oldProps:n}=t;i.scenegraph!==n.scenegraph?this._updateScenegraph():i._animations!==n._animations&&this._applyAnimationsProp(this.state.animator,i._animations)}finalizeState(t){var i;super.finalizeState(t),(i=this.state.scenegraph)==null||i.destroy()}get isLoaded(){var t;return!!((t=this.state)!=null&&t.scenegraph&&super.isLoaded)}_updateScenegraph(){var t;const i=this.props,{device:n}=this.context;let r=null;if(i.scenegraph instanceof N0)r={scenes:[i.scenegraph]};else if(i.scenegraph&&typeof i.scenegraph=="object"){const h=i.scenegraph,A=h.json?qyt(h):h,v=Egt(n,A,this._getModelOptions());r={gltf:A,...v},$yt(v).then(()=>{this.setNeedsRedraw()}).catch(C=>{this.raiseError(C,"loading glTF")})}const s={layer:this,device:this.context.device},o=i.getScene(r,s),l=i.getAnimator(r,s);if(o instanceof oA){(t=this.state.scenegraph)==null||t.destroy(),this._applyAnimationsProp(l,i._animations);const h=[];o.traverse(A=>{A instanceof Lb&&h.push(A.model)}),this.setState({scenegraph:o,animator:l,models:h}),this.getAttributeManager().invalidateAll()}else o!==null&&Yi.warn("invalid scenegraph:",o)()}_applyAnimationsProp(t,i){if(!t||!i)return;const n=t.getAnimations();Object.keys(i).sort().forEach(r=>{const s=i[r];if(r==="*")n.forEach(o=>{Object.assign(o,s)});else if(Number.isFinite(Number(r))){const o=Number(r);o>=0&&o<n.length?Object.assign(n[o],s):Yi.warn(`animation ${r} not found`)()}else{const o=n.find(({name:l})=>l===r);o?Object.assign(o,s):Yi.warn(`animation ${r} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:t}=this.props;let i;return t&&(typeof t=="function"?i=t({gl:this.context.gl,layer:this}):i=t),{imageBasedLightingEnvironment:i,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:t}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(t.timeline.getTime()),this.setNeedsRedraw());const{viewport:i,renderPass:n}=this.context,{sizeScale:r,sizeMinPixels:s,sizeMaxPixels:o,coordinateSystem:l}=this.props,h=this.getNumInstances();this.state.scenegraph.traverse((A,{worldMatrix:v})=>{if(A instanceof Lb){const{model:C}=A;C.setInstanceCount(h);const S={camera:C.uniforms.cameraPosition},L={sizeScale:r,sizeMinPixels:s,sizeMaxPixels:o,composeModelMatrix:pF(i,l),sceneModelMatrix:v};C.shaderInputs.setProps({pbrProjection:S,scenegraph:L}),C.draw(n)}})}}Yg.defaultProps=r_t,Yg.layerName="ScenegraphLayer";const o_t=Object.freeze(Object.defineProperty({__proto__:null,ScenegraphLayer:Yg,SimpleMeshLayer:bf},Symbol.toStringTag,{value:"Module"})),ZF=`uniform meshUniforms {
  bool pickFeatureIds;
} mesh;
`,s_t={name:"mesh",vs:ZF,fs:ZF,uniformTypes:{pickFeatureIds:"f32"}},a_t=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (mesh.pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBRMATERIAL
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,l_t=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBRMATERIAL
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= layer.opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function c_t(e){const t=e.positions||e.POSITION,i=t.value.length/t.size;e.COLOR_0||e.colors||(e.colors={size:4,value:new Uint8Array(i*4).fill(255),normalized:!0})}const u_t={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class $w extends bf{getShaders(){const t=super.getShaders();return t.modules.push(db,s_t),{...t,vs:a_t,fs:l_t}}initializeState(){const{featureIds:t}=this.props;super.initializeState();const i=this.getAttributeManager();t&&i.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(t){super.updateState(t);const{props:i,oldProps:n}=t;i.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(i.pbrMaterial)}draw(t){const{featureIds:i}=this.props,{model:n}=this.state;if(!n)return;const r={pickFeatureIds:!!i},s={camera:n.uniforms.cameraPosition};n.shaderInputs.setProps({pbrProjection:s,mesh:r}),super.draw(t)}getModel(t){const{id:i}=this.props,n=this.parseMaterial(this.props.pbrMaterial,t);this.setState({parsedPBRMaterial:n});const r=this.getShaders();return c_t(t.attributes),new Hr(this.context.device,{...this.getShaders(),id:i,geometry:t,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...r.defines,...n==null?void 0:n.defines,HAS_UV_REGIONS:t.attributes.uvRegions?1:0},parameters:n==null?void 0:n.parameters,isInstanced:!0})}updatePbrMaterialUniforms(t){const{model:i}=this.state;if(i){const{mesh:n}=this.props,r=this.parseMaterial(t,n);this.setState({parsedPBRMaterial:r});const{pbr_baseColorSampler:s}=r.bindings,{emptyTexture:o}=this.state,l={sampler:s||o,hasTexture:!!s},{camera:h,...A}={...r.bindings,...r.uniforms};i.shaderInputs.setProps({simpleMesh:l,pbrMaterial:A})}}parseMaterial(t,i){const n=!!(t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorTexture);return yF(this.context.device,{unlit:n,...t},{NORMAL:i.attributes.normals,TEXCOORD_0:i.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(t){const i=this.props.featureIds,n=new Uint8ClampedArray(i.length*t.size),r=[];for(let s=0;s<i.length;s++)this.encodePickingColor(i[s],r),n[s*3]=r[0],n[s*3+1]=r[1],n[s*3+2]=r[2];t.value=n}finalizeState(t){var i;super.finalizeState(t),(i=this.state.parsedPBRMaterial)==null||i.generatedTextures.forEach(n=>n.destroy()),this.setState({parsedPBRMaterial:null})}}$w.layerName="MeshLayer",$w.defaultProps=u_t;const h_t=6378137,f_t=6378137,d_t=6356752314245179e-9;function E_(e){return e}new de;function p_t(e,t=[],i=E_){return"longitude"in e?(t[0]=i(e.longitude),t[1]=i(e.latitude),t[2]=e.height):"x"in e?(t[0]=i(e.x),t[1]=i(e.y),t[2]=e.z):(t[0]=i(e[0]),t[1]=i(e[1]),t[2]=e[2]),t}function A_t(e,t=[]){return p_t(e,t,To._cartographicRadians?E_:OH)}function g_t(e,t,i=E_){return"longitude"in t?(t.longitude=i(e[0]),t.latitude=i(e[1]),t.height=e[2]):"x"in t?(t.x=i(e[0]),t.y=i(e[1]),t.z=e[2]):(t[0]=i(e[0]),t[1]=i(e[1]),t[2]=e[2]),t}function m_t(e,t){return g_t(e,t,To._cartographicRadians?E_:LH)}const YF=1e-14,y_t=new de,qF={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},tC={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},qg={east:new de,north:new de,up:new de,west:new de,south:new de,down:new de},__t=new de,v_t=new de,b_t=new de;function $F(e,t,i,n,r,s){const o=qF[t]&&qF[t][i];Al(o&&(!n||n===o));let l,h,A;const v=y_t.copy(r);if(fa(v.x,0,YF)&&fa(v.y,0,YF)){const C=Math.sign(v.z);l=__t.fromArray(tC[t]),t!=="east"&&t!=="west"&&l.scale(C),h=v_t.fromArray(tC[i]),i!=="east"&&i!=="west"&&h.scale(C),A=b_t.fromArray(tC[n]),n!=="east"&&n!=="west"&&A.scale(C)}else{const{up:C,east:S,north:L}=qg;S.set(-v.y,v.x,0).normalize(),e.geodeticSurfaceNormal(v,C),L.copy(C).cross(S);const{down:N,west:G,south:W}=qg;N.copy(C).scale(-1),G.copy(S).scale(-1),W.copy(L).scale(-1),l=qg[t],h=qg[i],A=qg[n]}return s[0]=l.x,s[1]=l.y,s[2]=l.z,s[3]=0,s[4]=h.x,s[5]=h.y,s[6]=h.z,s[7]=0,s[8]=A.x,s[9]=A.y,s[10]=A.z,s[11]=0,s[12]=v.x,s[13]=v.y,s[14]=v.z,s[15]=1,s}const Pp=new de,x_t=new de,w_t=new de;function C_t(e,t,i=[]){const{oneOverRadii:n,oneOverRadiiSquared:r,centerToleranceSquared:s}=t;Pp.from(e);const o=Pp.x,l=Pp.y,h=Pp.z,A=n.x,v=n.y,C=n.z,S=o*o*A*A,L=l*l*v*v,N=h*h*C*C,G=S+L+N,W=Math.sqrt(1/G);if(!Number.isFinite(W))return;const j=x_t;if(j.copy(e).scale(W),G<s)return j.to(i);const q=r.x,Z=r.y,K=r.z,ft=w_t;ft.set(j.x*q*2,j.y*Z*2,j.z*K*2);let rt=(1-W)*Pp.len()/(.5*ft.len()),Lt=0,Vt,At,at,kt;do{rt-=Lt,Vt=1/(1+rt*q),At=1/(1+rt*Z),at=1/(1+rt*K);const X=Vt*Vt,ht=At*At,Mt=at*at,pe=X*Vt,Ct=ht*At,Dt=Mt*at;kt=S*X+L*ht+N*Mt-1;const Gt=-2*(S*pe*q+L*Ct*Z+N*Dt*K);Lt=kt/Gt}while(Math.abs(kt)>tJ);return Pp.scale([Vt,At,at]).to(i)}const B_=new de,t8=new de,E_t=new de,Tl=new de,B_t=new de,T_=new de;class Cr{constructor(t=0,i=0,n=0){this.centerToleranceSquared=$W,Al(t>=0),Al(i>=0),Al(n>=0),this.radii=new de(t,i,n),this.radiiSquared=new de(t*t,i*i,n*n),this.radiiToTheFourth=new de(t*t*t*t,i*i*i*i,n*n*n*n),this.oneOverRadii=new de(t===0?0:1/t,i===0?0:1/i,n===0?0:1/n),this.oneOverRadiiSquared=new de(t===0?0:1/(t*t),i===0?0:1/(i*i),n===0?0:1/(n*n)),this.minimumRadius=Math.min(t,i,n),this.maximumRadius=Math.max(t,i,n),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||!!(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t,i=[0,0,0]){const n=t8,r=E_t,[,,s]=t;this.geodeticSurfaceNormalCartographic(t,n),r.copy(this.radiiSquared).scale(n);const o=Math.sqrt(n.dot(r));return r.scale(1/o),n.scale(s),r.add(n),r.to(i)}cartesianToCartographic(t,i=[0,0,0]){T_.from(t);const n=this.scaleToGeodeticSurface(T_,Tl);if(!n)return;const r=this.geodeticSurfaceNormal(n,t8),s=B_t;s.copy(T_).subtract(n);const o=Math.atan2(r.y,r.x),l=Math.asin(r.z),h=Math.sign(tb(s,T_))*TI(s);return m_t([o,l,h],i)}eastNorthUpToFixedFrame(t,i=new mn){return $F(this,"east","north","up",t,i)}localFrameToFixedFrame(t,i,n,r,s=new mn){return $F(this,t,i,n,r,s)}geocentricSurfaceNormal(t,i=[0,0,0]){return B_.from(t).normalize().to(i)}geodeticSurfaceNormalCartographic(t,i=[0,0,0]){const n=A_t(t),r=n[0],s=n[1],o=Math.cos(s);return B_.set(o*Math.cos(r),o*Math.sin(r),Math.sin(s)).normalize(),B_.to(i)}geodeticSurfaceNormal(t,i=[0,0,0]){return B_.from(t).scale(this.oneOverRadiiSquared).normalize().to(i)}scaleToGeodeticSurface(t,i){return C_t(t,this,i)}scaleToGeocentricSurface(t,i=[0,0,0]){Tl.from(t);const n=Tl.x,r=Tl.y,s=Tl.z,o=this.oneOverRadiiSquared,l=1/Math.sqrt(n*n*o.x+r*r*o.y+s*s*o.z);return Tl.multiplyScalar(l).to(i)}transformPositionToScaledSpace(t,i=[0,0,0]){return Tl.from(t).scale(this.oneOverRadii).to(i)}transformPositionFromScaledSpace(t,i=[0,0,0]){return Tl.from(t).scale(this.radii).to(i)}getSurfaceNormalIntersectionWithZAxis(t,i=0,n=[0,0,0]){Al(fa(this.radii.x,this.radii.y,HI)),Al(this.radii.z>0),Tl.from(t);const r=Tl.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(r)>=this.radii.z-i))return Tl.set(0,0,r).to(n)}}Cr.WGS84=new Cr(h_t,f_t,d_t);class T_t{constructor(t,i,n){z(this,"item"),z(this,"previous"),z(this,"next"),this.item=t,this.previous=i,this.next=n}}class S_t{constructor(){z(this,"head",null),z(this,"tail",null),z(this,"_length",0)}get length(){return this._length}add(t){const i=new T_t(t,this.tail,null);return this.tail?(this.tail.next=i,this.tail=i):(this.head=i,this.tail=i),++this._length,i}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,i){t!==i&&(this.remove(i),this._insert(t,i))}_insert(t,i){const n=t.next;t.next=i,this.tail===t?this.tail=i:n.previous=i,i.next=n,i.previous=t,++this._length}}class I_t{constructor(){z(this,"_list"),z(this,"_sentinel"),z(this,"_trimTiles"),this._list=new S_t,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const i=t._cacheNode;i&&this._list.splice(this._sentinel,i)}add(t,i,n){i._cacheNode||(i._cacheNode=this._list.add(i),n&&n(t,i))}unloadTile(t,i,n){const r=i._cacheNode;r&&(this._list.remove(r),i._cacheNode=null,n&&n(t,i))}unloadTiles(t,i){const n=this._trimTiles;this._trimTiles=!1;const r=this._list,s=t.maximumMemoryUsage*1024*1024,o=this._sentinel;let l=r.head;for(;l!==o&&(t.gpuMemoryUsageInBytes>s||n);){const h=l.item;l=l.next,this.unloadTile(t,h,i)}}trim(){this._trimTiles=!0}}function M_t(e,t){yr(e),yr(t);const{rtcCenter:i,gltfUpAxis:n}=t,{computedTransform:r,boundingVolume:{center:s}}=e;let o=new mn(r);switch(i&&o.translate(i),n){case"Z":break;case"Y":const v=new mn().rotateX(Math.PI/2);o=o.multiplyRight(v);break;case"X":const C=new mn().rotateY(-Math.PI/2);o=o.multiplyRight(C);break}t.isQuantized&&o.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const l=new de(s);t.cartesianModelMatrix=o,t.cartesianOrigin=l;const h=Cr.WGS84.cartesianToCartographic(l,new de),A=Cr.WGS84.eastNorthUpToFixedFrame(l).invert();t.cartographicModelMatrix=A.multiplyRight(o),t.cartographicOrigin=h,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}const e8=new de,eC=new de,iC=new ba([new Rl,new Rl,new Rl,new Rl,new Rl,new Rl]);function P_t(e,t){const{cameraDirection:i,cameraUp:n,height:r}=e,{metersPerUnit:s}=e.distanceScales,o=S_(e,e.center),l=Cr.WGS84.eastNorthUpToFixedFrame(o),h=e.unprojectPosition(e.cameraPosition),A=Cr.WGS84.cartographicToCartesian(h,new de),v=new de(l.transformAsVector(new de(i).scale(s))).normalize(),C=new de(l.transformAsVector(new de(n).scale(s))).normalize();D_t(e);const S=e.constructor,{longitude:L,latitude:N,width:G,bearing:W,zoom:j}=e,q=new S({longitude:L,latitude:N,height:r,width:G,bearing:W,zoom:j,pitch:0});return{camera:{position:A,direction:v,up:C},viewport:e,topDownViewport:q,height:r,cullingVolume:iC,frameNumber:t,sseDenominator:1.15}}function R_t(e,t,i){if(i===0||e.length<=i)return[e,[]];const n=[],{longitude:r,latitude:s}=t.viewport;for(const[A,v]of e.entries()){const[C,S]=v.header.mbs,L=Math.abs(r-C),N=Math.abs(s-S),G=Math.sqrt(N*N+L*L);n.push([A,G])}const o=n.sort((A,v)=>A[1]-v[1]),l=[];for(let A=0;A<i;A++)l.push(e[o[A][0]]);const h=[];for(let A=i;A<o.length;A++)h.push(e[o[A][0]]);return[l,h]}function D_t(e){const t=e.getFrustumPlanes(),i=i8(t.near,e.cameraPosition),n=S_(e,i),r=S_(e,e.cameraPosition,eC);let s=0;iC.planes[s++].fromPointNormal(n,e8.copy(n).subtract(r));for(const o in t){if(o==="near")continue;const l=t[o],h=i8(l,i,eC),A=S_(e,h,eC);iC.planes[s++].fromPointNormal(A,e8.copy(n).subtract(A))}}function i8(e,t,i=new de){const n=e.normal.dot(t);return i.copy(e.normal).scale(e.distance-n).add(t),i}function S_(e,t,i=new de){const n=e.unprojectPosition(t);return Cr.WGS84.cartographicToCartesian(n,i)}const O_t=6378137,L_t=6378137,nC=6356752314245179e-9,Rp=new de;function F_t(e,t){if(e instanceof um){const{halfAxes:i}=e,n=N_t(i);return Math.log2(nC/(n+t[2]))}else if(e instanceof cm){const{radius:i}=e;return Math.log2(nC/(i+t[2]))}else if(e.width&&e.height){const{width:i,height:n}=e,r=Math.log2(O_t/i),s=Math.log2(L_t/n);return(r+s)/2}return 1}function n8(e,t,i){Cr.WGS84.cartographicToCartesian([e.xmax,e.ymax,e.zmax],Rp);const n=Math.sqrt(Math.pow(Rp[0]-i[0],2)+Math.pow(Rp[1]-i[1],2)+Math.pow(Rp[2]-i[2],2));return Math.log2(nC/(n+t[2]))}function k_t(e,t,i){const[n,r,s,o]=e;return n8({xmax:s,ymax:o,zmax:0},t,i)}function N_t(e){e.getColumn(0,Rp);const t=e.getColumn(1),i=e.getColumn(2);return Rp.add(t).add(i).len()}const _a={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var Sl;(function(e){e[e.ADD=1]="ADD",e[e.REPLACE=2]="REPLACE"})(Sl||(Sl={}));var lu;(function(e){e.EMPTY="empty",e.SCENEGRAPH="scenegraph",e.POINTCLOUD="pointcloud",e.MESH="mesh"})(lu||(lu={}));var Ws;(function(e){e.I3S="I3S",e.TILES3D="TILES3D"})(Ws||(Ws={}));var Dp;(function(e){e.GEOMETRIC_ERROR="geometricError",e.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(Dp||(Dp={}));const U_t={USE_OPTIMIZATION:1};function r8(e){return e!=null}const xs=new de,I_=new de,G_t=new de,z_t=new de,Cf=new de,o8=new de,s8=new de,a8=new de;function rC(e,t,i){if(yr(e,"3D Tile: boundingVolume must be defined"),e.box)return l8(e.box,t,i);if(e.region)return H_t(e.region);if(e.sphere)return j_t(e.sphere,t,i);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function V_t(e,t){if(e.box)return W_t(t);if(e.region){const[i,n,r,s,o,l]=e.region;return[[dl(i),dl(n),o],[dl(r),dl(s),l]]}if(e.sphere)return J_t(t);throw new Error("Unkown boundingVolume type")}function l8(e,t,i){const n=new de(e[0],e[1],e[2]);t.transform(n,n);let r=[];if(e.length===10){const A=e.slice(3,6),v=new YA;v.fromArray(e,6);const C=new de([1,0,0]),S=new de([0,1,0]),L=new de([0,0,1]);C.transformByQuaternion(v),C.scale(A[0]),S.transformByQuaternion(v),S.scale(A[1]),L.transformByQuaternion(v),L.scale(A[2]),r=[...C.toArray(),...S.toArray(),...L.toArray()]}else r=[...e.slice(3,6),...e.slice(6,9),...e.slice(9,12)];const s=t.transformAsVector(r.slice(0,3)),o=t.transformAsVector(r.slice(3,6)),l=t.transformAsVector(r.slice(6,9)),h=new mr([s[0],s[1],s[2],o[0],o[1],o[2],l[0],l[1],l[2]]);return r8(i)?(i.center=n,i.halfAxes=h,i):new um(n,h)}function j_t(e,t,i){const n=new de(e[0],e[1],e[2]);t.transform(n,n);const r=t.getScale(I_),s=Math.max(Math.max(r[0],r[1]),r[2]),o=e[3]*s;return r8(i)?(i.center=n,i.radius=o,i):new cm(n,o)}function H_t(e){const[t,i,n,r,s,o]=e,l=Cr.WGS84.cartographicToCartesian([dl(t),dl(r),s],G_t),h=Cr.WGS84.cartographicToCartesian([dl(n),dl(i),o],z_t),A=new de().addVectors(l,h).multiplyByScalar(.5);return Cr.WGS84.cartesianToCartographic(A,Cf),Cr.WGS84.cartographicToCartesian([dl(n),Cf[1],Cf[2]],o8),Cr.WGS84.cartographicToCartesian([Cf[0],dl(r),Cf[2]],s8),Cr.WGS84.cartographicToCartesian([Cf[0],Cf[1],o],a8),l8([...A,...o8.subtract(A),...s8.subtract(A),...a8.subtract(A)],new mn)}function W_t(e){const t=c8(),{halfAxes:i}=e,n=new de(i.getColumn(0)),r=new de(i.getColumn(1)),s=new de(i.getColumn(2));for(let o=0;o<2;o++){for(let l=0;l<2;l++){for(let h=0;h<2;h++)xs.copy(e.center),xs.add(n),xs.add(r),xs.add(s),u8(t,xs),s.negate();r.negate()}n.negate()}return t}function J_t(e){const t=c8(),{center:i,radius:n}=e,r=Cr.WGS84.scaleToGeodeticSurface(i,xs);let s;r?s=Cr.WGS84.geodeticSurfaceNormal(r):s=new de(0,0,1);let o=new de(s[2],-s[1],0);o.len()>0?o.normalize():o=new de(0,1,0);const l=o.clone().cross(s);for(const h of[o,l,s]){I_.copy(h).scale(n);for(let A=0;A<2;A++)xs.copy(i),xs.add(I_),u8(t,xs),I_.negate()}return t}function c8(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function u8(e,t){Cr.WGS84.cartesianToCartographic(t,xs),e[0][0]=Math.min(e[0][0],xs[0]),e[0][1]=Math.min(e[0][1],xs[1]),e[0][2]=Math.min(e[0][2],xs[2]),e[1][0]=Math.max(e[1][0],xs[0]),e[1][1]=Math.max(e[1][1],xs[1]),e[1][2]=Math.max(e[1][2],xs[2])}new de,new de,new mn,new de,new de,new de;function X_t(e,t){const i=e*t;return 1-Math.exp(-(i*i))}function K_t(e,t){if(e.dynamicScreenSpaceError&&e.dynamicScreenSpaceErrorComputedDensity){const i=e.dynamicScreenSpaceErrorComputedDensity,n=e.dynamicScreenSpaceErrorFactor;return X_t(t,i)*n}return 0}function Q_t(e,t,i){const n=e.tileset,r=e.parent&&e.parent.lodMetricValue||e.lodMetricValue,s=i?r:e.lodMetricValue;if(s===0)return 0;const o=Math.max(e._distanceToCamera,1e-7),{height:l,sseDenominator:h}=t,{viewDistanceScale:A}=n.options;let v=s*l*(A||1)/(o*h);return v-=K_t(n,o),v}const oC=new de,h8=new de,mh=new de,f8=new de,Z_t=new de,sC=new mn,d8=new mn;function Y_t(e,t){if(e.lodMetricValue===0||isNaN(e.lodMetricValue))return"DIG";const i=2*p8(e,t);return i<2?"OUT":!e.header.children||i<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}function p8(e,t){const{topDownViewport:i}=t,n=e.header.mbs[1],r=e.header.mbs[0],s=e.header.mbs[2],o=e.header.mbs[3],l=[...e.boundingVolume.center],h=i.unprojectPosition(i.cameraPosition);Cr.WGS84.cartographicToCartesian(h,oC),h8.copy(oC).subtract(l).normalize(),Cr.WGS84.eastNorthUpToFixedFrame(l,sC),d8.copy(sC).invert(),mh.copy(oC).transform(d8);const A=Math.sqrt(mh[0]*mh[0]+mh[1]*mh[1]),v=A*A/mh[2];f8.copy([mh[0],mh[1],v]);const C=f8.transform(sC).subtract(l).normalize(),S=h8.cross(C).normalize().scale(o).add(l),L=Cr.WGS84.cartesianToCartographic(S),N=i.project([r,n,s]),G=i.project(L);return Z_t.copy(N).subtract(G).magnitude()}function q_t(e){return{assetGltfUpAxis:e.asset&&e.asset.gltfUpAxis||"Y"}}class A8{constructor(t=0){z(this,"_map",new Map),z(this,"_array"),z(this,"_length"),this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return yr(t<this._array.length),this._array[t]}set(t,i){yr(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=i,this._map.set(i,t)}delete(t){const i=this._map.get(t);i>=0&&(this._array.splice(i,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const i=this.length++;this._array[i]=t,this._map.set(t,i)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){yr(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){yr(t>=0),this.length=t}trim(t){t==null&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const $_t={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class M_{constructor(t){z(this,"options"),z(this,"root",null),z(this,"selectedTiles",{}),z(this,"requestedTiles",{}),z(this,"emptyTiles",{}),z(this,"lastUpdate",new Date().getTime()),z(this,"updateDebounceTime",1e3),z(this,"_traversalStack",new A8),z(this,"_emptyTraversalStack",new A8),z(this,"_frameNumber",null),this.options={...$_t,...t}}traversalFinished(t){return!0}traverse(t,i,n){this.root=t,this.options={...this.options,...n},this.reset(),this.updateTile(t,i),this._frameNumber=i.frameNumber,this.executeTraversal(t,i)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,i){const n=this._traversalStack;for(t._selectionDepth=1,n.push(t);n.length>0;){const s=n.pop();let o=!1;this.canTraverse(s,i)&&(this.updateChildTiles(s,i),o=this.updateAndPushChildren(s,i,n,s.hasRenderContent?s._selectionDepth+1:s._selectionDepth));const l=s.parent,h=!!(!l||l._shouldRefine),A=!o;s.hasRenderContent?s.refine===Sl.ADD?(this.loadTile(s,i),this.selectTile(s,i)):s.refine===Sl.REPLACE&&(this.loadTile(s,i),A&&this.selectTile(s,i)):(this.emptyTiles[s.id]=s,this.loadTile(s,i),A&&this.selectTile(s,i)),this.touchTile(s,i),s._shouldRefine=o&&h}const r=new Date().getTime();(this.traversalFinished(i)||r-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=r,this.options.onTraversalEnd(i))}updateChildTiles(t,i){const n=t.children;for(const r of n)this.updateTile(r,i)}updateAndPushChildren(t,i,n,r){const{loadSiblings:s,skipLevelOfDetail:o}=this.options,l=t.children;l.sort(this.compareDistanceToCamera.bind(this));const h=t.refine===Sl.REPLACE&&t.hasRenderContent&&!o;let A=!1,v=!0;for(const C of l)if(C._selectionDepth=r,C.isVisibleAndInRequestVolume?(n.find(C)&&n.delete(C),n.push(C),A=!0):(h||s)&&(this.loadTile(C,i),this.touchTile(C,i)),h){let S;if(C._inRequestVolume?C.hasRenderContent?S=C.contentAvailable:S=this.executeEmptyTraversal(C,i):S=!1,v=v&&S,!v)return!1}return A||(v=!1),v}updateTile(t,i){this.updateTileVisibility(t,i)}selectTile(t,i){this.shouldSelectTile(t)&&(t._selectedFrame=i.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,i){this.shouldLoadTile(t)&&(t._requestedFrame=i.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,i){t.tileset._cache.touch(t),t._touchedFrame=i.frameNumber}canTraverse(t,i){return t.hasChildren?t.hasTilesetContent?!t.contentExpired:this.shouldRefine(t,i):!1}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,i,n=!1){let r=t._screenSpaceError;return n&&(r=t.getScreenSpaceError(i,!0)),r>t.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(t,i){const n=[];if(this.options.viewportTraversersMap)for(const r in this.options.viewportTraversersMap)this.options.viewportTraversersMap[r]===i.viewport.id&&n.push(r);else n.push(i.viewport.id);t.updateVisibility(i,n)}compareDistanceToCamera(t,i){return t._distanceToCamera-i._distanceToCamera}anyChildrenVisible(t,i){let n=!1;for(const r of t.children)r.updateVisibility(i),n=n||r.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(t,i){let n=!0;const r=this._emptyTraversalStack;for(r.push(t);r.length>0;){const s=r.pop(),o=!s.hasRenderContent&&this.canTraverse(s,i),l=!s.hasRenderContent&&s.children.length===0;if(!o&&!s.contentAvailable&&!l&&(n=!1),this.updateTile(s,i),s.isVisibleAndInRequestVolume||(this.loadTile(s,i),this.touchTile(s,i)),o){const h=s.children;for(const A of h)r.push(A)}}return n}}const g8=new de;function tvt(e){return e!=null}class aC{constructor(t,i,n,r=""){z(this,"tileset"),z(this,"header"),z(this,"id"),z(this,"url"),z(this,"parent"),z(this,"refine"),z(this,"type"),z(this,"contentUrl"),z(this,"lodMetricType","geometricError"),z(this,"lodMetricValue",0),z(this,"boundingVolume",null),z(this,"content",null),z(this,"contentState",_a.UNLOADED),z(this,"gpuMemoryUsageInBytes",0),z(this,"children",[]),z(this,"depth",0),z(this,"viewportIds",[]),z(this,"transform",new mn),z(this,"extensions",null),z(this,"implicitTiling",null),z(this,"userData",{}),z(this,"computedTransform"),z(this,"hasEmptyContent",!1),z(this,"hasTilesetContent",!1),z(this,"traverser",new M_({})),z(this,"_cacheNode",null),z(this,"_frameNumber",null),z(this,"_expireDate",null),z(this,"_expiredContent",null),z(this,"_boundingBox"),z(this,"_distanceToCamera",0),z(this,"_screenSpaceError",0),z(this,"_visibilityPlaneMask"),z(this,"_visible"),z(this,"_contentBoundingVolume"),z(this,"_viewerRequestVolume"),z(this,"_initialTransform",new mn),z(this,"_priority",0),z(this,"_selectedFrame",0),z(this,"_requestedFrame",0),z(this,"_selectionDepth",0),z(this,"_touchedFrame",0),z(this,"_centerZDepth",0),z(this,"_shouldRefine",!1),z(this,"_stackLength",0),z(this,"_visitedFrame",0),z(this,"_inRequestVolume",!1),z(this,"_lodJudge",null),this.header=i,this.tileset=t,this.id=r||i.id,this.url=i.url,this.parent=n,this.refine=this._getRefine(i.refine),this.type=i.type,this.contentUrl=i.contentUrl,this._initializeLodMetric(i),this._initializeTransforms(i),this._initializeBoundingVolumes(i),this._initializeContent(i),this._initializeRenderingState(i),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===_a.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===_a.UNLOADED}get contentExpired(){return this.contentState===_a.EXPIRED}get contentFailed(){return this.contentState===_a.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=V_t(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(t,i){switch(this.tileset.type){case Ws.I3S:return p8(this,t);case Ws.TILES3D:return Q_t(this,t,i);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:i}=t.options,n=this.refine===Sl.ADD||i;if(n&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===_a.UNLOADED)return-1;const r=this.parent,s=r&&(!n||this._screenSpaceError===0||r.hasTilesetContent)?r._screenSpaceError:this._screenSpaceError,o=t.root?t.root._screenSpaceError:0;return Math.max(o-s,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=_a.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=_a.UNLOADED,!1;try{const i=this.tileset.getTileUrl(this.contentUrl),n=this.tileset.loader,r={...this.tileset.loadOptions,[n.id]:{...this.tileset.loadOptions[n.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(n.id)}};return this.content=await gp(i,n,r),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=_a.READY,this._onContentLoaded(),!0}catch(i){throw this.contentState=_a.FAILED,i}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=_a.UNLOADED,!0}updateVisibility(t,i){if(this._frameNumber===t.frameNumber)return;const n=this.parent,r=n?n._visibilityPlaneMask:ba.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const s=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(s)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,r),this._visible=this._visibilityPlaneMask!==ba.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=i}visibility(t,i){const{cullingVolume:n}=t,{boundingVolume:r}=this;return n.computeVisibilityWithPlaneMask(r,i)}contentVisibility(){return!0}distanceToTile(t){const i=this.boundingVolume;return Math.sqrt(Math.max(i.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth({camera:t}){const i=this.boundingVolume;return g8.subVectors(i.center,t.position),t.direction.dot(g8)}insideViewerRequestVolume(t){const i=this._viewerRequestVolume;return!i||i.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(tvt(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=_a.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new mn(t.transform):new mn;const i=this.parent,n=this.tileset,r=i&&i.computedTransform?i.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new mn(r).multiplyRight(this.transform);const s=i&&i._initialTransform?i._initialTransform.clone():new mn;this._initialTransform=new mn(s).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=_a.UNLOADED,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=ba.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||Sl.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(t){this.boundingVolume=rC(t.boundingVolume,this.computedTransform,this.boundingVolume);const i=t.content;i&&(i.boundingVolume&&(this._contentBoundingVolume=rC(i.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=rC(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(t=new mn){const i=t.clone().multiplyRight(this.transform);i.equals(this.computedTransform)||(this.computedTransform=i,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){switch(t){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return q_t(this.tileset.tileset)}}}class evt extends M_{compareDistanceToCamera(t,i){return i._distanceToCamera===0&&t._distanceToCamera===0?i._centerZDepth-t._centerZDepth:i._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,i){if(super.updateTileVisibility(t,i),!t.isVisibleAndInRequestVolume)return;const n=t.children.length>0;if(t.hasTilesetContent&&n){const o=t.children[0];this.updateTileVisibility(o,i),t._visible=o._visible;return}if(this.meetsScreenSpaceErrorEarly(t,i)){t._visible=!1;return}const r=t.refine===Sl.REPLACE,s=t._optimChildrenWithinParent===U_t.USE_OPTIMIZATION;if(r&&s&&n&&!this.anyChildrenVisible(t,i)){t._visible=!1;return}}meetsScreenSpaceErrorEarly(t,i){const{parent:n}=t;return!n||n.hasTilesetContent||n.refine!==Sl.ADD?!1:!this.shouldRefine(t,i,!0)}}class ivt{constructor(){z(this,"frameNumberMap",new Map)}register(t,i){const n=this.frameNumberMap.get(t)||new Map,r=n.get(i)||0;n.set(i,r+1),this.frameNumberMap.set(t,n)}deregister(t,i){const n=this.frameNumberMap.get(t);if(!n)return;const r=n.get(i)||1;n.set(i,r-1)}isZero(t,i){var n;return(((n=this.frameNumberMap.get(t))==null?void 0:n.get(i))||0)===0}}const lC={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class nvt{constructor(){z(this,"_statusMap"),z(this,"pendingTilesRegister",new ivt),this._statusMap={}}add(t,i,n,r){if(!this._statusMap[i]){const{frameNumber:s,viewport:{id:o}}=r;this._statusMap[i]={request:t,callback:n,key:i,frameState:r,status:lC.REQUESTED},this.pendingTilesRegister.register(o,s),t().then(l=>{this._statusMap[i].status=lC.COMPLETED;const{frameNumber:h,viewport:{id:A}}=this._statusMap[i].frameState;this.pendingTilesRegister.deregister(A,h),this._statusMap[i].callback(l,r)}).catch(l=>{this._statusMap[i].status=lC.ERROR;const{frameNumber:h,viewport:{id:A}}=this._statusMap[i].frameState;this.pendingTilesRegister.deregister(A,h),n(l)})}}update(t,i){if(this._statusMap[t]){const{frameNumber:n,viewport:{id:r}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(r,n);const{frameNumber:s,viewport:{id:o}}=i;this.pendingTilesRegister.register(o,s),this._statusMap[t].frameState=i}}find(t){return this._statusMap[t]}hasPendingTiles(t,i){return!this.pendingTilesRegister.isZero(t,i)}}class rvt extends M_{constructor(t){super(t),z(this,"_tileManager"),this._tileManager=new nvt}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,i){return t._lodJudge=Y_t(t,i),t._lodJudge==="DIG"}updateChildTiles(t,i){const n=t.header.children||[],r=t.children,s=t.tileset;for(const o of n){const l=`${o.id}-${i.viewport.id}`,h=r&&r.find(A=>A.id===l);if(h)h&&this.updateTile(h,i);else{let A=()=>this._loadTile(o.id,s);this._tileManager.find(l)?this._tileManager.update(l,i):(s.tileset.nodePages&&(A=()=>s.tileset.nodePagesTile.formTileFromNodePages(o.id)),this._tileManager.add(A,l,v=>this._onTileLoad(v,t,l),i))}}return!1}async _loadTile(t,i){const{loader:n}=i,r=i.getTileUrl(`${i.url}/nodes/${t}`),s={...i.loadOptions,i3s:{...i.loadOptions.i3s,isTileHeader:!0}};return await gp(r,n,s)}_onTileLoad(t,i,n){const r=new aC(i.tileset,t,i,n);i.children.push(r);const s=this._tileManager.find(r.id).frameState;this.updateTile(r,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(r,s)}}const ovt={description:"",ellipsoid:Cr.WGS84,modelMatrix:new mn,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:e=>e,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},P_="Tiles In Tileset(s)",cC="Tiles In Memory",m8="Tiles In View",y8="Tiles To Render",_8="Tiles Loaded",uC="Tiles Loading",v8="Tiles Unloaded",b8="Failed Tile Loads",x8="Points/Vertices",hC="Tile Memory Use",w8="Maximum Screen Space Error";class svt{constructor(t,i){z(this,"options"),z(this,"loadOptions"),z(this,"type"),z(this,"tileset"),z(this,"loader"),z(this,"url"),z(this,"basePath"),z(this,"modelMatrix"),z(this,"ellipsoid"),z(this,"lodMetricType"),z(this,"lodMetricValue"),z(this,"refine"),z(this,"root",null),z(this,"roots",{}),z(this,"asset",{}),z(this,"description",""),z(this,"properties"),z(this,"extras",null),z(this,"attributions",{}),z(this,"credits",{}),z(this,"stats"),z(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),z(this,"cartographicCenter",null),z(this,"cartesianCenter",null),z(this,"zoom",1),z(this,"boundingVolume",null),z(this,"dynamicScreenSpaceErrorComputedDensity",0),z(this,"maximumMemoryUsage",32),z(this,"gpuMemoryUsageInBytes",0),z(this,"memoryAdjustedScreenSpaceError",0),z(this,"_cacheBytes",0),z(this,"_cacheOverflowBytes",0),z(this,"_frameNumber",0),z(this,"_queryParams",{}),z(this,"_extensionsUsed",[]),z(this,"_tiles",{}),z(this,"_pendingCount",0),z(this,"selectedTiles",[]),z(this,"traverseCounter",0),z(this,"geometricError",0),z(this,"lastUpdatedVieports",null),z(this,"_requestedTiles",[]),z(this,"_emptyTiles",[]),z(this,"frameStateData",{}),z(this,"_traverser"),z(this,"_cache",new I_t),z(this,"_requestScheduler"),z(this,"updatePromise",null),z(this,"tilesetInitializationPromise"),this.options={...ovt,...i},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||dL(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new fL({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new x6({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(t){this.options={...this.options,...t}}getTileUrl(t){if(t.startsWith("data:"))return t;let i=t;return this.queryParams.length&&(i=`${t}${t.includes("?")?"&":"?"}${this.queryParams}`),i}hasExtension(t){return this._extensionsUsed.indexOf(t)>-1}update(t=null){this.tilesetInitializationPromise.then(()=>{!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t&&this.doUpdate(t)})}async selectTiles(t=null){return await this.tilesetInitializationPromise,t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise(i=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),i(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(t){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const i=t instanceof Array?t:[t];this._cache.reset(),this._frameNumber++,this.traverseCounter=i.length;const n=[];for(const r of i){const s=r.id;this._needTraverse(s)?n.push(s):this.traverseCounter--}for(const r of i){const s=r.id;if(this.roots[s]||(this.roots[s]=this._initializeTileHeaders(this.tileset,null)),!n.includes(s))continue;const o=P_t(r,this._frameNumber);this._traverser.traverse(this.roots[s],o,this.options)}}_needTraverse(t){let i=t;return this.options.viewportTraversersMap&&(i=this.options.viewportTraversersMap[t]),i===t}_onTraversalEnd(t){const i=t.viewport.id;this.frameStateData[i]||(this.frameStateData[i]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const n=this.frameStateData[i],r=Object.values(this._traverser.selectedTiles),[s,o]=R_t(r,t,this.options.maximumTilesSelected);n.selectedTiles=s;for(const l of o)l.unselect();n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const i=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(i.selectedTiles),this._requestedTiles=this._requestedTiles.concat(i._requestedTiles),this._emptyTiles=this._emptyTiles.concat(i._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,i){if(t.length!==i.length)return!0;const n=new Set(t.map(o=>o.id)),r=new Set(i.map(o=>o.id));let s=t.filter(o=>!r.has(o.id)).length>0;return s=s||i.filter(o=>!n.has(o.id)).length>0,s}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,(t,i)=>t._unloadTile(i))}_updateStats(){let t=0,i=0;for(const n of this.selectedTiles)n.contentAvailable&&n.content&&(t++,n.content.pointCount?i+=n.content.pointCount:i+=n.content.vertexCount);this.stats.get(m8).count=this.selectedTiles.length,this.stats.get(y8).count=t,this.stats.get(x8).count=i,this.stats.get(w8).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(t){this.type===Ws.I3S&&(this.calculateViewPropsI3S(),t.root=await t.root),this.root=this._initializeTileHeaders(t,null),this.type===Ws.TILES3D&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===Ws.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var t;const i=this.tileset.fullExtent;if(i){const{xmin:r,xmax:s,ymin:o,ymax:l,zmin:h,zmax:A}=i;this.cartographicCenter=new de(r+(s-r)/2,o+(l-o)/2,h+(A-h)/2),this.cartesianCenter=new de,Cr.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=n8(i,this.cartographicCenter,this.cartesianCenter);return}const n=(t=this.tileset.store)==null?void 0:t.extent;if(n){const[r,s,o,l]=n;this.cartographicCenter=new de(r+(o-r)/2,s+(l-s)/2,0),this.cartesianCenter=new de,Cr.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=k_t(n,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new de,this.zoom=1}calculateViewPropsTiles3D(){const t=this.root,{center:i}=t.boundingVolume;if(!i){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new de,this.zoom=1;return}i[0]!==0||i[1]!==0||i[2]!==0?(this.cartographicCenter=new de,Cr.WGS84.cartesianToCartographic(i,this.cartographicCenter)):this.cartographicCenter=new de(0,0,-Cr.WGS84.radii[0]),this.cartesianCenter=i,this.zoom=F_t(t.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(P_),this.stats.get(uC),this.stats.get(cC),this.stats.get(m8),this.stats.get(y8),this.stats.get(_8),this.stats.get(v8),this.stats.get(b8),this.stats.get(x8),this.stats.get(hC,"memory"),this.stats.get(w8)}_initializeTileHeaders(t,i){var n;const r=new aC(this,t.root,i);if(i&&(i.children.push(r),r.depth=i.depth+1),this.type===Ws.TILES3D){const s=[];for(s.push(r);s.length>0;){const o=s.pop();this.stats.get(P_).incrementCount();const l=o.header.children||[];for(const h of l){const A=new aC(this,h,o);if((n=A.contentUrl)!=null&&n.includes("?session=")){const v=new URL(A.contentUrl).searchParams.get("session");v&&(this._queryParams.session=v)}o.children.push(A),A.depth=o.depth+1,s.push(A)}}}return r}_initializeTraverser(){let t;switch(this.type){case Ws.TILES3D:t=evt;break;case Ws.I3S:t=rvt;break;default:t=M_}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let i;try{this._onStartTileLoading(),i=await t.loadContent()}catch(n){this._onTileLoadError(t,n instanceof Error?n:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(t,i)}}_onTileLoadError(t,i){this.stats.get(b8).incrementCount();const n=i.message||i.toString(),r=t.url;console.error(`A 3D tile failed to load: ${t.url} ${n}`),this.options.onTileError(t,n,r)}_onTileLoad(t,i){var n,r;if(i){if(this.type===Ws.I3S){const s=((r=(n=this.tileset)==null?void 0:n.nodePagesTile)==null?void 0:r.nodesInNodePages)||0;this.stats.get(P_).reset(),this.stats.get(P_).addCount(s)}t&&t.content&&M_t(t,t.content),this.updateContentTypes(t),this._addTileToCache(t),this.options.onTileLoad(t)}}updateContentTypes(t){var i;if(this.type===Ws.I3S)switch(t.header.isDracoGeometry&&(this.contentFormats.draco=!0),t.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Ws.TILES3D){const{extensionsRemoved:n=[]}=((i=t.content)==null?void 0:i.gltf)||{};n.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),n.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),n.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(uC).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(uC).decrementCount()}_addTileToCache(t){this._cache.add(this,t,i=>i._updateCacheStats(t))}_updateCacheStats(t){this.stats.get(_8).incrementCount(),this.stats.get(cC).incrementCount(),this.gpuMemoryUsageInBytes+=t.gpuMemoryUsageInBytes||0,this.stats.get(hC).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.gpuMemoryUsageInBytes||0,this.stats.get(cC).decrementCount(),this.stats.get(v8).incrementCount(),this.stats.get(hC).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const i=t.pop();for(const n of i.children)t.push(n);this._destroyTile(i)}this.root=null}_destroySubtree(t){const i=t,n=[];for(n.push(i);n.length>0;){t=n.pop();for(const r of t.children)n.push(r);t!==i&&this._destroyTile(t)}i.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeTiles3DTileset(t){if(t.queryString){const i=new URLSearchParams(t.queryString),n=Object.fromEntries(i.entries());this._queryParams={...this._queryParams,...n}}if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed||[],this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const C8="4.3.1",$g={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GLTF:"glTF"};function E8(e,t,i){yr(e instanceof ArrayBuffer);const n=new TextDecoder("utf8"),r=new Uint8Array(e,t,i);return n.decode(r)}function avt(e,t=0){const i=new DataView(e);return`${String.fromCharCode(i.getUint8(t+0))}${String.fromCharCode(i.getUint8(t+1))}${String.fromCharCode(i.getUint8(t+2))}${String.fromCharCode(i.getUint8(t+3))}`}const lvt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},_o={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Vn={...lvt,..._o},fC={[_o.DOUBLE]:Float64Array,[_o.FLOAT]:Float32Array,[_o.UNSIGNED_SHORT]:Uint16Array,[_o.UNSIGNED_INT]:Uint32Array,[_o.UNSIGNED_BYTE]:Uint8Array,[_o.BYTE]:Int8Array,[_o.SHORT]:Int16Array,[_o.INT]:Int32Array},cvt={DOUBLE:_o.DOUBLE,FLOAT:_o.FLOAT,UNSIGNED_SHORT:_o.UNSIGNED_SHORT,UNSIGNED_INT:_o.UNSIGNED_INT,UNSIGNED_BYTE:_o.UNSIGNED_BYTE,BYTE:_o.BYTE,SHORT:_o.SHORT,INT:_o.INT},dC="Failed to convert GL type";class xc{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const i in fC)if(fC[i]===t)return i;throw new Error(dC)}static fromName(t){const i=cvt[t];if(!i)throw new Error(dC);return i}static getArrayType(t){switch(t){case _o.UNSIGNED_SHORT_5_6_5:case _o.UNSIGNED_SHORT_4_4_4_4:case _o.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const i=fC[t];if(!i)throw new Error(dC);return i}}static getByteSize(t){return xc.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return!!xc.getArrayType(t)}static createTypedArray(t,i,n=0,r){r===void 0&&(r=(i.byteLength-n)/xc.getByteSize(t));const s=xc.getArrayType(t);return new s(i,n,r)}}function uvt(e,t){if(!e)throw new Error(`math.gl assertion failed. ${t}`)}function hvt(e,t=[0,0,0]){const i=e>>11&31,n=e>>5&63,r=e&31;return t[0]=i<<3,t[1]=n<<2,t[2]=r<<3,t}new $1,new de,new $1,new $1;function B8(e,t=255){return Qc(e,0,t)/t*2-1}function T8(e){return e<0?-1:1}function fvt(e,t,i,n){if(uvt(n),e<0||e>i||t<0||t>i)throw new Error(`x and y must be unsigned normalized integers between 0 and ${i}`);if(n.x=B8(e,i),n.y=B8(t,i),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const r=n.x;n.x=(1-Math.abs(n.y))*T8(r),n.y=(1-Math.abs(r))*T8(n.y)}return n.normalize()}function dvt(e,t,i){return fvt(e,t,255,i)}class pC{constructor(t,i){z(this,"json"),z(this,"buffer"),z(this,"featuresLength",0),z(this,"_cachedTypedArrays",{}),this.json=t,this.buffer=i}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return!!this.json[t]}getGlobalProperty(t,i=Vn.UNSIGNED_INT,n=1){const r=this.json[t];return r&&Number.isFinite(r.byteOffset)?this._getTypedArrayFromBinary(t,i,n,1,r.byteOffset):r}getPropertyArray(t,i,n){const r=this.json[t];return r&&Number.isFinite(r.byteOffset)?("componentType"in r&&(i=xc.fromName(r.componentType)),this._getTypedArrayFromBinary(t,i,n,this.featuresLength,r.byteOffset)):this._getTypedArrayFromArray(t,i,r)}getProperty(t,i,n,r,s){const o=this.json[t];if(!o)return o;const l=this.getPropertyArray(t,i,n);if(n===1)return l[r];for(let h=0;h<n;++h)s[h]=l[n*r+h];return s}_getTypedArrayFromBinary(t,i,n,r,s){const o=this._cachedTypedArrays;let l=o[t];return l||(l=xc.createTypedArray(i,this.buffer.buffer,this.buffer.byteOffset+s,r*n),o[t]=l),l}_getTypedArrayFromArray(t,i,n){const r=this._cachedTypedArrays;let s=r[t];return s||(s=xc.createTypedArray(i,n),r[t]=s),s}}const pvt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Avt={SCALAR:(e,t)=>e[t],VEC2:(e,t)=>[e[2*t+0],e[2*t+1]],VEC3:(e,t)=>[e[3*t+0],e[3*t+1],e[3*t+2]],VEC4:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT2:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT3:(e,t)=>[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]],MAT4:(e,t)=>[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]},gvt={SCALAR:(e,t,i)=>{t[i]=e},VEC2:(e,t,i)=>{t[2*i+0]=e[0],t[2*i+1]=e[1]},VEC3:(e,t,i)=>{t[3*i+0]=e[0],t[3*i+1]=e[1],t[3*i+2]=e[2]},VEC4:(e,t,i)=>{t[4*i+0]=e[0],t[4*i+1]=e[1],t[4*i+2]=e[2],t[4*i+3]=e[3]},MAT2:(e,t,i)=>{t[4*i+0]=e[0],t[4*i+1]=e[1],t[4*i+2]=e[2],t[4*i+3]=e[3]},MAT3:(e,t,i)=>{t[9*i+0]=e[0],t[9*i+1]=e[1],t[9*i+2]=e[2],t[9*i+3]=e[3],t[9*i+4]=e[4],t[9*i+5]=e[5],t[9*i+6]=e[6],t[9*i+7]=e[7],t[9*i+8]=e[8],t[9*i+9]=e[9]},MAT4:(e,t,i)=>{t[16*i+0]=e[0],t[16*i+1]=e[1],t[16*i+2]=e[2],t[16*i+3]=e[3],t[16*i+4]=e[4],t[16*i+5]=e[5],t[16*i+6]=e[6],t[16*i+7]=e[7],t[16*i+8]=e[8],t[16*i+9]=e[9],t[16*i+10]=e[10],t[16*i+11]=e[11],t[16*i+12]=e[12],t[16*i+13]=e[13],t[16*i+14]=e[14],t[16*i+15]=e[15]}};function mvt(e,t,i,n){const{componentType:r}=e;yr(e.componentType);const s=typeof r=="string"?xc.fromName(r):r,o=pvt[e.type],l=Avt[e.type],h=gvt[e.type];return i+=e.byteOffset,{values:xc.createTypedArray(s,t,i,o*n),type:s,size:o,unpacker:l,packer:h}}const yc=e=>e!==void 0;function yvt(e,t,i){if(!t)return null;let n=e.getExtension("3DTILES_batch_table_hierarchy");const r=t.HIERARCHY;return r&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=r,n=r),n?_vt(n,i):null}function _vt(e,t){let i,n,r;const s=e.instancesLength,o=e.classes;let l=e.classIds,h=e.parentCounts,A=e.parentIds,v=s;yc(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,r=getBinaryAccessor(l),l=r.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,s));let C;if(yc(h))for(yc(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,r=getBinaryAccessor(h),h=r.createArrayBufferView(t.buffer,t.byteOffset+h.byteOffset,s)),C=new Uint16Array(s),v=0,i=0;i<s;++i)C[i]=v,v+=h[i];yc(A)&&yc(A.byteOffset)&&(A.componentType=defaultValue(A.componentType,GL.UNSIGNED_SHORT),A.type=AttributeType.SCALAR,r=getBinaryAccessor(A),A=r.createArrayBufferView(t.buffer,t.byteOffset+A.byteOffset,v));const S=o.length;for(i=0;i<S;++i){const W=o[i].length,j=o[i].instances,q=getBinaryProperties(W,j,t);o[i].instances=combine(q,j)}const L=new Array(S).fill(0),N=new Uint16Array(s);for(i=0;i<s;++i)n=l[i],N[i]=L[n],++L[n];const G={classes:o,classIds:l,classIndexes:N,parentCounts:h,parentIndexes:C,parentIds:A};return xvt(G),G}function tm(e,t,i){if(!e)return;const n=e.parentCounts;return e.parentIds?i(e,t):n>0?vvt(e,t,i):bvt(e,t,i)}function vvt(e,t,i){const n=e.classIds,r=e.parentCounts,s=e.parentIds,o=e.parentIndexes,l=n.length,h=scratchVisited;h.length=Math.max(h.length,l);const A=++marker,v=scratchStack;for(v.length=0,v.push(t);v.length>0;){if(t=v.pop(),h[t]===A)continue;h[t]=A;const C=i(e,t);if(yc(C))return C;const S=r[t],L=o[t];for(let N=0;N<S;++N){const G=s[L+N];G!==t&&v.push(G)}}return null}function bvt(e,t,i){let n=!0;for(;n;){const r=i(e,t);if(yc(r))return r;const s=e.parentIds[t];n=s!==t,t=s}throw new Error("traverseHierarchySingleParent")}function xvt(e){const t=e.classIds.length;for(let i=0;i<t;++i)S8(e,i,stack)}function S8(e,t,i){const n=e.parentCounts,r=e.parentIds,s=e.parentIndexes,o=e.classIds.length;if(!yc(r))return;assert(t<o,`Parent index ${t} exceeds the total number of instances: ${o}`),assert(i.indexOf(t)===-1,"Circular dependency detected in the batch table hierarchy."),i.push(t);const l=yc(n)?n[t]:1,h=yc(n)?s[t]:t;for(let A=0;A<l;++A){const v=r[h+A];v!==t&&S8(e,v,i)}i.pop(t)}function Js(e){return e!=null}const R_=(e,t)=>e,wvt={HIERARCHY:!0,extensions:!0,extras:!0};class I8{constructor(t,i,n,r={}){z(this,"json"),z(this,"binary"),z(this,"featureCount"),z(this,"_extensions"),z(this,"_properties"),z(this,"_binaryProperties"),z(this,"_hierarchy");var s;yr(n>=0),this.json=t||{},this.binary=i,this.featureCount=n,this._extensions=((s=this.json)==null?void 0:s.extensions)||{},this._properties={};for(const o in this.json)wvt[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),r["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=yvt(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,i){if(this._checkBatchId(t),yr(typeof i=="string",i),this._hierarchy){const n=tm(this._hierarchy,t,(r,s)=>{const o=r.classIds[s];return r.classes[o].name===i});return Js(n)}return!1}isExactClass(t,i){return yr(typeof i=="string",i),this.getExactClassName(t)===i}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const i=this._hierarchy.classIds[t];return this._hierarchy.classes[i].name}}hasProperty(t,i){return this._checkBatchId(t),yr(typeof i=="string",i),Js(this._properties[i])||this._hasPropertyInHierarchy(t,i)}getPropertyNames(t,i){this._checkBatchId(t),i=Js(i)?i:[],i.length=0;const n=Object.keys(this._properties);return i.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(t,i),i}getProperty(t,i){if(this._checkBatchId(t),yr(typeof i=="string",i),this._binaryProperties){const r=this._binaryProperties[i];if(Js(r))return this._getBinaryProperty(r,t)}const n=this._properties[i];if(Js(n))return R_(n[t]);if(this._hierarchy){const r=this._getHierarchyProperty(t,i);if(Js(r))return r}}setProperty(t,i,n){const r=this.featureCount;if(this._checkBatchId(t),yr(typeof i=="string",i),this._binaryProperties){const o=this._binaryProperties[i];if(o){this._setBinaryProperty(o,t,n);return}}if(this._hierarchy&&this._setHierarchyProperty(this,t,i,n))return;let s=this._properties[i];Js(s)||(this._properties[i]=new Array(r),s=this._properties[i]),s[t]=R_(n)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,i){return t.unpack(t.typedArray,i)}_setBinaryProperty(t,i,n){t.pack(n,t.typedArray,i)}_initializeBinaryProperties(){let t=null;for(const i in this._properties){const n=this._properties[i],r=this._initializeBinaryProperty(i,n);r&&(t=t||{},t[i]=r)}return t}_initializeBinaryProperty(t,i){if("byteOffset"in i){const n=i;yr(this.binary,`Property ${t} requires a batch table binary.`),yr(n.type,`Property ${t} requires a type.`);const r=mvt(n,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:r.values,componentCount:r.size,unpack:r.unpacker,pack:r.packer}}return null}_hasPropertyInHierarchy(t,i){if(!this._hierarchy)return!1;const n=tm(this._hierarchy,t,(r,s)=>{const o=r.classIds[s],l=r.classes[o].instances;return Js(l[i])});return Js(n)}_getPropertyNamesInHierarchy(t,i){tm(this._hierarchy,t,(n,r)=>{const s=n.classIds[r],o=n.classes[s].instances;for(const l in o)o.hasOwnProperty(l)&&i.indexOf(l)===-1&&i.push(l)})}_getHierarchyProperty(t,i){return tm(this._hierarchy,t,(n,r)=>{const s=n.classIds[r],o=n.classes[s],l=n.classIndexes[r],h=o.instances[i];return Js(h)?Js(h.typedArray)?this._getBinaryProperty(h,l):R_(h[l]):null})}_setHierarchyProperty(t,i,n,r){const s=tm(this._hierarchy,i,(o,l)=>{const h=o.classIds[l],A=o.classes[h],v=o.classIndexes[l],C=A.instances[n];return Js(C)?(yr(l===i,`Inherited property "${n}" is read-only.`),Js(C.typedArray)?this._setBinaryProperty(C,v,r):C[v]=R_(r),!0):!1});return Js(s)}}const AC=4;function D_(e,t,i=0){const n=new DataView(t);if(e.magic=n.getUint32(i,!0),i+=AC,e.version=n.getUint32(i,!0),i+=AC,e.byteLength=n.getUint32(i,!0),i+=AC,e.version!==1)throw new Error(`3D Tile Version ${e.version} not supported`);return i}const Op=4,M8="b3dm tile in legacy format.";function gC(e,t,i){const n=new DataView(t);let r;e.header=e.header||{};let s=n.getUint32(i,!0);i+=Op;let o=n.getUint32(i,!0);i+=Op;let l=n.getUint32(i,!0);i+=Op;let h=n.getUint32(i,!0);return i+=Op,l>=570425344?(i-=Op*2,r=s,l=o,h=0,s=0,o=0,console.warn(M8)):h>=570425344&&(i-=Op,r=l,l=s,h=o,s=0,o=0,console.warn(M8)),e.header.featureTableJsonByteLength=s,e.header.featureTableBinaryByteLength=o,e.header.batchTableJsonByteLength=l,e.header.batchTableBinaryByteLength=h,e.header.batchLength=r,i}function mC(e,t,i,n){return i=Cvt(e,t,i),i=Evt(e,t,i),i}function Cvt(e,t,i,n){const{featureTableJsonByteLength:r,featureTableBinaryByteLength:s,batchLength:o}=e.header||{};if(e.featureTableJson={BATCH_LENGTH:o||0},r&&r>0){const l=E8(t,i,r);e.featureTableJson=JSON.parse(l)}return i+=r||0,e.featureTableBinary=new Uint8Array(t,i,s),i+=s||0,i}function Evt(e,t,i,n){const{batchTableJsonByteLength:r,batchTableBinaryByteLength:s}=e.header||{};if(r&&r>0){const o=E8(t,i,r);e.batchTableJson=JSON.parse(o),i+=r,s&&s>0&&(e.batchTableBinary=new Uint8Array(t,i,s),e.batchTableBinary=new Uint8Array(e.batchTableBinary),i+=s)}return i}function P8(e,t,i){if(!t&&(!e||!e.batchIds||!i))return null;const{batchIds:n,isRGB565:r,pointCount:s=0}=e;if(n&&i){const o=new Uint8ClampedArray(s*3);for(let l=0;l<s;l++){const h=n[l],A=i.getProperty(h,"dimensions").map(v=>v*255);o[l*3]=A[0],o[l*3+1]=A[1],o[l*3+2]=A[2]}return{type:Vn.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(t&&r){const o=new Uint8ClampedArray(s*3);for(let l=0;l<s;l++){const h=hvt(t[l]);o[l*3]=h[0],o[l*3+1]=h[1],o[l*3+2]=h[2]}return{type:Vn.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}return t&&t.length===s*3?{type:Vn.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:Vn.UNSIGNED_BYTE,value:t||new Uint8ClampedArray,size:4,normalized:!0}}const R8=new de;function Bvt(e,t){if(!t)return null;if(e.isOctEncoded16P){const i=new Float32Array((e.pointsLength||0)*3);for(let n=0;n<(e.pointsLength||0);n++)dvt(t[n*2],t[n*2+1],R8),R8.toArray(i,n*3);return{type:Vn.FLOAT,size:2,value:i}}return{type:Vn.FLOAT,size:2,value:t}}function Tvt(e,t,i){return e.isQuantized?i["3d-tiles"]&&i["3d-tiles"].decodeQuantizedPositions?(e.isQuantized=!1,Svt(e,t)):{type:Vn.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function Svt(e,t){const i=new de,n=new Float32Array(e.pointCount*3);for(let r=0;r<e.pointCount;r++)i.set(t[r*3],t[r*3+1],t[r*3+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(n,r*3);return n}async function Ivt(e,t,i,n,r){i=D_(e,t,i),i=gC(e,t,i),i=mC(e,t,i),Mvt(e);const{featureTable:s,batchTable:o}=Pvt(e);return await Fvt(e,s,o,n,r),Rvt(e,s,n),Dvt(e,s,o),Ovt(e,s),i}function Mvt(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}function Pvt(e){const t=new pC(e.featureTableJson,e.featureTableBinary),i=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(i))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=i,e.featuresLength=i,e.pointsLength=i,e.pointCount=i,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",Vn.FLOAT,3);const n=Lvt(e,t);return{featureTable:t,batchTable:n}}function Rvt(e,t,i){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.positions){if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",Vn.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const n=t.getPropertyArray("POSITION_QUANTIZED",Vn.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Vn.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Vn.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=Tvt(e,n,i)}}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function Dvt(e,t,i){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.colors){let n=null;t.hasProperty("RGBA")?(n=t.getPropertyArray("RGBA",Vn.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?n=t.getPropertyArray("RGB",Vn.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(n=t.getPropertyArray("RGB565",Vn.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=P8(e,n,i)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",Vn.UNSIGNED_BYTE,4))}function Ovt(e,t){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.normals){let i=null;t.hasProperty("NORMAL")?i=t.getPropertyArray("NORMAL",Vn.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(i=t.getPropertyArray("NORMAL_OCT16P",Vn.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=Bvt(e,i)}}function Lvt(e,t){let i=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",Vn.UNSIGNED_SHORT,1),e.batchIds)){const n=t.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:r,batchTableBinary:s}=e;i=new I8(r,s,n)}return i}async function Fvt(e,t,i,n,r){let s,o,l;const h=e.batchTableJson&&e.batchTableJson.extensions&&e.batchTableJson.extensions["3DTILES_draco_point_compression"];h&&(l=h.properties);const A=t.getExtension("3DTILES_draco_point_compression");if(A){o=A.properties;const C=A.byteOffset,S=A.byteLength;if(!o||!Number.isFinite(C)||!S)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=(e.featureTableBinary||[]).slice(C,C+S),e.hasPositions=Number.isFinite(o.POSITION),e.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),e.hasNormals=Number.isFinite(o.NORMAL),e.hasBatchIds=Number.isFinite(o.BATCH_ID),e.isTranslucent=Number.isFinite(o.RGBA)}if(!s)return!0;const v={buffer:s,properties:{...o,...l},batchTableProperties:l};return await kvt(e,v,n,r)}async function kvt(e,t,i,n){if(!n)return;const r={...i,draco:{...i==null?void 0:i.draco,extraAttributes:t.batchTableProperties||{}}};delete r["3d-tiles"];const s=await yf(t.buffer,Zw,r,n),o=s.attributes.POSITION&&s.attributes.POSITION.value,l=s.attributes.COLOR_0&&s.attributes.COLOR_0.value,h=s.attributes.NORMAL&&s.attributes.NORMAL.value,A=s.attributes.BATCH_ID&&s.attributes.BATCH_ID.value,v=o&&s.attributes.POSITION.value.quantization,C=h&&s.attributes.NORMAL.value.quantization;if(v){const L=s.POSITION.data.quantization,N=L.range;e.quantizedVolumeScale=new de(N,N,N),e.quantizedVolumeOffset=new de(L.minValues),e.quantizedRange=(1<<L.quantizationBits)-1,e.isQuantizedDraco=!0}C&&(e.octEncodedRange=(1<<s.NORMAL.data.quantization.quantizationBits)-1,e.isOctEncodedDraco=!0);const S={};if(t.batchTableProperties)for(const L of Object.keys(t.batchTableProperties))s.attributes[L]&&s.attributes[L].value&&(S[L.toLowerCase()]=s.attributes[L].value);e.attributes={positions:o,colors:P8(e,l,void 0),normals:h,batchIds:A,...S}}function va(e,t){if(!e)throw new Error(t||"assert failed: gltf")}const D8={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},O8={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Nvt=1.33,L8=["SCALAR","VEC2","VEC3","VEC4"],Uvt=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Gvt=new Map(Uvt),zvt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Vvt={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},jvt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function F8(e){return L8[e-1]||L8[0]}function O_(e){const t=Gvt.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function yC(e,t){const i=jvt[e.componentType],n=zvt[e.type],r=Vvt[e.componentType],s=e.count*n,o=e.count*n*r;va(o>=0&&o<=t.byteLength);const l=O8[e.componentType],h=D8[e.type];return{ArrayType:i,length:s,byteLength:o,componentByteSize:l,numberOfComponentsInElement:h}}function k8(e){let{images:t,bufferViews:i}=e;t=t||[],i=i||[];const n=t.map(o=>o.bufferView);i=i.filter(o=>!n.includes(o));const r=i.reduce((o,l)=>o+l.byteLength,0),s=t.reduce((o,l)=>{const{width:h,height:A}=l.image;return o+h*A},0);return r+Math.ceil(4*s*Nvt)}function Hvt(e,t,i){const n=e.bufferViews[i];va(n);const r=n.buffer,s=t[r];va(s);const o=(n.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,o,n.byteLength)}function Wvt(e,t,i){var n,r;const s=typeof i=="number"?(n=e.accessors)==null?void 0:n[i]:i;if(!s)throw new Error(`No gltf accessor ${JSON.stringify(i)}`);const o=(r=e.bufferViews)==null?void 0:r[s.bufferView||0];if(!o)throw new Error(`No gltf buffer view for accessor ${o}`);const{arrayBuffer:l,byteOffset:h}=t[o.buffer],A=(h||0)+(s.byteOffset||0)+(o.byteOffset||0),{ArrayType:v,length:C,componentByteSize:S,numberOfComponentsInElement:L}=yC(s,o),N=S*L,G=o.byteStride||N;if(typeof o.byteStride>"u"||o.byteStride===N)return new v(l,A,C);const W=new v(C);for(let j=0;j<s.count;j++){const q=new v(l,A+j*G,L);W.set(q,j*L)}return W}function Jvt(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class jo{constructor(t){z(this,"gltf"),z(this,"sourceBuffers"),z(this,"byteLength"),this.gltf={json:(t==null?void 0:t.json)||Jvt(),buffers:(t==null?void 0:t.buffers)||[],images:(t==null?void 0:t.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}hasExtension(t){const i=this.getUsedExtensions().find(r=>r===t),n=this.getRequiredExtensions().find(r=>r===t);return typeof i=="string"||typeof n=="string"}getExtension(t){const i=this.getUsedExtensions().find(r=>r===t),n=this.json.extensions||{};return i?n[t]:null}getRequiredExtension(t){return this.getRequiredExtensions().find(i=>i===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,i){return(t.extensions||{})[i]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,i){if(typeof i=="object")return i;const n=this.json[t]&&this.json[t][i];if(!n)throw new Error(`glTF file error: Could not find ${t}[${i}]`);return n}getTypedArrayForBufferView(t){t=this.getBufferView(t);const i=t.buffer,n=this.gltf.buffers[i];va(n);const r=(t.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,r,t.byteLength)}getTypedArrayForAccessor(t){const i=this.getAccessor(t);return Wvt(this.gltf.json,this.gltf.buffers,i)}getTypedArrayForImageData(t){t=this.getAccessor(t);const i=this.getBufferView(t.bufferView),n=this.getBuffer(i.buffer).data,r=i.byteOffset||0;return new Uint8Array(n,r,i.byteLength)}addApplicationData(t,i){return this.json[t]=i,this}addExtraData(t,i){return this.json.extras=this.json.extras||{},this.json.extras[t]=i,this}addObjectExtension(t,i,n){return t.extensions=t.extensions||{},t.extensions[i]=n,this.registerUsedExtension(i),this}setObjectExtension(t,i,n){const r=t.extensions||{};r[i]=n}removeObjectExtension(t,i){const n=(t==null?void 0:t.extensions)||{};if(n[i]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const r=this.json.extensionsRemoved;r.includes(i)||r.push(i)}delete n[i]}addExtension(t,i={}){return va(i),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=i,this.registerUsedExtension(t),i}addRequiredExtension(t,i={}){return va(i),this.addExtension(t,i),this.registerRequiredExtension(t),i}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(i=>i===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(i=>i===t)||this.json.extensionsRequired.push(t)}removeExtension(t){var i;if((i=this.json.extensions)!=null&&i[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(t)||n.push(t)}this.json.extensions&&delete this.json.extensions[t],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:i}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:i}),this.json.scenes.length-1}addNode(t){const{meshIndex:i,matrix:n}=t;this.json.nodes=this.json.nodes||[];const r={mesh:i};return n&&(r.matrix=n),this.json.nodes.push(r),this.json.nodes.length-1}addMesh(t){const{attributes:i,indices:n,material:r,mode:s=4}=t,o={primitives:[{attributes:this._addAttributes(i),mode:s}]};if(n){const l=this._addIndices(n);o.primitives[0].indices=l}return Number.isFinite(r)&&(o.primitives[0].material=r),this.json.meshes=this.json.meshes||[],this.json.meshes.push(o),this.json.meshes.length-1}addPointCloud(t){const i={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}addImage(t,i){const n=Yy(t),r=i||(n==null?void 0:n.mimeType),s={bufferView:this.addBufferView(t),mimeType:r};return this.json.images=this.json.images||[],this.json.images.push(s),this.json.images.length-1}addBufferView(t,i=0,n=this.byteLength){const r=t.byteLength;va(Number.isFinite(r)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const s={buffer:i,byteOffset:n,byteLength:r};return this.byteLength+=ru(r,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(s),this.json.bufferViews.length-1}addAccessor(t,i){const n={bufferView:t,type:F8(i.size),componentType:i.componentType,count:i.count,max:i.max,min:i.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(t,i={size:3}){const n=this.addBufferView(t);let r={min:i.min,max:i.max};(!r.min||!r.max)&&(r=this._getAccessorMinMax(t,i.size));const s={size:i.size,componentType:O_(t),count:Math.round(t.length/i.size),min:r.min,max:r.max};return this.addAccessor(n,Object.assign(s,i))}addTexture(t){const{imageIndex:i}=t,n={source:i};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){var t,i;const n=this.byteLength,r=new ArrayBuffer(n),s=new Uint8Array(r);let o=0;for(const l of this.sourceBuffers||[])o=hL(l,s,o);(i=(t=this.json)==null?void 0:t.buffers)!=null&&i[0]?this.json.buffers[0].byteLength=n:this.json.buffers=[{byteLength:n}],this.gltf.binary=r,this.sourceBuffers=[r],this.gltf.buffers=[{arrayBuffer:r,byteOffset:0,byteLength:r.byteLength}]}_removeStringFromArray(t,i){let n=!0;for(;n;){const r=t.indexOf(i);r>-1?t.splice(r,1):n=!1}}_addAttributes(t={}){const i={};for(const n in t){const r=t[n],s=this._getGltfAttributeName(n),o=this.addBinaryBuffer(r.value,r);i[s]=o}return i}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,i){const n={min:null,max:null};if(t.length<i)return n;n.min=[],n.max=[];const r=t.subarray(0,i);for(const s of r)n.min.push(s),n.max.push(s);for(let s=i;s<t.length;s+=i)for(let o=0;o<i;o++)n.min[0+o]=Math.min(n.min[0+o],t[s+o]),n.max[0+o]=Math.max(n.max[0+o],t[s+o]);return n}}function N8(e){return(e%1+1)%1}const U8={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},Xvt={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},G8={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function _C(e,t){return G8[t]*U8[e]}function L_(e,t,i,n){if(i!=="UINT8"&&i!=="UINT16"&&i!=="UINT32"&&i!=="UINT64")return null;const r=e.getTypedArrayForBufferView(t),s=F_(r,"SCALAR",i,n+1);return s instanceof BigInt64Array||s instanceof BigUint64Array?null:s}function F_(e,t,i,n=1){const r=U8[t],s=Xvt[i],o=G8[i],l=n*r,h=l*o;let A=e.buffer,v=e.byteOffset;return v%o!==0&&(A=new Uint8Array(A).slice(v,v+h).buffer,v=0),new s(A,v,l)}function vC(e,t,i){var n,r,s,o,l;const h=`TEXCOORD_${t.texCoord||0}`,A=i.attributes[h],v=e.getTypedArrayForAccessor(A),C=e.gltf.json,S=t.index,L=(r=(n=C.textures)==null?void 0:n[S])==null?void 0:r.source;if(typeof L<"u"){const N=(o=(s=C.images)==null?void 0:s[L])==null?void 0:o.mimeType,G=(l=e.gltf.images)==null?void 0:l[L];if(G&&typeof G.width<"u"){const W=[];for(let j=0;j<v.length;j+=2){const q=Kvt(G,N,v,j,t.channels);W.push(q)}return W}}return[]}function z8(e,t,i,n,r){if(!(i!=null&&i.length))return;const s=[];for(const v of i){let C=n.findIndex(S=>S===v);C===-1&&(C=n.push(v)-1),s.push(C)}const o=new Uint32Array(s),l=e.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,h=e.addBufferView(o,l,0),A=e.addAccessor(h,{size:1,componentType:O_(o),count:o.length});r.attributes[t]=A}function Kvt(e,t,i,n,r=[0]){const s={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=i[n],l=i[n+1];let h=1;t&&(t.indexOf("image/jpeg")!==-1||t.indexOf("image/png")!==-1)&&(h=4);const A=Qvt(o,l,e,h);let v=0;for(const C of r){const S=typeof C=="number"?Object.values(s)[C]:s[C],L=A+S.offset,N=aw(e);if(N.data.length<=L)throw new Error(`${N.data.length} <= ${L}`);const G=N.data[L];v|=G<<S.shift}return v}function Qvt(e,t,i,n=1){const r=i.width,s=N8(e)*(r-1),o=Math.round(s),l=i.height,h=N8(t)*(l-1),A=Math.round(h),v=i.components?i.components:n;return(A*r+o)*v}function V8(e,t,i,n,r){const s=[];for(let o=0;o<t;o++){const l=i[o],h=i[o+1]-i[o];if(h+l>n)break;const A=l/r,v=h/r;s.push(e.slice(A,A+v))}return s}function j8(e,t,i){const n=[];for(let r=0;r<t;r++){const s=r*i;n.push(e.slice(s,s+i))}return n}function H8(e,t,i,n){if(i)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const r=[],s=new TextDecoder("utf8");let o=0;for(let l=0;l<e;l++){const h=n[l+1]-n[l];if(h+o<=t.length){const A=t.subarray(o,h+o),v=s.decode(A);r.push(v),o+=h}}return r}return[]}const Lp="EXT_mesh_features",Zvt=Lp;async function Yvt(e,t){const i=new jo(e);$vt(i,t)}function qvt(e,t){const i=new jo(e);return e1t(i),i.createBinaryChunk(),i.gltf}function $vt(e,t){const i=e.gltf.json;if(i.meshes)for(const n of i.meshes)for(const r of n.primitives)t1t(e,r,t)}function t1t(e,t,i){var n,r,s;if(!((n=i==null?void 0:i.gltf)!=null&&n.loadBuffers))return;const o=(r=t.extensions)==null?void 0:r[Lp],l=o==null?void 0:o.featureIds;if(l)for(const h of l){let A;if(typeof h.attribute<"u"){const v=`_FEATURE_ID_${h.attribute}`,C=t.attributes[v];A=e.getTypedArrayForAccessor(C)}else typeof h.texture<"u"&&(s=i==null?void 0:i.gltf)!=null&&s.loadImages?A=vC(e,h.texture,t):A=[];h.data=A}}function e1t(e,t){const i=e.gltf.json.meshes;if(i)for(const n of i)for(const r of n.primitives)n1t(e,r)}function i1t(e,t,i,n){t.extensions||(t.extensions={});let r=t.extensions[Lp];r||(r={featureIds:[]},t.extensions[Lp]=r);const{featureIds:s}=r,o={featureCount:i.length,propertyTable:n,data:i};s.push(o),e.addObjectExtension(t,Lp,r)}function n1t(e,t){var i;const n=(i=t.extensions)==null?void 0:i[Lp];if(!n)return;const r=n.featureIds;r.forEach((s,o)=>{if(s.data){const{accessorKey:l,index:h}=r1t(t.attributes),A=new Uint32Array(s.data);r[o]={featureCount:A.length,propertyTable:s.propertyTable,attribute:h},e.gltf.buffers.push({arrayBuffer:A.buffer,byteOffset:A.byteOffset,byteLength:A.byteLength});const v=e.addBufferView(A),C=e.addAccessor(v,{size:1,componentType:O_(A),count:A.length});t.attributes[l]=C}})}function r1t(e){const t="_FEATURE_ID_",i=Object.keys(e).filter(r=>r.indexOf(t)===0);let n=-1;for(const r of i){const s=Number(r.substring(t.length));s>n&&(n=s)}return n++,{accessorKey:`${t}${n}`,index:n}}const o1t=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:i1t,decode:Yvt,encode:qvt,name:Zvt},Symbol.toStringTag,{value:"Module"})),Fp="EXT_structural_metadata",s1t=Fp;async function a1t(e,t){const i=new jo(e);c1t(i,t)}function l1t(e,t){const i=new jo(e);return E1t(i),i.createBinaryChunk(),i.gltf}function c1t(e,t){var i,n;if(!((i=t.gltf)!=null&&i.loadBuffers))return;const r=e.getExtension(Fp);r&&((n=t.gltf)!=null&&n.loadImages&&u1t(e,r),h1t(e,r))}function u1t(e,t){const i=t.propertyTextures,n=e.gltf.json;if(i&&n.meshes)for(const r of n.meshes)for(const s of r.primitives)d1t(e,i,s,t)}function h1t(e,t){const i=t.schema;if(!i)return;const n=i.classes,r=t.propertyTables;if(n&&r)for(const s in n){const o=f1t(r,s);o&&A1t(e,i,o)}}function f1t(e,t){for(const i of e)if(i.class===t)return i;return null}function d1t(e,t,i,n){var r;if(!t)return;const s=(r=i.extensions)==null?void 0:r[Fp],o=s==null?void 0:s.propertyTextures;if(o)for(const l of o){const h=t[l];p1t(e,h,i,n)}}function p1t(e,t,i,n){var r;if(!t.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const s=t.class;for(const o in t.properties){const l=`${s}_${o}`,h=(r=t.properties)==null?void 0:r[o];if(!h)continue;h.data||(h.data=[]);const A=h.data,v=vC(e,h,i);v!==null&&(z8(e,l,v,A,i),h.data=A,n.dataAttributeNames.push(l))}}function A1t(e,t,i){var n,r;const s=(n=t.classes)==null?void 0:n[i.class];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);const o=i.count;for(const l in s.properties){const h=s.properties[l],A=(r=i.properties)==null?void 0:r[l];if(A){const v=g1t(e,t,h,o,A);A.data=v}}}function g1t(e,t,i,n,r){let s=[];const o=r.values,l=e.getTypedArrayForBufferView(o),h=m1t(e,i,r,n),A=y1t(e,r,n);switch(i.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{s=_1t(i,n,l,h);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${i.type}`);case"STRING":{s=H8(n,l,h,A);break}case"ENUM":{s=v1t(t,i,n,l,h);break}default:throw new Error(`Unknown classProperty type ${i.type}`)}return s}function m1t(e,t,i,n){return t.array&&typeof t.count>"u"&&typeof i.arrayOffsets<"u"?L_(e,i.arrayOffsets,i.arrayOffsetType||"UINT32",n):null}function y1t(e,t,i){return typeof t.stringOffsets<"u"?L_(e,t.stringOffsets,t.stringOffsetType||"UINT32",i):null}function _1t(e,t,i,n){const r=e.array,s=e.count,o=_C(e.type,e.componentType),l=i.byteLength/o;let h;return e.componentType?h=F_(i,e.type,e.componentType,l):h=i,r?n?V8(h,t,n,i.length,o):s?j8(h,t,s):[]:h}function v1t(e,t,i,n,r){var s;const o=t.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const l=(s=e.enums)==null?void 0:s[o];if(!l)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const h=l.valueType||"UINT16",A=_C(t.type,h),v=n.byteLength/A;let C=F_(n,t.type,h,v);if(C||(C=n),t.array){if(r)return b1t({valuesData:C,numberOfElements:i,arrayOffsets:r,valuesDataBytesLength:n.length,elementSize:A,enumEntry:l});const S=t.count;return S?x1t(C,i,S,l):[]}return bC(C,0,i,l)}function b1t(e){const{valuesData:t,numberOfElements:i,arrayOffsets:n,valuesDataBytesLength:r,elementSize:s,enumEntry:o}=e,l=[];for(let h=0;h<i;h++){const A=n[h],v=n[h+1]-n[h];if(v+A>r)break;const C=A/s,S=v/s,L=bC(t,C,S,o);l.push(L)}return l}function x1t(e,t,i,n){const r=[];for(let s=0;s<t;s++){const o=i*s,l=bC(e,o,i,n);r.push(l)}return r}function bC(e,t,i,n){const r=[];for(let s=0;s<i;s++)if(e instanceof BigInt64Array||e instanceof BigUint64Array)r.push("");else{const o=e[t+s],l=w1t(n,o);l?r.push(l.name):r.push("")}return r}function w1t(e,t){for(const i of e.values)if(i.value===t)return i;return null}const C1t="schemaClassId";function E1t(e,t){var i,n;const r=e.getExtension(Fp);if(r&&r.propertyTables)for(const s of r.propertyTables){const o=s.class,l=(n=(i=r.schema)==null?void 0:i.classes)==null?void 0:n[o];s.properties&&l&&B1t(s,l,e)}}function B1t(e,t,i){for(const n in e.properties){const r=e.properties[n].data;if(r){const s=t.properties[n];if(s){const o=M1t(r,s,i);e.properties[n]=o}}}}function T1t(e,t,i=C1t){let n=e.getExtension(Fp);n||(n=e.addExtension(Fp)),n.schema=S1t(t,i,n.schema);const r=I1t(t,i,n.schema);return n.propertyTables||(n.propertyTables=[]),n.propertyTables.push(r)-1}function S1t(e,t,i){const n=i??{id:"schema_id"},r={properties:{}};for(const s of e){const o={type:s.elementType,componentType:s.componentType};r.properties[s.name]=o}return n.classes={},n.classes[t]=r,n}function I1t(e,t,i){var n;const r={class:t,count:0};let s=0;const o=(n=i.classes)==null?void 0:n[t];for(const l of e){if(s===0&&(s=l.values.length),s!==l.values.length&&l.values.length)throw new Error("Illegal values in attributes");o!=null&&o.properties[l.name]&&(r.properties||(r.properties={}),r.properties[l.name]={values:0,data:l.values})}return r.count=s,r}function M1t(e,t,i){const n={values:0};if(t.type==="STRING"){const{stringData:r,stringOffsets:s}=D1t(e);n.stringOffsets=xC(s,i),n.values=xC(r,i)}else if(t.type==="SCALAR"&&t.componentType){const r=R1t(e,t.componentType);n.values=xC(r,i)}return n}const P1t={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function R1t(e,t){const i=[];for(const r of e)i.push(Number(r));const n=P1t[t];if(!n)throw new Error("Illegal component type");return new n(i)}function D1t(e){const t=new TextEncoder,i=[];let n=0;for(const h of e){const A=t.encode(h);n+=A.length,i.push(A)}const r=new Uint8Array(n),s=[];let o=0;for(const h of i)r.set(h,o),s.push(o),o+=h.length;s.push(o);const l=new Uint32Array(s);return{stringData:r,stringOffsets:l}}function xC(e,t){return t.gltf.buffers.push({arrayBuffer:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength}),t.addBufferView(e)}const O1t=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:T1t,decode:a1t,encode:l1t,name:s1t},Symbol.toStringTag,{value:"Module"})),W8="EXT_feature_metadata",L1t=W8;async function F1t(e,t){const i=new jo(e);k1t(i,t)}function k1t(e,t){var i,n;if(!((i=t.gltf)!=null&&i.loadBuffers))return;const r=e.getExtension(W8);r&&((n=t.gltf)!=null&&n.loadImages&&N1t(e,r),U1t(e,r))}function N1t(e,t){const i=t.schema;if(!i)return;const n=i.classes,{featureTextures:r}=t;if(n&&r)for(const s in n){const o=n[s],l=z1t(r,s);l&&j1t(e,l,o)}}function U1t(e,t){const i=t.schema;if(!i)return;const n=i.classes,r=t.featureTables;if(n&&r)for(const s in n){const o=G1t(r,s);o&&V1t(e,i,o)}}function G1t(e,t){for(const i in e){const n=e[i];if(n.class===t)return n}return null}function z1t(e,t){for(const i in e){const n=e[i];if(n.class===t)return n}return null}function V1t(e,t,i){var n,r;if(!i.class)return;const s=(n=t.classes)==null?void 0:n[i.class];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);const o=i.count;for(const l in s.properties){const h=s.properties[l],A=(r=i.properties)==null?void 0:r[l];if(A){const v=H1t(e,t,h,o,A);A.data=v}}}function j1t(e,t,i){var n;const r=t.class;for(const s in i.properties){const o=(n=t==null?void 0:t.properties)==null?void 0:n[s];if(o){const l=Q1t(e,o,r);o.data=l}}}function H1t(e,t,i,n,r){let s=[];const o=r.bufferView,l=e.getTypedArrayForBufferView(o),h=W1t(e,i,r,n),A=J1t(e,i,r,n);return i.type==="STRING"||i.componentType==="STRING"?s=H8(n,l,h,A):X1t(i)&&(s=K1t(i,n,l,h)),s}function W1t(e,t,i,n){return t.type==="ARRAY"&&typeof t.componentCount>"u"&&typeof i.arrayOffsetBufferView<"u"?L_(e,i.arrayOffsetBufferView,i.offsetType||"UINT32",n):null}function J1t(e,t,i,n){return typeof i.stringOffsetBufferView<"u"?L_(e,i.stringOffsetBufferView,i.offsetType||"UINT32",n):null}function X1t(e){const t=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return t.includes(e.type)||typeof e.componentType<"u"&&t.includes(e.componentType)}function K1t(e,t,i,n){const r=e.type==="ARRAY",s=e.componentCount,o="SCALAR",l=e.componentType||e.type,h=_C(o,l),A=i.byteLength/h,v=F_(i,o,l,A);return r?n?V8(v,t,n,i.length,h):s?j8(v,t,s):[]:v}function Q1t(e,t,i){const n=e.gltf.json;if(!n.meshes)return[];const r=[];for(const s of n.meshes)for(const o of s.primitives)Z1t(e,i,t,r,o);return r}function Z1t(e,t,i,n,r){const s={channels:i.channels,...i.texture},o=vC(e,s,r);o&&z8(e,t,o,n,r)}const Y1t=Object.freeze(Object.defineProperty({__proto__:null,decode:F1t,name:L1t},Symbol.toStringTag,{value:"Module"})),q1t="4.3.1",kp=!0,J8=1735152710,wC=12,k_=8,$1t=1313821514,tbt=5130562,ebt=0,ibt=0,nbt=1;function rbt(e,t=0){return`${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}function obt(e,t=0,i={}){const n=new DataView(e),{magic:r=J8}=i,s=n.getUint32(t,!1);return s===r||s===J8}function sbt(e,t,i=0,n={}){const r=new DataView(t),s=rbt(r,i+0),o=r.getUint32(i+4,kp),l=r.getUint32(i+8,kp);switch(Object.assign(e,{header:{byteOffset:i,byteLength:l,hasBinChunk:!1},type:s,version:o,json:{},binChunks:[]}),i+=wC,e.version){case 1:return abt(e,r,i);case 2:return lbt(e,r,i,n={});default:throw new Error(`Invalid GLB version ${e.version}. Only supports version 1 and 2.`)}}function abt(e,t,i){yr(e.header.byteLength>wC+k_);const n=t.getUint32(i+0,kp),r=t.getUint32(i+4,kp);return i+=k_,yr(r===ebt),CC(e,t,i,n),i+=n,i+=EC(e,t,i,e.header.byteLength),i}function lbt(e,t,i,n){return yr(e.header.byteLength>wC+k_),cbt(e,t,i,n),i+e.header.byteLength}function cbt(e,t,i,n){for(;i+8<=e.header.byteLength;){const r=t.getUint32(i+0,kp),s=t.getUint32(i+4,kp);switch(i+=k_,s){case $1t:CC(e,t,i,r);break;case tbt:EC(e,t,i,r);break;case ibt:n.strict||CC(e,t,i,r);break;case nbt:n.strict||EC(e,t,i,r);break}i+=ru(r,4)}return i}function CC(e,t,i,n){const r=new Uint8Array(t.buffer,i,n),s=new TextDecoder("utf8").decode(r);return e.json=JSON.parse(s),ru(n,4)}function EC(e,t,i,n){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:i,byteLength:n,arrayBuffer:t.buffer}),ru(n,4)}function X8(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const i=t.baseUri||t.uri;if(!i)throw new Error(`'baseUri' must be provided to resolve relative url ${e}`);return i.substr(0,i.lastIndexOf("/")+1)+e}const ubt="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",hbt="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",fbt=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),dbt=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),pbt={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Abt={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function gbt(e,t,i,n,r,s="NONE"){const o=await mbt();vbt(o,o.exports[Abt[r]],e,t,i,n,o.exports[pbt[s||"NONE"]])}let BC;async function mbt(){return BC||(BC=ybt()),BC}async function ybt(){let e=ubt;WebAssembly.validate(fbt)&&(e=hbt,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(_bt(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function _bt(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;++n){const r=e.charCodeAt(n);t[n]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let i=0;for(let n=0;n<e.length;++n)t[i++]=t[n]<60?dbt[t[n]]:(t[n]-60)*64+t[++n];return t.buffer.slice(0,i)}function vbt(e,t,i,n,r,s,o){const l=e.exports.sbrk,h=n+3&-4,A=l(h*r),v=l(s.length),C=new Uint8Array(e.exports.memory.buffer);C.set(s,v);const S=t(A,n,r,v,s.length);if(S===0&&o&&o(A,h,r),i.set(C.subarray(A,A+n*r)),l(A-l(0)),S!==0)throw new Error(`Malformed buffer data: ${S}`)}const N_="EXT_meshopt_compression",bbt=N_;async function xbt(e,t){var i,n;const r=new jo(e);if(!((i=t==null?void 0:t.gltf)!=null&&i.decompressMeshes)||!((n=t.gltf)!=null&&n.loadBuffers))return;const s=[];for(const o of e.json.bufferViews||[])s.push(wbt(r,o));await Promise.all(s),r.removeExtension(N_)}async function wbt(e,t){const i=e.getObjectExtension(t,N_);if(i){const{byteOffset:n=0,byteLength:r=0,byteStride:s,count:o,mode:l,filter:h="NONE",buffer:A}=i,v=e.gltf.buffers[A],C=new Uint8Array(v.arrayBuffer,v.byteOffset+n,r),S=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await gbt(S,o,s,C,l,h),e.removeObjectExtension(t,N_)}}const Cbt=Object.freeze(Object.defineProperty({__proto__:null,decode:xbt,name:bbt},Symbol.toStringTag,{value:"Module"})),Np="EXT_texture_webp",Ebt=Np;function Bbt(e,t){const i=new jo(e);if(!wL("image/webp")){if(i.getRequiredExtensions().includes(Np))throw new Error(`gltf: Required extension ${Np} not supported by browser`);return}const{json:n}=i;for(const r of n.textures||[]){const s=i.getObjectExtension(r,Np);s&&(r.source=s.source),i.removeObjectExtension(r,Np)}i.removeExtension(Np)}const Tbt=Object.freeze(Object.defineProperty({__proto__:null,name:Ebt,preprocess:Bbt},Symbol.toStringTag,{value:"Module"})),U_="KHR_texture_basisu",Sbt=U_;function Ibt(e,t){const i=new jo(e),{json:n}=i;for(const r of n.textures||[]){const s=i.getObjectExtension(r,U_);s&&(r.source=s.source,i.removeObjectExtension(r,U_))}i.removeExtension(U_)}const Mbt=Object.freeze(Object.defineProperty({__proto__:null,name:Sbt,preprocess:Ibt},Symbol.toStringTag,{value:"Module"}));function Pbt(e){const t={};for(const i in e){const n=e[i];if(i!=="indices"){const r=K8(n);t[i]=r}}return t}function K8(e){const{buffer:t,size:i,count:n}=Rbt(e);return{value:t,size:i,byteOffset:0,count:n,type:F8(i),componentType:O_(t)}}function Rbt(e){let t=e,i=1,n=0;return e&&e.value&&(t=e.value,i=e.size||1),t&&(ArrayBuffer.isView(t)||(t=Dbt(t,Float32Array)),n=t.length/i),{buffer:t,size:i,count:n}}function Dbt(e,t,i=!1){return e?Array.isArray(e)?new t(e):i&&!(e instanceof t)?new t(e):e:null}const yh="KHR_draco_mesh_compression",Obt=yh;function Lbt(e,t,i){const n=new jo(e);for(const r of Q8(n))n.getObjectExtension(r,yh)}async function Fbt(e,t,i){var n;if(!((n=t==null?void 0:t.gltf)!=null&&n.decompressMeshes))return;const r=new jo(e),s=[];for(const o of Q8(r))r.getObjectExtension(o,yh)&&s.push(Nbt(r,o,t,i));await Promise.all(s),r.removeExtension(yh)}function kbt(e,t={}){const i=new jo(e);for(const n of i.json.meshes||[])Ubt(n),i.addRequiredExtension(yh)}async function Nbt(e,t,i,n){const r=e.getObjectExtension(t,yh);if(!r)return;const s=e.getTypedArrayForBufferView(r.bufferView),o=Ug(s.buffer,s.byteOffset),l={...i};delete l["3d-tiles"];const h=await yf(o,Zw,l,n),A=Pbt(h.attributes);for(const[v,C]of Object.entries(A))if(v in t.attributes){const S=t.attributes[v],L=e.getAccessor(S);L!=null&&L.min&&L!=null&&L.max&&(C.min=L.min,C.max=L.max)}t.attributes=A,h.indices&&(t.indices=K8(h.indices)),e.removeObjectExtension(t,yh),Gbt(t)}function Ubt(e,t,i=4,n,r){var s;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=n.DracoWriter.encodeSync({attributes:e}),l=(s=r==null?void 0:r.parseSync)==null?void 0:s.call(r,{attributes:e}),h=n._addFauxAttributes(l.attributes),A=n.addBufferView(o);return{primitives:[{attributes:h,mode:i,extensions:{[yh]:{bufferView:A,attributes:h}}}]}}function Gbt(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*Q8(e){for(const t of e.json.meshes||[])for(const i of t.primitives)yield i}const zbt=Object.freeze(Object.defineProperty({__proto__:null,decode:Fbt,encode:kbt,name:Obt,preprocess:Lbt},Symbol.toStringTag,{value:"Module"})),G_="KHR_texture_transform",Vbt=G_,z_=new de,jbt=new mr,Hbt=new mr;async function Wbt(e,t){var i;if(!new jo(e).hasExtension(G_)||!((i=t.gltf)!=null&&i.loadBuffers))return;const n=e.json.materials||[];for(let r=0;r<n.length;r++)Jbt(r,e)}function Jbt(e,t){var i,n,r,s;const o=(i=t.json.materials)==null?void 0:i[e],l=[(n=o==null?void 0:o.pbrMetallicRoughness)==null?void 0:n.baseColorTexture,o==null?void 0:o.emissiveTexture,o==null?void 0:o.normalTexture,o==null?void 0:o.occlusionTexture,(r=o==null?void 0:o.pbrMetallicRoughness)==null?void 0:r.metallicRoughnessTexture],h=[];for(const A of l)A&&(s=A==null?void 0:A.extensions)!=null&&s[G_]&&Xbt(t,e,A,h)}function Xbt(e,t,i,n){const r=Kbt(i,n);if(!r)return;const s=e.json.meshes||[];for(const o of s)for(const l of o.primitives){const h=l.material;Number.isFinite(h)&&t===h&&Qbt(e,l,r)}}function Kbt(e,t){var i;const n=(i=e.extensions)==null?void 0:i[G_],{texCoord:r=0}=e,{texCoord:s=r}=n;if(t.findIndex(([o,l])=>o===r&&l===s)===-1){const o=qbt(n);return r!==s&&(e.texCoord=s),t.push([r,s]),{originalTexCoord:r,texCoord:s,matrix:o}}return null}function Qbt(e,t,i){var n,r;const{originalTexCoord:s,texCoord:o,matrix:l}=i,h=t.attributes[`TEXCOORD_${s}`];if(Number.isFinite(h)){const A=(n=e.json.accessors)==null?void 0:n[h];if(A&&A.bufferView){const v=(r=e.json.bufferViews)==null?void 0:r[A.bufferView];if(v){const{arrayBuffer:C,byteOffset:S}=e.buffers[v.buffer],L=(S||0)+(A.byteOffset||0)+(v.byteOffset||0),{ArrayType:N,length:G}=yC(A,v),W=O8[A.componentType],j=D8[A.type],q=v.byteStride||W*j,Z=new Float32Array(G);for(let K=0;K<A.count;K++){const ft=new N(C,L+K*q,2);z_.set(ft[0],ft[1],1),z_.transformByMatrix3(l),Z.set([z_[0],z_[1]],K*j)}s===o?Zbt(A,v,e.buffers,Z):Ybt(o,A,t,e,Z)}}}}function Zbt(e,t,i,n){e.componentType=5126,i.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),t.buffer=i.length-1,t.byteLength=n.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function Ybt(e,t,i,n,r){n.buffers.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength});const s=n.json.bufferViews;if(!s)return;s.push({buffer:n.buffers.length-1,byteLength:r.buffer.byteLength,byteOffset:0});const o=n.json.accessors;o&&(o.push({bufferView:(s==null?void 0:s.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),i.attributes[`TEXCOORD_${e}`]=o.length-1)}function qbt(e){const{offset:t=[0,0],rotation:i=0,scale:n=[1,1]}=e,r=new mr().set(1,0,0,0,1,0,t[0],t[1],1),s=jbt.set(Math.cos(i),Math.sin(i),0,-Math.sin(i),Math.cos(i),0,0,0,1),o=Hbt.set(n[0],0,0,0,n[1],0,0,0,1);return r.multiplyRight(s).multiplyRight(o)}const $bt=Object.freeze(Object.defineProperty({__proto__:null,decode:Wbt,name:Vbt},Symbol.toStringTag,{value:"Module"})),Ef="KHR_lights_punctual",t2t=Ef;async function e2t(e){const t=new jo(e),{json:i}=t,n=t.getExtension(Ef);n&&(t.json.lights=n.lights,t.removeExtension(Ef));for(const r of i.nodes||[]){const s=t.getObjectExtension(r,Ef);s&&(r.light=s.light),t.removeObjectExtension(r,Ef)}}async function i2t(e){const t=new jo(e),{json:i}=t;if(i.lights){const n=t.addExtension(Ef);va(!n.lights),n.lights=i.lights,delete i.lights}if(t.json.lights){for(const n of t.json.lights){const r=n.node;t.addObjectExtension(r,Ef,n)}delete t.json.lights}}const n2t=Object.freeze(Object.defineProperty({__proto__:null,decode:e2t,encode:i2t,name:t2t},Symbol.toStringTag,{value:"Module"})),em="KHR_materials_unlit",r2t=em;async function o2t(e){const t=new jo(e),{json:i}=t;for(const n of i.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),t.removeObjectExtension(n,em);t.removeExtension(em)}function s2t(e){const t=new jo(e),{json:i}=t;if(t.materials)for(const n of i.materials||[])n.unlit&&(delete n.unlit,t.addObjectExtension(n,em,{}),t.addExtension(em))}const a2t=Object.freeze(Object.defineProperty({__proto__:null,decode:o2t,encode:s2t,name:r2t},Symbol.toStringTag,{value:"Module"})),im="KHR_techniques_webgl",l2t=im;async function c2t(e){const t=new jo(e),{json:i}=t,n=t.getExtension(im);if(n){const r=h2t(n,t);for(const s of i.materials||[]){const o=t.getObjectExtension(s,im);o&&(s.technique=Object.assign({},o,r[o.technique]),s.technique.values=f2t(s.technique,t)),t.removeObjectExtension(s,im)}t.removeExtension(im)}}async function u2t(e,t){}function h2t(e,t){const{programs:i=[],shaders:n=[],techniques:r=[]}=e,s=new TextDecoder;return n.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=s.decode(t.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),i.forEach(o=>{o.fragmentShader=n[o.fragmentShader],o.vertexShader=n[o.vertexShader]}),r.forEach(o=>{o.program=i[o.program]}),r}function f2t(e,t){const i=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach(n=>{e.uniforms[n].value&&!(n in i)&&(i[n]=e.uniforms[n].value)}),Object.keys(i).forEach(n=>{typeof i[n]=="object"&&i[n].index!==void 0&&(i[n].texture=t.getTexture(i[n].index))}),i}const d2t=Object.freeze(Object.defineProperty({__proto__:null,decode:c2t,encode:u2t,name:l2t},Symbol.toStringTag,{value:"Module"})),Z8=[O1t,o1t,Cbt,Tbt,Mbt,zbt,n2t,a2t,d2t,$bt,Y1t];function p2t(e,t={},i){var n;const r=Z8.filter(s=>Y8(s.name,t));for(const s of r)(n=s.preprocess)==null||n.call(s,e,t,i)}async function A2t(e,t={},i){var n;const r=Z8.filter(s=>Y8(s.name,t));for(const s of r)await((n=s.decode)==null?void 0:n.call(s,e,t,i))}function Y8(e,t){var i;const n=((i=t==null?void 0:t.gltf)==null?void 0:i.excludeExtensions)||{};return!(e in n&&!n[e])}const TC="KHR_binary_glTF";function g2t(e){const t=new jo(e),{json:i}=t;for(const n of i.images||[]){const r=t.getObjectExtension(n,TC);r&&Object.assign(n,r),t.removeObjectExtension(n,TC)}i.buffers&&i.buffers[0]&&delete i.buffers[0].uri,t.removeExtension(TC)}const q8={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},m2t={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class y2t{constructor(){z(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),z(this,"json")}normalize(t,i){this.json=t.json;const n=t.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!i.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),g2t(t),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const i in q8)this._convertTopLevelObjectToArray(t,i)}_convertTopLevelObjectToArray(t,i){const n=t[i];if(!(!n||Array.isArray(n))){t[i]=[];for(const r in n){const s=n[r];s.id=s.id||r;const o=t[i].length;t[i].push(s),this.idToIndexMap[i][r]=o}}}_convertObjectIdsToArrayIndices(t){for(const i in q8)this._convertIdsToIndices(t,i);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const i of t.textures)this._convertTextureIds(i);for(const i of t.meshes)this._convertMeshIds(i);for(const i of t.nodes)this._convertNodeIds(i);for(const i of t.scenes)this._convertSceneIds(i)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const i of t.primitives){const{attributes:n,indices:r,material:s}=i;for(const o in n)n[o]=this._convertIdToIndex(n[o],"accessor");r&&(i.indices=this._convertIdToIndex(r,"accessor")),s&&(i.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(i=>this._convertIdToIndex(i,"node"))),t.meshes&&(t.meshes=t.meshes.map(i=>this._convertIdToIndex(i,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(i=>this._convertIdToIndex(i,"node")))}_convertIdsToIndices(t,i){t[i]||(console.warn(`gltf v1: json doesn't contain attribute ${i}`),t[i]=[]);for(const n of t[i])for(const r in n){const s=n[r],o=this._convertIdToIndex(s,r);n[r]=o}}_convertIdToIndex(t,i){const n=m2t[i];if(n in this.idToIndexMap){const r=this.idToIndexMap[n][t];if(!Number.isFinite(r))throw new Error(`gltf v1: failed to resolve ${i} with id ${t}`);return r}return t}_updateObjects(t){for(const i of this.json.buffers)delete i.type}_updateMaterial(t){var i,n,r;for(const s of t.materials){s.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const o=((i=s.values)==null?void 0:i.tex)||((n=s.values)==null?void 0:n.texture2d_0)||((r=s.values)==null?void 0:r.diffuseTex),l=t.textures.findIndex(h=>h.id===o);l!==-1&&(s.pbrMetallicRoughness.baseColorTexture={index:l})}}}function _2t(e,t={}){return new y2t().normalize(e,t)}async function v2t(e,t,i=0,n,r){var s,o,l;return b2t(e,t,i,n),_2t(e,{normalize:(s=n==null?void 0:n.gltf)==null?void 0:s.normalize}),p2t(e,n,r),(o=n==null?void 0:n.gltf)!=null&&o.loadBuffers&&e.json.buffers&&await x2t(e,n,r),(l=n==null?void 0:n.gltf)!=null&&l.loadImages&&await w2t(e,n,r),await A2t(e,n,r),e}function b2t(e,t,i,n){if(n.uri&&(e.baseUri=n.uri),t instanceof ArrayBuffer&&!obt(t,i,n)&&(t=new TextDecoder().decode(t)),typeof t=="string")e.json=uL(t);else if(t instanceof ArrayBuffer){const o={};i=sbt(o,t,i,n.glb),va(o.type==="glTF",`Invalid GLB magic string ${o.type}`),e._glb=o,e.json=o.json}else va(!1,"GLTF: must be ArrayBuffer or string");const r=e.json.buffers||[];if(e.buffers=new Array(r.length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:o}=e._glb;e.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const s=e.json.images||[];e.images=new Array(s.length).fill({})}async function x2t(e,t,i){var n,r;const s=e.json.buffers||[];for(let o=0;o<s.length;++o){const l=s[o];if(l.uri){const{fetch:h}=i;va(h);const A=X8(l.uri,t),v=await((n=i==null?void 0:i.fetch)==null?void 0:n.call(i,A)),C=await((r=v==null?void 0:v.arrayBuffer)==null?void 0:r.call(v));e.buffers[o]={arrayBuffer:C,byteOffset:0,byteLength:C.byteLength},delete l.uri}else e.buffers[o]===null&&(e.buffers[o]={arrayBuffer:new ArrayBuffer(l.byteLength),byteOffset:0,byteLength:l.byteLength})}}async function w2t(e,t,i){const n=C2t(e),r=e.json.images||[],s=[];for(const o of n)s.push(E2t(e,r[o],o,t,i));return await Promise.all(s)}function C2t(e){const t=new Set,i=e.json.textures||[];for(const n of i)n.source!==void 0&&t.add(n.source);return Array.from(t).sort()}async function E2t(e,t,i,n,r){let s;if(t.uri&&!t.hasOwnProperty("bufferView")){const l=X8(t.uri,n),{fetch:h}=r;s=await(await h(l)).arrayBuffer(),t.bufferView={data:s}}if(Number.isFinite(t.bufferView)){const l=Hvt(e.json,e.buffers,t.bufferView);s=Ug(l.buffer,l.byteOffset,l.byteLength)}va(s,"glTF image has no data");let o=await yf(s,[qy,kF],{...n,mimeType:t.mimeType,basis:n.basis||{format:jw()}},r);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),e.images=e.images||[],e.images[i]=o}const V_={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:q1t,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:B2t,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function B2t(e,t={},i){t={...V_.options,...t},t.gltf={...V_.options.gltf,...t.gltf};const{byteOffset:n=0}=t;return await v2t({},e,n,t,i)}const T2t={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},S2t={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},za={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},I2t={magFilter:za.TEXTURE_MAG_FILTER,minFilter:za.TEXTURE_MIN_FILTER,wrapS:za.TEXTURE_WRAP_S,wrapT:za.TEXTURE_WRAP_T},M2t={[za.TEXTURE_MAG_FILTER]:za.LINEAR,[za.TEXTURE_MIN_FILTER]:za.NEAREST_MIPMAP_LINEAR,[za.TEXTURE_WRAP_S]:za.REPEAT,[za.TEXTURE_WRAP_T]:za.REPEAT};function P2t(){return{id:"default-sampler",parameters:M2t}}function R2t(e){return S2t[e]}function D2t(e){return T2t[e]}class O2t{constructor(){z(this,"baseUri",""),z(this,"jsonUnprocessed"),z(this,"json"),z(this,"buffers",[]),z(this,"images",[])}postProcess(t,i={}){const{json:n,buffers:r=[],images:s=[]}=t,{baseUri:o=""}=t;return va(n),this.baseUri=o,this.buffers=r,this.images=s,this.jsonUnprocessed=n,this.json=this._resolveTree(t.json,i),this.json}_resolveTree(t,i={}){const n={...t};return this.json=n,t.bufferViews&&(n.bufferViews=t.bufferViews.map((r,s)=>this._resolveBufferView(r,s))),t.images&&(n.images=t.images.map((r,s)=>this._resolveImage(r,s))),t.samplers&&(n.samplers=t.samplers.map((r,s)=>this._resolveSampler(r,s))),t.textures&&(n.textures=t.textures.map((r,s)=>this._resolveTexture(r,s))),t.accessors&&(n.accessors=t.accessors.map((r,s)=>this._resolveAccessor(r,s))),t.materials&&(n.materials=t.materials.map((r,s)=>this._resolveMaterial(r,s))),t.meshes&&(n.meshes=t.meshes.map((r,s)=>this._resolveMesh(r,s))),t.nodes&&(n.nodes=t.nodes.map((r,s)=>this._resolveNode(r,s)),n.nodes=n.nodes.map((r,s)=>this._resolveNodeChildren(r))),t.skins&&(n.skins=t.skins.map((r,s)=>this._resolveSkin(r,s))),t.scenes&&(n.scenes=t.scenes.map((r,s)=>this._resolveScene(r,s))),typeof this.json.scene=="number"&&n.scenes&&(n.scene=n.scenes[this.json.scene]),n}getScene(t){return this._get(this.json.scenes,t)}getNode(t){return this._get(this.json.nodes,t)}getSkin(t){return this._get(this.json.skins,t)}getMesh(t){return this._get(this.json.meshes,t)}getMaterial(t){return this._get(this.json.materials,t)}getAccessor(t){return this._get(this.json.accessors,t)}getCamera(t){return this._get(this.json.cameras,t)}getTexture(t){return this._get(this.json.textures,t)}getSampler(t){return this._get(this.json.samplers,t)}getImage(t){return this._get(this.json.images,t)}getBufferView(t){return this._get(this.json.bufferViews,t)}getBuffer(t){return this._get(this.json.buffers,t)}_get(t,i){if(typeof i=="object")return i;const n=t&&t[i];return n||console.warn(`glTF file error: Could not find ${t}[${i}]`),n}_resolveScene(t,i){return{...t,id:t.id||`scene-${i}`,nodes:(t.nodes||[]).map(n=>this.getNode(n))}}_resolveNode(t,i){const n={...t,id:(t==null?void 0:t.id)||`node-${i}`};return t.mesh!==void 0&&(n.mesh=this.getMesh(t.mesh)),t.camera!==void 0&&(n.camera=this.getCamera(t.camera)),t.skin!==void 0&&(n.skin=this.getSkin(t.skin)),t.meshes!==void 0&&t.meshes.length&&(n.mesh=t.meshes.reduce((r,s)=>{const o=this.getMesh(s);return r.id=o.id,r.primitives=r.primitives.concat(o.primitives),r},{primitives:[]})),n}_resolveNodeChildren(t){return t.children&&(t.children=t.children.map(i=>this.getNode(i))),t}_resolveSkin(t,i){const n=typeof t.inverseBindMatrices=="number"?this.getAccessor(t.inverseBindMatrices):void 0;return{...t,id:t.id||`skin-${i}`,inverseBindMatrices:n}}_resolveMesh(t,i){const n={...t,id:t.id||`mesh-${i}`,primitives:[]};return t.primitives&&(n.primitives=t.primitives.map(r=>{const s={...r,attributes:{},indices:void 0,material:void 0},o=r.attributes;for(const l in o)s.attributes[l]=this.getAccessor(o[l]);return r.indices!==void 0&&(s.indices=this.getAccessor(r.indices)),r.material!==void 0&&(s.material=this.getMaterial(r.material)),s})),n}_resolveMaterial(t,i){const n={...t,id:t.id||`material-${i}`};if(n.normalTexture&&(n.normalTexture={...n.normalTexture},n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture={...n.occlusionTexture},n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture={...n.emissiveTexture},n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness={...n.pbrMetallicRoughness};const r=n.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return n}_resolveAccessor(t,i){const n=R2t(t.componentType),r=D2t(t.type),s=n*r,o={...t,id:t.id||`accessor-${i}`,bytesPerComponent:n,components:r,bytesPerElement:s,value:void 0,bufferView:void 0,sparse:void 0};if(t.bufferView!==void 0&&(o.bufferView=this.getBufferView(t.bufferView)),o.bufferView){const l=o.bufferView.buffer,{ArrayType:h,byteLength:A}=yC(o,o.bufferView),v=(o.bufferView.byteOffset||0)+(o.byteOffset||0)+l.byteOffset;let C=l.arrayBuffer.slice(v,v+A);o.bufferView.byteStride&&(C=this._getValueFromInterleavedBuffer(l,v,o.bufferView.byteStride,o.bytesPerElement,o.count)),o.value=new h(C)}return o}_getValueFromInterleavedBuffer(t,i,n,r,s){const o=new Uint8Array(s*r);for(let l=0;l<s;l++){const h=i+l*n;o.set(new Uint8Array(t.arrayBuffer.slice(h,h+r)),l*r)}return o.buffer}_resolveTexture(t,i){return{...t,id:t.id||`texture-${i}`,sampler:typeof t.sampler=="number"?this.getSampler(t.sampler):P2t(),source:typeof t.source=="number"?this.getImage(t.source):void 0}}_resolveSampler(t,i){const n={id:t.id||`sampler-${i}`,...t,parameters:{}};for(const r in n){const s=this._enumSamplerParameter(r);s!==void 0&&(n.parameters[s]=n[r])}return n}_enumSamplerParameter(t){return I2t[t]}_resolveImage(t,i){const n={...t,id:t.id||`image-${i}`,image:null,bufferView:t.bufferView!==void 0?this.getBufferView(t.bufferView):void 0},r=this.images[i];return r&&(n.image=r),n}_resolveBufferView(t,i){const n=t.buffer,r=this.buffers[n].arrayBuffer;let s=this.buffers[n].byteOffset||0;return t.byteOffset&&(s+=t.byteOffset),{id:`bufferView-${i}`,...t,buffer:this.buffers[n],data:new Uint8Array(r,s,t.byteLength)}}_resolveCamera(t,i){const n={...t,id:t.id||`camera-${i}`};return n.perspective,n.orthographic,n}}function $8(e,t){return new O2t().postProcess(e,t)}const SC={URI:0,EMBEDDED:1};function tk(e,t,i,n){e.rotateYtoZ=!0;const r=(e.byteOffset||0)+(e.byteLength||0)-i;if(r===0)throw new Error("glTF byte length must be greater than 0.");return e.gltfUpAxis=n!=null&&n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",e.gltfArrayBuffer=Ug(t,i,r),e.gltfByteOffset=0,e.gltfByteLength=r,i%4===0||console.warn(`${e.type}: embedded glb is not aligned to a 4-byte boundary.`),(e.byteOffset||0)+(e.byteLength||0)}async function ek(e,t,i,n){const r=(i==null?void 0:i["3d-tiles"])||{};if(L2t(e,t),r.loadGLTF){if(!n)return;if(e.gltfUrl){const{fetch:s}=n,o=await s(e.gltfUrl,i);e.gltfArrayBuffer=await o.arrayBuffer(),e.gltfByteOffset=0}if(e.gltfArrayBuffer){const s=await yf(e.gltfArrayBuffer,V_,i,n);e.gltf=$8(s),e.gpuMemoryUsageInBytes=k8(e.gltf),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength}}}function L2t(e,t,i){switch(t){case SC.URI:if(e.gltfArrayBuffer){const n=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),r=new TextDecoder().decode(n);e.gltfUrl=r.replace(/[\s\0]+$/,"")}delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case SC.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function F2t(e,t,i,n,r){var s;i=k2t(e,t,i,n),await ek(e,SC.EMBEDDED,n,r);const o=(s=e==null?void 0:e.gltf)==null?void 0:s.extensions;return o&&o.CESIUM_RTC&&(e.rtcCenter=o.CESIUM_RTC.center),i}function k2t(e,t,i,n,r){i=D_(e,t,i),i=gC(e,t,i),i=mC(e,t,i),i=tk(e,t,i,n);const s=new pC(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=s.getGlobalProperty("RTC_CENTER",Vn.FLOAT,3),i}async function N2t(e,t,i,n,r){return i=U2t(e,t,i,n),await ek(e,e.gltfFormat||0,n,r),i}function U2t(e,t,i,n,r){var s;if(i=D_(e,t,i),e.version!==1)throw new Error(`Instanced 3D Model version ${e.version} is not supported`);i=gC(e,t,i);const o=new DataView(t);if(e.gltfFormat=o.getUint32(i,!0),i+=4,i=mC(e,t,i),i=tk(e,t,i,n),!((s=e==null?void 0:e.header)!=null&&s.featureTableJsonByteLength)||e.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const l=new pC(e.featureTableJson,e.featureTableBinary),h=l.getGlobalProperty("INSTANCES_LENGTH");if(l.featuresLength=h,!Number.isFinite(h))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");e.eastNorthUp=l.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=l.getGlobalProperty("RTC_CENTER",Vn.FLOAT,3);const A=new I8(e.batchTableJson,e.batchTableBinary,h);return G2t(e,l,A,h),i}function G2t(e,t,i,n){const r=new Array(n),s=new de;new de,new de,new de;const o=new mr,l=new YA,h=new de,A={},v=new mn,C=[],S=[],L=[],N=[];for(let G=0;G<n;G++){let W;if(t.hasProperty("POSITION"))W=t.getProperty("POSITION",Vn.FLOAT,3,G,s);else if(t.hasProperty("POSITION_QUANTIZED")){W=t.getProperty("POSITION_QUANTIZED",Vn.UNSIGNED_SHORT,3,G,s);const rt=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Vn.FLOAT,3);if(!rt)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Lt=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Vn.FLOAT,3);if(!Lt)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const Vt=65535;for(let At=0;At<3;At++)W[At]=W[At]/Vt*Lt[At]+rt[At]}if(!W)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(s.copy(W),A.translation=s,e.normalUp=t.getProperty("NORMAL_UP",Vn.FLOAT,3,G,C),e.normalRight=t.getProperty("NORMAL_RIGHT",Vn.FLOAT,3,G,S),e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",Vn.UNSIGNED_SHORT,2,G,C),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",Vn.UNSIGNED_SHORT,2,G,S),e.octNormalUp)throw e.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");e.eastNorthUp?(Cr.WGS84.eastNorthUpToFixedFrame(s,v),v.getRotationMatrix3(o)):o.identity()}l.fromMatrix3(o),A.rotation=l,h.set(1,1,1);const j=t.getProperty("SCALE",Vn.FLOAT,1,G,L);Number.isFinite(j)&&h.multiplyByScalar(j);const q=t.getProperty("SCALE_NON_UNIFORM",Vn.FLOAT,3,G,C);q&&h.scale(q),A.scale=h;let Z=t.getProperty("BATCH_ID",Vn.UNSIGNED_SHORT,1,G,N);Z===void 0&&(Z=G);const K=new mn().fromQuaternion(A.rotation);v.identity(),v.translate(A.translation),v.multiplyRight(K),v.scale(A.scale);const ft=v.clone();r[G]={modelMatrix:ft,batchId:Z}}e.instances=r}async function z2t(e,t,i,n,r,s){i=D_(e,t,i);const o=new DataView(t);for(e.tilesLength=o.getUint32(i,!0),i+=4,e.tiles=[];e.tiles.length<e.tilesLength&&(e.byteLength||0)-i>12;){const l={shape:"tile3d"};e.tiles.push(l),i=await s(t,i,n,r,l)}return i}async function V2t(e,t,i,n){var r,s;if(e.rotateYtoZ=!0,e.gltfUpAxis=(r=i==null?void 0:i["3d-tiles"])!=null&&r.assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",(s=i==null?void 0:i["3d-tiles"])!=null&&s.loadGLTF){if(!n)return t.byteLength;const o=await yf(t,V_,i,n);e.gltf=$8(o),e.gpuMemoryUsageInBytes=k8(e.gltf)}else e.gltfArrayBuffer=t;return t.byteLength}async function ik(e,t=0,i,n,r={shape:"tile3d"}){switch(r.byteOffset=t,r.type=avt(e,t),r.type){case $g.COMPOSITE:return await z2t(r,e,t,i,n,ik);case $g.BATCHED_3D_MODEL:return await F2t(r,e,t,i,n);case $g.GLTF:return await V2t(r,e,i,n);case $g.INSTANCED_3D_MODEL:return await N2t(r,e,t,i,n);case $g.POINT_CLOUD:return await Ivt(r,e,t,i,n);default:throw new Error(`3DTileLoader: unknown type ${r.type}`)}}const j2t=1952609651,H2t=1;async function W2t(e,t,i){if(new Uint32Array(e.slice(0,4))[0]!==j2t)throw new Error("Wrong subtree file magic number");if(new Uint32Array(e.slice(4,8))[0]!==H2t)throw new Error("Wrong subtree file verson, must be 1");const n=nk(e.slice(8,16)),r=new Uint8Array(e,24,n),s=new TextDecoder("utf8").decode(r),o=JSON.parse(s),l=nk(e.slice(16,24));let h=new ArrayBuffer(0);if(l&&(h=e.slice(24+n)),await j_(o,o.tileAvailability,h,i),Array.isArray(o.contentAvailability))for(const A of o.contentAvailability)await j_(o,A,h,i);else await j_(o,o.contentAvailability,h,i);return await j_(o,o.childSubtreeAvailability,h,i),o}async function j_(e,t,i,n){const r=Number.isFinite(t.bitstream)?t.bitstream:t.bufferView;if(typeof r!="number")return;const s=e.bufferViews[r],o=e.buffers[s.buffer];if(!(n!=null&&n.baseUrl))throw new Error("Url is not provided");if(!n.fetch)throw new Error("fetch is not provided");if(o.uri){const h=`${(n==null?void 0:n.baseUrl)||""}/${o.uri}`,A=await(await n.fetch(h)).arrayBuffer();t.explicitBitstream=new Uint8Array(A,s.byteOffset,s.byteLength);return}const l=e.buffers.slice(0,s.buffer).reduce((h,A)=>h+A.byteLength,0);t.explicitBitstream=new Uint8Array(i.slice(l,l+o.byteLength),s.byteOffset,s.byteLength)}function nk(e){const t=new DataView(e),i=t.getUint32(0,!0),n=t.getUint32(4,!0);return i+2**32*n}const rk={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:C8,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:W2t,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Va=null;try{Va=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function cr(e,t,i){this.low=e|0,this.high=t|0,this.unsigned=!!i}cr.prototype.__isLong__,Object.defineProperty(cr.prototype,"__isLong__",{value:!0});function ws(e){return(e&&e.__isLong__)===!0}function ok(e){var t=Math.clz32(e&-e);return e?31-t:t}cr.isLong=ws;var sk={},ak={};function Bf(e,t){var i,n,r;return t?(e>>>=0,(r=0<=e&&e<256)&&(n=ak[e],n)?n:(i=Hn(e,0,!0),r&&(ak[e]=i),i)):(e|=0,(r=-128<=e&&e<128)&&(n=sk[e],n)?n:(i=Hn(e,e<0?-1:0,!1),r&&(sk[e]=i),i))}cr.fromInt=Bf;function ja(e,t){if(isNaN(e))return t?cu:Ml;if(t){if(e<0)return cu;if(e>=ck)return dk}else{if(e<=-9223372036854776e3)return Xs;if(e+1>=X2t)return fk}return e<0?ja(-e,t).neg():Hn(e%Up|0,e/Up|0,t)}cr.fromNumber=ja;function Hn(e,t,i){return new cr(e,t,i)}cr.fromBits=Hn;var H_=Math.pow;function IC(e,t,i){if(e.length===0)throw Error("empty string");if(typeof t=="number"?(i=t,t=!1):t=!!t,e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return t?cu:Ml;if(i=i||10,i<2||36<i)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return IC(e.substring(1),t,i).neg();for(var r=ja(H_(i,8)),s=Ml,o=0;o<e.length;o+=8){var l=Math.min(8,e.length-o),h=parseInt(e.substring(o,o+l),i);if(l<8){var A=ja(H_(i,l));s=s.mul(A).add(ja(h))}else s=s.mul(r),s=s.add(ja(h))}return s.unsigned=t,s}cr.fromString=IC;function Il(e,t){return typeof e=="number"?ja(e,t):typeof e=="string"?IC(e,t):Hn(e.low,e.high,typeof t=="boolean"?t:e.unsigned)}cr.fromValue=Il;var lk=65536,J2t=1<<24,Up=lk*lk,ck=Up*Up,X2t=ck/2,uk=Bf(J2t),Ml=Bf(0);cr.ZERO=Ml;var cu=Bf(0,!0);cr.UZERO=cu;var Gp=Bf(1);cr.ONE=Gp;var hk=Bf(1,!0);cr.UONE=hk;var MC=Bf(-1);cr.NEG_ONE=MC;var fk=Hn(-1,2147483647,!1);cr.MAX_VALUE=fk;var dk=Hn(-1,-1,!0);cr.MAX_UNSIGNED_VALUE=dk;var Xs=Hn(0,-2147483648,!1);cr.MIN_VALUE=Xs;var ni=cr.prototype;ni.toInt=function(){return this.unsigned?this.low>>>0:this.low},ni.toNumber=function(){return this.unsigned?(this.high>>>0)*Up+(this.low>>>0):this.high*Up+(this.low>>>0)},ni.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Xs)){var t=ja(e),i=this.div(t),n=i.mul(t).sub(this);return i.toString(e)+n.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var r=ja(H_(e,6),this.unsigned),s=this,o="";;){var l=s.div(r),h=s.sub(l.mul(r)).toInt()>>>0,A=h.toString(e);if(s=l,s.isZero())return A+o;for(;A.length<6;)A="0"+A;o=""+A+o}},ni.getHighBits=function(){return this.high},ni.getHighBitsUnsigned=function(){return this.high>>>0},ni.getLowBits=function(){return this.low},ni.getLowBitsUnsigned=function(){return this.low>>>0},ni.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Xs)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1},ni.isZero=function(){return this.high===0&&this.low===0},ni.eqz=ni.isZero,ni.isNegative=function(){return!this.unsigned&&this.high<0},ni.isPositive=function(){return this.unsigned||this.high>=0},ni.isOdd=function(){return(this.low&1)===1},ni.isEven=function(){return(this.low&1)===0},ni.equals=function(e){return ws(e)||(e=Il(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low},ni.eq=ni.equals,ni.notEquals=function(e){return!this.eq(e)},ni.neq=ni.notEquals,ni.ne=ni.notEquals,ni.lessThan=function(e){return this.comp(e)<0},ni.lt=ni.lessThan,ni.lessThanOrEqual=function(e){return this.comp(e)<=0},ni.lte=ni.lessThanOrEqual,ni.le=ni.lessThanOrEqual,ni.greaterThan=function(e){return this.comp(e)>0},ni.gt=ni.greaterThan,ni.greaterThanOrEqual=function(e){return this.comp(e)>=0},ni.gte=ni.greaterThanOrEqual,ni.ge=ni.greaterThanOrEqual,ni.compare=function(e){if(ws(e)||(e=Il(e)),this.eq(e))return 0;var t=this.isNegative(),i=e.isNegative();return t&&!i?-1:!t&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},ni.comp=ni.compare,ni.negate=function(){return!this.unsigned&&this.eq(Xs)?Xs:this.not().add(Gp)},ni.neg=ni.negate,ni.add=function(e){ws(e)||(e=Il(e));var t=this.high>>>16,i=this.high&65535,n=this.low>>>16,r=this.low&65535,s=e.high>>>16,o=e.high&65535,l=e.low>>>16,h=e.low&65535,A=0,v=0,C=0,S=0;return S+=r+h,C+=S>>>16,S&=65535,C+=n+l,v+=C>>>16,C&=65535,v+=i+o,A+=v>>>16,v&=65535,A+=t+s,A&=65535,Hn(C<<16|S,A<<16|v,this.unsigned)},ni.subtract=function(e){return ws(e)||(e=Il(e)),this.add(e.neg())},ni.sub=ni.subtract,ni.multiply=function(e){if(this.isZero())return this;if(ws(e)||(e=Il(e)),Va){var t=Va.mul(this.low,this.high,e.low,e.high);return Hn(t,Va.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?cu:Ml;if(this.eq(Xs))return e.isOdd()?Xs:Ml;if(e.eq(Xs))return this.isOdd()?Xs:Ml;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(uk)&&e.lt(uk))return ja(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,n=this.high&65535,r=this.low>>>16,s=this.low&65535,o=e.high>>>16,l=e.high&65535,h=e.low>>>16,A=e.low&65535,v=0,C=0,S=0,L=0;return L+=s*A,S+=L>>>16,L&=65535,S+=r*A,C+=S>>>16,S&=65535,S+=s*h,C+=S>>>16,S&=65535,C+=n*A,v+=C>>>16,C&=65535,C+=r*h,v+=C>>>16,C&=65535,C+=s*l,v+=C>>>16,C&=65535,v+=i*A+n*h+r*l+s*o,v&=65535,Hn(S<<16|L,v<<16|C,this.unsigned)},ni.mul=ni.multiply,ni.divide=function(e){if(ws(e)||(e=Il(e)),e.isZero())throw Error("division by zero");if(Va){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Va.div_u:Va.div_s)(this.low,this.high,e.low,e.high);return Hn(t,Va.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?cu:Ml;var i,n,r;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return cu;if(e.gt(this.shru(1)))return hk;r=cu}else{if(this.eq(Xs)){if(e.eq(Gp)||e.eq(MC))return Xs;if(e.eq(Xs))return Gp;var s=this.shr(1);return i=s.div(e).shl(1),i.eq(Ml)?e.isNegative()?Gp:MC:(n=this.sub(e.mul(i)),r=i.add(n.div(e)),r)}else if(e.eq(Xs))return this.unsigned?cu:Ml;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=Ml}for(n=this;n.gte(e);){i=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(i)/Math.LN2),l=o<=48?1:H_(2,o-48),h=ja(i),A=h.mul(e);A.isNegative()||A.gt(n);)i-=l,h=ja(i,this.unsigned),A=h.mul(e);h.isZero()&&(h=Gp),r=r.add(h),n=n.sub(A)}return r},ni.div=ni.divide,ni.modulo=function(e){if(ws(e)||(e=Il(e)),Va){var t=(this.unsigned?Va.rem_u:Va.rem_s)(this.low,this.high,e.low,e.high);return Hn(t,Va.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},ni.mod=ni.modulo,ni.rem=ni.modulo,ni.not=function(){return Hn(~this.low,~this.high,this.unsigned)},ni.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},ni.clz=ni.countLeadingZeros,ni.countTrailingZeros=function(){return this.low?ok(this.low):ok(this.high)+32},ni.ctz=ni.countTrailingZeros,ni.and=function(e){return ws(e)||(e=Il(e)),Hn(this.low&e.low,this.high&e.high,this.unsigned)},ni.or=function(e){return ws(e)||(e=Il(e)),Hn(this.low|e.low,this.high|e.high,this.unsigned)},ni.xor=function(e){return ws(e)||(e=Il(e)),Hn(this.low^e.low,this.high^e.high,this.unsigned)},ni.shiftLeft=function(e){return ws(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Hn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Hn(0,this.low<<e-32,this.unsigned)},ni.shl=ni.shiftLeft,ni.shiftRight=function(e){return ws(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Hn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Hn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},ni.shr=ni.shiftRight,ni.shiftRightUnsigned=function(e){return ws(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Hn(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?Hn(this.high,0,this.unsigned):Hn(this.high>>>e-32,0,this.unsigned)},ni.shru=ni.shiftRightUnsigned,ni.shr_u=ni.shiftRightUnsigned,ni.rotateLeft=function(e){var t;return ws(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Hn(this.high,this.low,this.unsigned):e<32?(t=32-e,Hn(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,Hn(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},ni.rotl=ni.rotateLeft,ni.rotateRight=function(e){var t;return ws(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Hn(this.high,this.low,this.unsigned):e<32?(t=32-e,Hn(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,Hn(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},ni.rotr=ni.rotateRight,ni.toSigned=function(){return this.unsigned?Hn(this.low,this.high,!1):this},ni.toUnsigned=function(){return this.unsigned?this:Hn(this.low,this.high,!0)},ni.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},ni.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]},ni.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]},cr.fromBytes=function(e,t,i){return i?cr.fromBytesLE(e,t):cr.fromBytesBE(e,t)},cr.fromBytesLE=function(e,t){return new cr(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},cr.fromBytesBE=function(e,t){return new cr(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const K2t=16;function pk(e){e==="X"&&(e="");const t=e.padEnd(K2t,"0");return cr.fromString(t,!0,16)}function Q2t(e){if(e.isZero())return"X";let t=e.countTrailingZeros();const i=t%4;t=(t-i)/4;const n=t;t*=4;const r=e.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-n-r.length).join("0")+r}function Z2t(e,t){const i=Y2t(e).shiftRightUnsigned(2);return e.add(cr.fromNumber(2*t+1-4).multiply(i))}function Y2t(e){return e.and(e.not().add(1))}const q2t=3,$2t=30,txt=2*$2t+1,Ak=180/Math.PI;function ext(e){if(e.length===0)throw new Error(`Invalid Hilbert quad key ${e}`);const t=e.split("/"),i=parseInt(t[0],10),n=t[1],r=n.length;let s=0;const o=[0,0];for(let l=r-1;l>=0;l--){s=r-l;const h=n[l];let A=0,v=0;h==="1"?v=1:h==="2"?(A=1,v=1):h==="3"&&(A=1);const C=Math.pow(2,s-1);nxt(C,o,A,v),o[0]+=C*A,o[1]+=C*v}if(i%2===1){const l=o[0];o[0]=o[1],o[1]=l}return{face:i,ij:o,level:s}}function ixt(e){if(e.isZero())return"";let t=e.toString(2);for(;t.length<q2t+txt;)t="0"+t;const i=t.lastIndexOf("1"),n=t.substring(0,3),r=t.substring(3,i),s=r.length/2,o=cr.fromString(n,!0,2).toString(10);let l="";if(s!==0)for(l=cr.fromString(r,!0,2).toString(4);l.length<s;)l="0"+l;return`${o}/${l}`}function gk(e,t,i){const n=1<<t;return[(e[0]+i[0])/n,(e[1]+i[1])/n]}function mk(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function yk(e){return[mk(e[0]),mk(e[1])]}function _k(e,[t,i]){switch(e){case 0:return[1,t,i];case 1:return[-t,1,i];case 2:return[-t,-i,1];case 3:return[-1,-i,-t];case 4:return[i,-1,-t];case 5:return[i,t,-1];default:throw new Error("Invalid face")}}function vk([e,t,i]){const n=Math.atan2(i,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*Ak,n*Ak]}function nxt(e,t,i,n){if(n===0){i===1&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);const r=t[0];t[0]=t[1],t[1]=r}}function rxt(e){const t=gk(e.ij,e.level,[.5,.5]),i=yk(t),n=_k(e.face,i);return vk(n)}const oxt=100;function bk(e){const{face:t,ij:i,level:n}=e,r=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(oxt*Math.pow(2,-n))),o=new Float64Array(4*s*2+2);let l=0,h=0;for(let A=0;A<4;A++){const v=r[A].slice(0),C=r[A+1],S=(C[0]-v[0])/s,L=(C[1]-v[1])/s;for(let N=0;N<s;N++){v[0]+=S,v[1]+=L;const G=gk(i,n,v),W=yk(G),j=_k(t,W),q=vk(j);Math.abs(q[1])>89.999&&(q[0]=h);const Z=q[0]-h;q[0]+=Z>180?-360:Z<-180?360:0,o[l++]=q[0],o[l++]=q[1],h=q[0]}}return o[l++]=o[0],o[l++]=o[1],o}function PC(e){const t=sxt(e);return ext(t)}function sxt(e){if(e.indexOf("/")>0)return e;const t=pk(e);return ixt(t)}function axt(e){const t=PC(e);return rxt(t)}function lxt(e){let t;if(e.face===2||e.face===5){let i=null,n=0;for(let r=0;r<4;r++){const s=`${e.face}/${r}`,o=PC(s),l=bk(o);(typeof i>"u"||i===null)&&(i=new Float64Array(4*l.length)),i.set(l,n),n+=l.length}t=xk(i)}else{const i=bk(e);t=xk(i)}return t}function xk(e){if(e.length%2!==0)throw new Error("Invalid corners");const t=[],i=[];for(let n=0;n<e.length;n+=2)t.push(e[n]),i.push(e[n+1]);return t.sort((n,r)=>n-r),i.sort((n,r)=>n-r),{west:t[0],east:t[t.length-1],north:i[i.length-1],south:i[0]}}function cxt(e,t){const i=(t==null?void 0:t.minimumHeight)||0,n=(t==null?void 0:t.maximumHeight)||0,r=PC(e),s=lxt(r),o=s.west,l=s.south,h=s.east,A=s.north,v=[];return v.push(new de(o,A,i)),v.push(new de(h,A,i)),v.push(new de(h,l,i)),v.push(new de(o,l,i)),v.push(new de(o,A,n)),v.push(new de(h,A,n)),v.push(new de(h,l,n)),v.push(new de(o,l,n)),v}function wk(e){const t=e.token,i={minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight},n=cxt(t,i),r=axt(t),s=r[0],o=r[1],l=Cr.WGS84.cartographicToCartesian([s,o,i.maximumHeight]),h=new de(l[0],l[1],l[2]);n.push(h);const A=kL(n);return[...A.center,...A.halfAxes]}const uxt=4,hxt=8,fxt={QUADTREE:uxt,OCTREE:hxt};function dxt(e,t,i){if(e!=null&&e.box){const n=pk(e.s2VolumeInfo.token),r=Z2t(n,t),s=Q2t(r),o={...e.s2VolumeInfo};switch(o.token=s,i){case"OCTREE":const l=e.s2VolumeInfo,h=l.maximumHeight-l.minimumHeight,A=h/2,v=l.minimumHeight+h/2;l.minimumHeight=v-A,l.maximumHeight=v+A;break}return{box:wk(o),s2VolumeInfo:o}}}async function Ck(e){const{subtree:t,subtreeData:i={level:0,x:0,y:0,z:0},parentData:n={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:r=0,implicitOptions:s,loaderOptions:o,s2VolumeBox:l}=e,{subdivisionScheme:h,subtreeLevels:A,maximumLevel:v,contentUrlTemplate:C,subtreesUriTemplate:S,basePath:L}=s,N={children:[],lodMetricValue:0,contentUrl:""};if(!v)return g6.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${C} won't be loaded...`),N;const G=n.localLevel+1,W=i.level+G;if(W>v)return N;const j=fxt[h],q=Math.log2(j),Z=r&1,K=r>>1&1,ft=r>>2&1,rt=Tf(n.localX,Z,1),Lt=Tf(n.localY,K,1),Vt=Tf(n.localZ,ft,1),At=Tf(i.x,rt,G),at=Tf(i.y,Lt,G),kt=Tf(i.z,Vt,G),X=Tf(n.mortonIndex,r,q),ht=G===A&&RC(t.childSubtreeAvailability,X);let Mt,pe,Ct,Dt;if(ht){const Gt=`${L}/${S}`,te=DC(Gt,W,At,at,kt);Mt=await gp(te,rk,o),Dt=0,pe={level:W,x:At,y:at,z:kt},Ct={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else Mt=t,Dt=(j**G-1)/(j-1)+X,pe=i,Ct={mortonIndex:X,localLevel:G,localX:rt,localY:Lt,localZ:Vt};if(!RC(Mt.tileAvailability,Dt))return N;RC(Mt.contentAvailability,Dt)&&(N.contentUrl=DC(C,W,At,at,kt));for(let Gt=0;Gt<j;Gt++){const te=dxt(l,Gt,h),re=await Ck({subtree:Mt,subtreeData:pe,parentData:Ct,childIndex:Gt,implicitOptions:s,loaderOptions:o,s2VolumeBox:te});(re.contentUrl||re.children.length)&&N.children.push(re)}return N.contentUrl||N.children.length?pxt(N,{level:W,x:At,y:at,z:kt},s,l):N}function RC(e,t){let i;return Array.isArray(e)?(i=e[0],e.length>1&&g6.once('Not supported extension "3DTILES_multiple_contents" has been detected')):i=e,"constant"in i?!!i.constant:i.explicitBitstream?mxt(t,i.explicitBitstream):!1}function pxt(e,t,i,n){const{basePath:r,refine:s,getRefine:o,lodMetricType:l,getTileType:h,rootLodMetricValue:A,rootBoundingVolume:v}=i,C=e.contentUrl&&e.contentUrl.replace(`${r}/`,""),S=A/2**t.level,L=n!=null&&n.box?{box:n.box}:v,N=Axt(L,t,i.subdivisionScheme);return{children:e.children,contentUrl:e.contentUrl,content:{uri:C},id:e.contentUrl,refine:o(s),type:h(e),lodMetricType:l,lodMetricValue:S,geometricError:S,transform:e.transform,boundingVolume:N}}function Axt(e,t,i){if(e.region){const{level:n,x:r,y:s,z:o}=t,[l,h,A,v,C,S]=e.region,L=2**n,N=(A-l)/L,[G,W]=[l+N*r,l+N*(r+1)],j=(v-h)/L,[q,Z]=[h+j*s,h+j*(s+1)];let K,ft;if(i==="OCTREE"){const rt=(S-C)/L;[K,ft]=[C+rt*o,C+rt*(o+1)]}else[K,ft]=[C,S];return{region:[G,q,W,Z,K,ft]}}if(e.box)return e;throw new Error(`Unsupported bounding volume type ${JSON.stringify(e)}`)}function Tf(e,t,i){return(e<<i)+t}function DC(e,t,i,n,r){const s=gxt({level:t,x:i,y:n,z:r});return e.replace(/{level}|{x}|{y}|{z}/gi,o=>s[o])}function gxt(e){const t={};for(const i in e)t[`{${i}}`]=e[i];return t}function mxt(e,t){const i=Math.floor(e/8),n=e%8;return(t[i]>>n&1)===1}function OC(e,t=""){if(!t)return lu.EMPTY;const i=t.split("?")[0].split(".").pop();switch(i){case"pnts":return lu.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return lu.SCENEGRAPH;default:return i||lu.EMPTY}}function LC(e){switch(e){case"REPLACE":case"replace":return Sl.REPLACE;case"ADD":case"add":return Sl.ADD;default:return e}}function FC(e,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const i=new URL(e,`${t}/`);return decodeURI(i.toString())}else if(e.startsWith("/"))return e;return Fft(t,e)}function Ek(e,t){var i;if(!e)return null;let n;if(e.content){const r=e.content.uri||((i=e.content)==null?void 0:i.url);typeof r<"u"&&(n=FC(r,t))}return{...e,id:n,contentUrl:n,lodMetricType:Dp.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:OC(e,n),refine:LC(e.refine)}}async function yxt(e,t,i){let n=null;const r=Tk(e.root);r&&e.root?n=await Bk(e.root,e,t,r,i):n=Ek(e.root,t);const s=[];for(s.push(n);s.length>0;){const o=s.pop()||{},l=o.children||[],h=[];for(const A of l){const v=Tk(A);let C;v?C=await Bk(A,e,t,v,i):C=Ek(A,t),C&&(h.push(C),s.push(C))}o.children=h}return n}async function Bk(e,t,i,n,r){var s,o,l;const{subdivisionScheme:h,maximumLevel:A,availableLevels:v,subtreeLevels:C,subtrees:{uri:S}}=n,L=DC(S,0,0,0,0),N=FC(L,i),G=await gp(N,rk,r),W=(s=e.content)==null?void 0:s.uri,j=W?FC(W,i):"",q=(o=t==null?void 0:t.root)==null?void 0:o.refine,Z=e.geometricError,K=(l=e.boundingVolume.extensions)==null?void 0:l["3DTILES_bounding_volume_S2"];if(K){const Lt={box:wk(K),s2VolumeInfo:K};e.boundingVolume=Lt}const ft=e.boundingVolume,rt={contentUrlTemplate:j,subtreesUriTemplate:S,subdivisionScheme:h,subtreeLevels:C,maximumLevel:Number.isFinite(v)?v-1:A,refine:q,basePath:i,lodMetricType:Dp.GEOMETRIC_ERROR,rootLodMetricValue:Z,rootBoundingVolume:ft,getTileType:OC,getRefine:LC};return await _xt(e,i,G,rt,r)}async function _xt(e,t,i,n,r){if(!e)return null;const{children:s,contentUrl:o}=await Ck({subtree:i,implicitOptions:n,loaderOptions:r});let l,h=null;return o&&(l=o,h={uri:o.replace(`${t}/`,"")}),{...e,id:l,contentUrl:l,lodMetricType:Dp.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:OC(e,l),refine:LC(e.refine),content:h||e.content,children:s}}function Tk(e){var t;return((t=e==null?void 0:e.extensions)==null?void 0:t["3DTILES_implicit_tiling"])||(e==null?void 0:e.implicitTiling)}const Sk={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:C8,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:vxt,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function vxt(e,t={},i){const n=t["3d-tiles"]||{};let r;return n.isTileset==="auto"?r=(i==null?void 0:i.url)&&i.url.indexOf(".json")!==-1:r=n.isTileset,r?bxt(e,t,i):xxt(e,t,i)}async function bxt(e,t,i){var n;const r=JSON.parse(new TextDecoder().decode(e)),s=(i==null?void 0:i.url)||"",o=wxt(s),l=await yxt(r,o,t||{});return{...r,shape:"tileset3d",loader:Sk,url:s,queryString:(i==null?void 0:i.queryString)||"",basePath:o,root:l||r.root,type:Ws.TILES3D,lodMetricType:Dp.GEOMETRIC_ERROR,lodMetricValue:((n=r.root)==null?void 0:n.geometricError)||0}}async function xxt(e,t,i){const n={content:{shape:"tile3d",featureIds:null}};return await ik(e,0,t,i,n.content),n.content}function wxt(e){return dL(e)}var Ik={},Mk;function _h(){return Mk||(Mk=1,function(e){var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function i(s,o){return Object.prototype.hasOwnProperty.call(s,o)}e.assign=function(s){for(var o=Array.prototype.slice.call(arguments,1);o.length;){var l=o.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var h in l)i(l,h)&&(s[h]=l[h])}}return s},e.shrinkBuf=function(s,o){return s.length===o?s:s.subarray?s.subarray(0,o):(s.length=o,s)};var n={arraySet:function(s,o,l,h,A){if(o.subarray&&s.subarray){s.set(o.subarray(l,l+h),A);return}for(var v=0;v<h;v++)s[A+v]=o[l+v]},flattenChunks:function(s){var o,l,h,A,v,C;for(h=0,o=0,l=s.length;o<l;o++)h+=s[o].length;for(C=new Uint8Array(h),A=0,o=0,l=s.length;o<l;o++)v=s[o],C.set(v,A),A+=v.length;return C}},r={arraySet:function(s,o,l,h,A){for(var v=0;v<h;v++)s[A+v]=o[l+v]},flattenChunks:function(s){return[].concat.apply([],s)}};e.setTyped=function(s){s?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,n)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,r))},e.setTyped(t)}(Ik)),Ik}var zp={},Pl={},Sf={},Pk;function Cxt(){if(Pk)return Sf;Pk=1;var e=_h(),t=4,i=0,n=1,r=2;function s(St){for(var Ne=St.length;--Ne>=0;)St[Ne]=0}var o=0,l=1,h=2,A=3,v=258,C=29,S=256,L=S+1+C,N=30,G=19,W=2*L+1,j=15,q=16,Z=7,K=256,ft=16,rt=17,Lt=18,Vt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],At=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],at=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],kt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],X=512,ht=new Array((L+2)*2);s(ht);var Mt=new Array(N*2);s(Mt);var pe=new Array(X);s(pe);var Ct=new Array(v-A+1);s(Ct);var Dt=new Array(C);s(Dt);var Gt=new Array(N);s(Gt);function te(St,Ne,Xe,ci,qt){this.static_tree=St,this.extra_bits=Ne,this.extra_base=Xe,this.elems=ci,this.max_length=qt,this.has_stree=St&&St.length}var re,ae,he;function Pe(St,Ne){this.dyn_tree=St,this.max_code=0,this.stat_desc=Ne}function Se(St){return St<256?pe[St]:pe[256+(St>>>7)]}function se(St,Ne){St.pending_buf[St.pending++]=Ne&255,St.pending_buf[St.pending++]=Ne>>>8&255}function fi(St,Ne,Xe){St.bi_valid>q-Xe?(St.bi_buf|=Ne<<St.bi_valid&65535,se(St,St.bi_buf),St.bi_buf=Ne>>q-St.bi_valid,St.bi_valid+=Xe-q):(St.bi_buf|=Ne<<St.bi_valid&65535,St.bi_valid+=Xe)}function Ze(St,Ne,Xe){fi(St,Xe[Ne*2],Xe[Ne*2+1])}function Ye(St,Ne){var Xe=0;do Xe|=St&1,St>>>=1,Xe<<=1;while(--Ne>0);return Xe>>>1}function ze(St){St.bi_valid===16?(se(St,St.bi_buf),St.bi_buf=0,St.bi_valid=0):St.bi_valid>=8&&(St.pending_buf[St.pending++]=St.bi_buf&255,St.bi_buf>>=8,St.bi_valid-=8)}function pi(St,Ne){var Xe=Ne.dyn_tree,ci=Ne.max_code,qt=Ne.stat_desc.static_tree,De=Ne.stat_desc.has_stree,mt=Ne.stat_desc.extra_bits,Ve=Ne.stat_desc.extra_base,Ce=Ne.stat_desc.max_length,H,ve,Te,wt,Kt,ce,Y=0;for(wt=0;wt<=j;wt++)St.bl_count[wt]=0;for(Xe[St.heap[St.heap_max]*2+1]=0,H=St.heap_max+1;H<W;H++)ve=St.heap[H],wt=Xe[Xe[ve*2+1]*2+1]+1,wt>Ce&&(wt=Ce,Y++),Xe[ve*2+1]=wt,!(ve>ci)&&(St.bl_count[wt]++,Kt=0,ve>=Ve&&(Kt=mt[ve-Ve]),ce=Xe[ve*2],St.opt_len+=ce*(wt+Kt),De&&(St.static_len+=ce*(qt[ve*2+1]+Kt)));if(Y!==0){do{for(wt=Ce-1;St.bl_count[wt]===0;)wt--;St.bl_count[wt]--,St.bl_count[wt+1]+=2,St.bl_count[Ce]--,Y-=2}while(Y>0);for(wt=Ce;wt!==0;wt--)for(ve=St.bl_count[wt];ve!==0;)Te=St.heap[--H],!(Te>ci)&&(Xe[Te*2+1]!==wt&&(St.opt_len+=(wt-Xe[Te*2+1])*Xe[Te*2],Xe[Te*2+1]=wt),ve--)}}function sn(St,Ne,Xe){var ci=new Array(j+1),qt=0,De,mt;for(De=1;De<=j;De++)ci[De]=qt=qt+Xe[De-1]<<1;for(mt=0;mt<=Ne;mt++){var Ve=St[mt*2+1];Ve!==0&&(St[mt*2]=Ye(ci[Ve]++,Ve))}}function Ii(){var St,Ne,Xe,ci,qt,De=new Array(j+1);for(Xe=0,ci=0;ci<C-1;ci++)for(Dt[ci]=Xe,St=0;St<1<<Vt[ci];St++)Ct[Xe++]=ci;for(Ct[Xe-1]=ci,qt=0,ci=0;ci<16;ci++)for(Gt[ci]=qt,St=0;St<1<<At[ci];St++)pe[qt++]=ci;for(qt>>=7;ci<N;ci++)for(Gt[ci]=qt<<7,St=0;St<1<<At[ci]-7;St++)pe[256+qt++]=ci;for(Ne=0;Ne<=j;Ne++)De[Ne]=0;for(St=0;St<=143;)ht[St*2+1]=8,St++,De[8]++;for(;St<=255;)ht[St*2+1]=9,St++,De[9]++;for(;St<=279;)ht[St*2+1]=7,St++,De[7]++;for(;St<=287;)ht[St*2+1]=8,St++,De[8]++;for(sn(ht,L+1,De),St=0;St<N;St++)Mt[St*2+1]=5,Mt[St*2]=Ye(St,5);re=new te(ht,Vt,S+1,L,j),ae=new te(Mt,At,0,N,j),he=new te(new Array(0),at,0,G,Z)}function _i(St){var Ne;for(Ne=0;Ne<L;Ne++)St.dyn_ltree[Ne*2]=0;for(Ne=0;Ne<N;Ne++)St.dyn_dtree[Ne*2]=0;for(Ne=0;Ne<G;Ne++)St.bl_tree[Ne*2]=0;St.dyn_ltree[K*2]=1,St.opt_len=St.static_len=0,St.last_lit=St.matches=0}function Fn(St){St.bi_valid>8?se(St,St.bi_buf):St.bi_valid>0&&(St.pending_buf[St.pending++]=St.bi_buf),St.bi_buf=0,St.bi_valid=0}function Ai(St,Ne,Xe,ci){Fn(St),se(St,Xe),se(St,~Xe),e.arraySet(St.pending_buf,St.window,Ne,Xe,St.pending),St.pending+=Xe}function vi(St,Ne,Xe,ci){var qt=Ne*2,De=Xe*2;return St[qt]<St[De]||St[qt]===St[De]&&ci[Ne]<=ci[Xe]}function cn(St,Ne,Xe){for(var ci=St.heap[Xe],qt=Xe<<1;qt<=St.heap_len&&(qt<St.heap_len&&vi(Ne,St.heap[qt+1],St.heap[qt],St.depth)&&qt++,!vi(Ne,ci,St.heap[qt],St.depth));)St.heap[Xe]=St.heap[qt],Xe=qt,qt<<=1;St.heap[Xe]=ci}function Ri(St,Ne,Xe){var ci,qt,De=0,mt,Ve;if(St.last_lit!==0)do ci=St.pending_buf[St.d_buf+De*2]<<8|St.pending_buf[St.d_buf+De*2+1],qt=St.pending_buf[St.l_buf+De],De++,ci===0?Ze(St,qt,Ne):(mt=Ct[qt],Ze(St,mt+S+1,Ne),Ve=Vt[mt],Ve!==0&&(qt-=Dt[mt],fi(St,qt,Ve)),ci--,mt=Se(ci),Ze(St,mt,Xe),Ve=At[mt],Ve!==0&&(ci-=Gt[mt],fi(St,ci,Ve)));while(De<St.last_lit);Ze(St,K,Ne)}function ur(St,Ne){var Xe=Ne.dyn_tree,ci=Ne.stat_desc.static_tree,qt=Ne.stat_desc.has_stree,De=Ne.stat_desc.elems,mt,Ve,Ce=-1,H;for(St.heap_len=0,St.heap_max=W,mt=0;mt<De;mt++)Xe[mt*2]!==0?(St.heap[++St.heap_len]=Ce=mt,St.depth[mt]=0):Xe[mt*2+1]=0;for(;St.heap_len<2;)H=St.heap[++St.heap_len]=Ce<2?++Ce:0,Xe[H*2]=1,St.depth[H]=0,St.opt_len--,qt&&(St.static_len-=ci[H*2+1]);for(Ne.max_code=Ce,mt=St.heap_len>>1;mt>=1;mt--)cn(St,Xe,mt);H=De;do mt=St.heap[1],St.heap[1]=St.heap[St.heap_len--],cn(St,Xe,1),Ve=St.heap[1],St.heap[--St.heap_max]=mt,St.heap[--St.heap_max]=Ve,Xe[H*2]=Xe[mt*2]+Xe[Ve*2],St.depth[H]=(St.depth[mt]>=St.depth[Ve]?St.depth[mt]:St.depth[Ve])+1,Xe[mt*2+1]=Xe[Ve*2+1]=H,St.heap[1]=H++,cn(St,Xe,1);while(St.heap_len>=2);St.heap[--St.heap_max]=St.heap[1],pi(St,Ne),sn(Xe,Ce,St.bl_count)}function $n(St,Ne,Xe){var ci,qt=-1,De,mt=Ne[0*2+1],Ve=0,Ce=7,H=4;for(mt===0&&(Ce=138,H=3),Ne[(Xe+1)*2+1]=65535,ci=0;ci<=Xe;ci++)De=mt,mt=Ne[(ci+1)*2+1],!(++Ve<Ce&&De===mt)&&(Ve<H?St.bl_tree[De*2]+=Ve:De!==0?(De!==qt&&St.bl_tree[De*2]++,St.bl_tree[ft*2]++):Ve<=10?St.bl_tree[rt*2]++:St.bl_tree[Lt*2]++,Ve=0,qt=De,mt===0?(Ce=138,H=3):De===mt?(Ce=6,H=3):(Ce=7,H=4))}function gn(St,Ne,Xe){var ci,qt=-1,De,mt=Ne[0*2+1],Ve=0,Ce=7,H=4;for(mt===0&&(Ce=138,H=3),ci=0;ci<=Xe;ci++)if(De=mt,mt=Ne[(ci+1)*2+1],!(++Ve<Ce&&De===mt)){if(Ve<H)do Ze(St,De,St.bl_tree);while(--Ve!==0);else De!==0?(De!==qt&&(Ze(St,De,St.bl_tree),Ve--),Ze(St,ft,St.bl_tree),fi(St,Ve-3,2)):Ve<=10?(Ze(St,rt,St.bl_tree),fi(St,Ve-3,3)):(Ze(St,Lt,St.bl_tree),fi(St,Ve-11,7));Ve=0,qt=De,mt===0?(Ce=138,H=3):De===mt?(Ce=6,H=3):(Ce=7,H=4)}}function rr(St){var Ne;for($n(St,St.dyn_ltree,St.l_desc.max_code),$n(St,St.dyn_dtree,St.d_desc.max_code),ur(St,St.bl_desc),Ne=G-1;Ne>=3&&St.bl_tree[kt[Ne]*2+1]===0;Ne--);return St.opt_len+=3*(Ne+1)+5+5+4,Ne}function Wn(St,Ne,Xe,ci){var qt;for(fi(St,Ne-257,5),fi(St,Xe-1,5),fi(St,ci-4,4),qt=0;qt<ci;qt++)fi(St,St.bl_tree[kt[qt]*2+1],3);gn(St,St.dyn_ltree,Ne-1),gn(St,St.dyn_dtree,Xe-1)}function Tn(St){var Ne=4093624447,Xe;for(Xe=0;Xe<=31;Xe++,Ne>>>=1)if(Ne&1&&St.dyn_ltree[Xe*2]!==0)return i;if(St.dyn_ltree[9*2]!==0||St.dyn_ltree[10*2]!==0||St.dyn_ltree[13*2]!==0)return n;for(Xe=32;Xe<S;Xe++)if(St.dyn_ltree[Xe*2]!==0)return n;return i}var tr=!1;function je(St){tr||(Ii(),tr=!0),St.l_desc=new Pe(St.dyn_ltree,re),St.d_desc=new Pe(St.dyn_dtree,ae),St.bl_desc=new Pe(St.bl_tree,he),St.bi_buf=0,St.bi_valid=0,_i(St)}function mi(St,Ne,Xe,ci){fi(St,(o<<1)+(ci?1:0),3),Ai(St,Ne,Xe)}function Mi(St){fi(St,l<<1,3),Ze(St,K,ht),ze(St)}function nn(St,Ne,Xe,ci){var qt,De,mt=0;St.level>0?(St.strm.data_type===r&&(St.strm.data_type=Tn(St)),ur(St,St.l_desc),ur(St,St.d_desc),mt=rr(St),qt=St.opt_len+3+7>>>3,De=St.static_len+3+7>>>3,De<=qt&&(qt=De)):qt=De=Xe+5,Xe+4<=qt&&Ne!==-1?mi(St,Ne,Xe,ci):St.strategy===t||De===qt?(fi(St,(l<<1)+(ci?1:0),3),Ri(St,ht,Mt)):(fi(St,(h<<1)+(ci?1:0),3),Wn(St,St.l_desc.max_code+1,St.d_desc.max_code+1,mt+1),Ri(St,St.dyn_ltree,St.dyn_dtree)),_i(St),ci&&Fn(St)}function _r(St,Ne,Xe){return St.pending_buf[St.d_buf+St.last_lit*2]=Ne>>>8&255,St.pending_buf[St.d_buf+St.last_lit*2+1]=Ne&255,St.pending_buf[St.l_buf+St.last_lit]=Xe&255,St.last_lit++,Ne===0?St.dyn_ltree[Xe*2]++:(St.matches++,Ne--,St.dyn_ltree[(Ct[Xe]+S+1)*2]++,St.dyn_dtree[Se(Ne)*2]++),St.last_lit===St.lit_bufsize-1}return Sf._tr_init=je,Sf._tr_stored_block=mi,Sf._tr_flush_block=nn,Sf._tr_tally=_r,Sf._tr_align=Mi,Sf}var kC,Rk;function Dk(){if(Rk)return kC;Rk=1;function e(t,i,n,r){for(var s=t&65535|0,o=t>>>16&65535|0,l=0;n!==0;){l=n>2e3?2e3:n,n-=l;do s=s+i[r++]|0,o=o+s|0;while(--l);s%=65521,o%=65521}return s|o<<16|0}return kC=e,kC}var NC,Ok;function Lk(){if(Ok)return NC;Ok=1;function e(){for(var n,r=[],s=0;s<256;s++){n=s;for(var o=0;o<8;o++)n=n&1?3988292384^n>>>1:n>>>1;r[s]=n}return r}var t=e();function i(n,r,s,o){var l=t,h=o+s;n^=-1;for(var A=o;A<h;A++)n=n>>>8^l[(n^r[A])&255];return n^-1}return NC=i,NC}var Fk,kk;function UC(){return kk||(kk=1,Fk={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}),Fk}var Nk;function Ext(){if(Nk)return Pl;Nk=1;var e=_h(),t=Cxt(),i=Dk(),n=Lk(),r=UC(),s=0,o=1,l=3,h=4,A=5,v=0,C=1,S=-2,L=-3,N=-5,G=-1,W=1,j=2,q=3,Z=4,K=0,ft=2,rt=8,Lt=9,Vt=15,At=8,at=29,kt=256,X=kt+1+at,ht=30,Mt=19,pe=2*X+1,Ct=15,Dt=3,Gt=258,te=Gt+Dt+1,re=32,ae=42,he=69,Pe=73,Se=91,se=103,fi=113,Ze=666,Ye=1,ze=2,pi=3,sn=4,Ii=3;function _i(H,ve){return H.msg=r[ve],ve}function Fn(H){return(H<<1)-(H>4?9:0)}function Ai(H){for(var ve=H.length;--ve>=0;)H[ve]=0}function vi(H){var ve=H.state,Te=ve.pending;Te>H.avail_out&&(Te=H.avail_out),Te!==0&&(e.arraySet(H.output,ve.pending_buf,ve.pending_out,Te,H.next_out),H.next_out+=Te,ve.pending_out+=Te,H.total_out+=Te,H.avail_out-=Te,ve.pending-=Te,ve.pending===0&&(ve.pending_out=0))}function cn(H,ve){t._tr_flush_block(H,H.block_start>=0?H.block_start:-1,H.strstart-H.block_start,ve),H.block_start=H.strstart,vi(H.strm)}function Ri(H,ve){H.pending_buf[H.pending++]=ve}function ur(H,ve){H.pending_buf[H.pending++]=ve>>>8&255,H.pending_buf[H.pending++]=ve&255}function $n(H,ve,Te,wt){var Kt=H.avail_in;return Kt>wt&&(Kt=wt),Kt===0?0:(H.avail_in-=Kt,e.arraySet(ve,H.input,H.next_in,Kt,Te),H.state.wrap===1?H.adler=i(H.adler,ve,Kt,Te):H.state.wrap===2&&(H.adler=n(H.adler,ve,Kt,Te)),H.next_in+=Kt,H.total_in+=Kt,Kt)}function gn(H,ve){var Te=H.max_chain_length,wt=H.strstart,Kt,ce,Y=H.prev_length,nt=H.nice_match,ct=H.strstart>H.w_size-te?H.strstart-(H.w_size-te):0,vt=H.window,Ft=H.w_mask,pt=H.prev,bt=H.strstart+Gt,lt=vt[wt+Y-1],Et=vt[wt+Y];H.prev_length>=H.good_match&&(Te>>=2),nt>H.lookahead&&(nt=H.lookahead);do if(Kt=ve,!(vt[Kt+Y]!==Et||vt[Kt+Y-1]!==lt||vt[Kt]!==vt[wt]||vt[++Kt]!==vt[wt+1])){wt+=2,Kt++;do;while(vt[++wt]===vt[++Kt]&&vt[++wt]===vt[++Kt]&&vt[++wt]===vt[++Kt]&&vt[++wt]===vt[++Kt]&&vt[++wt]===vt[++Kt]&&vt[++wt]===vt[++Kt]&&vt[++wt]===vt[++Kt]&&vt[++wt]===vt[++Kt]&&wt<bt);if(ce=Gt-(bt-wt),wt=bt-Gt,ce>Y){if(H.match_start=ve,Y=ce,ce>=nt)break;lt=vt[wt+Y-1],Et=vt[wt+Y]}}while((ve=pt[ve&Ft])>ct&&--Te!==0);return Y<=H.lookahead?Y:H.lookahead}function rr(H){var ve=H.w_size,Te,wt,Kt,ce,Y;do{if(ce=H.window_size-H.lookahead-H.strstart,H.strstart>=ve+(ve-te)){e.arraySet(H.window,H.window,ve,ve,0),H.match_start-=ve,H.strstart-=ve,H.block_start-=ve,wt=H.hash_size,Te=wt;do Kt=H.head[--Te],H.head[Te]=Kt>=ve?Kt-ve:0;while(--wt);wt=ve,Te=wt;do Kt=H.prev[--Te],H.prev[Te]=Kt>=ve?Kt-ve:0;while(--wt);ce+=ve}if(H.strm.avail_in===0)break;if(wt=$n(H.strm,H.window,H.strstart+H.lookahead,ce),H.lookahead+=wt,H.lookahead+H.insert>=Dt)for(Y=H.strstart-H.insert,H.ins_h=H.window[Y],H.ins_h=(H.ins_h<<H.hash_shift^H.window[Y+1])&H.hash_mask;H.insert&&(H.ins_h=(H.ins_h<<H.hash_shift^H.window[Y+Dt-1])&H.hash_mask,H.prev[Y&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=Y,Y++,H.insert--,!(H.lookahead+H.insert<Dt)););}while(H.lookahead<te&&H.strm.avail_in!==0)}function Wn(H,ve){var Te=65535;for(Te>H.pending_buf_size-5&&(Te=H.pending_buf_size-5);;){if(H.lookahead<=1){if(rr(H),H.lookahead===0&&ve===s)return Ye;if(H.lookahead===0)break}H.strstart+=H.lookahead,H.lookahead=0;var wt=H.block_start+Te;if((H.strstart===0||H.strstart>=wt)&&(H.lookahead=H.strstart-wt,H.strstart=wt,cn(H,!1),H.strm.avail_out===0)||H.strstart-H.block_start>=H.w_size-te&&(cn(H,!1),H.strm.avail_out===0))return Ye}return H.insert=0,ve===h?(cn(H,!0),H.strm.avail_out===0?pi:sn):(H.strstart>H.block_start&&(cn(H,!1),H.strm.avail_out),Ye)}function Tn(H,ve){for(var Te,wt;;){if(H.lookahead<te){if(rr(H),H.lookahead<te&&ve===s)return Ye;if(H.lookahead===0)break}if(Te=0,H.lookahead>=Dt&&(H.ins_h=(H.ins_h<<H.hash_shift^H.window[H.strstart+Dt-1])&H.hash_mask,Te=H.prev[H.strstart&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=H.strstart),Te!==0&&H.strstart-Te<=H.w_size-te&&(H.match_length=gn(H,Te)),H.match_length>=Dt)if(wt=t._tr_tally(H,H.strstart-H.match_start,H.match_length-Dt),H.lookahead-=H.match_length,H.match_length<=H.max_lazy_match&&H.lookahead>=Dt){H.match_length--;do H.strstart++,H.ins_h=(H.ins_h<<H.hash_shift^H.window[H.strstart+Dt-1])&H.hash_mask,Te=H.prev[H.strstart&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=H.strstart;while(--H.match_length!==0);H.strstart++}else H.strstart+=H.match_length,H.match_length=0,H.ins_h=H.window[H.strstart],H.ins_h=(H.ins_h<<H.hash_shift^H.window[H.strstart+1])&H.hash_mask;else wt=t._tr_tally(H,0,H.window[H.strstart]),H.lookahead--,H.strstart++;if(wt&&(cn(H,!1),H.strm.avail_out===0))return Ye}return H.insert=H.strstart<Dt-1?H.strstart:Dt-1,ve===h?(cn(H,!0),H.strm.avail_out===0?pi:sn):H.last_lit&&(cn(H,!1),H.strm.avail_out===0)?Ye:ze}function tr(H,ve){for(var Te,wt,Kt;;){if(H.lookahead<te){if(rr(H),H.lookahead<te&&ve===s)return Ye;if(H.lookahead===0)break}if(Te=0,H.lookahead>=Dt&&(H.ins_h=(H.ins_h<<H.hash_shift^H.window[H.strstart+Dt-1])&H.hash_mask,Te=H.prev[H.strstart&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=H.strstart),H.prev_length=H.match_length,H.prev_match=H.match_start,H.match_length=Dt-1,Te!==0&&H.prev_length<H.max_lazy_match&&H.strstart-Te<=H.w_size-te&&(H.match_length=gn(H,Te),H.match_length<=5&&(H.strategy===W||H.match_length===Dt&&H.strstart-H.match_start>4096)&&(H.match_length=Dt-1)),H.prev_length>=Dt&&H.match_length<=H.prev_length){Kt=H.strstart+H.lookahead-Dt,wt=t._tr_tally(H,H.strstart-1-H.prev_match,H.prev_length-Dt),H.lookahead-=H.prev_length-1,H.prev_length-=2;do++H.strstart<=Kt&&(H.ins_h=(H.ins_h<<H.hash_shift^H.window[H.strstart+Dt-1])&H.hash_mask,Te=H.prev[H.strstart&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=H.strstart);while(--H.prev_length!==0);if(H.match_available=0,H.match_length=Dt-1,H.strstart++,wt&&(cn(H,!1),H.strm.avail_out===0))return Ye}else if(H.match_available){if(wt=t._tr_tally(H,0,H.window[H.strstart-1]),wt&&cn(H,!1),H.strstart++,H.lookahead--,H.strm.avail_out===0)return Ye}else H.match_available=1,H.strstart++,H.lookahead--}return H.match_available&&(wt=t._tr_tally(H,0,H.window[H.strstart-1]),H.match_available=0),H.insert=H.strstart<Dt-1?H.strstart:Dt-1,ve===h?(cn(H,!0),H.strm.avail_out===0?pi:sn):H.last_lit&&(cn(H,!1),H.strm.avail_out===0)?Ye:ze}function je(H,ve){for(var Te,wt,Kt,ce,Y=H.window;;){if(H.lookahead<=Gt){if(rr(H),H.lookahead<=Gt&&ve===s)return Ye;if(H.lookahead===0)break}if(H.match_length=0,H.lookahead>=Dt&&H.strstart>0&&(Kt=H.strstart-1,wt=Y[Kt],wt===Y[++Kt]&&wt===Y[++Kt]&&wt===Y[++Kt])){ce=H.strstart+Gt;do;while(wt===Y[++Kt]&&wt===Y[++Kt]&&wt===Y[++Kt]&&wt===Y[++Kt]&&wt===Y[++Kt]&&wt===Y[++Kt]&&wt===Y[++Kt]&&wt===Y[++Kt]&&Kt<ce);H.match_length=Gt-(ce-Kt),H.match_length>H.lookahead&&(H.match_length=H.lookahead)}if(H.match_length>=Dt?(Te=t._tr_tally(H,1,H.match_length-Dt),H.lookahead-=H.match_length,H.strstart+=H.match_length,H.match_length=0):(Te=t._tr_tally(H,0,H.window[H.strstart]),H.lookahead--,H.strstart++),Te&&(cn(H,!1),H.strm.avail_out===0))return Ye}return H.insert=0,ve===h?(cn(H,!0),H.strm.avail_out===0?pi:sn):H.last_lit&&(cn(H,!1),H.strm.avail_out===0)?Ye:ze}function mi(H,ve){for(var Te;;){if(H.lookahead===0&&(rr(H),H.lookahead===0)){if(ve===s)return Ye;break}if(H.match_length=0,Te=t._tr_tally(H,0,H.window[H.strstart]),H.lookahead--,H.strstart++,Te&&(cn(H,!1),H.strm.avail_out===0))return Ye}return H.insert=0,ve===h?(cn(H,!0),H.strm.avail_out===0?pi:sn):H.last_lit&&(cn(H,!1),H.strm.avail_out===0)?Ye:ze}function Mi(H,ve,Te,wt,Kt){this.good_length=H,this.max_lazy=ve,this.nice_length=Te,this.max_chain=wt,this.func=Kt}var nn;nn=[new Mi(0,0,0,0,Wn),new Mi(4,4,8,4,Tn),new Mi(4,5,16,8,Tn),new Mi(4,6,32,32,Tn),new Mi(4,4,16,16,tr),new Mi(8,16,32,32,tr),new Mi(8,16,128,128,tr),new Mi(8,32,128,256,tr),new Mi(32,128,258,1024,tr),new Mi(32,258,258,4096,tr)];function _r(H){H.window_size=2*H.w_size,Ai(H.head),H.max_lazy_match=nn[H.level].max_lazy,H.good_match=nn[H.level].good_length,H.nice_match=nn[H.level].nice_length,H.max_chain_length=nn[H.level].max_chain,H.strstart=0,H.block_start=0,H.lookahead=0,H.insert=0,H.match_length=H.prev_length=Dt-1,H.match_available=0,H.ins_h=0}function St(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=rt,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new e.Buf16(pe*2),this.dyn_dtree=new e.Buf16((2*ht+1)*2),this.bl_tree=new e.Buf16((2*Mt+1)*2),Ai(this.dyn_ltree),Ai(this.dyn_dtree),Ai(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new e.Buf16(Ct+1),this.heap=new e.Buf16(2*X+1),Ai(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new e.Buf16(2*X+1),Ai(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ne(H){var ve;return!H||!H.state?_i(H,S):(H.total_in=H.total_out=0,H.data_type=ft,ve=H.state,ve.pending=0,ve.pending_out=0,ve.wrap<0&&(ve.wrap=-ve.wrap),ve.status=ve.wrap?ae:fi,H.adler=ve.wrap===2?0:1,ve.last_flush=s,t._tr_init(ve),v)}function Xe(H){var ve=Ne(H);return ve===v&&_r(H.state),ve}function ci(H,ve){return!H||!H.state||H.state.wrap!==2?S:(H.state.gzhead=ve,v)}function qt(H,ve,Te,wt,Kt,ce){if(!H)return S;var Y=1;if(ve===G&&(ve=6),wt<0?(Y=0,wt=-wt):wt>15&&(Y=2,wt-=16),Kt<1||Kt>Lt||Te!==rt||wt<8||wt>15||ve<0||ve>9||ce<0||ce>Z)return _i(H,S);wt===8&&(wt=9);var nt=new St;return H.state=nt,nt.strm=H,nt.wrap=Y,nt.gzhead=null,nt.w_bits=wt,nt.w_size=1<<nt.w_bits,nt.w_mask=nt.w_size-1,nt.hash_bits=Kt+7,nt.hash_size=1<<nt.hash_bits,nt.hash_mask=nt.hash_size-1,nt.hash_shift=~~((nt.hash_bits+Dt-1)/Dt),nt.window=new e.Buf8(nt.w_size*2),nt.head=new e.Buf16(nt.hash_size),nt.prev=new e.Buf16(nt.w_size),nt.lit_bufsize=1<<Kt+6,nt.pending_buf_size=nt.lit_bufsize*4,nt.pending_buf=new e.Buf8(nt.pending_buf_size),nt.d_buf=1*nt.lit_bufsize,nt.l_buf=3*nt.lit_bufsize,nt.level=ve,nt.strategy=ce,nt.method=Te,Xe(H)}function De(H,ve){return qt(H,ve,rt,Vt,At,K)}function mt(H,ve){var Te,wt,Kt,ce;if(!H||!H.state||ve>A||ve<0)return H?_i(H,S):S;if(wt=H.state,!H.output||!H.input&&H.avail_in!==0||wt.status===Ze&&ve!==h)return _i(H,H.avail_out===0?N:S);if(wt.strm=H,Te=wt.last_flush,wt.last_flush=ve,wt.status===ae)if(wt.wrap===2)H.adler=0,Ri(wt,31),Ri(wt,139),Ri(wt,8),wt.gzhead?(Ri(wt,(wt.gzhead.text?1:0)+(wt.gzhead.hcrc?2:0)+(wt.gzhead.extra?4:0)+(wt.gzhead.name?8:0)+(wt.gzhead.comment?16:0)),Ri(wt,wt.gzhead.time&255),Ri(wt,wt.gzhead.time>>8&255),Ri(wt,wt.gzhead.time>>16&255),Ri(wt,wt.gzhead.time>>24&255),Ri(wt,wt.level===9?2:wt.strategy>=j||wt.level<2?4:0),Ri(wt,wt.gzhead.os&255),wt.gzhead.extra&&wt.gzhead.extra.length&&(Ri(wt,wt.gzhead.extra.length&255),Ri(wt,wt.gzhead.extra.length>>8&255)),wt.gzhead.hcrc&&(H.adler=n(H.adler,wt.pending_buf,wt.pending,0)),wt.gzindex=0,wt.status=he):(Ri(wt,0),Ri(wt,0),Ri(wt,0),Ri(wt,0),Ri(wt,0),Ri(wt,wt.level===9?2:wt.strategy>=j||wt.level<2?4:0),Ri(wt,Ii),wt.status=fi);else{var Y=rt+(wt.w_bits-8<<4)<<8,nt=-1;wt.strategy>=j||wt.level<2?nt=0:wt.level<6?nt=1:wt.level===6?nt=2:nt=3,Y|=nt<<6,wt.strstart!==0&&(Y|=re),Y+=31-Y%31,wt.status=fi,ur(wt,Y),wt.strstart!==0&&(ur(wt,H.adler>>>16),ur(wt,H.adler&65535)),H.adler=1}if(wt.status===he)if(wt.gzhead.extra){for(Kt=wt.pending;wt.gzindex<(wt.gzhead.extra.length&65535)&&!(wt.pending===wt.pending_buf_size&&(wt.gzhead.hcrc&&wt.pending>Kt&&(H.adler=n(H.adler,wt.pending_buf,wt.pending-Kt,Kt)),vi(H),Kt=wt.pending,wt.pending===wt.pending_buf_size));)Ri(wt,wt.gzhead.extra[wt.gzindex]&255),wt.gzindex++;wt.gzhead.hcrc&&wt.pending>Kt&&(H.adler=n(H.adler,wt.pending_buf,wt.pending-Kt,Kt)),wt.gzindex===wt.gzhead.extra.length&&(wt.gzindex=0,wt.status=Pe)}else wt.status=Pe;if(wt.status===Pe)if(wt.gzhead.name){Kt=wt.pending;do{if(wt.pending===wt.pending_buf_size&&(wt.gzhead.hcrc&&wt.pending>Kt&&(H.adler=n(H.adler,wt.pending_buf,wt.pending-Kt,Kt)),vi(H),Kt=wt.pending,wt.pending===wt.pending_buf_size)){ce=1;break}wt.gzindex<wt.gzhead.name.length?ce=wt.gzhead.name.charCodeAt(wt.gzindex++)&255:ce=0,Ri(wt,ce)}while(ce!==0);wt.gzhead.hcrc&&wt.pending>Kt&&(H.adler=n(H.adler,wt.pending_buf,wt.pending-Kt,Kt)),ce===0&&(wt.gzindex=0,wt.status=Se)}else wt.status=Se;if(wt.status===Se)if(wt.gzhead.comment){Kt=wt.pending;do{if(wt.pending===wt.pending_buf_size&&(wt.gzhead.hcrc&&wt.pending>Kt&&(H.adler=n(H.adler,wt.pending_buf,wt.pending-Kt,Kt)),vi(H),Kt=wt.pending,wt.pending===wt.pending_buf_size)){ce=1;break}wt.gzindex<wt.gzhead.comment.length?ce=wt.gzhead.comment.charCodeAt(wt.gzindex++)&255:ce=0,Ri(wt,ce)}while(ce!==0);wt.gzhead.hcrc&&wt.pending>Kt&&(H.adler=n(H.adler,wt.pending_buf,wt.pending-Kt,Kt)),ce===0&&(wt.status=se)}else wt.status=se;if(wt.status===se&&(wt.gzhead.hcrc?(wt.pending+2>wt.pending_buf_size&&vi(H),wt.pending+2<=wt.pending_buf_size&&(Ri(wt,H.adler&255),Ri(wt,H.adler>>8&255),H.adler=0,wt.status=fi)):wt.status=fi),wt.pending!==0){if(vi(H),H.avail_out===0)return wt.last_flush=-1,v}else if(H.avail_in===0&&Fn(ve)<=Fn(Te)&&ve!==h)return _i(H,N);if(wt.status===Ze&&H.avail_in!==0)return _i(H,N);if(H.avail_in!==0||wt.lookahead!==0||ve!==s&&wt.status!==Ze){var ct=wt.strategy===j?mi(wt,ve):wt.strategy===q?je(wt,ve):nn[wt.level].func(wt,ve);if((ct===pi||ct===sn)&&(wt.status=Ze),ct===Ye||ct===pi)return H.avail_out===0&&(wt.last_flush=-1),v;if(ct===ze&&(ve===o?t._tr_align(wt):ve!==A&&(t._tr_stored_block(wt,0,0,!1),ve===l&&(Ai(wt.head),wt.lookahead===0&&(wt.strstart=0,wt.block_start=0,wt.insert=0))),vi(H),H.avail_out===0))return wt.last_flush=-1,v}return ve!==h?v:wt.wrap<=0?C:(wt.wrap===2?(Ri(wt,H.adler&255),Ri(wt,H.adler>>8&255),Ri(wt,H.adler>>16&255),Ri(wt,H.adler>>24&255),Ri(wt,H.total_in&255),Ri(wt,H.total_in>>8&255),Ri(wt,H.total_in>>16&255),Ri(wt,H.total_in>>24&255)):(ur(wt,H.adler>>>16),ur(wt,H.adler&65535)),vi(H),wt.wrap>0&&(wt.wrap=-wt.wrap),wt.pending!==0?v:C)}function Ve(H){var ve;return!H||!H.state?S:(ve=H.state.status,ve!==ae&&ve!==he&&ve!==Pe&&ve!==Se&&ve!==se&&ve!==fi&&ve!==Ze?_i(H,S):(H.state=null,ve===fi?_i(H,L):v))}function Ce(H,ve){var Te=ve.length,wt,Kt,ce,Y,nt,ct,vt,Ft;if(!H||!H.state||(wt=H.state,Y=wt.wrap,Y===2||Y===1&&wt.status!==ae||wt.lookahead))return S;for(Y===1&&(H.adler=i(H.adler,ve,Te,0)),wt.wrap=0,Te>=wt.w_size&&(Y===0&&(Ai(wt.head),wt.strstart=0,wt.block_start=0,wt.insert=0),Ft=new e.Buf8(wt.w_size),e.arraySet(Ft,ve,Te-wt.w_size,wt.w_size,0),ve=Ft,Te=wt.w_size),nt=H.avail_in,ct=H.next_in,vt=H.input,H.avail_in=Te,H.next_in=0,H.input=ve,rr(wt);wt.lookahead>=Dt;){Kt=wt.strstart,ce=wt.lookahead-(Dt-1);do wt.ins_h=(wt.ins_h<<wt.hash_shift^wt.window[Kt+Dt-1])&wt.hash_mask,wt.prev[Kt&wt.w_mask]=wt.head[wt.ins_h],wt.head[wt.ins_h]=Kt,Kt++;while(--ce);wt.strstart=Kt,wt.lookahead=Dt-1,rr(wt)}return wt.strstart+=wt.lookahead,wt.block_start=wt.strstart,wt.insert=wt.lookahead,wt.lookahead=0,wt.match_length=wt.prev_length=Dt-1,wt.match_available=0,H.next_in=ct,H.input=vt,H.avail_in=nt,wt.wrap=Y,v}return Pl.deflateInit=De,Pl.deflateInit2=qt,Pl.deflateReset=Xe,Pl.deflateResetKeep=Ne,Pl.deflateSetHeader=ci,Pl.deflate=mt,Pl.deflateEnd=Ve,Pl.deflateSetDictionary=Ce,Pl.deflateInfo="pako deflate (from Nodeca project)",Pl}var If={},Uk;function Gk(){if(Uk)return If;Uk=1;var e=_h(),t=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch{t=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{i=!1}for(var n=new e.Buf8(256),r=0;r<256;r++)n[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;n[254]=n[254]=1,If.string2buf=function(o){var l,h,A,v,C,S=o.length,L=0;for(v=0;v<S;v++)h=o.charCodeAt(v),(h&64512)===55296&&v+1<S&&(A=o.charCodeAt(v+1),(A&64512)===56320&&(h=65536+(h-55296<<10)+(A-56320),v++)),L+=h<128?1:h<2048?2:h<65536?3:4;for(l=new e.Buf8(L),C=0,v=0;C<L;v++)h=o.charCodeAt(v),(h&64512)===55296&&v+1<S&&(A=o.charCodeAt(v+1),(A&64512)===56320&&(h=65536+(h-55296<<10)+(A-56320),v++)),h<128?l[C++]=h:h<2048?(l[C++]=192|h>>>6,l[C++]=128|h&63):h<65536?(l[C++]=224|h>>>12,l[C++]=128|h>>>6&63,l[C++]=128|h&63):(l[C++]=240|h>>>18,l[C++]=128|h>>>12&63,l[C++]=128|h>>>6&63,l[C++]=128|h&63);return l};function s(o,l){if(l<65534&&(o.subarray&&i||!o.subarray&&t))return String.fromCharCode.apply(null,e.shrinkBuf(o,l));for(var h="",A=0;A<l;A++)h+=String.fromCharCode(o[A]);return h}return If.buf2binstring=function(o){return s(o,o.length)},If.binstring2buf=function(o){for(var l=new e.Buf8(o.length),h=0,A=l.length;h<A;h++)l[h]=o.charCodeAt(h);return l},If.buf2string=function(o,l){var h,A,v,C,S=l||o.length,L=new Array(S*2);for(A=0,h=0;h<S;){if(v=o[h++],v<128){L[A++]=v;continue}if(C=n[v],C>4){L[A++]=65533,h+=C-1;continue}for(v&=C===2?31:C===3?15:7;C>1&&h<S;)v=v<<6|o[h++]&63,C--;if(C>1){L[A++]=65533;continue}v<65536?L[A++]=v:(v-=65536,L[A++]=55296|v>>10&1023,L[A++]=56320|v&1023)}return s(L,A)},If.utf8border=function(o,l){var h;for(l=l||o.length,l>o.length&&(l=o.length),h=l-1;h>=0&&(o[h]&192)===128;)h--;return h<0||h===0?l:h+n[o[h]]>l?h:l},If}var GC,zk;function Vk(){if(zk)return GC;zk=1;function e(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}return GC=e,GC}var jk;function Bxt(){if(jk)return zp;jk=1;var e=Ext(),t=_h(),i=Gk(),n=UC(),r=Vk(),s=Object.prototype.toString,o=0,l=4,h=0,A=1,v=2,C=-1,S=0,L=8;function N(q){if(!(this instanceof N))return new N(q);this.options=t.assign({level:C,method:L,chunkSize:16384,windowBits:15,memLevel:8,strategy:S,to:""},q||{});var Z=this.options;Z.raw&&Z.windowBits>0?Z.windowBits=-Z.windowBits:Z.gzip&&Z.windowBits>0&&Z.windowBits<16&&(Z.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;var K=e.deflateInit2(this.strm,Z.level,Z.method,Z.windowBits,Z.memLevel,Z.strategy);if(K!==h)throw new Error(n[K]);if(Z.header&&e.deflateSetHeader(this.strm,Z.header),Z.dictionary){var ft;if(typeof Z.dictionary=="string"?ft=i.string2buf(Z.dictionary):s.call(Z.dictionary)==="[object ArrayBuffer]"?ft=new Uint8Array(Z.dictionary):ft=Z.dictionary,K=e.deflateSetDictionary(this.strm,ft),K!==h)throw new Error(n[K]);this._dict_set=!0}}N.prototype.push=function(q,Z){var K=this.strm,ft=this.options.chunkSize,rt,Lt;if(this.ended)return!1;Lt=Z===~~Z?Z:Z===!0?l:o,typeof q=="string"?K.input=i.string2buf(q):s.call(q)==="[object ArrayBuffer]"?K.input=new Uint8Array(q):K.input=q,K.next_in=0,K.avail_in=K.input.length;do{if(K.avail_out===0&&(K.output=new t.Buf8(ft),K.next_out=0,K.avail_out=ft),rt=e.deflate(K,Lt),rt!==A&&rt!==h)return this.onEnd(rt),this.ended=!0,!1;(K.avail_out===0||K.avail_in===0&&(Lt===l||Lt===v))&&(this.options.to==="string"?this.onData(i.buf2binstring(t.shrinkBuf(K.output,K.next_out))):this.onData(t.shrinkBuf(K.output,K.next_out)))}while((K.avail_in>0||K.avail_out===0)&&rt!==A);return Lt===l?(rt=e.deflateEnd(this.strm),this.onEnd(rt),this.ended=!0,rt===h):(Lt===v&&(this.onEnd(h),K.avail_out=0),!0)},N.prototype.onData=function(q){this.chunks.push(q)},N.prototype.onEnd=function(q){q===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=q,this.msg=this.strm.msg};function G(q,Z){var K=new N(Z);if(K.push(q,!0),K.err)throw K.msg||n[K.err];return K.result}function W(q,Z){return Z=Z||{},Z.raw=!0,G(q,Z)}function j(q,Z){return Z=Z||{},Z.gzip=!0,G(q,Z)}return zp.Deflate=N,zp.deflate=G,zp.deflateRaw=W,zp.gzip=j,zp}var Vp={},Ha={},zC,Hk;function Txt(){if(Hk)return zC;Hk=1;var e=30,t=12;return zC=function(i,n){var r,s,o,l,h,A,v,C,S,L,N,G,W,j,q,Z,K,ft,rt,Lt,Vt,At,at,kt,X;r=i.state,s=i.next_in,kt=i.input,o=s+(i.avail_in-5),l=i.next_out,X=i.output,h=l-(n-i.avail_out),A=l+(i.avail_out-257),v=r.dmax,C=r.wsize,S=r.whave,L=r.wnext,N=r.window,G=r.hold,W=r.bits,j=r.lencode,q=r.distcode,Z=(1<<r.lenbits)-1,K=(1<<r.distbits)-1;t:do{W<15&&(G+=kt[s++]<<W,W+=8,G+=kt[s++]<<W,W+=8),ft=j[G&Z];e:for(;;){if(rt=ft>>>24,G>>>=rt,W-=rt,rt=ft>>>16&255,rt===0)X[l++]=ft&65535;else if(rt&16){Lt=ft&65535,rt&=15,rt&&(W<rt&&(G+=kt[s++]<<W,W+=8),Lt+=G&(1<<rt)-1,G>>>=rt,W-=rt),W<15&&(G+=kt[s++]<<W,W+=8,G+=kt[s++]<<W,W+=8),ft=q[G&K];i:for(;;){if(rt=ft>>>24,G>>>=rt,W-=rt,rt=ft>>>16&255,rt&16){if(Vt=ft&65535,rt&=15,W<rt&&(G+=kt[s++]<<W,W+=8,W<rt&&(G+=kt[s++]<<W,W+=8)),Vt+=G&(1<<rt)-1,Vt>v){i.msg="invalid distance too far back",r.mode=e;break t}if(G>>>=rt,W-=rt,rt=l-h,Vt>rt){if(rt=Vt-rt,rt>S&&r.sane){i.msg="invalid distance too far back",r.mode=e;break t}if(At=0,at=N,L===0){if(At+=C-rt,rt<Lt){Lt-=rt;do X[l++]=N[At++];while(--rt);At=l-Vt,at=X}}else if(L<rt){if(At+=C+L-rt,rt-=L,rt<Lt){Lt-=rt;do X[l++]=N[At++];while(--rt);if(At=0,L<Lt){rt=L,Lt-=rt;do X[l++]=N[At++];while(--rt);At=l-Vt,at=X}}}else if(At+=L-rt,rt<Lt){Lt-=rt;do X[l++]=N[At++];while(--rt);At=l-Vt,at=X}for(;Lt>2;)X[l++]=at[At++],X[l++]=at[At++],X[l++]=at[At++],Lt-=3;Lt&&(X[l++]=at[At++],Lt>1&&(X[l++]=at[At++]))}else{At=l-Vt;do X[l++]=X[At++],X[l++]=X[At++],X[l++]=X[At++],Lt-=3;while(Lt>2);Lt&&(X[l++]=X[At++],Lt>1&&(X[l++]=X[At++]))}}else if((rt&64)===0){ft=q[(ft&65535)+(G&(1<<rt)-1)];continue i}else{i.msg="invalid distance code",r.mode=e;break t}break}}else if((rt&64)===0){ft=j[(ft&65535)+(G&(1<<rt)-1)];continue e}else if(rt&32){r.mode=t;break t}else{i.msg="invalid literal/length code",r.mode=e;break t}break}}while(s<o&&l<A);Lt=W>>3,s-=Lt,W-=Lt<<3,G&=(1<<W)-1,i.next_in=s,i.next_out=l,i.avail_in=s<o?5+(o-s):5-(s-o),i.avail_out=l<A?257+(A-l):257-(l-A),r.hold=G,r.bits=W},zC}var VC,Wk;function Sxt(){if(Wk)return VC;Wk=1;var e=_h(),t=15,i=852,n=592,r=0,s=1,o=2,l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],h=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],A=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],v=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];return VC=function(C,S,L,N,G,W,j,q){var Z=q.bits,K=0,ft=0,rt=0,Lt=0,Vt=0,At=0,at=0,kt=0,X=0,ht=0,Mt,pe,Ct,Dt,Gt,te=null,re=0,ae,he=new e.Buf16(t+1),Pe=new e.Buf16(t+1),Se=null,se=0,fi,Ze,Ye;for(K=0;K<=t;K++)he[K]=0;for(ft=0;ft<N;ft++)he[S[L+ft]]++;for(Vt=Z,Lt=t;Lt>=1&&he[Lt]===0;Lt--);if(Vt>Lt&&(Vt=Lt),Lt===0)return G[W++]=1<<24|64<<16|0,G[W++]=1<<24|64<<16|0,q.bits=1,0;for(rt=1;rt<Lt&&he[rt]===0;rt++);for(Vt<rt&&(Vt=rt),kt=1,K=1;K<=t;K++)if(kt<<=1,kt-=he[K],kt<0)return-1;if(kt>0&&(C===r||Lt!==1))return-1;for(Pe[1]=0,K=1;K<t;K++)Pe[K+1]=Pe[K]+he[K];for(ft=0;ft<N;ft++)S[L+ft]!==0&&(j[Pe[S[L+ft]]++]=ft);if(C===r?(te=Se=j,ae=19):C===s?(te=l,re-=257,Se=h,se-=257,ae=256):(te=A,Se=v,ae=-1),ht=0,ft=0,K=rt,Gt=W,At=Vt,at=0,Ct=-1,X=1<<Vt,Dt=X-1,C===s&&X>i||C===o&&X>n)return 1;for(;;){fi=K-at,j[ft]<ae?(Ze=0,Ye=j[ft]):j[ft]>ae?(Ze=Se[se+j[ft]],Ye=te[re+j[ft]]):(Ze=96,Ye=0),Mt=1<<K-at,pe=1<<At,rt=pe;do pe-=Mt,G[Gt+(ht>>at)+pe]=fi<<24|Ze<<16|Ye|0;while(pe!==0);for(Mt=1<<K-1;ht&Mt;)Mt>>=1;if(Mt!==0?(ht&=Mt-1,ht+=Mt):ht=0,ft++,--he[K]===0){if(K===Lt)break;K=S[L+j[ft]]}if(K>Vt&&(ht&Dt)!==Ct){for(at===0&&(at=Vt),Gt+=rt,At=K-at,kt=1<<At;At+at<Lt&&(kt-=he[At+at],!(kt<=0));)At++,kt<<=1;if(X+=1<<At,C===s&&X>i||C===o&&X>n)return 1;Ct=ht&Dt,G[Ct]=Vt<<24|At<<16|Gt-W|0}}return ht!==0&&(G[Gt+ht]=K-at<<24|64<<16|0),q.bits=Vt,0},VC}var Jk;function Ixt(){if(Jk)return Ha;Jk=1;var e=_h(),t=Dk(),i=Lk(),n=Txt(),r=Sxt(),s=0,o=1,l=2,h=4,A=5,v=6,C=0,S=1,L=2,N=-2,G=-3,W=-4,j=-5,q=8,Z=1,K=2,ft=3,rt=4,Lt=5,Vt=6,At=7,at=8,kt=9,X=10,ht=11,Mt=12,pe=13,Ct=14,Dt=15,Gt=16,te=17,re=18,ae=19,he=20,Pe=21,Se=22,se=23,fi=24,Ze=25,Ye=26,ze=27,pi=28,sn=29,Ii=30,_i=31,Fn=32,Ai=852,vi=592,cn=15,Ri=cn;function ur(qt){return(qt>>>24&255)+(qt>>>8&65280)+((qt&65280)<<8)+((qt&255)<<24)}function $n(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new e.Buf16(320),this.work=new e.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function gn(qt){var De;return!qt||!qt.state?N:(De=qt.state,qt.total_in=qt.total_out=De.total=0,qt.msg="",De.wrap&&(qt.adler=De.wrap&1),De.mode=Z,De.last=0,De.havedict=0,De.dmax=32768,De.head=null,De.hold=0,De.bits=0,De.lencode=De.lendyn=new e.Buf32(Ai),De.distcode=De.distdyn=new e.Buf32(vi),De.sane=1,De.back=-1,C)}function rr(qt){var De;return!qt||!qt.state?N:(De=qt.state,De.wsize=0,De.whave=0,De.wnext=0,gn(qt))}function Wn(qt,De){var mt,Ve;return!qt||!qt.state||(Ve=qt.state,De<0?(mt=0,De=-De):(mt=(De>>4)+1,De<48&&(De&=15)),De&&(De<8||De>15))?N:(Ve.window!==null&&Ve.wbits!==De&&(Ve.window=null),Ve.wrap=mt,Ve.wbits=De,rr(qt))}function Tn(qt,De){var mt,Ve;return qt?(Ve=new $n,qt.state=Ve,Ve.window=null,mt=Wn(qt,De),mt!==C&&(qt.state=null),mt):N}function tr(qt){return Tn(qt,Ri)}var je=!0,mi,Mi;function nn(qt){if(je){var De;for(mi=new e.Buf32(512),Mi=new e.Buf32(32),De=0;De<144;)qt.lens[De++]=8;for(;De<256;)qt.lens[De++]=9;for(;De<280;)qt.lens[De++]=7;for(;De<288;)qt.lens[De++]=8;for(r(o,qt.lens,0,288,mi,0,qt.work,{bits:9}),De=0;De<32;)qt.lens[De++]=5;r(l,qt.lens,0,32,Mi,0,qt.work,{bits:5}),je=!1}qt.lencode=mi,qt.lenbits=9,qt.distcode=Mi,qt.distbits=5}function _r(qt,De,mt,Ve){var Ce,H=qt.state;return H.window===null&&(H.wsize=1<<H.wbits,H.wnext=0,H.whave=0,H.window=new e.Buf8(H.wsize)),Ve>=H.wsize?(e.arraySet(H.window,De,mt-H.wsize,H.wsize,0),H.wnext=0,H.whave=H.wsize):(Ce=H.wsize-H.wnext,Ce>Ve&&(Ce=Ve),e.arraySet(H.window,De,mt-Ve,Ce,H.wnext),Ve-=Ce,Ve?(e.arraySet(H.window,De,mt-Ve,Ve,0),H.wnext=Ve,H.whave=H.wsize):(H.wnext+=Ce,H.wnext===H.wsize&&(H.wnext=0),H.whave<H.wsize&&(H.whave+=Ce))),0}function St(qt,De){var mt,Ve,Ce,H,ve,Te,wt,Kt,ce,Y,nt,ct,vt,Ft,pt=0,bt,lt,Et,g,ut,Ee,Zt,Be,Re=new e.Buf8(4),Fe,fe,ke=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!qt||!qt.state||!qt.output||!qt.input&&qt.avail_in!==0)return N;mt=qt.state,mt.mode===Mt&&(mt.mode=pe),ve=qt.next_out,Ce=qt.output,wt=qt.avail_out,H=qt.next_in,Ve=qt.input,Te=qt.avail_in,Kt=mt.hold,ce=mt.bits,Y=Te,nt=wt,Be=C;t:for(;;)switch(mt.mode){case Z:if(mt.wrap===0){mt.mode=pe;break}for(;ce<16;){if(Te===0)break t;Te--,Kt+=Ve[H++]<<ce,ce+=8}if(mt.wrap&2&&Kt===35615){mt.check=0,Re[0]=Kt&255,Re[1]=Kt>>>8&255,mt.check=i(mt.check,Re,2,0),Kt=0,ce=0,mt.mode=K;break}if(mt.flags=0,mt.head&&(mt.head.done=!1),!(mt.wrap&1)||(((Kt&255)<<8)+(Kt>>8))%31){qt.msg="incorrect header check",mt.mode=Ii;break}if((Kt&15)!==q){qt.msg="unknown compression method",mt.mode=Ii;break}if(Kt>>>=4,ce-=4,Zt=(Kt&15)+8,mt.wbits===0)mt.wbits=Zt;else if(Zt>mt.wbits){qt.msg="invalid window size",mt.mode=Ii;break}mt.dmax=1<<Zt,qt.adler=mt.check=1,mt.mode=Kt&512?X:Mt,Kt=0,ce=0;break;case K:for(;ce<16;){if(Te===0)break t;Te--,Kt+=Ve[H++]<<ce,ce+=8}if(mt.flags=Kt,(mt.flags&255)!==q){qt.msg="unknown compression method",mt.mode=Ii;break}if(mt.flags&57344){qt.msg="unknown header flags set",mt.mode=Ii;break}mt.head&&(mt.head.text=Kt>>8&1),mt.flags&512&&(Re[0]=Kt&255,Re[1]=Kt>>>8&255,mt.check=i(mt.check,Re,2,0)),Kt=0,ce=0,mt.mode=ft;case ft:for(;ce<32;){if(Te===0)break t;Te--,Kt+=Ve[H++]<<ce,ce+=8}mt.head&&(mt.head.time=Kt),mt.flags&512&&(Re[0]=Kt&255,Re[1]=Kt>>>8&255,Re[2]=Kt>>>16&255,Re[3]=Kt>>>24&255,mt.check=i(mt.check,Re,4,0)),Kt=0,ce=0,mt.mode=rt;case rt:for(;ce<16;){if(Te===0)break t;Te--,Kt+=Ve[H++]<<ce,ce+=8}mt.head&&(mt.head.xflags=Kt&255,mt.head.os=Kt>>8),mt.flags&512&&(Re[0]=Kt&255,Re[1]=Kt>>>8&255,mt.check=i(mt.check,Re,2,0)),Kt=0,ce=0,mt.mode=Lt;case Lt:if(mt.flags&1024){for(;ce<16;){if(Te===0)break t;Te--,Kt+=Ve[H++]<<ce,ce+=8}mt.length=Kt,mt.head&&(mt.head.extra_len=Kt),mt.flags&512&&(Re[0]=Kt&255,Re[1]=Kt>>>8&255,mt.check=i(mt.check,Re,2,0)),Kt=0,ce=0}else mt.head&&(mt.head.extra=null);mt.mode=Vt;case Vt:if(mt.flags&1024&&(ct=mt.length,ct>Te&&(ct=Te),ct&&(mt.head&&(Zt=mt.head.extra_len-mt.length,mt.head.extra||(mt.head.extra=new Array(mt.head.extra_len)),e.arraySet(mt.head.extra,Ve,H,ct,Zt)),mt.flags&512&&(mt.check=i(mt.check,Ve,ct,H)),Te-=ct,H+=ct,mt.length-=ct),mt.length))break t;mt.length=0,mt.mode=At;case At:if(mt.flags&2048){if(Te===0)break t;ct=0;do Zt=Ve[H+ct++],mt.head&&Zt&&mt.length<65536&&(mt.head.name+=String.fromCharCode(Zt));while(Zt&&ct<Te);if(mt.flags&512&&(mt.check=i(mt.check,Ve,ct,H)),Te-=ct,H+=ct,Zt)break t}else mt.head&&(mt.head.name=null);mt.length=0,mt.mode=at;case at:if(mt.flags&4096){if(Te===0)break t;ct=0;do Zt=Ve[H+ct++],mt.head&&Zt&&mt.length<65536&&(mt.head.comment+=String.fromCharCode(Zt));while(Zt&&ct<Te);if(mt.flags&512&&(mt.check=i(mt.check,Ve,ct,H)),Te-=ct,H+=ct,Zt)break t}else mt.head&&(mt.head.comment=null);mt.mode=kt;case kt:if(mt.flags&512){for(;ce<16;){if(Te===0)break t;Te--,Kt+=Ve[H++]<<ce,ce+=8}if(Kt!==(mt.check&65535)){qt.msg="header crc mismatch",mt.mode=Ii;break}Kt=0,ce=0}mt.head&&(mt.head.hcrc=mt.flags>>9&1,mt.head.done=!0),qt.adler=mt.check=0,mt.mode=Mt;break;case X:for(;ce<32;){if(Te===0)break t;Te--,Kt+=Ve[H++]<<ce,ce+=8}qt.adler=mt.check=ur(Kt),Kt=0,ce=0,mt.mode=ht;case ht:if(mt.havedict===0)return qt.next_out=ve,qt.avail_out=wt,qt.next_in=H,qt.avail_in=Te,mt.hold=Kt,mt.bits=ce,L;qt.adler=mt.check=1,mt.mode=Mt;case Mt:if(De===A||De===v)break t;case pe:if(mt.last){Kt>>>=ce&7,ce-=ce&7,mt.mode=ze;break}for(;ce<3;){if(Te===0)break t;Te--,Kt+=Ve[H++]<<ce,ce+=8}switch(mt.last=Kt&1,Kt>>>=1,ce-=1,Kt&3){case 0:mt.mode=Ct;break;case 1:if(nn(mt),mt.mode=he,De===v){Kt>>>=2,ce-=2;break t}break;case 2:mt.mode=te;break;case 3:qt.msg="invalid block type",mt.mode=Ii}Kt>>>=2,ce-=2;break;case Ct:for(Kt>>>=ce&7,ce-=ce&7;ce<32;){if(Te===0)break t;Te--,Kt+=Ve[H++]<<ce,ce+=8}if((Kt&65535)!==(Kt>>>16^65535)){qt.msg="invalid stored block lengths",mt.mode=Ii;break}if(mt.length=Kt&65535,Kt=0,ce=0,mt.mode=Dt,De===v)break t;case Dt:mt.mode=Gt;case Gt:if(ct=mt.length,ct){if(ct>Te&&(ct=Te),ct>wt&&(ct=wt),ct===0)break t;e.arraySet(Ce,Ve,H,ct,ve),Te-=ct,H+=ct,wt-=ct,ve+=ct,mt.length-=ct;break}mt.mode=Mt;break;case te:for(;ce<14;){if(Te===0)break t;Te--,Kt+=Ve[H++]<<ce,ce+=8}if(mt.nlen=(Kt&31)+257,Kt>>>=5,ce-=5,mt.ndist=(Kt&31)+1,Kt>>>=5,ce-=5,mt.ncode=(Kt&15)+4,Kt>>>=4,ce-=4,mt.nlen>286||mt.ndist>30){qt.msg="too many length or distance symbols",mt.mode=Ii;break}mt.have=0,mt.mode=re;case re:for(;mt.have<mt.ncode;){for(;ce<3;){if(Te===0)break t;Te--,Kt+=Ve[H++]<<ce,ce+=8}mt.lens[ke[mt.have++]]=Kt&7,Kt>>>=3,ce-=3}for(;mt.have<19;)mt.lens[ke[mt.have++]]=0;if(mt.lencode=mt.lendyn,mt.lenbits=7,Fe={bits:mt.lenbits},Be=r(s,mt.lens,0,19,mt.lencode,0,mt.work,Fe),mt.lenbits=Fe.bits,Be){qt.msg="invalid code lengths set",mt.mode=Ii;break}mt.have=0,mt.mode=ae;case ae:for(;mt.have<mt.nlen+mt.ndist;){for(;pt=mt.lencode[Kt&(1<<mt.lenbits)-1],bt=pt>>>24,lt=pt>>>16&255,Et=pt&65535,!(bt<=ce);){if(Te===0)break t;Te--,Kt+=Ve[H++]<<ce,ce+=8}if(Et<16)Kt>>>=bt,ce-=bt,mt.lens[mt.have++]=Et;else{if(Et===16){for(fe=bt+2;ce<fe;){if(Te===0)break t;Te--,Kt+=Ve[H++]<<ce,ce+=8}if(Kt>>>=bt,ce-=bt,mt.have===0){qt.msg="invalid bit length repeat",mt.mode=Ii;break}Zt=mt.lens[mt.have-1],ct=3+(Kt&3),Kt>>>=2,ce-=2}else if(Et===17){for(fe=bt+3;ce<fe;){if(Te===0)break t;Te--,Kt+=Ve[H++]<<ce,ce+=8}Kt>>>=bt,ce-=bt,Zt=0,ct=3+(Kt&7),Kt>>>=3,ce-=3}else{for(fe=bt+7;ce<fe;){if(Te===0)break t;Te--,Kt+=Ve[H++]<<ce,ce+=8}Kt>>>=bt,ce-=bt,Zt=0,ct=11+(Kt&127),Kt>>>=7,ce-=7}if(mt.have+ct>mt.nlen+mt.ndist){qt.msg="invalid bit length repeat",mt.mode=Ii;break}for(;ct--;)mt.lens[mt.have++]=Zt}}if(mt.mode===Ii)break;if(mt.lens[256]===0){qt.msg="invalid code -- missing end-of-block",mt.mode=Ii;break}if(mt.lenbits=9,Fe={bits:mt.lenbits},Be=r(o,mt.lens,0,mt.nlen,mt.lencode,0,mt.work,Fe),mt.lenbits=Fe.bits,Be){qt.msg="invalid literal/lengths set",mt.mode=Ii;break}if(mt.distbits=6,mt.distcode=mt.distdyn,Fe={bits:mt.distbits},Be=r(l,mt.lens,mt.nlen,mt.ndist,mt.distcode,0,mt.work,Fe),mt.distbits=Fe.bits,Be){qt.msg="invalid distances set",mt.mode=Ii;break}if(mt.mode=he,De===v)break t;case he:mt.mode=Pe;case Pe:if(Te>=6&&wt>=258){qt.next_out=ve,qt.avail_out=wt,qt.next_in=H,qt.avail_in=Te,mt.hold=Kt,mt.bits=ce,n(qt,nt),ve=qt.next_out,Ce=qt.output,wt=qt.avail_out,H=qt.next_in,Ve=qt.input,Te=qt.avail_in,Kt=mt.hold,ce=mt.bits,mt.mode===Mt&&(mt.back=-1);break}for(mt.back=0;pt=mt.lencode[Kt&(1<<mt.lenbits)-1],bt=pt>>>24,lt=pt>>>16&255,Et=pt&65535,!(bt<=ce);){if(Te===0)break t;Te--,Kt+=Ve[H++]<<ce,ce+=8}if(lt&&(lt&240)===0){for(g=bt,ut=lt,Ee=Et;pt=mt.lencode[Ee+((Kt&(1<<g+ut)-1)>>g)],bt=pt>>>24,lt=pt>>>16&255,Et=pt&65535,!(g+bt<=ce);){if(Te===0)break t;Te--,Kt+=Ve[H++]<<ce,ce+=8}Kt>>>=g,ce-=g,mt.back+=g}if(Kt>>>=bt,ce-=bt,mt.back+=bt,mt.length=Et,lt===0){mt.mode=Ye;break}if(lt&32){mt.back=-1,mt.mode=Mt;break}if(lt&64){qt.msg="invalid literal/length code",mt.mode=Ii;break}mt.extra=lt&15,mt.mode=Se;case Se:if(mt.extra){for(fe=mt.extra;ce<fe;){if(Te===0)break t;Te--,Kt+=Ve[H++]<<ce,ce+=8}mt.length+=Kt&(1<<mt.extra)-1,Kt>>>=mt.extra,ce-=mt.extra,mt.back+=mt.extra}mt.was=mt.length,mt.mode=se;case se:for(;pt=mt.distcode[Kt&(1<<mt.distbits)-1],bt=pt>>>24,lt=pt>>>16&255,Et=pt&65535,!(bt<=ce);){if(Te===0)break t;Te--,Kt+=Ve[H++]<<ce,ce+=8}if((lt&240)===0){for(g=bt,ut=lt,Ee=Et;pt=mt.distcode[Ee+((Kt&(1<<g+ut)-1)>>g)],bt=pt>>>24,lt=pt>>>16&255,Et=pt&65535,!(g+bt<=ce);){if(Te===0)break t;Te--,Kt+=Ve[H++]<<ce,ce+=8}Kt>>>=g,ce-=g,mt.back+=g}if(Kt>>>=bt,ce-=bt,mt.back+=bt,lt&64){qt.msg="invalid distance code",mt.mode=Ii;break}mt.offset=Et,mt.extra=lt&15,mt.mode=fi;case fi:if(mt.extra){for(fe=mt.extra;ce<fe;){if(Te===0)break t;Te--,Kt+=Ve[H++]<<ce,ce+=8}mt.offset+=Kt&(1<<mt.extra)-1,Kt>>>=mt.extra,ce-=mt.extra,mt.back+=mt.extra}if(mt.offset>mt.dmax){qt.msg="invalid distance too far back",mt.mode=Ii;break}mt.mode=Ze;case Ze:if(wt===0)break t;if(ct=nt-wt,mt.offset>ct){if(ct=mt.offset-ct,ct>mt.whave&&mt.sane){qt.msg="invalid distance too far back",mt.mode=Ii;break}ct>mt.wnext?(ct-=mt.wnext,vt=mt.wsize-ct):vt=mt.wnext-ct,ct>mt.length&&(ct=mt.length),Ft=mt.window}else Ft=Ce,vt=ve-mt.offset,ct=mt.length;ct>wt&&(ct=wt),wt-=ct,mt.length-=ct;do Ce[ve++]=Ft[vt++];while(--ct);mt.length===0&&(mt.mode=Pe);break;case Ye:if(wt===0)break t;Ce[ve++]=mt.length,wt--,mt.mode=Pe;break;case ze:if(mt.wrap){for(;ce<32;){if(Te===0)break t;Te--,Kt|=Ve[H++]<<ce,ce+=8}if(nt-=wt,qt.total_out+=nt,mt.total+=nt,nt&&(qt.adler=mt.check=mt.flags?i(mt.check,Ce,nt,ve-nt):t(mt.check,Ce,nt,ve-nt)),nt=wt,(mt.flags?Kt:ur(Kt))!==mt.check){qt.msg="incorrect data check",mt.mode=Ii;break}Kt=0,ce=0}mt.mode=pi;case pi:if(mt.wrap&&mt.flags){for(;ce<32;){if(Te===0)break t;Te--,Kt+=Ve[H++]<<ce,ce+=8}if(Kt!==(mt.total&4294967295)){qt.msg="incorrect length check",mt.mode=Ii;break}Kt=0,ce=0}mt.mode=sn;case sn:Be=S;break t;case Ii:Be=G;break t;case _i:return W;case Fn:default:return N}return qt.next_out=ve,qt.avail_out=wt,qt.next_in=H,qt.avail_in=Te,mt.hold=Kt,mt.bits=ce,(mt.wsize||nt!==qt.avail_out&&mt.mode<Ii&&(mt.mode<ze||De!==h))&&_r(qt,qt.output,qt.next_out,nt-qt.avail_out),Y-=qt.avail_in,nt-=qt.avail_out,qt.total_in+=Y,qt.total_out+=nt,mt.total+=nt,mt.wrap&&nt&&(qt.adler=mt.check=mt.flags?i(mt.check,Ce,nt,qt.next_out-nt):t(mt.check,Ce,nt,qt.next_out-nt)),qt.data_type=mt.bits+(mt.last?64:0)+(mt.mode===Mt?128:0)+(mt.mode===he||mt.mode===Dt?256:0),(Y===0&&nt===0||De===h)&&Be===C&&(Be=j),Be}function Ne(qt){if(!qt||!qt.state)return N;var De=qt.state;return De.window&&(De.window=null),qt.state=null,C}function Xe(qt,De){var mt;return!qt||!qt.state||(mt=qt.state,(mt.wrap&2)===0)?N:(mt.head=De,De.done=!1,C)}function ci(qt,De){var mt=De.length,Ve,Ce,H;return!qt||!qt.state||(Ve=qt.state,Ve.wrap!==0&&Ve.mode!==ht)?N:Ve.mode===ht&&(Ce=1,Ce=t(Ce,De,mt,0),Ce!==Ve.check)?G:(H=_r(qt,De,mt,mt),H?(Ve.mode=_i,W):(Ve.havedict=1,C))}return Ha.inflateReset=rr,Ha.inflateReset2=Wn,Ha.inflateResetKeep=gn,Ha.inflateInit=tr,Ha.inflateInit2=Tn,Ha.inflate=St,Ha.inflateEnd=Ne,Ha.inflateGetHeader=Xe,Ha.inflateSetDictionary=ci,Ha.inflateInfo="pako inflate (from Nodeca project)",Ha}var Xk,Kk;function Qk(){return Kk||(Kk=1,Xk={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}),Xk}var jC,Zk;function Mxt(){if(Zk)return jC;Zk=1;function e(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}return jC=e,jC}var Yk;function Pxt(){if(Yk)return Vp;Yk=1;var e=Ixt(),t=_h(),i=Gk(),n=Qk(),r=UC(),s=Vk(),o=Mxt(),l=Object.prototype.toString;function h(C){if(!(this instanceof h))return new h(C);this.options=t.assign({chunkSize:16384,windowBits:0,to:""},C||{});var S=this.options;S.raw&&S.windowBits>=0&&S.windowBits<16&&(S.windowBits=-S.windowBits,S.windowBits===0&&(S.windowBits=-15)),S.windowBits>=0&&S.windowBits<16&&!(C&&C.windowBits)&&(S.windowBits+=32),S.windowBits>15&&S.windowBits<48&&(S.windowBits&15)===0&&(S.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var L=e.inflateInit2(this.strm,S.windowBits);if(L!==n.Z_OK)throw new Error(r[L]);if(this.header=new o,e.inflateGetHeader(this.strm,this.header),S.dictionary&&(typeof S.dictionary=="string"?S.dictionary=i.string2buf(S.dictionary):l.call(S.dictionary)==="[object ArrayBuffer]"&&(S.dictionary=new Uint8Array(S.dictionary)),S.raw&&(L=e.inflateSetDictionary(this.strm,S.dictionary),L!==n.Z_OK)))throw new Error(r[L])}h.prototype.push=function(C,S){var L=this.strm,N=this.options.chunkSize,G=this.options.dictionary,W,j,q,Z,K,ft=!1;if(this.ended)return!1;j=S===~~S?S:S===!0?n.Z_FINISH:n.Z_NO_FLUSH,typeof C=="string"?L.input=i.binstring2buf(C):l.call(C)==="[object ArrayBuffer]"?L.input=new Uint8Array(C):L.input=C,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new t.Buf8(N),L.next_out=0,L.avail_out=N),W=e.inflate(L,n.Z_NO_FLUSH),W===n.Z_NEED_DICT&&G&&(W=e.inflateSetDictionary(this.strm,G)),W===n.Z_BUF_ERROR&&ft===!0&&(W=n.Z_OK,ft=!1),W!==n.Z_STREAM_END&&W!==n.Z_OK)return this.onEnd(W),this.ended=!0,!1;L.next_out&&(L.avail_out===0||W===n.Z_STREAM_END||L.avail_in===0&&(j===n.Z_FINISH||j===n.Z_SYNC_FLUSH))&&(this.options.to==="string"?(q=i.utf8border(L.output,L.next_out),Z=L.next_out-q,K=i.buf2string(L.output,q),L.next_out=Z,L.avail_out=N-Z,Z&&t.arraySet(L.output,L.output,q,Z,0),this.onData(K)):this.onData(t.shrinkBuf(L.output,L.next_out))),L.avail_in===0&&L.avail_out===0&&(ft=!0)}while((L.avail_in>0||L.avail_out===0)&&W!==n.Z_STREAM_END);return W===n.Z_STREAM_END&&(j=n.Z_FINISH),j===n.Z_FINISH?(W=e.inflateEnd(this.strm),this.onEnd(W),this.ended=!0,W===n.Z_OK):(j===n.Z_SYNC_FLUSH&&(this.onEnd(n.Z_OK),L.avail_out=0),!0)},h.prototype.onData=function(C){this.chunks.push(C)},h.prototype.onEnd=function(C){C===n.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.msg=this.strm.msg};function A(C,S){var L=new h(S);if(L.push(C,!0),L.err)throw L.msg||r[L.err];return L.result}function v(C,S){return S=S||{},S.raw=!0,A(C,S)}return Vp.Inflate=h,Vp.inflate=A,Vp.inflateRaw=v,Vp.ungzip=A,Vp}var HC,qk;function Rxt(){if(qk)return HC;qk=1;var e=_h().assign,t=Bxt(),i=Pxt(),n=Qk(),r={};return e(r,t,i,n),HC=r,HC}var Dxt=Rxt();const jp=Jh(Dxt),$k=[0],Oxt={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:Sk,onTilesetLoad:{type:"function",value:e=>{}},onTileLoad:{type:"function",value:e=>{}},onTileUnload:{type:"function",value:e=>{}},onTileError:{type:"function",value:(e,t,i)=>{}},_getMeshColor:{type:"function",value:e=>[255,255,255]}};class WC extends Mo{initializeState(){"onTileLoadFail"in this.props&&Yi.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var t,i;return!!((i=(t=this.state)==null?void 0:t.tileset3d)!=null&&i.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({props:t,oldProps:i,changeFlags:n}){if(t.data&&t.data!==i.data&&this._loadTileset(t.data),n.viewportChanged){const{activeViewports:r}=this.state;Object.keys(r).length&&(this._updateTileset(r),this.state.lastUpdatedViewports=r,this.state.activeViewports={})}if(n.propsChanged){const{layerMap:r}=this.state;for(const s in r)r[s].needsUpdate=!0}}activateViewport(t){const{activeViewports:i,lastUpdatedViewports:n}=this.state;this.internalState.viewport=t,i[t.id]=t;const r=n==null?void 0:n[t.id];(!r||!t.equals(r))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:t,sourceLayer:i}){const n=i&&i.props.tile;return t.picked&&(t.object=n),t.sourceTile=n,t}filterSubLayer({layer:t,viewport:i}){const{tile:n}=t.props,{id:r}=i;return n.selected&&n.viewportIds.includes(r)}_updateAutoHighlight(t){const i=t.sourceTile,n=this.state.layerMap[i==null?void 0:i.id];n&&n.layer&&n.layer.updateAutoHighlight(t)}async _loadTileset(t){const{loadOptions:i={}}=this.props,n=this.props.loader||this.props.loaders,r=Array.isArray(n)?n[0]:n,s={loadOptions:{...i}};let o=t;if(r.preload){const A=await r.preload(t,i);A.url&&(o=A.url),A.headers&&(s.loadOptions.fetch={...s.loadOptions.fetch,headers:A.headers}),Object.assign(s,A)}const l=await gp(o,r,s.loadOptions),h=new svt(l,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...s});this.setState({tileset3d:h,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(h)}_onTileLoad(t){const{lastUpdatedViewports:i}=this.state;this.props.onTileLoad(t),this._updateTileset(i),this.setNeedsUpdate()}_onTileUnload(t){delete this.state.layerMap[t.id],this.props.onTileUnload(t)}_updateTileset(t){if(!t)return;const{tileset3d:i}=this.state,{timeline:n}=this.context,r=Object.keys(t).length;!n||!r||!i||i.selectTiles(Object.values(t)).then(s=>{this.state.frameNumber!==s&&this.setState({frameNumber:s})})}_getSubLayer(t,i){if(!t.content)return null;switch(t.type){case lu.POINTCLOUD:return this._makePointCloudLayer(t,i);case lu.SCENEGRAPH:return this._make3DModelLayer(t);case lu.MESH:return this._makeSimpleMeshLayer(t,i);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${t.content.type}`)}}_makePointCloudLayer(t,i){const{attributes:n,pointCount:r,constantRGBA:s,cartographicOrigin:o,modelMatrix:l}=t.content,{positions:h,normals:A,colors:v}=n;if(!h)return null;const C=i&&i.props.data||{header:{vertexCount:r},attributes:{POSITION:h,NORMAL:A,COLOR_0:v}},{pointSize:S,getPointColor:L}=this.props,N=this.getSubLayerClass("pointcloud",Rg);return new N({pointSize:S},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${t.id}`,tile:t,data:C,coordinateSystem:qi.METER_OFFSETS,coordinateOrigin:o,modelMatrix:l,getColor:s||L,_offset:0})}_make3DModelLayer(t){const{gltf:i,instances:n,cartographicOrigin:r,modelMatrix:s}=t.content,o=this.getSubLayerClass("scenegraph",Yg);return new o({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${t.id}`,tile:t,data:n||$k,scenegraph:i,coordinateSystem:qi.METER_OFFSETS,coordinateOrigin:r,modelMatrix:s,getTransformMatrix:l=>l.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(t,i){const n=t.content,{attributes:r,indices:s,modelMatrix:o,cartographicOrigin:l,coordinateSystem:h=qi.METER_OFFSETS,material:A,featureIds:v}=n,{_getMeshColor:C}=this.props,S=i&&i.props.mesh||new es({topology:"triangle-list",attributes:Lxt(r),indices:s}),L=this.getSubLayerClass("mesh",$w);return new L(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${t.id}`,tile:t,mesh:S,data:$k,getColor:C(t),pbrMaterial:A,modelMatrix:o,coordinateOrigin:l,coordinateSystem:h,featureIds:v,_offset:0})}renderLayers(){const{tileset3d:t,layerMap:i}=this.state;return t?t.tiles.map(n=>{const r=i[n.id]=i[n.id]||{tile:n};let{layer:s}=r;return n.selected&&(s?r.needsUpdate&&(s=this._getSubLayer(n,s),r.needsUpdate=!1):s=this._getSubLayer(n)),r.layer=s,s}).filter(Boolean):null}}WC.defaultProps=Oxt,WC.layerName="Tile3DLayer";function Lxt(e){const t={};return t.positions={...e.positions,value:new Float32Array(e.positions.value)},e.normals&&(t.normals=e.normals),e.texCoords&&(t.texCoords=e.texCoords),e.colors&&(t.colors=e.colors),e.uvRegions&&(t.uvRegions=e.uvRegions),t}const Fxt="4.3.1",t5={dataType:null,batchType:null,name:"Terrain",id:"terrain",module:"terrain",version:Fxt,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:void 0,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:void 0}}};({...t5});const e5=[1],kxt={...au.defaultProps,elevationData:s_,texture:{...s_,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[t5]};function i5(e){return Array.isArray(e)?e.join(";"):e||""}class JC extends Mo{updateState({props:t,oldProps:i}){const n=t.elevationData!==i.elevationData;if(n){const{elevationData:s}=t,o=s&&(Array.isArray(s)||s.includes("{x}")&&s.includes("{y}"));this.setState({isTiled:o})}const r=n||t.meshMaxError!==i.meshMaxError||t.elevationDecoder!==i.elevationDecoder||t.bounds!==i.bounds;if(!this.state.isTiled&&r){const s=this.loadTerrain(t);this.setState({terrain:s})}t.workerUrl&&Yi.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:t,bounds:i,elevationDecoder:n,meshMaxError:r,signal:s}){if(!t)return null;let o=this.getLoadOptions();o={...o,terrain:{skirtHeight:this.state.isTiled?r*2:0,...o==null?void 0:o.terrain,bounds:i,meshMaxError:r,elevationDecoder:n}};const{fetch:l}=this.props;return l(t,{propName:"elevationData",layer:this,loadOptions:o,signal:s})}getTiledTerrainData(t){const{elevationData:i,fetch:n,texture:r,elevationDecoder:s,meshMaxError:o}=this.props,{viewport:l}=this.context,h=vf(i,t),A=r&&vf(r,t),{signal:v}=t;let C=[0,0],S=[0,0];if(l.isGeospatial){const W=t.bbox;C=l.projectFlat([W.west,W.south]),S=l.projectFlat([W.east,W.north])}else{const W=t.bbox;C=[W.left,W.bottom],S=[W.right,W.top]}const L=[C[0],C[1],S[0],S[1]],N=this.loadTerrain({elevationData:h,bounds:L,elevationDecoder:s,meshMaxError:o,signal:v}),G=A?n(A,{propName:"texture",layer:this,loaders:[],signal:v}).catch(W=>null):Promise.resolve(null);return Promise.all([N,G])}renderSubLayers(t){const i=this.getSubLayerClass("mesh",bf),{color:n,wireframe:r,material:s}=this.props,{data:o}=t;if(!o)return null;const[l,h]=o;return new i(t,{data:e5,mesh:l,texture:h,_instanced:!1,coordinateSystem:qi.CARTESIAN,getPosition:A=>[0,0,0],getColor:n,wireframe:r,material:s})}onViewportLoad(t){if(!t)return;const{zRange:i}=this.state,n=t.map(o=>o.content).filter(Boolean).map(o=>o[0].header.boundingBox.map(l=>l[2]));if(n.length===0)return;const r=Math.min(...n.map(o=>o[0])),s=Math.max(...n.map(o=>o[1]));(!i||r<i[0]||s>i[1])&&this.setState({zRange:[r,s]})}renderLayers(){const{color:t,material:i,elevationData:n,texture:r,wireframe:s,meshMaxError:o,elevationDecoder:l,tileSize:h,maxZoom:A,minZoom:v,extent:C,maxRequests:S,onTileLoad:L,onTileUnload:N,onTileError:G,maxCacheSize:W,maxCacheByteSize:j,refinementStrategy:q}=this.props;if(this.state.isTiled)return new au(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:i5(n),texture:i5(r),meshMaxError:o,elevationDecoder:l}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:h,maxZoom:A,minZoom:v,extent:C,maxRequests:S,onTileLoad:L,onTileUnload:N,onTileError:G,maxCacheSize:W,maxCacheByteSize:j,refinementStrategy:q});if(!n)return null;const Z=this.getSubLayerClass("mesh",bf);return new Z(this.getSubLayerProps({id:"mesh"}),{data:e5,mesh:this.state.terrain,texture:r,_instanced:!1,getPosition:K=>[0,0,0],getColor:t,material:i,wireframe:s})}}JC.defaultProps=kxt,JC.layerName="TerrainLayer";const Nxt={clipBounds:[0,0,1,1],clipByInstance:void 0},n5=`
uniform clipUniforms {
  vec4 bounds;
} clip;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip.bounds[0] && position.y >= clip.bounds[1] && position.x < clip.bounds[2] && position.y < clip.bounds[3];
}
`,Uxt={name:"clip",vs:n5,uniformTypes:{bounds:"vec4<f32>"}},Gxt={"vs:#decl":`
out float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
in float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},zxt={name:"clip",fs:n5,uniformTypes:{bounds:"vec4<f32>"}},Vxt={"vs:#decl":`
out vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
in vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`};class W_ extends $0{getShaders(){let t="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(t=!!this.props.clipByInstance),this.state.clipByInstance=t,t?{modules:[Uxt],inject:Gxt}:{modules:[zxt],inject:Vxt}}draw(){const{clipBounds:t}=this.props,i={};if(this.state.clipByInstance)i.bounds=t;else{const n=this.projectPosition([t[0],t[1],0]),r=this.projectPosition([t[2],t[3],0]);i.bounds=[Math.min(n[0],r[0]),Math.min(n[1],r[1]),Math.max(n[0],r[0]),Math.max(n[1],r[1])]}this.setShaderModuleProps({clip:i})}}W_.defaultProps=Nxt,W_.extensionName="ClipExtension";const jxt=`
in float collisionPriorities;

uniform sampler2D collision_texture;

uniform collisionUniforms {
  bool sort;
  bool enabled;
} collision;

vec2 collision_getCoords(vec4 position) {
  vec4 collision_clipspace = project_common_position_to_clipspace(position);
  return (1.0 + collision_clipspace.xy / collision_clipspace.w) / 2.0;
}

float collision_match(vec2 tex, vec3 pickingColor) {
  vec4 collision_pickingColor = texture(collision_texture, tex);
  float delta = dot(abs(collision_pickingColor.rgb - pickingColor), vec3(1.0));
  float e = 0.001;
  return step(delta, e);
}

float collision_isVisible(vec2 texCoords, vec3 pickingColor) {
  if (!collision.enabled) {
    return 1.0;
  }

  // Visibility test, sample area of 5x5 pixels in order to fade in/out.
  // Due to the locality, the lookups will be cached
  // This reduces the flicker present when objects are shown/hidden
  const int N = 2;
  float accumulator = 0.0;
  vec2 step = vec2(1.0 / project.viewportSize);

  const float floatN = float(N);
  vec2 delta = -floatN * step;
  for(int i = -N; i <= N; i++) {
    delta.x = -step.x * floatN;
    for(int j = -N; j <= N; j++) {
      accumulator += collision_match(texCoords + delta, pickingColor);
      delta.x += step.x;
    }
    delta.y += step.y;
  }

  float W = 2.0 * floatN + 1.0;
  return pow(accumulator / (W * W), 2.2);
}
`,Hxt={"vs:#decl":`
  float collision_fade = 1.0;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  if (collision.sort) {
    float collisionPriority = collisionPriorities;
    position.z = -0.001 * collisionPriority * position.w; // Support range -1000 -> 1000
  }

  if (collision.enabled) {
    vec4 collision_common_position = project_position(vec4(geometry.worldPosition, 1.0));
    vec2 collision_texCoords = collision_getCoords(collision_common_position);
    collision_fade = collision_isVisible(collision_texCoords, geometry.pickingColor / 255.0);
    if (collision_fade < 0.0001) {
      // Position outside clip space bounds to discard
      position = vec4(0.0, 0.0, 2.0, 1.0);
    }
  }
  `,"vs:DECKGL_FILTER_COLOR":`
  color.a *= collision_fade;
  `},Wxt=e=>{if(!e||!("dummyCollisionMap"in e))return{};const{enabled:t,collisionFBO:i,drawToCollisionMap:n,dummyCollisionMap:r}=e;return{enabled:t&&!n,sort:!!n,collision_texture:!n&&i?i.colorAttachments[0]:r}},Jxt={name:"collision",dependencies:[O0],vs:jxt,inject:Hxt,getUniforms:Wxt,uniformTypes:{sort:"i32",enabled:"i32"}};class Xxt extends F0{renderCollisionMap(t,i){const n=[0,0,0,0],r=[1,1,t.width-2*1,t.height-2*1];this.render({...i,clearColor:n,scissorRect:r,target:t,pass:"collision"})}getLayerParameters(t,i,n){return{...t.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}getShaderModuleProps(){return{collision:{drawToCollisionMap:!0},picking:{isActive:1,isAttribute:!1},lighting:{enabled:!1}}}}const XC=2;class Kxt{constructor(){this.id="collision-filter-effect",this.props=null,this.useInPicking=!0,this.order=1,this.channels={},this.collisionFBOs={}}setup(t){this.context=t;const{device:i}=t;this.dummyCollisionMap=i.createTexture({width:1,height:1}),this.collisionFilterPass=new Xxt(i,{id:"default-collision-filter"})}preRender({effects:t,layers:i,layerFilter:n,viewports:r,onViewportActive:s,views:o,isPicking:l,preRenderStats:h={}}){var A;const{device:v}=this.context;if(l)return;const C=i.filter(({props:{visible:j,collisionEnabled:q}})=>j&&q);if(C.length===0){this.channels={};return}const S=t==null?void 0:t.filter(j=>j.useInPicking&&h[j.id]),L=(A=h["mask-effect"])==null?void 0:A.didRender,N=this._groupByCollisionGroup(v,C),G=r[0],W=!this.lastViewport||!this.lastViewport.equals(G)||L;for(const j in N){const q=this.collisionFBOs[j],Z=N[j],[K,ft]=v.canvasContext.getPixelSize();q.resize({width:K/XC,height:ft/XC}),this._render(Z,{effects:S,layerFilter:n,onViewportActive:s,views:o,viewport:G,viewportChanged:W})}}_render(t,{effects:i,layerFilter:n,onViewportActive:r,views:s,viewport:o,viewportChanged:l}){const{collisionGroup:h}=t,A=this.channels[h];if(!A)return;const v=l||t===A||!$r(A.layers,t.layers,1)||t.layerBounds.some((C,S)=>!fa(C,A.layerBounds[S]))||t.allLayersLoaded!==A.allLayersLoaded||t.layers.some(C=>C.props.transitions);if(this.channels[h]=t,v){this.lastViewport=o;const C=this.collisionFBOs[h];this.collisionFilterPass.renderCollisionMap(C,{pass:"collision-filter",isPicking:!0,layers:t.layers,effects:i,layerFilter:n,viewports:o?[o]:[],onViewportActive:r,views:s,shaderModuleProps:{collision:{enabled:!0,dummyCollisionMap:this.dummyCollisionMap},project:{devicePixelRatio:C.device.canvasContext.getDevicePixelRatio()/XC}}})}}_groupByCollisionGroup(t,i){const n={};for(const r of i){const s=r.props.collisionGroup;let o=n[s];o||(o={collisionGroup:s,layers:[],layerBounds:[],allLayersLoaded:!0},n[s]=o),o.layers.push(r),o.layerBounds.push(r.getBounds()),r.isLoaded||(o.allLayersLoaded=!1)}for(const r of Object.keys(n))this.collisionFBOs[r]||this.createFBO(t,r),this.channels[r]||(this.channels[r]=n[r]);for(const r of Object.keys(this.collisionFBOs))n[r]||this.destroyFBO(r);return n}getShaderModuleProps(t){const{collisionGroup:i,collisionEnabled:n}=t.props,{collisionFBOs:r,dummyCollisionMap:s}=this,o=r[i];return{collision:{enabled:n&&!!o,collisionFBO:o,dummyCollisionMap:s}}}cleanup(){this.dummyCollisionMap&&(this.dummyCollisionMap.delete(),this.dummyCollisionMap=void 0),this.channels={};for(const t of Object.keys(this.collisionFBOs))this.destroyFBO(t);this.collisionFBOs={},this.lastViewport=void 0}createFBO(t,i){const{width:n,height:r}=t.gl.canvas,s=t.createTexture({format:"rgba8unorm",width:n,height:r,sampler:{minFilter:"nearest",magFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),o=t.createTexture({format:"depth16unorm",width:n,height:r,mipmaps:!1});this.collisionFBOs[i]=t.createFramebuffer({id:`collision-${i}`,width:n,height:r,colorAttachments:[s],depthStencilAttachment:o})}destroyFBO(t){var i,n;const r=this.collisionFBOs[t];(i=r.colorAttachments[0])==null||i.destroy(),(n=r.depthStencilAttachment)==null||n.destroy(),r.destroy(),delete this.collisionFBOs[t]}}const Qxt={getCollisionPriority:{type:"accessor",value:0},collisionEnabled:!0,collisionGroup:{type:"string",value:"default"},collisionTestProps:{}};class KC extends $0{getShaders(){return{modules:[Jxt]}}draw({shaderModuleProps:t}){var i;(i=t.collision)!=null&&i.drawToCollisionMap&&(this.props=this.clone(this.props.collisionTestProps).props)}initializeState(t,i){var n;this.getAttributeManager()!==null&&((n=this.context.deck)==null||n._addDefaultEffect(new Kxt),this.getAttributeManager().add({collisionPriorities:{size:1,stepMode:"dynamic",accessor:"getCollisionPriority"}}))}getNeedsPickingBuffer(){return this.props.collisionEnabled}}KC.defaultProps=Qxt,KC.extensionName="CollisionFilterExtension";function QC(e,t){const i=t==null?void 0:t.globalFeatureId;return i!==void 0?Zxt(e,i):Yxt(e,t==null?void 0:t.type)}function Zxt(e,t){const i=r5(e);for(const n of i){let r=0,s=n.featureIds.value[0];for(let o=0;o<n.featureIds.value.length;o++){const l=n.featureIds.value[o];if(l!==s){if(t===n.globalFeatureIds.value[r])return J_(n,r,o);r=o,s=l}}if(t===n.globalFeatureIds.value[r])return J_(n,r,n.featureIds.value.length)}throw new Error(`featureId:${t} not found`)}function Yxt(e,t){const i=r5(e);return $xt(i)}function qxt(e,t,i){switch(e.type){case"Point":return nwt(e,t,i);case"LineString":return iwt(e,t,i);case"Polygon":return o5(e,t,i);default:const n=e;throw new Error(`Unsupported geometry type: ${n==null?void 0:n.type}`)}}function r5(e,t){const i=[];return e.points&&(e.points.type="Point",i.push(e.points)),e.lines&&(e.lines.type="LineString",i.push(e.lines)),e.polygons&&(e.polygons.type="Polygon",i.push(e.polygons)),i}function $xt(e){const t=[];for(const i of e){if(i.featureIds.value.length===0)continue;let n=0,r=i.featureIds.value[0];for(let s=0;s<i.featureIds.value.length;s++){const o=i.featureIds.value[s];o!==r&&(t.push(J_(i,n,s)),n=s,r=o)}t.push(J_(i,n,i.featureIds.value.length))}return t}function J_(e,t,i){const n=qxt(e,t,i),r=ewt(e,t),s=twt(e,t);return{type:"Feature",geometry:n,properties:r,...s}}function twt(e,t=0,i){return e.fields&&e.fields[e.featureIds.value[t]]}function ewt(e,t=0,i){const n=Object.assign({},e.properties[e.featureIds.value[t]]);for(const r in e.numericProps)n[r]=e.numericProps[r].value[t];return n}function o5(e,t=-1/0,i=1/0){const{positions:n}=e,r=e.polygonIndices.value.filter(l=>l>=t&&l<=i),s=e.primitivePolygonIndices.value.filter(l=>l>=t&&l<=i);if(!(r.length>2)){const l=[];for(let h=0;h<s.length-1;h++){const A=s[h],v=s[h+1],C=X_(n,A,v);l.push(C)}return{type:"Polygon",coordinates:l}}const o=[];for(let l=0;l<r.length-1;l++){const h=r[l],A=r[l+1],v=o5(e,h,A).coordinates;o.push(v)}return{type:"MultiPolygon",coordinates:o}}function iwt(e,t=-1/0,i=1/0){const{positions:n}=e,r=e.pathIndices.value.filter(o=>o>=t&&o<=i);if(!(r.length>2))return{type:"LineString",coordinates:X_(n,r[0],r[1])};const s=[];for(let o=0;o<r.length-1;o++){const l=X_(n,r[o],r[o+1]);s.push(l)}return{type:"MultiLineString",coordinates:s}}function nwt(e,t,i){const{positions:n}=e,r=X_(n,t,i);return r.length>1?{type:"MultiPoint",coordinates:r}:{type:"Point",coordinates:r[0]}}function X_(e,t,i){t=t||0,i=i||e.value.length/e.size;const n=[];for(let r=t;r<i;r++){const s=Array();for(let o=r*e.size;o<(r+1)*e.size;o++)s.push(Number(e.value[o]));n.push(s)}return n}var ZC={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var s5;function rwt(){return s5||(s5=1,ZC.read=function(e,t,i,n,r){var s,o,l=r*8-n-1,h=(1<<l)-1,A=h>>1,v=-7,C=i?r-1:0,S=i?-1:1,L=e[t+C];for(C+=S,s=L&(1<<-v)-1,L>>=-v,v+=l;v>0;s=s*256+e[t+C],C+=S,v-=8);for(o=s&(1<<-v)-1,s>>=-v,v+=n;v>0;o=o*256+e[t+C],C+=S,v-=8);if(s===0)s=1-A;else{if(s===h)return o?NaN:(L?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-A}return(L?-1:1)*o*Math.pow(2,s-n)},ZC.write=function(e,t,i,n,r,s){var o,l,h,A=s*8-r-1,v=(1<<A)-1,C=v>>1,S=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=n?0:s-1,N=n?1:-1,G=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(l=isNaN(t)?1:0,o=v):(o=Math.floor(Math.log(t)/Math.LN2),t*(h=Math.pow(2,-o))<1&&(o--,h*=2),o+C>=1?t+=S/h:t+=S*Math.pow(2,1-C),t*h>=2&&(o++,h/=2),o+C>=v?(l=0,o=v):o+C>=1?(l=(t*h-1)*Math.pow(2,r),o=o+C):(l=t*Math.pow(2,C-1)*Math.pow(2,r),o=0));r>=8;e[i+L]=l&255,L+=N,l/=256,r-=8);for(o=o<<r|l,A+=r;A>0;e[i+L]=o&255,L+=N,o/=256,A-=8);e[i+L-N]|=G*128}),ZC}var YC,a5;function owt(){if(a5)return YC;a5=1,YC=t;var e=rwt();function t(X){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(X)?X:new Uint8Array(X||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var i=65536*65536,n=1/i,r=12,s=typeof TextDecoder>"u"?null:new TextDecoder("utf8");t.prototype={destroy:function(){this.buf=null},readFields:function(X,ht,Mt){for(Mt=Mt||this.length;this.pos<Mt;){var pe=this.readVarint(),Ct=pe>>3,Dt=this.pos;this.type=pe&7,X(Ct,ht,this),this.pos===Dt&&this.skip(pe)}return ht},readMessage:function(X,ht){return this.readFields(X,ht,this.readVarint()+this.pos)},readFixed32:function(){var X=rt(this.buf,this.pos);return this.pos+=4,X},readSFixed32:function(){var X=Vt(this.buf,this.pos);return this.pos+=4,X},readFixed64:function(){var X=rt(this.buf,this.pos)+rt(this.buf,this.pos+4)*i;return this.pos+=8,X},readSFixed64:function(){var X=rt(this.buf,this.pos)+Vt(this.buf,this.pos+4)*i;return this.pos+=8,X},readFloat:function(){var X=e.read(this.buf,this.pos,!0,23,4);return this.pos+=4,X},readDouble:function(){var X=e.read(this.buf,this.pos,!0,52,8);return this.pos+=8,X},readVarint:function(X){var ht=this.buf,Mt,pe;return pe=ht[this.pos++],Mt=pe&127,pe<128||(pe=ht[this.pos++],Mt|=(pe&127)<<7,pe<128)||(pe=ht[this.pos++],Mt|=(pe&127)<<14,pe<128)||(pe=ht[this.pos++],Mt|=(pe&127)<<21,pe<128)?Mt:(pe=ht[this.pos],Mt|=(pe&15)<<28,o(Mt,X,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var X=this.readVarint();return X%2===1?(X+1)/-2:X/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var X=this.readVarint()+this.pos,ht=this.pos;return this.pos=X,X-ht>=r&&s?at(this.buf,ht,X):At(this.buf,ht,X)},readBytes:function(){var X=this.readVarint()+this.pos,ht=this.buf.subarray(this.pos,X);return this.pos=X,ht},readPackedVarint:function(X,ht){if(this.type!==t.Bytes)return X.push(this.readVarint(ht));var Mt=l(this);for(X=X||[];this.pos<Mt;)X.push(this.readVarint(ht));return X},readPackedSVarint:function(X){if(this.type!==t.Bytes)return X.push(this.readSVarint());var ht=l(this);for(X=X||[];this.pos<ht;)X.push(this.readSVarint());return X},readPackedBoolean:function(X){if(this.type!==t.Bytes)return X.push(this.readBoolean());var ht=l(this);for(X=X||[];this.pos<ht;)X.push(this.readBoolean());return X},readPackedFloat:function(X){if(this.type!==t.Bytes)return X.push(this.readFloat());var ht=l(this);for(X=X||[];this.pos<ht;)X.push(this.readFloat());return X},readPackedDouble:function(X){if(this.type!==t.Bytes)return X.push(this.readDouble());var ht=l(this);for(X=X||[];this.pos<ht;)X.push(this.readDouble());return X},readPackedFixed32:function(X){if(this.type!==t.Bytes)return X.push(this.readFixed32());var ht=l(this);for(X=X||[];this.pos<ht;)X.push(this.readFixed32());return X},readPackedSFixed32:function(X){if(this.type!==t.Bytes)return X.push(this.readSFixed32());var ht=l(this);for(X=X||[];this.pos<ht;)X.push(this.readSFixed32());return X},readPackedFixed64:function(X){if(this.type!==t.Bytes)return X.push(this.readFixed64());var ht=l(this);for(X=X||[];this.pos<ht;)X.push(this.readFixed64());return X},readPackedSFixed64:function(X){if(this.type!==t.Bytes)return X.push(this.readSFixed64());var ht=l(this);for(X=X||[];this.pos<ht;)X.push(this.readSFixed64());return X},skip:function(X){var ht=X&7;if(ht===t.Varint)for(;this.buf[this.pos++]>127;);else if(ht===t.Bytes)this.pos=this.readVarint()+this.pos;else if(ht===t.Fixed32)this.pos+=4;else if(ht===t.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+ht)},writeTag:function(X,ht){this.writeVarint(X<<3|ht)},realloc:function(X){for(var ht=this.length||16;ht<this.pos+X;)ht*=2;if(ht!==this.length){var Mt=new Uint8Array(ht);Mt.set(this.buf),this.buf=Mt,this.length=ht}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(X){this.realloc(4),Lt(this.buf,X,this.pos),this.pos+=4},writeSFixed32:function(X){this.realloc(4),Lt(this.buf,X,this.pos),this.pos+=4},writeFixed64:function(X){this.realloc(8),Lt(this.buf,X&-1,this.pos),Lt(this.buf,Math.floor(X*n),this.pos+4),this.pos+=8},writeSFixed64:function(X){this.realloc(8),Lt(this.buf,X&-1,this.pos),Lt(this.buf,Math.floor(X*n),this.pos+4),this.pos+=8},writeVarint:function(X){if(X=+X||0,X>268435455||X<0){A(X,this);return}this.realloc(4),this.buf[this.pos++]=X&127|(X>127?128:0),!(X<=127)&&(this.buf[this.pos++]=(X>>>=7)&127|(X>127?128:0),!(X<=127)&&(this.buf[this.pos++]=(X>>>=7)&127|(X>127?128:0),!(X<=127)&&(this.buf[this.pos++]=X>>>7&127)))},writeSVarint:function(X){this.writeVarint(X<0?-X*2-1:X*2)},writeBoolean:function(X){this.writeVarint(!!X)},writeString:function(X){X=String(X),this.realloc(X.length*4),this.pos++;var ht=this.pos;this.pos=kt(this.buf,X,this.pos);var Mt=this.pos-ht;Mt>=128&&S(ht,Mt,this),this.pos=ht-1,this.writeVarint(Mt),this.pos+=Mt},writeFloat:function(X){this.realloc(4),e.write(this.buf,X,this.pos,!0,23,4),this.pos+=4},writeDouble:function(X){this.realloc(8),e.write(this.buf,X,this.pos,!0,52,8),this.pos+=8},writeBytes:function(X){var ht=X.length;this.writeVarint(ht),this.realloc(ht);for(var Mt=0;Mt<ht;Mt++)this.buf[this.pos++]=X[Mt]},writeRawMessage:function(X,ht){this.pos++;var Mt=this.pos;X(ht,this);var pe=this.pos-Mt;pe>=128&&S(Mt,pe,this),this.pos=Mt-1,this.writeVarint(pe),this.pos+=pe},writeMessage:function(X,ht,Mt){this.writeTag(X,t.Bytes),this.writeRawMessage(ht,Mt)},writePackedVarint:function(X,ht){ht.length&&this.writeMessage(X,L,ht)},writePackedSVarint:function(X,ht){ht.length&&this.writeMessage(X,N,ht)},writePackedBoolean:function(X,ht){ht.length&&this.writeMessage(X,j,ht)},writePackedFloat:function(X,ht){ht.length&&this.writeMessage(X,G,ht)},writePackedDouble:function(X,ht){ht.length&&this.writeMessage(X,W,ht)},writePackedFixed32:function(X,ht){ht.length&&this.writeMessage(X,q,ht)},writePackedSFixed32:function(X,ht){ht.length&&this.writeMessage(X,Z,ht)},writePackedFixed64:function(X,ht){ht.length&&this.writeMessage(X,K,ht)},writePackedSFixed64:function(X,ht){ht.length&&this.writeMessage(X,ft,ht)},writeBytesField:function(X,ht){this.writeTag(X,t.Bytes),this.writeBytes(ht)},writeFixed32Field:function(X,ht){this.writeTag(X,t.Fixed32),this.writeFixed32(ht)},writeSFixed32Field:function(X,ht){this.writeTag(X,t.Fixed32),this.writeSFixed32(ht)},writeFixed64Field:function(X,ht){this.writeTag(X,t.Fixed64),this.writeFixed64(ht)},writeSFixed64Field:function(X,ht){this.writeTag(X,t.Fixed64),this.writeSFixed64(ht)},writeVarintField:function(X,ht){this.writeTag(X,t.Varint),this.writeVarint(ht)},writeSVarintField:function(X,ht){this.writeTag(X,t.Varint),this.writeSVarint(ht)},writeStringField:function(X,ht){this.writeTag(X,t.Bytes),this.writeString(ht)},writeFloatField:function(X,ht){this.writeTag(X,t.Fixed32),this.writeFloat(ht)},writeDoubleField:function(X,ht){this.writeTag(X,t.Fixed64),this.writeDouble(ht)},writeBooleanField:function(X,ht){this.writeVarintField(X,!!ht)}};function o(X,ht,Mt){var pe=Mt.buf,Ct,Dt;if(Dt=pe[Mt.pos++],Ct=(Dt&112)>>4,Dt<128||(Dt=pe[Mt.pos++],Ct|=(Dt&127)<<3,Dt<128)||(Dt=pe[Mt.pos++],Ct|=(Dt&127)<<10,Dt<128)||(Dt=pe[Mt.pos++],Ct|=(Dt&127)<<17,Dt<128)||(Dt=pe[Mt.pos++],Ct|=(Dt&127)<<24,Dt<128)||(Dt=pe[Mt.pos++],Ct|=(Dt&1)<<31,Dt<128))return h(X,Ct,ht);throw new Error("Expected varint not more than 10 bytes")}function l(X){return X.type===t.Bytes?X.readVarint()+X.pos:X.pos+1}function h(X,ht,Mt){return Mt?ht*4294967296+(X>>>0):(ht>>>0)*4294967296+(X>>>0)}function A(X,ht){var Mt,pe;if(X>=0?(Mt=X%4294967296|0,pe=X/4294967296|0):(Mt=~(-X%4294967296),pe=~(-X/4294967296),Mt^4294967295?Mt=Mt+1|0:(Mt=0,pe=pe+1|0)),X>=18446744073709552e3||X<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ht.realloc(10),v(Mt,pe,ht),C(pe,ht)}function v(X,ht,Mt){Mt.buf[Mt.pos++]=X&127|128,X>>>=7,Mt.buf[Mt.pos++]=X&127|128,X>>>=7,Mt.buf[Mt.pos++]=X&127|128,X>>>=7,Mt.buf[Mt.pos++]=X&127|128,X>>>=7,Mt.buf[Mt.pos]=X&127}function C(X,ht){var Mt=(X&7)<<4;ht.buf[ht.pos++]|=Mt|((X>>>=3)?128:0),X&&(ht.buf[ht.pos++]=X&127|((X>>>=7)?128:0),X&&(ht.buf[ht.pos++]=X&127|((X>>>=7)?128:0),X&&(ht.buf[ht.pos++]=X&127|((X>>>=7)?128:0),X&&(ht.buf[ht.pos++]=X&127|((X>>>=7)?128:0),X&&(ht.buf[ht.pos++]=X&127)))))}function S(X,ht,Mt){var pe=ht<=16383?1:ht<=2097151?2:ht<=268435455?3:Math.floor(Math.log(ht)/(Math.LN2*7));Mt.realloc(pe);for(var Ct=Mt.pos-1;Ct>=X;Ct--)Mt.buf[Ct+pe]=Mt.buf[Ct]}function L(X,ht){for(var Mt=0;Mt<X.length;Mt++)ht.writeVarint(X[Mt])}function N(X,ht){for(var Mt=0;Mt<X.length;Mt++)ht.writeSVarint(X[Mt])}function G(X,ht){for(var Mt=0;Mt<X.length;Mt++)ht.writeFloat(X[Mt])}function W(X,ht){for(var Mt=0;Mt<X.length;Mt++)ht.writeDouble(X[Mt])}function j(X,ht){for(var Mt=0;Mt<X.length;Mt++)ht.writeBoolean(X[Mt])}function q(X,ht){for(var Mt=0;Mt<X.length;Mt++)ht.writeFixed32(X[Mt])}function Z(X,ht){for(var Mt=0;Mt<X.length;Mt++)ht.writeSFixed32(X[Mt])}function K(X,ht){for(var Mt=0;Mt<X.length;Mt++)ht.writeFixed64(X[Mt])}function ft(X,ht){for(var Mt=0;Mt<X.length;Mt++)ht.writeSFixed64(X[Mt])}function rt(X,ht){return(X[ht]|X[ht+1]<<8|X[ht+2]<<16)+X[ht+3]*16777216}function Lt(X,ht,Mt){X[Mt]=ht,X[Mt+1]=ht>>>8,X[Mt+2]=ht>>>16,X[Mt+3]=ht>>>24}function Vt(X,ht){return(X[ht]|X[ht+1]<<8|X[ht+2]<<16)+(X[ht+3]<<24)}function At(X,ht,Mt){for(var pe="",Ct=ht;Ct<Mt;){var Dt=X[Ct],Gt=null,te=Dt>239?4:Dt>223?3:Dt>191?2:1;if(Ct+te>Mt)break;var re,ae,he;te===1?Dt<128&&(Gt=Dt):te===2?(re=X[Ct+1],(re&192)===128&&(Gt=(Dt&31)<<6|re&63,Gt<=127&&(Gt=null))):te===3?(re=X[Ct+1],ae=X[Ct+2],(re&192)===128&&(ae&192)===128&&(Gt=(Dt&15)<<12|(re&63)<<6|ae&63,(Gt<=2047||Gt>=55296&&Gt<=57343)&&(Gt=null))):te===4&&(re=X[Ct+1],ae=X[Ct+2],he=X[Ct+3],(re&192)===128&&(ae&192)===128&&(he&192)===128&&(Gt=(Dt&15)<<18|(re&63)<<12|(ae&63)<<6|he&63,(Gt<=65535||Gt>=1114112)&&(Gt=null))),Gt===null?(Gt=65533,te=1):Gt>65535&&(Gt-=65536,pe+=String.fromCharCode(Gt>>>10&1023|55296),Gt=56320|Gt&1023),pe+=String.fromCharCode(Gt),Ct+=te}return pe}function at(X,ht,Mt){return s.decode(X.subarray(ht,Mt))}function kt(X,ht,Mt){for(var pe=0,Ct,Dt;pe<ht.length;pe++){if(Ct=ht.charCodeAt(pe),Ct>55295&&Ct<57344)if(Dt)if(Ct<56320){X[Mt++]=239,X[Mt++]=191,X[Mt++]=189,Dt=Ct;continue}else Ct=Dt-55296<<10|Ct-56320|65536,Dt=null;else{Ct>56319||pe+1===ht.length?(X[Mt++]=239,X[Mt++]=191,X[Mt++]=189):Dt=Ct;continue}else Dt&&(X[Mt++]=239,X[Mt++]=191,X[Mt++]=189,Dt=null);Ct<128?X[Mt++]=Ct:(Ct<2048?X[Mt++]=Ct>>6|192:(Ct<65536?X[Mt++]=Ct>>12|224:(X[Mt++]=Ct>>18|240,X[Mt++]=Ct>>12&63|128),X[Mt++]=Ct>>6&63|128),X[Mt++]=Ct&63|128)}return Mt}return YC}var swt=owt();const awt=Jh(swt),lwt="4.3.1",l5={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:lwt,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:void 0}}};({...l5});const cwt={Point:c5,MultiPoint:uwt,LineString:u5,MultiLineString:hwt,Polygon:h5,MultiPolygon:fwt};function c5([e,t],[i,n],r){const s=pl(i[0],n[0],e),o=pl(i[1],n[1],t);return r.unprojectFlat([s,o])}function qC(e,t,i){return e.map(n=>c5(n,t,i))}function uwt(e,t,i){return qC(e,t,i)}function u5(e,t,i){return qC(e,t,i)}function hwt(e,t,i){return e.map(n=>u5(n,t,i))}function h5(e,t,i){return e.map(n=>qC(n,t,i))}function fwt(e,t,i){return e.map(n=>h5(n,t,i))}function dwt(e,t,i){const n=i.projectFlat([t.west,t.north]),r=i.projectFlat([t.east,t.south]),s=[n,r];return{...e,coordinates:cwt[e.type](e.coordinates,s,i)}}const pwt=["points","lines","polygons"];function Awt(e,t,i,n){for(const r of pwt){const s=e[r]&&gwt(e[r],t,i,n);if(s>=0)return s}return-1}function gwt(e,t,i,n){const r=e.featureIds.value;if(!r.length)return-1;let s=0,o=r[r.length-1]+1;if(n){const h=mwt(e,n);if(h)s=h[0],o=h[1]+1;else return-1}let l=-1;if(t in e.numericProps){const h=e.numericProps[t].value.findIndex((A,v)=>A===i&&r[v]>=s&&r[v]<o);return h>=0?e.globalFeatureIds.value[h]:-1}else t?l=f5(e.properties,h=>h[t]===i,s,o):e.fields&&(l=f5(e.fields,h=>h.id===i,s,o));return l>=0?ywt(e,l):-1}function mwt(e,t){if(!e.__layers){const i={},{properties:n}=e;for(let r=0;r<n.length;r++){const{layerName:s}=n[r];s&&(i[s]?i[s][1]=r:i[s]=[r,r])}e.__layers=i}return e.__layers[t]}function ywt(e,t){if(!e.__ids){const i=[],n=e.featureIds.value,r=e.globalFeatureIds.value;for(let s=0;s<n.length;s++)i[n[s]]=r[s];e.__ids=i}return e.__ids[t]}function f5(e,t,i,n){for(let r=i;r<n;r++)if(t(e[r],r))return r;return-1}const $C=512,_wt={...nu.defaultProps,data:s_,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[l5],binary:!0};class Hp extends au{initializeState(){super.initializeState();const t=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:t,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){var t;return!!((t=this.state)!=null&&t.data&&super.isLoaded)}updateState({props:t,oldProps:i,context:n,changeFlags:r}){var s;r.dataChanged&&this._updateTileData(),(s=this.state)!=null&&s.data&&(super.updateState({props:t,oldProps:i,context:n,changeFlags:r}),this._setWGS84PropertyForTiles());const{highlightColor:o}=t;o!==i.highlightColor&&Array.isArray(o)&&this.setState({highlightColor:o})}async _updateTileData(){let t=this.props.data,i=null;if(typeof t=="string"&&!Jpt(t)){const{onDataLoad:n,fetch:r}=this.props;this.setState({data:null,tileJSON:null});try{i=await r(t,{propName:"data",layer:this,loaders:[]})}catch(s){this.raiseError(s,"loading TileJSON"),t=null}n&&n(i,{propName:"data",layer:this})}else t&&typeof t=="object"&&"tilejson"in t&&(i=t);i&&(t=i.tiles),this.setState({data:t,tileJSON:i})}_getTilesetOptions(){const t=super._getTilesetOptions(),i=this.state.tileJSON,{minZoom:n,maxZoom:r}=this.props;return i&&(Number.isFinite(i.minzoom)&&i.minzoom>n&&(t.minZoom=i.minzoom),Number.isFinite(i.maxzoom)&&(!Number.isFinite(r)||i.maxzoom<r)&&(t.maxZoom=i.maxzoom)),t}renderLayers(){var t;return(t=this.state)!=null&&t.data?super.renderLayers():null}getTileData(t){const{data:i,binary:n}=this.state,{index:r,signal:s}=t,o=vf(i,t);if(!o)return Promise.reject("Invalid URL");let l=this.getLoadOptions();const{fetch:h}=this.props;return l={...l,mimeType:"application/x-protobuf",mvt:{...l==null?void 0:l.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:r},gis:n?{format:"binary"}:{}},h(o,{propName:"data",layer:this,loadOptions:l,signal:s})}renderSubLayers(t){const{x:i,y:n,z:r}=t.tile.index,s=Math.pow(2,r),o=$C/s,l=-o,h=$C*i/s,A=$C*(1-n/s),v=new mn().scale([o,l,1]);t.autoHighlight=!1,this.context.viewport.resolution||(t.modelMatrix=v,t.coordinateOrigin=[h,A,0],t.coordinateSystem=qi.CARTESIAN,t.extensions=[...t.extensions||[],new W_]);const C=super.renderSubLayers(t);return this.state.binary&&!(C instanceof nu)&&Yi.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),C}_updateAutoHighlight(t){const{uniqueIdProperty:i}=this.props,{hoveredFeatureId:n,hoveredFeatureLayerName:r}=this.state,s=t.object;let o=null,l=null;s&&(o=tE(s,i),l=d5(s));let{highlightColor:h}=this.props;typeof h=="function"&&(h=h(t)),(n!==o||r!==l)&&this.setState({highlightColor:h,hoveredFeatureId:o,hoveredFeatureLayerName:l})}_isWGS84(){return!!this.context.viewport.resolution}getPickingInfo(t){const i=super.getPickingInfo(t);if(this.state.binary&&i.index!==-1){const{data:n}=t.sourceLayer.props;i.object=QC(n,{globalFeatureId:i.index})}return i.object&&!this._isWGS84()&&(i.object=A5(i.object,i.tile.bbox,this.context.viewport)),i}getSubLayerPropsByTile(t){return{highlightedObjectIndex:this.getHighlightedObjectIndex(t),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(t){const{hoveredFeatureId:i,hoveredFeatureLayerName:n,binary:r}=this.state,{uniqueIdProperty:s,highlightedFeatureId:o}=this.props,l=t.content,h=p5(o);if(!(p5(i)||h))return-1;const A=h?o:i;return Array.isArray(l)?l.findIndex(v=>{const C=tE(v,s)===A,S=h||d5(v)===n;return C&&S}):l&&r?Awt(l,s,A,h?"":n):-1}_pickObjects(t){const{deck:i,viewport:n}=this.context,r=n.width,s=n.height,o=n.x,l=n.y,h=[this.id];return i.pickObjects({x:o,y:l,width:r,height:s,layerIds:h,maxObjects:t})}getRenderedFeatures(t=null){const i=this._pickObjects(t),n=new Set,r=[];for(const s of i){const o=tE(s.object,this.props.uniqueIdProperty);o===void 0?r.push(s.object):n.has(o)||(n.add(o),r.push(s.object))}return r}_setWGS84PropertyForTiles(){const t="dataInWGS84";this.state.tileset.selectedTiles.forEach(i=>{i.hasOwnProperty(t)||Object.defineProperty(i,t,{get:()=>{if(!i.content)return null;if(this.state.binary&&Array.isArray(i.content)&&!i.content.length)return[];const{bbox:n}=i;if(i._contentWGS84===void 0&&Xpt(n)){const r=this.state.binary?QC(i.content):i.content;i._contentWGS84=r.map(s=>A5(s,n,this.context.viewport))}return i._contentWGS84}})})}}Hp.layerName="MVTLayer",Hp.defaultProps=_wt;function tE(e,t){if(e.properties&&t)return e.properties[t];if("id"in e)return e.id}function d5(e){var t;return((t=e.properties)==null?void 0:t.layerName)||null}function p5(e){return e!=null&&e!==""}function A5(e,t,i){const n={...e,geometry:{type:e.geometry.type}};return Object.defineProperty(n.geometry,"coordinates",{get:()=>dwt(e.geometry,t,i).coordinates}),n}const g5="0123456789bcdefghjkmnpqrstuvwxyz",m5={};for(let e=0;e<g5.length;e++)m5[g5.charAt(e)]=e;const vwt=-90,bwt=90,xwt=-180,wwt=180;function Cwt(e){let t=!0,i=bwt,n=vwt,r=wwt,s=xwt,o,l=0;for(let h=0,A=e.length;h<A;h++){const v=e[h].toLowerCase();l=m5[v];for(let C=4;C>=0;C--){const S=l>>C&1;t?(o=(r+s)/2,S===1?s=o:r=o):(o=(i+n)/2,S===1?n=o:i=o),t=!t}}return[n,s,i,r]}function Ewt(e){const[t,i,n,r]=Cwt(e);return[r,n,r,t,i,t,i,n,r,n]}const Bwt={getGeohash:{type:"accessor",value:e=>e.geohash}};class K_ extends dh{indexToBounds(){const{data:t,getGeohash:i}=this.props;return{data:t,_normalize:!1,positionFormat:"XY",getPolygon:(n,r)=>Ewt(i(n,r))}}}K_.layerName="GeohashLayer",K_.defaultProps=Bwt;const Twt=Object.freeze(Object.defineProperty({__proto__:null,GeohashLayer:K_,GreatCircleLayer:hw,H3ClusterLayer:d_,H3HexagonLayer:_c,MVTLayer:Hp,QuadkeyLayer:e_,S2Layer:t_,TerrainLayer:JC,Tile3DLayer:WC,TileLayer:au,TripsLayer:c_,_GeoCellLayer:dh,_Tile2DHeader:IL,_Tileset2D:l_,_WMSLayer:uw,_getURLFromTemplate:vf},Symbol.toStringTag,{value:"Module"})),y5=[0x5555555555555555n,0x3333333333333333n,0x0f0f0f0f0f0f0f0fn,0x00ff00ff00ff00ffn,0x0000ffff0000ffffn,0x00000000ffffffffn],_5=[0n,1n,2n,4n,8n,16n];function Swt(e){return BigInt(`0x${e}`)}function eE(e){return e.toString(16)}function Iwt(e){if(e.z<0||e.z>26)throw new Error("Wrong zoom");const t=BigInt(e.z);let i=BigInt(e.x)<<32n-t,n=BigInt(e.y)<<32n-t;for(let r=0;r<5;r++){const s=_5[5-r],o=y5[4-r];i=(i|i<<s)&o,n=(n|n<<s)&o}return 0x4000000000000000n|1n<<59n|t<<52n|(i|n<<1n)>>12n|0xfffffffffffffn>>t*2n}function v5(e){const t=e>>59n&7n,i=e>>57n&3n,n=e>>52n&0x1fn,r=(e&0xfffffffffffffn)<<12n;if(t!==1n&&i!==0n)throw new Error("Wrong mode");let s=r,o=r>>1n;for(let l=0;l<6;l++){const h=_5[l],A=y5[l];s=(s|s>>h)&A,o=(o|o>>h)&A}return s=s>>32n-n,o=o>>32n-n,{z:Number(n),x:Number(s),y:Number(o)}}function iE(e){return e>>52n&0x1fn}function b5(e){const t=iE(e)-1n;return e&~(0x1fn<<52n)|t<<52n|0xfffffffffffffn>>t*2n}function Mwt(e,t,i,n=[],r,s){var o;if(!e.content)return!1;e.userData||(e.userData={});const l=(o=t.get(i))==null?void 0:o[0];if(l){if(n.every(A=>A.name in l))return!1;t.clear()}const h={};for(const A of e.content){let v=A.id;const C=typeof r=="function"?r(A,{}):r;for(let W=0;W<i-1;W++)v=b5(v);const S=Number(v);if(!(S in h)){h[S]={id:v,count:0,position:[0,0]};for(const{name:W,aggregation:j}of n)j==="any"?h[S][W]=A.properties[W]:h[S][W]=0}const L=h[S].count;h[S].count+=typeof s=="function"?s(A,{}):s;const N=h[S].count,G=N-L;h[S].position[0]=(L*h[S].position[0]+G*C[0])/N,h[S].position[1]=(L*h[S].position[1]+G*C[1])/N;for(const{name:W,aggregation:j}of n){const q=h[S][W],Z=A.properties[W];j==="average"?h[S][W]=(L*q+G*Z)/N:j==="count"||j==="sum"?h[S][W]=q+Z:j==="max"?h[S][W]=Math.max(q,Z):j==="min"&&(h[S][W]=Math.min(q,Z))}}return t.set(i,Object.values(h)),!0}function Pwt(e){const t=[],i=["any","average","count","min","max","sum"];for(const n of Object.keys(e.content[0].properties)){let r=n.split("_").pop().toLowerCase();i.includes(r)||(Yi.warn(`No valid aggregation present in ${n} property`)(),r="any"),t.push({name:n,aggregation:r})}return t}function Rwt(e,t){const i={};for(const{name:n,aggregation:r}of t)if(i[n]={min:1/0,max:-1/0},r!=="any")for(const s of e)i[n].min=Math.min(i[n].min,s[n]),i[n].max=Math.max(i[n].max,s[n]);return i}const nm=new Uint16Array,x5={positions:{value:new Float32Array,size:2},properties:[],numericProps:{},featureIds:{value:nm,size:1},globalFeatureIds:{value:nm,size:1}};function Dwt(e){const t=new Float32Array(e.length*2),i=new Uint16Array(e.length);for(let n=0;n<e.length;n++)t.set(e[n].position,2*n),i[n]=n;return{shape:"binary-feature-collection",points:{type:"Point",positions:{value:t,size:2},properties:e,numericProps:{},featureIds:{value:i,size:1},globalFeatureIds:{value:i,size:1}},lines:{type:"LineString",pathIndices:{value:nm,size:1},...x5},polygons:{type:"Polygon",polygonIndices:{value:nm,size:1},primitivePolygonIndices:{value:nm,size:1},...x5}}}const Wp=512;class nE extends l_{getTileIndices(t){return super.getTileIndices(t).map(Iwt).map(i=>({q:i,i:eE(i)}))}getTileId({q:t,i}){return i||eE(t)}getTileMetadata({q:t}){return super.getTileMetadata(v5(t))}getTileZoom({q:t}){return Number(iE(t))}getParentIndex({q:t}){return{q:b5(t)}}}const w5=512;function C5(e){const{x:t,y:i,z:n}=v5(e),r=w5/(1<<n);return[t*r,w5-i*r,r]}function Owt(e,t){const[i,n,r]=C5(e);return[[i,n],[i+t*r,n-t*r]]}function E5(e,t=1){const[i,n]=Owt(e,t),[r,s]=sc(i),[o,l]=sc(n);return[o,s,o,l,r,l,r,s,o,s]}const Q_=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),B5=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);B5&&parseFloat(B5[1]);function Lwt(e){var t;globalThis.loaders||(globalThis.loaders={}),(t=globalThis.loaders).modules||(t.modules={}),Object.assign(globalThis.loaders.modules,e)}function Fwt(...e){return kwt(e)}function kwt(e){const t=e.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),i=t.reduce((s,o)=>s+o.byteLength,0),n=new Uint8Array(i);let r=0;for(const s of t)n.set(s,r),r+=s.byteLength;return n.buffer}async function Nwt(e){const t=[];for await(const i of e)t.push(i);return Fwt(...t)}function Uwt(e){return e&&typeof e=="object"&&e.isBuffer}function Z_(e){if(Uwt(e)||e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){const t=e;return new TextEncoder().encode(t).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function Y_(e){return t=>new Promise((i,n)=>e(t,(r,s)=>r?n(r):i(s)))}class Gwt{constructor(t){this.compressBatches=this.compressBatches.bind(this),this.decompressBatches=this.decompressBatches.bind(this)}async preload(t={}){Lwt(t)}async compress(t){return await this.preload(),this.compressSync(t)}async decompress(t,i){return await this.preload(),this.decompressSync(t,i)}compressSync(t){throw new Error(`${this.name}: sync compression not supported`)}decompressSync(t,i){throw new Error(`${this.name}: sync decompression not supported`)}async*compressBatches(t){const i=await this.concatenate(t);yield this.compress(i)}async*decompressBatches(t){const i=await this.concatenate(t);yield this.decompress(i)}concatenate(t){return Nwt(t)}improveError(t){return t.message.includes(this.name)||(t.message=`${this.name} ${t.message}`),t}}class zwt extends Gwt{constructor(t={}){super(t),z(this,"name","deflate"),z(this,"extensions",[]),z(this,"contentEncodings",["deflate"]),z(this,"isSupported",!0),z(this,"options"),z(this,"_chunks",[]),this.options=t}async compress(t){var i,n;if(!Q_&&(i=this.options.deflate)!=null&&i.useZlib){const r=(n=this.options.deflate)!=null&&n.gzip?await Y_(zu.gzip)(t):await Y_(zu.deflate)(t);return Z_(r)}return this.compressSync(t)}async decompress(t){var i,n;if(!Q_&&(i=this.options.deflate)!=null&&i.useZlib){const r=(n=this.options.deflate)!=null&&n.gzip?await Y_(zu.gunzip)(t):await Y_(zu.inflate)(t);return Z_(r)}return this.decompressSync(t)}compressSync(t){var i,n,r,s;if(!Q_&&(i=this.options.deflate)!=null&&i.useZlib){const h=(n=this.options.deflate)!=null&&n.gzip?zu.gzipSync(t):zu.deflateSync(t);return Z_(h)}const o=((r=this.options)==null?void 0:r.deflate)||{},l=new Uint8Array(t);return((s=this.options)!=null&&s.raw?jp.deflateRaw:jp.deflate)(l,o).buffer}decompressSync(t){var i,n,r,s;if(!Q_&&(i=this.options.deflate)!=null&&i.useZlib){const h=(n=this.options.deflate)!=null&&n.gzip?zu.gunzipSync(t):zu.inflateSync(t);return Z_(h)}const o=((r=this.options)==null?void 0:r.deflate)||{},l=new Uint8Array(t);return((s=this.options)!=null&&s.raw?jp.inflateRaw:jp.inflate)(l,o).buffer}async*compressBatches(t){var i;const n=((i=this.options)==null?void 0:i.deflate)||{},r=new jp.Deflate(n);yield*this.transformBatches(r,t)}async*decompressBatches(t){var i;const n=((i=this.options)==null?void 0:i.deflate)||{},r=new jp.Inflate(n);yield*this.transformBatches(r,t)}async*transformBatches(t,i){t.onData=this._onData.bind(this),t.onEnd=this._onEnd.bind(this);for await(const r of i){const s=new Uint8Array(r);if(!t.push(s,!1))throw new Error(`${this._getError()}write`);yield*this._getChunks()}const n=new Uint8Array(0);t.push(n,!0),yield*this._getChunks()}_onData(t){this._chunks.push(t)}_onEnd(t){if(t!==0)throw new Error(this._getError(t)+this._chunks.length)}_getChunks(){const t=this._chunks;return this._chunks=[],t}_getError(t=0){const i={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};return`${this.name}: ${i[t]}`}}class Vwt extends zwt{constructor(t){super({...t,deflate:{...t==null?void 0:t.gzip,gzip:!0}}),z(this,"name","gzip"),z(this,"extensions",["gz","gzip"]),z(this,"contentEncodings",["gzip","x-gzip"]),z(this,"isSupported",!0)}}function q_(e,t,i,n){const r=t.type===2?t.readVarint()+t.pos:t.pos+1,s=t.buf.buffer.slice(t.pos,r);if((n==null?void 0:n.compression)==="gzip"){const o=new Vwt().decompressSync(s);i.value=new e(o)}else i.value=new e(s);return t.pos=r,i.value}class QE{static read(t,i){return t.readFields(QE._readField,{key:"",value:null},i)}static _readField(t,i,n){t===1?i.key=n.readString():t===2&&(i.value=n.readString())}}class Rf{static read(t,i){return t.readFields(Rf._readField,{},i)}static _readField(t,i,n){if(t===1){const{key:r,value:s}=QE.read(n,n.readVarint()+n.pos);i[r]=s}}}class hm{static read(t,i){const{value:n,size:r}=t.readFields(hm._readField,{value:[],size:0},i);return{value:n,size:r}}static _readField(t,i,n){t===1?q_(Float64Array,n,i):t===2&&(i.size=n.readVarint(!0))}}class Ka{static read(t,i){const{value:n,size:r}=t.readFields(Ka._readField,{value:[],size:0},i);return{value:new Uint32Array(n),size:r}}static _readField(t,i,n){t===1?n.readPackedVarint(i.value):t===2&&(i.size=n.readVarint(!0))}}class fm{static read(t,i){return t.readFields(fm._readField,{id:0},i)}static _readField(t,i,n){t===1&&(i.id=n.readVarint())}}class ZE{static read(t,i){return t.readFields(ZE._readField,{value:[]},i)}static _readField(t,i,n){t===1&&q_(Float64Array,n,i)}}class Df{static read(t,i){return t.readFields(Df._readField,{key:"",value:null},i)}static _readField(t,i,n){t===1?i.key=n.readString():t===2&&(i.value=ZE.read(n,n.readVarint()+n.pos))}}class YE{static read(t,i){return t.readFields(YE._readField,{positions:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},i)}static _readField(t,i,n){if(t===1)i.positions=hm.read(n,n.readVarint()+n.pos);else if(t===2)i.globalFeatureIds=Ka.read(n,n.readVarint()+n.pos);else if(t===3)i.featureIds=Ka.read(n,n.readVarint()+n.pos);else if(t===4)i.properties.push(Rf.read(n,n.readVarint()+n.pos));else if(t===5){const r=Df.read(n,n.readVarint()+n.pos);i.numericProps[r.key]=r.value}else t===6&&i.fields.push(fm.read(n,n.readVarint()+n.pos))}}class qE{static read(t,i){return t.readFields(qE._readField,{positions:null,pathIndices:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},i)}static _readField(t,i,n){if(t===1)i.positions=hm.read(n,n.readVarint()+n.pos);else if(t===2)i.pathIndices=Ka.read(n,n.readVarint()+n.pos);else if(t===3)i.globalFeatureIds=Ka.read(n,n.readVarint()+n.pos);else if(t===4)i.featureIds=Ka.read(n,n.readVarint()+n.pos);else if(t===5)i.properties.push(Rf.read(n,n.readVarint()+n.pos));else if(t===6){const r=Df.read(n,n.readVarint()+n.pos);i.numericProps[r.key]=r.value}else t===7&&i.fields.push(fm.read(n,n.readVarint()+n.pos))}}class $E{static read(t,i){return t.readFields($E._readField,{positions:null,polygonIndices:null,globalFeatureIds:null,featureIds:null,primitivePolygonIndices:null,triangles:null,properties:[],numericProps:{},fields:[]},i)}static _readField(t,i,n){if(t===1)i.positions=hm.read(n,n.readVarint()+n.pos);else if(t===2)i.polygonIndices=Ka.read(n,n.readVarint()+n.pos);else if(t===3)i.globalFeatureIds=Ka.read(n,n.readVarint()+n.pos);else if(t===4)i.featureIds=Ka.read(n,n.readVarint()+n.pos);else if(t===5)i.primitivePolygonIndices=Ka.read(n,n.readVarint()+n.pos);else if(t===6)i.triangles=Ka.read(n,n.readVarint()+n.pos);else if(t===7)i.properties.push(Rf.read(n,n.readVarint()+n.pos));else if(t===8){const r=Df.read(n,n.readVarint()+n.pos);i.numericProps[r.key]=r.value}else t===9&&i.fields.push(fm.read(n,n.readVarint()+n.pos))}}let jwt=class _N{static read(t,i){return t.readFields(_N._readField,{points:null,lines:null,polygons:null},i)}static _readField(t,i,n){t===1?i.points=YE.read(n,n.readVarint()+n.pos):t===2?i.lines=qE.read(n,n.readVarint()+n.pos):t===3&&(i.polygons=$E.read(n,n.readVarint()+n.pos))}};class t3{static read(t,i){return t.readFields(t3._readField,{value:[]},i)}static _readField(t,i,n){t===1&&q_(BigUint64Array,n,i)}}class e3{static read(t,i){return t.readFields(e3._readField,{indices:null,properties:[],numericProps:{}},i)}static _readField(t,i,n){if(t===1)i.indices=t3.read(n,n.readVarint()+n.pos);else if(t===2)i.properties.push(Rf.read(n,n.readVarint()+n.pos));else if(t===3){const r=Df.read(n,n.readVarint()+n.pos);i.numericProps[r.key]=r.value}}}let Hwt=class vN{static read(t,i){return t.readFields(vN._readField,{scheme:0,cells:null},i)}static _readField(t,i,n){t===1?i.scheme=n.readVarint():t===2&&(i.cells=e3.read(n,n.readVarint()+n.pos))}};function $_(e,t){const i=new awt(e);return t.read(i)}function Mf(e,t){Yi.assert(e,t)}function Wwt(e,t){const{properties:i,numericProps:n}=e;return new Proxy(i[t]||{},{get(r,s){return s in n?n[s].value[t]:r[s]},has(r,s){return s in n||s in r},ownKeys(r){return[...Object.keys(n),...Reflect.ownKeys(r)]},getOwnPropertyDescriptor(r,s){return{enumerable:!0,configurable:!0}}})}function tv(e,t){return`https://unpkg.com/@deck.gl/carto@${t}/dist/${e}-worker.js`}function Jwt(e){const{cells:t,scheme:i}=e,n=t.indices.value.length,r=[];for(let s=0;s<n;s++){const o=i==="h3"?eE(t.indices.value[s]):t.indices.value[s],l={...t.properties[s]};for(const h of Object.keys(t.numericProps))l[h]=t.numericProps[h].value[s];r.push({id:o,properties:l})}return r}const T5="9.1.9",S5="cartoSpatialTile",Xwt={cartoSpatialTile:{scheme:"quadbin",workerUrl:tv(S5,T5)}},I5={name:"CARTO Spatial Tile",version:T5,id:S5,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-spatial-tile"],category:"geometry",parse:async(e,t)=>M5(e,t),parseSync:M5,worker:!0,options:Xwt};function M5(e,t){var i;if(!e)return null;const n=$_(e,Hwt),{cells:r}=n,s=(i=t==null?void 0:t.cartoSpatialTile)==null?void 0:i.scheme;return Jwt({cells:r,scheme:s})}function rm(e,t){var i,n,r;(n=(i=e==null?void 0:e.fetch)==null?void 0:i.headers)!=null&&n.Authorization||(e.fetch={...e.fetch,headers:{...(r=e.fetch)==null?void 0:r.headers,Authorization:`Bearer ${t}`}})}function Kwt(e,t){const i={};for(const{geoid:n,...r}of t.properties)n in i?Yi.warn("Duplicate geoid key in boundary mapping, using first occurance")():i[n]=r;for(const n of["points","lines","polygons"]){const r=e[n];if(r.positions.value.length===0)continue;r.properties=r.properties.map(({geoid:A})=>i[A]);const{positions:s,globalFeatureIds:o}=r;let l=null;n==="lines"&&(l=r.pathIndices.value),n==="polygons"&&(l=r.polygonIndices.value);const h=s.value.length/s.size;for(const A in t.numericProps){const v=t.numericProps[A].value,C=v.constructor,S=new C(h);if(r.numericProps[A]={value:S,size:1},l)for(let L=0;L<l.length-1;L++){const N=l[L],G=l[L+1],W=o.value[N];S.fill(v[W],N,G)}else for(let L=0;L<h;L++){const N=o.value[L];S[L]=v[N]}}}return e}const Pf={type:"object",value:null,validate:(e,t)=>t.optional&&e===null||typeof e=="object"&&Array.isArray(e.tiles)&&e.tiles.every(i=>typeof i=="string"),equal:(e,t)=>$r(e,t,2),async:!0};Ig([I5]);const P5={data:Pf,clusterLevel:{type:"number",value:5,min:1},getPosition:{type:"accessor",value:({id:e})=>E5(e,.5).slice(2,4)},getWeight:{type:"accessor",value:1},refinementStrategy:"no-overlap",tileSize:Wp};class rE extends au{initializeState(){super.initializeState(),this.state.aggregationCache=new WeakMap}renderLayers(){var t;const i=(t=this.state.tileset)==null?void 0:t.tiles.filter(L=>L.isLoaded&&L.content&&this.state.tileset.isTileVisible(L));if(!(i!=null&&i.length))return null;i.sort((L,N)=>N.zoom-L.zoom);const{zoom:n}=this.context.viewport,{clusterLevel:r,getPosition:s,getWeight:o}=this.props,{aggregationCache:l}=this.state,h=Pwt(i[0]),A=[];let v=!1;for(const L of i){const N=Math.round(n-L.zoom),G=Math.round(r)-N;let W=l.get(L.content);W||(W=new Map,l.set(L.content,W));const j=Mwt(L,W,G,h,s,o);v||(v=j),A.push(...W.get(G))}A.sort((L,N)=>Number(N.count-L.count));const C=A==null?void 0:A.map(L=>L.id);if(v||(v=!$r(C,this.state.clusterIds,1)),this.setState({clusterIds:C}),v){const L=Rwt(A,h),N=Dwt(A);N.points.attributes={stats:L},this.setState({data:N})}const S={...this.props,id:"clusters",data:this.state.data,dataComparator:(L,N)=>{var G,W,j,q;const Z=(W=(G=L==null?void 0:L.points)==null?void 0:G.properties)==null?void 0:W.map(ft=>ft.id),K=(q=(j=N==null?void 0:N.points)==null?void 0:j.properties)==null?void 0:q.map(ft=>ft.id);return $r(Z,K,1)}};return new nu(this.getSubLayerProps(S))}getPickingInfo(t){const i=t.info;if(i.index!==-1){const{data:n}=t.sourceLayer.props;i.object=QC(n,{globalFeatureId:i.index})}return i}_updateAutoHighlight(t){for(const i of this.getSubLayers())i.updateAutoHighlight(t)}filterSubLayer(){return!0}}rE.layerName="ClusterGeoJsonLayer",rE.defaultProps=P5;class oE extends Mo{getLoadOptions(){const t=super.getLoadOptions()||{},i=this.props.data;return rm(t,i.accessToken),t.cartoSpatialTile={...t.cartoSpatialTile,scheme:"quadbin"},t}renderLayers(){const t=this.props.data;if(!t)return null;const{tiles:i,maxresolution:n}=t;return[new rE(this.props,{id:`cluster-geojson-layer-${this.props.id}`,data:i,TilesetClass:nE,maxZoom:n,loadOptions:this.getLoadOptions()})]}}oE.layerName="ClusterTileLayer",oE.defaultProps=P5;const Qwt=85.051128;function Zwt({west:e,north:t,east:i,south:n},r){const s=[[t,i],[n,i],[n,e],[t,e]].map(h=>Sw(h[0],h[1],r)).map(h=>Math.max(...GAt(h).map(A=>VAt(A,Ep.rads)))*180/Math.PI),o=Math.max(...s),l=Math.min(180,o/Math.cos((t+n)/2*Math.PI/180));return{north:Math.min(t+o,Qwt),east:i+l,south:Math.max(n-o,-85.051128),west:e-l}}function R5({west:e,north:t,east:i,south:n},r){const s=Math.abs(i-e);if(s>180){const o=Math.ceil(s/180);let l=[];for(let h=0;h<o;h++){const A=e+h*180,v=Math.min(A+179.9999999,i);l=l.concat(R5({west:A,north:t,east:v,south:n},r))}return[...new Set(l)]}return NAt([[t,i],[n,i],[n,e],[t,e],[t,i]],r)}function Ywt(e){const t=aF(e),i=t.map(h=>h[0]),n=t.map(h=>h[1]),r=Math.min(...n),s=Math.min(...i),o=Math.max(...n),l=Math.max(...i);return{west:r,south:s,east:o,north:l}}const qwt=2;function sE(e,t){const i=Math.log2(t/512),n=2/3*(e.zoom-i),r=Math.log(1/Math.cos(Math.PI*e.latitude/180));return Math.max(0,Math.floor(n+r-qwt))}class $wt extends l_{getTileIndices({viewport:t,minZoom:i,maxZoom:n}){if(t.latitude===void 0)return[];const[r,s,o,l]=t.getBounds(),{tileSize:h}=this.opts;let A=sE(t,h),v;if(typeof i=="number"&&Number.isFinite(i)&&A<i)return[];if(typeof n=="number"&&Number.isFinite(n)&&A>n){A=n;const C=Sw(t.latitude,t.longitude,n);v=kAt(C,1)}else{const C=Zwt({west:r,north:l,east:o,south:s},A);v=R5(C,A)}return v.map(C=>({i:C}))}getTileId({i:t}){return t}getTileMetadata({i:t}){return{bbox:Ywt(t)}}getTileZoom({i:t}){return Tw(t)}getParentIndex(t){const i=Tw(t.i);return{i:FAt(t.i,i-1)}}}Ig([I5]);function tCt(e){return e!=null&&e!==""}const eCt={tileSize:Wp};class ev extends au{_updateAutoHighlight(t){const{hoveredFeatureId:i}=this.state,n=t.object;let r=null;if(n&&(r=n.id),i!==r){let{highlightColor:s}=this.props;typeof s=="function"&&(s=s(t)),this.setState({highlightColor:s,hoveredFeatureId:r})}}getSubLayerPropsByTile(t){return{highlightedObjectIndex:this.getHighlightedObjectIndex(t),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(t){const{hoveredFeatureId:i}=this.state,n=t.content;return!tCt(i)||!Array.isArray(n)||!this._featureInTile(t,i)?-1:n.findIndex(r=>r.id===i)}_featureInTile(t,i){const n=this.state.tileset,r=n.getTileZoom(t.index),s=t.index.q?"q":"i";let o={[s]:i},l=n.getTileZoom(o);for(;!(l<=r);)o=n.getParentIndex(o),l=n.getTileZoom(o);return o[s]===t.index[s]}}ev.layerName="SpatialIndexTileLayer",ev.defaultProps=eCt;const iCt=e=>{const{data:t}=e,{index:i}=e.tile;return!t||!t.length?null:new _c(e,{getHexagon:n=>n.id,centerHexagon:i,highPrecision:!0})},nCt={data:Pf,tileSize:Wp};class aE extends Mo{initializeState(){_c._checkH3Lib()}getLoadOptions(){const t=super.getLoadOptions()||{},i=this.props.data;return rm(t,i.accessToken),t.cartoSpatialTile={...t.cartoSpatialTile,scheme:"h3"},t}renderLayers(){const t=this.props.data;if(!t)return null;const{tiles:i}=t;let{minresolution:n,maxresolution:r}=t;this.props.minZoom&&(n=Math.max(n,sE({zoom:this.props.minZoom,latitude:0},this.props.tileSize))),this.props.maxZoom&&(r=Math.min(r,sE({zoom:this.props.maxZoom,latitude:0},this.props.tileSize)));const s=this.getSubLayerClass("spatial-index-tile",ev);return new s(this.props,{id:`h3-tile-layer-${this.props.id}`,data:i,TilesetClass:$wt,renderSubLayers:iCt,minZoom:n,maxZoom:r,loadOptions:this.getLoadOptions()})}}aE.layerName="H3TileLayer",aE.defaultProps=nCt;const rCt=`uniform heatmapUniforms {
  vec2 colorDomain;
  vec2 delta;
  float intensity;
  float opacity;
  float radiusPixels;
} heatmap;

uniform sampler2D colorTexture;

vec3 colorGradient(float value) {
  return texture(colorTexture, vec2(value, 0.5)).rgb;
}

const vec3 SHIFT = vec3(1.0, 256.0, 256.0 * 256.0);
const float MAX_VAL = SHIFT.z * 255.0;
const float SCALE = MAX_VAL / 8.0;
vec4 pack(float value) {
  return vec4(mod(vec3(value, floor(value / SHIFT.yz)), 256.0), 255.0) / 255.0;
}
float unpack(vec3 color) {
  return 255.0 * dot(color, SHIFT);
}

vec4 heatmap_sampleColor(sampler2D source, vec2 texSize, vec2 texCoord) {
  bool firstPass = (heatmap.delta.y < 0.5);
  float accumulator = 0.0;

  // Controls quality of heatmap, larger values increase quality at expense of performance
  float SUPPORT = clamp(heatmap.radiusPixels / 2.0, 8.0, 32.0);

  // Gaussian normalization parameters
  float sigma = SUPPORT / 3.0;
  float a = -0.5 / (sigma * sigma);
  float w0 = 0.3989422804014327 / sigma; // 1D normalization
  for (float t = -SUPPORT; t <= SUPPORT; t++) {
    vec2 percent = (t * heatmap.delta - 0.5) / SUPPORT;
    vec2 delta = percent * heatmap.radiusPixels / texSize;
    vec4 offsetColor = texture(source, texCoord + delta);

    // Unpack float
    float value = unpack(offsetColor.rgb);

    // Gaussian
    float weight = w0 * exp(a * t * t);
    
    accumulator += value * weight;
  }

  if (firstPass) {
    return pack(accumulator);
  }

  // Undo scaling to obtain normalized density
  float density = 10.0 * heatmap.intensity * accumulator / SCALE;
 
  // Domain also in normalized density units
  vec2 domain = heatmap.colorDomain;

  // Apply domain
  float f = (density - domain[0]) / (domain[1] - domain[0]);

  // sqrt/log scaling??
  // float f = (log(density) - log(domain[0] + 1.0)) / (log(domain[1] + 1.0) - log(domain[0] + 1.0));
  // f = sqrt(f);

  // Color map
  vec4 color = vec4(0.0);
  color.rgb = colorGradient(f);

  color.a = smoothstep(0.0, 0.1, f);
  color.a = pow(color.a, 1.0 / 2.2);
  color.a *= heatmap.opacity;

  return color;
}
`,oCt={name:"heatmap",uniformPropTypes:{colorDomain:{value:[0,1]},delta:{value:[0,1]},intensity:{value:1,min:.1,max:10},opacity:{value:1,min:0,max:1},radiusPixels:{value:20,min:0,softMax:100}},uniformTypes:{colorDomain:"vec2<f32>",delta:"vec2<f32>",intensity:"f32",opacity:"f32",radiusPixels:"f32"},getUniforms:e=>{if(!e)return{};const{colorDomain:t=[0,1],colorTexture:i,delta:n=[1,0],intensity:r=1,opacity:s=1,radiusPixels:o=20}=e;return{colorDomain:t,colorTexture:i,delta:n,intensity:r,opacity:s,radiusPixels:o}},fs:rCt,passes:[{sampler:!0,uniforms:{delta:[1,0]}},{sampler:!0,uniforms:{delta:[0,1]}}]},sCt={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};function lE(e){for(;e.parent&&!e.applyPostProcess;)e=e.parent;return e}class D5 extends Io{initializeState(){this.id=`draw-callback-${lE(this).props.id}`}_drawLayer(){lE(this).applyPostProcess()}}D5.layerName="DrawCallbackLayer";function O5(e){var t;return t=class extends e{draw(i){const{shaderModuleProps:n}=i,{picking:r}=n,s=lE(this);r.isActive||s.enableRTT(i),super.draw(i),r.isActive||s.disableRTT()}},t.layerName=`RTT-${e.layerName}`,t}function L5(e,t){var i;return i=class extends e{initializeState(n){super.initializeState(n),this._createTextures(),this.internalState.postProcess=new bQ(t,this.props),this.internalState.postProcess.setup(n)}updateState(n){super.updateState(n),this.internalState.postProcess.setProps(this.props)}renderLayers(){let n=super.renderLayers();return n?(n=Array.isArray(n)?n:[n],[...n,new D5]):null}_createTextures(){const{device:n}=this.context;this.internalState.renderBuffers=[0,1].map(r=>n.createFramebuffer({id:`layer-fbo-${r}`,colorAttachments:[n.createTexture(sCt)],depthStencilAttachment:"depth16unorm"}))}_resizeBuffers(n){const{shaderModuleProps:r}=n,{viewport:s}=this.context,{devicePixelRatio:o}=r.project,l=o*s.width,h=o*s.height;this.internalState.renderBuffers.forEach(A=>A.resize({width:l,height:h}))}enableRTT(n){this._resizeBuffers(n),this.internalState.originalRenderPass=this.context.renderPass;const[r]=this.internalState.renderBuffers;this.internalState.internalRenderPass=this.context.device.beginRenderPass({framebuffer:r,parameters:{viewport:[0,0,r.width,r.height]},clearColor:this.internalState.renderInProgress?!1:[0,0,0,0]}),this.internalState.renderInProgress=!0,this.context.renderPass=this.internalState.internalRenderPass}disableRTT(){this.internalState.internalRenderPass.end(),this.context.renderPass=this.internalState.originalRenderPass}applyPostProcess(){if(!this.internalState.renderInProgress)return;const[n,r]=this.internalState.renderBuffers,{framebuffer:s}=this.context.renderPass.props;this.internalState.postProcess.postRender({inputBuffer:n,swapBuffer:r,target:s}),this.internalState.renderInProgress=!1}_finalize(){this.internalState.renderBuffers.forEach(n=>{n.destroy()}),this.internalState.renderBuffers=null,this.internalState.postProcess.cleanup()}},i.layerName=`PostProcess${e.layerName}`,i}const aCt=`vec4 copy_filterColor_ext(vec4 color, vec2 texSize, vec2 texCoord) {
  return color;
}
`,lCt={name:"copy",fs:aCt,getUniforms:()=>({}),passes:[{filter:!0}]},cCt={getQuadbin:{type:"accessor",value:e=>e.quadbin}};class cE extends dh{indexToBounds(){const{data:t,extruded:i,getQuadbin:n}=this.props,r=i?.99:1;return{data:t,_normalize:!1,positionFormat:"XY",getPolygon:(s,o)=>E5(n(s,o),r),updateTriggers:{getPolygon:r}}}}cE.layerName="QuadbinLayer",cE.defaultProps=cCt;const uCt=e=>{const{data:t}=e;if(!t||!t.length)return null;const i=typeof t[0].id=="bigint";return new cE(e,{getQuadbin:i?n=>n.id:n=>Swt(n.id)})},hCt={data:Pf,tileSize:Wp};class iv extends Mo{getLoadOptions(){const t=super.getLoadOptions()||{},i=this.props.data;return rm(t,i.accessToken),t.cartoSpatialTile={...t.cartoSpatialTile,scheme:"quadbin"},t}renderLayers(){const t=this.props.data;if(!t)return null;const{tiles:i,maxresolution:n}=t,r=this.getSubLayerClass("spatial-index-tile",ev);return new r(this.props,{id:`quadbin-tile-layer-${this.props.id}`,data:i,TilesetClass:nE,renderSubLayers:uCt,maxZoom:n,loadOptions:this.getLoadOptions()})}}iv.layerName="QuadbinTileLayer",iv.defaultProps=hCt;const fCt=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]],dCt={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};function F5(e){const t=Number(iE(e));return Math.pow(4,t)}function pCt(e){const t=new Uint8Array(e.length*4);let i=0;for(let n=0;n<e.length;n++){const r=e[n];t[i++]=r[0],t[i++]=r[1],t[i++]=r[2],t[i++]=Number.isFinite(r[3])?r[3]:255}return t}const ACt=`uniform densityUniforms {
  float factor;
} density;
`,gCt={name:"density",vs:ACt,uniformTypes:{factor:"f32"}};class k5 extends O5(hh){getShaders(t){const i=super.getShaders(t);return i.inject={"vs:#main-end":`
      // Value from getWeight accessor
  float weight = elevations;

  // Keep "power" delivered to screen constant when tiles update
  // by outputting normalized density
  weight *= density.factor;

  // Pack float into 3 channels to pass to heatmap shader
  // SCALE value important, as we don't want to saturate
  // but also want enough definition to avoid banding
  const vec3 SHIFT = vec3(1.0, 256.0, 256.0 * 256.0);
  const float MAX_VAL = SHIFT.z * 255.0;
  const float SCALE = MAX_VAL / 8.0;
  weight *= SCALE;
  weight = clamp(weight, 0.0, MAX_VAL);
  vColor = vec4(mod(vec3(weight, floor(weight / SHIFT.yz)), 256.0), 255.0) / 255.0;
`},i.modules=[...i.modules,gCt],i}draw(t){const i=this.props.data[0],n=this.props.elevationScale,r={factor:F5(i.id)/n};for(const s of this.state.models)s.shaderInputs.setProps({density:r});super.draw(t)}}k5.layerName="RTTSolidPolygonLayer";const mCt=L5(iv,oCt),yCt={data:Pf,getWeight:{type:"accessor",value:1},onMaxDensityChange:{type:"function",optional:!0,value:null},colorDomain:{type:"array",value:[0,1]},colorRange:fCt,intensity:{type:"number",value:1},radiusPixels:{type:"number",min:0,max:100,value:20}};class uE extends Mo{initializeState(){this.state={isLoaded:!1,tiles:new Set,viewportChanged:!1}}shouldUpdateState({changeFlags:t}){const{viewportChanged:i}=t;return this.setState({viewportChanged:i}),t.somethingChanged}updateState(t){const{props:i,oldProps:n}=t;super.updateState(t),i.colorRange!==n.colorRange&&this._updateColorTexture(t)}renderLayers(){var t,i,n;const{data:r,getWeight:s,colorDomain:o,intensity:l,radiusPixels:h,_subLayerProps:A,updateTriggers:v,onMaxDensityChange:C,onViewportLoad:S,onTileLoad:L,onTileUnload:N,...G}=this.props,W={...A,cell:{...A==null?void 0:A.cell,_subLayerProps:{...(t=A==null?void 0:A.cell)==null?void 0:t._subLayerProps,fill:{...(n=(i=A==null?void 0:A.cell)==null?void 0:i._subLayerProps)==null?void 0:n.fill,type:k5}}}};let j=0,q=0;const Z=[...this.state.tiles].filter(Lt=>Lt.content),K=Z.filter(Lt=>Lt.isVisible),ft=K.length?K:Z;for(const Lt of ft){const Vt=Lt.content[0],At=F5(Vt.id);q=Math.max(Lt.userData.maxWeight*At,q),j=Math.max(Lt.zoom,j)}const rt=this.context.viewport.zoom-j;return q=q*Math.pow(2,rt),typeof C=="function"&&C(q),new mCt(G,this.getSubLayerProps({id:"heatmap",data:r,getFillColor:0,getElevation:s,elevationScale:q,colorDomain:o,radiusPixels:h,intensity:l,_subLayerProps:W,refinementStrategy:"no-overlap",colorTexture:this.state.colorTexture,extruded:!1,stroked:!1,updateTriggers:{getElevation:v.getWeight},onViewportLoad:Lt=>{this.setState({isLoaded:!0}),typeof S=="function"&&S(Lt)},onTileLoad:Lt=>{let Vt=-1/0;if(typeof s!="function")Vt=s;else if(Lt.content)for(const At of Lt.content)Vt=Math.max(s(At,{}),Vt);Lt.userData={maxWeight:Vt},this.state.tiles.add(Lt),typeof L=="function"&&L(Lt)},onTileUnload:Lt=>{this.state.tiles.delete(Lt),typeof N=="function"&&N(Lt)},transitions:{elevationScale:{type:"spring",stiffness:.3,damping:.5}}}))}_updateColorTexture(t){const{colorRange:i}=t.props;let{colorTexture:n}=this.state;const r=pCt(i);n&&(n==null?void 0:n.width)===i.length?n.setTexture2DData({data:r}):(n==null||n.destroy(),n=this.context.device.createTexture({...dCt,data:r,width:i.length,height:1})),this.setState({colorTexture:n})}}uE.layerName="HeatmapTileLayer",uE.defaultProps=yCt;const[N5,U5,G5,z5]=[0,1,2,3];class V5 extends Fg{getShaders(){const t=super.getShaders();let i=t.vs;return i=i.replaceAll("textBackground.padding.","_padding."),i=i.replace("void main(void) {",`void main(void) {
  vec4 _padding = textBackground.padding + instancePixelOffsets.xyxy * vec4(1.0, 1.0, -1.0, -1.0);`),{...t,vs:i}}}V5.layerName="EnhancedTextBackgroundLayer";class j5 extends mf{filterSubLayer({layer:t,renderPass:i}){const n=t.id.includes("primary-background");return i==="collision"?n:!n}}j5.layerName="EnhancedTextLayer";const _Ct={...mf.defaultProps,getRadius:{type:"accessor",value:1},radiusScale:{type:"number",min:0,value:1}};class nv extends Mo{calculatePixelOffset(t){const{getTextAnchor:i,getAlignmentBaseline:n,getRadius:r,getSecondaryText:s,radiusScale:o,secondarySizeScale:l,sizeScale:h}=this.props,A=i==="middle"?0:i==="start"?1:-1,v=n==="center"?0:n==="bottom"?1:-1,C=h/4,S=h*(1+1/4),L=.6*(1-v)*h;let N=t?L:0;i==="middle"&&n==="top"&&s&&(N-=L,N-=l,N+=h);const G=1+1/4;return typeof r=="function"?(W,j)=>{const q=(j?r(W,j):1)*o*G;return[A*(q+C),v*(q+S)+N]}:[A*(r*o*G+C),v*(r*o*G+S)+N]}calculateBackgroundPadding(){const{getTextAnchor:t,getAlignmentBaseline:i,sizeScale:n}=this.props,r=12*n,s=3*n,o=[0,0,0,0];return i==="top"?o[U5]=s:i==="bottom"?o[z5]=s:(o[U5]=.5*s,o[z5]=.5*s),t==="start"?o[N5]=r:t==="end"?o[G5]=r:(o[N5]=.5*r,o[G5]=.5*r),o}renderTextLayer(t,{updateTriggers:i={},...n}){const{data:r,characterSet:s,fontFamily:o,fontSettings:l,fontWeight:h,outlineColor:A,outlineWidth:v,sizeScale:C,radiusScale:S,getAlignmentBaseline:L,getColor:N,getPosition:G,getTextAnchor:W,updateTriggers:j}=this.props;return new j5(this.getSubLayerProps({id:t,data:r,characterSet:s,fontFamily:o,fontSettings:l,fontWeight:h,outlineColor:A,outlineWidth:v,sizeScale:C,getAlignmentBaseline:L,getColor:N,getPosition:G,getTextAnchor:W,updateTriggers:{...j,...i,getPixelOffset:[j.getRadius,j.getTextAnchor,j.getAlignmentBaseline,S,C]}}),{getSize:1,_subLayerProps:{background:{type:V5}}},n)}renderLayers(){const{getText:t,getSecondaryColor:i,getSecondaryText:n,secondaryOutlineColor:r,secondarySizeScale:s,updateTriggers:o}=this.props,l=this.calculatePixelOffset(!1),h=this.calculateBackgroundPadding();return[this.renderTextLayer(`${o.getText}-primary`,{backgroundPadding:h,getText:t,getPixelOffset:l,background:!0}),!!n&&this.renderTextLayer(`${o.getSecondaryText}-secondary`,{getText:n,getPixelOffset:this.calculatePixelOffset(!0),getAlignmentBaseline:"top",...i&&{getColor:i},...s&&{sizeScale:s},...r&&{outlineColor:r}})]}}nv.layerName="PointLabelLayer",nv.defaultProps=_Ct;const vCt=`#version 300 es
#define SHADER_NAME raster-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in float instanceElevations;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif
void main(void) {
vec2 tileOrigin = column.offset.xy;
float scale = column.widthScale;
int yIndex = - (gl_InstanceID / BLOCK_WIDTH);
int xIndex = gl_InstanceID + (yIndex * BLOCK_WIDTH);
vec2 cellCenter = scale * vec2(float(xIndex) + 0.5, float(yIndex) - 0.5);
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float cellWidth = column.coverage * scale;
geometry.position = vec4(tileOrigin, 0.0, 1.0);
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
geometry.position.xyz -= project.commonOrigin;
}
geometry.position.xy += cellCenter;
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float halfOffset = project_pixel_size(column.widthScale) / cellWidth;
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
geometry.pickingColor = instancePickingColors;
vec2 base = positions.xy * scale * strokeOffsetRatio * column.coverage * shouldRender;
vec3 cell = vec3(base, project_size(elevation));
DECKGL_FILTER_SIZE(cell, geometry);
geometry.position.xyz += cell;
gl_Position = project_common_position_to_clipspace(geometry.position);
geometry.normal = project_normal(normals);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,bCt={...dc.defaultProps,extruded:!1,diskResolution:4,vertices:[[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]};class H5 extends O5(dc){getShaders(){const t=super.getShaders(),i=this.props.data,n=i.data.blockSize??Math.sqrt(i.length);return{...t,defines:{...t.defines,BLOCK_WIDTH:n},vs:vCt}}initializeState(){this.getAttributeManager().addInstanced({instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:[255,255,255,255]}})}}H5.layerName="RasterColumnLayer";function xCt(e,t){return e.data===t.data&&e.length===t.length}class hE extends Mo{renderLayers(){const{data:t,getElevation:i,getFillColor:n,getLineColor:r,getLineWidth:s,tileIndex:o,updateTriggers:l}=this.props;if(!t||!o)return null;const h=t.blockSize??0,[A,v,C]=C5(o),S=[A,v],L=C/h,N=this.getSubLayerClass("column",H5),{highlightedObjectIndex:G,highlightColor:W}=this.state;return new N(this.props,this.getSubLayerProps({id:"cell",updateTriggers:l,getElevation:this.getSubLayerAccessor(i),getFillColor:this.getSubLayerAccessor(n),getLineColor:this.getSubLayerAccessor(r),getLineWidth:this.getSubLayerAccessor(s)}),{data:{data:t,length:h*h},dataComparator:xCt,offset:S,lineWidthScale:L,highlightedObjectIndex:G,highlightColor:W,parameters:{blendColorSrcFactor:"one",blendAlphaSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaDstFactor:"zero",blendColorOperation:"add",blendAlphaOperation:"add"}})}getSubLayerAccessor(t){return typeof t!="function"?super.getSubLayerAccessor(t):(i,n)=>{const{data:r,index:s}=n,o=r.data,l=Wwt(o.cells,s);return t({properties:l},n)}}getPickingInfo(t){const i=super.getPickingInfo(t);return i.index!==-1&&(i.object=this.getSubLayerAccessor(n=>n)(void 0,{data:this.props,index:i.index})),i}_updateAutoHighlight(t){const{highlightedObjectIndex:i}=this.state;let n=-1;if(t.index!==-1&&(n=t.index),i!==n){let{highlightColor:r}=this.props;typeof r=="function"&&(r=r(t)),this.setState({highlightColor:r,highlightedObjectIndex:n})}}}hE.layerName="RasterLayer",hE.defaultProps=bCt;const wCt={uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array,uint64:BigUint64Array,int8:Int8Array,int16:Int16Array,int32:Int32Array,int64:BigInt64Array,float32:Float32Array,float64:Float64Array};class i3{static read(t,i){return t.readFields(i3._readField,{name:"",type:"",data:null},i)}static _readField(t,i,n){if(t===1)i.name=n.readString();else if(t===2)i.type=n.readString();else if(t===3){const r=wCt[i.type];if(!r)throw Error(`Invalid data type: ${i.type}`);i.data={};const{compression:s}=fE;q_(r,n,i.data,{compression:s})}}}let fE=class bN{static read(t,i){return t.readFields(bN._readField,{blockSize:0,bands:[]},i)}static _readField(t,i,n){t===1?i.blockSize=n.readVarint():t===2&&i.bands.push(i3.read(n,n.readVarint()+n.pos))}};const W5="9.1.9",J5="cartoRasterTile",CCt={cartoRasterTile:{metadata:null,workerUrl:tv(J5,W5)}},ECt={name:"CARTO Raster Tile",version:W5,id:J5,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-raster-tile"],category:"geometry",parse:async(e,t)=>X5(e,t),parseSync:X5,worker:!0,options:CCt};function X5(e,t){var i;const n=(i=t==null?void 0:t.cartoRasterTile)==null?void 0:i.metadata;if(!e||!n)return null;fE.compression=n.compression;const r=$_(e,fE),{bands:s,blockSize:o}=r,l={};for(let h=0;h<s.length;h++){const{name:A,data:v}=s[h];l[A]=v}return{blockSize:o,cells:{numericProps:l,properties:[]}}}Ig([ECt]);const BCt=e=>{var t,i;const n=(i=(t=e.tile)==null?void 0:t.index)==null?void 0:i.q;return n?new hE(e,{tileIndex:n}):null},TCt={data:Pf,refinementStrategy:"no-overlap",tileSize:Wp};class SCt extends L5(au,lCt){filterSubLayer(t){const{tile:i}=t.layer.props;return i?super.filterSubLayer(t):!0}}class dE extends Mo{getLoadOptions(){const t=super.getLoadOptions()||{},i=this.props.data;return rm(t,i.accessToken),t}renderLayers(){const t=this.props.data;if(!t)return null;const{tiles:i,minzoom:n,maxzoom:r,raster_metadata:s}=t,o=this.getSubLayerClass("tile",SCt),l=this.getLoadOptions();return new o(this.props,{id:`raster-tile-layer-${this.props.id}`,data:i,TilesetClass:nE,renderSubLayers:BCt,minZoom:n,maxZoom:r,loadOptions:{...l,cartoRasterTile:{...l==null?void 0:l.cartoRasterTile,metadata:s}}})}}dE.layerName="RasterTileLayer",dE.defaultProps=TCt;class n3{static read(t,i){return t.readFields(n3._readField,{properties:[],numericProps:{}},i)}static _readField(t,i,n){if(t===1)i.properties.push(Rf.read(n,n.readVarint()+n.pos));else if(t===2){const r=Df.read(n,n.readVarint()+n.pos);i.numericProps[r.key]=r.value}}}const K5="9.1.9",Q5="cartoPropertiesTile",ICt={cartoPropertiesTile:{workerUrl:tv(Q5,K5)}},MCt={name:"CARTO Properties Tile",version:K5,id:Q5,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-properties-tile"],category:"geometry",worker:!0,parse:async(e,t)=>Z5(e),parseSync:Z5,options:ICt};function Z5(e,t){return e?$_(e,n3):null}const Y5="9.1.9",q5="cartoVectorTile",PCt={cartoVectorTile:{workerUrl:tv(q5,Y5)}},RCt={name:"CARTO Vector Tile",version:Y5,id:q5,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-vector-tile"],category:"geometry",parse:async(e,t)=>$5(e),parseSync:$5,worker:!0,options:PCt};function DCt(e,t,{startPosition:i,endPosition:n,indices:r}){const s=e.positions.size,o=i*s,l=n*s,h=e.positions.value.subarray(o,l),A=r.slice(1).map(C=>C-i),v=AO(h,A,s);for(let C=0,S=v.length;C<S;++C)t.push(i+v[C])}function OCt(e){const{polygonIndices:t,primitivePolygonIndices:i}=e,n=[];let r=0;for(let s=0;s<t.value.length-1;s++){const o=t.value[s],l=t.value[s+1],h=i.value.indexOf(l),A=i.value.subarray(r,h);r=h,DCt(e,n,{startPosition:o,endPosition:l,indices:A})}e.triangles={value:new Uint32Array(n),size:1}}function $5(e,t){if(!e)return null;const i=$_(e,jwt);return i.polygons&&!i.polygons.triangles&&OCt(i.polygons),i}Ig([MCt,RCt]);const LCt={...Hp.defaultProps,data:Pf,dataComparator:Pf.equal,tileSize:Wp};class pE extends Hp{constructor(...t){super(...t)}initializeState(){super.initializeState(),this.setState({binary:!0})}updateState(t){const{props:i}=t;if(i.data){super.updateState(t);const n=new URL(i.data.tiles[0]).searchParams.get("formatTiles")==="mvt";this.setState({mvt:n})}}getLoadOptions(){const t=super.getLoadOptions()||{},i=this.props.data;return rm(t,i.accessToken),t.gis={format:"binary"},t}async getTileData(t){const i=this.props.data,{tiles:n,properties_tiles:r}=i,s=vf(n,t);if(!s)return Promise.reject("Invalid URL");const o=this.getLoadOptions(),{fetch:l}=this.props,{signal:h}=t,A=l(s,{propName:"data",layer:this,loadOptions:o,signal:h});if(!r)return await A;const v=vf(r,t);if(!v)return Promise.reject("Invalid properties URL");const C=l(v,{propName:"data",layer:this,loadOptions:o,signal:h}),[S,L]=await Promise.all([A,C]);return S?L?Kwt(S,L):S:null}renderSubLayers(t){var i,n,r;if(t.data===null)return null;if(this.state.mvt)return super.renderSubLayers(t);const s=t.tile.bbox,{west:o,south:l,east:h,north:A}=s,v=[new W_,...t.extensions||[]],C={clipBounds:[o,l,h,A]},S=G=>{var W,j,q;return{[G]:{...C,...(W=t==null?void 0:t._subLayerProps)==null?void 0:W[G],extensions:[...v,...((q=(j=t==null?void 0:t._subLayerProps)==null?void 0:j[G])==null?void 0:q.extensions)||[]]}}},L={"points-text":{type:nv,...(i=t==null?void 0:t._subLayerProps)==null?void 0:i["points-text"],extensions:[new KC,...t.extensions||[],...((r=(n=t==null?void 0:t._subLayerProps)==null?void 0:n["points-text"])==null?void 0:r.extensions)||[]]}},N={...t,autoHighlight:!1,_subLayerProps:{...t._subLayerProps,...L,...S("polygons-fill"),...S("polygons-stroke"),...S("linestrings")}};return new nu(N)}_isWGS84(){return this.state.mvt?super._isWGS84():!0}}pE.layerName="VectorTileLayer",pE.defaultProps=LCt;var Rn={YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}},FCt={2:["#ffc6c4","#672044"],3:["#ffc6c4","#cc607d","#672044"],4:["#ffc6c4","#e38191","#ad466c","#672044"],5:["#ffc6c4","#ee919b","#cc607d","#9e3963","#672044"],6:["#ffc6c4","#f29ca3","#da7489","#b95073","#93345d","#672044"],7:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],tags:["quantitative"]},kCt={2:["#fbe6c5","#70284a"],3:["#fbe6c5","#dc7176","#70284a"],4:["#fbe6c5","#ee8a82","#c8586c","#70284a"],5:["#fbe6c5","#f2a28a","#dc7176","#b24b65","#70284a"],6:["#fbe6c5","#f4b191","#e7807d","#d06270","#a44360","#70284a"],7:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],tags:["quantitative"]},NCt={2:["#f6d2a9","#b13f64"],3:["#f6d2a9","#ea8171","#b13f64"],4:["#f6d2a9","#f19c7c","#dd686c","#b13f64"],5:["#f6d2a9","#f3aa84","#ea8171","#d55d6a","#b13f64"],6:["#f6d2a9","#f4b28a","#ef9177","#e3726d","#cf5669","#b13f64"],7:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],tags:["quantitative"]},UCt={2:["#ecda9a","#ee4d5a"],3:["#ecda9a","#f7945d","#ee4d5a"],4:["#ecda9a","#f3ad6a","#f97b57","#ee4d5a"],5:["#ecda9a","#f1b973","#f7945d","#f86f56","#ee4d5a"],6:["#ecda9a","#f0c079","#f5a363","#f98558","#f76856","#ee4d5a"],7:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],tags:["quantitative"]},GCt={2:["#fde0c5","#eb4a40"],3:["#fde0c5","#f59e72","#eb4a40"],4:["#fde0c5","#f8b58b","#f2855d","#eb4a40"],5:["#fde0c5","#f9c098","#f59e72","#f17854","#eb4a40"],6:["#fde0c5","#fac7a1","#f7ac80","#f38f65","#f0704f","#eb4a40"],7:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],tags:["quantitative"]},zCt={2:["#fef6b5","#e15383"],3:["#fef6b5","#ffa679","#e15383"],4:["#fef6b5","#ffc285","#fa8a76","#e15383"],5:["#fef6b5","#ffd08e","#ffa679","#f67b77","#e15383"],6:["#fef6b5","#ffd795","#ffb77f","#fd9576","#f37378","#e15383"],7:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],tags:["quantitative"]},VCt={2:["#e4f1e1","#0d585f"],3:["#e4f1e1","#63a6a0","#0d585f"],4:["#e4f1e1","#89c0b6","#448c8a","#0d585f"],5:["#E4F1E1","#9CCDC1","#63A6A0","#337F7F","#0D585F"],6:["#e4f1e1","#abd4c7","#7ab5ad","#509693","#2c7778","#0d585f"],7:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],tags:["quantitative"]},jCt={2:["#c4e6c3","#1d4f60"],3:["#c4e6c3","#4da284","#1d4f60"],4:["#c4e6c3","#6dbc90","#36877a","#1d4f60"],5:["#c4e6c3","#80c799","#4da284","#2d7974","#1d4f60"],6:["#c4e6c3","#8dce9f","#5fb28b","#3e927e","#297071","#1d4f60"],7:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],tags:["quantitative"]},HCt={2:["#d2fbd4","#123f5a"],3:["#d2fbd4","#559c9e","#123f5a"],4:["#d2fbd4","#7bbcb0","#3a7c89","#123f5a"],5:["#d2fbd4","#8eccb9","#559c9e","#2b6c7f","#123f5a"],6:["#d2fbd4","#9cd5be","#6cafa9","#458892","#266377","#123f5a"],7:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],tags:["quantitative"]},WCt={2:["#d3f2a3","#074050"],3:["#d3f2a3","#4c9b82","#074050"],4:["#d3f2a3","#6cc08b","#217a79","#074050"],5:["#d3f2a3","#82d091","#4c9b82","#19696f","#074050"],6:["#d3f2a3","#8fda94","#60b187","#35877d","#145f69","#074050"],7:["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],tags:["quantitative"]},JCt={2:["#245668","#EDEF5D"],3:["#245668","#39AB7E","#EDEF5D"],4:["#245668","#0D8F81","#6EC574","#EDEF5D"],5:["#245668","#04817E","#39AB7E","#8BD16D","#EDEF5D"],6:["#245668","#09787C","#1D9A81","#58BB79","#9DD869","#EDEF5D"],7:["#245668","#0F7279","#0D8F81","#39AB7E","#6EC574","#A9DC67","#EDEF5D"],tags:["aggregation"]},XCt={2:["#f7feae","#045275"],3:["#f7feae","#46aea0","#045275"],4:["#f7feae","#7ccba2","#089099","#045275"],5:["#f7feae","#9bd8a4","#46aea0","#058092","#045275"],6:["#f7feae","#ace1a4","#68bfa1","#2a9c9c","#02778e","#045275"],7:["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],tags:["quantitative"]},KCt={2:["#d1eeea","#2a5674"],3:["#d1eeea","#68abb8","#2a5674"],4:["#d1eeea","#85c4c9","#4f90a6","#2a5674"],5:["#d1eeea","#96d0d1","#68abb8","#45829b","#2a5674"],6:["#d1eeea","#a1d7d6","#79bbc3","#599bae","#3f7994","#2a5674"],7:["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],tags:["quantitative"]},QCt={2:["#b0f2bc","#257d98"],3:["#b0f2bc","#4cc8a3","#257d98"],4:["#b0f2bc","#67dba5","#38b2a3","#257d98"],5:["#b0f2bc","#77e2a8","#4cc8a3","#31a6a2","#257d98"],6:["#b0f2bc","#82e6aa","#5bd4a4","#3fbba3","#2e9ea1","#257d98"],7:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],tags:["quantitative"]},ZCt={2:["#f3e0f7","#63589f"],3:["#f3e0f7","#b998dd","#63589f"],4:["#f3e0f7","#d1afe8","#9f82ce","#63589f"],5:["#f3e0f7","#dbbaed","#b998dd","#9178c4","#63589f"],6:["#f3e0f7","#e0c2ef","#c8a5e4","#aa8bd4","#8871be","#63589f"],7:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],tags:["quantitative"]},YCt={2:["#f9ddda","#573b88"],3:["#f9ddda","#ce78b3","#573b88"],4:["#f9ddda","#e597b9","#ad5fad","#573b88"],5:["#f9ddda","#eda8bd","#ce78b3","#9955a8","#573b88"],6:["#f9ddda","#f0b2c1","#dd8ab6","#bb69b0","#8c4fa4","#573b88"],7:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],tags:["quantitative"]},qCt={2:["#f3e79b","#5c53a5"],3:["#f3e79b","#eb7f86","#5c53a5"],4:["#f3e79b","#f8a07e","#ce6693","#5c53a5"],5:["#f3e79b","#fab27f","#eb7f86","#b95e9a","#5c53a5"],6:["#f3e79b","#fabc82","#f59280","#dc6f8e","#ab5b9e","#5c53a5"],7:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],tags:["quantitative"]},$Ct={2:["#f3cbd3","#6c2167"],3:["#f3cbd3","#ca699d","#6c2167"],4:["#f3cbd3","#dd88ac","#b14d8e","#6c2167"],5:["#f3cbd3","#e498b4","#ca699d","#a24186","#6c2167"],6:["#f3cbd3","#e7a2b9","#d67ba5","#bc5894","#983a81","#6c2167"],7:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],tags:["quantitative"]},tEt={2:["#fcde9c","#7c1d6f"],3:["#fcde9c","#e34f6f","#7c1d6f"],4:["#fcde9c","#f0746e","#dc3977","#7c1d6f"],5:["#fcde9c","#f58670","#e34f6f","#d72d7c","#7c1d6f"],6:["#fcde9c","#f89872","#ec666d","#df4273","#c5287b","#7c1d6f"],7:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],tags:["quantitative"]},eEt={2:["#4b2991","#edd9a3"],3:["#4b2991","#ea4f88","#edd9a3"],4:["#4b2991","#c0369d","#fa7876","#edd9a3"],5:["#4b2991","#a52fa2","#ea4f88","#fa9074","#edd9a3"],6:["#4b2991","#932da3","#d43f96","#f7667c","#f89f77","#edd9a3"],7:["#4b2991","#872ca2","#c0369d","#ea4f88","#fa7876","#f6a97a","#edd9a3"],tags:["aggregation"]},iEt={2:["#ede5cf","#541f3f"],3:["#ede5cf","#c1766f","#541f3f"],4:["#ede5cf","#d39c83","#a65461","#541f3f"],5:["#ede5cf","#daaf91","#c1766f","#95455a","#541f3f"],6:["#ede5cf","#ddba9b","#cd8c7a","#b26166","#8a3c56","#541f3f"],7:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],tags:["quantitative"]},nEt={2:["#929b4f","#db8195"],3:["#a3ad62","#fdfbe4","#df91a3"],4:["#929b4f","#d9dbaf","#f3d1ca","#db8195"],5:["#879043","#c1c68c","#fdfbe4","#ebb4b8","#d8758b"],6:["#7f883b","#b0b874","#e3e4be","#f6ddd1","#e4a0ac","#d66d85"],7:["#798234","#a3ad62","#d0d3a2","#fdfbe4","#f0c6c3","#df91a3","#d46780"],tags:["diverging"]},rEt={2:["#3d5941","#ca562c"],3:["#3d5941","#f6edbd","#ca562c"],4:["#3d5941","#b5b991","#edbb8a","#ca562c"],5:["#3d5941","#96a07c","#f6edbd","#e6a272","#ca562c"],6:["#3d5941","#839170","#cecea2","#f1cf9e","#e19464","#ca562c"],7:["#3d5941","#778868","#b5b991","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},oEt={2:["#008080","#ca562c"],3:["#008080","#f6edbd","#ca562c"],4:["#008080","#b4c8a8","#edbb8a","#ca562c"],5:["#008080","#92b69e","#f6edbd","#e6a272","#ca562c"],6:["#008080","#7eab98","#ced7b1","#f1cf9e","#e19464","#ca562c"],7:["#008080","#70a494","#b4c8a8","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},sEt={2:["#009392","#cf597e"],3:["#009392","#e9e29c","#cf597e"],4:["#009392","#9ccb86","#eeb479","#cf597e"],5:["#009392","#71be83","#e9e29c","#ed9c72","#cf597e"],6:["#009392","#52b684","#bcd48c","#edc783","#eb8d71","#cf597e"],7:["#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"],tags:["diverging"]},aEt={2:["#009392","#d0587e"],3:["#009392","#f1eac8","#d0587e"],4:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],5:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],6:["#009392","#72aaa1","#b1c7b3","#e5b9ad","#d98994","#d0587e"],7:["#009392","#72aaa1","#b1c7b3","#f1eac8","#e5b9ad","#d98994","#d0587e"],tags:["diverging"]},lEt={2:["#009B9E","#C75DAB"],3:["#009B9E","#F1F1F1","#C75DAB"],4:["#009B9E","#A7D3D4","#E4C1D9","#C75DAB"],5:["#009B9E","#7CC5C6","#F1F1F1","#DDA9CD","#C75DAB"],6:["#009B9E","#5DBCBE","#C6DFDF","#E9D4E2","#D99BC6","#C75DAB"],7:["#009B9E","#42B7B9","#A7D3D4","#F1F1F1","#E4C1D9","#D691C1","#C75DAB"],tags:["diverging"]},cEt={2:["#A16928","#2887a1"],3:["#A16928","#edeac2","#2887a1"],4:["#A16928","#d6bd8d","#b5c8b8","#2887a1"],5:["#A16928","#caa873","#edeac2","#98b7b2","#2887a1"],6:["#A16928","#c29b64","#e0cfa2","#cbd5bc","#85adaf","#2887a1"],7:["#A16928","#bd925a","#d6bd8d","#edeac2","#b5c8b8","#79a7ac","#2887a1"],tags:["diverging"]},uEt={2:["#855C75","#D9AF6B","#7C7C7C"],3:["#855C75","#D9AF6B","#AF6458","#7C7C7C"],4:["#855C75","#D9AF6B","#AF6458","#736F4C","#7C7C7C"],5:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#7C7C7C"],6:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#7C7C7C"],7:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#7C7C7C"],8:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#7C7C7C"],9:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#7C7C7C"],10:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#7C7C7C"],11:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#467378","#7C7C7C"],tags:["qualitative"]},hEt={2:["#7F3C8D","#11A579","#A5AA99"],3:["#7F3C8D","#11A579","#3969AC","#A5AA99"],4:["#7F3C8D","#11A579","#3969AC","#F2B701","#A5AA99"],5:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#A5AA99"],6:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#A5AA99"],7:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#A5AA99"],8:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#A5AA99"],9:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#A5AA99"],10:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#A5AA99"],11:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#4b4b8f","#A5AA99"],tags:["qualitative"]},fEt={2:["#66C5CC","#F6CF71","#B3B3B3"],3:["#66C5CC","#F6CF71","#F89C74","#B3B3B3"],4:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#B3B3B3"],5:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#B3B3B3"],6:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#B3B3B3"],7:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#B3B3B3"],8:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#B3B3B3"],9:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B3B3B3"],10:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#B3B3B3"],11:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"],tags:["qualitative"]},dEt={2:["#5F4690","#1D6996","#666666"],3:["#5F4690","#1D6996","#38A6A5","#666666"],4:["#5F4690","#1D6996","#38A6A5","#0F8554","#666666"],5:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#666666"],6:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#666666"],7:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#666666"],8:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#666666"],9:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#666666"],10:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#666666"],11:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#994E95","#666666"],tags:["qualitative"]},pEt={2:["#88CCEE","#CC6677","#888888"],3:["#88CCEE","#CC6677","#DDCC77","#888888"],4:["#88CCEE","#CC6677","#DDCC77","#117733","#888888"],5:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#888888"],6:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#888888"],7:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#888888"],8:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#888888"],9:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#888888"],10:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#888888"],11:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#6699CC","#888888"],tags:["qualitative","colorblind"]},AEt={2:["#E58606","#5D69B1","#A5AA99"],3:["#E58606","#5D69B1","#52BCA3","#A5AA99"],4:["#E58606","#5D69B1","#52BCA3","#99C945","#A5AA99"],5:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#A5AA99"],6:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#A5AA99"],7:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#A5AA99"],8:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#A5AA99"],9:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#A5AA99"],10:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#A5AA99"],11:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#CC3A8E","#A5AA99"],tags:["qualitative"]},gEt={...Rn.BuGn,tags:["quantitative"]},mEt={...Rn.BuPu,tags:["quantitative"]},yEt={...Rn.GnBu,tags:["quantitative"]},_Et={...Rn.OrRd,tags:["quantitative"]},vEt={...Rn.PuBu,tags:["quantitative"]},bEt={...Rn.PuBuGn,tags:["quantitative"]},xEt={...Rn.PuRd,tags:["quantitative"]},wEt={...Rn.RdPu,tags:["quantitative"]},CEt={...Rn.YlGn,tags:["quantitative"]},EEt={...Rn.YlGnBu,tags:["quantitative"]},BEt={...Rn.YlOrBr,tags:["quantitative"]},TEt={...Rn.YlOrRd,tags:["quantitative"]},SEt={...Rn.Accent,tags:["qualitative"]},IEt={...Rn.Dark2,tags:["qualitative"]},MEt={...Rn.Paired,tags:["qualitative"]},PEt={...Rn.Pastel1,tags:["qualitative"]},REt={...Rn.Pastel2,tags:["qualitative"]},DEt={...Rn.Set1,tags:["qualitative"]},OEt={...Rn.Set2,tags:["qualitative"]},LEt={...Rn.Set3,tags:["qualitative"]},FEt={...Rn.Blues,tags:["quantitative"]},kEt={...Rn.Greens,tags:["quantitative"]},NEt={...Rn.Greys,tags:["quantitative"]},UEt={...Rn.Oranges,tags:["quantitative"]},GEt={...Rn.Purples,tags:["quantitative"]},zEt={...Rn.Reds,tags:["quantitative"]},VEt={...Rn.BrBG,tags:["diverging"]},jEt={...Rn.PiYG,tags:["diverging"]},HEt={...Rn.PRGn,tags:["diverging"]},WEt={...Rn.PuOr,tags:["diverging"]},JEt={...Rn.RdBu,tags:["diverging"]},XEt={...Rn.RdGy,tags:["diverging"]},KEt={...Rn.RdYlBu,tags:["diverging"]},QEt={...Rn.RdYlGn,tags:["diverging"]},ZEt={...Rn.Spectral,tags:["diverging"]};const YEt=Object.freeze(Object.defineProperty({__proto__:null,Antique:uEt,ArmyRose:nEt,BluGrn:jCt,BluYl:XCt,Bold:hEt,BrwnYl:iEt,Burg:FCt,BurgYl:kCt,DarkMint:HCt,Earth:cEt,Emrld:WCt,Fall:rEt,Geyser:oEt,Magenta:$Ct,Mint:VCt,OrYel:UCt,Pastel:fEt,Peach:GCt,PinkYl:zCt,Prism:dEt,Purp:ZCt,PurpOr:YCt,RedOr:NCt,Safe:pEt,Sunset:qCt,SunsetDark:tEt,Teal:KCt,TealGrn:QCt,TealRose:aEt,Temps:sEt,Tropic:lEt,Vivid:AEt,ag_GrnYl:JCt,ag_Sunset:eEt,cb_Accent:SEt,cb_Blues:FEt,cb_BrBG:VEt,cb_BuGn:gEt,cb_BuPu:mEt,cb_Dark2:IEt,cb_GnBu:yEt,cb_Greens:kEt,cb_Greys:NEt,cb_OrRd:_Et,cb_Oranges:UEt,cb_PRGn:HEt,cb_Paired:MEt,cb_Pastel1:PEt,cb_Pastel2:REt,cb_PiYG:jEt,cb_PuBu:vEt,cb_PuBuGn:bEt,cb_PuOr:WEt,cb_PuRd:xEt,cb_Purples:GEt,cb_RdBu:JEt,cb_RdGy:XEt,cb_RdPu:wEt,cb_RdYlBu:KEt,cb_RdYlGn:QEt,cb_Reds:zEt,cb_Set1:DEt,cb_Set2:OEt,cb_Set3:LEt,cb_Spectral:ZEt,cb_YlGn:CEt,cb_YlGnBu:EEt,cb_YlOrBr:BEt,cb_YlOrRd:TEt},Symbol.toStringTag,{value:"Module"})),AE="PurpOr",gE=[204,204,204],qEt=[119,119,119];function mE(e,t){const i=YEt[e];let n=t;Mf(i,`Palette "${e}" not found. Expected a CARTOColors string`);const r=Object.keys(i).filter(h=>h!=="tags").map(Number),s=Math.max(...r),o=Math.min(...r);!Number.isInteger(t)||t>s?n=s:t<o&&(n=o);let l=i[n];return i.tags&&i.tags.includes("qualitative")&&(l=l.slice(0,-1)),l.map(h=>$Et(h))}function $Et(e){let t=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(e);return t?[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),255]:(t=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(e),t?[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),parseInt(t[4]+t[4],16)]:(t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),255]:(t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),Mf(t,`Hexadecimal color "${e}" was not parsed correctly`),[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),parseInt(t[4],16)])))}const t3t=Object.freeze(["function","string"]);function yE(e,t,i){var n;return Mf(typeof t=="object",'Expected "data" to be an object'),Mf(t3t.includes(typeof e),'Expected "attr" to be a function or string'),typeof e=="function"?e(t,i):(n=t==null?void 0:t.properties)==null?void 0:n[e]}function e3t({attr:e,domain:t,colors:i=AE,nullColor:n=gE}){Mf(Array.isArray(t),'Expected "domain" to be an array of numbers');const r=typeof i=="string"?mE(i,t.length+1):i,s=gG().domain(t).range(r);return(o,l)=>{const h=yE(e,o,l);return typeof h=="number"&&Number.isFinite(h)?s(h):n}}function i3t({attr:e,domain:t,colors:i=AE,nullColor:n=gE,othersColor:r=qEt}){Mf(Array.isArray(t),'Expected "domain" to be an array of numbers or strings');const s={},o=typeof i=="string"?mE(i,t.length):i;for(const[l,h]of t.entries())s[h]=o[l];return(l,h)=>{const A=yE(e,l,h);return typeof A=="number"&&Number.isFinite(A)||typeof A=="string"?s[A]||r:n}}function n3t({attr:e,domain:t,colors:i=AE,nullColor:n=gE}){Mf(Array.isArray(t),'Expected "domain" to be an array of numbers');const r=typeof i=="string"?mE(i,t.length):i,s=mG().domain(t).range(r);return(o,l)=>{const h=yE(e,o,l);return typeof h=="number"&&Number.isFinite(h)?s(h):n}}function r3t({pointCount:e,getBinId:t}){const i=new Map;for(let n=0;n<e;n++){const r=t(n);if(r===null)continue;let s=i.get(String(r));s?s.points.push(n):(s={id:r,index:i.size,points:[n]},i.set(String(r),s))}return Array.from(i.values())}function o3t({bins:e,dimensions:t,target:i}){const n=e.length*t;(!i||i.length<n)&&(i=new Float32Array(n));for(let r=0;r<e.length;r++){const{id:s}=e[r];Array.isArray(s)?i.set(s,r*t):i[r]=s}return i}const s3t=e=>e.length,t9=(e,t)=>{let i=0;for(const n of e)i+=t(n);return i},a3t=(e,t)=>e.length===0?NaN:t9(e,t)/e.length,l3t=(e,t)=>{let i=1/0;for(const n of e){const r=t(n);r<i&&(i=r)}return i},c3t=(e,t)=>{let i=-1/0;for(const n of e){const r=t(n);r>i&&(i=r)}return i},u3t={COUNT:s3t,SUM:t9,MEAN:a3t,MIN:l3t,MAX:c3t};function h3t({bins:e,getValue:t,operation:i,target:n}){(!n||n.length<e.length)&&(n=new Float32Array(e.length));let r=1/0,s=-1/0;for(let o=0;o<e.length;o++){const{points:l}=e[o];n[o]=i(l,t),n[o]<r&&(r=n[o]),n[o]>s&&(s=n[o])}return{value:n,domain:[r,s]}}function e9(e,t,i){const n={};for(const s of e.sources||[]){const o=t[s];if(o)n[s]=f3t(o);else throw new Error(`Cannot find attribute ${s}`)}const r={};return s=>{for(const o in n)r[o]=n[o](s);return e.getValue(r,s,i)}}function f3t(e){const t=e.value,{offset:i=0,stride:n,size:r}=e.getAccessor(),s=t.BYTES_PER_ELEMENT,o=i/s,l=n?n/s:r;if(r===1)return e.isConstant?()=>t[0]:A=>{const v=o+l*A;return t[v]};let h;return e.isConstant?(h=Array.from(t),()=>h):(h=new Array(r),A=>{const v=o+l*A;for(let C=0;C<r;C++)h[C]=t[v+C];return h})}class Jp{constructor(t){this.bins=[],this.binIds=null,this.results=[],this.dimensions=t.dimensions,this.channelCount=t.getValue.length,this.props={...t,binOptions:{},pointCount:0,operations:[],customOperations:[],attributes:{}},this.needsUpdate=!0,this.setProps(t)}destroy(){}get binCount(){return this.bins.length}setProps(t){const i=this.props;if(t.binOptions&&($r(t.binOptions,i.binOptions,2)||this.setNeedsUpdate()),t.operations)for(let n=0;n<this.channelCount;n++)t.operations[n]!==i.operations[n]&&this.setNeedsUpdate(n);if(t.customOperations)for(let n=0;n<this.channelCount;n++)!!t.customOperations[n]!=!!i.customOperations[n]&&this.setNeedsUpdate(n);t.pointCount!==void 0&&t.pointCount!==i.pointCount&&this.setNeedsUpdate(),t.attributes&&(t.attributes={...i.attributes,...t.attributes}),Object.assign(this.props,t)}setNeedsUpdate(t){t===void 0?this.needsUpdate=!0:this.needsUpdate!==!0&&(this.needsUpdate=this.needsUpdate||[],this.needsUpdate[t]=!0)}update(){var t,i,n,r;if(this.needsUpdate===!0){this.bins=r3t({pointCount:this.props.pointCount,getBinId:e9(this.props.getBin,this.props.attributes,this.props.binOptions)});const s=o3t({bins:this.bins,dimensions:this.dimensions,target:(t=this.binIds)==null?void 0:t.value});this.binIds={value:s,type:"float32",size:this.dimensions}}for(let s=0;s<this.channelCount;s++)if(this.needsUpdate===!0||this.needsUpdate[s]){const o=this.props.customOperations[s]||u3t[this.props.operations[s]],{value:l,domain:h}=h3t({bins:this.bins,getValue:e9(this.props.getValue[s],this.props.attributes,void 0),operation:o,target:(i=this.results[s])==null?void 0:i.value});this.results[s]={value:l,domain:h,type:"float32",size:1},(r=(n=this.props).onUpdate)==null||r.call(n,{channel:s})}this.needsUpdate=!1}preDraw(){}getBins(){return this.binIds}getResult(t){return this.results[t]}getResultDomain(t){var i;return((i=this.results[t])==null?void 0:i.domain)??[1/0,-1/0]}getBin(t){const i=this.bins[t];if(!i)return null;const n=new Array(this.channelCount);for(let r=0;r<n.length;r++){const s=this.results[r];n[r]=s==null?void 0:s.value[t]}return{id:i.id,value:n,count:i.points.length,pointIndices:i.points}}}function i9(e,t,i){return e.createFramebuffer({width:t,height:i,colorAttachments:[e.createTexture({width:t,height:i,format:"rgba32float",mipmaps:!1,sampler:{minFilter:"nearest",magFilter:"nearest"}})]})}const d3t=`uniform binSorterUniforms {
  ivec4 binIdRange;
  ivec2 targetSize;
} binSorter;
`,p3t={name:"binSorter",vs:d3t,uniformTypes:{binIdRange:"vec4<i32>",targetSize:"vec2<i32>"}},n9=[1,2,4,8],A3t=3e38,g3t={SUM:0,MEAN:0,MIN:0,MAX:0,COUNT:0},rv=1024;class m3t{constructor(t,i){this.binsFBO=null,this.device=t,this.model=_3t(t,i)}get texture(){return this.binsFBO?this.binsFBO.colorAttachments[0].texture:null}destroy(){var t,i;this.model.destroy(),(t=this.binsFBO)==null||t.colorAttachments[0].texture.destroy(),(i=this.binsFBO)==null||i.destroy()}getBinValues(t){if(!this.binsFBO)return null;const i=t%rv,n=Math.floor(t/rv),r=this.device.readPixelsToArrayWebGL(this.binsFBO,{sourceX:i,sourceY:n,sourceWidth:1,sourceHeight:1}).buffer;return new Float32Array(r)}setDimensions(t,i){var n,r;const s=rv,o=Math.ceil(t/s);this.binsFBO?this.binsFBO.height<o&&this.binsFBO.resize({width:s,height:o}):this.binsFBO=i9(this.device,s,o);const l={binIdRange:[i[0][0],i[0][1],((n=i[1])==null?void 0:n[0])||0,((r=i[1])==null?void 0:r[1])||0],targetSize:[this.binsFBO.width,this.binsFBO.height]};this.model.shaderInputs.setProps({binSorter:l})}setModelProps(t){const i=this.model;t.attributes&&i.setAttributes(t.attributes),t.constantAttributes&&i.setConstantAttributes(t.constantAttributes),t.vertexCount!==void 0&&i.setVertexCount(t.vertexCount),t.shaderModuleProps&&i.shaderInputs.setProps(t.shaderModuleProps)}update(t){if(!this.binsFBO)return;const i=y3t(t);this._updateBins("SUM",i.SUM+i.MEAN),this._updateBins("MIN",i.MIN),this._updateBins("MAX",i.MAX)}_updateBins(t,i){if(i===0)return;i|=n9[3];const n=this.model,r=this.binsFBO,s=t==="MAX"?-3e38:t==="MIN"?A3t:0,o=this.device.beginRenderPass({id:`gpu-aggregation-${t}`,framebuffer:r,parameters:{viewport:[0,0,r.width,r.height],colorMask:i},clearColor:[s,s,s,0],clearDepth:!1,clearStencil:!1});n.setParameters({blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendColorOperation:t==="MAX"?"max":t==="MIN"?"min":"add",blendAlphaOperation:"add"}),n.draw(o),o.end()}}function y3t(e){const t={...g3t};for(let i=0;i<e.length;i++){const n=e[i];n&&(t[n]+=n9[i])}return t}function _3t(e,t){let i=t.vs;t.dimensions===2&&(i+=`
void getBin(out int binId) {
  ivec2 binId2;
  getBin(binId2);
  if (binId2.x < binSorter.binIdRange.x || binId2.x >= binSorter.binIdRange.y) {
    binId = -1;
  } else {
    binId = (binId2.y - binSorter.binIdRange.z) * (binSorter.binIdRange.y - binSorter.binIdRange.x) + binId2.x;
  }
}
`);const n=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-vertex

${i}

out vec3 v_Value;

void main() {
  int binIndex;
  getBin(binIndex);
  binIndex = binIndex - binSorter.binIdRange.x;
  if (binIndex < 0) {
    gl_Position = vec4(0.);
    return;
  }
  int row = binIndex / binSorter.targetSize.x;
  int col = binIndex - row * binSorter.targetSize.x;
  vec2 position = (vec2(col, row) + 0.5) / vec2(binSorter.targetSize) * 2.0 - 1.0;
  gl_Position = vec4(position, 0.0, 1.0);
  gl_PointSize = 1.0;

#if NUM_CHANNELS == 3
  getValue(v_Value);
#elif NUM_CHANNELS == 2
  getValue(v_Value.xy);
#else
  getValue(v_Value.x);
#endif
}
`,r=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-fragment

precision highp float;

in vec3 v_Value;
out vec4 fragColor;

void main() {
  fragColor.xyz = v_Value;

  #ifdef MODULE_GEOMETRY
  geometry.uv = vec2(0.);
  DECKGL_FILTER_COLOR(fragColor, geometry);
  #endif

  fragColor.w = 1.0;
}
`;return new Hr(e,{bufferLayout:t.bufferLayout,modules:[...t.modules||[],p3t],defines:{...t.defines,NON_INSTANCED_MODEL:1,NUM_CHANNELS:t.channelCount},isInstanced:!1,vs:n,fs:r,topology:"point-list",disableWarnings:!0})}const v3t=`uniform aggregatorTransformUniforms {
  ivec4 binIdRange;
  bvec3 isCount;
  bvec3 isMean;
  float naN;
} aggregatorTransform;
`,b3t={name:"aggregatorTransform",vs:v3t,uniformTypes:{binIdRange:"vec4<i32>",isCount:"vec3<f32>",isMean:"vec3<f32>"}};class x3t{constructor(t,i){this.binBuffer=null,this.valueBuffer=null,this._domains=null,this.device=t,this.channelCount=i.channelCount,this.transform=w3t(t,i),this.domainFBO=i9(t,2,1)}destroy(){var t,i;this.transform.destroy(),(t=this.binBuffer)==null||t.destroy(),(i=this.valueBuffer)==null||i.destroy(),this.domainFBO.colorAttachments[0].texture.destroy(),this.domainFBO.destroy()}get domains(){if(!this._domains){const t=this.device.readPixelsToArrayWebGL(this.domainFBO).buffer,i=new Float32Array(t);this._domains=[[-i[4],i[0]],[-i[5],i[1]],[-i[6],i[2]]].slice(0,this.channelCount)}return this._domains}setDimensions(t,i){var n,r,s,o;const{model:l,transformFeedback:h}=this.transform;l.setVertexCount(t);const A={binIdRange:[i[0][0],i[0][1],((n=i[1])==null?void 0:n[0])||0,((r=i[1])==null?void 0:r[1])||0]};l.shaderInputs.setProps({aggregatorTransform:A});const v=t*i.length*4;(!this.binBuffer||this.binBuffer.byteLength<v)&&((s=this.binBuffer)==null||s.destroy(),this.binBuffer=this.device.createBuffer({byteLength:v}),h.setBuffer("binIds",this.binBuffer));const C=t*this.channelCount*4;(!this.valueBuffer||this.valueBuffer.byteLength<C)&&((o=this.valueBuffer)==null||o.destroy(),this.valueBuffer=this.device.createBuffer({byteLength:C}),h.setBuffer("values",this.valueBuffer))}update(t,i){if(!t)return;const n=this.transform,r=this.domainFBO,s=[0,1,2].map(h=>i[h]==="COUNT"?1:0),o=[0,1,2].map(h=>i[h]==="MEAN"?1:0),l={isCount:s,isMean:o,bins:t};n.model.shaderInputs.setProps({aggregatorTransform:l}),n.run({id:"gpu-aggregation-domain",framebuffer:r,parameters:{viewport:[0,0,2,1]},clearColor:[-3e38,-3e38,-3e38,0],clearDepth:!1,clearStencil:!1}),this._domains=null}}function w3t(e,t){const i=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-vertex

uniform sampler2D bins;

#if NUM_DIMS == 1
out float binIds;
#else
out vec2 binIds;
#endif

#if NUM_CHANNELS == 1
flat out float values;
#elif NUM_CHANNELS == 2
flat out vec2 values;
#else
flat out vec3 values;
#endif

const float NAN = intBitsToFloat(-1);

void main() {
  int row = gl_VertexID / SAMPLER_WIDTH;
  int col = gl_VertexID - row * SAMPLER_WIDTH;
  vec4 weights = texelFetch(bins, ivec2(col, row), 0);
  vec3 value3 = mix(
    mix(weights.rgb, vec3(weights.a), aggregatorTransform.isCount),
    weights.rgb / max(weights.a, 1.0),
    aggregatorTransform.isMean
  );
  if (weights.a == 0.0) {
    value3 = vec3(NAN);
  }

#if NUM_DIMS == 1
  binIds = float(gl_VertexID + aggregatorTransform.binIdRange.x);
#else
  int y = gl_VertexID / (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  int x = gl_VertexID - y * (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  binIds.y = float(y + aggregatorTransform.binIdRange.z);
  binIds.x = float(x + aggregatorTransform.binIdRange.x);
#endif

#if NUM_CHANNELS == 3
  values = value3;
#elif NUM_CHANNELS == 2
  values = value3.xy;
#else
  values = value3.x;
#endif

  gl_Position = vec4(0., 0., 0., 1.);
  // This model renders into a 2x1 texture to obtain min and max simultaneously.
  // See comments in fragment shader
  gl_PointSize = 2.0;
}
`,n=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-fragment

precision highp float;

#if NUM_CHANNELS == 1
flat in float values;
#elif NUM_CHANNELS == 2
flat in vec2 values;
#else
flat in vec3 values;
#endif

out vec4 fragColor;

void main() {
  vec3 value3;
#if NUM_CHANNELS == 3
  value3 = values;
#elif NUM_CHANNELS == 2
  value3.xy = values;
#else
  value3.x = values;
#endif
  if (isnan(value3.x)) discard;
  // This shader renders into a 2x1 texture with blending=max
  // The left pixel yields the max value of each channel
  // The right pixel yields the min value of each channel
  if (gl_FragCoord.x < 1.0) {
    fragColor = vec4(value3, 1.0);
  } else {
    fragColor = vec4(-value3, 1.0);
  }
}
`;return new k0(e,{vs:i,fs:n,topology:"point-list",modules:[b3t],parameters:{blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendColorOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendAlphaOperation:"max"},defines:{NUM_DIMS:t.dimensions,NUM_CHANNELS:t.channelCount,SAMPLER_WIDTH:rv},varyings:["binIds","values"],disableWarnings:!0})}class Wa{static isSupported(t){return t.features.has("float32-renderable-webgl")&&t.features.has("texture-blend-float-webgl")}constructor(t,i){this.binCount=0,this.binIds=null,this.results=[],this.device=t,this.dimensions=i.dimensions,this.channelCount=i.channelCount,this.props={...i,pointCount:0,binIdRange:[[0,0]],operations:[],attributes:{},binOptions:{}},this.needsUpdate=new Array(this.channelCount).fill(!0),this.binSorter=new m3t(t,i),this.aggregationTransform=new x3t(t,i),this.setProps(i)}getBins(){var t;const i=this.aggregationTransform.binBuffer;return i?(((t=this.binIds)==null?void 0:t.buffer)!==i&&(this.binIds={buffer:i,type:"float32",size:this.dimensions}),this.binIds):null}getResult(t){var i;const n=this.aggregationTransform.valueBuffer;return!n||t>=this.channelCount?null:(((i=this.results[t])==null?void 0:i.buffer)!==n&&(this.results[t]={buffer:n,type:"float32",size:1,stride:this.channelCount*4,offset:t*4}),this.results[t])}getResultDomain(t){return this.aggregationTransform.domains[t]}getBin(t){if(t<0||t>=this.binCount)return null;const{binIdRange:i}=this.props;let n;if(this.dimensions===1)n=[t+i[0][0]];else{const[[l,h],[A]]=i,v=h-l;n=[t%v+l,Math.floor(t/v)+A]}const r=this.binSorter.getBinValues(t);if(!r)return null;const s=r[3],o=[];for(let l=0;l<this.channelCount;l++){const h=this.props.operations[l];h==="COUNT"?o[l]=s:s===0?o[l]=NaN:o[l]=h==="MEAN"?r[l]/s:r[l]}return{id:n,value:o,count:s}}destroy(){this.binSorter.destroy(),this.aggregationTransform.destroy()}setProps(t){const i=this.props;if("binIdRange"in t&&!$r(t.binIdRange,i.binIdRange,2)){const n=t.binIdRange;if(Yi.assert(n.length===this.dimensions),this.dimensions===1){const[[r,s]]=n;this.binCount=s-r}else{const[[r,s],[o,l]]=n;this.binCount=(s-r)*(l-o)}this.binSorter.setDimensions(this.binCount,n),this.aggregationTransform.setDimensions(this.binCount,n),this.setNeedsUpdate()}if(t.operations)for(let n=0;n<this.channelCount;n++)t.operations[n]!==i.operations[n]&&this.setNeedsUpdate(n);if(t.pointCount!==void 0&&t.pointCount!==i.pointCount&&(this.binSorter.setModelProps({vertexCount:t.pointCount}),this.setNeedsUpdate()),t.binOptions&&($r(t.binOptions,i.binOptions,2)||this.setNeedsUpdate(),this.binSorter.model.shaderInputs.setProps({binOptions:t.binOptions})),t.attributes){const n={},r={};for(const s of Object.values(t.attributes))for(const[o,l]of Object.entries(s.getValue()))ArrayBuffer.isView(l)?r[o]=l:l&&(n[o]=l);this.binSorter.setModelProps({attributes:n,constantAttributes:r})}t.shaderModuleProps&&this.binSorter.setModelProps({shaderModuleProps:t.shaderModuleProps}),Object.assign(this.props,t)}setNeedsUpdate(t){t===void 0?this.needsUpdate.fill(!0):this.needsUpdate[t]=!0}update(){}preDraw(){var t,i;if(!this.needsUpdate.some(Boolean))return;const{operations:n}=this.props,r=this.needsUpdate.map((s,o)=>s?n[o]:null);this.binSorter.update(r),this.aggregationTransform.update(this.binSorter.texture,n);for(let s=0;s<this.channelCount;s++)this.needsUpdate[s]&&(this.needsUpdate[s]=!1,(i=(t=this.props).onUpdate)==null||i.call(t,{channel:s}))}}let Xp=class extends Mo{get isDrawable(){return!0}initializeState(){this.getAttributeManager().remove(["instancePickingColors"])}updateState(e){var t,i;super.updateState(e);const n=this.getAggregatorType();if(e.changeFlags.extensionsChanged||this.state.aggregatorType!==n){(t=this.state.aggregator)==null||t.destroy();const r=this.createAggregator(n);return r.setProps({attributes:(i=this.getAttributeManager())==null?void 0:i.attributes}),this.setState({aggregator:r,aggregatorType:n}),!0}return!1}finalizeState(e){super.finalizeState(e),this.state.aggregator.destroy()}updateAttributes(e){const{aggregator:t}=this.state;t.setProps({attributes:e});for(const i in e)this.onAttributeChange(i);t.update()}draw({shaderModuleProps:e}){const{aggregator:t}=this.state;t.setProps({shaderModuleProps:e}),t.preDraw()}_getAttributeManager(){return new K0(this.context.device,{id:this.props.id,stats:this.context.stats})}};Xp.layerName="AggregationLayer";const ov=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function r9(e,t=!1,i=Float32Array){let n;if(Number.isFinite(e[0]))n=new i(e);else{n=new i(e.length*4);let r=0;for(let s=0;s<e.length;s++){const o=e[s];n[r++]=o[0],n[r++]=o[1],n[r++]=o[2],n[r++]=Number.isFinite(o[3])?o[3]:255}}if(t)for(let r=0;r<n.length;r++)n[r]/=255;return n}const sv={linear:"linear",quantile:"nearest",quantize:"nearest",ordinal:"nearest"};function _E(e,t){e.setSampler({minFilter:sv[t],magFilter:sv[t]})}function vE(e,t,i="linear"){const n=r9(t,!1,Uint8Array);return e.createTexture({format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:sv[i],magFilter:sv[i],addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},data:n,width:n.length/4,height:1})}const C3t=`#version 300 es
#define SHADER_NAME screen-grid-layer-vertex-shader
#define RANGE_COUNT 6
in vec2 positions;
in vec2 instancePositions;
in float instanceWeights;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
if (isnan(instanceWeights)) {
gl_Position = vec4(0.);
return;
}
vec2 pos = instancePositions * screenGrid.gridSizeClipspace + positions * screenGrid.cellSizeClipspace;
pos.x = pos.x - 1.0;
pos.y = 1.0 - pos.y;
gl_Position = vec4(pos, 0., 1.);
vColor = interp(instanceWeights, screenGrid.colorDomain, colorRange);
vColor.a *= layer.opacity;
picking_setPickingColor(instancePickingColors);
}
`,E3t=`#version 300 es
#define SHADER_NAME screen-grid-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,B3t=`uniform screenGridUniforms {
  vec2 cellSizeClipspace;
  vec2 gridSizeClipspace;
  vec2 colorDomain;
} screenGrid;
`,T3t={name:"screenGrid",vs:B3t,uniformTypes:{cellSizeClipspace:"vec2<f32>",gridSizeClipspace:"vec2<f32>",colorDomain:"vec2<f32>"}};class o9 extends Io{getShaders(){return super.getShaders({vs:C3t,fs:E3t,modules:[pa,T3t]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceWeights:{size:1,type:"float32",accessor:"getWeight"}}),this.state.model=this._getModel()}updateState(t){var i;super.updateState(t);const{props:n,oldProps:r,changeFlags:s}=t,o=this.state.model;if(r.colorRange!==n.colorRange){(i=this.state.colorTexture)==null||i.destroy(),this.state.colorTexture=vE(this.context.device,n.colorRange,n.colorScaleType);const l={colorRange:this.state.colorTexture};o.shaderInputs.setProps({screenGrid:l})}else r.colorScaleType!==n.colorScaleType&&_E(this.state.colorTexture,n.colorScaleType);if(r.cellMarginPixels!==n.cellMarginPixels||r.cellSizePixels!==n.cellSizePixels||s.viewportChanged){const{width:l,height:h}=this.context.viewport,{cellSizePixels:A,cellMarginPixels:v}=this.props,C=Math.max(A-v,0),S={gridSizeClipspace:[A/l*2,A/h*2],cellSizeClipspace:[C/l*2,C/h*2]};o.shaderInputs.setProps({screenGrid:S})}}finalizeState(t){var i;super.finalizeState(t),(i=this.state.colorTexture)==null||i.destroy()}draw({uniforms:t}){const i=this.props.colorDomain(),n=this.state.model,r={colorDomain:i};n.shaderInputs.setProps({screenGrid:r}),n.draw(this.context.renderPass)}_getModel(){return new Hr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new es({topology:"triangle-strip",attributes:{positions:{value:new Float32Array([0,0,1,0,0,1,1,1]),size:2}}}),isInstanced:!0})}}o9.layerName="ScreenGridCellLayer";const S3t=`uniform binOptionsUniforms {
  float cellSizePixels;
} binOptions;
`,I3t={name:"binOptions",vs:S3t,uniformTypes:{cellSizePixels:"f32"}},M3t={cellSizePixels:{type:"number",value:100,min:1},cellMarginPixels:{type:"number",value:2,min:0},colorRange:ov,colorScaleType:"linear",getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM"};class bE extends Xp{getAggregatorType(){return this.props.gpuAggregation&&Wa.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(t){return t==="cpu"||!Wa.isSupported(this.context.device)?new Jp({dimensions:2,getBin:{sources:["positions"],getValue:({positions:i},n,r)=>{const s=this.context.viewport,o=s.project(i),l=r.cellSizePixels;return o[0]<0||o[0]>=s.width||o[1]<0||o[1]>=s.height?null:[Math.floor(o[0]/l),Math.floor(o[1]/l)]}},getValue:[{sources:["counts"],getValue:({counts:i})=>i}]}):new Wa(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Uo,I3t],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;
  
  void getBin(out ivec2 binId) {
    vec4 pos = project_position_to_clipspace(positions, positions64Low, vec3(0.0));
    vec2 screenCoords = vec2(pos.x / pos.w + 1.0, 1.0 - pos.y / pos.w) / 2.0 * project.viewportSize / project.devicePixelRatio;
    vec2 gridCoords = floor(screenCoords / binOptions.cellSizePixels);
    binId = ivec2(gridCoords);
  }
  void getValue(out float weight) {
    weight = counts;
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState(t){const i=super.updateState(t),{props:n,oldProps:r,changeFlags:s}=t,{cellSizePixels:o,aggregation:l}=n;if(i||s.dataChanged||s.updateTriggersChanged||s.viewportChanged||l!==r.aggregation||o!==r.cellSizePixels){const{width:h,height:A}=this.context.viewport,{aggregator:v}=this.state;v instanceof Wa&&v.setProps({binIdRange:[[0,Math.ceil(h/o)],[0,Math.ceil(A/o)]]}),v.setProps({pointCount:this.getNumInstances(),operations:[l],binOptions:{cellSizePixels:o}})}return s.viewportChanged&&this.state.aggregator.setNeedsUpdate(),i}onAttributeChange(t){const{aggregator:i}=this.state;switch(t){case"positions":i.setNeedsUpdate();break;case"counts":i.setNeedsUpdate(0);break}}renderLayers(){const{aggregator:t}=this.state,i=this.getSubLayerClass("cells",o9),n=t.getBins(),r=t.getResult(0);return new i(this.props,this.getSubLayerProps({id:"cell-layer"}),{data:{length:t.binCount,attributes:{getBin:n,getWeight:r}},dataComparator:(s,o)=>s.length===o.length,updateTriggers:{getBin:[n],getWeight:[r]},parameters:{depthWriteEnabled:!1,...this.props.parameters},colorDomain:()=>this.props.colorDomain||t.getResultDomain(0),extensions:[]})}getPickingInfo(t){const i=t.info,{index:n}=i;if(n>=0){const r=this.state.aggregator.getBin(n);let s;r&&(s={col:r.id[0],row:r.id[1],value:r.value[0],count:r.count},r.pointIndices&&(s.pointIndices=r.pointIndices,s.points=Array.isArray(this.props.data)?r.pointIndices.map(o=>this.props.data[o]):[])),i.object=s}return i}}bE.layerName="ScreenGridLayer",bE.defaultProps=M3t;class av{constructor(t,i){this.props={scaleType:"linear",lowerPercentile:0,upperPercentile:100},this.domain=null,this.cutoff=null,this.input=t,this.inputLength=i,this.attribute=t}getScalePercentile(){if(!this._percentile){const t=s9(this.input,this.inputLength);this._percentile=R3t(t)}return this._percentile}getScaleOrdinal(){if(!this._ordinal){const t=s9(this.input,this.inputLength);this._ordinal=P3t(t)}return this._ordinal}getCutoff({scaleType:t,lowerPercentile:i,upperPercentile:n}){if(t==="quantile")return[i,n-1];if(i>0||n<100){const{domain:r}=this.getScalePercentile();let s=r[Math.floor(i)-1]??-1/0,o=r[Math.floor(n)-1]??1/0;if(t==="ordinal"){const{domain:l}=this.getScaleOrdinal();s=l.findIndex(h=>h>=s),o=l.findIndex(h=>h>o)-1,o===-2&&(o=l.length-1)}return[s,o]}return null}update(t){const i=this.props;if(t.scaleType!==i.scaleType)switch(t.scaleType){case"quantile":{const{attribute:n}=this.getScalePercentile();this.attribute=n,this.domain=[0,99];break}case"ordinal":{const{attribute:n,domain:r}=this.getScaleOrdinal();this.attribute=n,this.domain=[0,r.length-1];break}default:this.attribute=this.input,this.domain=null}return(t.scaleType!==i.scaleType||t.lowerPercentile!==i.lowerPercentile||t.upperPercentile!==i.upperPercentile)&&(this.cutoff=this.getCutoff(t)),this.props=t,this}}function P3t(e){const t=new Set;for(const r of e)Number.isFinite(r)&&t.add(r);const i=Array.from(t).sort(),n=new Map;for(let r=0;r<i.length;r++)n.set(i[r],r);return{attribute:{value:e.map(r=>Number.isFinite(r)?n.get(r):NaN),type:"float32",size:1},domain:i}}function R3t(e,t=100){const i=Array.from(e).filter(Number.isFinite).sort(D3t);let n=0;const r=Math.max(1,t),s=new Array(r-1);for(;++n<r;)s[n-1]=O3t(i,n/r);return{attribute:{value:e.map(o=>Number.isFinite(o)?L3t(s,o):NaN),type:"float32",size:1},domain:s}}function s9(e,t){var i;const n=(e.stride??4)/4,r=(e.offset??0)/4;let s=e.value;if(!s){const l=(i=e.buffer)==null?void 0:i.readSyncWebGL(0,n*4*t);l&&(s=new Float32Array(l.buffer),e.value=s)}if(n===1)return s.subarray(0,t);const o=new Float32Array(t);for(let l=0;l<t;l++)o[l]=s[l*n+r];return o}function D3t(e,t){return e-t}function O3t(e,t){const i=e.length;if(t<=0||i<2)return e[0];if(t>=1)return e[i-1];const n=(i-1)*t,r=Math.floor(n),s=e[r],o=e[r+1];return s+(o-s)*(n-r)}function L3t(e,t){let i=0,n=e.length;for(;i<n;){const r=i+n>>>1;e[r]>t?n=r:i=r+1}return i}function xE({dataBounds:e,getBinId:t,padding:i=0}){const n=[e[0],e[1],[e[0][0],e[1][1]],[e[1][0],e[0][1]]].map(h=>t(h)),r=Math.min(...n.map(h=>h[0]))-i,s=Math.min(...n.map(h=>h[1]))-i,o=Math.max(...n.map(h=>h[0]))+i+1,l=Math.max(...n.map(h=>h[1]))+i+1;return[[r,o],[s,l]]}const a9=Math.PI/3,lv=2*Math.sin(a9),cv=1.5,F3t=Array.from({length:6},(e,t)=>{const i=t*a9;return[Math.sin(i),-Math.cos(i)]});function wE([e,t],i){let n=Math.round(t=t/i/cv),r=Math.round(e=e/i/lv-(n&1)/2);const s=t-n;if(Math.abs(s)*3>1){const o=e-r,l=r+(e<r?-1:1)/2,h=n+(t<n?-1:1),A=e-l,v=t-h;o*o+s*s>A*A+v*v&&(r=l+(n&1?1:-1)/2,n=h)}return[r,n]}const k3t=`
const vec2 DIST = vec2(${lv}, ${cv});

ivec2 pointToHexbin(vec2 p, float radius) {
  p /= radius * DIST;
  float pj = round(p.y);
  float pjm2 = mod(pj, 2.0);
  p.x -= pjm2 * 0.5;
  float pi = round(p.x);
  vec2 d1 = p - vec2(pi, pj);

  if (abs(d1.y) * 3. > 1.) {
    vec2 v2 = step(0.0, d1) - 0.5;
    v2.y *= 2.0;
    vec2 d2 = d1 - v2;
    if (dot(d1, d1) > dot(d2, d2)) {
      pi += v2.x + pjm2 - 0.5;
      pj += v2.y;
    }
  }
  return ivec2(pi, pj);
}
`;function l9([e,t],i){return[(e+(t&1)/2)*i*lv,t*i*cv]}const N3t=`
const vec2 DIST = vec2(${lv}, ${cv});

vec2 hexbinCentroid(vec2 binId, float radius) {
  binId.x += fract(binId.y * 0.5);
  return binId * DIST * radius;
}
`,U3t=`#version 300 es
#define SHADER_NAME hexagon-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
${N3t}
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < hexagon.colorDomain.z ||
instanceColorValues > hexagon.colorDomain.w ||
instanceElevationValues < hexagon.elevationDomain.z ||
instanceElevationValues > hexagon.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = hexbinCentroid(instancePositions, column.radius) + (hexagon.originCommon - project.commonOrigin.xy);
commonPosition += positions.xy * column.radius * column.coverage;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, hexagon.elevationDomain.xy, hexagon.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, hexagon.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,G3t=`uniform hexagonUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
} hexagon;
`,z3t={name:"hexagon",vs:G3t,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>"}};class c9 extends dc{getShaders(){const t=super.getShaders();return t.modules.push(z3t),{...t,vs:U3t}}initializeState(){super.initializeState();const t=this.getAttributeManager();t.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),t.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(t){var i;super.updateState(t);const{props:n,oldProps:r}=t,s=this.state.fillModel;if(r.colorRange!==n.colorRange){(i=this.state.colorTexture)==null||i.destroy(),this.state.colorTexture=vE(this.context.device,n.colorRange,n.colorScaleType);const o={colorRange:this.state.colorTexture};s.shaderInputs.setProps({hexagon:o})}else r.colorScaleType!==n.colorScaleType&&_E(this.state.colorTexture,n.colorScaleType)}finalizeState(t){var i;super.finalizeState(t),(i=this.state.colorTexture)==null||i.destroy()}draw({uniforms:t}){const{radius:i,hexOriginCommon:n,elevationRange:r,elevationScale:s,extruded:o,coverage:l,colorDomain:h,elevationDomain:A}=this.props,v=this.props.colorCutoff||[-1/0,1/0],C=this.props.elevationCutoff||[-1/0,1/0],S=this.state.fillModel;S.vertexArray.indexBuffer&&S.setIndexBuffer(null),S.setVertexCount(this.state.fillVertexCount);const L={colorDomain:[Math.max(h[0],v[0]),Math.min(h[1],v[1]),Math.max(h[0]-1,v[0]),Math.min(h[1]+1,v[1])],elevationDomain:[Math.max(A[0],C[0]),Math.min(A[1],C[1]),Math.max(A[0]-1,C[0]),Math.min(A[1]+1,C[1])],elevationRange:[r[0]*s,r[1]*s],originCommon:n};S.shaderInputs.setProps({column:{extruded:o,coverage:l,radius:i},hexagon:L}),S.draw(this.context.renderPass)}}c9.layerName="HexagonCellLayer";const V3t=`uniform binOptionsUniforms {
  vec2 hexOriginCommon;
  float radiusCommon;
} binOptions;
`,j3t={name:"binOptions",vs:V3t,uniformTypes:{hexOriginCommon:"vec2<f32>",radiusCommon:"f32"}};function u9(){}const H3t={gpuAggregation:!0,colorDomain:null,colorRange:ov,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:u9,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:u9,radius:{type:"number",min:1,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:e=>e.position},hexagonAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0};class CE extends Xp{getAggregatorType(){const{gpuAggregation:t,hexagonAggregator:i,getColorValue:n,getElevationValue:r}=this.props;return t&&(i||n||r)?(Yi.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):t&&Wa.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(t){if(t==="cpu"){const{hexagonAggregator:i,radius:n}=this.props;return new Jp({dimensions:2,getBin:{sources:["positions"],getValue:({positions:r},s,o)=>{if(i)return i(r,n);const l=this.state.aggregatorViewport.projectPosition(r),{radiusCommon:h,hexOriginCommon:A}=o;return wE([l[0]-A[0],l[1]-A[1]],h)}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:r})=>r},{sources:["elevationWeights"],getValue:({elevationWeights:r})=>r}]})}return new Wa(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Uo,j3t],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;
  
  ${k3t}

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    binId = pointToHexbin(positionCommon.xy, binOptions.radiusCommon);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(t){const i=super.updateState(t),{props:n,oldProps:r,changeFlags:s}=t,{aggregator:o}=this.state;if((s.dataChanged||!this.state.dataAsArray)&&(n.getColorValue||n.getElevationValue)&&(this.state.dataAsArray=Array.from(lc(n.data).iterable)),i||s.dataChanged||n.radius!==r.radius||n.getColorValue!==r.getColorValue||n.getElevationValue!==r.getElevationValue||n.colorAggregation!==r.colorAggregation||n.elevationAggregation!==r.elevationAggregation){this._updateBinOptions();const{radiusCommon:l,hexOriginCommon:h,binIdRange:A,dataAsArray:v}=this.state;if(o.setProps({binIdRange:A,pointCount:this.getNumInstances(),operations:[n.colorAggregation,n.elevationAggregation],binOptions:{radiusCommon:l,hexOriginCommon:h},onUpdate:this._onAggregationUpdate.bind(this)}),v){const{getColorValue:C,getElevationValue:S}=this.props;o.setProps({customOperations:[C&&(L=>C(L.map(N=>v[N]),{indices:L,data:n.data})),S&&(L=>S(L.map(N=>v[N]),{indices:L,data:n.data}))]})}}return s.updateTriggersChanged&&s.updateTriggersChanged.getColorValue&&o.setNeedsUpdate(0),s.updateTriggersChanged&&s.updateTriggersChanged.getElevationValue&&o.setNeedsUpdate(1),i}_updateBinOptions(){const t=this.getBounds();let i=1,n=[0,0],r=[[0,1],[0,1]],s=this.context.viewport;if(t&&Number.isFinite(t[0][0])){let o=[(t[0][0]+t[1][0])/2,(t[0][1]+t[1][1])/2];const{radius:l}=this.props,{unitsPerMeter:h}=s.getDistanceScales(o);i=h[0]*l;const A=wE(s.projectFlat(o),i);o=s.unprojectFlat(l9(A,i));const v=s.constructor;s=s.isGeospatial?new v({longitude:o[0],latitude:o[1],zoom:12}):new hu({position:[o[0],o[1],0],zoom:12}),n=[Math.fround(s.center[0]),Math.fround(s.center[1])],r=xE({dataBounds:t,getBinId:C=>{const S=s.projectFlat(C);return S[0]-=n[0],S[1]-=n[1],wE(S,i)},padding:1})}this.setState({radiusCommon:i,hexOriginCommon:n,binIdRange:r,aggregatorViewport:s})}draw(t){t.shaderModuleProps.project&&(t.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(t)}_onAggregationUpdate({channel:t}){const i=this.getCurrentLayer().props,{aggregator:n}=this.state;if(t===0){const r=n.getResult(0);this.setState({colors:new av(r,n.binCount)}),i.onSetColorDomain(n.getResultDomain(0))}else if(t===1){const r=n.getResult(1);this.setState({elevations:new av(r,n.binCount)}),i.onSetElevationDomain(n.getResultDomain(1))}}onAttributeChange(t){const{aggregator:i}=this.state;switch(t){case"positions":i.setNeedsUpdate(),this._updateBinOptions();const{radiusCommon:n,hexOriginCommon:r,binIdRange:s}=this.state;i.setProps({binIdRange:s,binOptions:{radiusCommon:n,hexOriginCommon:r}});break;case"colorWeights":i.setNeedsUpdate(0);break;case"elevationWeights":i.setNeedsUpdate(1);break}}renderLayers(){var t,i;const{aggregator:n,radiusCommon:r,hexOriginCommon:s}=this.state,{elevationScale:o,colorRange:l,elevationRange:h,extruded:A,coverage:v,material:C,transitions:S,colorScaleType:L,lowerPercentile:N,upperPercentile:G,colorDomain:W,elevationScaleType:j,elevationLowerPercentile:q,elevationUpperPercentile:Z,elevationDomain:K}=this.props,ft=this.getSubLayerClass("cells",c9),rt=n.getBins(),Lt=(t=this.state.colors)==null?void 0:t.update({scaleType:L,lowerPercentile:N,upperPercentile:G}),Vt=(i=this.state.elevations)==null?void 0:i.update({scaleType:j,lowerPercentile:q,upperPercentile:Z});return!Lt||!Vt?null:new ft(this.getSubLayerProps({id:"cells"}),{data:{length:n.binCount,attributes:{getBin:rt,getColorValue:Lt.attribute,getElevationValue:Vt.attribute}},dataComparator:(At,at)=>At.length===at.length,updateTriggers:{getBin:[rt],getColorValue:[Lt.attribute],getElevationValue:[Vt.attribute]},diskResolution:6,vertices:F3t,radius:r,hexOriginCommon:s,elevationScale:o,colorRange:l,colorScaleType:L,elevationRange:h,extruded:A,coverage:v,material:C,colorDomain:Lt.domain||W||n.getResultDomain(0),elevationDomain:Vt.domain||K||n.getResultDomain(1),colorCutoff:Lt.cutoff,elevationCutoff:Vt.cutoff,transitions:S&&{getFillColor:S.getColorValue||S.getColorWeight,getElevation:S.getElevationValue||S.getElevationWeight},extensions:[]})}getPickingInfo(t){const i=t.info,{index:n}=i;if(n>=0){const r=this.state.aggregator.getBin(n);let s;if(r){const o=l9(r.id,this.state.radiusCommon),l=this.context.viewport.unprojectFlat(o);s={col:r.id[0],row:r.id[1],position:l,colorValue:r.value[0],elevationValue:r.value[1],count:r.count},r.pointIndices&&(s.pointIndices=r.pointIndices,s.points=Array.isArray(this.props.data)?r.pointIndices.map(h=>this.props.data[h]):[])}i.object=s}return i}}CE.layerName="HexagonLayer",CE.defaultProps=H3t;const bn=.5,Sn=1/6,be={N:[0,bn],E:[bn,0],S:[0,-.5],W:[-.5,0],NE:[bn,bn],NW:[-.5,bn],SE:[bn,-.5],SW:[-.5,-.5]},Kp=[be.W,be.SW,be.S],Qp=[be.S,be.SE,be.E],Zp=[be.E,be.NE,be.N],Yp=[be.NW,be.W,be.N],qp=[[-.5,Sn],[-.5,-.16666666666666666],[-.16666666666666666,-.5],[Sn,-.5]],$p=[[-.16666666666666666,-.5],[Sn,-.5],[bn,-.16666666666666666],[bn,Sn]],tA=[[bn,-.16666666666666666],[bn,Sn],[Sn,bn],[-.16666666666666666,bn]],eA=[[-.5,Sn],[-.5,-.16666666666666666],[Sn,bn],[-.16666666666666666,bn]],h9=[be.W,be.SW,be.SE,be.E],f9=[be.S,be.SE,be.NE,be.N],d9=[be.NW,be.W,be.E,be.NE],p9=[be.NW,be.SW,be.S,be.N],A9=[[-.5,Sn],[-.5,-.16666666666666666],[bn,-.16666666666666666],[bn,Sn]],g9=[[-.16666666666666666,-.5],[Sn,-.5],[Sn,bn],[-.16666666666666666,bn]],W3t=[be.NW,be.SW,be.SE,be.NE],m9=[be.NW,be.SW,be.SE,be.E,be.N],y9=[be.W,be.SW,be.SE,be.NE,be.N],_9=[be.NW,be.W,be.S,be.SE,be.NE],v9=[be.NW,be.SW,be.S,be.E,be.NE],b9=[be.NW,be.W,[bn,-.16666666666666666],[bn,Sn],be.N],x9=[[-.16666666666666666,-.5],[Sn,-.5],be.E,be.NE,be.N],w9=[[-.5,Sn],[-.5,-.16666666666666666],be.S,be.SE,be.E],C9=[be.W,be.SW,be.S,[Sn,bn],[-.16666666666666666,bn]],E9=[be.NW,be.W,[-.16666666666666666,-.5],[Sn,-.5],be.N],B9=[[-.5,Sn],[-.5,-.16666666666666666],be.E,be.NE,be.N],T9=[be.S,be.SE,be.E,[Sn,bn],[-.16666666666666666,bn]],S9=[be.W,be.SW,be.S,[bn,-.16666666666666666],[bn,Sn]],I9=[be.W,be.SW,be.SE,be.E,[Sn,bn],[-.16666666666666666,bn]],M9=[[-.5,Sn],[-.5,-.16666666666666666],be.S,be.SE,be.NE,be.N],P9=[be.NW,be.W,[-.16666666666666666,-.5],[Sn,-.5],be.E,be.NE],R9=[be.NW,be.SW,be.S,[bn,-.16666666666666666],[bn,Sn],be.N],iA=[be.W,be.SW,be.S,be.E,be.NE,be.N],nA=[be.NW,be.W,be.S,be.SE,be.E,be.N],uv=[[-.5,Sn],[-.5,-.16666666666666666],[-.16666666666666666,-.5],[Sn,-.5],be.E,be.NE,be.N],hv=[be.W,be.SW,be.S,[bn,-.16666666666666666],[bn,Sn],[Sn,bn],[-.16666666666666666,bn]],fv=[be.NW,be.W,[-.16666666666666666,-.5],[Sn,-.5],[bn,-.16666666666666666],[bn,Sn],be.N],dv=[[-.5,Sn],[-.5,-.16666666666666666],be.S,be.SE,be.E,[Sn,bn],[-.16666666666666666,bn]],D9=[[-.5,Sn],[-.5,-.16666666666666666],[-.16666666666666666,-.5],[Sn,-.5],[bn,-.16666666666666666],[bn,Sn],[Sn,bn],[-.16666666666666666,bn]],J3t={0:[],1:[[be.W,be.S]],2:[[be.S,be.E]],3:[[be.W,be.E]],4:[[be.N,be.E]],5:{0:[[be.W,be.S],[be.N,be.E]],1:[[be.W,be.N],[be.S,be.E]]},6:[[be.N,be.S]],7:[[be.W,be.N]],8:[[be.W,be.N]],9:[[be.N,be.S]],10:{0:[[be.W,be.N],[be.S,be.E]],1:[[be.W,be.S],[be.N,be.E]]},11:[[be.N,be.E]],12:[[be.W,be.E]],13:[[be.S,be.E]],14:[[be.W,be.S]],15:[]};function hi(e){return parseInt(e,4)}const X3t={[hi("0000")]:[],[hi("2222")]:[],[hi("2221")]:[Kp],[hi("2212")]:[Qp],[hi("2122")]:[Zp],[hi("1222")]:[Yp],[hi("0001")]:[Kp],[hi("0010")]:[Qp],[hi("0100")]:[Zp],[hi("1000")]:[Yp],[hi("2220")]:[qp],[hi("2202")]:[$p],[hi("2022")]:[tA],[hi("0222")]:[eA],[hi("0002")]:[qp],[hi("0020")]:[$p],[hi("0200")]:[tA],[hi("2000")]:[eA],[hi("0011")]:[h9],[hi("0110")]:[f9],[hi("1100")]:[d9],[hi("1001")]:[p9],[hi("2211")]:[h9],[hi("2112")]:[f9],[hi("1122")]:[d9],[hi("1221")]:[p9],[hi("2200")]:[A9],[hi("2002")]:[g9],[hi("0022")]:[A9],[hi("0220")]:[g9],[hi("1111")]:[W3t],[hi("1211")]:[m9],[hi("2111")]:[y9],[hi("1112")]:[_9],[hi("1121")]:[v9],[hi("1011")]:[m9],[hi("0111")]:[y9],[hi("1110")]:[_9],[hi("1101")]:[v9],[hi("1200")]:[b9],[hi("0120")]:[x9],[hi("0012")]:[w9],[hi("2001")]:[C9],[hi("1022")]:[b9],[hi("2102")]:[x9],[hi("2210")]:[w9],[hi("0221")]:[C9],[hi("1002")]:[E9],[hi("2100")]:[B9],[hi("0210")]:[T9],[hi("0021")]:[S9],[hi("1220")]:[E9],[hi("0122")]:[B9],[hi("2012")]:[T9],[hi("2201")]:[S9],[hi("0211")]:[I9],[hi("2110")]:[M9],[hi("1102")]:[P9],[hi("1021")]:[R9],[hi("2011")]:[I9],[hi("0112")]:[M9],[hi("1120")]:[P9],[hi("1201")]:[R9],[hi("2101")]:[iA],[hi("0121")]:[iA],[hi("1012")]:[nA],[hi("1210")]:[nA],[hi("0101")]:{0:[Kp,Zp],1:[iA],2:[iA]},[hi("1010")]:{0:[Yp,Qp],1:[nA],2:[nA]},[hi("2121")]:{0:[iA],1:[iA],2:[Kp,Zp]},[hi("1212")]:{0:[nA],1:[nA],2:[Yp,Qp]},[hi("2120")]:{0:[uv],1:[uv],2:[qp,Zp]},[hi("2021")]:{0:[hv],1:[hv],2:[Kp,tA]},[hi("1202")]:{0:[fv],1:[fv],2:[Yp,$p]},[hi("0212")]:{0:[dv],1:[dv],2:[Qp,eA]},[hi("0102")]:{0:[qp,Zp],1:[uv],2:[uv]},[hi("0201")]:{0:[Kp,tA],1:[hv],2:[hv]},[hi("1020")]:{0:[Yp,$p],1:[fv],2:[fv]},[hi("2010")]:{0:[Qp,eA],1:[dv],2:[dv]},[hi("2020")]:{0:[eA,$p],1:[D9],2:[qp,tA]},[hi("0202")]:{0:[tA,qp],1:[D9],2:[eA,$p]}};function om(e,t){return Number.isNaN(e)?0:Array.isArray(t)?e<t[0]?0:e<t[1]?1:2:e>=t?1:0}function K3t(e){const{x:t,y:i,xRange:n,yRange:r,getValue:s,threshold:o}=e,l=t<n[0],h=t>=n[1]-1,A=i<r[0],v=i>=r[1]-1,C=l||h||A||v;let S=0,L,N,G,W;if(l||v)G=0;else{const Z=s(t,i+1);G=om(Z,o),S+=Z}if(h||v)W=0;else{const Z=s(t+1,i+1);W=om(Z,o),S+=Z}if(h||A)N=0;else{const Z=s(t+1,i);N=om(Z,o),S+=Z}if(l||A)L=0;else{const Z=s(t,i);L=om(Z,o),S+=Z}let j=-1;Number.isFinite(o)&&(j=G<<3|W<<2|N<<1|L),Array.isArray(o)&&(j=G<<6|W<<4|N<<2|L);let q=0;return C||(q=om(S/4,o)),{code:j,meanCode:q}}function Q3t(e){const{x:t,y:i,z:n,code:r,meanCode:s}=e;let o=X3t[r];Array.isArray(o)||(o=o[s]);const l=t+1,h=i+1,A=[];return o.forEach(v=>{const C=[];v.forEach(S=>{const L=l+S[0],N=h+S[1];C.push([L,N,n])}),A.push(C)}),A}function Z3t(e){const{x:t,y:i,z:n,code:r,meanCode:s}=e;let o=J3t[r];Array.isArray(o)||(o=o[s]);const l=t+1,h=i+1,A=[];return o.forEach(v=>{v.forEach(C=>{const S=l+C[0],L=h+C[1];A.push([S,L,n])})}),A}function Y3t({contours:e,getValue:t,xRange:i,yRange:n}){const r=[],s=[];let o=0,l=0;for(let h=0;h<e.length;h++){const A=e[h],v=A.zIndex??h,{threshold:C}=A;for(let S=i[0]-1;S<i[1];S++)for(let L=n[0]-1;L<n[1];L++){const{code:N,meanCode:G}=K3t({getValue:t,threshold:C,x:S,y:L,xRange:i,yRange:n}),W={x:S,y:L,z:v,code:N,meanCode:G};if(Array.isArray(C)){const j=Q3t(W);for(const q of j)s[l++]={vertices:q,contour:A}}else{const j=Z3t(W);j.length>0&&(r[o++]={vertices:j,contour:A})}}}return{lines:r,polygons:s}}function q3t(e){var t,i,n;const{aggregator:r,binIdRange:s,channel:o}=e;if(r instanceof Wa){const l=(t=r.getResult(o))==null?void 0:t.buffer;if(l){const h=new Float32Array(l.readSyncWebGL().buffer);return $3t(h,s)}}if(r instanceof Jp){const l=(i=r.getResult(o))==null?void 0:i.value,h=(n=r.getBins())==null?void 0:n.value;if(h&&l)return tBt(l,h,r.binCount)}return null}function $3t(e,t){const[[i,n],[r,s]]=t,o=n-i,l=s-r;return(h,A)=>(h-=i,A-=r,h<0||h>=o||A<0||A>=l?NaN:e[A*o+h])}function tBt(e,t,i){const n={};for(let r=0;r<i;r++){const s=t[r*2],o=t[r*2+1];n[s]=n[s]||{},n[s][o]=e[r]}return(r,s)=>{var o;return((o=n[r])==null?void 0:o[s])??NaN}}const eBt=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,iBt={name:"binOptions",vs:eBt,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}},O9=[255,255,255,255],nBt=1,rBt={cellSize:{type:"number",min:1,value:1e3},gridOrigin:{type:"array",compare:!0,value:[0,0]},getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM",contours:{type:"object",value:[{threshold:1}],optional:!0,compare:3},zOffset:.005};let EE=class extends Xp{getAggregatorType(){return this.props.gpuAggregation&&Wa.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){return e==="cpu"?new Jp({dimensions:2,getBin:{sources:["positions"],getValue:({positions:t},i,n)=>{const r=this.state.aggregatorViewport.projectPosition(t),{cellSizeCommon:s,cellOriginCommon:o}=n;return[Math.floor((r[0]-o[0])/s[0]),Math.floor((r[1]-o[1])/s[1])]}},getValue:[{sources:["counts"],getValue:({counts:t})=>t}],onUpdate:this._onAggregationUpdate.bind(this)}):new Wa(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Uo,iBt],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out float value) {
    value = counts;
  }
  `}),onUpdate:this._onAggregationUpdate.bind(this)})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}updateState(e){const t=super.updateState(e),{props:i,oldProps:n,changeFlags:r}=e,{aggregator:s}=this.state;if(t||r.dataChanged||i.cellSize!==n.cellSize||!$r(i.gridOrigin,n.gridOrigin,1)||i.aggregation!==n.aggregation){this._updateBinOptions();const{cellSizeCommon:o,cellOriginCommon:l,binIdRange:h}=this.state;s.setProps({binIdRange:h,pointCount:this.getNumInstances(),operations:[i.aggregation],binOptions:{cellSizeCommon:o,cellOriginCommon:l}})}return $r(n.contours,i.contours,2)||this.setState({contourData:null}),t}_updateBinOptions(){const e=this.getBounds(),t=[1,1];let i=[0,0],n=[[0,1],[0,1]],r=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let s=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2];const{cellSize:o,gridOrigin:l}=this.props,{unitsPerMeter:h}=r.getDistanceScales(s);t[0]=h[0]*o,t[1]=h[1]*o;const A=r.projectFlat(s);i=[Math.floor((A[0]-l[0])/t[0])*t[0]+l[0],Math.floor((A[1]-l[1])/t[1])*t[1]+l[1]],s=r.unprojectFlat(i);const v=r.constructor;r=r.isGeospatial?new v({longitude:s[0],latitude:s[1],zoom:12}):new hu({position:[s[0],s[1],0],zoom:12}),i=[Math.fround(r.center[0]),Math.fround(r.center[1])],n=xE({dataBounds:e,getBinId:C=>{const S=r.projectFlat(C);return[Math.floor((S[0]-i[0])/t[0]),Math.floor((S[1]-i[1])/t[1])]}})}this.setState({cellSizeCommon:t,cellOriginCommon:i,binIdRange:n,aggregatorViewport:r})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate(){const{aggregator:e,binIdRange:t}=this.state;this.setState({aggregatedValueReader:q3t({aggregator:e,binIdRange:t,channel:0}),contourData:null})}_getContours(){const{aggregatedValueReader:e}=this.state;if(!e)return null;if(!this.state.contourData){const{binIdRange:t}=this.state,{contours:i}=this.props,n=Y3t({contours:i,getValue:e,xRange:t[0],yRange:t[1]});this.state.contourData=n}return this.state.contourData}onAttributeChange(e){const{aggregator:t}=this.state;switch(e){case"positions":t.setNeedsUpdate(),this._updateBinOptions();const{cellSizeCommon:i,cellOriginCommon:n,binIdRange:r}=this.state;t.setProps({binIdRange:r,binOptions:{cellSizeCommon:i,cellOriginCommon:n}});break;case"counts":t.setNeedsUpdate(0);break}}renderLayers(){const e=this._getContours();if(!e)return null;const{lines:t,polygons:i}=e,{zOffset:n}=this.props,{cellOriginCommon:r,cellSizeCommon:s}=this.state,o=this.getSubLayerClass("lines",ch),l=this.getSubLayerClass("bands",hh),h=new mn().translate([r[0],r[1],0]).scale([s[0],s[1],n]),A=t&&t.length>0&&new o(this.getSubLayerProps({id:"lines"}),{data:t,coordinateSystem:qi.CARTESIAN,modelMatrix:h,getPath:C=>C.vertices,getColor:C=>C.contour.color??O9,getWidth:C=>C.contour.strokeWidth??nBt,widthUnits:"pixels"}),v=i&&i.length>0&&new l(this.getSubLayerProps({id:"bands"}),{data:i,coordinateSystem:qi.CARTESIAN,modelMatrix:h,getPolygon:C=>C.vertices,getFillColor:C=>C.contour.color??O9});return[A,v]}getPickingInfo(e){const t=e.info,{object:i}=t;return i&&(t.object={contour:i.contour}),t}};EE.layerName="ContourLayer",EE.defaultProps=rBt;const oBt=`#version 300 es
#define SHADER_NAME grid-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < grid.colorDomain.z ||
instanceColorValues > grid.colorDomain.w ||
instanceElevationValues < grid.elevationDomain.z ||
instanceElevationValues > grid.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = (instancePositions + (positions.xy + 1.0) / 2.0 * column.coverage) * grid.sizeCommon + grid.originCommon - project.commonOrigin.xy;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, grid.elevationDomain.xy, grid.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, grid.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,sBt=`uniform gridUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
  vec2 sizeCommon;
} grid;
`,aBt={name:"grid",vs:sBt,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>",sizeCommon:"vec2<f32>"}};class L9 extends dc{getShaders(){const t=super.getShaders();return t.modules.push(aBt),{...t,vs:oBt}}initializeState(){super.initializeState();const t=this.getAttributeManager();t.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),t.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(t){var i;super.updateState(t);const{props:n,oldProps:r}=t,s=this.state.fillModel;if(r.colorRange!==n.colorRange){(i=this.state.colorTexture)==null||i.destroy(),this.state.colorTexture=vE(this.context.device,n.colorRange,n.colorScaleType);const o={colorRange:this.state.colorTexture};s.shaderInputs.setProps({grid:o})}else r.colorScaleType!==n.colorScaleType&&_E(this.state.colorTexture,n.colorScaleType)}finalizeState(t){var i;super.finalizeState(t),(i=this.state.colorTexture)==null||i.destroy()}_updateGeometry(){const t=new oP;this.state.fillModel.setGeometry(t)}draw({uniforms:t}){const{cellOriginCommon:i,cellSizeCommon:n,elevationRange:r,elevationScale:s,extruded:o,coverage:l,colorDomain:h,elevationDomain:A}=this.props,v=this.props.colorCutoff||[-1/0,1/0],C=this.props.elevationCutoff||[-1/0,1/0],S=this.state.fillModel,L={colorDomain:[Math.max(h[0],v[0]),Math.min(h[1],v[1]),Math.max(h[0]-1,v[0]),Math.min(h[1]+1,v[1])],elevationDomain:[Math.max(A[0],C[0]),Math.min(A[1],C[1]),Math.max(A[0]-1,C[0]),Math.min(A[1]+1,C[1])],elevationRange:[r[0]*s,r[1]*s],originCommon:i,sizeCommon:n};S.shaderInputs.setProps({column:{extruded:o,coverage:l},grid:L}),S.draw(this.context.renderPass)}}L9.layerName="GridCellLayer";const lBt=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,cBt={name:"binOptions",vs:lBt,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}};function F9(){}const uBt={gpuAggregation:!0,colorDomain:null,colorRange:ov,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:F9,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:F9,cellSize:{type:"number",min:0,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:e=>e.position},gridAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0};class BE extends Xp{getAggregatorType(){const{gpuAggregation:t,gridAggregator:i,getColorValue:n,getElevationValue:r}=this.props;return t&&(i||n||r)?(Yi.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):t&&Wa.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(t){if(t==="cpu"){const{gridAggregator:i,cellSize:n}=this.props;return new Jp({dimensions:2,getBin:{sources:["positions"],getValue:({positions:r},s,o)=>{if(i)return i(r,n);const l=this.state.aggregatorViewport.projectPosition(r),{cellSizeCommon:h,cellOriginCommon:A}=o;return[Math.floor((l[0]-A[0])/h[0]),Math.floor((l[1]-A[1])/h[1])]}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:r})=>r},{sources:["elevationWeights"],getValue:({elevationWeights:r})=>r}]})}return new Wa(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Uo,cBt],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(t){const i=super.updateState(t),{props:n,oldProps:r,changeFlags:s}=t,{aggregator:o}=this.state;if((s.dataChanged||!this.state.dataAsArray)&&(n.getColorValue||n.getElevationValue)&&(this.state.dataAsArray=Array.from(lc(n.data).iterable)),i||s.dataChanged||n.cellSize!==r.cellSize||n.getColorValue!==r.getColorValue||n.getElevationValue!==r.getElevationValue||n.colorAggregation!==r.colorAggregation||n.elevationAggregation!==r.elevationAggregation){this._updateBinOptions();const{cellSizeCommon:l,cellOriginCommon:h,binIdRange:A,dataAsArray:v}=this.state;if(o.setProps({binIdRange:A,pointCount:this.getNumInstances(),operations:[n.colorAggregation,n.elevationAggregation],binOptions:{cellSizeCommon:l,cellOriginCommon:h},onUpdate:this._onAggregationUpdate.bind(this)}),v){const{getColorValue:C,getElevationValue:S}=this.props;o.setProps({customOperations:[C&&(L=>C(L.map(N=>v[N]),{indices:L,data:n.data})),S&&(L=>S(L.map(N=>v[N]),{indices:L,data:n.data}))]})}}return s.updateTriggersChanged&&s.updateTriggersChanged.getColorValue&&o.setNeedsUpdate(0),s.updateTriggersChanged&&s.updateTriggersChanged.getElevationValue&&o.setNeedsUpdate(1),i}_updateBinOptions(){const t=this.getBounds(),i=[1,1];let n=[0,0],r=[[0,1],[0,1]],s=this.context.viewport;if(t&&Number.isFinite(t[0][0])){let o=[(t[0][0]+t[1][0])/2,(t[0][1]+t[1][1])/2];const{cellSize:l}=this.props,{unitsPerMeter:h}=s.getDistanceScales(o);i[0]=h[0]*l,i[1]=h[1]*l;const A=s.projectFlat(o);n=[Math.floor(A[0]/i[0])*i[0],Math.floor(A[1]/i[1])*i[1]],o=s.unprojectFlat(n);const v=s.constructor;s=s.isGeospatial?new v({longitude:o[0],latitude:o[1],zoom:12}):new hu({position:[o[0],o[1],0],zoom:12}),n=[Math.fround(s.center[0]),Math.fround(s.center[1])],r=xE({dataBounds:t,getBinId:C=>{const S=s.projectFlat(C);return[Math.floor((S[0]-n[0])/i[0]),Math.floor((S[1]-n[1])/i[1])]}})}this.setState({cellSizeCommon:i,cellOriginCommon:n,binIdRange:r,aggregatorViewport:s})}draw(t){t.shaderModuleProps.project&&(t.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(t)}_onAggregationUpdate({channel:t}){const i=this.getCurrentLayer().props,{aggregator:n}=this.state;if(t===0){const r=n.getResult(0);this.setState({colors:new av(r,n.binCount)}),i.onSetColorDomain(n.getResultDomain(0))}else if(t===1){const r=n.getResult(1);this.setState({elevations:new av(r,n.binCount)}),i.onSetElevationDomain(n.getResultDomain(1))}}onAttributeChange(t){const{aggregator:i}=this.state;switch(t){case"positions":i.setNeedsUpdate(),this._updateBinOptions();const{cellSizeCommon:n,cellOriginCommon:r,binIdRange:s}=this.state;i.setProps({binIdRange:s,binOptions:{cellSizeCommon:n,cellOriginCommon:r}});break;case"colorWeights":i.setNeedsUpdate(0);break;case"elevationWeights":i.setNeedsUpdate(1);break}}renderLayers(){var t,i;const{aggregator:n,cellOriginCommon:r,cellSizeCommon:s}=this.state,{elevationScale:o,colorRange:l,elevationRange:h,extruded:A,coverage:v,material:C,transitions:S,colorScaleType:L,lowerPercentile:N,upperPercentile:G,colorDomain:W,elevationScaleType:j,elevationLowerPercentile:q,elevationUpperPercentile:Z,elevationDomain:K}=this.props,ft=this.getSubLayerClass("cells",L9),rt=n.getBins(),Lt=(t=this.state.colors)==null?void 0:t.update({scaleType:L,lowerPercentile:N,upperPercentile:G}),Vt=(i=this.state.elevations)==null?void 0:i.update({scaleType:j,lowerPercentile:q,upperPercentile:Z});return!Lt||!Vt?null:new ft(this.getSubLayerProps({id:"cells"}),{data:{length:n.binCount,attributes:{getBin:rt,getColorValue:Lt.attribute,getElevationValue:Vt.attribute}},dataComparator:(At,at)=>At.length===at.length,updateTriggers:{getBin:[rt],getColorValue:[Lt.attribute],getElevationValue:[Vt.attribute]},cellOriginCommon:r,cellSizeCommon:s,elevationScale:o,colorRange:l,colorScaleType:L,elevationRange:h,extruded:A,coverage:v,material:C,colorDomain:Lt.domain||W||n.getResultDomain(0),elevationDomain:Vt.domain||K||n.getResultDomain(1),colorCutoff:Lt.cutoff,elevationCutoff:Vt.cutoff,transitions:S&&{getFillColor:S.getColorValue||S.getColorWeight,getElevation:S.getElevationValue||S.getElevationWeight},extensions:[]})}getPickingInfo(t){const i=t.info,{index:n}=i;if(n>=0){const r=this.state.aggregator.getBin(n);let s;r&&(s={col:r.id[0],row:r.id[1],colorValue:r.value[0],elevationValue:r.value[1],count:r.count},r.pointIndices&&(s.pointIndices=r.pointIndices,s.points=Array.isArray(this.props.data)?r.pointIndices.map(o=>this.props.data[o]):[])),i.object=s}return i}}BE.layerName="GridLayer",BE.defaultProps=uBt;function hBt(e){const t=e.map(l=>l[0]),i=e.map(l=>l[1]),n=Math.min.apply(null,t),r=Math.max.apply(null,t),s=Math.min.apply(null,i),o=Math.max.apply(null,i);return[n,s,r,o]}function fBt(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}const k9=new Float32Array(12);function N9(e,t=2){let i=0;for(const n of e)for(let r=0;r<t;r++)k9[i++]=n[r]||0;return k9}function dBt(e,t,i){const[n,r,s,o]=e,l=s-n,h=o-r;let A=l,v=h;l/h<t/i?A=t/i*h:v=i/t*l,A<t&&(A=t,v=i);const C=(s+n)/2,S=(o+r)/2;return[C-A/2,S-v/2,C+A/2,S+v/2]}function pBt(e,t){const[i,n,r,s]=t;return[(e[0]-i)/(r-i),(e[1]-n)/(s-n)]}const ABt=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * triangle.threshold;
if (triangle.colorDomain[1] > 0.) {
maxValue = triangle.colorDomain[1];
minValue = triangle.colorDomain[0];
}
vIntensityMax = triangle.intensity / maxValue;
vIntensityMin = triangle.intensity / minValue;
}
`,gBt=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (triangle.aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= layer.opacity;
fragColor = linearColor;
}
`,U9=`uniform triangleUniforms {
  float aggregationMode;
  vec2 colorDomain;
  float intensity;
  float threshold;
} triangle;
`,mBt={name:"triangle",vs:U9,fs:U9,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};class G9 extends Io{getShaders(){return super.getShaders({vs:ABt,fs:gBt,modules:[Uo,mBt]})}initializeState({device:t}){this.setState({model:this._getModel(t)})}_getModel(t){const{vertexCount:i,data:n}=this.props;return new Hr(t,{...this.getShaders(),id:this.props.id,attributes:n.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:i})}draw(){const{model:t}=this.state,{aggregationMode:i,colorDomain:n,intensity:r,threshold:s,colorTexture:o,maxTexture:l,weightsTexture:h}=this.props,A={aggregationMode:i,colorDomain:n,intensity:r,threshold:s,colorTexture:o,maxTexture:l,weightsTexture:h};t.shaderInputs.setProps({triangle:A}),t.draw(this.context.renderPass)}}G9.layerName="TriangleLayer";function yBt(e,t){const i={};for(const n in e)t.includes(n)||(i[n]=e[n]);return i}class z9 extends Mo{initializeAggregationLayer(t){super.initializeState(this.context),this.setState({ignoreProps:yBt(this.constructor._propTypes,t.data.props),dimensions:t})}updateState(t){super.updateState(t);const{changeFlags:i}=t;if(i.extensionsChanged){const n=this.getShaders({});n&&n.defines&&(n.defines.NON_INSTANCED_MODEL=1),this.updateShaders(n)}this._updateAttributes()}updateAttributes(t){this.setState({changedAttributes:t})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){const{viewport:t,mousePosition:i,device:n}=this.context;return Object.assign(Object.create(this.props),{viewport:t,mousePosition:i,picking:{isActive:0},devicePixelRatio:n.canvasContext.cssToDeviceRatio()})}updateShaders(t){}isAggregationDirty(t,i={}){const{props:n,oldProps:r,changeFlags:s}=t,{compareAll:o=!1,dimension:l}=i,{ignoreProps:h}=this.state,{props:A,accessors:v=[]}=l,{updateTriggersChanged:C}=s;if(s.dataChanged)return!0;if(C){if(C.all)return!0;for(const S of v)if(C[S])return!0}if(o)return s.extensionsChanged?!0:qb({oldProps:r,newProps:n,ignoreProps:h,propTypes:this.constructor._propTypes});for(const S of A)if(n[S]!==r[S])return!0;return!1}isAttributeChanged(t){const{changedAttributes:i}=this.state;return t?i&&i[t]!==void 0:!_Bt(i)}_getAttributeManager(){return new K0(this.context.device,{id:this.props.id,stats:this.context.stats})}}z9.layerName="AggregationLayer";function _Bt(e){let t=!0;for(const i in e){t=!1;break}return t}const V9=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
void main()
{
weightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`,j9=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,vBt=`#version 300 es
uniform sampler2D inTexture;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(maxWeight.textureSize);
int xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`,bBt=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`,xBt=`uniform weightUniforms {
  vec4 commonBounds;
  float radiusPixels;
  float textureWidth;
  float weightsScale;
} weight;
`,wBt={name:"weight",vs:xBt,uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},CBt={name:"maxWeight",vs:`uniform maxWeightUniforms {
  float textureSize;
} maxWeight;
`,uniformTypes:{textureSize:"f32"}},EBt=2,TE={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},H9=[0,0],BBt={SUM:0,MEAN:1},TBt={getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:ov,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},SBt=["float32-renderable-webgl","texture-blend-float-webgl"],IBt={data:{props:["radiusPixels"]}};class SE extends z9{getShaders(t){let i=[Uo];return t.modules&&(i=[...i,...t.modules]),super.getShaders({...t,modules:i})}initializeState(){super.initializeAggregationLayer(IBt),this.setState({colorDomain:H9}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState(t){super.updateState(t),this._updateHeatmapState(t)}_updateHeatmapState(t){const{props:i,oldProps:n}=t,r=this._getChangeFlags(t);(r.dataChanged||r.viewportChanged)&&(r.boundsChanged=this._updateBounds(r.dataChanged),this._updateTextureRenderingBounds()),r.dataChanged||r.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):r.viewportZoomChanged&&this._debouncedUpdateWeightmap(),i.colorRange!==n.colorRange&&this._updateColorTexture(t),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:t.context.viewport.zoom})}renderLayers(){const{weightsTexture:t,triPositionBuffer:i,triTexCoordBuffer:n,maxWeightsTexture:r,colorTexture:s,colorDomain:o}=this.state,{updateTriggers:l,intensity:h,threshold:A,aggregation:v}=this.props,C=this.getSubLayerClass("triangle",G9);return new C(this.getSubLayerProps({id:"triangle-layer",updateTriggers:l}),{coordinateSystem:qi.DEFAULT,data:{attributes:{positions:i,texCoords:n}},vertexCount:4,maxTexture:r,colorTexture:s,aggregationMode:BBt[v]||0,weightsTexture:t,intensity:h,threshold:A,colorDomain:o})}finalizeState(t){super.finalizeState(t);const{weightsTransform:i,weightsTexture:n,maxWeightTransform:r,maxWeightsTexture:s,triPositionBuffer:o,triTexCoordBuffer:l,colorTexture:h,updateTimer:A}=this.state;i==null||i.destroy(),n==null||n.destroy(),r==null||r.destroy(),s==null||s.destroy(),o==null||o.destroy(),l==null||l.destroy(),h==null||h.destroy(),A&&clearTimeout(A)}_getAttributeManager(){return new K0(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(t){const i={},{dimensions:n}=this.state;i.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(t,{compareAll:!0,dimension:n.data})&&"aggregation is dirty",i.viewportChanged=t.changeFlags.viewportChanged;const{zoom:r}=this.state;return(!t.context.viewport||t.context.viewport.zoom!==r)&&(i.viewportZoomChanged=!0),i}_createTextures(){const{textureSize:t,format:i}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...TE,width:t,height:t,format:i}),maxWeightsTexture:this.context.device.createTexture({...TE,width:1,height:1,format:i})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{device:t}=this.context,{weightsTextureSize:i}=this.props,n=Math.min(i,t.limits.maxTextureDimension2D),r=SBt.every(l=>t.features.has(l)),s=r?"rgba32float":"rgba8unorm",o=r?1:1/255;this.setState({textureSize:n,format:s,weightsScale:o}),r||Yi.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(t){let{weightsTransform:i}=this.state;const{weightsTexture:n}=this.state,r=this.getAttributeManager();i==null||i.destroy(),i=new nP(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:r.getBufferLayouts(),vertexCount:1,targetTexture:n,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...t,modules:[...t.modules,wBt]}),this.setState({weightsTransform:i})}_setupResources(){this._createTextures();const{device:t}=this.context,{textureSize:i,weightsTexture:n,maxWeightsTexture:r}=this.state,s=this.getShaders({vs:V9,fs:j9});this._createWeightsTransform(s);const o=this.getShaders({vs:vBt,fs:bBt,modules:[CBt]}),l=new nP(t,{id:`${this.id}-max-weights-transform`,targetTexture:r,...o,vertexCount:i*i,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),h={inTexture:n,textureSize:i};l.model.shaderInputs.setProps({maxWeight:h}),this.setState({weightsTexture:n,maxWeightsTexture:r,maxWeightTransform:l,zoom:null,triPositionBuffer:t.createBuffer({byteLength:48}),triTexCoordBuffer:t.createBuffer({byteLength:48})})}updateShaders(t){this._createWeightsTransform({vs:V9,fs:j9,...t})}_updateMaxWeightValue(){const{maxWeightTransform:t}=this.state;t.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(t=!1){const{viewport:i}=this.context,n=[i.unproject([0,0]),i.unproject([i.width,0]),i.unproject([0,i.height]),i.unproject([i.width,i.height])].map(l=>l.map(Math.fround)),r=hBt(n),s={visibleWorldBounds:r,viewportCorners:n};let o=!1;if(t||!this.state.worldBounds||!fBt(this.state.worldBounds,r)){const l=this._worldToCommonBounds(r),h=this._commonToWorldBounds(l);this.props.coordinateSystem===qi.LNGLAT&&(h[1]=Math.max(h[1],-85.051129),h[3]=Math.min(h[3],85.051129),h[0]=Math.max(h[0],-360),h[2]=Math.min(h[2],360));const A=this._worldToCommonBounds(h);s.worldBounds=h,s.normalizedCommonBounds=A,o=!0}return this.setState(s),o}_updateTextureRenderingBounds(){const{triPositionBuffer:t,triTexCoordBuffer:i,normalizedCommonBounds:n,viewportCorners:r}=this.state,{viewport:s}=this.context;t.write(N9(r,3));const o=r.map(l=>pBt(s.projectPosition(l),n));i.write(N9(o,2))}_updateColorTexture(t){const{colorRange:i}=t.props;let{colorTexture:n}=this.state;const r=r9(i,!1,Uint8Array);n&&(n==null?void 0:n.width)===i.length?n.setTexture2DData({data:r}):(n==null||n.destroy(),n=this.context.device.createTexture({...TE,data:r,width:i.length,height:1})),this.setState({colorTexture:n})}_updateWeightmap(){const{radiusPixels:t,colorDomain:i,aggregation:n}=this.props,{worldBounds:r,textureSize:s,weightsScale:o,weightsTexture:l}=this.state,h=this.state.weightsTransform;this.state.isWeightMapDirty=!1;const A=this._worldToCommonBounds(r,{useLayerCoordinateSystem:!0});if(i&&n==="SUM"){const{viewport:q}=this.context,Z=q.distanceScales.metersPerUnit[2]*(A[2]-A[0])/s;this.state.colorDomain=i.map(K=>K*Z*o)}else this.state.colorDomain=i||H9;const v=this.getAttributeManager().getAttributes(),C=this.getModuleSettings();this._setModelAttributes(h.model,v),h.model.setVertexCount(this.getNumInstances());const S={radiusPixels:t,commonBounds:A,textureWidth:s,weightsScale:o,weightsTexture:l},{viewport:L,devicePixelRatio:N,coordinateSystem:G,coordinateOrigin:W}=C,{modelMatrix:j}=this.props;h.model.shaderInputs.setProps({project:{viewport:L,devicePixelRatio:N,modelMatrix:j,coordinateSystem:G,coordinateOrigin:W},weight:S}),h.run({parameters:{viewport:[0,0,s,s]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(t=!1){let{updateTimer:i}=this.state;const{debounceTimeout:n}=this.props;t?(i=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(i),i=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),n)),this.setState({updateTimer:i})}_worldToCommonBounds(t,i={}){const{useLayerCoordinateSystem:n=!1}=i,[r,s,o,l]=t,{viewport:h}=this.context,{textureSize:A}=this.state,{coordinateSystem:v}=this.props,C=n&&(v===qi.LNGLAT_OFFSETS||v===qi.METER_OFFSETS),S=C?h.projectPosition(this.props.coordinateOrigin):[0,0],L=A*EBt/h.scale;let N,G;return n&&!C?(N=this.projectPosition([r,s,0]),G=this.projectPosition([o,l,0])):(N=h.projectPosition([r,s,0]),G=h.projectPosition([o,l,0])),dBt([N[0]-S[0],N[1]-S[1],G[0]-S[0],G[1]-S[1]],L,L)}_commonToWorldBounds(t){const[i,n,r,s]=t,{viewport:o}=this.context,l=o.unprojectPosition([i,n]),h=o.unprojectPosition([r,s]);return l.slice(0,2).concat(h.slice(0,2))}}SE.layerName="HeatmapLayer",SE.defaultProps=TBt;const MBt=Object.freeze(Object.defineProperty({__proto__:null,CPUAggregator:Jp,ContourLayer:EE,GridLayer:BE,HeatmapLayer:SE,HexagonLayer:CE,ScreenGridLayer:bE,WebGLAggregator:Wa,_AggregationLayer:Xp},Symbol.toStringTag,{value:"Module"})),PBt={ClusterTileLayer:oE,H3TileLayer:aE,HeatmapTileLayer:uE,PointLabelLayer:nv,QuadbinTileLayer:iv,RasterTileLayer:dE,VectorTileLayer:pE};function IE(e,t=""){if(!e)throw new Error(`JSON conversion error ${t}`)}function RBt(e,t){const i=OBt(t);let n=e;for(const r of i)n=DBt(n)?n[r]:void 0;return n}function DBt(e){return e!==null&&typeof e=="object"}const W9={};function OBt(e){if(typeof e=="string"){let t=W9[e];return t||(t=e.split("."),W9[e]=t),t}return Array.isArray(e)?e:[e]}var ME={exports:{}},J9;function LBt(){return J9||(J9=1,function(e,t){(function(i){var n="Compound",r="Identifier",s="MemberExpression",o="Literal",l="ThisExpression",h="CallExpression",A="UnaryExpression",v="BinaryExpression",C="LogicalExpression",S="ConditionalExpression",L="ArrayExpression",N=46,G=44,W=39,j=34,q=40,Z=41,K=91,ft=93,rt=63,Lt=59,Vt=58,At=function(Se,se){var fi=new Error(Se+" at character "+se);throw fi.index=se,fi.description=Se,fi},at=!0,kt={"-":at,"!":at,"~":at,"+":at},X={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},ht=function(Se){var se=0,fi;for(var Ze in Se)(fi=Ze.length)>se&&Se.hasOwnProperty(Ze)&&(se=fi);return se},Mt=ht(kt),pe=ht(X),Ct={true:!0,false:!1,null:null},Dt="this",Gt=function(Se){return X[Se]||0},te=function(Se,se,fi){var Ze=Se==="||"||Se==="&&"?C:v;return{type:Ze,operator:Se,left:se,right:fi}},re=function(Se){return Se>=48&&Se<=57},ae=function(Se){return Se===36||Se===95||Se>=65&&Se<=90||Se>=97&&Se<=122||Se>=128&&!X[String.fromCharCode(Se)]},he=function(Se){return Se===36||Se===95||Se>=65&&Se<=90||Se>=97&&Se<=122||Se>=48&&Se<=57||Se>=128&&!X[String.fromCharCode(Se)]},Pe=function(Se){for(var se=0,fi=Se.charAt,Ze=Se.charCodeAt,Ye=function(je){return fi.call(Se,je)},ze=function(je){return Ze.call(Se,je)},pi=Se.length,sn=function(){for(var je=ze(se);je===32||je===9||je===10||je===13;)je=ze(++se)},Ii=function(){var je=Fn(),mi,Mi;if(sn(),ze(se)===rt){if(se++,mi=Ii(),mi||At("Expected expression",se),sn(),ze(se)===Vt)return se++,Mi=Ii(),Mi||At("Expected expression",se),{type:S,test:je,consequent:mi,alternate:Mi};At("Expected :",se)}else return je},_i=function(){sn();for(var je=Se.substr(se,pe),mi=je.length;mi>0;){if(X.hasOwnProperty(je)&&(!ae(ze(se))||se+je.length<Se.length&&!he(ze(se+je.length))))return se+=mi,je;je=je.substr(0,--mi)}return!1},Fn=function(){var je,mi,Mi,nn,_r,St,Ne,Xe,ci;if(St=Ai(),mi=_i(),!mi)return St;for(_r={value:mi,prec:Gt(mi)},Ne=Ai(),Ne||At("Expected expression after "+mi,se),nn=[St,_r,Ne];(mi=_i())&&(Mi=Gt(mi),Mi!==0);){for(_r={value:mi,prec:Mi},ci=mi;nn.length>2&&Mi<=nn[nn.length-2].prec;)Ne=nn.pop(),mi=nn.pop().value,St=nn.pop(),je=te(mi,St,Ne),nn.push(je);je=Ai(),je||At("Expected expression after "+ci,se),nn.push(_r,je)}for(Xe=nn.length-1,je=nn[Xe];Xe>1;)je=te(nn[Xe-1].value,nn[Xe-2],je),Xe-=2;return je},Ai=function(){var je,mi,Mi;if(sn(),je=ze(se),re(je)||je===N)return vi();if(je===W||je===j)return cn();if(je===K)return rr();for(mi=Se.substr(se,Mt),Mi=mi.length;Mi>0;){if(kt.hasOwnProperty(mi)&&(!ae(ze(se))||se+mi.length<Se.length&&!he(ze(se+mi.length))))return se+=Mi,{type:A,operator:mi,argument:Ai(),prefix:!0};mi=mi.substr(0,--Mi)}return ae(je)||je===q?$n():!1},vi=function(){for(var je="",mi,Mi;re(ze(se));)je+=Ye(se++);if(ze(se)===N)for(je+=Ye(se++);re(ze(se));)je+=Ye(se++);if(mi=Ye(se),mi==="e"||mi==="E"){for(je+=Ye(se++),mi=Ye(se),(mi==="+"||mi==="-")&&(je+=Ye(se++));re(ze(se));)je+=Ye(se++);re(ze(se-1))||At("Expected exponent ("+je+Ye(se)+")",se)}return Mi=ze(se),ae(Mi)?At("Variable names cannot start with a number ("+je+Ye(se)+")",se):Mi===N&&At("Unexpected period",se),{type:o,value:parseFloat(je),raw:je}},cn=function(){for(var je="",mi=Ye(se++),Mi=!1,nn;se<pi;)if(nn=Ye(se++),nn===mi){Mi=!0;break}else if(nn==="\\")switch(nn=Ye(se++),nn){case"n":je+=`
`;break;case"r":je+="\r";break;case"t":je+="	";break;case"b":je+="\b";break;case"f":je+="\f";break;case"v":je+="\v";break;default:je+=nn}else je+=nn;return Mi||At('Unclosed quote after "'+je+'"',se),{type:o,value:je,raw:mi+je+mi}},Ri=function(){var je=ze(se),mi=se,Mi;for(ae(je)?se++:At("Unexpected "+Ye(se),se);se<pi&&(je=ze(se),he(je));)se++;return Mi=Se.slice(mi,se),Ct.hasOwnProperty(Mi)?{type:o,value:Ct[Mi],raw:Mi}:Mi===Dt?{type:l}:{type:r,name:Mi}},ur=function(je){for(var mi,Mi=[],nn,_r=!1,St=0;se<pi;)if(sn(),mi=ze(se),mi===je){_r=!0,se++,je===Z&&St&&St>=Mi.length&&At("Unexpected token "+String.fromCharCode(je),se);break}else if(mi===G){if(se++,St++,St!==Mi.length){if(je===Z)At("Unexpected token ,",se);else if(je===ft)for(var Ne=Mi.length;Ne<St;Ne++)Mi.push(null)}}else nn=Ii(),(!nn||nn.type===n)&&At("Expected comma",se),Mi.push(nn);return _r||At("Expected "+String.fromCharCode(je),se),Mi},$n=function(){var je,mi;for(je=ze(se),je===q?mi=gn():mi=Ri(),sn(),je=ze(se);je===N||je===K||je===q;)se++,je===N?(sn(),mi={type:s,computed:!1,object:mi,property:Ri()}):je===K?(mi={type:s,computed:!0,object:mi,property:Ii()},sn(),je=ze(se),je!==ft&&At("Unclosed [",se),se++):je===q&&(mi={type:h,arguments:ur(Z),callee:mi}),sn(),je=ze(se);return mi},gn=function(){se++;var je=Ii();if(sn(),ze(se)===Z)return se++,je;At("Unclosed (",se)},rr=function(){return se++,{type:L,elements:ur(ft)}},Wn=[],Tn,tr;se<pi;)Tn=ze(se),Tn===Lt||Tn===G?se++:(tr=Ii())?Wn.push(tr):se<pi&&At('Unexpected "'+Ye(se)+'"',se);return Wn.length===1?Wn[0]:{type:n,body:Wn}};Pe.version="0.3.5",Pe.toString=function(){return"JavaScript Expression Parser (JSEP) v"+Pe.version},Pe.addUnaryOp=function(Se){return Mt=Math.max(Se.length,Mt),kt[Se]=at,this},Pe.addBinaryOp=function(Se,se){return pe=Math.max(Se.length,pe),X[Se]=se,this},Pe.addLiteral=function(Se,se){return Ct[Se]=se,this},Pe.removeUnaryOp=function(Se){return delete kt[Se],Se.length===Mt&&(Mt=ht(kt)),this},Pe.removeAllUnaryOps=function(){return kt={},Mt=0,this},Pe.removeBinaryOp=function(Se){return delete X[Se],Se.length===pe&&(pe=ht(X)),this},Pe.removeAllBinaryOps=function(){return X={},pe=0,this},Pe.removeLiteral=function(Se){return delete Ct[Se],this},Pe.removeAllLiterals=function(){return Ct={},this},e.exports?t=e.exports=Pe:t.parse=Pe})()}(ME,ME.exports)),ME.exports}var FBt=LBt();const kBt=Jh(FBt),X9={"||":(e,t)=>e||t,"&&":(e,t)=>e&&t,"|":(e,t)=>e|t,"^":(e,t)=>e^t,"&":(e,t)=>e&t,"==":(e,t)=>e==t,"!=":(e,t)=>e!=t,"===":(e,t)=>e===t,"!==":(e,t)=>e!==t,"<":(e,t)=>e<t,">":(e,t)=>e>t,"<=":(e,t)=>e<=t,">=":(e,t)=>e>=t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,">>>":(e,t)=>e>>>t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t)=>e%t},NBt={"-":e=>-e,"+":e=>+e,"~":e=>~e,"!":e=>!e};function K9(e,t){return e.map(function(i){return rs(i,t)})}function Q9(e,t){const i=rs(e.object,t);let n;if(e.computed?n=rs(e.property,t):n=e.property.name,/^__proto__|prototype|constructor$/.test(n))throw Error(`Access to member "${n}" disallowed.`);return[i,i[n]]}function rs(e,t){const i=e;switch(i.type){case"ArrayExpression":return K9(i.elements,t);case"BinaryExpression":return X9[i.operator](rs(i.left,t),rs(i.right,t));case"CallExpression":let n,r,s;return i.callee.type==="MemberExpression"?(s=Q9(i.callee,t),n=s[0],r=s[1]):r=rs(i.callee,t),typeof r!="function"?void 0:r.apply(n,K9(i.arguments,t));case"ConditionalExpression":return rs(i.test,t)?rs(i.consequent,t):rs(i.alternate,t);case"Identifier":return t[i.name];case"Literal":return i.value;case"LogicalExpression":return i.operator==="||"?rs(i.left,t)||rs(i.right,t):i.operator==="&&"?rs(i.left,t)&&rs(i.right,t):X9[i.operator](rs(i.left,t),rs(i.right,t));case"MemberExpression":return Q9(i,t)[1];case"ThisExpression":return t;case"UnaryExpression":return NBt[i.operator](rs(i.argument,t));default:return}}const PE={"-":e=>e};function Z9(e,t){if(e in PE)return PE[e];let i;const n=kBt(e);return n.type==="Identifier"?i=r=>RBt(r,e):(RE(n,r=>{if(r.type==="CallExpression")throw new Error("Function calls not allowed in JSON expressions")}),i=r=>rs(n,r)),PE[e]=i,i}function RE(e,t){if(Array.isArray(e))e.forEach(i=>RE(i,t));else if(e&&typeof e=="object"){e.type&&t(e);for(const i in e)RE(e[i],t)}}const pv="@@=",Y9="@@#",UBt="@@type",q9="@@function",$9=e=>e&&typeof e=="object";class DE{constructor(...t){this.typeKey=UBt,this.functionKey=q9,this.log=console,this.classes={},this.reactComponents={},this.enumerations={},this.constants={},this.functions={},this.React=null,this.convertFunction=Z9,this.preProcessClassProps=(i,n)=>n,this.postProcessConvertedJson=i=>i;for(const i of t)this.merge(i)}merge(t){for(const i in t)switch(i){case"layers":case"views":Object.assign(this.classes,t[i]);break;default:if(i in this){const n=t[i];this[i]=$9(this[i])?Object.assign(this[i],n):n}}}validate(t){return IE(!this.typeKey||typeof this.typeKey=="string"),IE($9(this.classes)),!0}}function GBt(e){return typeof e=="string"&&e.startsWith(pv)}function zBt(e){return e.replace(pv,"")}function tN(e,t){const i={};for(const n in e){let r=e[n];GBt(r)&&(r=zBt(r),r=Z9(r)),i[n]=r}return i}function VBt(e,t,i){const n=i.classes[e],r=i.reactComponents[e];if(!n&&!r){const{log:s}=i;if(s){const o=JSON.stringify(t,null,0).slice(0,40);s.warn(`JSON converter: No registered class of type ${e}(${o}...)  `)}return null}return n?jBt(n,t,i):HBt(r,t,i)}function jBt(e,t,i){return i.preProcessClassProps&&(t=i.preProcessClassProps(e,t,i)),t=tN(t),new e(t)}function HBt(e,t,i){const{React:n}=i,{children:r=[]}=t;return delete t.children,i.preProcessClassProps&&(t=i.preProcessClassProps(e,t,i)),t=tN(t),n.createElement(e,t,r)}function WBt(e,t,i){const n=i.functions[e];if(!n){const{log:r}=i;if(r){const s=JSON.stringify(t,null,0).slice(0,40);r.warn(`JSON converter: No registered function ${e}(${s}...)  `)}return null}return n(t)}function JBt(e){return typeof e=="string"?JSON.parse(e):e}const OE=e=>e&&typeof e=="object";class XBt{constructor(t){this.log=console,this.onJSONChange=()=>{},this.json=null,this.convertedJson=null,this.setProps(t)}finalize(){}setProps(t){"configuration"in t&&(this.configuration=t.configuration instanceof DE?t.configuration:new DE(t.configuration)),"onJSONChange"in t&&(this.onJSONChange=t.onJSONChange)}mergeConfiguration(t){this.configuration.merge(t)}convert(t){if(!t||t===this.json)return this.convertedJson;this.json=t;const i=JBt(t);let n=KBt(i,this.configuration);return n=this.configuration.postProcessConvertedJson(n),this.convertedJson=n,n}convertJson(t){return this.convert(t)}}function KBt(e,t){return t=new DE(t),LE(e,"",t)}function LE(e,t,i){return Array.isArray(e)?e.map((n,r)=>LE(n,String(r),i)):QBt(e,i)?ZBt(e,i):OE(e)?q9 in e?YBt(e,i):FE(e,i):typeof e=="string"?qBt(e,t,i):e}function QBt(e,t){const{typeKey:i}=t;return OE(e)&&!!e[i]}function ZBt(e,t){const{typeKey:i}=t,n=e[i];let r={...e};return delete r[i],r=FE(r,t),VBt(n,r,t)}function YBt(e,t){const{functionKey:i}=t,n=e[i];let r={...e};return delete r[i],r=FE(r,t),WBt(n,r,t)}function FE(e,t){IE(OE(e));const i={};for(const n in e){const r=e[n];i[n]=LE(r,n,t)}return i}function qBt(e,t,i){if(e.startsWith(pv)&&i.convertFunction)return e=e.replace(pv,""),i.convertFunction(e,i);if(e.startsWith(Y9)){if(e=e.replace(Y9,""),i.constants[e])return i.constants[e];const[n,r]=e.split(".");return i.enumerations[n][r]}return e}const $Bt={classes:{...eft,...MBt,...Twt,...o_t,...PBt},functions:{colorBins:e3t,colorCategories:i3t,colorContinuous:n3t}},eN=new XBt({configuration:$Bt}),tTt={[K_.layerName]:["getFillColor"],[d_.layerName]:["getFillColor"],[_c.layerName]:["getFillColor"],[Hp.layerName]:["getFillColor"],[e_.layerName]:["getFillColor"],[t_.layerName]:["getFillColor"],[c_.layerName]:["getColor"],[Mg.layerName]:["getTargetColor","getSourceColor"],[dc.layerName]:["getFillColor"],[nu.layerName]:["getFillColor"],[mp.layerName]:["getColor"],[Dy.layerName]:["getColor"],[ch.layerName]:["getColor"],[Rg.layerName]:["getColor"],[fh.layerName]:["getFillColor"],[Dg.layerName]:["getFillColor","getColor","getLineColor"],[hh.layerName]:["getFillColor"],[mf.layerName]:["getColor"],[Yg.layerName]:["getColor"],[bf.layerName]:["getColor"]},eTt=({object:e,objectInfo:t,originalFillFunction:i})=>{const n=typeof i=="function"?i(e,t):i;if(Array.isArray(n))return[n[0]||0,n[1]||0,n[2]||0,n[3]||255];if(typeof n=="string"&&n.startsWith("@@=")){const r=eN.convert({originalColor:n}).originalColor(e);return[r[0]||0,r[1]||0,r[2]||0,r[3]||255]}return null},iN=({isSelected:e,object:t,objectInfo:i,opacity:n,originalFillFunction:r})=>{const s=eTt({object:t,objectInfo:i,originalFillFunction:r});if(!s)return null;let o=0;return e?o=Math.max(typeof s[3]=="number"?s[3]:n,n):o=Math.min(typeof s[3]=="number"?s[3]:n,n),[s[0]||0,s[1]||0,s[2]||0,o]},iTt=({isSelected:e,object:t,objectInfo:i,originalFillFunction:n,selectedColor:r,selectedOpacity:s=255,unselectedColor:o,unselectedOpacity:l=Math.floor(255*.4)})=>e?iN({opacity:s,isSelected:!0,object:t,objectInfo:i,originalFillFunction:n})||r:iN({opacity:l,isSelected:!1,object:t,objectInfo:i,originalFillFunction:n})||o,sm={selection:{indices:{},objects:{}}},nN=(e,t)=>{const i=t.match(/{(.*?)}/g);return i&&i.forEach(n=>{const r=n.substring(1,n.length-1);e.object.hasOwnProperty(r)?t=t.replace(n,e.object[r]):e.object.hasOwnProperty("properties")&&e.object.properties.hasOwnProperty(r)&&(t=t.replace(n,e.object.properties[r]))}),t};function nTt(e,t){return t.id?e.getElementState(t.id,"selection")??sm:sm}function rTt(e,t){if(!t.id)return sm;const i=e.getStringValue(t);return(i?Zv.parse(i):null)??sm}function oTt(e,t,i,n){e.id&&t.setStringValue(e,JSON.stringify(i.value),{fromUi:i.fromUi},n)}const sTt=e=>{var t;const{height:i,width:n,expanded:r}=MB(PB),{element:s,fragmentId:o,isLightTheme:l,theme:h,widgetMgr:A}=e,{selectionMode:v,tooltip:C,useContainerWidth:S}=s,L=r??!1,[N,G]=AG({element:s,getDefaultState:nTt,getStateFromWidgetMgr:rTt,updateWidgetMgrState:oTt,widgetMgr:A,fragmentId:o}),[W,j]=Ie.useState(null),{height:q,width:Z}=zct({element:s,isFullScreen:L,shouldUseContainerWidth:S,container:{height:i,width:n},heightFallback:((t=W==null?void 0:W.initialViewState)==null?void 0:t.height)||h.sizes.defaultMapHeight}),[K,ft]=Ie.useState(null),rt=v[0],Lt=rt!==void 0,Vt=Lt&&Object.keys(N.selection.indices).length>0,At=Ie.useMemo(()=>Object.freeze(Zv.parse(s.json)),[L,l,s.json]),at=Ie.useMemo(()=>{const ht={...At};if(ht.mapStyle||(ht.mapStyle=`mapbox://styles/mapbox/${l?"light":"dark"}-v9`),ht.layers){const Mt=Object.values(N.selection.indices).some(Ct=>Ct==null?void 0:Ct.length),pe=ht.layers.some(Ct=>Object.hasOwn(Ct,"pickable"));ht.layers=ht.layers.map(Ct=>{var Dt,Gt;if(!Ct||Array.isArray(Ct)||!Lt)return Ct;pe||(Ct.pickable=!0);const te=`${Ct.id||null}`,re=((Gt=(Dt=N==null?void 0:N.selection)==null?void 0:Dt.indices)==null?void 0:Gt[te])||[],ae=tTt[Ct["@@type"]];if(!ae)return Ct;const he={...Ct};return ae.forEach(Pe=>{var Se;he.updateTriggers={[Pe]:[...((Se=he.updateTriggers)==null?void 0:Se[Pe])||[],re,Mt]};const se=!Mt,fi=Ct[Pe];if(se||!fi)return he;const Ze=255,Ye=Math.floor(255*.4),ze=SB(h.colors.primary),pi=[ze[0],ze[1],ze[2],Ze],sn=SB(h.colors.gray20),Ii=[sn[0],sn[1],sn[2],Ye],_i=(Fn,Ai)=>iTt({isSelected:re.includes(Ai.index),object:Fn,objectInfo:Ai,originalFillFunction:fi,selectedColor:pi,unselectedColor:Ii,selectedOpacity:Ze,unselectedOpacity:Ye});he[Pe]=_i}),he})}return ht==null||delete ht.views,eN.convert(ht)},[N.selection.indices,l,Lt,At,h.colors.gray20,h.colors.primary]);Ie.useEffect(()=>{if(!lG(at.initialViewState,K)){const ht=Object.keys(at.initialViewState).reduce((Mt,pe)=>at.initialViewState[pe]===(K==null?void 0:K[pe])?Mt:{...Mt,[pe]:at.initialViewState[pe]},{});j(Mt=>({...Mt,...ht})),ft(at.initialViewState)}},[at.initialViewState,K,W]);const kt=Ie.useCallback(ht=>{if(!ht||!ht.object||!C)return null;const Mt=Zv.parse(C);return Mt.html?Mt.html=nN(ht,Mt.html):Mt.text=nN(ht,Mt.text),Mt},[C]),X=Ie.useCallback(({viewState:ht})=>{j(ht)},[j]);return{createTooltip:kt,data:N,deck:at,hasActiveSelection:Vt,height:q,isSelectionModeActivated:Lt,onViewStateChange:X,selectionMode:rt,setSelection:G,viewState:W,width:Z}};Ig([H2,gx]);const kE=sm.selection,aTt=[],lTt=e=>{const{disabled:t,disableFullscreenMode:i,element:n,fragmentId:r,mapboxToken:s,widgetMgr:o}=e,{mapboxToken:l}=n,h=cG(),{expanded:A,expand:v,collapse:C}=MB(PB),{createTooltip:S,data:L,deck:N,hasActiveSelection:G,height:W,isSelectionModeActivated:j,onViewStateChange:q,selectionMode:Z,setSelection:K,viewState:ft,width:rt}=sTt({element:n,fragmentId:r,isLightTheme:TB(h),theme:h,widgetMgr:o}),[Lt,Vt]=Ie.useState(!1);Ie.useEffect(()=>{Vt(!0)},[]);const At=Ie.useCallback(kt=>{var X;if(Z===void 0)return;const{index:ht,object:Mt}=kt,pe=`${((X=kt.layer)==null?void 0:X.id)||null}`,Ct=L,Dt=ht===-1,Gt=(()=>{var te;if(Dt)return kE;switch(Z){case IB.SelectionMode.SINGLE_OBJECT:return((te=Ct.selection.indices[pe])==null?void 0:te[0])===ht?kE:{indices:{[`${pe}`]:[ht]},objects:{[`${pe}`]:[Mt]}};case IB.SelectionMode.MULTI_OBJECT:{const re=new Map((()=>{var ae,he;return(((he=(ae=Ct==null?void 0:Ct.selection)==null?void 0:ae.indices)==null?void 0:he[pe])||[]).map((Pe,Se)=>{var se,fi,Ze;return[Pe,(Ze=(fi=(se=Ct.selection)==null?void 0:se.objects)==null?void 0:fi[pe])==null?void 0:Ze[Se]]})})());if(re.has(ht)?re.delete(ht):re.set(ht,Mt),re.size===0){const{[pe]:ae,...he}=Ct.selection.indices,{[pe]:Pe,...Se}=Ct.selection.objects;return{indices:he,objects:Se}}return{indices:{...Ct.selection.indices,[`${pe}`]:Array.from(re.keys())},objects:{...Ct.selection.objects,[`${pe}`]:Array.from(re.values())}}}default:throw uG(Z),new Error("Invalid selection mode")}})();JSON.stringify(Gt)!==JSON.stringify(Ct.selection)&&K({fromUi:!0,value:{selection:Gt}})},[Z,L,K]),at=Ie.useCallback(()=>{K({value:{selection:kE},fromUi:!0})},[K]);return ir.jsxs(zD,{className:"stDeckGlJsonChart","data-testid":"stDeckGlJsonChart",height:W,children:[ir.jsx(fG,{isFullScreen:A,disableFullscreenMode:i,onExpand:v,onCollapse:C,target:zD,locked:G&&!t?!0:void 0,children:G&&!t&&ir.jsx(dG,{label:"Clear selection",onClick:at,icon:hG})}),ft&&ir.jsxs(H$,{viewState:ft,onViewStateChange:q,height:W,width:rt,layers:Lt?N.layers:aTt,getTooltip:S,ContextProvider:cf.Provider,controller:!0,onClick:j&&!t?At:void 0,children:[ir.jsx($c,{height:W,width:rt,mapStyle:N.mapStyle&&(typeof N.mapStyle=="string"?N.mapStyle:N.mapStyle[0]),mapboxApiAccessToken:l||s}),ir.jsx(Gct,{children:ir.jsx(cnt,{"data-testid":"stDeckGlJsonChartZoomButton",showCompass:!1})})]})]})},cTt=pG(Uct("st.pydeck_chart")(lTt)),uTt=Ie.memo(cTt);export{uTt as default};
